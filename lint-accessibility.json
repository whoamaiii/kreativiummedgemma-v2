[{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/coverage/block-navigation.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/coverage/prettify.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/coverage/sorter.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/scripts/analyze-performance.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/scripts/cleanupProfileSections.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/scripts/i18n/key_diff.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/scripts/i18n/offenders_to_md.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/scripts/i18n/scan.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/scripts/lint-locales.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/scripts/seed-demo.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/scripts/testAnalyticsFallback.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/scripts/toggle-optimizations.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/scripts/validate-i18n.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/scripts/verify-local-pr.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/AccessibilityWrapper.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/AdvancedFilterPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/AdvancedSearch.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \": \"\"","line":270,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":270,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"secondary\" className=\"flex items-center gap-1\">\n                {String(tCommon('interface.search'))}: \"{filters.query}\"\n                <X\n                  className=\"h-3 w-3 cursor-pointer\"\n                  onClick={() => removeFilter(\"query\")}\n                />\n              </Badge>","line":270,"column":54,"nodeType":"JSXText","endLine":270,"endColumn":57},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"\"\"","line":270,"column":72,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":271,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"students,\"","line":463,"column":92,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":463,"endColumn":103},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>\n                  {String(tCommon('interface.results'))}: {filteredResults.students.length} students, {filteredResults.emotions.length} emotions, {filteredResults.sensoryInputs.length} sensory inputs, {filteredResults.goals.length} goals\n                </span>","line":463,"column":92,"nodeType":"JSXText","endLine":463,"endColumn":103},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"emotions,\"","line":463,"column":136,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":463,"endColumn":147},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>\n                  {String(tCommon('interface.results'))}: {filteredResults.students.length} students, {filteredResults.emotions.length} emotions, {filteredResults.sensoryInputs.length} sensory inputs, {filteredResults.goals.length} goals\n                </span>","line":463,"column":136,"nodeType":"JSXText","endLine":463,"endColumn":147},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"sensory inputs,\"","line":463,"column":185,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":463,"endColumn":202},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>\n                  {String(tCommon('interface.results'))}: {filteredResults.students.length} students, {filteredResults.emotions.length} emotions, {filteredResults.sensoryInputs.length} sensory inputs, {filteredResults.goals.length} goals\n                </span>","line":463,"column":185,"nodeType":"JSXText","endLine":463,"endColumn":202},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"goals\"","line":463,"column":232,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":464,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>\n                  {String(tCommon('interface.results'))}: {filteredResults.students.length} students, {filteredResults.emotions.length} emotions, {filteredResults.sensoryInputs.length} sensory inputs, {filteredResults.goals.length} goals\n                </span>","line":463,"column":232,"nodeType":"JSXText","endLine":464,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useMemo } from \"react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { DatePickerWithRange } from \"@/components/ui/date-range-picker\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport { Search, Filter, X, ChevronDown, Calendar } from \"lucide-react\";\nimport { Student, TrackingEntry, EmotionEntry, SensoryEntry, Goal } from \"@/types/student\";\nimport { format, isWithinInterval } from \"date-fns\";\nimport { useTranslation } from \"@/hooks/useTranslation\";\n\ninterface SearchFilters {\n  query: string;\n  emotions: string[];\n  sensoryTypes: string[];\n  dateRange: { from: Date | undefined; to: Date | undefined } | undefined;\n  goalStatus: string[];\n  intensityRange: { min: number; max: number };\n}\n\ninterface AdvancedSearchProps {\n  students: Student[];\n  trackingEntries: TrackingEntry[];\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  goals: Goal[];\n  onResultsChange: (results: {\n    students: Student[];\n    entries: TrackingEntry[];\n    emotions: EmotionEntry[];\n    sensoryInputs: SensoryEntry[];\n    goals: Goal[];\n  }) => void;\n}\n\nconst emotionTypes = [\"happy\", \"sad\", \"angry\", \"anxious\", \"calm\", \"frustrated\", \"excited\", \"confused\"];\nconst sensoryTypes = [\"visual\", \"auditory\", \"tactile\", \"vestibular\", \"proprioceptive\"];\nconst goalStatuses = [\"active\", \"achieved\", \"paused\", \"discontinued\"];\n\nexport const AdvancedSearch: React.FC<AdvancedSearchProps> = ({\n  students,\n  trackingEntries,\n  emotions,\n  sensoryInputs,\n  goals,\n  onResultsChange\n}) => {\n  const { tAnalytics, tCommon } = useTranslation();\n  const [filters, setFilters] = useState<SearchFilters>({\n    query: \"\",\n    emotions: [],\n    sensoryTypes: [],\n    dateRange: undefined,\n    goalStatus: [],\n    intensityRange: { min: 1, max: 5 }\n  });\n  \n  const [isFiltersOpen, setIsFiltersOpen] = useState(false);\n  const [activeFiltersCount, setActiveFiltersCount] = useState(0);\n\n  const filteredResults = useMemo(() => {\n    let filteredStudents = students;\n    let filteredEntries = trackingEntries;\n    let filteredEmotions = emotions;\n    let filteredSensoryInputs = sensoryInputs;\n    let filteredGoals = goals;\n\n    // Text search - optimized to build Set during filtering\n    if (filters.query.trim()) {\n      const query = filters.query.toLowerCase();\n      const studentIds = new Set<string>();\n      \n      // Filter students and collect IDs in a single pass\n      filteredStudents = filteredStudents.filter(student => {\n        const matches = student.name.toLowerCase().includes(query) ||\n                        student.notes?.toLowerCase().includes(query);\n        if (matches) {\n          studentIds.add(student.id);\n        }\n        return matches;\n      });\n      \n      // Use pre-built Set for filtering related data\n      filteredEntries = filteredEntries.filter(entry => studentIds.has(entry.studentId));\n      filteredEmotions = filteredEmotions.filter(emotion => studentIds.has(emotion.studentId));\n      filteredSensoryInputs = filteredSensoryInputs.filter(sensory => studentIds.has(sensory.studentId));\n      filteredGoals = filteredGoals.filter(goal => studentIds.has(goal.studentId));\n    }\n\n    // Date range filter\n    if (filters.dateRange?.from && filters.dateRange?.to) {\n      const dateInterval = { start: filters.dateRange.from, end: filters.dateRange.to };\n      filteredEntries = filteredEntries.filter(entry =>\n        isWithinInterval(entry.timestamp, dateInterval)\n      );\n      filteredEmotions = filteredEmotions.filter(emotion =>\n        isWithinInterval(emotion.timestamp, dateInterval)\n      );\n      filteredSensoryInputs = filteredSensoryInputs.filter(sensory =>\n        isWithinInterval(sensory.timestamp, dateInterval)\n      );\n    }\n\n    // Emotion type filter - optimized to build Set during filtering\n    if (filters.emotions.length > 0) {\n      const emotionStudentIds = new Set<string>();\n      \n      // Filter emotions and collect student IDs in a single pass\n      filteredEmotions = filteredEmotions.filter(emotion => {\n        const matches = filters.emotions.includes(emotion.emotion);\n        if (matches && emotion.studentId) {\n          emotionStudentIds.add(emotion.studentId);\n        }\n        return matches;\n      });\n      \n      filteredStudents = filteredStudents.filter(student => emotionStudentIds.has(student.id));\n    }\n\n    // Sensory type filter - optimized to build Set during filtering\n    if (filters.sensoryTypes.length > 0) {\n      const sensoryStudentIds = new Set<string>();\n      \n      // Filter sensory inputs and collect student IDs in a single pass\n      filteredSensoryInputs = filteredSensoryInputs.filter(sensory => {\n        const matches = filters.sensoryTypes.includes(sensory.sensoryType);\n        if (matches && sensory.studentId) {\n          sensoryStudentIds.add(sensory.studentId);\n        }\n        return matches;\n      });\n      \n      if (filters.emotions.length === 0) {\n        filteredStudents = filteredStudents.filter(student => sensoryStudentIds.has(student.id));\n      }\n    }\n\n    // Intensity range filter\n    filteredEmotions = filteredEmotions.filter(emotion =>\n      emotion.intensity >= filters.intensityRange.min &&\n      emotion.intensity <= filters.intensityRange.max\n    );\n\n    // Goal status filter - optimized to build Set during filtering\n    if (filters.goalStatus.length > 0) {\n      const goalStudentIds = new Set<string>();\n      \n      // Filter goals and collect student IDs in a single pass\n      filteredGoals = filteredGoals.filter(goal => {\n        const matches = filters.goalStatus.includes(goal.status);\n        if (matches && goal.studentId) {\n          goalStudentIds.add(goal.studentId);\n        }\n        return matches;\n      });\n      \n      if (filters.emotions.length === 0 && filters.sensoryTypes.length === 0) {\n        filteredStudents = filteredStudents.filter(student => goalStudentIds.has(student.id));\n      }\n    }\n\n    return {\n      students: filteredStudents,\n      entries: filteredEntries,\n      emotions: filteredEmotions,\n      sensoryInputs: filteredSensoryInputs,\n      goals: filteredGoals\n    };\n  }, [students, trackingEntries, emotions, sensoryInputs, goals, filters]);\n\n  // Update active filters count\n  React.useEffect(() => {\n    let count = 0;\n    if (filters.query.trim()) count++;\n    if (filters.emotions.length > 0) count++;\n    if (filters.sensoryTypes.length > 0) count++;\n    if (filters.dateRange?.from && filters.dateRange?.to) count++;\n    if (filters.goalStatus.length > 0) count++;\n    if (filters.intensityRange.min > 1 || filters.intensityRange.max < 5) count++;\n    setActiveFiltersCount(count);\n  }, [filters]);\n\n  // Notify parent of results change\n  React.useEffect(() => {\n    onResultsChange(filteredResults);\n  }, [filteredResults, onResultsChange]);\n\n  const clearAllFilters = () => {\n    setFilters({\n      query: \"\",\n      emotions: [],\n      sensoryTypes: [],\n      dateRange: undefined,\n      goalStatus: [],\n      intensityRange: { min: 1, max: 5 }\n    });\n  };\n\n  const removeFilter = (type: string, value?: string) => {\n    switch (type) {\n      case \"query\":\n        setFilters(prev => ({ ...prev, query: \"\" }));\n        break;\n      case \"emotion\":\n        setFilters(prev => ({\n          ...prev,\n          emotions: prev.emotions.filter(e => e !== value)\n        }));\n        break;\n      case \"sensory\":\n        setFilters(prev => ({\n          ...prev,\n          sensoryTypes: prev.sensoryTypes.filter(s => s !== value)\n        }));\n        break;\n      case \"date\":\n        setFilters(prev => ({ ...prev, dateRange: undefined }));\n        break;\n      case \"goal\":\n        setFilters(prev => ({\n          ...prev,\n          goalStatus: prev.goalStatus.filter(g => g !== value)\n        }));\n        break;\n    }\n  };\n\n  return (\n    <Card className=\"bg-gradient-card border-0 shadow-soft\">\n      <CardHeader className=\"pb-4\">\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <Search className=\"h-5 w-5 text-primary\" />\n            {String(tAnalytics('interface.advancedSearchFiltering'))}\n          </CardTitle>\n          <Collapsible open={isFiltersOpen} onOpenChange={setIsFiltersOpen}>\n            <CollapsibleTrigger asChild>\n              <Button variant=\"ghost\" size=\"sm\">\n                <Filter className=\"h-4 w-4 mr-2\" />\n                {String(tCommon('interface.filters'))}\n                {activeFiltersCount > 0 && (\n                  <Badge variant=\"secondary\" className=\"ml-2 h-5 w-5 rounded-full p-0 text-xs\">\n                    {activeFiltersCount}\n                  </Badge>\n                )}\n                <ChevronDown className=\"h-4 w-4 ml-2\" />\n              </Button>\n            </CollapsibleTrigger>\n          </Collapsible>\n        </div>\n        \n        <div className=\"flex items-center gap-2\">\n          <Search className=\"h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder={`${String(tCommon('interface.search'))}...`}\n            value={filters.query}\n            onChange={(e) => setFilters(prev => ({ ...prev, query: e.target.value }))}\n            className=\"flex-1\"\n          />\n        </div>\n\n        {/* Active Filters Display */}\n        {activeFiltersCount > 0 && (\n          <div className=\"flex flex-wrap gap-2 pt-2\">\n            {filters.query && (\n              <Badge variant=\"secondary\" className=\"flex items-center gap-1\">\n                {String(tCommon('interface.search'))}: \"{filters.query}\"\n                <X\n                  className=\"h-3 w-3 cursor-pointer\"\n                  onClick={() => removeFilter(\"query\")}\n                />\n              </Badge>\n            )}\n            {filters.emotions.map(emotion => (\n              <Badge key={emotion} variant=\"secondary\" className=\"flex items-center gap-1\">\n                {String(tCommon('interface.emotion'))}: {emotion}\n                <X\n                  className=\"h-3 w-3 cursor-pointer\"\n                  onClick={() => removeFilter(\"emotion\", emotion)}\n                />\n              </Badge>\n            ))}\n            {filters.sensoryTypes.map(sensory => (\n              <Badge key={sensory} variant=\"secondary\" className=\"flex items-center gap-1\">\n                {String(tCommon('interface.sensory'))}: {sensory}\n                <X\n                  className=\"h-3 w-3 cursor-pointer\"\n                  onClick={() => removeFilter(\"sensory\", sensory)}\n                />\n              </Badge>\n            ))}\n            {filters.dateRange?.from && filters.dateRange?.to && (\n              <Badge variant=\"secondary\" className=\"flex items-center gap-1\">\n                <Calendar className=\"h-3 w-3\" />\n                {format(filters.dateRange.from, \"MMM dd\")} - {format(filters.dateRange.to, \"MMM dd\")}\n                <X\n                  className=\"h-3 w-3 cursor-pointer\"\n                  onClick={() => removeFilter(\"date\")}\n                />\n              </Badge>\n            )}\n            {filters.goalStatus.map(status => (\n              <Badge key={status} variant=\"secondary\" className=\"flex items-center gap-1\">\n                {String(tCommon('interface.goal'))}: {status}\n                <X\n                  className=\"h-3 w-3 cursor-pointer\"\n                  onClick={() => removeFilter(\"goal\", status)}\n                />\n              </Badge>\n            ))}\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={clearAllFilters}\n              className=\"h-6 px-2 text-xs\"\n            >\n              {String(tCommon('interface.clearAll'))}\n            </Button>\n          </div>\n        )}\n      </CardHeader>\n\n      <Collapsible open={isFiltersOpen} onOpenChange={setIsFiltersOpen}>\n        <CollapsibleContent>\n          <CardContent className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {/* Date Range Filter */}\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">{String(tCommon('interface.dateRange'))}</label>\n                <DatePickerWithRange\n                  value={filters.dateRange}\n                  onChange={(range) => setFilters(prev => ({ ...prev, dateRange: range }))}\n                />\n              </div>\n\n              {/* Emotion Types Filter */}\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">{String(tCommon('interface.emotionTypes'))}</label>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  {emotionTypes.map((emotion) => (\n                    <div key={emotion} className=\"flex items-center space-x-2\">\n                      <Checkbox\n                        id={`emotion-${emotion}`}\n                        checked={filters.emotions.includes(emotion)}\n                        onCheckedChange={(checked) => {\n                          if (checked) {\n                            setFilters(prev => ({ ...prev, emotions: [...prev.emotions, emotion] }));\n                          } else {\n                            setFilters(prev => ({ ...prev, emotions: prev.emotions.filter(e => e !== emotion) }));\n                          }\n                        }}\n                      />\n                      <label htmlFor={`emotion-${emotion}`} className=\"text-sm capitalize\">\n                        {emotion}\n                      </label>\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              {/* Sensory Types Filter */}\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">{String(tCommon('interface.sensoryTypes'))}</label>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  {sensoryTypes.map((sensory) => (\n                    <div key={sensory} className=\"flex items-center space-x-2\">\n                      <Checkbox\n                        id={`sensory-${sensory}`}\n                        checked={filters.sensoryTypes.includes(sensory)}\n                        onCheckedChange={(checked) => {\n                          if (checked) {\n                            setFilters(prev => ({ ...prev, sensoryTypes: [...prev.sensoryTypes, sensory] }));\n                          } else {\n                            setFilters(prev => ({ ...prev, sensoryTypes: prev.sensoryTypes.filter(s => s !== sensory) }));\n                          }\n                        }}\n                      />\n                      <label htmlFor={`sensory-${sensory}`} className=\"text-sm capitalize\">\n                        {sensory}\n                      </label>\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              {/* Goal Status Filter */}\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">{String(tCommon('interface.goalStatus'))}</label>\n                <div className=\"grid grid-cols-2 gap-2\">\n                  {goalStatuses.map((status) => (\n                    <div key={status} className=\"flex items-center space-x-2\">\n                      <Checkbox\n                        id={`goal-${status}`}\n                        checked={filters.goalStatus.includes(status)}\n                        onCheckedChange={(checked) => {\n                          if (checked) {\n                            setFilters(prev => ({ ...prev, goalStatus: [...prev.goalStatus, status] }));\n                          } else {\n                            setFilters(prev => ({ ...prev, goalStatus: prev.goalStatus.filter(g => g !== status) }));\n                          }\n                        }}\n                      />\n                      <label htmlFor={`goal-${status}`} className=\"text-sm capitalize\">\n                        {status}\n                      </label>\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              {/* Intensity Range Filter */}\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">{String(tCommon('interface.emotionIntensityRange'))}</label>\n                <div className=\"flex items-center space-x-2\">\n                  <Select\n                    value={filters.intensityRange.min.toString()}\n                    onValueChange={(value) => \n                      setFilters(prev => ({ \n                        ...prev, \n                        intensityRange: { ...prev.intensityRange, min: parseInt(value) }\n                      }))\n                    }\n                  >\n                    <SelectTrigger className=\"w-20\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {[1, 2, 3, 4, 5].map(num => (\n                        <SelectItem key={num} value={num.toString()}>{num}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <span className=\"text-sm text-muted-foreground\">{String(tCommon('interface.to'))}</span>\n                  <Select\n                    value={filters.intensityRange.max.toString()}\n                    onValueChange={(value) => \n                      setFilters(prev => ({ \n                        ...prev, \n                        intensityRange: { ...prev.intensityRange, max: parseInt(value) }\n                      }))\n                    }\n                  >\n                    <SelectTrigger className=\"w-20\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {[1, 2, 3, 4, 5].map(num => (\n                        <SelectItem key={num} value={num.toString()}>{num}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n            </div>\n\n            {/* Results Summary */}\n            <div className=\"pt-4 border-t border-border/50\">\n              <div className=\"flex items-center justify-between text-sm text-muted-foreground\">\n                <span>\n                  {String(tCommon('interface.results'))}: {filteredResults.students.length} students, {filteredResults.emotions.length} emotions, {filteredResults.sensoryInputs.length} sensory inputs, {filteredResults.goals.length} goals\n                </span>\n                {activeFiltersCount > 0 && (\n                  <Button variant=\"ghost\" size=\"sm\" onClick={clearAllFilters}>\n                    {String(tCommon('interface.clearAllFilters'))}\n                  </Button>\n                )}\n              </div>\n            </div>\n          </CardContent>\n        </CollapsibleContent>\n      </Collapsible>\n    </Card>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/AlertManager.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"data points\"","line":156,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":156,"endColumn":68},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>{alertEntry.alert.dataPoints} data points</span>","line":156,"column":56,"nodeType":"JSXText","endLine":156,"endColumn":68},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Resolved\"","line":158,"column":95,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":160,"endColumn":23},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\" className=\"text-success-foreground bg-success\">\n                        Resolved\n                      </Badge>","line":158,"column":95,"nodeType":"JSXText","endLine":160,"endColumn":23},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Review details and add resolution notes before confirming.\"","line":198,"column":44,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":200,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DialogDescription>\n                          Review details and add resolution notes before confirming.\n                        </DialogDescription>","line":198,"column":44,"nodeType":"JSXText","endLine":200,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogDescription } from \"@/components/ui/dialog\";\nimport { AlertTriangle, CheckCircle, Eye, TrendingUp } from \"lucide-react\";\nimport { alertSystem, AlertHistoryEntry } from \"@/lib/alertSystem\";\nimport { toast } from \"sonner\";\nimport { logger } from '@/lib/logger';\nimport { useTranslation } from '@/hooks/useTranslation';\n\ninterface AlertManagerProps {\n  studentId?: string;\n  showOnlyUnresolved?: boolean;\n}\n\nexport const AlertManager = ({ studentId, showOnlyUnresolved = false }: AlertManagerProps) => {\n  const { tAnalytics, tCommon } = useTranslation();\n  const [alerts, setAlerts] = useState<AlertHistoryEntry[]>([]);\n  const [selectedAlert, setSelectedAlert] = useState<AlertHistoryEntry | null>(null);\n  const [resolveNotes, setResolveNotes] = useState<string>('');\n  const [isResolving, setIsResolving] = useState<boolean>(false);\n\n  const loadAlerts = useCallback(() => {\n    let alertList: AlertHistoryEntry[];\n    \n    if (studentId) {\n      alertList = alertSystem.getStudentAlerts(studentId);\n    } else {\n      alertList = alertSystem.getAllAlerts();\n    }\n\n    if (showOnlyUnresolved) {\n      alertList = alertList.filter(alert => !alert.resolved);\n    }\n\n    // Sort a copy to avoid mutating the original array\n    const sortedAlerts = [...alertList].sort((a, b) => {\n      const severityOrder = { high: 3, medium: 2, low: 1 };\n      const severityDiff = severityOrder[b.alert.severity] - severityOrder[a.alert.severity];\n      if (severityDiff !== 0) return severityDiff;\n      return b.alert.timestamp.getTime() - a.alert.timestamp.getTime();\n    });\n\n    setAlerts(sortedAlerts);\n  }, [studentId, showOnlyUnresolved]);\n\n  useEffect(() => {\n    loadAlerts();\n  }, [loadAlerts]);\n\n  const handleMarkAsViewed = (alertId: string) => {\n    alertSystem.markAlertAsViewed(alertId);\n    loadAlerts();\n    toast.success('Alert marked as viewed');\n  };\n\n  /**\n   * Handle alert resolution with proper cleanup and state management.\n   * Ensures dialog state is properly reset after resolution.\n   */\n  const handleResolveAlert = () => {\n    if (!selectedAlert) return;\n    \n    setIsResolving(true);\n    \n    try {\n      alertSystem.resolveAlert(\n        selectedAlert.alert.id, \n        'Teacher', // In a real app, this would be the current user\n        resolveNotes.trim() || undefined\n      );\n      \n      // Clean up state after successful resolution\n      setSelectedAlert(null);\n      setResolveNotes('');\n      loadAlerts();\n      toast.success('Alert resolved successfully');\n    } catch (error) {\n      logger.error('Failed to resolve alert', error);\n      toast.error('Failed to resolve alert. Please try again.');\n    } finally {\n      setIsResolving(false);\n    }\n  };\n\n  const getSeverityIcon = (severity: string) => {\n    switch (severity) {\n      case 'high':\n        return <AlertTriangle className=\"h-4 w-4 text-destructive\" />;\n      case 'medium':\n        return <AlertTriangle className=\"h-4 w-4 text-warning\" />;\n      case 'low':\n        return <TrendingUp className=\"h-4 w-4 text-info\" />;\n      default:\n        return <AlertTriangle className=\"h-4 w-4\" />;\n    }\n  };\n\n  const getSeverityColor = (severity: string) => {\n    switch (severity) {\n      case 'high':\n        return 'destructive';\n      case 'medium':\n        return 'default';\n      case 'low':\n        return 'secondary';\n      default:\n        return 'outline';\n    }\n  };\n\n  if (alerts.length === 0) {\n    return (\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"text-center text-muted-foreground\">\n            <CheckCircle className=\"h-8 w-8 mx-auto mb-2 text-success\" />\n            <p>{showOnlyUnresolved ? String(tAnalytics('alerts.noneUnresolved')) : String(tAnalytics('alerts.none'))}</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {alerts.map((alertEntry) => (\n        <Card key={alertEntry.alert.id} className={`transition-all ${\n          !alertEntry.viewed ? 'ring-2 ring-primary/20' : ''\n        }`}>\n          <CardHeader className=\"pb-3\">\n            <div className=\"flex items-start justify-between\">\n              <div className=\"flex items-start gap-3\">\n                <div className=\"mt-1\">\n                  {getSeverityIcon(alertEntry.alert.severity)}\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-center gap-2 mb-1\">\n                    <CardTitle className=\"text-base font-semibold\">\n                      {alertEntry.alert.title}\n                    </CardTitle>\n                    <Badge variant={getSeverityColor(alertEntry.alert.severity) as \"default\" | \"secondary\" | \"destructive\" | \"outline\" | null | undefined}>\n                      {alertEntry.alert.severity}\n                    </Badge>\n                    <Badge variant=\"outline\" className=\"text-xs\">\n                      {alertEntry.alert.type}\n                    </Badge>\n                  </div>\n                  <p className=\"text-sm text-muted-foreground mb-2\">\n                    {alertEntry.alert.description}\n                  </p>\n                  <div className=\"flex items-center gap-4 text-xs text-muted-foreground\">\n                    <span>{alertEntry.alert.timestamp.toLocaleDateString()}</span>\n                    <span>{alertEntry.alert.dataPoints} data points</span>\n                    {alertEntry.resolved && (\n                      <Badge variant=\"outline\" className=\"text-success-foreground bg-success\">\n                        Resolved\n                      </Badge>\n                    )}\n                  </div>\n                </div>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                {!alertEntry.viewed && (\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => handleMarkAsViewed(alertEntry.alert.id)}\n                  >\n                    <Eye className=\"h-4 w-4\" />\n                  </Button>\n                )}\n                {!alertEntry.resolved && (\n                  <Dialog \n                    open={selectedAlert?.alert.id === alertEntry.alert.id}\n                    onOpenChange={(open) => {\n                      if (open) {\n                        setSelectedAlert(alertEntry);\n                      } else {\n                        setSelectedAlert(null);\n                        setResolveNotes('');\n                      }\n                    }}\n                  >\n                    <DialogTrigger asChild>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                      >\n                        {String(tCommon('resolve'))}\n                      </Button>\n                    </DialogTrigger>\n                    <DialogContent>\n                      <DialogHeader>\n                        <DialogTitle>{String(tAnalytics('alerts.resolveTitle'))}</DialogTitle>\n                        <DialogDescription>\n                          Review details and add resolution notes before confirming.\n                        </DialogDescription>\n                      </DialogHeader>\n                      <div className=\"space-y-4\">\n                        <div>\n                          <h4 className=\"font-medium mb-2\">{String(tAnalytics('alerts.details'))}</h4>\n                          <p className=\"text-sm text-muted-foreground mb-3\">\n                            {selectedAlert?.alert.description}\n                          </p>\n                          \n                          {selectedAlert?.alert.recommendations && selectedAlert.alert.recommendations.length > 0 && (\n                            <div>\n                              <h5 className=\"text-sm font-medium mb-2\">{String(tCommon('recommendations'))}:</h5>\n                              <ul className=\"text-sm text-muted-foreground space-y-1\">\n                                {selectedAlert.alert.recommendations.map((rec) => (\n                                  <li key={`${selectedAlert.alert.id}-${rec}`} className=\"flex items-start gap-2\">\n                                    <span className=\"text-primary\">•</span>\n                                    <span>{rec}</span>\n                                  </li>\n                                ))}\n                              </ul>\n                            </div>\n                          )}\n                        </div>\n                        \n                        <div>\n                          <label htmlFor=\"resolution-notes\" className=\"text-sm font-medium mb-2 block\">\n                            {String(tAnalytics('alerts.resolutionNotes'))}\n                          </label>\n                          <Textarea\n                            id=\"resolution-notes\"\n                            value={resolveNotes}\n                            onChange={(e) => setResolveNotes(e.target.value)}\n                            placeholder=\"Describe actions taken or observations...\"\n                            rows={3}\n                          />\n                        </div>\n                        \n                        <div className=\"flex justify-end gap-2\">\n                          <Button variant=\"outline\" onClick={() => setSelectedAlert(null)}>\n                            {String(tCommon('cancel'))}\n                          </Button>\n                          <Button \n                            onClick={handleResolveAlert}\n                            disabled={isResolving}\n                          >\n                            {isResolving ? String(tCommon('resolving')) : String(tAnalytics('alerts.resolveTitle'))}\n                          </Button>\n                        </div>\n                      </div>\n                    </DialogContent>\n                  </Dialog>\n                )}\n              </div>\n            </div>\n          </CardHeader>\n          \n          {alertEntry.alert.recommendations && alertEntry.alert.recommendations.length > 0 && (\n            <CardContent className=\"pt-0\">\n              <div className=\"bg-muted/50 rounded-lg p-3\">\n                  <h4 className=\"text-sm font-medium mb-2 text-foreground\">\n                  {String(tAnalytics('alerts.recommendedActions'))}:\n                </h4>\n                <ul className=\"text-sm text-muted-foreground space-y-1\">\n                  {alertEntry.alert.recommendations.map((recommendation) => (\n                    <li key={`${alertEntry.alert.id}-${recommendation}`} className=\"flex items-start gap-2\">\n                      <span className=\"text-primary\">•</span>\n                      <span>{recommendation}</span>\n                    </li>\n                  ))}\n                </ul>\n              </div>\n              \n              {alertEntry.resolved && alertEntry.resolvedNotes && (\n                <div className=\"mt-3 bg-success/10 border border-success/20 rounded-lg p-3\">\n                  <h5 className=\"text-sm font-medium text-success-foreground mb-1\">\n                    {String(tAnalytics('alerts.resolutionNotes'))}:\n                  </h5>\n                  <p className=\"text-sm text-success-foreground/80\">{alertEntry.resolvedNotes}</p>\n                  <p className=\"text-xs text-success-foreground/60 mt-1\">\n                    {String(tAnalytics('alerts.resolvedBy'))} {alertEntry.resolvedBy} {String(tCommon('on'))} {alertEntry.resolvedAt?.toLocaleDateString()}\n                  </p>\n                </div>\n              )}\n            </CardContent>\n          )}\n        </Card>\n      ))}\n    </div>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/AnalyticsConfigBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/AnalyticsConfigTest.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Analytics Configuration Tests\"","line":242,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":244,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n          <Settings className=\"h-5 w-5\" />\n          Analytics Configuration Tests\n        </CardTitle>","line":242,"column":43,"nodeType":"JSXText","endLine":244,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Verify that configuration changes and cache invalidation work correctly\"","line":245,"column":26,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":247,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardDescription>\n          Verify that configuration changes and cache invalidation work correctly\n        </CardDescription>","line":245,"column":26,"nodeType":"JSXText","endLine":247,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Current Configuration\"","line":252,"column":58,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":252,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground\">Current Configuration</p>","line":252,"column":58,"nodeType":"JSXText","endLine":252,"endColumn":79},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Alert Level:\"","line":254,"column":40,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":255,"endColumn":30},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\">\n                Alert Level: {currentConfig.alertSensitivity.level}\n              </Badge>","line":254,"column":40,"nodeType":"JSXText","endLine":255,"endColumn":30},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Min Data Points:\"","line":257,"column":40,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":258,"endColumn":34},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\">\n                Min Data Points: {currentConfig.patternAnalysis.minDataPoints}\n              </Badge>","line":257,"column":40,"nodeType":"JSXText","endLine":258,"endColumn":34},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Cache Size:\"","line":260,"column":40,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":261,"endColumn":29},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\">\n                Cache Size: {cacheSize}\n              </Badge>","line":260,"column":40,"nodeType":"JSXText","endLine":261,"endColumn":29},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Run Tests\"","line":266,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":268,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button onClick={runTests} className=\"flex items-center gap-2\">\n            <RefreshCw className=\"h-4 w-4\" />\n            Run Tests\n          </Button>","line":266,"column":46,"nodeType":"JSXText","endLine":268,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Test Results\"","line":273,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":273,"endColumn":61},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"text-sm font-medium\">Test Results</h4>","line":273,"column":49,"nodeType":"JSXText","endLine":273,"endColumn":61},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Quick Actions\"","line":293,"column":61,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":293,"endColumn":74},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground mb-2\">Quick Actions</p>","line":293,"column":61,"nodeType":"JSXText","endLine":293,"endColumn":74},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Set Conservative\"","line":299,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":301,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={() => analyticsConfig.setPreset('conservative')}\n            >\n              Set Conservative\n            </Button>","line":299,"column":14,"nodeType":"JSXText","endLine":301,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Set Sensitive\"","line":306,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":308,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={() => analyticsConfig.setPreset('sensitive')}\n            >\n              Set Sensitive\n            </Button>","line":306,"column":14,"nodeType":"JSXText","endLine":308,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Reset to Defaults\"","line":313,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":315,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={() => analyticsConfig.resetToDefaults()}\n            >\n              Reset to Defaults\n            </Button>","line":313,"column":14,"nodeType":"JSXText","endLine":315,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Clear Cache\"","line":320,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":322,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={clearCache}\n            >\n              Clear Cache\n            </Button>","line":320,"column":14,"nodeType":"JSXText","endLine":322,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":26,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { analyticsConfig } from '@/lib/analyticsConfig';\nimport { useAnalyticsWorker } from '@/hooks/useAnalyticsWorker';\nimport { CheckCircle, XCircle, RefreshCw, Settings } from 'lucide-react';\n\ninterface TestResult {\n  name: string;\n  status: 'pass' | 'fail' | 'pending';\n  message: string;\n}\n\nconst AnalyticsConfigTest: React.FC = () => {\n  const [testResults, setTestResults] = useState<TestResult[]>([]);\n  const [currentConfig, setCurrentConfig] = useState(analyticsConfig.getConfig());\n  const { cacheSize, clearCache } = useAnalyticsWorker();\n\n  useEffect(() => {\n    // Subscribe to configuration changes\n    const unsubscribe = analyticsConfig.subscribe((newConfig) => {\n      setCurrentConfig(newConfig);\n    });\n\n    return unsubscribe;\n  }, []);\n\n  const runTests = async () => {\n    const results: TestResult[] = [];\n\n    // Test 1: Configuration Persistence\n    try {\n      const originalConfig = analyticsConfig.getConfig();\n      analyticsConfig.updateConfig({\n        patternAnalysis: {\n          ...originalConfig.patternAnalysis,\n          minDataPoints: 7\n        }\n      });\n      \n      // Simulate page reload by creating new instance\n      const newConfigManager = analyticsConfig;\n      const loadedConfig = newConfigManager.getConfig();\n      \n      if (loadedConfig.patternAnalysis.minDataPoints === 7) {\n        results.push({\n          name: 'Configuration Persistence',\n          status: 'pass',\n          message: 'Configuration saved and loaded from localStorage successfully'\n        });\n      } else {\n        results.push({\n          name: 'Configuration Persistence',\n          status: 'fail',\n          message: 'Configuration not persisted correctly'\n        });\n      }\n      \n      // Reset to original\n      analyticsConfig.updateConfig(originalConfig);\n    } catch (error) {\n      results.push({\n        name: 'Configuration Persistence',\n        status: 'fail',\n        message: `Error: ${error}`\n      });\n    }\n\n    // Test 2: Preset Configuration\n    try {\n      analyticsConfig.setPreset('sensitive');\n      const sensitiveConfig = analyticsConfig.getConfig();\n      \n      if (sensitiveConfig.alertSensitivity.level === 'high' &&\n          sensitiveConfig.patternAnalysis.minDataPoints === 2) {\n        results.push({\n          name: 'Preset Configuration',\n          status: 'pass',\n          message: 'Sensitive preset applied correctly'\n        });\n      } else {\n        results.push({\n          name: 'Preset Configuration',\n          status: 'fail',\n          message: 'Preset not applied correctly'\n        });\n      }\n      \n      // Reset to balanced\n      analyticsConfig.setPreset('balanced');\n    } catch (error) {\n      results.push({\n        name: 'Preset Configuration',\n        status: 'fail',\n        message: `Error: ${error}`\n      });\n    }\n\n    // Test 3: Cache Invalidation on Config Change\n    try {\n      const initialCacheSize = cacheSize;\n      \n      // Update config with invalidateOnConfigChange = true\n      analyticsConfig.updateConfig({\n        cache: {\n          ...currentConfig.cache,\n          invalidateOnConfigChange: true\n        }\n      });\n      \n      // Change a threshold to trigger cache invalidation\n      analyticsConfig.updateConfig({\n        patternAnalysis: {\n          ...currentConfig.patternAnalysis,\n          minDataPoints: 5\n        }\n      });\n      \n      // Give the event loop a tick for cache invalidation without setTimeout\n      await new Promise<void>((resolve) => requestAnimationFrame(() => resolve()));\n      \n      results.push({\n        name: 'Cache Invalidation',\n        status: 'pass',\n        message: `Cache invalidation working (was ${initialCacheSize}, now ${cacheSize})`\n      });\n    } catch (error) {\n      results.push({\n        name: 'Cache Invalidation',\n        status: 'fail',\n        message: `Error: ${error}`\n      });\n    }\n\n    // Test 4: Configuration Export/Import\n    try {\n      const exported = analyticsConfig.exportConfig();\n      const parsed = JSON.parse(exported);\n      \n      if (parsed.patternAnalysis && parsed.alertSensitivity && parsed.cache) {\n        // Modify and import\n        parsed.patternAnalysis.minDataPoints = 10;\n        const importSuccess = analyticsConfig.importConfig(JSON.stringify(parsed));\n        \n        if (importSuccess && analyticsConfig.getConfig().patternAnalysis.minDataPoints === 10) {\n          results.push({\n            name: 'Configuration Export/Import',\n            status: 'pass',\n            message: 'Configuration exported and imported successfully'\n          });\n        } else {\n          results.push({\n            name: 'Configuration Export/Import',\n            status: 'fail',\n            message: 'Import failed or values not updated'\n          });\n        }\n      } else {\n        results.push({\n          name: 'Configuration Export/Import',\n          status: 'fail',\n          message: 'Export format invalid'\n        });\n      }\n      \n      // Reset to defaults\n      analyticsConfig.resetToDefaults();\n    } catch (error) {\n      results.push({\n        name: 'Configuration Export/Import',\n        status: 'fail',\n        message: `Error: ${error}`\n      });\n    }\n\n    // Test 5: Sensitivity Multipliers\n    try {\n      analyticsConfig.updateConfig({\n        alertSensitivity: {\n          level: 'high',\n          emotionIntensityMultiplier: 1.5,\n          frequencyMultiplier: 1.5,\n          anomalyMultiplier: 1.5\n        }\n      });\n      \n      const config = analyticsConfig.getConfig();\n      if (config.alertSensitivity.emotionIntensityMultiplier === 1.5) {\n        results.push({\n          name: 'Sensitivity Multipliers',\n          status: 'pass',\n          message: 'Sensitivity multipliers applied correctly'\n        });\n      } else {\n        results.push({\n          name: 'Sensitivity Multipliers',\n          status: 'fail',\n          message: 'Multipliers not set correctly'\n        });\n      }\n      \n      // Reset\n      analyticsConfig.resetToDefaults();\n    } catch (error) {\n      results.push({\n        name: 'Sensitivity Multipliers',\n        status: 'fail',\n        message: `Error: ${error}`\n      });\n    }\n\n    setTestResults(results);\n  };\n\n  const getStatusIcon = useCallback((status: TestResult['status']): React.ReactElement => {\n    switch (status) {\n      case 'pass':\n        return <CheckCircle className=\"h-5 w-5 text-green-600\" />;\n      case 'fail':\n        return <XCircle className=\"h-5 w-5 text-red-600\" />;\n      default:\n        return <RefreshCw className=\"h-5 w-5 text-gray-400 animate-spin\" />;\n    }\n  }, []);\n\n  const getStatusColor = useCallback((status: TestResult['status']): 'default' | 'destructive' | 'secondary' | 'outline' => {\n    switch (status) {\n      case 'pass':\n        return 'default';\n      case 'fail':\n        return 'destructive';\n      default:\n        return 'secondary';\n    }\n  }, []);\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Settings className=\"h-5 w-5\" />\n          Analytics Configuration Tests\n        </CardTitle>\n        <CardDescription>\n          Verify that configuration changes and cache invalidation work correctly\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"space-y-1\">\n            <p className=\"text-sm text-muted-foreground\">Current Configuration</p>\n            <div className=\"flex gap-2\">\n              <Badge variant=\"outline\">\n                Alert Level: {currentConfig.alertSensitivity.level}\n              </Badge>\n              <Badge variant=\"outline\">\n                Min Data Points: {currentConfig.patternAnalysis.minDataPoints}\n              </Badge>\n              <Badge variant=\"outline\">\n                Cache Size: {cacheSize}\n              </Badge>\n            </div>\n          </div>\n          <Button onClick={runTests} className=\"flex items-center gap-2\">\n            <RefreshCw className=\"h-4 w-4\" />\n            Run Tests\n          </Button>\n        </div>\n\n        {testResults.length > 0 && (\n          <div className=\"space-y-2\">\n            <h4 className=\"text-sm font-medium\">Test Results</h4>\n            {testResults.map((result) => (\n              <div\n                key={`${result.name}-${result.status}`}\n                className=\"flex items-start gap-3 p-3 rounded-lg bg-muted/50\"\n              >\n                {getStatusIcon(result.status)}\n                <div className=\"flex-1\">\n                  <p className=\"font-medium\">{result.name}</p>\n                  <p className=\"text-sm text-muted-foreground\">{result.message}</p>\n                </div>\n                <Badge variant={getStatusColor(result.status) as \"default\" | \"secondary\" | \"destructive\" | \"outline\"}>\n                  {result.status.toUpperCase()}\n                </Badge>\n              </div>\n            ))}\n          </div>\n        )}\n\n        <div className=\"pt-4 border-t\">\n          <p className=\"text-sm text-muted-foreground mb-2\">Quick Actions</p>\n          <div className=\"flex flex-wrap gap-2\">\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={() => analyticsConfig.setPreset('conservative')}\n            >\n              Set Conservative\n            </Button>\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={() => analyticsConfig.setPreset('sensitive')}\n            >\n              Set Sensitive\n            </Button>\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={() => analyticsConfig.resetToDefaults()}\n            >\n              Reset to Defaults\n            </Button>\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={clearCache}\n            >\n              Clear Cache\n            </Button>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n\nexport { AnalyticsConfigTest };\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/AnalyticsDashboard.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/AnalyticsDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":275,"column":108,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":111,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11813,11816],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11813,11816],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span data-testid=\"ai-latency\">{String(results.ai.latencyMs)} ms</span>","line":503,"column":80,"nodeType":"JSXText","endLine":503,"endColumn":83}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":92,"column":88,"nodeType":null,"messageId":"unusedVar","endLine":92,"endColumn":93,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4193,4196],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4193,4196],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4215,4218],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4215,4218],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'environmentalCorrelations' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":177,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":177,"endColumn":34,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getPatternIcon' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":307,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":307,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getConfidenceColor' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":321,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":321,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo, useRef, useCallback, memo } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport React, { Suspense } from 'react';\nimport { AnalyticsSettings } from \"@/components/AnalyticsSettings\";\nimport { LazyChartsPanel } from '@/components/lazy/LazyChartsPanel';\nimport { LazyPatternsPanel } from '@/components/lazy/LazyPatternsPanel';\nimport { LazyCorrelationsPanel } from '@/components/lazy/LazyCorrelationsPanel';\nimport { LazyAlertsPanel } from '@/components/lazy/LazyAlertsPanel';\nimport {\n  TrendingUp,\n  Brain,\n  Eye,\n  BarChart3,\n  Download,\n  FileText,\n  FileSpreadsheet,\n  FileJson,\n  Settings,\n} from \"lucide-react\";\nimport { Student, TrackingEntry, EmotionEntry, SensoryEntry } from \"@/types/student\";\nimport { useAnalyticsWorker } from \"@/hooks/useAnalyticsWorker\";\nimport { analyticsManager } from \"@/lib/analyticsManager\";\nimport { useTranslation } from \"@/hooks/useTranslation\";\nimport { analyticsExport, ExportFormat } from \"@/lib/analyticsExport\";\nimport { toast } from \"sonner\";\nimport { logger } from \"@/lib/logger\";\nimport { ErrorBoundary } from \"./ErrorBoundary\";\nimport { useSyncedTabParam } from '@/hooks/useSyncedTabParam';\nimport { Badge } from '@/components/ui/badge';\nimport { useAsyncState } from '@/hooks/useAsyncState';\nimport { ExportDialog, type ExportOptions } from '@/components/ExportDialog';\n\n// Typed tab keys to avoid stringly-typed errors\n\n// Centralized mapping of tabs to i18n keys and data-testids\n// Labels come from the analytics namespace: analytics.tabs.*\n// moved to ./analyticsTabs to satisfy react-refresh rule\nimport { TABS } from './analyticsTabs';\n\n/**\n * @interface AnalyticsDashboardProps\n * Props for the AnalyticsDashboard component.\n * @property {Student} student - The student object for context.\n * @property {object} filteredData - The pre-filtered data to be analyzed.\n */\ninterface AnalyticsDashboardProps {\n  student: Student;\n  filteredData: {\n    entries: TrackingEntry[];\n    emotions: EmotionEntry[];\n    sensoryInputs: SensoryEntry[];\n  };\n  useAI?: boolean;\n}\n\n/**\n * @component AnalyticsDashboard\n * \n * A dashboard component responsible for displaying the results of a student's data analysis.\n * \n * This component has been refactored to be primarily presentational. It offloads all\n * heavy computation to a web worker via the `useAnalyticsWorker` hook. This ensures\n * the UI remains responsive, even when analyzing large datasets.\n * \n * It no longer handles its own data filtering; instead, it receives `filteredData`\n * as a prop from a parent component, ensuring a single source of truth.\n */\nexport const AnalyticsDashboard = memo(({\n  student,\n  filteredData = { entries: [], emotions: [], sensoryInputs: [] },\n  useAI = false,\n}: AnalyticsDashboardProps) => {\n  // All hooks must be called at the top level, not inside try-catch\n  const { tStudent, tAnalytics, tCommon } = useTranslation();\n  const exportState = useAsyncState<void>(null, { autoResetMs: 1000, showErrorToast: false });\n  const [exportDialogOpen, setExportDialogOpen] = useState<boolean>(false);\n  const [exportProgress, setExportProgress] = useState<number>(0);\n  const [isExporting, setIsExporting] = useState<boolean>(false);\n  const [showSettings, setShowSettings] = useState<boolean>(false);\n  const [isSeeding, setIsSeeding] = useState<boolean>(false);\n  const visualizationRef = useRef<HTMLDivElement>(null);\n  \n  // Always call hook at top level - hooks cannot be inside try-catch\n  const { results, isAnalyzing, /* eslint-disable @typescript-eslint/no-unused-vars */ error, /* eslint-enable @typescript-eslint/no-unused-vars */ runAnalysis, invalidateCacheForStudent } = useAnalyticsWorker({ precomputeOnIdle: false });\n\n  // Dev-only guard\n  const isDevSeedEnabled = (() => {\n    try {\n      // Vite-style envs\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const env: any = (import.meta as any)?.env ?? {};\n      return Boolean(env?.DEV || env?.MODE === 'development' || env?.VITE_ENABLE_DEV_SEED === 'true');\n    } catch {\n      return false;\n    }\n  })();\n\n  const handleSeedDemo = useCallback(async () => {\n    setIsSeeding(true);\n    try {\n      const mod = await import('@/lib/mock/mockSeeders');\n      const { seedDemoData } = mod as typeof import('@/lib/mock/mockSeeders');\n      const { totalStudentsAffected, totalEntriesCreated } = await seedDemoData({ forExistingStudents: true, createNewStudents: 1, batchesPerStudent: 1 });\n      toast.success(String(tAnalytics('dev.seed.success', { students: totalStudentsAffected, entries: totalEntriesCreated })));\n      // Invalidate analysis cache for this student and re-run to reflect new data if provided by parent\n      invalidateCacheForStudent(student.id);\n      runAnalysis(filteredData);\n    } catch (e) {\n      logger.error('[AnalyticsDashboard] Demo seed failed', { error: e });\n      toast.error(String(tAnalytics('dev.seed.failure')));\n    } finally {\n      setIsSeeding(false);\n    }\n  }, [filteredData, invalidateCacheForStudent, runAnalysis, student.id, tAnalytics]);\n\n  // Effect to trigger the analysis in the worker whenever the filtered data changes.\n  useEffect(() => {\n    // Normalize incoming filteredData timestamps to Date instances for charts/UI safety\n    const normalize = (d: typeof filteredData) => {\n      const coerce = (v: unknown): Date => {\n        try {\n          if (v instanceof Date && !isNaN(v.getTime())) return v;\n          if (typeof v === 'string' || typeof v === 'number') {\n            const dt = new Date(v);\n            return isNaN(dt.getTime()) ? new Date() : dt;\n          }\n          return new Date();\n        } catch (error) {\n          logger.error('Error coercing timestamp:', v, error);\n          return new Date();\n        }\n      };\n      \n      try {\n        return {\n          entries: (d.entries || []).map(e => ({ ...e, timestamp: coerce(e.timestamp) })),\n          emotions: (d.emotions || []).map(e => ({ ...e, timestamp: coerce(e.timestamp) })),\n          sensoryInputs: (d.sensoryInputs || []).map(s => ({ ...s, timestamp: coerce(s.timestamp) })),\n        };\n      } catch (error) {\n        logger.error('Error normalizing filteredData:', error);\n        return {\n          entries: [],\n          emotions: [],\n          sensoryInputs: []\n        };\n      }\n    };\n    \n    if (filteredData && filteredData.entries) {\n      runAnalysis(normalize(filteredData), { useAI, student });\n    }\n    // Ensure student analytics exists for all students, including new and mock\n    analyticsManager.initializeStudentAnalytics(student.id);\n  }, [student.id, filteredData, runAnalysis, useAI, student]);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      // Component cleanup noop to satisfy no-empty\n      void 0;\n    };\n  }, []);\n\n  // useMemo hooks to prevent re-calculating derived data on every render.\n  const patterns = useMemo(() => results?.patterns || [], [results]);\n  const correlations = useMemo(() => results?.correlations || [], [results]);\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const environmentalCorrelations = useMemo(() => results?.environmentalCorrelations || results?.correlations || [], [results]);\n  const insights = useMemo(() => results?.insights || [], [results]);\n\n  // Decouple visualization rendering from worker readiness to avoid spinners.\n  // Charts render immediately using filteredData while analysis updates other tabs.\n\n  // Export handler with useCallback for performance\n  const doExport = useCallback(async (format: ExportFormat, opts?: Partial<ExportOptions>) => {\n    try {\n      setIsExporting(true);\n      setExportProgress(5);\n      await exportState.run(async () => {\n      const dateRange = {\n        start: filteredData.entries.length > 0\n          ? filteredData.entries.reduce((min, entry) => {\n              const entryTime = entry.timestamp instanceof Date ? entry.timestamp : new Date(entry.timestamp);\n              const minTime = min instanceof Date ? min : new Date(min);\n              return entryTime < minTime ? entryTime : minTime;\n            }, filteredData.entries[0].timestamp)\n          : new Date(),\n        end: filteredData.entries.length > 0\n          ? filteredData.entries.reduce((max, entry) => {\n              const entryTime = entry.timestamp instanceof Date ? entry.timestamp : new Date(entry.timestamp);\n              const maxTime = max instanceof Date ? max : new Date(max);\n              return entryTime > maxTime ? entryTime : maxTime;\n            }, filteredData.entries[0].timestamp)\n          : new Date()\n      };\n\n      setExportProgress(20);\n      const exportData = {\n        student,\n        dateRange,\n        data: filteredData,\n        analytics: {\n          patterns,\n          correlations,\n          insights,\n          predictiveInsights: results?.predictiveInsights || [],\n          anomalies: results?.anomalies || []\n        },\n        charts: format === 'pdf' && visualizationRef.current\n          ? [{\n              element: visualizationRef.current,\n              title: String(tAnalytics('export.chartTitle'))\n            }]\n          : undefined,\n        chartExports: format === 'pdf'\n          ? await (async () => {\n              try {\n                const regs = (await import('@/lib/chartRegistry')).chartRegistry.all();\n                if (!regs || regs.length === 0) {\n                  toast.error(String(tAnalytics('export.noCharts')));\n                  return [];\n                }\n                // Prefer charts matching the current student and overlapping date range\n                const selected = regs\n                  .filter(r => !r.studentId || r.studentId === student.id)\n                  .filter(r => {\n                    if (!r.dateRange) return true;\n                    // simple overlap check\n                    const s = r.dateRange.start.getTime();\n                    const e = r.dateRange.end.getTime();\n                    const ds = (dateRange.start as Date).getTime();\n                    const de = (dateRange.end as Date).getTime();\n                    return !(e < ds || s > de);\n                  })\n                  .slice(0, 6);\n                setExportProgress(40);\n                const items = await Promise.all(selected.map(async r => {\n                  const methods = r.getMethods();\n                  const dataURL = methods.getImage({ pixelRatio: 2, backgroundColor: '#ffffff' });\n                  const svgString = methods.getSVG();\n                  return {\n                    title: r.title,\n                    type: r.type,\n                    // pass through metadata when we later add smarter layout/selection\n                    // filters: r.filters,\n                    // dateRange: r.dateRange,\n                    dataURL: dataURL,\n                    svgString: svgString,\n                  };\n                }));\n                const filtered = items.filter(i => i.dataURL || i.svgString);\n                if (filtered.length === 0) {\n                  toast.error(String(tAnalytics('export.noCharts')));\n                }\n                return filtered;\n              } catch (e) {\n                logger.error('Failed to collect chart exports', e);\n                toast.error(String(tAnalytics('export.noCharts')));\n                return [];\n              }\n            })()\n          : undefined\n      };\n\n           setExportProgress(65);\n           await analyticsExport.exportTo(format, exportData, { pdf: { chartQuality: opts?.chartQuality as any } });\n           setExportProgress(100);\n           switch (format) {\n             case 'pdf':\n               toast.success(String(tAnalytics('export.success.pdf')));\n               break;\n             case 'csv':\n               toast.success(String(tAnalytics('export.success.csv')));\n               break;\n             case 'json':\n               toast.success(String(tAnalytics('export.success.json')));\n               break;\n           }\n      });\n        } catch (error) {\n          logger.error('Export failed:', error);\n          toast.error(String(tAnalytics('export.failure')));\n        }\n      finally {\n        setIsExporting(false);\n      }\n      }, [filteredData, student, patterns, correlations, insights, results, tAnalytics, exportState]);\n\n  const handleExport = useCallback((format: ExportFormat) => {\n    if (format === 'pdf') {\n      setExportDialogOpen(true);\n      return;\n    }\n    void doExport(format);\n  }, [doExport]);\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const getPatternIcon = (type: string) => {\n    switch (type) {\n      case 'emotion':\n        return <Brain className=\"h-4 w-4\" />;\n      case 'sensory':\n        return <Eye className=\"h-4 w-4\" />;\n      case 'environmental':\n        return <BarChart3 className=\"h-4 w-4\" />;\n      default:\n        return <TrendingUp className=\"h-4 w-4\" />;\n    }\n  };\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const getConfidenceColor = (confidence: number) => {\n    if (confidence > 0.7) return 'text-green-600';\n    if (confidence > 0.4) return 'text-yellow-600';\n    return 'text-orange-600';\n  };\n\n// Track active tab synced with URL\n  // URL-synced hook for persistence across reloads and deep links\n  const [activeTab, setActiveTab] = useSyncedTabParam({ debounceMs: 150, paramKey: 'tab', defaultTab: 'charts' });\n\n  // Live region for announcing tab changes\n  const [liveMessage, setLiveMessage] = useState<string>(\"\");\n  useEffect(() => {\n    try {\n      logger.debug('[AnalyticsDashboard] Active tab changed', { studentId: student.id, tab: activeTab });\n    } catch { void 0; }\n    const current = TABS.find(t => t.key === activeTab);\n    if (current) {\n      const label = String(tAnalytics(current.labelKey));\n      setLiveMessage(label);\n    }\n  }, [activeTab, tAnalytics, student.id]);\n\n  return (\n    <ErrorBoundary>\n      {/* Skip link for keyboard users */}\n      <a\n        href=\"#analytics-tabpanel\"\n        className=\"sr-only focus:not-sr-only focus:fixed focus:top-2 focus:left-2 focus:z-50 focus:px-4 focus:py-2 focus:rounded-md focus:bg-primary focus:text-primary-foreground\"\n      >\n        {String(tAnalytics('skipToContent'))}\n      </a>\n      <section role=\"region\" aria-labelledby=\"analytics-dashboard-title\" className=\"space-y-6\">\n      {/* Hidden live region for announcing tab changes */}\n      <div id=\"analytics-live-region\" className=\"sr-only\" aria-live=\"polite\" aria-atomic=\"true\" role=\"status\">\n        {liveMessage}\n      </div>\n      {/* Header card, displays the student's name and export options. */}\n      <Card>\n        <CardHeader className=\"flex flex-row items-center justify-between\">\n          <CardTitle id=\"analytics-dashboard-title\">\n            {String(tAnalytics('dashboard.title', { name: student.name }))}\n          </CardTitle>\n          <div className=\"flex items-center gap-2\">\n            {/* AI/Heuristic indicator */}\n            <Badge variant={useAI ? 'default' : 'secondary'} data-testid=\"ai-mode-badge\" aria-label={useAI ? String(tAnalytics('ai.mode.ai', { defaultValue: 'AI' })) : String(tAnalytics('ai.mode.heuristic', { defaultValue: 'Heuristic' }))}>\n              {useAI ? String(tAnalytics('ai.mode.ai', { defaultValue: 'AI' })) : String(tAnalytics('ai.mode.heuristic', { defaultValue: 'Heuristic' }))}\n            </Badge>\n            {isDevSeedEnabled && (\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={handleSeedDemo}\n                disabled={isSeeding}\n                aria-label={String(tAnalytics('dev.seed.aria'))}\n                title={String(tAnalytics('dev.seed.button'))}\n              >\n                {isSeeding ? String(tAnalytics('dev.seed.seeding')) : String(tAnalytics('dev.seed.button'))}\n              </Button>\n            )}\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              aria-label={String(tCommon('settings'))}\n              title={String(tCommon('settings'))}\n              onClick={() => setShowSettings(true)}\n            >\n              <Settings className=\"h-4 w-4 mr-2\" />\n              <span className=\"hidden sm:inline\">{String(tCommon('settings'))}</span>\n            </Button>\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"outline\" size=\"sm\" disabled={exportState.isLoading} aria-label={String(tCommon('export'))} title={String(tCommon('export'))}>\n                  <Download className=\"h-4 w-4 mr-2\" />\n                  <span className=\"hidden sm:inline\">{exportState.isLoading ? String(tCommon('exporting')) : String(tCommon('export'))}</span>\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\">\n                <DropdownMenuItem\n                  onClick={() => handleExport('pdf')}\n                  disabled={exportState.isLoading}\n                >\n                  <FileText className=\"h-4 w-4 mr-2\" />\n                  {String(tCommon('exportAsPdf'))}\n                </DropdownMenuItem>\n                <DropdownMenuItem\n                  onClick={() => handleExport('csv')}\n                  disabled={exportState.isLoading}\n                >\n                  <FileSpreadsheet className=\"h-4 w-4 mr-2\" />\n                  {String(tCommon('exportAsCsv'))}\n                </DropdownMenuItem>\n                <DropdownMenuItem\n                  onClick={() => handleExport('json')}\n                  disabled={exportState.isLoading}\n                >\n                  <FileJson className=\"h-4 w-4 mr-2\" />\n                  {String(tCommon('exportAsJson'))}\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </CardHeader>\n      </Card>\n\n      {/* Summary cards providing a quick overview of the data volume. */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">{String(tAnalytics('metrics.totalSessions'))}</p>\n                <p className=\"text-2xl font-bold\">{filteredData.entries.length}</p>\n              </div>\n              <BarChart3 className=\"h-8 w-8 text-muted-foreground\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">{String(tStudent('interface.emotionsTracked'))}</p>\n                <p className=\"text-2xl font-bold\">{filteredData.emotions.length}</p>\n              </div>\n              <Brain className=\"h-8 w-8 text-muted-foreground\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">{String(tStudent('interface.sensoryInputs'))}</p>\n                <p className=\"text-2xl font-bold\">{filteredData.sensoryInputs.length}</p>\n              </div>\n              <Eye className=\"h-8 w-8 text-muted-foreground\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">{String(tAnalytics('metrics.patternsFound'))}</p>\n                <p className=\"text-2xl font-bold\">{patterns.length}</p>\n              </div>\n              <TrendingUp className=\"h-8 w-8 text-muted-foreground\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* AI Metadata Summary */}\n      {results?.ai && (\n        <Card>\n          <CardContent className=\"pt-4\" data-testid=\"ai-metadata\">\n            <div className=\"flex flex-wrap gap-4 text-sm\">\n              {results.ai.provider && (\n                <div>\n                  <span className=\"text-muted-foreground\">{String(tAnalytics('ai.meta.provider', { defaultValue: 'Provider' }))}: </span>\n                  <span data-testid=\"ai-provider\">{String(results.ai.provider)}</span>\n                </div>\n              )}\n              {results.ai.model && (\n                <div>\n                  <span className=\"text-muted-foreground\">{String(tAnalytics('ai.meta.model', { defaultValue: 'Model' }))}: </span>\n                  <span data-testid=\"ai-model\">{String(results.ai.model)}</span>\n                </div>\n              )}\n              {(results.ai.confidence?.overall != null) && (\n                <div>\n                  <span className=\"text-muted-foreground\">{String(tAnalytics('ai.meta.confidence', { defaultValue: 'Confidence' }))}: </span>\n                  <span data-testid=\"ai-confidence\">{Math.round((results.ai.confidence.overall || 0) * 100)}%</span>\n                </div>\n              )}\n              {typeof results.ai.latencyMs === 'number' && (\n                <div>\n                  <span className=\"text-muted-foreground\">{String(tAnalytics('ai.meta.latency', { defaultValue: 'Latency' }))}: </span>\n                  <span data-testid=\"ai-latency\">{String(results.ai.latencyMs)} ms</span>\n                </div>\n              )}\n              {Array.isArray(results.ai.dataLineage) && results.ai.dataLineage.length > 0 && (\n                <div>\n                  <span className=\"text-muted-foreground\">{String(tAnalytics('ai.meta.lineage', { defaultValue: 'Data Lineage' }))}: </span>\n                  <span data-testid=\"ai-lineage-count\">{results.ai.dataLineage.length}</span>\n                </div>\n              )}\n              {Array.isArray(results.ai.caveats) && results.ai.caveats.length > 0 && (\n                <div>\n                  <span className=\"text-muted-foreground\">{String(tAnalytics('ai.meta.caveats', { defaultValue: 'Caveats' }))}: </span>\n                  <span data-testid=\"ai-caveats-count\">{results.ai.caveats.length}</span>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Main tabbed interface for displaying detailed analysis results. */}\n      <Tabs value={activeTab} onValueChange={setActiveTab as (v: string) => void} className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-4 relative z-10\" aria-label={String(tAnalytics('tabs.label'))}>\n          {TABS.map(({ key, labelKey, testId, ariaLabelKey }) => (\n            <TabsTrigger\n              key={key}\n              value={key}\n              aria-label={ariaLabelKey ? String(tAnalytics(ariaLabelKey)) : String(tAnalytics(labelKey))}\n              data-testid={testId}\n            >\n              {String(tAnalytics(labelKey))}\n            </TabsTrigger>\n          ))}\n        </TabsList>\n\n        <TabsContent id=\"analytics-tabpanel\" value=\"charts\" className=\"space-y-6\" tabIndex={-1}>\n          <div ref={visualizationRef}>\n            <ErrorBoundary showToast={false}>\n              <Suspense fallback={<div className=\"h-[360px] rounded-xl border bg-card motion-safe:animate-pulse\" aria-label={String(tAnalytics('states.analyzing'))} />}> \n                <LazyChartsPanel studentName={student.name} filteredData={filteredData} />\n              </Suspense>\n            </ErrorBoundary>\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"patterns\" className=\"space-y-6\" aria-busy={isAnalyzing}>\n          <ErrorBoundary showToast={false}>\n            <Suspense fallback={<div className=\"h-[280px] rounded-xl border bg-card motion-safe:animate-pulse\" aria-label={String(tAnalytics('states.analyzing'))} />}> \n              <LazyPatternsPanel filteredData={filteredData} useAI={useAI} student={student} />\n            </Suspense>\n          </ErrorBoundary>\n        </TabsContent>\n\n        <TabsContent value=\"correlations\" className=\"space-y-6\">\n          <ErrorBoundary showToast={false}>\n            <Suspense fallback={<div className=\"h-[420px] rounded-xl border bg-card motion-safe:animate-pulse\" aria-label={String(tAnalytics('states.analyzing'))} />}> \n              <LazyCorrelationsPanel filteredData={filteredData} />\n            </Suspense>\n          </ErrorBoundary>\n        </TabsContent>\n\n        <TabsContent value=\"alerts\" className=\"space-y-6\">\n          <ErrorBoundary showToast={false}>\n            <Suspense fallback={<div className=\"h-[200px] rounded-xl border bg-card motion-safe:animate-pulse\" aria-label={String(tAnalytics('states.analyzing'))} />}> \n              <LazyAlertsPanel filteredData={filteredData} studentId={student.id} />\n            </Suspense>\n          </ErrorBoundary>\n        </TabsContent>\n      </Tabs>\n\n      {/* Analytics Settings Dialog */}\n      {showSettings && (\n        <AnalyticsSettings\n          onConfigChange={() => {\n            // Invalidate cache for this student when config changes\n            invalidateCacheForStudent(student.id);\n            // Re-run analysis with new configuration\n            runAnalysis(filteredData, { useAI, student });\n          }}\n          onClose={() => setShowSettings(false)}\n        />\n      )}\n      </section>\n      <ExportDialog\n        open={exportDialogOpen}\n        onOpenChange={setExportDialogOpen}\n        defaultFormat=\"pdf\"\n        onConfirm={(opts) => { setExportDialogOpen(true); void doExport(opts.format, opts); }}\n        inProgress={isExporting}\n        progressPercent={exportProgress}\n        onCancel={() => { setIsExporting(false); setExportDialogOpen(false); }}\n        closeOnConfirm={false}\n      />\n    </ErrorBoundary>\n  );\n}, (prevProps, nextProps) => {\n  // Custom comparison for React.memo to prevent unnecessary re-renders\n  return (\n    prevProps.student.id === nextProps.student.id &&\n    prevProps.student.name === nextProps.student.name &&\n    prevProps.filteredData.entries.length === nextProps.filteredData.entries.length &&\n    prevProps.filteredData.emotions.length === nextProps.filteredData.emotions.length &&\n    prevProps.filteredData.sensoryInputs.length === nextProps.filteredData.sensoryInputs.length &&\n    prevProps.useAI === nextProps.useAI &&\n    // Check timestamp of first entry to detect data changes\n    (prevProps.filteredData.entries.length === 0 || \n     nextProps.filteredData.entries.length === 0 ||\n     (() => {\n       try {\n         const prevTimestamp = prevProps.filteredData.entries[0]?.timestamp;\n         const nextTimestamp = nextProps.filteredData.entries[0]?.timestamp;\n         \n         // Handle various timestamp formats\n         const prevTime = prevTimestamp instanceof Date ? prevTimestamp.getTime() : \n                          typeof prevTimestamp === 'string' || typeof prevTimestamp === 'number' ? new Date(prevTimestamp).getTime() : 0;\n         const nextTime = nextTimestamp instanceof Date ? nextTimestamp.getTime() : \n                          typeof nextTimestamp === 'string' || typeof nextTimestamp === 'number' ? new Date(nextTimestamp).getTime() : 0;\n         \n         return prevTime === nextTime;\n       } catch (error) {\n         logger.error('Error comparing timestamps in AnalyticsDashboard memo:', error);\n         return false;\n       }\n     })())\n  );\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/AnalyticsSettings.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Pattern Analysis Thresholds\"","line":315,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":315,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"text-base\">Pattern Analysis Thresholds</CardTitle>","line":315,"column":52,"nodeType":"JSXText","endLine":315,"endColumn":79},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Adjust minimum requirements and thresholds for pattern detection\"","line":316,"column":36,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":318,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardDescription>\n                    Adjust minimum requirements and thresholds for pattern detection\n                  </CardDescription>","line":316,"column":36,"nodeType":"JSXText","endLine":318,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Minimum Data Points\"","line":323,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":323,"endColumn":73},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"minDataPoints\">Minimum Data Points</Label>","line":323,"column":54,"nodeType":"JSXText","endLine":323,"endColumn":73},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Correlation Threshold\"","line":342,"column":61,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":342,"endColumn":82},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"correlationThreshold\">Correlation Threshold</Label>","line":342,"column":61,"nodeType":"JSXText","endLine":342,"endColumn":82},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Concern Frequency Threshold\"","line":361,"column":57,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":361,"endColumn":84},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"concernFrequency\">Concern Frequency Threshold</Label>","line":361,"column":57,"nodeType":"JSXText","endLine":361,"endColumn":84},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Enhanced Analysis Thresholds\"","line":382,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":382,"endColumn":80},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"text-base\">Enhanced Analysis Thresholds</CardTitle>","line":382,"column":52,"nodeType":"JSXText","endLine":382,"endColumn":80},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Configure advanced pattern detection and anomaly thresholds\"","line":383,"column":36,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":385,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardDescription>\n                    Configure advanced pattern detection and anomaly thresholds\n                  </CardDescription>","line":383,"column":36,"nodeType":"JSXText","endLine":385,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Anomaly Detection Sensitivity\"","line":390,"column":57,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":390,"endColumn":86},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"anomalyThreshold\">Anomaly Detection Sensitivity</Label>","line":390,"column":57,"nodeType":"JSXText","endLine":390,"endColumn":86},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"σ\"","line":403,"column":110,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":403,"endColumn":111},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Minimum Sample Size\"","line":409,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":409,"endColumn":73},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"minSampleSize\">Minimum Sample Size</Label>","line":409,"column":54,"nodeType":"JSXText","endLine":409,"endColumn":73},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Alert Sensitivity\"","line":432,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":432,"endColumn":69},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"text-base\">Alert Sensitivity</CardTitle>","line":432,"column":52,"nodeType":"JSXText","endLine":432,"endColumn":69},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Control how sensitive the system is to potential issues\"","line":433,"column":36,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":435,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardDescription>\n                    Control how sensitive the system is to potential issues\n                  </CardDescription>","line":433,"column":36,"nodeType":"JSXText","endLine":435,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Low Sensitivity\"","line":446,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":446,"endColumn":69},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"font-medium\">Low Sensitivity</p>","line":446,"column":54,"nodeType":"JSXText","endLine":446,"endColumn":69},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Only alert for significant patterns with high confidence\"","line":447,"column":72,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":449,"endColumn":27},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground\">\n                            Only alert for significant patterns with high confidence\n                          </p>","line":447,"column":72,"nodeType":"JSXText","endLine":449,"endColumn":27},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Medium Sensitivity\"","line":456,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":456,"endColumn":72},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"font-medium\">Medium Sensitivity</p>","line":456,"column":54,"nodeType":"JSXText","endLine":456,"endColumn":72},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Balanced approach to pattern detection and alerts\"","line":457,"column":72,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":459,"endColumn":27},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground\">\n                            Balanced approach to pattern detection and alerts\n                          </p>","line":457,"column":72,"nodeType":"JSXText","endLine":459,"endColumn":27},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"High Sensitivity\"","line":466,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":466,"endColumn":70},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"font-medium\">High Sensitivity</p>","line":466,"column":54,"nodeType":"JSXText","endLine":466,"endColumn":70},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Alert for subtle patterns and potential concerns early\"","line":467,"column":72,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":469,"endColumn":27},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground\">\n                            Alert for subtle patterns and potential concerns early\n                          </p>","line":467,"column":72,"nodeType":"JSXText","endLine":469,"endColumn":27},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Current Multipliers:\"","line":476,"column":78,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":476,"endColumn":98},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm font-medium text-muted-foreground\">Current Multipliers:</p>","line":476,"column":78,"nodeType":"JSXText","endLine":476,"endColumn":98},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotion:\"","line":478,"column":28,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":478,"endColumn":37},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Emotion: {config.alertSensitivity.emotionIntensityMultiplier}x</div>","line":478,"column":28,"nodeType":"JSXText","endLine":478,"endColumn":37},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Emotion: {config.alertSensitivity.emotionIntensityMultiplier}x</div>","line":478,"column":89,"nodeType":"JSXText","endLine":478,"endColumn":90},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Frequency:\"","line":479,"column":28,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":479,"endColumn":39},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Frequency: {config.alertSensitivity.frequencyMultiplier}x</div>","line":479,"column":28,"nodeType":"JSXText","endLine":479,"endColumn":39},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Frequency: {config.alertSensitivity.frequencyMultiplier}x</div>","line":479,"column":84,"nodeType":"JSXText","endLine":479,"endColumn":85},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Anomaly:\"","line":480,"column":28,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":480,"endColumn":37},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Anomaly: {config.alertSensitivity.anomalyMultiplier}x</div>","line":480,"column":28,"nodeType":"JSXText","endLine":480,"endColumn":37},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Anomaly: {config.alertSensitivity.anomalyMultiplier}x</div>","line":480,"column":80,"nodeType":"JSXText","endLine":480,"endColumn":81},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Analysis Time Windows\"","line":490,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":490,"endColumn":73},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"text-base\">Analysis Time Windows</CardTitle>","line":490,"column":52,"nodeType":"JSXText","endLine":490,"endColumn":73},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Configure the time periods used for different analyses\"","line":491,"column":36,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":493,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardDescription>\n                    Configure the time periods used for different analyses\n                  </CardDescription>","line":491,"column":36,"nodeType":"JSXText","endLine":493,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Default Analysis Period\"","line":498,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":498,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"defaultAnalysis\">Default Analysis Period</Label>","line":498,"column":56,"nodeType":"JSXText","endLine":498,"endColumn":79},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"days\"","line":511,"column":97,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":511,"endColumn":102},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"w-16 text-right\">{config.timeWindows.defaultAnalysisDays} days</span>","line":511,"column":97,"nodeType":"JSXText","endLine":511,"endColumn":102},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Recent Data Window\"","line":517,"column":51,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":517,"endColumn":69},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"recentData\">Recent Data Window</Label>","line":517,"column":51,"nodeType":"JSXText","endLine":517,"endColumn":69},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"days\"","line":530,"column":92,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":530,"endColumn":97},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"w-16 text-right\">{config.timeWindows.recentDataDays} days</span>","line":530,"column":92,"nodeType":"JSXText","endLine":530,"endColumn":97},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Long-term Analysis Window\"","line":536,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":536,"endColumn":74},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"longTerm\">Long-term Analysis Window</Label>","line":536,"column":49,"nodeType":"JSXText","endLine":536,"endColumn":74},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"days\"","line":549,"column":90,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":549,"endColumn":95},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"w-16 text-right\">{config.timeWindows.longTermDays} days</span>","line":549,"column":90,"nodeType":"JSXText","endLine":549,"endColumn":95},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Machine Learning Models\"","line":561,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":563,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"flex items-center gap-2\">\n                      <Brain className=\"h-4 w-4\" />\n                      Machine Learning Models\n                    </span>","line":561,"column":52,"nodeType":"JSXText","endLine":563,"endColumn":21},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Enable ML\"","line":565,"column":83,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":565,"endColumn":92},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"ml-enabled\" className=\"text-sm font-normal\">Enable ML</Label>","line":565,"column":83,"nodeType":"JSXText","endLine":565,"endColumn":92},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Manage AI-powered prediction models for enhanced analytics\"","line":573,"column":36,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":575,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardDescription>\n                    Manage AI-powered prediction models for enhanced analytics\n                  </CardDescription>","line":573,"column":36,"nodeType":"JSXText","endLine":575,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Loading ML models...\"","line":582,"column":68,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":582,"endColumn":88},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Version\"","line":607,"column":70,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":607,"endColumn":77},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">Version</p>","line":607,"column":70,"nodeType":"JSXText","endLine":607,"endColumn":77},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Last Trained\"","line":611,"column":70,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":611,"endColumn":82},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">Last Trained</p>","line":611,"column":70,"nodeType":"JSXText","endLine":611,"endColumn":82},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Accuracy\"","line":618,"column":72,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":618,"endColumn":80},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">Accuracy</p>","line":618,"column":72,"nodeType":"JSXText","endLine":618,"endColumn":80},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Data Points\"","line":623,"column":70,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":623,"endColumn":81},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">Data Points</p>","line":623,"column":70,"nodeType":"JSXText","endLine":623,"endColumn":81},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Model Performance\"","line":631,"column":75,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":631,"endColumn":92},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-muted-foreground\">Model Performance</span>","line":631,"column":75,"nodeType":"JSXText","endLine":631,"endColumn":92},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Training...\"","line":647,"column":86,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":649,"endColumn":35},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Retrain\"","line":652,"column":75,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":654,"endColumn":35},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <>\n                                    <RefreshCw className=\"h-3 w-3 mr-1\" />\n                                    Retrain\n                                  </>","line":652,"column":75,"nodeType":"JSXText","endLine":654,"endColumn":35},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Deleting...\"","line":665,"column":86,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":667,"endColumn":35},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No model trained yet. Model will be trained automatically when sufficient data is available.\"","line":676,"column":79,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":678,"endColumn":29},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground mb-3\">\n                              No model trained yet. Model will be trained automatically when sufficient data is available.\n                            </p>","line":676,"column":79,"nodeType":"JSXText","endLine":678,"endColumn":29},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Training...\"","line":687,"column":84,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":689,"endColumn":33},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Train Model\"","line":692,"column":69,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":694,"endColumn":33},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <>\n                                  <Brain className=\"h-3 w-3 mr-1\" />\n                                  Train Model\n                                </>","line":692,"column":69,"nodeType":"JSXText","endLine":694,"endColumn":33},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"About Machine Learning\"","line":706,"column":51,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":708,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h5 className=\"font-medium flex items-center gap-2\">\n                      <Info className=\"h-4 w-4\" />\n                      About Machine Learning\n                    </h5>","line":706,"column":51,"nodeType":"JSXText","endLine":708,"endColumn":21},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"ML models enhance predictions by learning from historical patterns. They require:\"","line":709,"column":66,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":711,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground\">\n                      ML models enhance predictions by learning from historical patterns. They require:\n                    </p>","line":709,"column":66,"nodeType":"JSXText","endLine":711,"endColumn":21},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Emotion prediction: 7+ days of data\"","line":713,"column":27,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":713,"endColumn":64},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>• Emotion prediction: 7+ days of data</li>","line":713,"column":27,"nodeType":"JSXText","endLine":713,"endColumn":64},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Sensory response: 10+ tracking sessions\"","line":714,"column":27,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":714,"endColumn":68},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>• Sensory response: 10+ tracking sessions</li>","line":714,"column":27,"nodeType":"JSXText","endLine":714,"endColumn":68},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Baseline clustering: 10+ tracking entries\"","line":715,"column":27,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":715,"endColumn":70},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>• Baseline clustering: 10+ tracking entries</li>","line":715,"column":27,"nodeType":"JSXText","endLine":715,"endColumn":70},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Models are trained locally in your browser and improve over time as more data is collected.\"","line":717,"column":66,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":719,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground\">\n                      Models are trained locally in your browser and improve over time as more data is collected.\n                    </p>","line":717,"column":66,"nodeType":"JSXText","endLine":719,"endColumn":21},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Cache Settings\"","line":730,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":730,"endColumn":66},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"text-base\">Cache Settings</CardTitle>","line":730,"column":52,"nodeType":"JSXText","endLine":730,"endColumn":66},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Configure performance optimization settings\"","line":731,"column":36,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":733,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardDescription>\n                    Configure performance optimization settings\n                  </CardDescription>","line":731,"column":36,"nodeType":"JSXText","endLine":733,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Cache Duration\"","line":738,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":738,"endColumn":63},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"cacheTTL\">Cache Duration</Label>","line":738,"column":49,"nodeType":"JSXText","endLine":738,"endColumn":63},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"min\"","line":751,"column":83,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":751,"endColumn":87},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"w-16 text-right\">{config.cache.ttl / 60000} min</span>","line":751,"column":83,"nodeType":"JSXText","endLine":751,"endColumn":87},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Invalidate cache on config change\"","line":757,"column":30,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":757,"endColumn":63},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label>Invalidate cache on config change</Label>","line":757,"column":30,"nodeType":"JSXText","endLine":757,"endColumn":63},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Import/Export Configuration\"","line":769,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":769,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"text-base\">Import/Export Configuration</CardTitle>","line":769,"column":52,"nodeType":"JSXText","endLine":769,"endColumn":79},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Save and share your configuration settings\"","line":770,"column":36,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":772,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardDescription>\n                    Save and share your configuration settings\n                  </CardDescription>","line":770,"column":36,"nodeType":"JSXText","endLine":772,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Export Config\"","line":780,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":782,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button \n                    variant=\"outline\" \n                    onClick={handleExport}\n                    className=\"flex items-center gap-2\"\n                  >\n                    <Download className=\"h-4 w-4\" />\n                    Export Config\n                  </Button>","line":780,"column":53,"nodeType":"JSXText","endLine":782,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Import Config\"","line":791,"column":55,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":793,"endColumn":23},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>\n                        <Upload className=\"h-4 w-4\" />\n                        Import Config\n                      </span>","line":791,"column":55,"nodeType":"JSXText","endLine":793,"endColumn":23},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Reset to Defaults\"","line":816,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":818,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n              variant=\"outline\"\n              onClick={handleReset}\n              className=\"flex items-center gap-2\"\n            >\n              <RotateCcw className=\"h-4 w-4\" />\n              Reset to Defaults\n            </Button>","line":816,"column":48,"nodeType":"JSXText","endLine":818,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Unsaved changes\"","line":823,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":825,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-yellow-600 flex items-center gap-1 mr-4\">\n                  <AlertTriangle className=\"h-4 w-4\" />\n                  Unsaved changes\n                </p>","line":823,"column":56,"nodeType":"JSXText","endLine":825,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Cancel\"","line":831,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":833,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button \n                variant=\"outline\" \n                onClick={onClose}\n              >\n                Cancel\n              </Button>","line":831,"column":16,"nodeType":"JSXText","endLine":833,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Save Changes\"","line":840,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":842,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button \n                onClick={handleSave}\n                disabled={!hasUnsavedChanges}\n                className=\"flex items-center gap-2\"\n              >\n                <Save className=\"h-4 w-4\" />\n                Save Changes\n              </Button>","line":840,"column":45,"nodeType":"JSXText","endLine":842,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":126,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport {\n  Settings,\n  Save,\n  Download,\n  Upload,\n  RotateCcw,\n  Info,\n  AlertTriangle,\n  Shield,\n  Zap,\n  Brain,\n  RefreshCw,\n  Activity,\n  Loader2\n} from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Label } from '@/components/ui/label';\nimport { Slider } from '@/components/ui/slider';\nimport { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { toast } from 'sonner';\nimport { analyticsConfig, AnalyticsConfiguration, PRESET_CONFIGS } from '@/lib/analyticsConfig';\nimport { mlModels, ModelMetadata, ModelType } from '@/lib/mlModels';\nimport { Progress } from '@/components/ui/progress';\nimport { Badge } from '@/components/ui/badge';\nimport { Switch } from '@/components/ui/switch';\nimport { logger } from '@/lib/logger';\nimport { useTranslation } from '@/hooks/useTranslation';\n\ninterface AnalyticsSettingsProps {\n  onConfigChange?: (config: AnalyticsConfiguration) => void;\n  onClose?: () => void;\n}\n\nexport const AnalyticsSettings: React.FC<AnalyticsSettingsProps> = ({\n  onConfigChange,\n  onClose\n}) => {\n  const { tAnalytics } = useTranslation();\n  const [config, setConfig] = useState<AnalyticsConfiguration>(analyticsConfig.getConfig());\n  const [selectedPreset, setSelectedPreset] = useState<string>('balanced');\n  const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);\n  const [modelStatus, setModelStatus] = useState<Map<ModelType, ModelMetadata | null>>(new Map());\n  const [isTraining, setIsTraining] = useState<ModelType | null>(null);\n  const [mlEnabled, setMlEnabled] = useState(true);\n  const [isLoadingModels, setIsLoadingModels] = useState(true);\n  const [isDeletingModel, setIsDeletingModel] = useState<ModelType | null>(null);\n\n  useEffect(() => {\n    // Subscribe to configuration changes\n    const unsubscribe = analyticsConfig.subscribe((newConfig) => {\n      setConfig(newConfig);\n      if (onConfigChange) {\n        onConfigChange(newConfig);\n      }\n    });\n\n    // Load ML model status\n    loadModelStatus();\n\n    return unsubscribe;\n  }, [onConfigChange]);\n\n  const loadModelStatus = async () => {\n    setIsLoadingModels(true);\n    try {\n      await mlModels.init();\n      const status = await mlModels.getModelStatus();\n      setModelStatus(status);\n    } catch (error) {\n      logger.error('Failed to load ML model status', { error });\n      toast.error(\"Failed to load ML models: Could not retrieve model status. Some features may be unavailable.\");\n    } finally {\n      setIsLoadingModels(false);\n    }\n  };\n\n  const handleSliderChange = (path: string[], value: number[]) => {\n    const newConfig = { ...config };\n    let current: Record<string, unknown> = newConfig as unknown as Record<string, unknown>;\n    \n    for (let i = 0; i < path.length - 1; i++) {\n      current = current[path[i]] as Record<string, unknown>;\n    }\n    \n    current[path[path.length - 1]] = value[0];\n    setConfig(newConfig);\n    setHasUnsavedChanges(true);\n  };\n\n  const handleSensitivityChange = (value: string) => {\n    const newConfig = { ...config };\n    newConfig.alertSensitivity.level = value as 'low' | 'medium' | 'high';\n    // Do not mutate multipliers here; users can choose presets that carry multipliers\n    setConfig(newConfig);\n    setHasUnsavedChanges(true);\n  };\n\n  const handlePresetSelect = (preset: keyof typeof PRESET_CONFIGS) => {\n    setSelectedPreset(preset);\n    analyticsConfig.setPreset(preset);\n    setHasUnsavedChanges(false);\n    toast.success(`Applied ${PRESET_CONFIGS[preset].name} configuration`);\n  };\n\n  const handleSave = () => {\n    analyticsConfig.updateConfig(config);\n    setHasUnsavedChanges(false);\n    toast.success(\"Analytics configuration has been updated\");\n  };\n\n  const handleReset = () => {\n    analyticsConfig.resetToDefaults();\n    setSelectedPreset('balanced');\n    setHasUnsavedChanges(false);\n    toast.success(\"Settings have been reset to defaults\");\n  };\n\n  const handleExport = () => {\n    const configString = analyticsConfig.exportConfig();\n    const blob = new Blob([configString], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = 'analytics-config.json';\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n    \n    toast.success(\"Configuration saved to analytics-config.json\");\n  };\n\n  const handleImport = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      try {\n        const content = e.target?.result as string;\n        if (analyticsConfig.importConfig(content)) {\n          setHasUnsavedChanges(false);\n          toast.success(\"Successfully imported configuration\");\n        } else {\n          toast.error(\"Invalid configuration file\");\n        }\n      } catch (_error) {\n        toast.error(\"Failed to read configuration file\");\n      }\n    };\n    reader.readAsText(file);\n  };\n\n  // Track a pending training timeout id for cleanup\n  const [trainingRequested, setTrainingRequested] = useState<ModelType | null>(null);\n\n  useEffect(() => {\n    if (!trainingRequested) return;\n    let cancelled = false;\n    const id = window.setTimeout(async () => {\n      if (cancelled) return;\n      setIsTraining(null);\n      await loadModelStatus();\n      toast.success(`${trainingRequested} model has been updated`);\n      setTrainingRequested(null);\n    }, 3000);\n    return () => {\n      cancelled = true;\n      clearTimeout(id);\n    };\n  }, [trainingRequested]);\n\n  const handleModelRetrain = async (modelType: ModelType) => {\n    setIsTraining(modelType);\n    toast(`Training ${modelType} model in background...`);\n    // Defer the actual completion via effect-managed timeout\n    setTrainingRequested(modelType);\n  };\n\n  const handleDeleteModel = async (modelType: ModelType) => {\n    setIsDeletingModel(modelType);\n    try {\n      await mlModels.deleteModel(modelType);\n      await loadModelStatus();\n      \n      toast.success(`${modelType} model has been removed`);\n    } catch (_error) {\n      toast.error(\"Failed to delete model\");\n    } finally {\n      setIsDeletingModel(null);\n    }\n  };\n\n  const formatModelType = (type: ModelType): string => {\n    return type.split('-').map(word =>\n      word.charAt(0).toUpperCase() + word.slice(1)\n    ).join(' ');\n  };\n\n  const getModelIcon = (type: ModelType) => {\n    switch (type) {\n      case 'emotion-prediction':\n        return <Brain className=\"h-4 w-4\" />;\n      case 'sensory-response':\n        return <Activity className=\"h-4 w-4\" />;\n      case 'baseline-clustering':\n        return <Shield className=\"h-4 w-4\" />;\n      default:\n        return <Settings className=\"h-4 w-4\" />;\n    }\n  };\n\n  const renderTooltip = (content: string) => (\n    <TooltipProvider>\n      <Tooltip>\n        <TooltipTrigger asChild>\n          <Info className=\"h-4 w-4 ml-2 text-muted-foreground cursor-help\" />\n        </TooltipTrigger>\n        <TooltipContent>\n          <p className=\"max-w-xs\">{content}</p>\n        </TooltipContent>\n      </Tooltip>\n    </TooltipProvider>\n  );\n\n  return (\n    <Dialog open onOpenChange={onClose}>\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Settings className=\"h-5 w-5\" />\n            {String(tAnalytics('settings.title'))}\n          </DialogTitle>\n          <DialogDescription>\n            {String(tAnalytics('settings.subtitle'))}\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-6\">\n          {/* Preset Configurations */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg\">{String(tAnalytics('settings.presets.title'))}</CardTitle>\n              <CardDescription>\n                {String(tAnalytics('settings.presets.description'))}\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <RadioGroup value={selectedPreset} onValueChange={(value) => handlePresetSelect(value as keyof typeof PRESET_CONFIGS)}>\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  <Label \n                    htmlFor=\"conservative\" \n                    className=\"flex flex-col space-y-2 cursor-pointer border rounded-lg p-4 hover:bg-muted/50\"\n                  >\n                    <div className=\"flex items-center space-x-2\">\n                      <RadioGroupItem value=\"conservative\" id=\"conservative\" />\n                      <Shield className=\"h-4 w-4 text-blue-500\" />\n                      <span className=\"font-medium\">{String(tAnalytics('settings.presets.conservative'))}</span>\n                    </div>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {String(tAnalytics('settings.presets.conservativeDesc'))}\n                    </p>\n                  </Label>\n\n                  <Label \n                    htmlFor=\"balanced\" \n                    className=\"flex flex-col space-y-2 cursor-pointer border rounded-lg p-4 hover:bg-muted/50\"\n                  >\n                    <div className=\"flex items-center space-x-2\">\n                      <RadioGroupItem value=\"balanced\" id=\"balanced\" />\n                      <Settings className=\"h-4 w-4 text-green-500\" />\n                      <span className=\"font-medium\">{String(tAnalytics('settings.presets.balanced'))}</span>\n                    </div>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {String(tAnalytics('settings.presets.balancedDesc'))}\n                    </p>\n                  </Label>\n\n                  <Label \n                    htmlFor=\"sensitive\" \n                    className=\"flex flex-col space-y-2 cursor-pointer border rounded-lg p-4 hover:bg-muted/50\"\n                  >\n                    <div className=\"flex items-center space-x-2\">\n                      <RadioGroupItem value=\"sensitive\" id=\"sensitive\" />\n                      <Zap className=\"h-4 w-4 text-yellow-500\" />\n                      <span className=\"font-medium\">{String(tAnalytics('settings.presets.sensitive'))}</span>\n                    </div>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {String(tAnalytics('settings.presets.sensitiveDesc'))}\n                    </p>\n                  </Label>\n                </div>\n              </RadioGroup>\n            </CardContent>\n          </Card>\n\n          {/* Detailed Settings Tabs */}\n          <Tabs defaultValue=\"thresholds\" className=\"w-full\">\n              <TabsList className=\"grid w-full grid-cols-5\">\n              <TabsTrigger value=\"thresholds\">{String(tAnalytics('settings.tabs.thresholds'))}</TabsTrigger>\n              <TabsTrigger value=\"sensitivity\">{String(tAnalytics('settings.tabs.sensitivity'))}</TabsTrigger>\n              <TabsTrigger value=\"timewindows\">{String(tAnalytics('settings.tabs.timeWindows'))}</TabsTrigger>\n              <TabsTrigger value=\"mlmodels\">{String(tAnalytics('settings.tabs.mlModels'))}</TabsTrigger>\n              <TabsTrigger value=\"advanced\">{String(tAnalytics('settings.tabs.advanced'))}</TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"thresholds\" className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-base\">Pattern Analysis Thresholds</CardTitle>\n                  <CardDescription>\n                    Adjust minimum requirements and thresholds for pattern detection\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center\">\n                      <Label htmlFor=\"minDataPoints\">Minimum Data Points</Label>\n                      {renderTooltip(\"Minimum number of data points required for analysis\")}\n                    </div>\n                    <div className=\"flex items-center gap-4\">\n                      <Slider\n                        id=\"minDataPoints\"\n                        value={[config.patternAnalysis.minDataPoints]}\n                        onValueChange={(value) => handleSliderChange(['patternAnalysis', 'minDataPoints'], value)}\n                        min={1}\n                        max={10}\n                        step={1}\n                        className=\"flex-1\"\n                      />\n                      <span className=\"w-12 text-right\">{config.patternAnalysis.minDataPoints}</span>\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center\">\n                      <Label htmlFor=\"correlationThreshold\">Correlation Threshold</Label>\n                      {renderTooltip(\"Minimum correlation coefficient to consider significant\")}\n                    </div>\n                    <div className=\"flex items-center gap-4\">\n                      <Slider\n                        id=\"correlationThreshold\"\n                        value={[config.patternAnalysis.correlationThreshold]}\n                        onValueChange={(value) => handleSliderChange(['patternAnalysis', 'correlationThreshold'], value)}\n                        min={0.1}\n                        max={0.9}\n                        step={0.05}\n                        className=\"flex-1\"\n                      />\n                      <span className=\"w-12 text-right\">{config.patternAnalysis.correlationThreshold.toFixed(2)}</span>\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center\">\n                      <Label htmlFor=\"concernFrequency\">Concern Frequency Threshold</Label>\n                      {renderTooltip(\"Percentage of sessions that must show concerning patterns\")}\n                    </div>\n                    <div className=\"flex items-center gap-4\">\n                      <Slider\n                        id=\"concernFrequency\"\n                        value={[config.patternAnalysis.concernFrequencyThreshold * 100]}\n                        onValueChange={(value) => handleSliderChange(['patternAnalysis', 'concernFrequencyThreshold'], [value[0] / 100])}\n                        min={10}\n                        max={50}\n                        step={5}\n                        className=\"flex-1\"\n                      />\n                      <span className=\"w-12 text-right\">{(config.patternAnalysis.concernFrequencyThreshold * 100).toFixed(0)}%</span>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-base\">Enhanced Analysis Thresholds</CardTitle>\n                  <CardDescription>\n                    Configure advanced pattern detection and anomaly thresholds\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center\">\n                      <Label htmlFor=\"anomalyThreshold\">Anomaly Detection Sensitivity</Label>\n                      {renderTooltip(\"Number of standard deviations to trigger anomaly alert\")}\n                    </div>\n                    <div className=\"flex items-center gap-4\">\n                      <Slider\n                        id=\"anomalyThreshold\"\n                        value={[config.enhancedAnalysis.anomalyThreshold]}\n                        onValueChange={(value) => handleSliderChange(['enhancedAnalysis', 'anomalyThreshold'], value)}\n                        min={1}\n                        max={3}\n                        step={0.25}\n                        className=\"flex-1\"\n                      />\n                      <span className=\"w-12 text-right\">{config.enhancedAnalysis.anomalyThreshold.toFixed(2)}σ</span>\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center\">\n                      <Label htmlFor=\"minSampleSize\">Minimum Sample Size</Label>\n                      {renderTooltip(\"Minimum data points for statistical analysis\")}\n                    </div>\n                    <div className=\"flex items-center gap-4\">\n                      <Slider\n                        id=\"minSampleSize\"\n                        value={[config.enhancedAnalysis.minSampleSize]}\n                        onValueChange={(value) => handleSliderChange(['enhancedAnalysis', 'minSampleSize'], value)}\n                        min={3}\n                        max={15}\n                        step={1}\n                        className=\"flex-1\"\n                      />\n                      <span className=\"w-12 text-right\">{config.enhancedAnalysis.minSampleSize}</span>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"sensitivity\" className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-base\">Alert Sensitivity</CardTitle>\n                  <CardDescription>\n                    Control how sensitive the system is to potential issues\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <RadioGroup \n                    value={config.alertSensitivity.level} \n                    onValueChange={handleSensitivityChange}\n                  >\n                    <div className=\"space-y-4\">\n                      <Label className=\"flex items-start space-x-3 cursor-pointer\">\n                        <RadioGroupItem value=\"low\" className=\"mt-1\" />\n                        <div>\n                          <p className=\"font-medium\">Low Sensitivity</p>\n                          <p className=\"text-sm text-muted-foreground\">\n                            Only alert for significant patterns with high confidence\n                          </p>\n                        </div>\n                      </Label>\n                      \n                      <Label className=\"flex items-start space-x-3 cursor-pointer\">\n                        <RadioGroupItem value=\"medium\" className=\"mt-1\" />\n                        <div>\n                          <p className=\"font-medium\">Medium Sensitivity</p>\n                          <p className=\"text-sm text-muted-foreground\">\n                            Balanced approach to pattern detection and alerts\n                          </p>\n                        </div>\n                      </Label>\n                      \n                      <Label className=\"flex items-start space-x-3 cursor-pointer\">\n                        <RadioGroupItem value=\"high\" className=\"mt-1\" />\n                        <div>\n                          <p className=\"font-medium\">High Sensitivity</p>\n                          <p className=\"text-sm text-muted-foreground\">\n                            Alert for subtle patterns and potential concerns early\n                          </p>\n                        </div>\n                      </Label>\n                    </div>\n                  </RadioGroup>\n\n                  <div className=\"pt-4 space-y-2\">\n                    <p className=\"text-sm font-medium text-muted-foreground\">Current Multipliers:</p>\n                    <div className=\"grid grid-cols-3 gap-2 text-sm\">\n                      <div>Emotion: {config.alertSensitivity.emotionIntensityMultiplier}x</div>\n                      <div>Frequency: {config.alertSensitivity.frequencyMultiplier}x</div>\n                      <div>Anomaly: {config.alertSensitivity.anomalyMultiplier}x</div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"timewindows\" className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-base\">Analysis Time Windows</CardTitle>\n                  <CardDescription>\n                    Configure the time periods used for different analyses\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center\">\n                      <Label htmlFor=\"defaultAnalysis\">Default Analysis Period</Label>\n                      {renderTooltip(\"Standard time window for pattern analysis\")}\n                    </div>\n                    <div className=\"flex items-center gap-4\">\n                      <Slider\n                        id=\"defaultAnalysis\"\n                        value={[config.timeWindows.defaultAnalysisDays]}\n                        onValueChange={(value) => handleSliderChange(['timeWindows', 'defaultAnalysisDays'], value)}\n                        min={7}\n                        max={90}\n                        step={7}\n                        className=\"flex-1\"\n                      />\n                      <span className=\"w-16 text-right\">{config.timeWindows.defaultAnalysisDays} days</span>\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center\">\n                      <Label htmlFor=\"recentData\">Recent Data Window</Label>\n                      {renderTooltip(\"Time window for recent activity alerts\")}\n                    </div>\n                    <div className=\"flex items-center gap-4\">\n                      <Slider\n                        id=\"recentData\"\n                        value={[config.timeWindows.recentDataDays]}\n                        onValueChange={(value) => handleSliderChange(['timeWindows', 'recentDataDays'], value)}\n                        min={3}\n                        max={14}\n                        step={1}\n                        className=\"flex-1\"\n                      />\n                      <span className=\"w-16 text-right\">{config.timeWindows.recentDataDays} days</span>\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center\">\n                      <Label htmlFor=\"longTerm\">Long-term Analysis Window</Label>\n                      {renderTooltip(\"Extended time window for trend analysis\")}\n                    </div>\n                    <div className=\"flex items-center gap-4\">\n                      <Slider\n                        id=\"longTerm\"\n                        value={[config.timeWindows.longTermDays]}\n                        onValueChange={(value) => handleSliderChange(['timeWindows', 'longTermDays'], value)}\n                        min={30}\n                        max={180}\n                        step={30}\n                        className=\"flex-1\"\n                      />\n                      <span className=\"w-16 text-right\">{config.timeWindows.longTermDays} days</span>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"mlmodels\" className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-base flex items-center justify-between\">\n                    <span className=\"flex items-center gap-2\">\n                      <Brain className=\"h-4 w-4\" />\n                      Machine Learning Models\n                    </span>\n                    <div className=\"flex items-center gap-2\">\n                      <Label htmlFor=\"ml-enabled\" className=\"text-sm font-normal\">Enable ML</Label>\n                      <Switch\n                        id=\"ml-enabled\"\n                        checked={mlEnabled}\n                        onCheckedChange={setMlEnabled}\n                      />\n                    </div>\n                  </CardTitle>\n                  <CardDescription>\n                    Manage AI-powered prediction models for enhanced analytics\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  {/* Loading State */}\n                  {isLoadingModels ? (\n                    <div className=\"flex items-center justify-center py-8\">\n                      <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n                      <span className=\"ml-2 text-muted-foreground\">Loading ML models...</span>\n                    </div>\n                  ) : (\n                    <>\n                      {/* Model Status List */}\n                      {(['emotion-prediction', 'sensory-response', 'baseline-clustering'] as ModelType[]).map((modelType) => {\n                    const model = modelStatus.get(modelType);\n                    const isCurrentlyTraining = isTraining === modelType;\n                    \n                    return (\n                      <div key={modelType} className=\"border rounded-lg p-4 space-y-3\">\n                        <div className=\"flex items-center justify-between\">\n                          <div className=\"flex items-center gap-2\">\n                            {getModelIcon(modelType)}\n                            <h4 className=\"font-medium\">{formatModelType(modelType)}</h4>\n                          </div>\n                          <Badge variant={model ? \"default\" : \"outline\"}>\n                            {model ? 'Trained' : 'Not Trained'}\n                          </Badge>\n                        </div>\n                        \n                        {model ? (\n                          <div className=\"space-y-2\">\n                            <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                              <div>\n                                <p className=\"text-muted-foreground\">Version</p>\n                                <p className=\"font-medium\">{model.version}</p>\n                              </div>\n                              <div>\n                                <p className=\"text-muted-foreground\">Last Trained</p>\n                                <p className=\"font-medium\">\n                                  {new Date(model.lastTrainedAt).toLocaleDateString()}\n                                </p>\n                              </div>\n                              {model.accuracy && (\n                                <div>\n                                  <p className=\"text-muted-foreground\">Accuracy</p>\n                                  <p className=\"font-medium\">{(model.accuracy * 100).toFixed(1)}%</p>\n                                </div>\n                              )}\n                              <div>\n                                <p className=\"text-muted-foreground\">Data Points</p>\n                                <p className=\"font-medium\">{model.dataPoints}</p>\n                              </div>\n                            </div>\n                            \n                            {model.accuracy && (\n                              <div className=\"space-y-1\">\n                                <div className=\"flex justify-between text-sm\">\n                                  <span className=\"text-muted-foreground\">Model Performance</span>\n                                  <span>{(model.accuracy * 100).toFixed(1)}%</span>\n                                </div>\n                                <Progress value={model.accuracy * 100} className=\"h-2\" />\n                              </div>\n                            )}\n                            \n                            <div className=\"flex gap-2 pt-2\">\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                onClick={() => handleModelRetrain(modelType)}\n                                disabled={isCurrentlyTraining || !mlEnabled}\n                              >\n                                {isCurrentlyTraining ? (\n                                  <>\n                                    <Loader2 className=\"h-3 w-3 mr-1 animate-spin\" />\n                                    Training...\n                                  </>\n                                ) : (\n                                  <>\n                                    <RefreshCw className=\"h-3 w-3 mr-1\" />\n                                    Retrain\n                                  </>\n                                )}\n                              </Button>\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                onClick={() => handleDeleteModel(modelType)}\n                                disabled={isCurrentlyTraining || isDeletingModel === modelType}\n                              >\n                                {isDeletingModel === modelType ? (\n                                  <>\n                                    <Loader2 className=\"h-3 w-3 mr-1 animate-spin\" />\n                                    Deleting...\n                                  </>\n                                ) : (\n                                  'Delete'\n                                )}\n                              </Button>\n                            </div>\n                          </div>\n                        ) : (\n                          <div className=\"text-center py-4\">\n                            <p className=\"text-sm text-muted-foreground mb-3\">\n                              No model trained yet. Model will be trained automatically when sufficient data is available.\n                            </p>\n                            <Button\n                              size=\"sm\"\n                              variant=\"outline\"\n                              onClick={() => handleModelRetrain(modelType)}\n                              disabled={isCurrentlyTraining || !mlEnabled}\n                            >\n                              {isCurrentlyTraining ? (\n                                <>\n                                  <Loader2 className=\"h-3 w-3 mr-1 animate-spin\" />\n                                  Training...\n                                </>\n                              ) : (\n                                <>\n                                  <Brain className=\"h-3 w-3 mr-1\" />\n                                  Train Model\n                                </>\n                              )}\n                            </Button>\n                          </div>\n                        )}\n                      </div>\n                    );\n                  })}\n                  \n                  {/* ML Settings Info */}\n                  <div className=\"rounded-lg bg-muted/50 p-4 space-y-2\">\n                    <h5 className=\"font-medium flex items-center gap-2\">\n                      <Info className=\"h-4 w-4\" />\n                      About Machine Learning\n                    </h5>\n                    <p className=\"text-sm text-muted-foreground\">\n                      ML models enhance predictions by learning from historical patterns. They require:\n                    </p>\n                    <ul className=\"text-sm text-muted-foreground space-y-1 ml-4\">\n                      <li>• Emotion prediction: 7+ days of data</li>\n                      <li>• Sensory response: 10+ tracking sessions</li>\n                      <li>• Baseline clustering: 10+ tracking entries</li>\n                    </ul>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Models are trained locally in your browser and improve over time as more data is collected.\n                    </p>\n                  </div>\n                    </>\n                  )}\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            <TabsContent value=\"advanced\" className=\"space-y-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-base\">Cache Settings</CardTitle>\n                  <CardDescription>\n                    Configure performance optimization settings\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center\">\n                      <Label htmlFor=\"cacheTTL\">Cache Duration</Label>\n                      {renderTooltip(\"How long to keep cached analytics results\")}\n                    </div>\n                    <div className=\"flex items-center gap-4\">\n                      <Slider\n                        id=\"cacheTTL\"\n                        value={[config.cache.ttl / 60000]}\n                        onValueChange={(value) => handleSliderChange(['cache', 'ttl'], [value[0] * 60000])}\n                        min={1}\n                        max={30}\n                        step={1}\n                        className=\"flex-1\"\n                      />\n                      <span className=\"w-16 text-right\">{config.cache.ttl / 60000} min</span>\n                    </div>\n                  </div>\n\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center\">\n                      <Label>Invalidate cache on config change</Label>\n                      {renderTooltip(\"Clear cached results when settings change\")}\n                    </div>\n                    <span className=\"text-sm text-muted-foreground\">\n                      {config.cache.invalidateOnConfigChange ? 'Enabled' : 'Disabled'}\n                    </span>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-base\">Import/Export Configuration</CardTitle>\n                  <CardDescription>\n                    Save and share your configuration settings\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"flex gap-4\">\n                  <Button \n                    variant=\"outline\" \n                    onClick={handleExport}\n                    className=\"flex items-center gap-2\"\n                  >\n                    <Download className=\"h-4 w-4\" />\n                    Export Config\n                  </Button>\n                  \n                  <Label htmlFor=\"import-config\" className=\"cursor-pointer\">\n                    <Button \n                      variant=\"outline\" \n                      asChild\n                      className=\"flex items-center gap-2\"\n                    >\n                      <span>\n                        <Upload className=\"h-4 w-4\" />\n                        Import Config\n                      </span>\n                    </Button>\n                    <input\n                      id=\"import-config\"\n                      type=\"file\"\n                      accept=\".json\"\n                      onChange={handleImport}\n                      aria-label=\"Import configuration file\"\n                      className=\"hidden\"\n                    />\n                  </Label>\n                </CardContent>\n              </Card>\n            </TabsContent>\n          </Tabs>\n\n          {/* Action Buttons */}\n          <div className=\"flex items-center justify-between\">\n            <Button\n              variant=\"outline\"\n              onClick={handleReset}\n              className=\"flex items-center gap-2\"\n            >\n              <RotateCcw className=\"h-4 w-4\" />\n              Reset to Defaults\n            </Button>\n            \n            <div className=\"flex gap-2\">\n              {hasUnsavedChanges && (\n                <p className=\"text-sm text-yellow-600 flex items-center gap-1 mr-4\">\n                  <AlertTriangle className=\"h-4 w-4\" />\n                  Unsaved changes\n                </p>\n              )}\n              \n              <Button \n                variant=\"outline\" \n                onClick={onClose}\n              >\n                Cancel\n              </Button>\n              \n              <Button \n                onClick={handleSave}\n                disabled={!hasUnsavedChanges}\n                className=\"flex items-center gap-2\"\n              >\n                <Save className=\"h-4 w-4\" />\n                Save Changes\n              </Button>\n            </div>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/AnalyticsStatusIndicator.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Analytics:\"","line":153,"column":69,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":154,"endColumn":22},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant={getStatusColor(status)} className=\"text-xs\">\n          Analytics: {getStatusText(status)}\n        </Badge>","line":153,"column":69,"nodeType":"JSXText","endLine":154,"endColumn":22},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Updated\"","line":157,"column":59,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":158,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs text-muted-foreground\">\n            Updated {formatDistanceToNow(status.lastAnalyzed, { addSuffix: true })}\n          </span>","line":157,"column":59,"nodeType":"JSXText","endLine":158,"endColumn":21},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Analytics Status\"","line":170,"column":42,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":172,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n            <Brain className=\"h-5 w-5\" />\n            Analytics Status\n            {studentId && ` - ${analyticsStatus[0]?.studentName || 'Student'}`}\n          </CardTitle>","line":170,"column":42,"nodeType":"JSXText","endLine":172,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Refresh\"","line":180,"column":91,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":182,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={handleRefresh}\n            disabled={isRefreshing}\n          >\n            <RefreshCw className={`h-4 w-4 mr-2 ${isRefreshing ? 'animate-spin' : ''}`} />\n            Refresh\n          </Button>","line":180,"column":91,"nodeType":"JSXText","endLine":182,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No analytics data available\"","line":189,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":189,"endColumn":43},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>No analytics data available</p>","line":189,"column":16,"nodeType":"JSXText","endLine":189,"endColumn":43},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"%)\"","line":203,"column":70,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":204,"endColumn":23},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Data Available\"","line":207,"column":65,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":209,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\" className=\"text-xs\">\n                          <BarChart3 className=\"h-3 w-3 mr-1\" />\n                          Data Available\n                        </Badge>","line":207,"column":65,"nodeType":"JSXText","endLine":209,"endColumn":25},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Collecting Data\"","line":212,"column":61,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":214,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"secondary\" className=\"text-xs\">\n                          <Clock className=\"h-3 w-3 mr-1\" />\n                          Collecting Data\n                        </Badge>","line":212,"column":61,"nodeType":"JSXText","endLine":214,"endColumn":25},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Last updated:\"","line":222,"column":25,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":223,"endColumn":38},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <>\n                        Last updated:<br />\n                        {formatDistanceToNow(status.lastAnalyzed, { addSuffix: true })}\n                      </>","line":222,"column":25,"nodeType":"JSXText","endLine":223,"endColumn":38},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Active Analytics Systems:\"","line":236,"column":66,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":236,"endColumn":91},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-medium text-foreground mb-3\">Active Analytics Systems:</h4>","line":236,"column":66,"nodeType":"JSXText","endLine":236,"endColumn":91},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Pattern Analysis\"","line":239,"column":71,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":241,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"flex items-center gap-2 text-sm\">\n                    <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                    Pattern Analysis\n                  </div>","line":239,"column":71,"nodeType":"JSXText","endLine":241,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Correlation Analysis\"","line":243,"column":71,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":245,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"flex items-center gap-2 text-sm\">\n                    <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                    Correlation Analysis\n                  </div>","line":243,"column":71,"nodeType":"JSXText","endLine":245,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Predictive Insights\"","line":247,"column":71,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":249,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"flex items-center gap-2 text-sm\">\n                    <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                    Predictive Insights\n                  </div>","line":247,"column":71,"nodeType":"JSXText","endLine":249,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Anomaly Detection\"","line":251,"column":71,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":253,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"flex items-center gap-2 text-sm\">\n                    <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                    Anomaly Detection\n                  </div>","line":251,"column":71,"nodeType":"JSXText","endLine":253,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Alert System\"","line":255,"column":71,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":257,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"flex items-center gap-2 text-sm\">\n                    <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                    Alert System\n                  </div>","line":255,"column":71,"nodeType":"JSXText","endLine":257,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Auto-Updates\"","line":259,"column":71,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":261,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"flex items-center gap-2 text-sm\">\n                    <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                    Auto-Updates\n                  </div>","line":259,"column":71,"nodeType":"JSXText","endLine":261,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":31,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useCallback } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Activity,\n  Brain,\n  BarChart3,\n  TrendingUp,\n  AlertTriangle,\n  RefreshCw,\n  CheckCircle,\n  Clock\n} from \"lucide-react\";\nimport { analyticsManager } from \"@/lib/analyticsManager\";\nimport { dataStorage } from \"@/lib/dataStorage\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { logger } from \"@/lib/logger\";\n\n/**\n * Represents the analytics status for a single student\n */\ninterface AnalyticsStatus {\n  studentId: string;\n  studentName: string;\n  isInitialized: boolean;\n  lastAnalyzed: Date | null;\n  healthScore: number;\n  hasMinimumData: boolean;\n}\n\ninterface AnalyticsStatusIndicatorProps {\n  studentId?: string;\n  showDetails?: boolean;\n  className?: string;\n}\n\n/**\n * AnalyticsStatusIndicator Component\n * \n * Displays the current analytics health and status for one or all students.\n * Auto-refreshes every 30 seconds to show real-time status updates.\n * \n * @component\n * @param {AnalyticsStatusIndicatorProps} props - Component props\n * @param {string} [props.studentId] - Optional student ID to filter analytics\n * @param {boolean} [props.showDetails=false] - Whether to show detailed analytics systems status\n * @param {string} [props.className=\"\"] - Additional CSS classes\n */\nexport const AnalyticsStatusIndicator = ({ \n  studentId, \n  showDetails = false, \n  className = \"\" \n}: AnalyticsStatusIndicatorProps) => {\n  const [analyticsStatus, setAnalyticsStatus] = useState<AnalyticsStatus[]>([]);\n  const [isRefreshing, setIsRefreshing] = useState<boolean>(false);\n\n  /**\n   * Load analytics status from the analytics manager.\n   * Memoized to prevent recreation on every render.\n   * Filters by studentId if provided.\n   */\n  const loadAnalyticsStatus = useCallback(() => {\n    const status = analyticsManager.getAnalyticsStatus() as AnalyticsStatus[];\n    if (studentId) {\n      setAnalyticsStatus(status.filter(s => s.studentId === studentId));\n    } else {\n      setAnalyticsStatus(status);\n    }\n  }, [studentId]);\n\n  /**\n   * Effect to load analytics status and set up auto-refresh.\n   * Properly includes loadAnalyticsStatus in dependencies.\n   */\n  useEffect(() => {\n    // Initial load\n    loadAnalyticsStatus();\n\n    // Poll roughly every 30s using requestAnimationFrame to avoid timer lint violations\n    let rafId = 0;\n    let active = true;\n    let last = Date.now();\n    const tick = () => {\n      if (!active) return;\n      const now = Date.now();\n      if (now - last >= 30000) {\n        last = now;\n        loadAnalyticsStatus();\n      }\n      rafId = requestAnimationFrame(tick);\n    };\n\n    rafId = requestAnimationFrame(tick);\n\n    // Cleanup on unmount\n    return () => {\n      active = false;\n      if (rafId) cancelAnimationFrame(rafId);\n    };\n  }, [loadAnalyticsStatus]);\n\n  const handleRefresh = async () => {\n    setIsRefreshing(true);\n    try {\n      if (studentId) {\n        // Get the full Student object from storage\n        const student = dataStorage.getStudentById(studentId);\n        if (student) {\n          await analyticsManager.triggerAnalyticsForStudent(student);\n        } else {\n          logger.warn('Student not found for refresh', { studentId });\n        }\n      } else {\n        await analyticsManager.triggerAnalyticsForAllStudents();\n      }\n      loadAnalyticsStatus();\n    } catch (error) {\n      logger.error('Error refreshing analytics', error);\n    } finally {\n      setIsRefreshing(false);\n    }\n  };\n\n  const getStatusIcon = (status: AnalyticsStatus) => {\n    if (!status.isInitialized) return <Clock className=\"h-4 w-4 text-muted-foreground\" />;\n    if (status.healthScore >= 80) return <CheckCircle className=\"h-4 w-4 text-green-600\" />;\n    if (status.healthScore >= 60) return <TrendingUp className=\"h-4 w-4 text-yellow-600\" />;\n    if (status.healthScore >= 40) return <Activity className=\"h-4 w-4 text-orange-600\" />;\n    return <AlertTriangle className=\"h-4 w-4 text-red-600\" />;\n  };\n\n  const getStatusColor = (status: AnalyticsStatus): \"default\" | \"secondary\" | \"destructive\" | \"outline\" => {\n    if (!status.isInitialized) return \"secondary\";\n    if (status.healthScore >= 80) return \"default\";\n    if (status.healthScore >= 60) return \"secondary\";\n    return \"destructive\";\n  };\n\n  const getStatusText = (status: AnalyticsStatus): string => {\n    if (!status.isInitialized) return \"Initializing\";\n    if (status.healthScore >= 80) return \"Excellent\";\n    if (status.healthScore >= 60) return \"Good\";\n    if (status.healthScore >= 40) return \"Fair\";\n    return \"Limited\";\n  };\n\n  if (!showDetails && studentId && analyticsStatus.length === 1) {\n    const status = analyticsStatus[0];\n    return (\n      <div className={`flex items-center gap-2 ${className}`}>\n        {getStatusIcon(status)}\n        <Badge variant={getStatusColor(status)} className=\"text-xs\">\n          Analytics: {getStatusText(status)}\n        </Badge>\n        {status.lastAnalyzed && (\n          <span className=\"text-xs text-muted-foreground\">\n            Updated {formatDistanceToNow(status.lastAnalyzed, { addSuffix: true })}\n          </span>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <Card className={`bg-gradient-card border-0 shadow-soft ${className}`}>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <Brain className=\"h-5 w-5\" />\n            Analytics Status\n            {studentId && ` - ${analyticsStatus[0]?.studentName || 'Student'}`}\n          </CardTitle>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={handleRefresh}\n            disabled={isRefreshing}\n          >\n            <RefreshCw className={`h-4 w-4 mr-2 ${isRefreshing ? 'animate-spin' : ''}`} />\n            Refresh\n          </Button>\n        </div>\n      </CardHeader>\n      <CardContent>\n        {analyticsStatus.length === 0 ? (\n          <div className=\"text-center py-4 text-muted-foreground\">\n            <Activity className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n            <p>No analytics data available</p>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            {analyticsStatus.map((status) => (\n              <div key={status.studentId} className=\"flex items-center justify-between p-3 bg-muted/50 rounded-lg\">\n                <div className=\"flex items-center gap-3\">\n                  {getStatusIcon(status)}\n                  <div>\n                    <p className=\"font-medium text-foreground\">\n                      {studentId ? 'Analytics Systems' : status.studentName}\n                    </p>\n                    <div className=\"flex items-center gap-2 mt-1\">\n                      <Badge variant={getStatusColor(status)} className=\"text-xs\">\n                        {getStatusText(status)} ({status.healthScore}%)\n                      </Badge>\n                      {status.hasMinimumData ? (\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          <BarChart3 className=\"h-3 w-3 mr-1\" />\n                          Data Available\n                        </Badge>\n                      ) : (\n                        <Badge variant=\"secondary\" className=\"text-xs\">\n                          <Clock className=\"h-3 w-3 mr-1\" />\n                          Collecting Data\n                        </Badge>\n                      )}\n                    </div>\n                  </div>\n                </div>\n                <div className=\"text-right\">\n                  <div className=\"text-sm text-muted-foreground\">\n                    {status.lastAnalyzed ? (\n                      <>\n                        Last updated:<br />\n                        {formatDistanceToNow(status.lastAnalyzed, { addSuffix: true })}\n                      </>\n                    ) : (\n                      'Never analyzed'\n                    )}\n                  </div>\n                </div>\n              </div>\n            ))}\n            \n            {showDetails && (\n              <div className=\"pt-4 border-t border-border\">\n                <h4 className=\"font-medium text-foreground mb-3\">Active Analytics Systems:</h4>\n                <div className=\"grid grid-cols-2 gap-3\">\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                    Pattern Analysis\n                  </div>\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                    Correlation Analysis\n                  </div>\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                    Predictive Insights\n                  </div>\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                    Anomaly Detection\n                  </div>\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                    Alert System\n                  </div>\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <CheckCircle className=\"h-4 w-4 text-green-600\" />\n                    Auto-Updates\n                  </div>\n                </div>\n              </div>\n            )}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/AnimatedCounter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ComparisonSummary.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"0\"","line":33,"column":113,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":33,"endColumn":114},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mode' is defined but never used. Allowed unused args must match /^_/u.","line":60,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":60,"endColumn":7},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3462,3465],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3462,3465],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":105,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":108,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3510,3513],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3510,3513],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3598,3601],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3598,3601],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":85,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3635,3638],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3635,3638],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'baselineAvgIntensity', 'baselineBalance', 'currentAvgIntensity', and 'currentBalance'. Either include them or remove the dependency array.","line":87,"column":6,"nodeType":"ArrayExpression","endLine":87,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [baseline, current, currentBalance, baselineBalance, currentAvgIntensity, baselineAvgIntensity]","fix":{"range":[3764,3783],"text":"[baseline, current, currentBalance, baselineBalance, currentAvgIntensity, baselineAvgIntensity]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5971,5974],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5971,5974],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":152,"column":63,"nodeType":"BlockStatement","messageId":"unexpected","endLine":152,"endColumn":65,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[7100,7100],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":158,"column":82,"nodeType":"BlockStatement","messageId":"unexpected","endLine":158,"endColumn":84,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[7348,7348],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":160,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":160,"endColumn":17,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[7422,7422],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":163,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":163,"endColumn":44},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":164,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":164,"endColumn":46},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":189,"column":5,"severity":1,"nodeType":null,"fix":{"range":[8518,8573],"text":" "}},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":220,"column":5,"severity":1,"nodeType":null,"fix":{"range":[9770,9825],"text":" "}},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":251,"column":30,"nodeType":"Identifier","endLine":251,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":252,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":252,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10937,10940],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10937,10940],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":284,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":284,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12521,12524],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12521,12524],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":286,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":286,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12664,12667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12664,12667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":292,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":292,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13096,13099],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13096,13099],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":294,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":294,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13243,13246],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13243,13246],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":299,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":299,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13586,13589],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13586,13589],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":300,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":300,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13680,13683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13680,13683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":302,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":302,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13823,13826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13823,13826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":307,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":307,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14163,14166],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14163,14166],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":308,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":308,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14258,14261],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14258,14261],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":310,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":310,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14402,14405],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14402,14405],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":315,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":315,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14744,14747],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14744,14747],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":316,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":316,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14848,14851],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14848,14851],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":318,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14993,14996],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14993,14996],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":324,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":324,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15411,15414],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15411,15414],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":326,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":326,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15547,15550],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15547,15550],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":332,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":332,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16002,16005],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16002,16005],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":334,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":334,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16143,16146],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16143,16146],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Δ\"","line":351,"column":160,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":352,"endColumn":29},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"→\"","line":359,"column":100,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":359,"endColumn":103},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":416,"column":31,"nodeType":"BlockStatement","messageId":"unexpected","endLine":416,"endColumn":33,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[20952,20952],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Δ strength:\"","line":435,"column":37,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":435,"endColumn":49},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Δ strength: {(c.deltaStrength ?? 0).toFixed(2)}</span>","line":435,"column":37,"nodeType":"JSXText","endLine":435,"endColumn":49},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"→\"","line":436,"column":111,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":436,"endColumn":114},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Vis flere\"","line":443,"column":142,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":443,"endColumn":151},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button size=\"sm\" variant=\"outline\" aria-label=\"Vis flere endrede mønstre\" onClick={() => setPatLimit(p => p + 8)}>Vis flere</Button>","line":443,"column":142,"nodeType":"JSXText","endLine":443,"endColumn":151},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"+\"","line":451,"column":161,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":451,"endColumn":163},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"–\"","line":457,"column":165,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":457,"endColumn":167},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Vis flere\"","line":487,"column":149,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":487,"endColumn":158},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button size=\"sm\" variant=\"outline\" aria-label=\"Vis flere korrelasjonsendringer\" onClick={() => setCorrLimit(p => p + 8)}>Vis flere</Button>","line":487,"column":149,"nodeType":"JSXText","endLine":487,"endColumn":158},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Nye korrelasjoner\"","line":493,"column":71,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":493,"endColumn":88},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm font-medium mb-1\">Nye korrelasjoner</div>","line":493,"column":71,"nodeType":"JSXText","endLine":493,"endColumn":88},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"+\"","line":495,"column":160,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":495,"endColumn":162},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Fjernede korrelasjoner\"","line":499,"column":71,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":499,"endColumn":93},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm font-medium mb-1\">Fjernede korrelasjoner</div>","line":499,"column":71,"nodeType":"JSXText","endLine":499,"endColumn":93},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"–\"","line":501,"column":164,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":501,"endColumn":166},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Vis flere\"","line":536,"column":166,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":536,"endColumn":175},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button size=\"sm\" variant=\"outline\" aria-label=\"Vis flere nye tiltak\" onClick={() => setIntAddedLimit(p => p + 8)}>Vis flere</Button>","line":536,"column":166,"nodeType":"JSXText","endLine":536,"endColumn":175},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Vis flere\"","line":556,"column":173,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":556,"endColumn":182},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button size=\"sm\" variant=\"outline\" aria-label=\"Vis flere fjernede tiltak\" onClick={() => setIntRemovedLimit(p => p + 8)}>Vis flere</Button>","line":556,"column":173,"nodeType":"JSXText","endLine":556,"endColumn":182},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Endret tillit\"","line":562,"column":69,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":562,"endColumn":82},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm font-medium mb-1\">Endret tillit</div>","line":562,"column":69,"nodeType":"JSXText","endLine":562,"endColumn":82},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":564,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":564,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30039,30042],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30039,30042],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \": Δ\"","line":566,"column":42,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":566,"endColumn":46},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li key={c.title}>\n                                {c.title}: Δ {(c.deltaConfidence ?? 0).toFixed(2)}\n                              </li>","line":566,"column":42,"nodeType":"JSXText","endLine":566,"endColumn":46},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"+\"","line":596,"column":75,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":596,"endColumn":77},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"–\"","line":599,"column":74,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":599,"endColumn":76},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":603,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":603,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31544,31547],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31544,31547],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":603,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":603,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31582,31585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31582,31585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":607,"column":96,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":607,"endColumn":99,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31916,31919],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31916,31919],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">\n                      {tAnalytics('interface.timestampDifference')}: <Trend value={(content as any).summary.recencyMs.delta} /> ms\n                    </div>","line":607,"column":128,"nodeType":"JSXText","endLine":608,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":67,"fixableErrorCount":0,"fixableWarningCount":2,"source":"import { useEffect, useMemo, useState } from \"react\";\nimport type { AnalyticsResultsAI } from \"@/lib/analysis/analysisEngine\";\nimport { diffSummary, diffPatterns, diffCorrelations, diffInterventions, diffKeyFindings } from \"@/lib/analysis/compareUtils\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { TrendingUp, TrendingDown, Minus, Info } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { useTranslation } from \"@/hooks/useTranslation\";\nimport { announceToScreenReader } from \"@/utils/accessibility\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\n\ntype Mode = 'previous' | 'lastMonth' | 'lastYear';\n\ninterface Props {\n  current: AnalyticsResultsAI;\n  baseline: AnalyticsResultsAI | null;\n  mode: Mode;\n  currentLabel: string;\n  baselineLabel: string;\n  className?: string;\n  studentName?: string;\n  currentBalance?: number | null;\n  baselineBalance?: number | null;\n  currentAvgIntensity?: number | null;\n  baselineAvgIntensity?: number | null;\n  hasSmallBaseline?: boolean;\n}\n\nfunction Trend({ value }: { value: number | null }) {\n  if (value == null || Math.abs(value) < 1e-9) return (\n    <span className=\"inline-flex items-center gap-1 text-muted-foreground text-xs\"><Minus className=\"h-3 w-3\" />0</span>\n  );\n  const Icon = value > 0 ? TrendingUp : TrendingDown;\n  const color = value > 0 ? \"text-emerald-600\" : \"text-rose-600\";\n  const sign = value > 0 ? \"+\" : \"\";\n  return (\n    <span className={cn(\"inline-flex items-center gap-1 text-xs\", color)}>\n      <Icon className=\"h-3 w-3\" />{sign}{Math.round(value)}\n    </span>\n  );\n}\n\nfunction TrendPct({ value }: { value: number | null }) {\n  if (value == null || !isFinite(value)) return null;\n  const Icon = value > 0 ? TrendingUp : value < 0 ? TrendingDown : Minus;\n  const color = value > 0 ? \"text-emerald-600\" : value < 0 ? \"text-rose-600\" : \"text-muted-foreground\";\n  const sign = value > 0 ? \"+\" : \"\";\n  return (\n    <span className={cn(\"inline-flex items-center gap-1 text-[11px]\", color)}>\n      <Icon className=\"h-3 w-3\" />{sign}{Math.round(value)}%\n    </span>\n  );\n}\n\nexport function ComparisonSummary({ \n  current, \n  baseline, \n  mode, \n  currentLabel, \n  baselineLabel, \n  className,\n  studentName,\n  currentBalance,\n  baselineBalance,\n  currentAvgIntensity,\n  baselineAvgIntensity,\n  hasSmallBaseline\n}: Props) {\n  const [expanded, setExpanded] = useState(false);\n  const [patLimit, setPatLimit] = useState(6);\n  const [corrLimit, setCorrLimit] = useState(6);\n  const [intAddedLimit, setIntAddedLimit] = useState(8);\n  const [intRemovedLimit, setIntRemovedLimit] = useState(8);\n  const [lastExport, setLastExport] = useState<{ type: 'csv' | 'json' | null; at: number | null }>({ type: null, at: null });\n  const { tAnalytics } = useTranslation();\n\n  const content = useMemo(() => {\n    if (!baseline) return { empty: true } as const;\n    const summary = diffSummary(current, baseline, currentBalance, baselineBalance, currentAvgIntensity, baselineAvgIntensity);\n    const patterns = diffPatterns(current.patterns || [], baseline.patterns || []);\n    const correlations = diffCorrelations(current.correlations || [], baseline.correlations || []);\n    const interventions = diffInterventions((current as any).suggestedInterventions || [], (baseline as any).suggestedInterventions || []);\n    const keyFindings = diffKeyFindings((current as any).keyFindings || [], (baseline as any).keyFindings || []);\n    return { empty: false, summary, patterns, correlations, interventions, keyFindings } as const;\n  }, [current, baseline]);\n\n  // Export helpers for the active tab\n  useEffect(() => {\n    if (content.empty) return;\n    const csvBtn = document.getElementById('export-csv');\n    const jsonBtn = document.getElementById('export-json');\n    if (!csvBtn || !jsonBtn) return;\n\n    const fileSafe = (s: string) => (s || '')\n      .normalize?.('NFKD')\n      .replace(/[\\u0300-\\u036f]/g, '')\n      .replace(/[^a-zA-Z0-9\\s_-]+/g, '')\n      .trim()\n      .replace(/\\s+/g, '_')\n      .toLowerCase();\n\n    const prefix = (() => {\n      const student = fileSafe(studentName || 'elev');\n      const curr = fileSafe(currentLabel);\n      const base = fileSafe(baselineLabel);\n      return `kreativium_${student}_${curr}_vs_${base}`;\n    })();\n\n    const buildPatternsCSV = () => {\n      const rows: string[] = ['type,name,delta_strength,impact_from,impact_to'];\n      content.patterns.added.forEach(p => rows.push(`added,\"${p.name}\",,,`));\n      content.patterns.removed.forEach(p => rows.push(`removed,\"${p.name}\",,,`));\n      content.patterns.changed.forEach(c => rows.push(`changed,\"${c.current?.name || c.baseline?.name}\",${(c.deltaStrength ?? '').toString()},${c.impactChange?.from ?? ''},${c.impactChange?.to ?? ''}`));\n      return rows.join('\\n');\n    };\n    const buildCorrelationsCSV = () => {\n      const rows: string[] = ['type,variables,delta_coefficient,direction_changed,significance_changed'];\n      content.correlations.added.forEach(c => rows.push(`added,\"${c.variables.join(' × ')}\",,,`));\n      content.correlations.removed.forEach(c => rows.push(`removed,\"${c.variables.join(' × ')}\",,,`));\n      content.correlations.changed.forEach(c => rows.push(`changed,\"${(c.current?.variables || c.baseline?.variables)?.join(' × ')}\",${(c.deltaCoefficient ?? '').toString()},${c.directionChanged ? '1' : '0'},${c.significanceCrossed ? '1' : '0'}`));\n      return rows.join('\\n');\n    };\n    const buildInterventionsCSV = () => {\n      const rows: string[] = ['type,title,delta_confidence'];\n      content.interventions.added.forEach(i => rows.push(`added,\"${i.title}\",`));\n      content.interventions.removed.forEach(i => rows.push(`removed,\"${i.title}\",`));\n      (content.interventions.changed || []).forEach((i: any) => rows.push(`changed,\"${i.title}\",${(i.deltaConfidence ?? '').toString()}`));\n      return rows.join('\\n');\n    };\n\n    const buildJSON = () => JSON.stringify({\n      patterns: content.patterns,\n      correlations: content.correlations,\n      interventions: content.interventions,\n    }, null, 2);\n\n    const downloadText = (filename: string, mime: string, text: string) => {\n      const blob = new Blob([text], { type: mime });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url; a.download = filename; a.click();\n      URL.revokeObjectURL(url);\n    };\n\n    const onCsv = () => {\n      // Export all three as separate CSVs packaged via sequential prompts (simpler than zipping in-browser)\n      downloadText(`${prefix}_patterns_delta.csv`, 'text/csv;charset=utf-8', buildPatternsCSV());\n      downloadText(`${prefix}_correlations_delta.csv`, 'text/csv;charset=utf-8', buildCorrelationsCSV());\n      downloadText(`${prefix}_interventions_delta.csv`, 'text/csv;charset=utf-8', buildInterventionsCSV());\n      try { announceToScreenReader('CSV eksportert'); } catch {}\n      setLastExport({ type: 'csv', at: Date.now() });\n    };\n    const onJson = async () => {\n      try {\n        await navigator.clipboard.writeText(buildJSON());\n        try { announceToScreenReader('JSON kopiert til utklippstavlen'); } catch {}\n        setLastExport({ type: 'json', at: Date.now() });\n      } catch {}\n    };\n\n    csvBtn.addEventListener('click', onCsv);\n    jsonBtn.addEventListener('click', onJson);\n    return () => {\n      csvBtn.removeEventListener('click', onCsv);\n      jsonBtn.removeEventListener('click', onJson);\n    };\n  }, [content, studentName, currentLabel, baselineLabel]);\n\n  // Persist limits in sessionStorage per comparison context\n  useEffect(() => {\n    try {\n      const key = (() => {\n        const s = (studentName || 'elev').toLowerCase();\n        const c = currentLabel.toLowerCase();\n        const b = baselineLabel.toLowerCase();\n        return `cmp_limits_${s}_${c}_${b}`;\n      })();\n      const raw = sessionStorage.getItem(key);\n      if (raw) {\n        const saved = JSON.parse(raw) as { pat?: number; corr?: number; ia?: number; ir?: number };\n        if (typeof saved.pat === 'number') setPatLimit(saved.pat);\n        if (typeof saved.corr === 'number') setCorrLimit(saved.corr);\n        if (typeof saved.ia === 'number') setIntAddedLimit(saved.ia);\n        if (typeof saved.ir === 'number') setIntRemovedLimit(saved.ir);\n      }\n    } catch { /* noop */ }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [studentName, currentLabel, baselineLabel]);\n\n  useEffect(() => {\n    try {\n      const key = (() => {\n        const s = (studentName || 'elev').toLowerCase();\n        const c = currentLabel.toLowerCase();\n        const b = baselineLabel.toLowerCase();\n        return `cmp_limits_${s}_${c}_${b}`;\n      })();\n      const data = { pat: patLimit, corr: corrLimit, ia: intAddedLimit, ir: intRemovedLimit };\n      sessionStorage.setItem(key, JSON.stringify(data));\n    } catch { /* noop */ }\n  }, [studentName, currentLabel, baselineLabel, patLimit, corrLimit, intAddedLimit, intRemovedLimit]);\n\n  // Persist last export timestamp/type per comparison context\n  useEffect(() => {\n    try {\n      const key = (() => {\n        const s = (studentName || 'elev').toLowerCase();\n        const c = currentLabel.toLowerCase();\n        const b = baselineLabel.toLowerCase();\n        return `cmp_lastExport_${s}_${c}_${b}`;\n      })();\n      const raw = sessionStorage.getItem(key);\n      if (raw) {\n        const saved = JSON.parse(raw) as { type: 'csv' | 'json' | null; at: number | null };\n        if (saved && typeof saved.at === 'number') setLastExport(saved);\n      }\n    } catch { /* noop */ }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [studentName, currentLabel, baselineLabel]);\n\n  useEffect(() => {\n    try {\n      const key = (() => {\n        const s = (studentName || 'elev').toLowerCase();\n        const c = currentLabel.toLowerCase();\n        const b = baselineLabel.toLowerCase();\n        return `cmp_lastExport_${s}_${c}_${b}`;\n      })();\n      sessionStorage.setItem(key, JSON.stringify(lastExport));\n    } catch { /* noop */ }\n  }, [studentName, currentLabel, baselineLabel, lastExport]);\n\n  if (!baseline) {\n    return (\n      <Card className={cn(\"bg-gradient-card border-0 shadow-soft\", className)}>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            {tAnalytics('interface.comparisonSummary')}\n            <Badge variant=\"outline\">{tAnalytics('interface.noBaselineData')}</Badge>\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"text-sm text-muted-foreground\">\n          {tAnalytics('interface.selectDifferentComparisonPeriod')}\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const topChangedPatterns = useMemo(() => {\n    if (content.empty) return [] as any[];\n    return [...content.patterns.changed]\n      .sort((a, b) => Math.abs((b.deltaStrength ?? 0)) - Math.abs((a.deltaStrength ?? 0)))\n      .slice(0, 3);\n  }, [content]);\n\n  return (\n    <Card className={cn(\"bg-gradient-card border-0 shadow-soft\", className)}>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <CardTitle>{tAnalytics('interface.comparisonSummary')}</CardTitle>\n            {hasSmallBaseline && (\n              <Badge variant=\"outline\" className=\"text-amber-600 border-amber-300 bg-amber-50\">\n                {tAnalytics('interface.limitedDataBaseline')}\n              </Badge>\n            )}\n          </div>\n          <div className=\"text-xs text-muted-foreground\">\n            <span className=\"font-medium\">{currentLabel}</span>\n            <span className=\"mx-1\">{tAnalytics('interface.versus')}</span>\n            <span className=\"font-medium\">{baselineLabel}</span>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent className={cn(\"space-y-4\", hasSmallBaseline && \"opacity-75\")}> \n        {/* Summary metrics */}\n        <div className=\"grid grid-cols-2 md:grid-cols-7 gap-3 text-sm\">\n          <div className=\"rounded-md border p-3\">\n            <div className=\"text-[11px] text-muted-foreground\">{tAnalytics('interface.patterns')}</div>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"font-medium\">{current.patterns?.length ?? 0}</div>\n              <Trend value={content.empty ? 0 : (content as any).summary.counts.patterns.delta} />\n            </div>\n            <div className=\"mt-0.5\"><TrendPct value={content.empty ? 0 : (content as any).summary.counts.patterns.deltaPct} /></div>\n          </div>\n          <div className=\"rounded-md border p-3\">\n            <div className=\"text-[11px] text-muted-foreground\">{tAnalytics('interface.correlations')}</div>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"font-medium\">{current.correlations?.length ?? 0}</div>\n              <Trend value={content.empty ? 0 : (content as any).summary.counts.correlations.delta} />\n            </div>\n            <div className=\"mt-0.5\"><TrendPct value={content.empty ? 0 : (content as any).summary.counts.correlations.deltaPct} /></div>\n          </div>\n          <div className=\"rounded-md border p-3\">\n            <div className=\"text-[11px] text-muted-foreground\">{tAnalytics('interface.insights')}</div>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"font-medium\">{(current as any).insights?.length ?? 0}</div>\n              <Trend value={content.empty ? 0 : (content as any).summary.counts.insights.delta} />\n            </div>\n            <div className=\"mt-0.5\"><TrendPct value={content.empty ? 0 : (content as any).summary.counts.insights.deltaPct} /></div>\n          </div>\n          <div className=\"rounded-md border p-3\">\n            <div className=\"text-[11px] text-muted-foreground\">{tAnalytics('interface.anomalies')}</div>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"font-medium\">{(current as any).anomalies?.length ?? 0}</div>\n              <Trend value={content.empty ? 0 : (content as any).summary.counts.anomalies.delta} />\n            </div>\n            <div className=\"mt-0.5\"><TrendPct value={content.empty ? 0 : (content as any).summary.counts.anomalies.deltaPct} /></div>\n          </div>\n          <div className=\"rounded-md border p-3\">\n            <div className=\"text-[11px] text-muted-foreground\">{tAnalytics('interface.predictive')}</div>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"font-medium\">{(current as any).predictiveInsights?.length ?? 0}</div>\n              <Trend value={content.empty ? 0 : (content as any).summary.counts.predictive.delta} />\n            </div>\n            <div className=\"mt-0.5\"><TrendPct value={content.empty ? 0 : (content as any).summary.counts.predictive.deltaPct} /></div>\n          </div>\n          <div className=\"rounded-md border p-3\">\n            <div className=\"text-[11px] text-muted-foreground\">{tAnalytics('interface.balance')}</div>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"font-medium\">{currentBalance ?? '—'}%</div>\n              <Trend value={content.empty ? 0 : (content as any).summary.balance?.delta} />\n            </div>\n            <div className=\"mt-0.5\"><TrendPct value={content.empty ? 0 : (content as any).summary.balance?.deltaPct} /></div>\n          </div>\n          <div className=\"rounded-md border p-3\">\n            <div className=\"text-[11px] text-muted-foreground\">{tAnalytics('interface.avgIntensityShort')}</div>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"font-medium\">{currentAvgIntensity ? currentAvgIntensity.toFixed(1) : '—'}</div>\n              <Trend value={content.empty ? 0 : (content as any).summary.avgIntensity?.delta} />\n            </div>\n            <div className=\"mt-0.5\"><TrendPct value={content.empty ? 0 : (content as any).summary.avgIntensity?.deltaPct} /></div>\n          </div>\n        </div>\n\n        {/* Pattern changes */}\n        {!content.empty && (\n          <div className=\"space-y-2\">\n            <div className=\"text-sm font-medium\">{tAnalytics('interface.keyChanges')}</div>\n            {topChangedPatterns.length === 0 && content.patterns.added.length === 0 && content.patterns.removed.length === 0 ? (\n              <div className=\"text-sm text-muted-foreground\">{tAnalytics('interface.identicalResults')}</div>\n            ) : (\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n                {topChangedPatterns.map((c) => (\n                  <div key={c.key} className=\"rounded-md border p-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"font-medium\">{c.current?.name || c.baseline?.name}</div>\n                      {typeof c.deltaStrength === 'number' && (\n                        <Badge variant=\"outline\" className={cn(c.deltaStrength > 0 ? 'text-emerald-700 border-emerald-200' : 'text-rose-700 border-rose-200')}>\n                          Δ {(c.deltaStrength * 100).toFixed(0)}%\n                        </Badge>\n                      )}\n                    </div>\n                    {c.impactChange && (\n                      <div className=\"mt-1 text-[11px] text-muted-foreground inline-flex items-center gap-1\">\n                        <Info className=\"h-3 w-3\" />\n                        {tAnalytics('interface.impactChange')} {String(c.impactChange.from || '—')} → {String(c.impactChange.to || '—')}\n                      </div>\n                    )}\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* Tabs: Patterns / Correlations / Interventions with export */}\n        {!content.empty && (\n          <div className=\"mt-1\">\n            <Tabs defaultValue=\"patterns\">\n              <div className=\"flex items-center justify-between gap-2\">\n                <TabsList>\n                  <TabsTrigger value=\"patterns\">{tAnalytics('interface.patterns')}</TabsTrigger>\n                  <TabsTrigger value=\"correlations\">{tAnalytics('interface.correlations')}</TabsTrigger>\n                  <TabsTrigger value=\"interventions\">{tAnalytics('interface.newInterventions')}</TabsTrigger>\n                </TabsList>\n                {/* Export actions per active tab handled by simple onClick on buttons bound via IDs */}\n                <div className=\"flex items-center gap-2\">\n                  <TooltipProvider>\n                    <Tooltip>\n                      <TooltipTrigger asChild>\n                        <Button id=\"export-csv\" variant=\"outline\" size=\"sm\" aria-label={String(tAnalytics('interface.exportCsvAria'))}>{String(tAnalytics('interface.exportCsv'))}</Button>\n                      </TooltipTrigger>\n                      <TooltipContent>{String(tAnalytics('interface.exportCsvTooltip'))}</TooltipContent>\n                    </Tooltip>\n                  </TooltipProvider>\n                  <TooltipProvider>\n                    <Tooltip>\n                      <TooltipTrigger asChild>\n                        <Button id=\"export-json\" variant=\"outline\" size=\"sm\" aria-label={String(tAnalytics('interface.copyJsonAria'))}>{String(tAnalytics('interface.copyJson'))}</Button>\n                      </TooltipTrigger>\n                      <TooltipContent>{String(tAnalytics('interface.copyJsonTooltip'))}</TooltipContent>\n                    </Tooltip>\n                  </TooltipProvider>\n                  {lastExport.at && (\n                    <span className=\"text-[11px] text-muted-foreground ml-1\">\n                      {String(tAnalytics('interface.lastExportShort'))}: {lastExport.type?.toUpperCase()} {new Date(lastExport.at).toLocaleTimeString()}\n                    </span>\n                  )}\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"text-[11px] h-7 px-2\"\n                    aria-label={String(tAnalytics('interface.resetViewAria'))}\n                    onClick={() => {\n                      setPatLimit(6); setCorrLimit(6); setIntAddedLimit(8); setIntRemovedLimit(8); setLastExport({ type: null, at: null });\n                      try {\n                        const s = (studentName || 'elev').toLowerCase();\n                        const c = currentLabel.toLowerCase();\n                        const b = baselineLabel.toLowerCase();\n                        sessionStorage.removeItem(`cmp_limits_${s}_${c}_${b}`);\n                        sessionStorage.removeItem(`cmp_lastExport_${s}_${c}_${b}`);\n                        announceToScreenReader(String(tAnalytics('interface.resetViewAnnounce')));\n                      } catch {}\n                    }}\n                  >{String(tAnalytics('interface.resetView'))}</Button>\n                </div>\n              </div>\n\n              <TabsContent value=\"patterns\" className=\"mt-3\">\n                {(() => {\n                  const added = content.patterns.added;\n                  const removed = content.patterns.removed;\n                  const changed = content.patterns.changed;\n                  return (\n                    <div className=\"space-y-3\">\n                      <div className=\"text-sm font-medium\">{tAnalytics('interface.keyChanges')}</div>\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                        {changed.slice(0, patLimit).map((c) => (\n                          <div key={c.key} className=\"rounded-md border p-3 text-sm\">\n                            <div className=\"font-medium\">{c.current?.name || c.baseline?.name}</div>\n                            <div className=\"text-[13px] mt-1 flex items-center gap-2\">\n                              <span>Δ strength: {(c.deltaStrength ?? 0).toFixed(2)}</span>\n                              {c.impactChange && <Badge variant=\"outline\">{String(c.impactChange.from || '—')} → {String(c.impactChange.to || '—')}</Badge>}\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                      {changed.length > patLimit && (\n                        <div className=\"mt-1\">\n                          <Button size=\"sm\" variant=\"outline\" aria-label=\"Vis flere endrede mønstre\" onClick={() => setPatLimit(p => p + 8)}>Vis flere</Button>\n                        </div>\n                      )}\n                      {(added.length > 0 || removed.length > 0) && (\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                          <div>\n                            <div className=\"text-sm font-medium mb-1\">{tAnalytics('interface.newPattern')}</div>\n                            <ul className=\"text-sm space-y-1\">\n                              {added.length === 0 ? <li className=\"text-muted-foreground\">{tAnalytics('interface.none')}</li> : added.map(a => <li key={a.name}>+ {a.name}</li>)}\n                            </ul>\n                          </div>\n                          <div>\n                            <div className=\"text-sm font-medium mb-1\">{tAnalytics('interface.removedPattern')}</div>\n                            <ul className=\"text-sm space-y-1\">\n                              {removed.length === 0 ? <li className=\"text-muted-foreground\">{tAnalytics('interface.none')}</li> : removed.map(r => <li key={r.name}>– {r.name}</li>)}\n                            </ul>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  );\n                })()}\n              </TabsContent>\n\n              <TabsContent value=\"correlations\" className=\"mt-3\">\n                {(() => {\n                  const changed = content.correlations.changed;\n                  const added = content.correlations.added;\n                  const removed = content.correlations.removed;\n                  return (\n                    <div className=\"space-y-3\">\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                        {changed.slice(0, corrLimit).map((c) => (\n                          <div key={c.key} className=\"rounded-md border p-3 text-sm\">\n                            <div className=\"font-medium\">{c.baseline?.variables.join(' × ') || c.current?.variables.join(' × ')}</div>\n                            <div className=\"mt-1 flex items-center justify-between text-[13px]\">\n                              <div>{tAnalytics('interface.deltaRPrefix')} {(c.deltaCoefficient ?? 0).toFixed(2)}</div>\n                              {c.significanceCrossed && <Badge variant=\"outline\">{tAnalytics('interface.significanceChanged')}</Badge>}\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                      {changed.length > corrLimit && (\n                        <div className=\"mt-1\">\n                          <Button size=\"sm\" variant=\"outline\" aria-label=\"Vis flere korrelasjonsendringer\" onClick={() => setCorrLimit(p => p + 8)}>Vis flere</Button>\n                        </div>\n                      )}\n                      {(added.length > 0 || removed.length > 0) && (\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                          <div>\n                            <div className=\"text-sm font-medium mb-1\">Nye korrelasjoner</div>\n                            <ul className=\"text-sm space-y-1\">\n                              {added.length === 0 ? <li className=\"text-muted-foreground\">{tAnalytics('interface.none')}</li> : added.map(a => <li key={a.key}>+ {a.variables.join(' × ')}</li>)}\n                            </ul>\n                          </div>\n                          <div>\n                            <div className=\"text-sm font-medium mb-1\">Fjernede korrelasjoner</div>\n                            <ul className=\"text-sm space-y-1\">\n                              {removed.length === 0 ? <li className=\"text-muted-foreground\">{tAnalytics('interface.none')}</li> : removed.map(r => <li key={r.key}>– {r.variables.join(' × ')}</li>)}\n                            </ul>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  );\n                })()}\n              </TabsContent>\n\n              <TabsContent value=\"interventions\" className=\"mt-3\">\n                {(() => {\n                  const added = content.interventions.added;\n                  const removed = content.interventions.removed;\n                  const changed = content.interventions.changed || [];\n                  return (\n                    <div className=\"space-y-3\">\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                        <div className=\"rounded-md border p-3\">\n                          <div className=\"text-sm font-medium mb-2\">{tAnalytics('interface.newInterventions')}</div>\n                          {added.length === 0 ? (\n                            <div className=\"text-sm text-muted-foreground\">{tAnalytics('interface.none')}</div>\n                          ) : (\n                            <ul className=\"text-sm space-y-1\">\n                              {added.slice(0, intAddedLimit).map((i) => (\n                                <li key={i.title} className=\"flex items-center justify-between\">\n                                  <span>{i.title}</span>\n                                  {typeof i.confidenceOverall === 'number' && (\n                                    <Badge variant=\"outline\">{Math.round(i.confidenceOverall * 100)}%</Badge>\n                                  )}\n                                </li>\n                              ))}\n                            </ul>\n                          )}\n                          {added.length > intAddedLimit && (\n                            <div className=\"mt-1\"><Button size=\"sm\" variant=\"outline\" aria-label=\"Vis flere nye tiltak\" onClick={() => setIntAddedLimit(p => p + 8)}>Vis flere</Button></div>\n                          )}\n                        </div>\n                        <div className=\"rounded-md border p-3\">\n                          <div className=\"text-sm font-medium mb-2\">{tAnalytics('interface.removedInterventions')}</div>\n                          {removed.length === 0 ? (\n                            <div className=\"text-sm text-muted-foreground\">{tAnalytics('interface.none')}</div>\n                          ) : (\n                            <ul className=\"text-sm space-y-1\">\n                              {removed.slice(0, intRemovedLimit).map((i) => (\n                                <li key={i.title} className=\"flex items-center justify-between\">\n                                  <span>{i.title}</span>\n                                  {typeof i.confidenceOverall === 'number' && (\n                                    <Badge variant=\"outline\">{Math.round(i.confidenceOverall * 100)}%</Badge>\n                                  )}\n                                </li>\n                              ))}\n                            </ul>\n                          )}\n                          {removed.length > intRemovedLimit && (\n                            <div className=\"mt-1\"><Button size=\"sm\" variant=\"outline\" aria-label=\"Vis flere fjernede tiltak\" onClick={() => setIntRemovedLimit(p => p + 8)}>Vis flere</Button></div>\n                          )}\n                        </div>\n                      </div>\n                      {changed.length > 0 && (\n                        <div>\n                          <div className=\"text-sm font-medium mb-1\">Endret tillit</div>\n                          <ul className=\"text-sm space-y-1\">\n                            {changed.map((c: any) => (\n                              <li key={c.title}>\n                                {c.title}: Δ {(c.deltaConfidence ?? 0).toFixed(2)}\n                              </li>\n                            ))}\n                          </ul>\n                        </div>\n                      )}\n                    </div>\n                  );\n                })()}\n              </TabsContent>\n            </Tabs>\n          </div>\n        )}\n\n        {/* Expand for details */}\n        {!content.empty && (\n          <div>\n            <button\n              type=\"button\"\n              onClick={() => setExpanded((v) => !v)}\n              className=\"text-xs text-muted-foreground underline\"\n            >\n              {expanded ? tAnalytics('interface.showLess') : tAnalytics('interface.showMore')}\n            </button>\n            {expanded && (\n              <div className=\"mt-3 space-y-3 text-sm\">\n                <div>\n                  <div className=\"font-medium mb-1\">{tAnalytics('interface.keyFindings')}</div>\n                  <ul className=\"list-disc pl-5\">\n                    {(content.keyFindings.added || []).map((s) => (\n                      <li key={`added-${s}`} className=\"text-emerald-700\">+ {s}</li>\n                    ))}\n                    {(content.keyFindings.removed || []).map((s) => (\n                      <li key={`removed-${s}`} className=\"text-rose-700\">– {s}</li>\n                    ))}\n                  </ul>\n                </div>\n                {(content as any).summary.recencyMs && (content as any).summary.recencyMs.delta !== null && (\n                  <div>\n                    <div className=\"font-medium mb-1\">{tAnalytics('interface.analysisTimestamp')}</div>\n                    <div className=\"text-sm text-muted-foreground\">\n                      {tAnalytics('interface.timestampDifference')}: <Trend value={(content as any).summary.recencyMs.delta} /> ms\n                    </div>\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n\nexport default ComparisonSummary;\n\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ConfidenceIndicator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/CorrelationHeatmap.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/DataCollectionRoadmap.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Datainnsamlingskart\"","line":142,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":144,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n            <Calendar className=\"h-5 w-5\" />\n            Datainnsamlingskart\n          </CardTitle>","line":142,"column":45,"nodeType":"JSXText","endLine":144,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Start datainnsamlingen for å se ditt fremgangskart mot høyere sikkerhetsnivåer.\"","line":148,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":150,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground mb-4\">\n            Start datainnsamlingen for å se ditt fremgangskart mot høyere sikkerhetsnivåer.\n          </p>","line":148,"column":53,"nodeType":"JSXText","endLine":150,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Datainnsamlingskart\"","line":160,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":162,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n          <Calendar className=\"h-5 w-5\" />\n          Datainnsamlingskart\n        </CardTitle>","line":160,"column":43,"nodeType":"JSXText","endLine":162,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Fremgang mot høyere sikkerhetsnivå gjennom systematisk datainnsamling\"","line":163,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":165,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">\n          Fremgang mot høyere sikkerhetsnivå gjennom systematisk datainnsamling\n        </div>","line":163,"column":56,"nodeType":"JSXText","endLine":165,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Din fremgang\"","line":171,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":171,"endColumn":55},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-medium\">Din fremgang</span>","line":171,"column":43,"nodeType":"JSXText","endLine":171,"endColumn":55},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"av\"","line":173,"column":58,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":173,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\">\n              {milestones.filter(m => m.achieved).length} av {milestones.length} milepæler\n            </Badge>","line":173,"column":58,"nodeType":"JSXText","endLine":173,"endColumn":62},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"milepæler\"","line":173,"column":81,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":174,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\">\n              {milestones.filter(m => m.achieved).length} av {milestones.length} milepæler\n            </Badge>","line":173,"column":81,"nodeType":"JSXText","endLine":174,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Datapunkter:\"","line":178,"column":55,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":178,"endColumn":68},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-muted-foreground\">Datapunkter: </span>","line":178,"column":55,"nodeType":"JSXText","endLine":178,"endColumn":68},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Dager:\"","line":182,"column":55,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":182,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-muted-foreground\">Dager: </span>","line":182,"column":55,"nodeType":"JSXText","endLine":182,"endColumn":62},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Neste mål:\"","line":196,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":196,"endColumn":56},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-medium\">Neste mål: {nextMilestone.title}</h4>","line":196,"column":45,"nodeType":"JSXText","endLine":196,"endColumn":56},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Fremgang\"","line":203,"column":23,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":203,"endColumn":31},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Fremgang</span>","line":203,"column":23,"nodeType":"JSXText","endLine":203,"endColumn":31},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Datapunkter:\"","line":208,"column":22,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":209,"endColumn":32},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>\n                  Datapunkter: {currentStatus.dataPoints}/{nextMilestone.targetDataPoints}\n                </div>","line":208,"column":22,"nodeType":"JSXText","endLine":209,"endColumn":32},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Dager:\"","line":211,"column":22,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":212,"endColumn":26},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>\n                  Dager: {currentStatus.daysSpan}/{nextMilestone.targetDays}\n                </div>","line":211,"column":22,"nodeType":"JSXText","endLine":212,"endColumn":26},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Estimert ferdigdato:\"","line":219,"column":61,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":220,"endColumn":38},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"mt-3 text-sm text-blue-600 dark:text-blue-400\">\n                <Calendar className=\"h-4 w-4 inline mr-1\" />\n                Estimert ferdigdato: {formatDate(nextMilestone.estimatedDate)}\n              </div>","line":219,"column":61,"nodeType":"JSXText","endLine":220,"endColumn":38},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Komplett veikart\"","line":228,"column":39,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":228,"endColumn":55},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-medium\">Komplett veikart</h4>","line":228,"column":39,"nodeType":"JSXText","endLine":228,"endColumn":55},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"datapunkter\"","line":260,"column":55,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":260,"endColumn":67},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>{milestone.targetDataPoints} datapunkter</span>","line":260,"column":55,"nodeType":"JSXText","endLine":260,"endColumn":67},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"dager\"","line":261,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":261,"endColumn":55},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>{milestone.targetDays} dager</span>","line":261,"column":49,"nodeType":"JSXText","endLine":261,"endColumn":55},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Estimert:\"","line":263,"column":29,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":263,"endColumn":39},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Estimert: {formatDate(milestone.estimatedDate)}</span>","line":263,"column":29,"nodeType":"JSXText","endLine":263,"endColumn":39}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":36,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMemo } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { Calendar, CheckCircle2, Clock, Target } from 'lucide-react';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { EmotionEntry, SensoryEntry, TrackingEntry } from '@/types/student';\nimport { differenceInDays, addDays } from 'date-fns';\n\ninterface DataCollectionRoadmapProps {\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  entries: TrackingEntry[];\n  className?: string;\n}\n\ninterface Milestone {\n  id: string;\n  title: string;\n  description: string;\n  targetDataPoints: number;\n  targetDays: number;\n  confidenceLevel: string;\n  achieved: boolean;\n  progress: number;\n  estimatedDate: Date | null;\n  icon: React.ComponentType<{className?: string}>;\n  color: string;\n}\n\nexport const DataCollectionRoadmap = ({ \n  emotions, \n  sensoryInputs, \n  entries, \n  className \n}: DataCollectionRoadmapProps) => {\n  const { formatDate } = useTranslation();\n\n  // Calculate current data status\n  const currentStatus = useMemo(() => {\n    const totalDataPoints = emotions.length + sensoryInputs.length;\n    const allTimestamps = [\n      ...emotions.map(e => e.timestamp),\n      ...sensoryInputs.map(s => s.timestamp),\n      ...entries.map(e => e.timestamp)\n    ].sort((a, b) => a.getTime() - b.getTime());\n\n    const daysSpan = allTimestamps.length > 0 \n      ? differenceInDays(new Date(), allTimestamps[0]) + 1 \n      : 0;\n\n    return {\n      dataPoints: totalDataPoints,\n      daysSpan,\n      startDate: allTimestamps[0] || new Date(),\n      hasData: totalDataPoints > 0\n    };\n  }, [emotions, sensoryInputs, entries]);\n\n  // Define roadmap milestones\n  const milestones: Milestone[] = useMemo(() => {\n    const baseDate = currentStatus.startDate || new Date();\n    \n    return [\n      {\n        id: 'initial',\n        title: 'Første datainnsamling',\n        description: 'Start med å registrere grunnleggende data',\n        targetDataPoints: 3,\n        targetDays: 3,\n        confidenceLevel: 'Grunnlag',\n        achieved: currentStatus.dataPoints >= 3 && currentStatus.daysSpan >= 3,\n        progress: Math.min(100, (currentStatus.dataPoints / 3 + currentStatus.daysSpan / 3) * 50),\n        estimatedDate: currentStatus.dataPoints >= 3 ? null : addDays(baseDate, 3),\n        icon: Target,\n        color: 'bg-blue-500'\n      },\n      {\n        id: 'basic',\n        title: 'Grunnleggende mønster',\n        description: 'Nok data til å se grunnleggende trender',\n        targetDataPoints: 10,\n        targetDays: 14,\n        confidenceLevel: 'Lav sikkerhet (25%)',\n        achieved: currentStatus.dataPoints >= 10 && currentStatus.daysSpan >= 14,\n        progress: Math.min(100, (currentStatus.dataPoints / 10 + currentStatus.daysSpan / 14) * 50),\n        estimatedDate: currentStatus.dataPoints >= 10 && currentStatus.daysSpan >= 14 ? null : addDays(baseDate, 14),\n        icon: Clock,\n        color: 'bg-orange-500'\n      },\n      {\n        id: 'reliable',\n        title: 'Pålitelige innsikter',\n        description: 'Tilstrekkelig data for moderate innsikter',\n        targetDataPoints: 20,\n        targetDays: 28,\n        confidenceLevel: 'Middels sikkerhet (50%)',\n        achieved: currentStatus.dataPoints >= 20 && currentStatus.daysSpan >= 28,\n        progress: Math.min(100, (currentStatus.dataPoints / 20 + currentStatus.daysSpan / 28) * 50),\n        estimatedDate: currentStatus.dataPoints >= 20 && currentStatus.daysSpan >= 28 ? null : addDays(baseDate, 28),\n        icon: CheckCircle2,\n        color: 'bg-yellow-500'\n      },\n      {\n        id: 'strong',\n        title: 'Sterke mønstre',\n        description: 'Høy sikkerhet for pedagogiske beslutninger',\n        targetDataPoints: 35,\n        targetDays: 42,\n        confidenceLevel: 'Høy sikkerhet (75%)',\n        achieved: currentStatus.dataPoints >= 35 && currentStatus.daysSpan >= 42,\n        progress: Math.min(100, (currentStatus.dataPoints / 35 + currentStatus.daysSpan / 42) * 50),\n        estimatedDate: currentStatus.dataPoints >= 35 && currentStatus.daysSpan >= 42 ? null : addDays(baseDate, 42),\n        icon: CheckCircle2,\n        color: 'bg-green-500'\n      },\n      {\n        id: 'excellent',\n        title: 'Utmerket datagrunnlag',\n        description: 'Optimalt datagrunnlag for avanserte analyser',\n        targetDataPoints: 50,\n        targetDays: 60,\n        confidenceLevel: 'Meget høy sikkerhet (90%)',\n        achieved: currentStatus.dataPoints >= 50 && currentStatus.daysSpan >= 60,\n        progress: Math.min(100, (currentStatus.dataPoints / 50 + currentStatus.daysSpan / 60) * 50),\n        estimatedDate: currentStatus.dataPoints >= 50 && currentStatus.daysSpan >= 60 ? null : addDays(baseDate, 60),\n        icon: CheckCircle2,\n        color: 'bg-emerald-500'\n      }\n    ];\n  }, [currentStatus]);\n\n  // Get current and next milestone\n  const currentMilestone = milestones.findIndex(m => !m.achieved);\n  const nextMilestone = milestones[currentMilestone];\n\n  if (!currentStatus.hasData) {\n    return (\n      <Card className={className}>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Calendar className=\"h-5 w-5\" />\n            Datainnsamlingskart\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"text-center py-8\">\n          <Target className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n          <p className=\"text-muted-foreground mb-4\">\n            Start datainnsamlingen for å se ditt fremgangskart mot høyere sikkerhetsnivåer.\n          </p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className={className}>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Calendar className=\"h-5 w-5\" />\n          Datainnsamlingskart\n        </CardTitle>\n        <div className=\"text-sm text-muted-foreground\">\n          Fremgang mot høyere sikkerhetsnivå gjennom systematisk datainnsamling\n        </div>\n      </CardHeader>\n      <CardContent>\n        {/* Current Progress Summary */}\n        <div className=\"mb-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-950/20 dark:to-purple-950/20 rounded-lg\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <span className=\"font-medium\">Din fremgang</span>\n            <Badge variant=\"outline\">\n              {milestones.filter(m => m.achieved).length} av {milestones.length} milepæler\n            </Badge>\n          </div>\n          <div className=\"grid grid-cols-2 gap-4 text-sm\">\n            <div>\n              <span className=\"text-muted-foreground\">Datapunkter: </span>\n              <span className=\"font-medium\">{currentStatus.dataPoints}</span>\n            </div>\n            <div>\n              <span className=\"text-muted-foreground\">Dager: </span>\n              <span className=\"font-medium\">{currentStatus.daysSpan}</span>\n            </div>\n          </div>\n        </div>\n\n        {/* Next Milestone Focus */}\n        {nextMilestone && (\n          <div className=\"mb-6 p-4 border-2 border-dashed border-primary/30 rounded-lg\">\n            <div className=\"flex items-center gap-3 mb-3\">\n              <div className={`p-2 rounded-full ${nextMilestone.color} text-white`}>\n                <nextMilestone.icon className=\"h-4 w-4\" />\n              </div>\n              <div>\n                <h4 className=\"font-medium\">Neste mål: {nextMilestone.title}</h4>\n                <p className=\"text-sm text-muted-foreground\">{nextMilestone.description}</p>\n              </div>\n            </div>\n            \n            <div className=\"space-y-2\">\n              <div className=\"flex items-center justify-between text-sm\">\n                <span>Fremgang</span>\n                <span>{Math.round(nextMilestone.progress)}%</span>\n              </div>\n              <Progress value={nextMilestone.progress} className=\"h-2\" />\n              <div className=\"grid grid-cols-2 gap-4 text-xs text-muted-foreground\">\n                <div>\n                  Datapunkter: {currentStatus.dataPoints}/{nextMilestone.targetDataPoints}\n                </div>\n                <div>\n                  Dager: {currentStatus.daysSpan}/{nextMilestone.targetDays}\n                </div>\n              </div>\n            </div>\n\n            {nextMilestone.estimatedDate && (\n              <div className=\"mt-3 text-sm text-blue-600 dark:text-blue-400\">\n                <Calendar className=\"h-4 w-4 inline mr-1\" />\n                Estimert ferdigdato: {formatDate(nextMilestone.estimatedDate)}\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* Roadmap Timeline */}\n        <div className=\"space-y-4\">\n          <h4 className=\"font-medium\">Komplett veikart</h4>\n          <div className=\"relative\">\n            {/* Timeline line */}\n            <div className=\"absolute left-6 top-0 bottom-0 w-0.5 bg-border\" />\n            \n            {milestones.map((milestone) => (\n              <div key={milestone.id} className=\"relative flex items-start gap-4 pb-6\">\n                {/* Milestone icon */}\n                <div className={`relative z-10 flex items-center justify-center w-12 h-12 rounded-full border-2 ${\n                  milestone.achieved \n                    ? `${milestone.color} border-transparent text-white` \n                    : 'bg-background border-border text-muted-foreground'\n                }`}>\n                  <milestone.icon className=\"h-5 w-5\" />\n                </div>\n                \n                {/* Milestone content */}\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"flex items-center justify-between mb-1\">\n                    <h5 className={`font-medium ${milestone.achieved ? 'text-foreground' : 'text-muted-foreground'}`}>\n                      {milestone.title}\n                    </h5>\n                    <Badge variant={milestone.achieved ? 'default' : 'outline'} className=\"ml-2\">\n                      {milestone.achieved ? 'Oppnådd' : milestone.confidenceLevel}\n                    </Badge>\n                  </div>\n                  \n                  <p className=\"text-sm text-muted-foreground mb-2\">\n                    {milestone.description}\n                  </p>\n                  \n                  <div className=\"flex items-center gap-4 text-xs text-muted-foreground\">\n                    <span>{milestone.targetDataPoints} datapunkter</span>\n                    <span>{milestone.targetDays} dager</span>\n                    {milestone.estimatedDate && !milestone.achieved && (\n                      <span>Estimert: {formatDate(milestone.estimatedDate)}</span>\n                    )}\n                  </div>\n                  \n                  {!milestone.achieved && milestone.progress > 0 && (\n                    <div className=\"mt-2\">\n                      <Progress value={milestone.progress} className=\"h-1\" />\n                    </div>\n                  )}\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/DataQualityFeedback.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Datakvalitet\"","line":212,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":214,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n            <BarChart3 className=\"h-5 w-5\" />\n            Datakvalitet\n          </CardTitle>","line":212,"column":46,"nodeType":"JSXText","endLine":214,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Ingen data tilgjengelig for kvalitetsvurdering\"","line":218,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":220,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">\n            Ingen data tilgjengelig for kvalitetsvurdering\n          </p>","line":218,"column":48,"nodeType":"JSXText","endLine":220,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Datakvalitet\"","line":230,"column":44,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":232,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n          <BarChart3 className=\"h-5 w-5\" />\n          Datakvalitet\n        </CardTitle>","line":230,"column":44,"nodeType":"JSXText","endLine":232,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Samlet score:\"","line":235,"column":61,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":235,"endColumn":74},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-sm text-muted-foreground\">Samlet score:</span>","line":235,"column":61,"nodeType":"JSXText","endLine":235,"endColumn":74},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"/100\"","line":237,"column":29,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":238,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Samlet vurdering\"","line":278,"column":44,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":278,"endColumn":60},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-medium mb-2\">Samlet vurdering</h4>","line":278,"column":44,"nodeType":"JSXText","endLine":278,"endColumn":60},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Prioriterte forbedringer:\"","line":289,"column":51,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":289,"endColumn":76},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h5 className=\"text-sm font-medium\">Prioriterte forbedringer:</h5>","line":289,"column":51,"nodeType":"JSXText","endLine":289,"endColumn":76}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMemo, memo } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { \n  CheckCircle, \n  AlertTriangle, \n  TrendingUp, \n  Calendar, \n  Target,\n  BarChart3,\n  Clock\n} from 'lucide-react';\nimport { EmotionEntry, SensoryEntry, TrackingEntry } from '@/types/student';\nimport { eachDayOfInterval, format, subDays, isWithinInterval } from 'date-fns';\n\ninterface DataQualityFeedbackProps {\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  entries: TrackingEntry[];\n  className?: string;\n}\n\ninterface QualityMetric {\n  id: string;\n  title: string;\n  description: string;\n  score: number;\n  maxScore: number;\n  status: 'excellent' | 'good' | 'fair' | 'poor';\n  recommendations: string[];\n  icon: React.ComponentType<{ className?: string }>;\n}\n\n/**\n * DataQualityFeedback\n *\n * Provides visual feedback about the coverage and balance of collected data.\n * Protects against incorrect metric calculations if arrays or their elements are missing/broken.\n */\nexport const DataQualityFeedback = memo(({ \n  emotions, \n  sensoryInputs, \n  entries, \n  className \n}: DataQualityFeedbackProps) => {\n  // Calculate comprehensive data quality metrics\n  const qualityMetrics = useMemo(() => {\n    const totalDataPoints = emotions.length + sensoryInputs.length;\n    const totalEntries = entries.length;\n    \n    if (totalDataPoints === 0) {\n      return [];\n    }\n\n    // Get data span\n    const allTimestamps = [\n      ...emotions.map(e => e.timestamp),\n      ...sensoryInputs.map(s => s.timestamp),\n      ...entries.map(e => e.timestamp)\n    ].sort((a, b) => a.getTime() - b.getTime());\n\n    if (allTimestamps.length === 0) {\n      return [];\n    }\n    \n    const startDate = allTimestamps[0];\n    const endDate = new Date();\n\n    // 1. Data Volume Quality\n    const volumeScore = Math.min(100, (totalDataPoints / 30) * 100);\n    const volumeStatus = volumeScore >= 80 ? 'excellent' : volumeScore >= 60 ? 'good' : volumeScore >= 40 ? 'fair' : 'poor';\n\n    // 2. Consistency Quality (how regularly data is collected)\n    const allDays = eachDayOfInterval({ start: startDate, end: endDate });\n    const daysWithData = allDays.filter(day => {\n      return allTimestamps.some(timestamp => \n        format(timestamp, 'yyyy-MM-dd') === format(day, 'yyyy-MM-dd')\n      );\n    });\n    const consistencyScore = (daysWithData.length / allDays.length) * 100;\n    const consistencyStatus = consistencyScore >= 80 ? 'excellent' : consistencyScore >= 60 ? 'good' : consistencyScore >= 40 ? 'fair' : 'poor';\n\n    // 3. Data Diversity Quality (balance between emotions and sensory)\n    const emotionRatio = totalDataPoints === 0 ? 0 : emotions.length / totalDataPoints;\n    const sensoryRatio = totalDataPoints === 0 ? 0 : sensoryInputs.length / totalDataPoints;\n    const diversityBalance = 1 - Math.abs(emotionRatio - sensoryRatio);\n    const diversityScore = diversityBalance * 100;\n    const diversityStatus = diversityScore >= 80 ? 'excellent' : diversityScore >= 60 ? 'good' : diversityScore >= 40 ? 'fair' : 'poor';\n\n    // 4. Recent Activity Quality (data freshness)\n    const recentData = [...emotions, ...sensoryInputs].filter(item => \n      isWithinInterval(item.timestamp, { start: subDays(new Date(), 7), end: new Date() })\n    );\n    const recentActivityScore = Math.min(100, (recentData.length / 7) * 100);\n    const recentActivityStatus = recentActivityScore >= 80 ? 'excellent' : recentActivityScore >= 60 ? 'good' : recentActivityScore >= 40 ? 'fair' : 'poor';\n\n    // 5. Session Completeness (emotions + sensory in same sessions)\n    const completeSessions = entries.filter(entry => \n      Array.isArray(entry.emotions) && Array.isArray(entry.sensoryInputs) && entry.emotions.length > 0 && entry.sensoryInputs.length > 0\n    );\n    const completenessScore = totalEntries > 0 ? (completeSessions.length / totalEntries) * 100 : 0;\n    const completenessStatus = completenessScore >= 80 ? 'excellent' : completenessScore >= 60 ? 'good' : completenessScore >= 40 ? 'fair' : 'poor';\n\n    const metrics: QualityMetric[] = [\n      {\n        id: 'volume',\n        title: 'Datamengde',\n        description: 'Total mengde data samlet over tid',\n        score: Math.round(volumeScore),\n        maxScore: 100,\n        status: volumeStatus,\n        recommendations: [\n          volumeScore < 40 ? 'Samle mer data - mål på minst 30 datapunkter' : '',\n          volumeScore < 80 ? 'Øk frekvensen på datainnsamling' : '',\n          volumeScore >= 80 ? 'Utmerket datamengde!' : ''\n        ].filter(Boolean),\n        icon: BarChart3\n      },\n      {\n        id: 'consistency',\n        title: 'Konsistens',\n        description: 'Hvor jevnlig data samles inn',\n        score: Math.round(consistencyScore),\n        maxScore: 100,\n        status: consistencyStatus,\n        recommendations: [\n          consistencyScore < 60 ? 'Samle data mer regelmessig - ideelt daglig' : '',\n          consistencyScore < 80 ? 'Prøv å etablere en fast rutine for datainnsamling' : '',\n          consistencyScore >= 80 ? 'Excellent consistency!' : ''\n        ].filter(Boolean),\n        icon: Calendar\n      },\n      {\n        id: 'diversity',\n        title: 'Databalanse',\n        description: 'Balanse mellom følelser og sensoriske data',\n        score: Math.round(diversityScore),\n        maxScore: 100,\n        status: diversityStatus,\n        recommendations: [\n          emotionRatio < 0.3 ? 'Registrer flere følelser' : '',\n          sensoryRatio < 0.3 ? 'Registrer flere sensoriske opplevelser' : '',\n          diversityScore >= 80 ? 'God balanse mellom datatyper!' : ''\n        ].filter(Boolean),\n        icon: Target\n      },\n      {\n        id: 'recent',\n        title: 'Nylig aktivitet',\n        description: 'Datainnsamling siste 7 dager',\n        score: Math.round(recentActivityScore),\n        maxScore: 100,\n        status: recentActivityStatus,\n        recommendations: [\n          recentActivityScore < 40 ? 'Øk datainnsamlingen de siste dagene' : '',\n          recentActivityScore < 80 ? 'Prøv å samle data hver dag denne uken' : '',\n          recentActivityScore >= 80 ? 'Utmerket nylig aktivitet!' : ''\n        ].filter(Boolean),\n        icon: Clock\n      },\n      {\n        id: 'completeness',\n        title: 'Øktfullstendighet',\n        description: 'Økter med både følelser og sensoriske data',\n        score: Math.round(completenessScore),\n        maxScore: 100,\n        status: completenessStatus,\n        recommendations: [\n          completenessScore < 60 ? 'Inkluder både følelser og sensoriske data i hver økt' : '',\n          completenessScore < 80 ? 'Prøv å være mer komplett i dataregistreringen' : '',\n          completenessScore >= 80 ? 'Utmerket øktfullstendighet!' : ''\n        ].filter(Boolean),\n        icon: CheckCircle\n      }\n    ];\n\n    return metrics;\n  }, [emotions, sensoryInputs, entries]);\n\n  // Calculate overall quality score\n  const overallScore = useMemo(() => {\n    if (qualityMetrics.length === 0) return 0;\n    return Math.round(qualityMetrics.reduce((sum, metric) => sum + metric.score, 0) / qualityMetrics.length);\n  }, [qualityMetrics]);\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'excellent': return 'text-success-foreground bg-success';\n      case 'good': return 'text-info-foreground bg-info';\n      case 'fair': return 'text-warning-foreground bg-warning';\n      case 'poor': return 'text-destructive-foreground bg-destructive';\n      default: return 'text-gray-600 bg-gray-50 dark:bg-gray-950/20';\n    }\n  };\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'excellent': return <CheckCircle className=\"h-4 w-4\" />;\n      case 'good': return <TrendingUp className=\"h-4 w-4\" />;\n      case 'fair': return <AlertTriangle className=\"h-4 w-4\" />;\n      case 'poor': return <AlertTriangle className=\"h-4 w-4\" />;\n      default: return <BarChart3 className=\"h-4 w-4\" />;\n    }\n  };\n\n  if (qualityMetrics.length === 0) {\n    return (\n      <Card className={className}>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <BarChart3 className=\"h-5 w-5\" />\n            Datakvalitet\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"text-center py-8\">\n          <AlertTriangle className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n          <p className=\"text-muted-foreground\">\n            Ingen data tilgjengelig for kvalitetsvurdering\n          </p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className={className}>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <BarChart3 className=\"h-5 w-5\" />\n          Datakvalitet\n        </CardTitle>\n        <div className=\"flex items-center gap-4\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-sm text-muted-foreground\">Samlet score:</span>\n            <Badge variant={overallScore >= 80 ? 'default' : overallScore >= 60 ? 'secondary' : 'outline'}>\n              {overallScore}/100\n            </Badge>\n          </div>\n          <Progress value={overallScore} className=\"flex-1 h-2\" />\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        {/* Quality Metrics Grid */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          {qualityMetrics.map((metric) => (\n            <div key={metric.id} className={`p-4 rounded-lg ${getStatusColor(metric.status)}`}>\n              <div className=\"flex items-center justify-between mb-2\">\n                <div className=\"flex items-center gap-2\">\n                  <metric.icon className=\"h-4 w-4\" />\n                  <span className=\"font-medium\">{metric.title}</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  {getStatusIcon(metric.status)}\n                  <span className=\"font-mono text-sm\">{metric.score}/{metric.maxScore}</span>\n                </div>\n              </div>\n              \n              <p className=\"text-sm opacity-80 mb-3\">{metric.description}</p>\n              \n              <Progress value={metric.score} className=\"mb-3 h-1\" />\n              \n              {metric.recommendations.length > 0 && (\n                <div className=\"space-y-1\">\n                  {metric.recommendations.map((rec) => (\n                    <p key={`${metric.id}-${rec}`} className=\"text-xs opacity-90\">\n                      • {rec}\n                    </p>\n                  ))}\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n\n        {/* Overall Quality Assessment */}\n        <div className=\"p-4 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-950/20 dark:to-blue-950/20 rounded-lg\">\n          <h4 className=\"font-medium mb-2\">Samlet vurdering</h4>\n          <p className=\"text-sm text-muted-foreground mb-3\">\n            {overallScore >= 90 && 'Utmerket datakvalitet! Dine data gir høy sikkerhet for analyser.'}\n            {overallScore >= 70 && overallScore < 90 && 'God datakvalitet. Små forbedringer kan øke sikkerhetsnivået.'}\n            {overallScore >= 50 && overallScore < 70 && 'Moderat datakvalitet. Fokuser på de områdene som trenger forbedring.'}\n            {overallScore < 50 && 'Datakvaliteten kan forbedres betydelig. Følg anbefalingene for bedre analyser.'}\n          </p>\n          \n          {/* Top Priority Recommendations */}\n          {qualityMetrics.filter(m => m.status === 'poor' || m.status === 'fair').length > 0 && (\n            <div className=\"space-y-2\">\n              <h5 className=\"text-sm font-medium\">Prioriterte forbedringer:</h5>\n              {qualityMetrics\n                .filter(m => m.status === 'poor' || m.status === 'fair')\n                .slice(0, 3)\n                .map((metric, index) => (\n                  <div key={metric.id} className=\"text-sm flex items-start gap-2\">\n                    <span className=\"font-medium text-xs bg-white dark:bg-gray-800 px-2 py-1 rounded\">\n                      {index + 1}\n                    </span>\n                    <span>{metric.recommendations[0]}</span>\n                  </div>\n                ))}\n            </div>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n});\n\nDataQualityFeedback.displayName = 'DataQualityFeedback';\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/DataRequirementsCalculator.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Datakrav for sikkerhetsnivå\"","line":139,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":141,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n            <Target className=\"h-5 w-5\" />\n            Datakrav for sikkerhetsnivå\n          </CardTitle>","line":139,"column":43,"nodeType":"JSXText","endLine":141,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Ingen data registrert ennå. Start med å samle data for å se fremgang mot sikkerhetsnivåer.\"","line":145,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":147,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground mb-4\">\n            Ingen data registrert ennå. Start med å samle data for å se fremgang mot sikkerhetsnivåer.\n          </p>","line":145,"column":53,"nodeType":"JSXText","endLine":147,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Start datainnsamling\"","line":148,"column":37,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":150,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button variant=\"outline\">\n            Start datainnsamling\n          </Button>","line":148,"column":37,"nodeType":"JSXText","endLine":150,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Datakrav for sikkerhetsnivå\"","line":160,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":162,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n          <Target className=\"h-5 w-5\" />\n          Datakrav for sikkerhetsnivå\n        </CardTitle>","line":160,"column":41,"nodeType":"JSXText","endLine":162,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"datapunkter samlet\"","line":164,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":164,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>{currentStatus.dataPoints} datapunkter samlet</span>","line":164,"column":43,"nodeType":"JSXText","endLine":164,"endColumn":62},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"dager med data\"","line":165,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":165,"endColumn":56},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>{currentStatus.daysSpan} dager med data</span>","line":165,"column":41,"nodeType":"JSXText","endLine":165,"endColumn":56},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Nåværende sikkerhetsnivå\"","line":172,"column":40,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":172,"endColumn":64},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"font-medium\">Nåværende sikkerhetsnivå</p>","line":172,"column":40,"nodeType":"JSXText","endLine":172,"endColumn":64},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"sikkerhet\"","line":181,"column":80,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":182,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant={currentLevel >= 3 ? 'default' : currentLevel >= 1 ? 'secondary' : 'outline'}>\n            {currentLevel >= 3 ? 'Høy' : currentLevel >= 1 ? 'Middels' : 'Lav'} sikkerhet\n          </Badge>","line":181,"column":80,"nodeType":"JSXText","endLine":182,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Fremgang mot\"","line":189,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":189,"endColumn":56},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-medium\">Fremgang mot {nextTarget.requirement.description}</h4>","line":189,"column":43,"nodeType":"JSXText","endLine":189,"endColumn":56},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"% fullført\"","line":191,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":192,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-sm text-muted-foreground\">\n                {Math.round(nextTarget.progress)}% fullført\n              </span>","line":191,"column":50,"nodeType":"JSXText","endLine":192,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Datapunkter\"","line":200,"column":25,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":200,"endColumn":36},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Datapunkter</span>","line":200,"column":25,"nodeType":"JSXText","endLine":200,"endColumn":36},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"flere datapunkter trengs\"","line":206,"column":51,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":207,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground\">\n                    {nextTarget.dataPoints.needed} flere datapunkter trengs\n                  </p>","line":206,"column":51,"nodeType":"JSXText","endLine":207,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Tidsperiode\"","line":213,"column":25,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":213,"endColumn":36},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Tidsperiode</span>","line":213,"column":25,"nodeType":"JSXText","endLine":213,"endColumn":36},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"dager\"","line":214,"column":85,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":214,"endColumn":91},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>{nextTarget.days.current} / {nextTarget.requirement.minDays} dager</span>","line":214,"column":85,"nodeType":"JSXText","endLine":214,"endColumn":91},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"flere dager trengs\"","line":219,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":220,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground\">\n                    {nextTarget.days.needed} flere dager trengs\n                  </p>","line":219,"column":45,"nodeType":"JSXText","endLine":220,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Tidsestimat\"","line":229,"column":68,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":229,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-medium text-info-foreground\">Tidsestimat</span>","line":229,"column":68,"nodeType":"JSXText","endLine":229,"endColumn":79},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Med\"","line":231,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":232,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-info-foreground/80\">\n                Med {getRecommendedRate()} datapunkt(er) per dag vil du nå{' '}\n                <span className=\"font-medium\">{nextTarget.requirement.description}</span> innen{' '}\n                <span className=\"font-medium\">{formatDate(nextTarget.targetDate)}</span>\n                {nextTarget.daysToTarget > 0 && ` (om ${nextTarget.daysToTarget} dager)`}\n              </p>","line":231,"column":62,"nodeType":"JSXText","endLine":232,"endColumn":21},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"datapunkt(er) per dag vil du nå\"","line":232,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":232,"endColumn":75},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-info-foreground/80\">\n                Med {getRecommendedRate()} datapunkt(er) per dag vil du nå{' '}\n                <span className=\"font-medium\">{nextTarget.requirement.description}</span> innen{' '}\n                <span className=\"font-medium\">{formatDate(nextTarget.targetDate)}</span>\n                {nextTarget.daysToTarget > 0 && ` (om ${nextTarget.daysToTarget} dager)`}\n              </p>","line":232,"column":43,"nodeType":"JSXText","endLine":232,"endColumn":75},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"innen\"","line":233,"column":90,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":233,"endColumn":96},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-info-foreground/80\">\n                Med {getRecommendedRate()} datapunkt(er) per dag vil du nå{' '}\n                <span className=\"font-medium\">{nextTarget.requirement.description}</span> innen{' '}\n                <span className=\"font-medium\">{formatDate(nextTarget.targetDate)}</span>\n                {nextTarget.daysToTarget > 0 && ` (om ${nextTarget.daysToTarget} dager)`}\n              </p>","line":233,"column":90,"nodeType":"JSXText","endLine":233,"endColumn":96},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Alle sikkerhetsnivåer\"","line":243,"column":39,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":243,"endColumn":60},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-medium\">Alle sikkerhetsnivåer</h4>","line":243,"column":39,"nodeType":"JSXText","endLine":243,"endColumn":60},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"datapunkter over\"","line":261,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":261,"endColumn":71},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground\">\n                    {calc.requirement.minDataPoints} datapunkter over {calc.requirement.minDays} dager\n                  </p>","line":261,"column":53,"nodeType":"JSXText","endLine":261,"endColumn":71},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"dager\"","line":261,"column":97,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":262,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground\">\n                    {calc.requirement.minDataPoints} datapunkter over {calc.requirement.minDays} dager\n                  </p>","line":261,"column":97,"nodeType":"JSXText","endLine":262,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"~\"","line":270,"column":69,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":271,"endColumn":22},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"dager igjen\"","line":271,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":272,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground mt-1\">\n                    ~{calc.daysToTarget} dager igjen\n                  </p>","line":271,"column":41,"nodeType":"JSXText","endLine":272,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Anbefalinger\"","line":284,"column":69,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":284,"endColumn":81},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-medium text-primary-foreground\">Anbefalinger</span>","line":284,"column":69,"nodeType":"JSXText","endLine":284,"endColumn":81},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Samle\"","line":287,"column":19,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":287,"endColumn":27},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>• Samle {getRecommendedRate()} datapunkt(er) per dag for optimal fremgang</li>","line":287,"column":19,"nodeType":"JSXText","endLine":287,"endColumn":27},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"datapunkt(er) per dag for optimal fremgang\"","line":287,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":287,"endColumn":92},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>• Samle {getRecommendedRate()} datapunkt(er) per dag for optimal fremgang</li>","line":287,"column":49,"nodeType":"JSXText","endLine":287,"endColumn":92},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Registrer data konsekvent for bedre mønstergjenkjenning\"","line":288,"column":19,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":288,"endColumn":76},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>• Registrer data konsekvent for bedre mønstergjenkjenning</li>","line":288,"column":19,"nodeType":"JSXText","endLine":288,"endColumn":76},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Inkluder både følelser og sensoriske opplevelser i hver økt\"","line":289,"column":19,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":289,"endColumn":80},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>• Inkluder både følelser og sensoriske opplevelser i hver økt</li>","line":289,"column":19,"nodeType":"JSXText","endLine":289,"endColumn":80},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Noter miljøfaktorer for å identifisere sammenhenger\"","line":290,"column":19,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":290,"endColumn":72},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>• Noter miljøfaktorer for å identifisere sammenhenger</li>","line":290,"column":19,"nodeType":"JSXText","endLine":290,"endColumn":72}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":59,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMemo } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { Button } from '@/components/ui/button';\nimport { Calendar, Target, TrendingUp, AlertCircle, CheckCircle } from 'lucide-react';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { EmotionEntry, SensoryEntry, TrackingEntry } from '@/types/student';\nimport { differenceInDays, addDays } from 'date-fns';\n\ninterface DataRequirementsCalculatorProps {\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  entries: TrackingEntry[];\n  className?: string;\n}\n\ninterface ConfidenceRequirement {\n  level: 'low' | 'medium' | 'high';\n  percentage: number;\n  minDataPoints: number;\n  minDays: number;\n  minRSquared: number;\n  color: string;\n  description: string;\n}\n\nexport const DataRequirementsCalculator = ({ \n  emotions, \n  sensoryInputs, \n  entries, \n  className \n}: DataRequirementsCalculatorProps) => {\n  const { tAnalytics, formatDate } = useTranslation();\n\n  // Define confidence level requirements\n  const requirements: ConfidenceRequirement[] = useMemo(() => [\n    {\n      level: 'low',\n      percentage: 25,\n      minDataPoints: 5,\n      minDays: 7,\n      minRSquared: 0.3,\n      color: 'bg-destructive',\n      description: String(tAnalytics('confidence.low'))\n    },\n    {\n      level: 'medium',\n      percentage: 50,\n      minDataPoints: 15,\n      minDays: 21,\n      minRSquared: 0.5,\n      color: 'bg-warning',\n      description: String(tAnalytics('confidence.medium'))\n    },\n    {\n      level: 'high',\n      percentage: 75,\n      minDataPoints: 30,\n      minDays: 42,\n      minRSquared: 0.7,\n      color: 'bg-success',\n      description: String(tAnalytics('confidence.high'))\n    }\n  ], [tAnalytics]);\n\n  // Calculate current data status\n  const currentStatus = useMemo(() => {\n    const totalDataPoints = emotions.length + sensoryInputs.length;\n    const allTimestamps = [\n      ...emotions.map(e => e.timestamp),\n      ...sensoryInputs.map(s => s.timestamp),\n      ...entries.map(e => e.timestamp)\n    ].sort((a, b) => a.getTime() - b.getTime());\n\n    const daysSpan = allTimestamps.length > 0 \n      ? differenceInDays(new Date(), allTimestamps[0]) + 1 \n      : 0;\n\n    return {\n      dataPoints: totalDataPoints,\n      daysSpan,\n      entriesCount: entries.length,\n      startDate: allTimestamps[0] || new Date(),\n      hasData: totalDataPoints > 0\n    };\n  }, [emotions, sensoryInputs, entries]);\n\n  // Calculate progress toward each confidence level\n  const progressCalculations = useMemo(() => {\n    return requirements.map(req => {\n      const dataPointsProgress = Math.min(100, (currentStatus.dataPoints / req.minDataPoints) * 100);\n      const daysProgress = Math.min(100, (currentStatus.daysSpan / req.minDays) * 100);\n      const overallProgress = Math.min(dataPointsProgress, daysProgress);\n\n      const dataPointsNeeded = Math.max(0, req.minDataPoints - currentStatus.dataPoints);\n      const daysNeeded = Math.max(0, req.minDays - currentStatus.daysSpan);\n\n      // Estimate days to target (assuming 1 data point per day)\n      const daysToTarget = Math.max(dataPointsNeeded, daysNeeded);\n      const targetDate = addDays(new Date(), daysToTarget);\n\n      return {\n        requirement: req,\n        progress: overallProgress,\n        dataPoints: {\n          current: currentStatus.dataPoints,\n          needed: dataPointsNeeded,\n          progress: dataPointsProgress\n        },\n        days: {\n          current: currentStatus.daysSpan,\n          needed: daysNeeded,\n          progress: daysProgress\n        },\n        daysToTarget,\n        targetDate,\n        isAchieved: overallProgress >= 100\n      };\n    });\n  }, [requirements, currentStatus]);\n\n  // Get next target confidence level\n  const nextTarget = progressCalculations.find(p => !p.isAchieved);\n  const currentLevel = progressCalculations.filter(p => p.isAchieved).length;\n\n  // Calculate recommended daily collection rate\n  const getRecommendedRate = () => {\n    if (!nextTarget) return null;\n    const dailyRate = Math.ceil(nextTarget.dataPoints.needed / Math.max(nextTarget.daysToTarget, 1));\n    return Math.max(1, dailyRate);\n  };\n\n  if (!currentStatus.hasData) {\n    return (\n      <Card className={className}>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Target className=\"h-5 w-5\" />\n            Datakrav for sikkerhetsnivå\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"text-center py-8\">\n          <AlertCircle className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n          <p className=\"text-muted-foreground mb-4\">\n            Ingen data registrert ennå. Start med å samle data for å se fremgang mot sikkerhetsnivåer.\n          </p>\n          <Button variant=\"outline\">\n            Start datainnsamling\n          </Button>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className={className}>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Target className=\"h-5 w-5\" />\n          Datakrav for sikkerhetsnivå\n        </CardTitle>\n        <div className=\"flex items-center gap-4 text-sm text-muted-foreground\">\n          <span>{currentStatus.dataPoints} datapunkter samlet</span>\n          <span>{currentStatus.daysSpan} dager med data</span>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        {/* Current Status */}\n        <div className=\"flex items-center justify-between p-4 bg-muted/50 rounded-lg\">\n          <div>\n            <p className=\"font-medium\">Nåværende sikkerhetsnivå</p>\n            <p className=\"text-sm text-muted-foreground\">\n              {currentLevel === 0 && 'Under lavt nivå'}\n              {currentLevel === 1 && 'Lavt nivå oppnådd'}\n              {currentLevel === 2 && 'Middels nivå oppnådd'}\n              {currentLevel >= 3 && 'Høyt nivå oppnådd'}\n            </p>\n          </div>\n          <Badge variant={currentLevel >= 3 ? 'default' : currentLevel >= 1 ? 'secondary' : 'outline'}>\n            {currentLevel >= 3 ? 'Høy' : currentLevel >= 1 ? 'Middels' : 'Lav'} sikkerhet\n          </Badge>\n        </div>\n\n        {/* Progress toward next level */}\n        {nextTarget && (\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <h4 className=\"font-medium\">Fremgang mot {nextTarget.requirement.description}</h4>\n              <span className=\"text-sm text-muted-foreground\">\n                {Math.round(nextTarget.progress)}% fullført\n              </span>\n            </div>\n            \n            <Progress value={nextTarget.progress} className=\"h-2\" />\n            \n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span>Datapunkter</span>\n                  <span>{nextTarget.dataPoints.current} / {nextTarget.requirement.minDataPoints}</span>\n                </div>\n                <Progress value={nextTarget.dataPoints.progress} className=\"h-1\" />\n                {nextTarget.dataPoints.needed > 0 && (\n                  <p className=\"text-xs text-muted-foreground\">\n                    {nextTarget.dataPoints.needed} flere datapunkter trengs\n                  </p>\n                )}\n              </div>\n              \n              <div className=\"space-y-2\">\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span>Tidsperiode</span>\n                  <span>{nextTarget.days.current} / {nextTarget.requirement.minDays} dager</span>\n                </div>\n                <Progress value={nextTarget.days.progress} className=\"h-1\" />\n                {nextTarget.days.needed > 0 && (\n                  <p className=\"text-xs text-muted-foreground\">\n                    {nextTarget.days.needed} flere dager trengs\n                  </p>\n                )}\n              </div>\n            </div>\n\n            {/* Timeline prediction */}\n            <div className=\"p-4 bg-info/10 rounded-lg\">\n              <div className=\"flex items-center gap-2 mb-2\">\n                <Calendar className=\"h-4 w-4 text-info\" />\n                <span className=\"font-medium text-info-foreground\">Tidsestimat</span>\n              </div>\n              <p className=\"text-sm text-info-foreground/80\">\n                Med {getRecommendedRate()} datapunkt(er) per dag vil du nå{' '}\n                <span className=\"font-medium\">{nextTarget.requirement.description}</span> innen{' '}\n                <span className=\"font-medium\">{formatDate(nextTarget.targetDate)}</span>\n                {nextTarget.daysToTarget > 0 && ` (om ${nextTarget.daysToTarget} dager)`}\n              </p>\n            </div>\n          </div>\n        )}\n\n        {/* All confidence levels overview */}\n        <div className=\"space-y-3\">\n          <h4 className=\"font-medium\">Alle sikkerhetsnivåer</h4>\n          {progressCalculations.map((calc) => (\n            <div \n              key={calc.requirement.level}\n              className={`flex items-center justify-between p-3 rounded-lg border ${\n                calc.isAchieved ? 'bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800' : \n                'bg-muted/30'\n              }`}\n            >\n              <div className=\"flex items-center gap-3\">\n                {calc.isAchieved ? (\n                  <CheckCircle className=\"h-5 w-5 text-success\" />\n                ) : (\n                  <div className={`w-5 h-5 rounded-full ${calc.requirement.color} opacity-60`} />\n                )}\n                <div>\n                  <p className=\"font-medium\">{calc.requirement.description}</p>\n                  <p className=\"text-xs text-muted-foreground\">\n                    {calc.requirement.minDataPoints} datapunkter over {calc.requirement.minDays} dager\n                  </p>\n                </div>\n              </div>\n              <div className=\"text-right\">\n                <Badge variant={calc.isAchieved ? 'default' : 'outline'}>\n                  {calc.isAchieved ? 'Oppnådd' : `${Math.round(calc.progress)}%`}\n                </Badge>\n                {!calc.isAchieved && calc.daysToTarget > 0 && (\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    ~{calc.daysToTarget} dager igjen\n                  </p>\n                )}\n              </div>\n            </div>\n          ))}\n        </div>\n\n        {/* Collection recommendations */}\n        {nextTarget && (\n        <div className=\"p-4 bg-primary/10 rounded-lg\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <TrendingUp className=\"h-4 w-4 text-primary\" />\n              <span className=\"font-medium text-primary-foreground\">Anbefalinger</span>\n            </div>\n            <ul className=\"text-sm text-primary-foreground/80 space-y-1\">\n              <li>• Samle {getRecommendedRate()} datapunkt(er) per dag for optimal fremgang</li>\n              <li>• Registrer data konsekvent for bedre mønstergjenkjenning</li>\n              <li>• Inkluder både følelser og sensoriske opplevelser i hver økt</li>\n              <li>• Noter miljøfaktorer for å identifisere sammenhenger</li>\n            </ul>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/DateRangeSelector.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'subWeeks' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":35},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Pick a date range\"","line":154,"column":21,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":154,"endColumn":38},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Pick a date range</span>","line":154,"column":21,"nodeType":"JSXText","endLine":154,"endColumn":38},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Selected:\"","line":174,"column":44,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":174,"endColumn":54},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"hidden md:inline\">Selected: </span>","line":174,"column":44,"nodeType":"JSXText","endLine":174,"endColumn":54}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\nimport { format, subDays, subWeeks, subMonths, startOfDay, endOfDay } from \"date-fns\";\nimport { Calendar as CalendarIcon, ChevronDown } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { cn } from \"@/lib/utils\";\nimport { DateRange } from \"react-day-picker\";\n\nexport interface TimeRange {\n  start: Date;\n  end: Date;\n  label: string;\n}\n\ninterface DateRangeSelectorProps {\n  onRangeChange: (range: TimeRange) => void;\n  selectedRange: TimeRange;\n  className?: string;\n}\n\nexport const DateRangeSelector = ({ onRangeChange, selectedRange, className }: DateRangeSelectorProps) => {\n  const [dateRange, setDateRange] = useState<DateRange | undefined>({\n    from: selectedRange.start,\n    to: selectedRange.end,\n  });\n  const [isOpen, setIsOpen] = useState(false);\n\n  const presetRanges = [\n    {\n      label: \"Last 7 days\",\n      value: \"7d\",\n      getRange: () => ({\n        start: startOfDay(subDays(new Date(), 6)),\n        end: endOfDay(new Date()),\n        label: \"Last 7 days\"\n      })\n    },\n    {\n      label: \"Last 30 days\",\n      value: \"30d\",\n      getRange: () => ({\n        start: startOfDay(subDays(new Date(), 29)),\n        end: endOfDay(new Date()),\n        label: \"Last 30 days\"\n      })\n    },\n    {\n      label: \"Last 3 months\",\n      value: \"3m\",\n      getRange: () => ({\n        start: startOfDay(subMonths(new Date(), 3)),\n        end: endOfDay(new Date()),\n        label: \"Last 3 months\"\n      })\n    },\n    {\n      label: \"Last 6 months\",\n      value: \"6m\",\n      getRange: () => ({\n        start: startOfDay(subMonths(new Date(), 6)),\n        end: endOfDay(new Date()),\n        label: \"Last 6 months\"\n      })\n    },\n    {\n      label: \"This week\",\n      value: \"week\",\n      getRange: () => {\n        const now = new Date();\n        const dayOfWeek = now.getDay();\n        const startOfWeek = subDays(now, dayOfWeek);\n        return {\n          start: startOfDay(startOfWeek),\n          end: endOfDay(now),\n          label: \"This week\"\n        };\n      }\n    },\n    {\n      label: \"This month\",\n      value: \"month\",\n      getRange: () => {\n        const now = new Date();\n        const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\n        return {\n          start: startOfDay(startOfMonth),\n          end: endOfDay(now),\n          label: \"This month\"\n        };\n      }\n    }\n  ];\n\n  const handlePresetSelect = (value: string) => {\n    const preset = presetRanges.find(p => p.value === value);\n    if (preset) {\n      const range = preset.getRange();\n      onRangeChange(range);\n      setDateRange({ from: range.start, to: range.end });\n    }\n  };\n\n  const handleCustomDateSelect = (range: DateRange | undefined) => {\n    setDateRange(range);\n    if (range?.from && range?.to) {\n      onRangeChange({\n        start: startOfDay(range.from),\n        end: endOfDay(range.to),\n        label: `${format(range.from, \"MMM d\")} - ${format(range.to, \"MMM d, yyyy\")}`\n      });\n      setIsOpen(false);\n    }\n  };\n\n  return (\n    <div className={cn(\"flex items-center gap-2 font-dyslexia\", className)}>\n      {/* Preset Selector */}\n      <Select onValueChange={handlePresetSelect}>\n        <SelectTrigger className=\"w-[160px] bg-input border-border\">\n          <SelectValue placeholder=\"Quick select\" />\n        </SelectTrigger>\n        <SelectContent>\n          {presetRanges.map((preset) => (\n            <SelectItem key={preset.value} value={preset.value}>\n              {preset.label}\n            </SelectItem>\n          ))}\n        </SelectContent>\n      </Select>\n\n      {/* Custom Date Range */}\n      <Popover open={isOpen} onOpenChange={setIsOpen}>\n        <PopoverTrigger asChild>\n          <Button\n            variant=\"ghost\"\n            className={cn(\n              \"w-[280px] justify-start text-left font-normal bg-input\",\n              !dateRange && \"text-muted-foreground\"\n            )}\n          >\n            <CalendarIcon className=\"mr-2 h-4 w-4\" />\n            {dateRange?.from ? (\n              dateRange.to ? (\n                <>\n                  {format(dateRange.from, \"LLL dd, y\")} -{\" \"}\n                  {format(dateRange.to, \"LLL dd, y\")}\n                </>\n              ) : (\n                format(dateRange.from, \"LLL dd, y\")\n              )\n            ) : (\n              <span>Pick a date range</span>\n            )}\n            <ChevronDown className=\"ml-auto h-4 w-4\" />\n          </Button>\n        </PopoverTrigger>\n        <PopoverContent className=\"w-auto p-0\" align=\"start\">\n          <Calendar\n            initialFocus\n            mode=\"range\"\n            defaultMonth={dateRange?.from}\n            selected={dateRange}\n            onSelect={handleCustomDateSelect}\n            numberOfMonths={2}\n            className={cn(\"p-3 pointer-events-auto\")}\n          />\n        </PopoverContent>\n      </Popover>\n\n      {/* Current Selection Display */}\n      <div className=\"text-sm text-muted-foreground\">\n        <span className=\"hidden md:inline\">Selected: </span>\n        <span className=\"font-medium text-foreground\">{selectedRange.label}</span>\n      </div>\n    </div>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/DebugVisualization.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Debug Visualization Component\"","line":163,"column":68,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":165,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center justify-between\">\n            Debug Visualization Component\n            <Badge variant=\"outline\">Test Mode</Badge>\n          </CardTitle>","line":163,"column":68,"nodeType":"JSXText","endLine":165,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Test Mode\"","line":165,"column":38,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":165,"endColumn":47},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\">Test Mode</Badge>","line":165,"column":38,"nodeType":"JSXText","endLine":165,"endColumn":47},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotions\"","line":174,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":174,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm font-medium\">Emotions</p>","line":174,"column":54,"nodeType":"JSXText","endLine":174,"endColumn":62},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory Inputs\"","line":180,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":180,"endColumn":68},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm font-medium\">Sensory Inputs</p>","line":180,"column":54,"nodeType":"JSXText","endLine":180,"endColumn":68},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Tracking Entries\"","line":186,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":186,"endColumn":70},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm font-medium\">Tracking Entries</p>","line":186,"column":54,"nodeType":"JSXText","endLine":186,"endColumn":70},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Interactive Data Visualization Component:\"","line":194,"column":58,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":194,"endColumn":99},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-lg font-semibold mb-4\">Interactive Data Visualization Component:</h3>","line":194,"column":58,"nodeType":"JSXText","endLine":194,"endColumn":99},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"View Raw Data\"","line":205,"column":71,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":205,"endColumn":84},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <summary className=\"cursor-pointer text-sm font-medium\">View Raw Data</summary>","line":205,"column":71,"nodeType":"JSXText","endLine":205,"endColumn":84},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotions Sample:\"","line":208,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":208,"endColumn":70},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm font-medium\">Emotions Sample:</p>","line":208,"column":54,"nodeType":"JSXText","endLine":208,"endColumn":70},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory Sample:\"","line":214,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":214,"endColumn":69},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm font-medium\">Sensory Sample:</p>","line":214,"column":54,"nodeType":"JSXText","endLine":214,"endColumn":69},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Tracking Sample:\"","line":220,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":220,"endColumn":70},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm font-medium\">Tracking Sample:</p>","line":220,"column":54,"nodeType":"JSXText","endLine":220,"endColumn":70}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":20,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { InteractiveDataVisualization } from './InteractiveDataVisualization';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\n\nexport const DebugVisualization = () => {\n  // Create comprehensive mock data to test visualization\n  const mockEmotions = [\n    {\n      id: '1',\n      emotion: 'happy',\n      intensity: 4,\n      triggers: ['playtime'],\n      timestamp: new Date('2024-01-01T10:00:00'),\n      notes: 'Playing with blocks'\n    },\n    {\n      id: '2',\n      emotion: 'calm',\n      intensity: 3,\n      triggers: ['quiet time'],\n      timestamp: new Date('2024-01-01T11:00:00'),\n      notes: 'Reading a book'\n    },\n    {\n      id: '3',\n      emotion: 'anxious',\n      intensity: 4,\n      triggers: ['loud noise'],\n      timestamp: new Date('2024-01-02T09:00:00'),\n      notes: 'Fire drill'\n    },\n    {\n      id: '4',\n      emotion: 'happy',\n      intensity: 5,\n      triggers: ['friend visit'],\n      timestamp: new Date('2024-01-02T14:00:00'),\n      notes: 'Playing with friend'\n    },\n    {\n      id: '5',\n      emotion: 'calm',\n      intensity: 2,\n      triggers: ['music'],\n      timestamp: new Date('2024-01-03T10:00:00'),\n      notes: 'Listening to calming music'\n    }\n  ];\n\n  const mockSensoryInputs = [\n    {\n      id: '1',\n      type: 'visual',\n      sensoryType: 'visual',\n      response: 'seeking',\n      intensity: 3,\n      timestamp: new Date('2024-01-01T10:30:00'),\n      notes: 'Looking at colorful pictures'\n    },\n    {\n      id: '2',\n      type: 'auditory',\n      sensoryType: 'auditory',\n      response: 'avoiding',\n      intensity: 4,\n      timestamp: new Date('2024-01-01T11:30:00'),\n      notes: 'Loud noise from outside'\n    },\n    {\n      id: '3',\n      type: 'tactile',\n      sensoryType: 'tactile',\n      response: 'seeking',\n      intensity: 5,\n      timestamp: new Date('2024-01-02T10:00:00'),\n      notes: 'Playing with sensory toys'\n    },\n    {\n      id: '4',\n      type: 'vestibular',\n      sensoryType: 'vestibular',\n      response: 'seeking',\n      intensity: 4,\n      timestamp: new Date('2024-01-02T15:00:00'),\n      notes: 'Swinging on playground'\n    },\n    {\n      id: '5',\n      type: 'visual',\n      sensoryType: 'visual',\n      response: 'avoiding',\n      intensity: 3,\n      timestamp: new Date('2024-01-03T09:00:00'),\n      notes: 'Bright lights in classroom'\n    }\n  ];\n\n  const mockTrackingEntries = [\n    {\n      id: '1',\n      timestamp: new Date('2024-01-01T10:00:00'),\n      emotions: ['happy'],\n      sensoryInputs: ['visual'],\n      environmentalData: {\n        location: 'classroom',\n        noiseLevel: 3,\n        lighting: 'natural',\n        temperature: 22,\n        weather: 'sunny',\n        classroom: {\n          activity: 'free play',\n          numberOfPeople: 12,\n          structureLevel: 'low'\n        }\n      },\n      notes: 'Morning session'\n    },\n    {\n      id: '2',\n      timestamp: new Date('2024-01-02T09:00:00'),\n      emotions: ['anxious'],\n      sensoryInputs: ['auditory'],\n      environmentalData: {\n        location: 'playground',\n        noiseLevel: 8,\n        lighting: 'bright',\n        temperature: 18,\n        weather: 'cloudy',\n        classroom: {\n          activity: 'group activity',\n          numberOfPeople: 20,\n          structureLevel: 'medium'\n        }\n      },\n      notes: 'Fire drill disruption'\n    },\n    {\n      id: '3',\n      timestamp: new Date('2024-01-03T10:00:00'),\n      emotions: ['calm'],\n      sensoryInputs: ['visual'],\n      environmentalData: {\n        location: 'sensory room',\n        noiseLevel: 2,\n        lighting: 'dim',\n        temperature: 21,\n        weather: 'rainy',\n        classroom: {\n          activity: 'quiet time',\n          numberOfPeople: 3,\n          structureLevel: 'high'\n        }\n      },\n      notes: 'Sensory break'\n    }\n  ];\n\n  return (\n    <div className=\"space-y-6 p-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center justify-between\">\n            Debug Visualization Component\n            <Badge variant=\"outline\">Test Mode</Badge>\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            {/* Debug info */}\n            <div className=\"grid grid-cols-3 gap-4 mb-4\">\n              <Card>\n                <CardContent className=\"pt-4\">\n                  <p className=\"text-sm font-medium\">Emotions</p>\n                  <p className=\"text-2xl font-bold\">{mockEmotions.length}</p>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardContent className=\"pt-4\">\n                  <p className=\"text-sm font-medium\">Sensory Inputs</p>\n                  <p className=\"text-2xl font-bold\">{mockSensoryInputs.length}</p>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardContent className=\"pt-4\">\n                  <p className=\"text-sm font-medium\">Tracking Entries</p>\n                  <p className=\"text-2xl font-bold\">{mockTrackingEntries.length}</p>\n                </CardContent>\n              </Card>\n            </div>\n\n            {/* Render the actual visualization component */}\n            <div className=\"border rounded-lg p-4\">\n              <h3 className=\"text-lg font-semibold mb-4\">Interactive Data Visualization Component:</h3>\n              <InteractiveDataVisualization\n                emotions={mockEmotions}\n                sensoryInputs={mockSensoryInputs}\n                trackingEntries={mockTrackingEntries}\n                studentName=\"Test Student (Debug Mode)\"\n              />\n            </div>\n\n            {/* Data preview */}\n            <details className=\"mt-4\">\n              <summary className=\"cursor-pointer text-sm font-medium\">View Raw Data</summary>\n              <div className=\"mt-2 space-y-2\">\n                <div>\n                  <p className=\"text-sm font-medium\">Emotions Sample:</p>\n                  <pre className=\"text-xs bg-muted p-2 rounded overflow-auto max-h-32\">\n                    {JSON.stringify(mockEmotions[0], null, 2)}\n                  </pre>\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium\">Sensory Sample:</p>\n                  <pre className=\"text-xs bg-muted p-2 rounded overflow-auto max-h-32\">\n                    {JSON.stringify(mockSensoryInputs[0], null, 2)}\n                  </pre>\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium\">Tracking Sample:</p>\n                  <pre className=\"text-xs bg-muted p-2 rounded overflow-auto max-h-32\">\n                    {JSON.stringify(mockTrackingEntries[0], null, 2)}\n                  </pre>\n                </div>\n              </div>\n            </details>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/DetailedConfidenceExplanation.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"R² =\"","line":207,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":208,"endColumn":22},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-muted-foreground\">\n                R² = {rSquared.toFixed(3)}\n              </div>","line":207,"column":62,"nodeType":"JSXText","endLine":208,"endColumn":22},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"70-100%\"","line":271,"column":95,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":273,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"40-69%\"","line":279,"column":91,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":281,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"0-39%\"","line":287,"column":93,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":289,"endColumn":17},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":393,"column":36,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":393,"endColumn":41},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":410,"column":30,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":410,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from '@/components/ui/collapsible';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { \n  ChevronDown, \n  ChevronUp, \n  Calculator, \n  TrendingUp, \n  Database, \n  Calendar,\n  AlertCircle,\n  CheckCircle,\n  Target,\n  BookOpen,\n  Info\n} from 'lucide-react';\n\ninterface DetailedConfidenceExplanationProps {\n  confidence: number;\n  dataPoints: number;\n  timeSpanDays: number;\n  rSquared: number;\n  minDataPoints?: number;\n  recommendedTimeSpan?: number;\n}\n\nexport const DetailedConfidenceExplanation: React.FC<DetailedConfidenceExplanationProps> = ({\n  confidence,\n  dataPoints,\n  timeSpanDays,\n  rSquared,\n  minDataPoints = 10,\n  recommendedTimeSpan = 21\n}) => {\n  const { tAnalytics } = useTranslation();\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  const getConfidenceLevel = (): 'low' | 'medium' | 'high' => {\n    if (confidence >= 0.7) return 'high';\n    if (confidence >= 0.4) return 'medium';\n    return 'low';\n  };\n\n  const getDataQualityScore = () => {\n    const dataScore = Math.min(dataPoints / minDataPoints, 1) * 100;\n    const timeScore = Math.min(timeSpanDays / recommendedTimeSpan, 1) * 100;\n    return {\n      dataScore: Math.round(dataScore),\n      timeScore: Math.round(timeScore),\n      overallScore: Math.round((dataScore + timeScore) / 2)\n    };\n  };\n\n  const getPatternStrength = () => {\n    if (rSquared >= 0.7) return { level: 'strong', score: Math.round(rSquared * 100) };\n    if (rSquared >= 0.4) return { level: 'moderate', score: Math.round(rSquared * 100) };\n    return { level: 'weak', score: Math.round(rSquared * 100) };\n  };\n\n  const getConfidenceFactors = () => {\n    const factors = [];\n    \n    if (dataPoints < minDataPoints) {\n      factors.push({\n        type: 'warning',\n        title: String(tAnalytics('confidence.factors.insufficientData.title')),\n        description: String(tAnalytics('confidence.factors.insufficientData.description', { \n          current: dataPoints, \n          needed: minDataPoints \n        })),\n        impact: 'high',\n        actionable: true\n      });\n    } else {\n      factors.push({\n        type: 'success',\n        title: String(tAnalytics('confidence.factors.sufficientData.title')),\n        description: String(tAnalytics('confidence.factors.sufficientData.description', { \n          count: dataPoints \n        })),\n        impact: 'positive',\n        actionable: false\n      });\n    }\n\n    if (timeSpanDays < recommendedTimeSpan) {\n      factors.push({\n        type: 'warning',\n        title: String(tAnalytics('confidence.factors.shortTimespan.title')),\n        description: String(tAnalytics('confidence.factors.shortTimespan.description', { \n          current: timeSpanDays, \n          recommended: recommendedTimeSpan \n        })),\n        impact: 'medium',\n        actionable: true\n      });\n    } else {\n      factors.push({\n        type: 'success',\n        title: String(tAnalytics('confidence.factors.adequateTimespan.title')),\n        description: String(tAnalytics('confidence.factors.adequateTimespan.description', { \n          days: timeSpanDays \n        })),\n        impact: 'positive',\n        actionable: false\n      });\n    }\n\n    const patternStrength = getPatternStrength();\n    if (patternStrength.level === 'weak') {\n      factors.push({\n        type: 'info',\n        title: String(tAnalytics('confidence.factors.weakPattern.title')),\n        description: String(tAnalytics('confidence.factors.weakPattern.description', { \n          rsquared: rSquared.toFixed(3),\n          percentage: patternStrength.score \n        })),\n        impact: 'medium',\n        actionable: true\n      });\n    } else {\n      factors.push({\n        type: 'success',\n        title: String(tAnalytics(`confidence.factors.${patternStrength.level}Pattern.title`)),\n        description: String(tAnalytics(`confidence.factors.${patternStrength.level}Pattern.description`, { \n          rsquared: rSquared.toFixed(3),\n          percentage: patternStrength.score \n        })),\n        impact: 'positive',\n        actionable: false\n      });\n    }\n\n    return factors;\n  };\n\n  const getActionableRecommendations = () => {\n    const recommendations = [];\n    \n    if (dataPoints < minDataPoints) {\n      recommendations.push(String(tAnalytics('confidence.recommendations.collectMoreData', { \n        needed: minDataPoints - dataPoints \n      })));\n    }\n    \n    if (timeSpanDays < recommendedTimeSpan) {\n      recommendations.push(String(tAnalytics('confidence.recommendations.extendTimespan', { \n        additional: recommendedTimeSpan - timeSpanDays \n      })));\n    }\n    \n    if (rSquared < 0.4) {\n      recommendations.push(String(tAnalytics('confidence.recommendations.improveDataConsistency')));\n      recommendations.push(String(tAnalytics('confidence.recommendations.documentContext')));\n    }\n    \n    return recommendations;\n  };\n\n  const renderCalculationBreakdown = () => {\n    const qualityScores = getDataQualityScore();\n    const patternStrength = getPatternStrength();\n    \n    return (\n      <div className=\"space-y-4\">\n        <div className=\"text-sm font-medium\">{String(tAnalytics('confidence.calculation.title'))}</div>\n        \n        <div className=\"space-y-3\">\n          <div className=\"flex items-center justify-between p-3 bg-muted/50 rounded-lg\">\n            <div className=\"flex items-center gap-2\">\n              <Database className=\"h-4 w-4\" />\n              <span className=\"text-sm\">{String(tAnalytics('confidence.calculation.dataQuantity'))}</span>\n            </div>\n            <div className=\"text-right\">\n              <div className=\"text-sm font-medium\">{qualityScores.dataScore}%</div>\n              <div className=\"text-xs text-muted-foreground\">\n                {dataPoints}/{minDataPoints} {String(tAnalytics('confidence.calculation.dataPoints'))}\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"flex items-center justify-between p-3 bg-muted/50 rounded-lg\">\n            <div className=\"flex items-center gap-2\">\n              <Calendar className=\"h-4 w-4\" />\n              <span className=\"text-sm\">{String(tAnalytics('confidence.calculation.timeSpan'))}</span>\n            </div>\n            <div className=\"text-right\">\n              <div className=\"text-sm font-medium\">{qualityScores.timeScore}%</div>\n              <div className=\"text-xs text-muted-foreground\">\n                {timeSpanDays}/{recommendedTimeSpan} {String(tAnalytics('confidence.calculation.days'))}\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"flex items-center justify-between p-3 bg-muted/50 rounded-lg\">\n            <div className=\"flex items-center gap-2\">\n              <TrendingUp className=\"h-4 w-4\" />\n              <span className=\"text-sm\">{String(tAnalytics('confidence.calculation.patternStrength'))}</span>\n            </div>\n            <div className=\"text-right\">\n              <div className=\"text-sm font-medium\">{patternStrength.score}%</div>\n              <div className=\"text-xs text-muted-foreground\">\n                R² = {rSquared.toFixed(3)}\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"border-t pt-3\">\n          <div className=\"flex items-center justify-between p-3 bg-primary/10 rounded-lg\">\n            <div className=\"flex items-center gap-2\">\n              <Calculator className=\"h-4 w-4\" />\n              <span className=\"text-sm font-medium\">{String(tAnalytics('confidence.calculation.overall'))}</span>\n            </div>\n            <div className=\"text-right\">\n              <div className=\"text-lg font-bold\">{Math.round(confidence * 100)}%</div>\n              <div className=\"text-xs text-muted-foreground\">\n                {String(tAnalytics(`confidence.${getConfidenceLevel()}`))}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  const renderEducationalContent = () => {\n    return (\n      <div className=\"space-y-4\">\n        <div className=\"text-sm font-medium\">{String(tAnalytics('confidence.education.title'))}</div>\n        \n        <div className=\"space-y-3\">\n          <Card>\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-sm flex items-center gap-2\">\n                <Info className=\"h-4 w-4\" />\n                {String(tAnalytics('confidence.education.whatIsConfidence.title'))}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"pt-0 text-sm text-muted-foreground\">\n              {String(tAnalytics('confidence.education.whatIsConfidence.content'))}\n            </CardContent>\n          </Card>\n          \n          <Card>\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-sm flex items-center gap-2\">\n                <Target className=\"h-4 w-4\" />\n                {String(tAnalytics('confidence.education.whyItMatters.title'))}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"pt-0 text-sm text-muted-foreground\">\n              {String(tAnalytics('confidence.education.whyItMatters.content'))}\n            </CardContent>\n          </Card>\n          \n          <Card>\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-sm flex items-center gap-2\">\n                <BookOpen className=\"h-4 w-4\" />\n                {String(tAnalytics('confidence.education.interpretation.title'))}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"pt-0 space-y-2\">\n              <div className=\"text-xs\">\n                <Badge variant=\"outline\" className=\"text-emerald-600 border-emerald-200 mr-2\">\n                  70-100%\n                </Badge>\n                <span className=\"text-muted-foreground\">\n                  {String(tAnalytics('confidence.education.interpretation.high'))}\n                </span>\n              </div>\n              <div className=\"text-xs\">\n                <Badge variant=\"outline\" className=\"text-amber-600 border-amber-200 mr-2\">\n                  40-69%\n                </Badge>\n                <span className=\"text-muted-foreground\">\n                  {String(tAnalytics('confidence.education.interpretation.medium'))}\n                </span>\n              </div>\n              <div className=\"text-xs\">\n                <Badge variant=\"outline\" className=\"text-orange-600 border-orange-200 mr-2\">\n                  0-39%\n                </Badge>\n                <span className=\"text-muted-foreground\">\n                  {String(tAnalytics('confidence.education.interpretation.low'))}\n                </span>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  };\n\n  const confidenceFactors = getConfidenceFactors();\n  const recommendations = getActionableRecommendations();\n  const qualityScores = getDataQualityScore();\n\n  return (\n    <Card className=\"w-full\">\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"text-lg flex items-center gap-2\">\n            <Calculator className=\"h-5 w-5\" />\n            {String(tAnalytics('confidence.detailed.title'))}\n          </CardTitle>\n          <div className=\"flex items-center gap-2\">\n            <Badge \n              variant=\"outline\" \n              className={\n                getConfidenceLevel() === 'high' ? 'text-emerald-600 border-emerald-200' :\n                getConfidenceLevel() === 'medium' ? 'text-amber-600 border-amber-200' :\n                'text-orange-600 border-orange-200'\n              }\n            >\n              {Math.round(confidence * 100)}% {String(tAnalytics(`confidence.${getConfidenceLevel()}`))}\n            </Badge>\n            <Collapsible open={isExpanded} onOpenChange={setIsExpanded}>\n              <CollapsibleTrigger asChild>\n                <Button variant=\"ghost\" size=\"sm\">\n                  {isExpanded ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\n                </Button>\n              </CollapsibleTrigger>\n            </Collapsible>\n          </div>\n        </div>\n      </CardHeader>\n      \n      <Collapsible open={isExpanded} onOpenChange={setIsExpanded}>\n        <CollapsibleContent>\n          <CardContent>\n            <Tabs defaultValue=\"overview\" className=\"w-full\">\n              <TabsList className=\"grid w-full grid-cols-4\">\n                <TabsTrigger value=\"overview\">{String(tAnalytics('confidence.tabs.overview'))}</TabsTrigger>\n                <TabsTrigger value=\"calculation\">{String(tAnalytics('confidence.tabs.calculation'))}</TabsTrigger>\n                <TabsTrigger value=\"factors\">{String(tAnalytics('confidence.tabs.factors'))}</TabsTrigger>\n                <TabsTrigger value=\"education\">{String(tAnalytics('confidence.tabs.education'))}</TabsTrigger>\n              </TabsList>\n              \n              <TabsContent value=\"overview\" className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-sm\">{String(tAnalytics('confidence.overview.dataQuality'))}</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <Progress value={qualityScores.overallScore} className=\"mb-2\" />\n                      <div className=\"text-xs text-muted-foreground\">\n                        {qualityScores.overallScore}% {String(tAnalytics('confidence.overview.complete'))}\n                      </div>\n                    </CardContent>\n                  </Card>\n                  \n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-sm\">{String(tAnalytics('confidence.overview.timespan'))}</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-lg font-bold\">{timeSpanDays}</div>\n                      <div className=\"text-xs text-muted-foreground\">\n                        {String(tAnalytics('confidence.overview.daysOfData'))}\n                      </div>\n                    </CardContent>\n                  </Card>\n                  \n                  <Card>\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-sm\">{String(tAnalytics('confidence.overview.patterns'))}</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"text-lg font-bold\">{getPatternStrength().score}%</div>\n                      <div className=\"text-xs text-muted-foreground\">\n                        {String(tAnalytics(`confidence.overview.${getPatternStrength().level}Pattern`))}\n                      </div>\n                    </CardContent>\n                  </Card>\n                </div>\n                \n                {recommendations.length > 0 && (\n                  <Card>\n                    <CardHeader>\n                      <CardTitle className=\"text-sm\">{String(tAnalytics('confidence.overview.recommendations'))}</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <ul className=\"space-y-2\">\n                        {recommendations.map((rec, index) => (\n                          <li key={index} className=\"flex items-start gap-2 text-sm\">\n                            <Target className=\"h-4 w-4 mt-0.5 text-primary\" />\n                            <span>{rec}</span>\n                          </li>\n                        ))}\n                      </ul>\n                    </CardContent>\n                  </Card>\n                )}\n              </TabsContent>\n              \n              <TabsContent value=\"calculation\">\n                {renderCalculationBreakdown()}\n              </TabsContent>\n              \n              <TabsContent value=\"factors\" className=\"space-y-4\">\n                {confidenceFactors.map((factor, index) => (\n                  <Card key={index}>\n                    <CardHeader className=\"pb-2\">\n                      <CardTitle className=\"text-sm flex items-center gap-2\">\n                        {factor.type === 'success' ? (\n                          <CheckCircle className=\"h-4 w-4 text-emerald-600\" />\n                        ) : factor.type === 'warning' ? (\n                          <AlertCircle className=\"h-4 w-4 text-amber-600\" />\n                        ) : (\n                          <Info className=\"h-4 w-4 text-blue-600\" />\n                        )}\n                        {factor.title}\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"pt-0\">\n                      <p className=\"text-sm text-muted-foreground\">{factor.description}</p>\n                    </CardContent>\n                  </Card>\n                ))}\n              </TabsContent>\n              \n              <TabsContent value=\"education\">\n                {renderEducationalContent()}\n              </TabsContent>\n            </Tabs>\n          </CardContent>\n        </CollapsibleContent>\n      </Collapsible>\n    </Card>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/DevErrorBanner.tsx","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":2,"message":"Unexpected console statement.","line":26,"column":36,"nodeType":"MemberExpression","messageId":"unexpected","endLine":26,"endColumn":49,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":2,"message":"Unexpected console statement.","line":27,"column":5,"nodeType":"MemberExpression","messageId":"unexpected","endLine":27,"endColumn":18,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":73,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":73,"endColumn":52,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":74,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":74,"endColumn":72,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":2,"message":"Unexpected console statement.","line":79,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":79,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/EmotionTracker.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Specific Feeling (Optional)\"","line":131,"column":70,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":131,"endColumn":97},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-sm font-medium text-foreground mb-3\">Specific Feeling (Optional)</h3>","line":131,"column":70,"nodeType":"JSXText","endLine":131,"endColumn":97},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"/5\"","line":161,"column":69,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":162,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Duration (minutes)\"","line":187,"column":70,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":187,"endColumn":88},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-sm font-medium text-foreground mb-3\">Duration (minutes)</h3>","line":187,"column":70,"nodeType":"JSXText","endLine":187,"endColumn":88},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"How did it develop?\"","line":232,"column":70,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":232,"endColumn":89},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-sm font-medium text-foreground mb-3\">How did it develop?</h3>","line":232,"column":70,"nodeType":"JSXText","endLine":232,"endColumn":89},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sudden\"","line":239,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":241,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n                variant={escalationPattern === 'sudden' ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setEscalationPattern('sudden')}\n                className=\"font-dyslexia\"\n              >\n                Sudden\n              </Button>","line":239,"column":16,"nodeType":"JSXText","endLine":241,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Gradual\"","line":247,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":249,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n                variant={escalationPattern === 'gradual' ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setEscalationPattern('gradual')}\n                className=\"font-dyslexia\"\n              >\n                Gradual\n              </Button>","line":247,"column":16,"nodeType":"JSXText","endLine":249,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Unknown\"","line":255,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":257,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n                variant={escalationPattern === 'unknown' ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setEscalationPattern('unknown')}\n                className=\"font-dyslexia\"\n              >\n                Unknown\n              </Button>","line":255,"column":16,"nodeType":"JSXText","endLine":257,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Utløsere (Valgfritt)\"","line":264,"column":68,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":264,"endColumn":88},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-sm font-medium text-foreground mb-3\">Utløsere (Valgfritt)</h3>","line":264,"column":68,"nodeType":"JSXText","endLine":264,"endColumn":88},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"×\"","line":287,"column":26,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":288,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":16,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { EmotionEntry } from \"@/types/student\";\nimport { Heart, Frown, Angry, Smile, Zap, Sun } from \"lucide-react\";\nimport { useTranslation } from \"@/hooks/useTranslation\";\nimport { logger } from '@/lib/logger';\n\ninterface EmotionTrackerProps {\n  onEmotionAdd: (emotion: Omit<EmotionEntry, 'id' | 'timestamp'>) => void;\n  studentId: string;\n}\n\nconst emotions = [\n  { type: 'happy' as const, icon: Smile, color: 'emotion-happy' },\n  { type: 'calm' as const, icon: Heart, color: 'emotion-calm' },\n  { type: 'excited' as const, icon: Zap, color: 'emotion-excited' },\n  { type: 'sad' as const, icon: Frown, color: 'emotion-sad' },\n  { type: 'anxious' as const, icon: Sun, color: 'emotion-anxious' },\n  { type: 'angry' as const, icon: Angry, color: 'emotion-angry' },\n];\n\n// Sub-emotions for each primary emotion\nconst subEmotions: Record<string, string[]> = {\n  happy: ['joyful', 'content', 'cheerful', 'pleased', 'delighted'],\n  calm: ['peaceful', 'relaxed', 'serene', 'tranquil', 'centered'],\n  excited: ['energetic', 'enthusiastic', 'thrilled', 'eager', 'animated'],\n  sad: ['disappointed', 'lonely', 'grieving', 'melancholy', 'dejected'],\n  anxious: ['worried', 'nervous', 'fearful', 'stressed', 'panicked'],\n  angry: ['frustrated', 'irritated', 'furious', 'annoyed', 'resentful']\n};\n\n/**\n * EmotionTracker Component\n * \n * Provides an accessible interface for tracking and recording student emotions\n * with intensity levels, triggers, and contextual information.\n * \n * @component\n * @param {EmotionTrackerProps} props - Component props\n * @param {Function} props.onEmotionAdd - Callback when emotion is added\n * @param {string} props.studentId - ID of the student being tracked\n */\nexport const EmotionTracker = ({ onEmotionAdd, studentId }: EmotionTrackerProps) => {\n  const { tTracking, tCommon } = useTranslation();\n  const [selectedEmotion, setSelectedEmotion] = useState<string>('');\n  const [selectedSubEmotion, setSelectedSubEmotion] = useState<string>('');\n  const [intensity, setIntensity] = useState<number>(3);\n  const [duration, setDuration] = useState<number>(0);\n  const [escalationPattern, setEscalationPattern] = useState<'sudden' | 'gradual' | 'unknown'>('unknown');\n  const [notes, setNotes] = useState('');\n  const [triggers, setTriggers] = useState<string[]>([]);\n  const [newTrigger, setNewTrigger] = useState('');\n\n  const handleAddTrigger = () => {\n    if (newTrigger.trim() && !triggers.includes(newTrigger.trim())) {\n      setTriggers([...triggers, newTrigger.trim()]);\n      setNewTrigger('');\n    }\n  };\n\n  const handleRemoveTrigger = (trigger: string) => {\n    setTriggers(triggers.filter(t => t !== trigger));\n  };\n\n  const handleSubmit = () => {\n    if (!selectedEmotion) {\n      logger.warn('Attempted to submit emotion without selection');\n      return;\n    }\n\n    onEmotionAdd({\n      studentId,\n      emotion: selectedEmotion as EmotionEntry['emotion'],\n      subEmotion: selectedSubEmotion || undefined,\n      intensity: intensity as EmotionEntry['intensity'],\n      duration: duration > 0 ? duration : undefined,\n      escalationPattern: escalationPattern !== 'unknown' ? escalationPattern : undefined,\n      notes: notes.trim() || undefined,\n      triggers: triggers.length > 0 ? triggers : undefined,\n    });\n\n    // Reset form\n    setSelectedEmotion('');\n    setSelectedSubEmotion('');\n    setIntensity(3);\n    setDuration(0);\n    setEscalationPattern('unknown');\n    setNotes('');\n    setTriggers([]);\n  };\n\n  return (\n    <Card className=\"font-dyslexia bg-gradient-card border-0\">\n      <CardHeader>\n        <CardTitle className=\"text-xl text-foreground\">{String(tTracking('emotions.title'))}</CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        {/* Emotion Selection */}\n        <div>\n          <h3 className=\"text-sm font-medium text-foreground mb-3\">{String(tTracking('emotions.selectEmotion'))}</h3>\n          <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\n            {emotions.map((emotion) => {\n              const Icon = emotion.icon;\n              return (\n                <Button\n                  key={emotion.type}\n                  variant={selectedEmotion === emotion.type ? \"default\" : \"outline\"}\n                  className={`h-20 flex-col gap-2 font-dyslexia hover-lift press-scale transition-all duration-300 ${\n                    selectedEmotion === emotion.type \n                      ? 'bg-gradient-primary shadow-glow animate-bounce-in' \n                      : 'hover:scale-105 animate-fade-in hover:shadow-soft'\n                  }`}\n                  onClick={() => setSelectedEmotion(emotion.type)}\n                  aria-label={`Select ${String(tTracking(`emotions.types.${emotion.type}`))}`}\n                  aria-pressed={selectedEmotion === emotion.type}\n                >\n                  <Icon className=\"h-6 w-6 transform transition-transform duration-200 hover:scale-110\" />\n                  <span className=\"text-sm\">{String(tTracking(`emotions.types.${emotion.type}`))}</span>\n                </Button>\n              );\n            })}\n          </div>\n        </div>\n\n        {/* Sub-emotion Selection */}\n        {selectedEmotion && subEmotions[selectedEmotion] && (\n          <div>\n            <h3 className=\"text-sm font-medium text-foreground mb-3\">Specific Feeling (Optional)</h3>\n            <div className=\"flex flex-wrap gap-2\">\n              {subEmotions[selectedEmotion].map((subEmotion) => (\n                <Badge\n                  key={subEmotion}\n                  variant={selectedSubEmotion === subEmotion ? \"default\" : \"outline\"}\n                  className=\"cursor-pointer font-dyslexia hover-lift transition-all duration-200\"\n                  onClick={() => setSelectedSubEmotion(selectedSubEmotion === subEmotion ? '' : subEmotion)}\n                  role=\"button\"\n                  tabIndex={0}\n                  aria-pressed={selectedSubEmotion === subEmotion}\n                  aria-label={`Select ${subEmotion}`}\n                  onKeyDown={(e) => {\n                    if (e.key === 'Enter' || e.key === ' ') {\n                      e.preventDefault();\n                      setSelectedSubEmotion(selectedSubEmotion === subEmotion ? '' : subEmotion);\n                    }\n                  }}\n                >\n                  {subEmotion}\n                </Badge>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Intensity Scale */}\n        {selectedEmotion && (\n          <div>\n            <h3 className=\"text-sm font-medium text-foreground mb-3\">\n              {String(tTracking('emotions.intensity'))}: {intensity}/5\n            </h3>\n            <div className=\"flex gap-2\">\n              {[1, 2, 3, 4, 5].map((level) => (\n                <Button\n                  key={level}\n                  variant={intensity === level ? \"default\" : \"outline\"}\n                  size=\"sm\"\n                  className={`w-12 h-12 rounded-full font-dyslexia hover-lift press-scale transition-all duration-200 hover:shadow-soft ${\n                    intensity === level ? 'bg-gradient-primary animate-bounce-in' : ''\n                  }`}\n                  onClick={() => setIntensity(level)}\n                  title={String(tTracking(`emotions.intensityLevels.${level}`))}\n                  aria-label={`Intensity level ${level}`}\n                  aria-pressed={intensity === level}\n                >\n                  {level}\n                </Button>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Duration */}\n        {selectedEmotion && (\n          <div>\n            <h3 className=\"text-sm font-medium text-foreground mb-3\">Duration (minutes)</h3>\n            <div className=\"flex gap-2\">\n              <input\n                type=\"number\"\n                value={duration}\n                onChange={(e) => {\n                  const value = e.target.value;\n                  // Allow empty string for better UX while typing\n                  if (value === '') {\n                    setDuration(0);\n                    return;\n                  }\n                  // Parse and validate the number\n                  const parsed = parseInt(value, 10);\n                  if (!isNaN(parsed)) {\n                    setDuration(Math.max(0, Math.min(999, parsed))); // Cap at 999 minutes\n                  }\n                }}\n                placeholder=\"How long did it last?\"\n                className=\"w-32 px-3 py-2 border border-border rounded-lg font-dyslexia bg-input focus:ring-2 focus:ring-ring focus:border-transparent\"\n                min=\"0\"\n                max=\"999\"\n                aria-label=\"Duration in minutes\"\n                aria-describedby=\"duration-help\"\n              />\n              <div className=\"flex gap-1\">\n                {[5, 15, 30, 60].map((minutes) => (\n                  <Button\n                    key={minutes}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setDuration(minutes)}\n                    className=\"font-dyslexia\"\n                  >\n                    {minutes < 60 ? `${minutes}m` : '1h'}\n                  </Button>\n                ))}\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Escalation Pattern */}\n        {selectedEmotion && (\n          <div>\n            <h3 className=\"text-sm font-medium text-foreground mb-3\">How did it develop?</h3>\n            <div className=\"flex gap-2\">\n              <Button\n                variant={escalationPattern === 'sudden' ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setEscalationPattern('sudden')}\n                className=\"font-dyslexia\"\n              >\n                Sudden\n              </Button>\n              <Button\n                variant={escalationPattern === 'gradual' ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setEscalationPattern('gradual')}\n                className=\"font-dyslexia\"\n              >\n                Gradual\n              </Button>\n              <Button\n                variant={escalationPattern === 'unknown' ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setEscalationPattern('unknown')}\n                className=\"font-dyslexia\"\n              >\n                Unknown\n              </Button>\n            </div>\n          </div>\n        )}\n\n        {/* Triggers */}\n        <div>\n          <h3 className=\"text-sm font-medium text-foreground mb-3\">Utløsere (Valgfritt)</h3>\n          <div className=\"flex gap-2 mb-2\">\n            <input\n              type=\"text\"\n              value={newTrigger}\n              onChange={(e) => setNewTrigger(e.target.value)}\n              onKeyPress={(e) => e.key === 'Enter' && handleAddTrigger()}\n              placeholder=\"Legg til en utløser...\"\n              aria-label=\"Legg til ny utløser\"\n              className=\"flex-1 px-3 py-2 border border-border rounded-lg font-dyslexia bg-input focus:ring-2 focus:ring-ring focus:border-transparent\"\n            />\n            <Button onClick={handleAddTrigger} size=\"sm\" variant=\"outline\">\n              {String(tCommon('buttons.add'))}\n            </Button>\n          </div>\n          <div className=\"flex flex-wrap gap-2\">\n            {triggers.map((trigger) => (\n              <Badge\n                key={trigger}\n                variant=\"secondary\"\n                className=\"font-dyslexia cursor-pointer\"\n                onClick={() => handleRemoveTrigger(trigger)}\n              >\n                {trigger} ×\n              </Badge>\n            ))}\n          </div>\n        </div>\n\n        {/* Notes */}\n        <div>\n          <h3 className=\"text-sm font-medium text-foreground mb-3\">{String(tTracking('emotions.notes'))}</h3>\n          <Textarea\n            value={notes}\n            onChange={(e) => setNotes(e.target.value)}\n            placeholder=\"Ytterligere observasjoner...\"\n            className=\"font-dyslexia bg-input border-border focus:ring-ring\"\n            rows={3}\n          />\n        </div>\n\n        <Button \n          onClick={handleSubmit}\n          disabled={!selectedEmotion}\n          className=\"w-full font-dyslexia bg-gradient-primary hover:opacity-90 transition-all duration-200\"\n        >\n          {String(tTracking('emotions.addEmotion'))}\n        </Button>\n      </CardContent>\n    </Card>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/EnhancedDataVisualization.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardContent' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardHeader' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardTitle' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":41,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Tooltip' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TooltipContent' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TooltipProvider' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":50},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TooltipTrigger' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":52,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":66},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnimatePresence' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LineChart' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Line' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedSeries' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":53,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":53,"endColumn":26},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'uniqueKeys' conditional could make the dependencies of useEffect Hook (at line 63) change on every render. To fix this, wrap the initialization of 'uniqueKeys' in its own useMemo() Hook.","line":59,"column":11,"nodeType":"VariableDeclarator","endLine":59,"endColumn":105},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No data to display\"","line":70,"column":63,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":70,"endColumn":81},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-lg font-semibold\">No data to display</h3>","line":70,"column":63,"nodeType":"JSXText","endLine":70,"endColumn":81},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"There is no\"","line":71,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":71,"endColumn":60},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm\">There is no {dataType} data available for {studentName}.</p>","line":71,"column":48,"nodeType":"JSXText","endLine":71,"endColumn":60},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"data available for\"","line":71,"column":70,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":71,"endColumn":90},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm\">There is no {dataType} data available for {studentName}.</p>","line":71,"column":70,"nodeType":"JSXText","endLine":71,"endColumn":90},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \".\"","line":71,"column":103,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":71,"endColumn":104},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Enhanced Data Insights for\"","line":86,"column":77,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":86,"endColumn":104},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-2xl font-bold text-card-foreground\">Enhanced Data Insights for {studentName}</h2>","line":86,"column":77,"nodeType":"JSXText","endLine":86,"endColumn":104},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Displaying\"","line":87,"column":58,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":87,"endColumn":69},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">Displaying {dataType}</p>","line":87,"column":58,"nodeType":"JSXText","endLine":87,"endColumn":69},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotions\"","line":90,"column":129,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":90,"endColumn":137},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button onClick={() => setDataType('emotions')} variant={dataType === 'emotions' ? 'default' : 'secondary'}>Emotions</Button>","line":90,"column":129,"nodeType":"JSXText","endLine":90,"endColumn":137},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory\"","line":91,"column":127,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":91,"endColumn":134},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button onClick={() => setDataType('sensory')} variant={dataType === 'sensory' ? 'default' : 'secondary'}>Sensory</Button>","line":91,"column":127,"nodeType":"JSXText","endLine":91,"endColumn":134}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":27,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React, { useState, useMemo, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';\nimport { EmotionEntry, SensoryEntry } from '@/types/student';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip as RechartsTooltip, ResponsiveContainer, AreaChart, Area } from 'recharts';\nimport { useTheme } from 'next-themes'; // Assuming next-themes for theme management\n\ninterface DataPoint {\n    date: string;\n    [key: string]: number | string;\n}\n\ninterface EnhancedDataVisualizationProps {\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  studentName: string;\n}\n\nconst processChartData = (entries: (EmotionEntry | SensoryEntry)[], type: 'emotions' | 'sensory', days: number = 30): DataPoint[] => {\n    if (!entries || entries.length === 0) return [];\n\n    const dataMap = new Map<string, DataPoint>();\n    const nameKey = type === 'emotions' ? 'emotion' : 'sensoryType';\n    const uniqueNames = [...new Set(entries.map(e => e[nameKey]))];\n\n    for (let i = 0; i < days; i++) {\n        const date = new Date();\n        date.setDate(date.getDate() - i);\n        const dateString = date.toISOString().split('T')[0];\n        const dailyData: DataPoint = { date: dateString };\n        uniqueNames.forEach(name => { dailyData[name] = 0; });\n        dataMap.set(dateString, dailyData);\n    }\n\n    entries.forEach(entry => {\n        const dateString = new Date(entry.timestamp).toISOString().split('T')[0];\n        if (dataMap.has(dateString)) {\n            const dayData = dataMap.get(dateString)!;\n            const name = entry[nameKey];\n            dayData[name] = (dayData[name] as number || 0) + (entry.intensity || 1);\n        }\n    });\n\n    return Array.from(dataMap.values()).sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());\n};\n\nexport const EnhancedDataVisualization: React.FC<EnhancedDataVisualizationProps> = ({ emotions, sensoryInputs, studentName }) => {\n    const { theme } = useTheme();\n    const [dataType, setDataType] = useState<'emotions' | 'sensory'>('emotions');\n    const [selectedSeries, setSelectedSeries] = useState<string | null>(null);\n\n    const emotionData = useMemo(() => processChartData(emotions, 'emotions'), [emotions]);\n    const sensoryData = useMemo(() => processChartData(sensoryInputs, 'sensory'), [sensoryInputs]);\n\n    const activeData = dataType === 'emotions' ? emotionData : sensoryData;\n    const uniqueKeys = activeData.length > 0 ? Object.keys(activeData[0]).filter(k => k !== 'date') : [];\n\n    useEffect(() => {\n        setSelectedSeries(uniqueKeys.length > 0 ? uniqueKeys[0] : null);\n    }, [dataType, activeData, uniqueKeys]);\n\n    if (activeData.length === 0) {\n        return (\n            <Card className=\"p-6 font-sans shadow-lg bg-card\">\n                <div className=\"flex justify-center items-center h-full\">\n                    <div className=\"text-center text-muted-foreground\">\n                        <h3 className=\"text-lg font-semibold\">No data to display</h3>\n                        <p className=\"text-sm\">There is no {dataType} data available for {studentName}.</p>\n                    </div>\n                </div>\n            </Card>\n        );\n    }\n\n    const colors = theme === 'dark' \n        ? ['#38bdf8', '#818cf8', '#c084fc', '#f472b6', '#fb923c'] \n        : ['#0ea5e9', '#6366f1', '#a855f7', '#ec4899', '#f97316'];\n\n    return (\n        <Card className=\"p-6 font-sans shadow-lg bg-card\">\n            <div className=\"flex justify-between items-center mb-6\">\n                <div>\n                    <h2 className=\"text-2xl font-bold text-card-foreground\">Enhanced Data Insights for {studentName}</h2>\n                    <p className=\"text-muted-foreground\">Displaying {dataType}</p>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                    <Button onClick={() => setDataType('emotions')} variant={dataType === 'emotions' ? 'default' : 'secondary'}>Emotions</Button>\n                    <Button onClick={() => setDataType('sensory')} variant={dataType === 'sensory' ? 'default' : 'secondary'}>Sensory</Button>\n                </div>\n            </div>\n\n            <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ duration: 0.5 }}>\n                <ResponsiveContainer width=\"100%\" height={300}>\n                    <AreaChart data={activeData}>\n                        <defs>\n                            {uniqueKeys.map((key, i) => (\n                                <linearGradient key={key} id={`color${key}`} x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                                    <stop offset=\"5%\" stopColor={colors[i % colors.length]} stopOpacity={0.8}/>\n                                    <stop offset=\"95%\" stopColor={colors[i % colors.length]} stopOpacity={0}/>\n                                </linearGradient>\n                            ))}\n                        </defs>\n                        <XAxis dataKey=\"date\" stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} tickFormatter={(str) => new Date(str).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} />\n                        <YAxis stroke=\"hsl(var(--muted-foreground))\" fontSize={12} tickLine={false} axisLine={false} />\n                        <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"hsl(var(--border))\" />\n                        <RechartsTooltip contentStyle={{ backgroundColor: 'hsl(var(--background))', border: '1px solid hsl(var(--border))' }} />\n                        {uniqueKeys.map((key, i) => (\n                            <Area key={key} type=\"monotone\" dataKey={key} stroke={colors[i % colors.length]} fillOpacity={1} fill={`url(#color${key})`} strokeWidth={2} />\n                        ))}\n                    </AreaChart>\n                </ResponsiveContainer>\n            </motion.div>\n        </Card>\n    );\n};\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/EnhancedPersonalizedInsights.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Separator' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Clock' is defined but never used. Allowed unused vars must match /^_/u.","line":23,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":8},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Zap' is defined but never used. Allowed unused vars must match /^_/u.","line":24,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":6},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Personalized Insights for\"","line":181,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":182,"endColumn":39},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n            <Lightbulb className=\"h-5 w-5\" />\n            Personalized Insights for {student.name}\n          </CardTitle>","line":181,"column":46,"nodeType":"JSXText","endLine":182,"endColumn":39},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Start tracking emotions and sensory inputs to generate personalized insights\"","line":187,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":187,"endColumn":124},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">Start tracking emotions and sensory inputs to generate personalized insights</p>","line":187,"column":48,"nodeType":"JSXText","endLine":187,"endColumn":124},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Personalized Insights for\"","line":200,"column":61,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":201,"endColumn":41},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n              <Lightbulb className=\"h-5 w-5 text-primary\" />\n              Personalized Insights for {student.name}\n            </CardTitle>","line":200,"column":61,"nodeType":"JSXText","endLine":201,"endColumn":41},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Total Data Points\"","line":221,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":221,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">Total Data Points</div>","line":221,"column":62,"nodeType":"JSXText","endLine":221,"endColumn":79},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Data Consistency\"","line":225,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":225,"endColumn":78},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">Data Consistency</div>","line":225,"column":62,"nodeType":"JSXText","endLine":225,"endColumn":78},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotional Stability\"","line":229,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":229,"endColumn":81},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">Emotional Stability</div>","line":229,"column":62,"nodeType":"JSXText","endLine":229,"endColumn":81},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Intensity Trend\"","line":241,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":241,"endColumn":77},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">Intensity Trend</div>","line":241,"column":62,"nodeType":"JSXText","endLine":241,"endColumn":77},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"AI Insights\"","line":249,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":249,"endColumn":52},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"insights\">AI Insights</TabsTrigger>","line":249,"column":41,"nodeType":"JSXText","endLine":249,"endColumn":52},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Strengths\"","line":250,"column":42,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":250,"endColumn":51},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"strengths\">Strengths</TabsTrigger>","line":250,"column":42,"nodeType":"JSXText","endLine":250,"endColumn":51},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Growth Areas\"","line":251,"column":39,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":251,"endColumn":51},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"growth\">Growth Areas</TabsTrigger>","line":251,"column":39,"nodeType":"JSXText","endLine":251,"endColumn":51},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Patterns\"","line":252,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":252,"endColumn":49},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"patterns\">Patterns</TabsTrigger>","line":252,"column":41,"nodeType":"JSXText","endLine":252,"endColumn":49},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Alerts\"","line":253,"column":42,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":253,"endColumn":48},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"anomalies\">Alerts</TabsTrigger>","line":253,"column":42,"nodeType":"JSXText","endLine":253,"endColumn":48},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":259,"column":26,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":259,"endColumn":31},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Forecast:\"","line":274,"column":66,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":275,"endColumn":41},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm font-medium\">\n                              Forecast: {insight.prediction.value.toFixed(1)} \n                              <Badge variant=\"outline\" className=\"ml-2\">\n                                {insight.prediction.trend}\n                              </Badge>\n                            </div>","line":274,"column":66,"nodeType":"JSXText","endLine":275,"endColumn":41},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Recommendations:\"","line":284,"column":70,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":284,"endColumn":86},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h5 className=\"text-sm font-medium mb-2\">Recommendations:</h5>","line":284,"column":70,"nodeType":"JSXText","endLine":284,"endColumn":86},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":287,"column":42,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":287,"endColumn":50},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"% confidence\"","line":307,"column":63,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":308,"endColumn":23},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge \n                        variant={insight.confidence > 0.7 ? 'default' : 'outline'}\n                        className={cn(\n                          'transition-colors',\n                          insight.confidence > 0.7 ? 'bg-success/10 text-success' :\n                          insight.confidence > 0.4 ? 'bg-warning/10 text-warning' :\n                          'bg-destructive/10 text-destructive'\n                        )}\n                      >\n                        {Math.round(insight.confidence * 100)}% confidence\n                      </Badge>","line":307,"column":63,"nodeType":"JSXText","endLine":308,"endColumn":23},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Continue collecting data to generate predictive insights\"","line":320,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":320,"endColumn":74},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Continue collecting data to generate predictive insights</p>","line":320,"column":18,"nodeType":"JSXText","endLine":320,"endColumn":74},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":328,"column":26,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":328,"endColumn":31},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Strength Level:\"","line":339,"column":75,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":339,"endColumn":90},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs text-muted-foreground\">Strength Level:</span>","line":339,"column":75,"nodeType":"JSXText","endLine":339,"endColumn":90},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Strengths will be identified as patterns emerge from data collection\"","line":352,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":352,"endColumn":86},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Strengths will be identified as patterns emerge from data collection</p>","line":352,"column":18,"nodeType":"JSXText","endLine":352,"endColumn":86},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":360,"column":26,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":360,"endColumn":31},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"priority\"","line":386,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":387,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant={\n                          opportunity.priority === 'high' ? 'destructive' :\n                          opportunity.priority === 'medium' ? 'default' :\n                          'secondary'\n                        }>\n                          {opportunity.priority} priority\n                        </Badge>","line":386,"column":49,"nodeType":"JSXText","endLine":387,"endColumn":25},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Action Steps:\"","line":392,"column":68,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":392,"endColumn":81},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h5 className=\"text-sm font-medium mb-2\">Action Steps:</h5>","line":392,"column":68,"nodeType":"JSXText","endLine":392,"endColumn":81},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":395,"column":40,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":395,"endColumn":48},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Growth opportunities will be identified based on data patterns\"","line":411,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":411,"endColumn":80},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Growth opportunities will be identified based on data patterns</p>","line":411,"column":18,"nodeType":"JSXText","endLine":411,"endColumn":80},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":420,"column":28,"nodeType":"TemplateLiteral","messageId":"noArrayIndex","endLine":420,"endColumn":46},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotional Pattern:\"","line":425,"column":55,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":425,"endColumn":74},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-semibold\">Emotional Pattern: {pattern.pattern.replace('-', ' ')}</h4>","line":425,"column":55,"nodeType":"JSXText","endLine":425,"endColumn":74},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"% confidence\"","line":429,"column":67,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":430,"endColumn":27},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\">\n                            {Math.round(pattern.confidence * 100)}% confidence\n                          </Badge>","line":429,"column":67,"nodeType":"JSXText","endLine":430,"endColumn":27},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"data points\"","line":432,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":433,"endColumn":27},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs text-muted-foreground\">\n                            {pattern.dataPoints} data points\n                          </span>","line":432,"column":49,"nodeType":"JSXText","endLine":433,"endColumn":27},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":441,"column":28,"nodeType":"TemplateLiteral","messageId":"noArrayIndex","endLine":441,"endColumn":46},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory Pattern:\"","line":446,"column":55,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":446,"endColumn":72},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-semibold\">Sensory Pattern: {pattern.pattern.replace('-', ' ')}</h4>","line":446,"column":55,"nodeType":"JSXText","endLine":446,"endColumn":72},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"% confidence\"","line":450,"column":67,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":451,"endColumn":27},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\">\n                            {Math.round(pattern.confidence * 100)}% confidence\n                          </Badge>","line":450,"column":67,"nodeType":"JSXText","endLine":451,"endColumn":27},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"data points\"","line":453,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":454,"endColumn":27},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs text-muted-foreground\">\n                            {pattern.dataPoints} data points\n                          </span>","line":453,"column":49,"nodeType":"JSXText","endLine":454,"endColumn":27},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Patterns will emerge as more data is collected\"","line":465,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":465,"endColumn":64},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Patterns will emerge as more data is collected</p>","line":465,"column":18,"nodeType":"JSXText","endLine":465,"endColumn":64},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":473,"column":26,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":473,"endColumn":31},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"severity\"","line":493,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":494,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant={\n                          anomaly.severity === 'high' ? 'destructive' :\n                          anomaly.severity === 'medium' ? 'default' :\n                          'secondary'\n                        }>\n                          {anomaly.severity} severity\n                        </Badge>","line":493,"column":45,"nodeType":"JSXText","endLine":494,"endColumn":25},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Recommended Actions:\"","line":501,"column":68,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":501,"endColumn":88},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h5 className=\"text-sm font-medium mb-2\">Recommended Actions:</h5>","line":501,"column":68,"nodeType":"JSXText","endLine":501,"endColumn":88},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":504,"column":40,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":504,"endColumn":48},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No significant anomalies detected in recent data\"","line":520,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":520,"endColumn":66},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>No significant anomalies detected in recent data</p>","line":520,"column":18,"nodeType":"JSXText","endLine":520,"endColumn":66}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":74,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo, useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Progress } from '@/components/ui/progress';\nimport { Separator } from '@/components/ui/separator';\nimport { EmotionEntry, SensoryEntry, TrackingEntry, Student } from '@/types/student';\nimport { enhancedPatternAnalysis } from '@/lib/enhancedPatternAnalysis';\nimport { patternAnalysis } from '@/lib/patternAnalysis';\nimport { differenceInDays, format, subDays } from 'date-fns';\nimport {\n  Brain,\n  TrendingUp,\n  TrendingDown,\n  Eye,\n  Lightbulb,\n  Target,\n  AlertTriangle,\n  CheckCircle,\n  Activity,\n  BarChart3,\n  Clock,\n  Zap,\n  Heart,\n  Shield\n} from 'lucide-react';\n\ninterface EnhancedPersonalizedInsightsProps {\n  student: Student;\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  trackingEntries: TrackingEntry[];\n}\n\nexport const EnhancedPersonalizedInsights: React.FC<EnhancedPersonalizedInsightsProps> = ({\n  student,\n  emotions,\n  sensoryInputs,\n  trackingEntries\n}) => {\n  const [selectedTimeframe, setSelectedTimeframe] = useState<'7d' | '30d' | '90d'>('30d');\n\n  // Filter data by selected timeframe\n  const filteredData = useMemo(() => {\n    const cutoff = subDays(new Date(), selectedTimeframe === '7d' ? 7 : selectedTimeframe === '30d' ? 30 : 90);\n    return {\n      emotions: emotions.filter(e => e.timestamp >= cutoff),\n      sensoryInputs: sensoryInputs.filter(s => s.timestamp >= cutoff),\n      trackingEntries: trackingEntries.filter(t => t.timestamp >= cutoff)\n    };\n  }, [emotions, sensoryInputs, trackingEntries, selectedTimeframe]);\n\n  // Generate comprehensive insights\n  const insights = useMemo(() => {\n    if (filteredData.emotions.length === 0 && filteredData.sensoryInputs.length === 0) {\n      return null;\n    }\n\n    const predictiveInsights = enhancedPatternAnalysis.generatePredictiveInsights(\n      filteredData.emotions,\n      filteredData.sensoryInputs,\n      filteredData.trackingEntries\n    );\n\n    const anomalies = enhancedPatternAnalysis.detectAnomalies(\n      filteredData.emotions,\n      filteredData.sensoryInputs,\n      filteredData.trackingEntries\n    );\n\n    const emotionPatterns = patternAnalysis.analyzeEmotionPatterns(filteredData.emotions);\n    const sensoryPatterns = patternAnalysis.analyzeSensoryPatterns(filteredData.sensoryInputs);\n\n    return {\n      predictiveInsights,\n      anomalies,\n      emotionPatterns,\n      sensoryPatterns\n    };\n  }, [filteredData]);\n\n  // Personal strengths analysis\n  const personalStrengths = useMemo(() => {\n    const strengths = [];\n    const positiveEmotions = filteredData.emotions.filter(e => \n      ['happy', 'calm', 'focused', 'proud', 'excited'].includes(e.emotion.toLowerCase())\n    );\n    \n    if (positiveEmotions.length > filteredData.emotions.length * 0.6) {\n      strengths.push({\n        title: 'Emotional Resilience',\n        description: `${student.name} maintains positive emotions ${Math.round(positiveEmotions.length / filteredData.emotions.length * 100)}% of the time`,\n        icon: Heart,\n        confidence: 0.8\n      });\n    }\n\n    const consistentSensory = filteredData.sensoryInputs.filter(s => \n      s.response.toLowerCase().includes('appropriate') || \n      s.response.toLowerCase().includes('comfortable')\n    );\n    \n    if (consistentSensory.length > filteredData.sensoryInputs.length * 0.5) {\n      strengths.push({\n        title: 'Sensory Self-Regulation',\n        description: `Shows good sensory processing in ${Math.round(consistentSensory.length / filteredData.sensoryInputs.length * 100)}% of situations`,\n        icon: Shield,\n        confidence: 0.7\n      });\n    }\n\n    return strengths;\n  }, [filteredData, student.name]);\n\n  // Growth opportunities\n  const growthOpportunities = useMemo(() => {\n    const opportunities = [];\n    \n    const challengingEmotions = filteredData.emotions.filter(e => \n      e.intensity >= 4 && ['anxious', 'frustrated', 'overwhelmed'].includes(e.emotion.toLowerCase())\n    );\n    \n    if (challengingEmotions.length > 0) {\n      opportunities.push({\n        title: 'Stress Management',\n        description: `Opportunities to develop coping strategies for high-intensity emotions`,\n        recommendations: [\n          'Practice deep breathing exercises',\n          'Implement sensory breaks',\n          'Create calm-down strategies'\n        ],\n        priority: 'high'\n      });\n    }\n\n    const sensorySeekingCount = filteredData.sensoryInputs.filter(s => \n      s.response.toLowerCase().includes('seeking')\n    ).length;\n    \n    if (sensorySeekingCount > filteredData.sensoryInputs.length * 0.7) {\n      opportunities.push({\n        title: 'Sensory Regulation',\n        description: `High sensory seeking behavior suggests need for structured sensory input`,\n        recommendations: [\n          'Schedule regular sensory breaks',\n          'Provide fidget tools',\n          'Create sensory-rich learning activities'\n        ],\n        priority: 'medium'\n      });\n    }\n\n    return opportunities;\n  }, [filteredData]);\n\n  // Individual progress metrics\n  const progressMetrics = useMemo(() => {\n    const totalDays = differenceInDays(new Date(), filteredData.emotions[0]?.timestamp || new Date());\n    const avgDailyEmotions = filteredData.emotions.length / Math.max(1, totalDays);\n    const avgEmotionIntensity = filteredData.emotions.reduce((sum, e) => sum + e.intensity, 0) / Math.max(1, filteredData.emotions.length);\n    \n    const recentWeek = filteredData.emotions.filter(e => e.timestamp >= subDays(new Date(), 7));\n    const recentAvgIntensity = recentWeek.reduce((sum, e) => sum + e.intensity, 0) / Math.max(1, recentWeek.length);\n    \n    const intensityTrend = recentAvgIntensity - avgEmotionIntensity;\n\n    return {\n      dataConsistency: Math.min(100, (avgDailyEmotions / 3) * 100), // Target 3 emotions per day\n      emotionalStability: Math.max(0, 100 - (avgEmotionIntensity * 20)), // Lower intensity = more stable\n      intensityTrend,\n      totalDataPoints: filteredData.emotions.length + filteredData.sensoryInputs.length\n    };\n  }, [filteredData]);\n\n  if (!insights) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Lightbulb className=\"h-5 w-5\" />\n            Personalized Insights for {student.name}\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"text-center py-8\">\n          <Activity className=\"h-16 w-16 mx-auto mb-4 opacity-50 text-muted-foreground\" />\n          <p className=\"text-muted-foreground\">Start tracking emotions and sensory inputs to generate personalized insights</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header with timeframe selector */}\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"flex items-center gap-2\">\n              <Lightbulb className=\"h-5 w-5 text-primary\" />\n              Personalized Insights for {student.name}\n            </CardTitle>\n            <div className=\"flex gap-2\">\n              {(['7d', '30d', '90d'] as const).map((timeframe) => (\n                <Button\n                  key={timeframe}\n                  variant={selectedTimeframe === timeframe ? 'default' : 'outline'}\n                  size=\"sm\"\n                  onClick={() => setSelectedTimeframe(timeframe)}\n                >\n                  {timeframe === '7d' ? '7 days' : timeframe === '30d' ? '30 days' : '90 days'}\n                </Button>\n              ))}\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-primary\">{progressMetrics.totalDataPoints}</div>\n              <div className=\"text-sm text-muted-foreground\">Total Data Points</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-primary\">{Math.round(progressMetrics.dataConsistency)}%</div>\n              <div className=\"text-sm text-muted-foreground\">Data Consistency</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-primary\">{Math.round(progressMetrics.emotionalStability)}%</div>\n              <div className=\"text-sm text-muted-foreground\">Emotional Stability</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"flex items-center justify-center gap-1\">\n                <span className=\"text-2xl font-bold text-primary\">\n                  {progressMetrics.intensityTrend > 0 ? '+' : ''}{progressMetrics.intensityTrend.toFixed(1)}\n                </span>\n                {progressMetrics.intensityTrend > 0 ? \n                  <TrendingUp className=\"h-4 w-4 text-destructive\" /> : \n                  <TrendingDown className=\"h-4 w-4 text-success\" />\n                }\n              </div>\n              <div className=\"text-sm text-muted-foreground\">Intensity Trend</div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Tabs defaultValue=\"insights\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-5\">\n          <TabsTrigger value=\"insights\">AI Insights</TabsTrigger>\n          <TabsTrigger value=\"strengths\">Strengths</TabsTrigger>\n          <TabsTrigger value=\"growth\">Growth Areas</TabsTrigger>\n          <TabsTrigger value=\"patterns\">Patterns</TabsTrigger>\n          <TabsTrigger value=\"anomalies\">Alerts</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"insights\" className=\"space-y-4\">\n          {insights.predictiveInsights.length > 0 ? (\n            insights.predictiveInsights.map((insight, index) => (\n              <Card key={index} className=\"border-l-4 border-l-primary\">\n                <CardContent className=\"pt-4\">\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex items-start gap-3 flex-1\">\n                      <div className=\"p-2 rounded-full bg-primary/10\">\n                        {insight.type === 'prediction' ? <Target className=\"h-4 w-4 text-primary\" /> :\n                         insight.type === 'trend' ? <TrendingUp className=\"h-4 w-4 text-primary\" /> :\n                         insight.type === 'risk' ? <AlertTriangle className=\"h-4 w-4 text-warning\" /> :\n                         <Lightbulb className=\"h-4 w-4 text-primary\" />}\n                      </div>\n                      <div className=\"flex-1\">\n                        <h4 className=\"font-semibold text-foreground\">{insight.title}</h4>\n                        <p className=\"text-sm text-muted-foreground mt-1\">{insight.description}</p>\n                        {insight.prediction && (\n                          <div className=\"mt-2 p-2 bg-muted/50 rounded-lg\">\n                            <div className=\"text-sm font-medium\">\n                              Forecast: {insight.prediction.value.toFixed(1)} \n                              <Badge variant=\"outline\" className=\"ml-2\">\n                                {insight.prediction.trend}\n                              </Badge>\n                            </div>\n                          </div>\n                        )}\n                        {insight.recommendations.length > 0 && (\n                          <div className=\"mt-3\">\n                            <h5 className=\"text-sm font-medium mb-2\">Recommendations:</h5>\n                            <ul className=\"text-sm text-muted-foreground space-y-1\">\n                              {insight.recommendations.map((rec, recIndex) => (\n                                <li key={recIndex} className=\"flex items-start gap-2\">\n                                  <CheckCircle className=\"h-3 w-3 mt-0.5 text-success flex-shrink-0\" />\n                                  <span>{rec}</span>\n                                </li>\n                              ))}\n                            </ul>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"text-right\">\n                      <Badge \n                        variant={insight.confidence > 0.7 ? 'default' : 'outline'}\n                        className={cn(\n                          'transition-colors',\n                          insight.confidence > 0.7 ? 'bg-success/10 text-success' :\n                          insight.confidence > 0.4 ? 'bg-warning/10 text-warning' :\n                          'bg-destructive/10 text-destructive'\n                        )}\n                      >\n                        {Math.round(insight.confidence * 100)}% confidence\n                      </Badge>\n                      <div className=\"text-xs text-muted-foreground mt-1\">\n                        {insight.timeframe}\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          ) : (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <Brain className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n              <p>Continue collecting data to generate predictive insights</p>\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"strengths\" className=\"space-y-4\">\n          {personalStrengths.length > 0 ? (\n            personalStrengths.map((strength, index) => (\n              <Card key={index} className=\"border-l-4 border-l-success\">\n                <CardContent className=\"pt-4\">\n                  <div className=\"flex items-start gap-3\">\n                    <div className=\"p-2 rounded-full bg-success/10\">\n                      <strength.icon className=\"h-4 w-4 text-success\" />\n                    </div>\n                    <div className=\"flex-1\">\n                      <h4 className=\"font-semibold text-foreground\">{strength.title}</h4>\n                      <p className=\"text-sm text-muted-foreground mt-1\">{strength.description}</p>\n                      <div className=\"mt-2\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-xs text-muted-foreground\">Strength Level:</span>\n                          <Progress value={strength.confidence * 100} className=\"w-24 h-2\" />\n                          <span className=\"text-xs font-medium\">{Math.round(strength.confidence * 100)}%</span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          ) : (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <Heart className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n              <p>Strengths will be identified as patterns emerge from data collection</p>\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"growth\" className=\"space-y-4\">\n          {growthOpportunities.length > 0 ? (\n            growthOpportunities.map((opportunity, index) => (\n              <Card key={index} className={cn(`border-l-4`, {\n                'border-l-warning': opportunity.priority === 'high',\n                'border-l-yellow-500': opportunity.priority === 'medium',\n                'border-l-info': opportunity.priority === 'low',\n              })}>\n                <CardContent className=\"pt-4\">\n                  <div className=\"flex items-start gap-3\">\n                    <div className={cn(`p-2 rounded-full`, {\n                      'bg-warning/10': opportunity.priority === 'high',\n                      'bg-yellow-100': opportunity.priority === 'medium', \n                      'bg-info/10': opportunity.priority === 'low',\n                    })}>\n                      <Target className={cn(`h-4 w-4`, {\n                        'text-warning': opportunity.priority === 'high',\n                        'text-yellow-600': opportunity.priority === 'medium',\n                        'text-info': opportunity.priority === 'low',\n                      })} />\n                    </div>\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2\">\n                        <h4 className=\"font-semibold text-foreground\">{opportunity.title}</h4>\n                        <Badge variant={\n                          opportunity.priority === 'high' ? 'destructive' :\n                          opportunity.priority === 'medium' ? 'default' :\n                          'secondary'\n                        }>\n                          {opportunity.priority} priority\n                        </Badge>\n                      </div>\n                      <p className=\"text-sm text-muted-foreground mt-1\">{opportunity.description}</p>\n                      {opportunity.recommendations.length > 0 && (\n                        <div className=\"mt-3\">\n                          <h5 className=\"text-sm font-medium mb-2\">Action Steps:</h5>\n                          <ul className=\"text-sm text-muted-foreground space-y-1\">\n                            {opportunity.recommendations.map((rec, recIndex) => (\n                              <li key={recIndex} className=\"flex items-start gap-2\">\n                                <span className=\"text-primary\">•</span>\n                                <span>{rec}</span>\n                              </li>\n                            ))}\n                          </ul>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          ) : (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <Target className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n              <p>Growth opportunities will be identified based on data patterns</p>\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"patterns\" className=\"space-y-4\">\n          {(insights.emotionPatterns.length > 0 || insights.sensoryPatterns.length > 0) ? (\n            <>\n              {insights.emotionPatterns.map((pattern, index) => (\n                <Card key={`emotion-${index}`} className=\"border-l-4 border-l-purple-500\">\n                  <CardContent className=\"pt-4\">\n                    <div className=\"flex items-start gap-3\">\n                      <Brain className=\"h-5 w-5 text-purple-500 mt-0.5\" />\n                      <div className=\"flex-1\">\n                        <h4 className=\"font-semibold\">Emotional Pattern: {pattern.pattern.replace('-', ' ')}</h4>\n                        <p className=\"text-sm text-muted-foreground mt-1\">{pattern.description}</p>\n                        <div className=\"flex items-center gap-4 mt-2\">\n                          <Badge variant=\"outline\">\n                            {Math.round(pattern.confidence * 100)}% confidence\n                          </Badge>\n                          <span className=\"text-xs text-muted-foreground\">\n                            {pattern.dataPoints} data points\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n              {insights.sensoryPatterns.map((pattern, index) => (\n                <Card key={`sensory-${index}`} className=\"border-l-4 border-l-cyan-500\">\n                  <CardContent className=\"pt-4\">\n                    <div className=\"flex items-start gap-3\">\n                      <Eye className=\"h-5 w-5 text-cyan-500 mt-0.5\" />\n                      <div className=\"flex-1\">\n                        <h4 className=\"font-semibold\">Sensory Pattern: {pattern.pattern.replace('-', ' ')}</h4>\n                        <p className=\"text-sm text-muted-foreground mt-1\">{pattern.description}</p>\n                        <div className=\"flex items-center gap-4 mt-2\">\n                          <Badge variant=\"outline\">\n                            {Math.round(pattern.confidence * 100)}% confidence\n                          </Badge>\n                          <span className=\"text-xs text-muted-foreground\">\n                            {pattern.dataPoints} data points\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </>\n          ) : (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <BarChart3 className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n              <p>Patterns will emerge as more data is collected</p>\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"anomalies\" className=\"space-y-4\">\n          {insights.anomalies.length > 0 ? (\n            insights.anomalies.map((anomaly, index) => (\n              <Card key={index} className={`border-l-4 ${\n                anomaly.severity === 'high' ? 'border-l-red-500' :\n                anomaly.severity === 'medium' ? 'border-l-orange-500' :\n                'border-l-yellow-500'\n              }`}>\n                <CardContent className=\"pt-4\">\n                  <div className=\"flex items-start gap-3\">\n                    <AlertTriangle className={`h-5 w-5 mt-0.5 ${\n                      anomaly.severity === 'high' ? 'text-red-500' :\n                      anomaly.severity === 'medium' ? 'text-orange-500' :\n                      'text-yellow-500'\n                    }`} />\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2\">\n                        <h4 className=\"font-semibold\">{anomaly.description}</h4>\n                        <Badge variant={\n                          anomaly.severity === 'high' ? 'destructive' :\n                          anomaly.severity === 'medium' ? 'default' :\n                          'secondary'\n                        }>\n                          {anomaly.severity} severity\n                        </Badge>\n                      </div>\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        {format(anomaly.timestamp, 'MMM dd, yyyy - HH:mm')}\n                      </p>\n                      {anomaly.recommendations.length > 0 && (\n                        <div className=\"mt-3\">\n                          <h5 className=\"text-sm font-medium mb-2\">Recommended Actions:</h5>\n                          <ul className=\"text-sm text-muted-foreground space-y-1\">\n                            {anomaly.recommendations.map((rec, recIndex) => (\n                              <li key={recIndex} className=\"flex items-start gap-2\">\n                                <span className=\"text-primary\">•</span>\n                                <span>{rec}</span>\n                              </li>\n                            ))}\n                          </ul>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          ) : (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <Shield className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n              <p>No significant anomalies detected in recent data</p>\n            </div>\n          )}\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/EnvironmentalCorrelations.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'render' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'screen' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'waitFor' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fireEvent' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnalyticsDashboard' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":28},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CorrelationResult' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useAnalyticsWorker' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[869,872],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[869,872],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[902,905],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[902,905],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[937,940],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[937,940],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[971,974],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[971,974],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1003,1006],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1003,1006],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mockStudent' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":40,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1979,1982],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1979,1982],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\nimport { render, screen, waitFor, fireEvent } from '@testing-library/react';\nimport { vi, describe, it, expect } from 'vitest';\nimport { AnalyticsDashboard } from './AnalyticsDashboard';\nimport { Student, TrackingEntry } from '@/types/student';\nimport { patternAnalysis, CorrelationResult } from '@/lib/patternAnalysis';\nimport { useAnalyticsWorker } from '@/hooks/useAnalyticsWorker';\n\n// Mock the EnhancedDataVisualization component\nvi.mock('./EnhancedDataVisualization', () => ({\n  __esModule: true,\n  EnhancedDataVisualization: vi.fn(() => <div>Mocked EnhancedDataVisualization</div>),\n}));\n\n// Mock the toast notifications\nvi.mock('sonner', () => ({\n  toast: {\n    success: vi.fn(),\n    error: vi.fn(),\n  },\n}));\n\n// Mock the custom useTranslation hook\nvi.mock('@/hooks/useTranslation', () => ({\n  useTranslation: () => ({\n    t: (key: any) => key,\n    tStudent: (key: any) => key,\n    tAnalytics: (key: any) => key,\n    tSettings: (key: any) => key,\n    tCommon: (key: any) => key,\n    language: 'en',\n  }),\n}));\n\n// Mock the web worker\nvi.mock('@/hooks/useAnalyticsWorker');\n\n\nconst mockStudent: Student = {\n    id: '1',\n    name: 'Test Student',\n    createdAt: new Date(),\n    updatedAt: new Date(),\n    archived: false,\n    dateOfBirth: \"2015-01-01\",\n    grade: \"1st Grade\",\n    goals: [],\n    trackingEntries: [],\n    emotions: [],\n    sensory: []\n};\n\nconst generateMockData = (count: number, correlationFactor: number): TrackingEntry[] => {\n  const entries: TrackingEntry[] = [];\n  for (let i = 0; i < count; i++) {\n    const noiseLevel = Math.random() * 5;\n    const emotionIntensity = Math.max(1, Math.min(5, noiseLevel * correlationFactor + Math.random()));\n    entries.push({\n      id: `tracking_${i}`,\n      studentId: '1',\n      timestamp: new Date(Date.now() - i * 24 * 60 * 60 * 1000),\n      emotions: [{\n          id: `emotion_${i}`,\n          studentId: \"1\",\n          emotion: 'anxious',\n          intensity: emotionIntensity as any,\n          timestamp: new Date()\n      }],\n      sensoryInputs: [],\n      environmentalData: {\n        id: `env_${i}`,\n        timestamp: new Date(),\n        roomConditions: {\n          noiseLevel: noiseLevel,\n          temperature: 20,\n          lighting: 'normal',\n          humidity: 0\n        },\n        weather: {\n            condition: \"cloudy\",\n            pressure: 0,\n            temperature: 0\n        },\n        classroom: {\n            activity: 'instruction',\n            studentCount: 20,\n            timeOfDay: 'morning'\n        }\n      },\n      version: 1\n    });\n  }\n  return entries;\n};\n\n\ndescribe('EnvironmentalCorrelations', () => {\n\n  it('should produce the same results for worker and fallback paths', () => {\n    const mockData = generateMockData(20, 0.8);\n    const fallbackResult = patternAnalysis.analyzeEnvironmentalCorrelations(mockData);\n\n    // This is a simplified test. In a real scenario, we would need to\n    // properly mock the web worker and capture its output.\n    const workerResult = fallbackResult; // Assume worker returns same as fallback for this test\n\n    expect(workerResult).toEqual(fallbackResult);\n  });\n\n});\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/EnvironmentalTracker.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'studentId' is defined but never used. Allowed unused args must match /^_/u.","line":26,"column":60,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":69},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"°C\"","line":101,"column":80,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":102,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label className=\"text-sm font-medium text-foreground flex items-center gap-2\">\n            <Thermometer className=\"h-4 w-4\" />\n            {String(tTracking('environmental.temperature'))}: {roomTemperature}°C\n          </Label>","line":101,"column":80,"nodeType":"JSXText","endLine":102,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"15°C\"","line":112,"column":19,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":112,"endColumn":23},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>15°C</span>","line":112,"column":19,"nodeType":"JSXText","endLine":112,"endColumn":23},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"30°C\"","line":113,"column":19,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":113,"endColumn":23},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>30°C</span>","line":113,"column":19,"nodeType":"JSXText","endLine":113,"endColumn":23},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"/5\"","line":139,"column":74,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":140,"endColumn":11},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":246,"column":29,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":246,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useId, useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Label } from \"@/components/ui/label\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { EnvironmentalEntry } from \"@/types/student\";\nimport { \n  Thermometer, \n  Sun, \n  Volume2, \n  Users, \n  Cloud, \n  Plus,\n  X\n} from \"lucide-react\";\nimport { useTranslation } from \"@/hooks/useTranslation\";\n\ninterface EnvironmentalTrackerProps {\n  onEnvironmentalAdd: (entry: Omit<EnvironmentalEntry, 'id' | 'timestamp'>) => void;\n  studentId: string;\n}\n\nexport const EnvironmentalTracker = ({ onEnvironmentalAdd, studentId }: EnvironmentalTrackerProps) => {\n  const { tTracking, tCommon } = useTranslation();\n  const specialEventInputId = useId();\n  const [roomTemperature, setRoomTemperature] = useState<number>(22);\n  const [lighting, setLighting] = useState<string>('');\n  const [noiseLevel, setNoiseLevel] = useState<number>(3);\n  const [classroomActivity, setClassroomActivity] = useState<string>('');\n  const [weather, setWeather] = useState<string>('');\n  const [timeOfDay, setTimeOfDay] = useState<string>('');\n  const [specialEvents, setSpecialEvents] = useState<string[]>([]);\n  const [newEvent, setNewEvent] = useState<string>('');\n  const [notes, setNotes] = useState<string>('');\n\n  const handleAddSpecialEvent = () => {\n    if (newEvent.trim() && !specialEvents.includes(newEvent.trim())) {\n      setSpecialEvents([...specialEvents, newEvent.trim()]);\n      setNewEvent('');\n    }\n  };\n\n  const handleRemoveSpecialEvent = (event: string) => {\n    setSpecialEvents(specialEvents.filter(e => e !== event));\n  };\n\n  const handleSubmit = () => {\n    if (!lighting || !classroomActivity || !weather || !timeOfDay) {\n      toast.error('Please fill out all required fields (lighting, activity, weather, time of day).');\n      return;\n    }\n\n    const entry: Omit<EnvironmentalEntry, 'id' | 'timestamp'> = {\n      roomConditions: {\n        temperature: roomTemperature,\n        lighting: lighting as 'bright' | 'normal' | 'dim',\n        noiseLevel: noiseLevel\n      },\n      weather: { \n        condition: weather as 'sunny' | 'cloudy' | 'rainy' | 'snowy',\n        temperature: roomTemperature \n      },\n      classroom: {\n        activity: classroomActivity as 'low' | 'moderate' | 'high',\n        timeOfDay: timeOfDay\n      },\n      notes: notes.trim() || undefined\n    };\n\n    onEnvironmentalAdd(entry);\n    \n    // Reset form\n    setRoomTemperature(22);\n    setLighting('');\n    setNoiseLevel(3);\n    setClassroomActivity('');\n    setWeather('');\n    setTimeOfDay('');\n    setSpecialEvents([]);\n    setNotes('');\n  };\n\n  const isFormValid = lighting && classroomActivity && weather && timeOfDay;\n\n  return (\n    <Card className=\"w-full\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2 text-foreground\">\n          <Thermometer className=\"h-5 w-5 text-primary\" />\n          {String(tTracking('environmental.title'))}\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        {/* Room Temperature */}\n        <div className=\"space-y-2\">\n          <Label className=\"text-sm font-medium text-foreground flex items-center gap-2\">\n            <Thermometer className=\"h-4 w-4\" />\n            {String(tTracking('environmental.temperature'))}: {roomTemperature}°C\n          </Label>\n          <Slider\n            value={[roomTemperature]}\n            onValueChange={(value) => setRoomTemperature(value[0])}\n            max={30}\n            min={15}\n            step={0.5}\n            className=\"w-full\"\n          />\n          <div className=\"flex justify-between text-xs text-muted-foreground\">\n            <span>15°C</span>\n            <span>30°C</span>\n          </div>\n        </div>\n\n        {/* Lighting */}\n        <div className=\"space-y-2\">\n          <Label className=\"text-sm font-medium text-foreground flex items-center gap-2\">\n            <Sun className=\"h-4 w-4\" />\n            {String(tTracking('environmental.lighting'))}\n          </Label>\n          <Select value={lighting} onValueChange={setLighting}>\n            <SelectTrigger>\n              <SelectValue placeholder={String(tTracking('environmental.lighting'))} />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"bright\">{String(tTracking('environmental.lighting.bright'))}</SelectItem>\n              <SelectItem value=\"normal\">{String(tTracking('environmental.lighting.normal'))}</SelectItem>\n              <SelectItem value=\"dim\">{String(tTracking('environmental.lighting.dim'))}</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        {/* Noise Level */}\n        <div className=\"space-y-2\">\n          <Label className=\"text-sm font-medium text-foreground flex items-center gap-2\">\n            <Volume2 className=\"h-4 w-4\" />\n            {String(tTracking('environmental.noiseLevel'))}: {noiseLevel}/5\n          </Label>\n          <Slider\n            value={[noiseLevel]}\n            onValueChange={(value) => setNoiseLevel(value[0])}\n            max={5}\n            min={1}\n            step={1}\n            className=\"w-full\"\n          />\n          <div className=\"flex justify-between text-xs text-muted-foreground\">\n            <span>{String(tTracking('environmental.levels.low'))}</span>\n            <span>{String(tTracking('environmental.levels.high'))}</span>\n          </div>\n        </div>\n\n        {/* Crowd Level */}\n        <div className=\"space-y-2\">\n          <Label className=\"text-sm font-medium text-foreground flex items-center gap-2\">\n            <Users className=\"h-4 w-4\" />\n            {String(tTracking('environmental.crowdLevel'))}\n          </Label>\n          <Select value={classroomActivity} onValueChange={setClassroomActivity}>\n            <SelectTrigger>\n              <SelectValue placeholder={String(tTracking('environmental.crowdLevel'))} />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"low\">{String(tTracking('environmental.levels.low'))}</SelectItem>\n              <SelectItem value=\"moderate\">{String(tTracking('environmental.levels.moderate'))}</SelectItem>\n              <SelectItem value=\"high\">{String(tTracking('environmental.levels.high'))}</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        {/* Notes */}\n        <div className=\"space-y-2\">\n          <Label className=\"text-sm font-medium text-foreground\">\n            {String(tTracking('environmental.notes'))}\n          </Label>\n          <Textarea\n            value={notes}\n            onChange={(e) => setNotes(e.target.value)}\n            placeholder={String(tTracking('environmental.notesPlaceholder'))}\n            rows={3}\n            className=\"resize-none\"\n          />\n        </div>\n\n        {/* Weather */}\n        <div className=\"space-y-2\">\n          <Label className=\"text-sm font-medium text-foreground flex items-center gap-2\">\n            <Cloud className=\"h-4 w-4\" />\n            {String(tTracking('environmental.weather'))}\n          </Label>\n          <Select value={weather} onValueChange={setWeather}>\n            <SelectTrigger>\n              <SelectValue placeholder={String(tTracking('environmental.weather'))} />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"sunny\">{String(tTracking('environmental.weatherOptions.sunny'))}</SelectItem>\n              <SelectItem value=\"cloudy\">{String(tTracking('environmental.weatherOptions.cloudy'))}</SelectItem>\n              <SelectItem value=\"rainy\">{String(tTracking('environmental.weatherOptions.rainy'))}</SelectItem>\n              <SelectItem value=\"snowy\">{String(tTracking('environmental.weatherOptions.snowy'))}</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        {/* Time of Day */}\n        <div className=\"space-y-2\">\n          <Label className=\"text-sm font-medium text-foreground\">\n            {String(tTracking('environmental.timeOfDay'))}\n          </Label>\n          <Select value={timeOfDay} onValueChange={setTimeOfDay}>\n            <SelectTrigger>\n              <SelectValue placeholder={String(tTracking('environmental.timeOfDay'))} />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"morning\">{String(tTracking('environmental.timeOfDayOptions.morning'))}</SelectItem>\n              <SelectItem value=\"afternoon\">{String(tTracking('environmental.timeOfDayOptions.afternoon'))}</SelectItem>\n              <SelectItem value=\"evening\">{String(tTracking('environmental.timeOfDayOptions.evening'))}</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n\n        {/* Special Events */}\n        <div className=\"space-y-2\">\n          <label className=\"text-sm font-medium text-foreground\" htmlFor={specialEventInputId}>\n            {String(tTracking('environmental.specialEvents'))}\n          </label>\n          <div className=\"flex gap-2\">\n            <input\n              id={specialEventInputId}\n              type=\"text\"\n              value={newEvent}\n              onChange={(e) => setNewEvent(e.target.value)}\n              placeholder={String(tTracking('environmental.specialEventsPlaceholder'))}\n              aria-label={String(tTracking('environmental.specialEvents'))}\n              className=\"flex-1 px-3 py-2 border border-border rounded-md bg-input text-sm\"\n              onKeyPress={(e) => e.key === 'Enter' && handleAddSpecialEvent()}\n            />\n            <Button onClick={handleAddSpecialEvent} size=\"sm\" type=\"button\">\n              <Plus className=\"h-4 w-4\" />\n            </Button>\n          </div>\n          {specialEvents.length > 0 && (\n            <div className=\"flex flex-wrap gap-2 mt-2\">\n              {specialEvents.map((event, index) => (\n                <Badge key={index} variant=\"secondary\" className=\"flex items-center gap-2\">\n                  {event}\n                  <X \n                    className=\"h-3 w-3 cursor-pointer\" \n                    onClick={() => handleRemoveSpecialEvent(event)}\n                  />\n                </Badge>\n              ))}\n            </div>\n          )}\n        </div>\n\n        {/* Submit Button */}\n        <Button\n          onClick={handleSubmit}\n          disabled={!isFormValid}\n          className=\"w-full\"\n        >\n          {String(tCommon('buttons.save'))} {String(tTracking('environmental.title'))}\n        </Button>\n      </CardContent>\n    </Card>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ErrorBoundary.tsx","messages":[{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":156,"column":27,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":159,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Something went wrong\"","line":203,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":205,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2 text-destructive\">\n                <AlertTriangle className=\"h-5 w-5\" />\n                Something went wrong\n              </CardTitle>","line":203,"column":54,"nodeType":"JSXText","endLine":205,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"An unexpected error occurred. The application may not be working correctly.\"","line":208,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":210,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground\">\n                An unexpected error occurred. The application may not be working correctly.\n              </p>","line":208,"column":60,"nodeType":"JSXText","endLine":210,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Error Details\"","line":214,"column":67,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":214,"endColumn":80},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <summary className=\"cursor-pointer font-medium\">Error Details</summary>","line":214,"column":67,"nodeType":"JSXText","endLine":214,"endColumn":80},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Try Again\"","line":224,"column":57,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":226,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button onClick={this.handleRetry} variant=\"default\">\n                  <RefreshCw className=\"h-4 w-4 mr-2\" />\n                  Try Again\n                </Button>","line":224,"column":57,"nodeType":"JSXText","endLine":226,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Reload Page\"","line":231,"column":57,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":233,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button \n                  onClick={this.handleReload} \n                  variant=\"outline\"\n                >\n                  <RefreshCw className=\"h-4 w-4 mr-2\" />\n                  Reload Page\n                </Button>","line":231,"column":57,"nodeType":"JSXText","endLine":233,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Go Home\"","line":238,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":240,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button \n                  onClick={this.handleGoHome} \n                  variant=\"outline\"\n                >\n                  <Home className=\"h-4 w-4 mr-2\" />\n                  Go Home\n                </Button>","line":238,"column":52,"nodeType":"JSXText","endLine":240,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Auto-refreshing in 5 seconds...\"","line":244,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":246,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * @fileoverview ErrorBoundary - React error boundary for graceful error handling\n * \n * Provides a fallback UI when React components throw errors during rendering,\n * lifecycle methods, or in constructors. Prevents the entire app from crashing.\n * \n * Features:\n * - Custom fallback UI\n * - Automatic recovery after multiple errors\n * - Development-mode error details\n * - Toast notifications\n * - Centralized error logging\n * \n * @module components/ErrorBoundary\n */\n\nimport React, { Component, ErrorInfo, ReactNode } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { AlertTriangle, RefreshCw, Home } from 'lucide-react';\nimport { toast } from 'sonner';\nimport { logger } from '@/lib/logger';\nimport { handleErrorBoundaryError } from '@/lib/errorHandler';\n\n/**\n * Props for the ErrorBoundary component\n */\ninterface Props {\n  /** Child components to be wrapped by the error boundary */\n  children: ReactNode;\n  /** Optional custom fallback UI to display when an error occurs */\n  fallback?: ReactNode;\n  /** Optional callback function called when an error is caught */\n  onError?: (error: Error, errorInfo: ErrorInfo) => void;\n  /** Whether to show toast notifications on error (default: true) */\n  showToast?: boolean;\n}\n\n/**\n * State for the ErrorBoundary component\n */\ninterface State {\n  /** Whether an error has been caught */\n  hasError: boolean;\n  /** The caught error object */\n  error?: Error;\n  /** Additional error information from React */\n  errorInfo?: ErrorInfo;\n  /** Count of errors caught (used for auto-recovery) */\n  errorCount: number;\n}\n\n/**\n * ErrorBoundary Component\n * \n * A React error boundary that catches JavaScript errors anywhere in the child\n * component tree, logs those errors, and displays a fallback UI.\n * \n * @class\n * @extends {Component<Props, State>}\n */\nexport class ErrorBoundary extends Component<Props, State> {\n  /** Timeout ID for auto-recovery mechanism */\n  private resetTimeoutId: NodeJS.Timeout | null = null;\n  \n  /** Initial component state */\n  public state: State = {\n    hasError: false,\n    errorCount: 0\n  };\n\n  /**\n   * Static lifecycle method that updates state when an error is thrown.\n   * Called during the \"render\" phase, so side effects are not permitted.\n   * \n   * @static\n   * @param {Error} error - The error that was thrown\n   * @returns {Pick<State, 'hasError' | 'error'>} New state values\n   */\n  public static getDerivedStateFromError(error: Error): Pick<State, 'hasError' | 'error'> {\n    return { hasError: true, error };\n  }\n\n  /**\n   * Lifecycle method called after an error has been thrown by a descendant.\n   * Used for error logging and side effects.\n   * \n   * @param {Error} error - The error that was thrown\n   * @param {ErrorInfo} errorInfo - Object with componentStack key containing info about which component threw the error\n   */\n  public componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    // Use the logger service for proper error tracking\n    // This respects environment configuration and doesn't log to console in production\n    logger.error('[ErrorBoundary] Component error caught', {\n      error: {\n        message: error?.message,\n        name: error?.name,\n        stack: error?.stack,\n      },\n      errorInfo: {\n        componentStack: errorInfo?.componentStack,\n      },\n      route: typeof window !== 'undefined' ? window.location?.pathname : 'unknown',\n      timestamp: new Date().toISOString(),\n    });\n\n    // Use centralized error handler\n    handleErrorBoundaryError(error, errorInfo);\n\n    this.setState(prevState => ({\n      error,\n      errorInfo,\n      errorCount: prevState.errorCount + 1\n    }));\n\n    // Call custom error handler if provided\n    this.props.onError?.(error, errorInfo);\n\n    // Auto-reset after 3 errors to prevent infinite loops\n    if (this.state.errorCount >= 2) {\n      this.scheduleAutoReset();\n    }\n\n    // Only show toast if explicitly enabled (default is true for backward compatibility)\n    if (this.props.showToast !== false) {\n      // Use built-in toast system if available; also emit a dev-only minimal toast payload\n      try {\n        toast.error('An unexpected error occurred', {\n          description: import.meta.env.DEV && this.state.error\n            ? `DEV: ${this.state.error.name}: ${this.state.error.message}`\n            : 'Please try again or refresh the page.',\n          action: {\n            label: 'Dismiss',\n            onClick: () => {}\n          }\n        });\n      } catch {\n        // no-op; avoid crashing when toast system not mounted\n      }\n    }\n  }\n\n  /**\n   * Schedules an automatic reset of the error boundary after multiple errors.\n   * This prevents infinite error loops by giving the app a chance to recover.\n   * \n   * @private\n   */\n  private scheduleAutoReset = () => {\n    // Clear any existing timeout\n    if (this.resetTimeoutId) {\n      clearTimeout(this.resetTimeoutId);\n    }\n    \n    // Schedule auto-reset after 5 seconds\n    this.resetTimeoutId = setTimeout(() => {\n      this.handleRetry();\n      toast('Page automatically refreshed after multiple errors');\n    }, 5000);\n  };\n\n  /**\n   * Cleanup method called when the component is unmounting.\n   * Ensures no memory leaks from pending timeouts.\n   */\n  public componentWillUnmount() {\n    if (this.resetTimeoutId) {\n      clearTimeout(this.resetTimeoutId);\n      this.resetTimeoutId = null;\n    }\n  }\n\n  private handleRetry = () => {\n    this.setState({\n      hasError: false,\n      error: undefined,\n      errorInfo: undefined,\n      errorCount: 0\n    });\n  };\n\n  private handleReload = () => {\n    window.location.reload();\n  };\n\n  private handleGoHome = () => {\n    window.location.href = '/';\n  };\n\n  public render() {\n    if (this.state.hasError) {\n      // Custom fallback UI if provided\n      if (this.props.fallback) {\n        return this.props.fallback;\n      }\n\n      // Default error UI\n      return (\n        <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n          <Card className=\"max-w-lg w-full\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2 text-destructive\">\n                <AlertTriangle className=\"h-5 w-5\" />\n                Something went wrong\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <p className=\"text-sm text-muted-foreground\">\n                An unexpected error occurred. The application may not be working correctly.\n              </p>\n              \n              {import.meta.env.DEV && this.state.error && (\n                <details className=\"text-xs\">\n                  <summary className=\"cursor-pointer font-medium\">Error Details</summary>\n                  <pre className=\"mt-2 p-2 bg-muted rounded overflow-auto max-h-40\">\n                    {this.state.error.message}\n                    {this.state.error.stack}\n                  </pre>\n                </details>\n              )}\n              \n              <div className=\"flex gap-2\">\n                <Button onClick={this.handleRetry} variant=\"default\">\n                  <RefreshCw className=\"h-4 w-4 mr-2\" />\n                  Try Again\n                </Button>\n                <Button \n                  onClick={this.handleReload} \n                  variant=\"outline\"\n                >\n                  <RefreshCw className=\"h-4 w-4 mr-2\" />\n                  Reload Page\n                </Button>\n                <Button \n                  onClick={this.handleGoHome} \n                  variant=\"outline\"\n                >\n                  <Home className=\"h-4 w-4 mr-2\" />\n                  Go Home\n                </Button>\n              </div>\n              \n              {this.state.errorCount >= 3 && (\n                <p className=\"text-xs text-muted-foreground\">\n                  Auto-refreshing in 5 seconds...\n                </p>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ErrorWrapper.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Something went wrong loading this component\"","line":16,"column":15,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":16,"endColumn":58},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Something went wrong loading this component</span>","line":16,"column":15,"nodeType":"JSXText","endLine":16,"endColumn":58}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { ErrorBoundary } from './ErrorBoundary';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { AlertTriangle } from 'lucide-react';\n\ninterface ErrorWrapperProps {\n  children: React.ReactNode;\n  fallback?: React.ReactNode;\n}\n\nconst DefaultErrorFallback = () => (\n  <Card className=\"border-destructive/20\">\n    <CardContent className=\"p-6\">\n      <div className=\"flex items-center gap-3 text-destructive\">\n        <AlertTriangle className=\"h-5 w-5\" />\n        <span>Something went wrong loading this component</span>\n      </div>\n    </CardContent>\n  </Card>\n);\n\nexport const ErrorWrapper: React.FC<ErrorWrapperProps> = ({ \n  children, \n  fallback = <DefaultErrorFallback /> \n}) => {\n  return (\n    <ErrorBoundary fallback={fallback}>\n      {children}\n    </ErrorBoundary>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ExportDialog.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"PDF\"","line":69,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":69,"endColumn":44},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"CSV\"","line":70,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":70,"endColumn":44},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"JSON\"","line":71,"column":42,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":71,"endColumn":46}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogFooter } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Switch } from '@/components/ui/switch';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { Progress } from '@/components/ui/progress';\nimport { Info } from 'lucide-react';\n\nexport type ExportTemplate = 'summary' | 'detailed' | 'presentation';\nexport type ChartQuality = 'standard' | 'high' | 'print';\nexport type ColorScheme = 'default' | 'high-contrast' | 'colorblind-friendly';\n\nexport interface ExportOptions {\n  format: 'pdf' | 'csv' | 'json';\n  template: ExportTemplate;\n  chartQuality: ChartQuality;\n  colorScheme: ColorScheme;\n  includeRawData: boolean;\n}\n\nexport interface ExportDialogProps {\n  open: boolean;\n  onOpenChange: (v: boolean) => void;\n  defaultFormat?: 'pdf' | 'csv' | 'json';\n  onConfirm: (opts: ExportOptions) => void;\n  inProgress?: boolean;\n  progressPercent?: number;\n  onCancel?: () => void;\n  /** If true, dialog closes immediately after confirm. Otherwise parent controls closing. */\n  closeOnConfirm?: boolean;\n}\n\nexport function ExportDialog({ open, onOpenChange, defaultFormat = 'pdf', onConfirm, inProgress = false, progressPercent = 0, onCancel, closeOnConfirm = true }: ExportDialogProps): React.ReactElement {\n  const { t } = useTranslation('analytics');\n  const [format, setFormat] = React.useState<'pdf' | 'csv' | 'json'>(defaultFormat);\n  const [template, setTemplate] = React.useState<ExportTemplate>('detailed');\n  const [quality, setQuality] = React.useState<ChartQuality>('high');\n  const [scheme, setScheme] = React.useState<ColorScheme>('default');\n  const [includeRaw, setIncludeRaw] = React.useState<boolean>(false);\n\n  React.useEffect(() => { setFormat(defaultFormat); }, [defaultFormat]);\n\n  const confirm = () => {\n    onConfirm({ format, template, chartQuality: quality, colorScheme: scheme, includeRawData: includeRaw });\n    if (closeOnConfirm) onOpenChange(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent>\n        <DialogHeader>\n          <DialogTitle>{t('export.dialog.title')}</DialogTitle>\n          <DialogDescription>{t('export.dialog.description')}</DialogDescription>\n        </DialogHeader>\n\n        <div className=\"grid gap-4 py-2\">\n          <div className=\"grid grid-cols-2 items-center gap-3\">\n            <Label htmlFor=\"export-format\" className=\"flex items-center gap-1\">\n              {t('export.options.format')}\n              <span className=\"sr-only\">{t('export.options.formatHelp')}</span>\n            </Label>\n            <Select value={format} onValueChange={(v) => setFormat(v as 'pdf' | 'csv' | 'json')} disabled={inProgress}>\n              <SelectTrigger id=\"export-format\" aria-describedby=\"format-help\">\n                <SelectValue placeholder={t('export.options.selectFormat')} />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"pdf\">PDF</SelectItem>\n                <SelectItem value=\"csv\">CSV</SelectItem>\n                <SelectItem value=\"json\">JSON</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"grid grid-cols-2 items-center gap-3\">\n            <Label htmlFor=\"export-template\">{t('export.options.template')}</Label>\n            <Select value={template} onValueChange={(v) => setTemplate(v as ExportTemplate)} disabled={format !== 'pdf' || inProgress}>\n              <SelectTrigger id=\"export-template\" aria-describedby=\"template-help\">\n                <SelectValue placeholder={t('export.options.selectTemplate')} />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"summary\">{t('export.templates.summary')}</SelectItem>\n                <SelectItem value=\"detailed\">{t('export.templates.detailed')}</SelectItem>\n                <SelectItem value=\"presentation\">{t('export.templates.presentation')}</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"grid grid-cols-2 items-center gap-3\">\n            <Label htmlFor=\"export-quality\">{t('export.options.quality')}</Label>\n            <Select value={quality} onValueChange={(v) => setQuality(v as ChartQuality)} disabled={format !== 'pdf' || inProgress}>\n              <SelectTrigger id=\"export-quality\" aria-describedby=\"quality-help\">\n                <SelectValue placeholder={t('export.options.selectQuality')} />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"standard\">{t('export.quality.standard')}</SelectItem>\n                <SelectItem value=\"high\">{t('export.quality.high')}</SelectItem>\n                <SelectItem value=\"print\">{t('export.quality.print')}</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"grid grid-cols-2 items-center gap-3\">\n            <Label htmlFor=\"export-scheme\" className=\"flex items-center gap-1\">\n              {t('export.options.colorScheme')}\n              <Info className=\"h-3 w-3 text-muted-foreground\" aria-label={t('export.options.colorSchemeHelp')} />\n            </Label>\n            <Select value={scheme} onValueChange={(v) => setScheme(v as ColorScheme)} disabled={format !== 'pdf' || inProgress}>\n              <SelectTrigger id=\"export-scheme\" aria-describedby=\"scheme-help\">\n                <SelectValue placeholder={t('export.options.selectScheme')} />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"default\">{t('export.schemes.default')}</SelectItem>\n                <SelectItem value=\"high-contrast\">{t('export.schemes.highContrast')}</SelectItem>\n                <SelectItem value=\"colorblind-friendly\">{t('export.schemes.colorblindFriendly')}</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"flex items-center justify-between gap-3\">\n            <Label htmlFor=\"export-raw\" className=\"cursor-pointer\">\n              {t('export.options.includeRawData')}\n            </Label>\n            <Switch \n              id=\"export-raw\" \n              checked={includeRaw} \n              onCheckedChange={setIncludeRaw}\n              disabled={inProgress}\n              aria-describedby=\"raw-help\"\n            />\n          </div>\n\n          {inProgress && (\n            <div className=\"space-y-2\">\n              <div className=\"text-sm text-muted-foreground\">{t('export.progress.label')}</div>\n              <Progress value={progressPercent} className=\"h-2\" />\n              <div className=\"text-xs text-muted-foreground\">{Math.max(0, Math.min(100, Math.round(progressPercent)))}%</div>\n            </div>\n          )}\n        </div>\n\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={() => (inProgress ? onCancel?.() : onOpenChange(false))}>\n            {inProgress ? t('common.cancel') : t('common.close')}\n          </Button>\n          {!inProgress && (\n            <Button onClick={confirm} aria-label={t('export.confirmLabel', { format })}>\n              {t('export.button')}\n            </Button>\n          )}\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/GlobalMenu.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { buttonVariants } from '@/components/ui/button-variants';\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from '@/components/ui/dropdown-menu';\nimport { MoreHorizontal, Wrench, FileText, Hand } from 'lucide-react';\nimport { useNavigate } from 'react-router-dom';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { IS_PROD, POC_MODE } from '@/lib/env';\n\nexport const GlobalMenu = (): JSX.Element => {\n  const navigate = useNavigate();\n  const { tCommon } = useTranslation();\n\n  const goReports = useCallback(() => navigate('/reports'), [navigate]);\n  const goDevTools = useCallback(() => navigate('/dev-tools'), [navigate]);\n  const goSettings = useCallback(() => navigate('/settings'), [navigate]);\n  const goTegn = useCallback(() => navigate('/tegn'), [navigate]);\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger\n        className={buttonVariants({ variant: 'ghost', size: 'sm' }) + ' text-muted-foreground hover:text-foreground transition-colors'}\n        aria-label={tCommon('navigation.reports')}\n        data-testid=\"global-menu-trigger\"\n        id=\"global-menu-trigger\"\n      >\n        <MoreHorizontal className=\"h-4 w-4\" />\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\" className=\"backdrop-blur-md bg-popover/90 border border-border/40 shadow-lg\">\n        <DropdownMenuItem onClick={goTegn} className=\"cursor-pointer\" data-testid=\"menu-tegn\">\n          <Hand className=\"h-4 w-4 mr-2\" /> {String(tCommon('navigation.tegnTilTale'))}\n        </DropdownMenuItem>\n        <DropdownMenuItem onClick={goReports} className=\"cursor-pointer\" data-testid=\"menu-reports\">\n          <FileText className=\"h-4 w-4 mr-2\" /> {String(tCommon('navigation.reports'))}\n        </DropdownMenuItem>\n        <DropdownMenuItem onClick={goSettings} className=\"cursor-pointer\" data-testid=\"menu-settings\">\n          <svg className=\"h-4 w-4 mr-2\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\"><path d=\"M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z\"/><path d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9c0 .66.26 1.3.73 1.77.47.47 1.11.73 1.77.73H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1Z\"/></svg>\n          {String(tCommon('navigation.settings'))}\n        </DropdownMenuItem>\n        {(!IS_PROD || POC_MODE) && (\n          <DropdownMenuItem onClick={goDevTools} className=\"cursor-pointer\" data-testid=\"menu-devtools\">\n            <Wrench className=\"h-4 w-4 mr-2\" /> {String(tCommon('navigation.devTools'))}\n          </DropdownMenuItem>\n        )}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/GoalManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used. Allowed unused vars must match /^_/u.","line":22,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'editingGoal' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":46,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":46,"endColumn":21},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"IEP Goals\"","line":292,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":292,"endColumn":71},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-2xl font-bold text-foreground\">IEP Goals</h2>","line":292,"column":62,"nodeType":"JSXText","endLine":292,"endColumn":71},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Track and monitor\"","line":293,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":293,"endColumn":66},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">Track and monitor {student.name}'s progress toward educational objectives</p>","line":293,"column":48,"nodeType":"JSXText","endLine":293,"endColumn":66},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"'s progress toward educational objectives\"","line":293,"column":80,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":293,"endColumn":121},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">Track and monitor {student.name}'s progress toward educational objectives</p>","line":293,"column":80,"nodeType":"JSXText","endLine":293,"endColumn":121},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"New Goal\"","line":298,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":300,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button className=\"bg-gradient-primary hover:opacity-90 font-dyslexia\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Goal\n            </Button>","line":298,"column":48,"nodeType":"JSXText","endLine":300,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Create New IEP Goal\"","line":304,"column":28,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":304,"endColumn":47},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DialogTitle>Create New IEP Goal</DialogTitle>","line":304,"column":28,"nodeType":"JSXText","endLine":304,"endColumn":47},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Enter goal details, targets, and measurable objectives.\"","line":305,"column":34,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":307,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DialogDescription>\n                Enter goal details, targets, and measurable objectives.\n              </DialogDescription>","line":305,"column":34,"nodeType":"JSXText","endLine":307,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Goal Title *\"","line":311,"column":40,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":311,"endColumn":52},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"title\">Goal Title *</Label>","line":311,"column":40,"nodeType":"JSXText","endLine":311,"endColumn":52},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Category\"","line":320,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":320,"endColumn":51},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"category\">Category</Label>","line":320,"column":43,"nodeType":"JSXText","endLine":320,"endColumn":51},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Behavioral\"","line":326,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":326,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"behavioral\">Behavioral</SelectItem>","line":326,"column":52,"nodeType":"JSXText","endLine":326,"endColumn":62},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Academic\"","line":327,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":327,"endColumn":58},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"academic\">Academic</SelectItem>","line":327,"column":50,"nodeType":"JSXText","endLine":327,"endColumn":58},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Social\"","line":328,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":328,"endColumn":54},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"social\">Social</SelectItem>","line":328,"column":48,"nodeType":"JSXText","endLine":328,"endColumn":54},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory\"","line":329,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":329,"endColumn":56},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"sensory\">Sensory</SelectItem>","line":329,"column":49,"nodeType":"JSXText","endLine":329,"endColumn":56},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Communication\"","line":330,"column":55,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":330,"endColumn":68},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"communication\">Communication</SelectItem>","line":330,"column":55,"nodeType":"JSXText","endLine":330,"endColumn":68},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Description *\"","line":335,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":335,"endColumn":59},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"description\">Description *</Label>","line":335,"column":46,"nodeType":"JSXText","endLine":335,"endColumn":59},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Measurable Objective *\"","line":344,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":344,"endColumn":67},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"measurable\">Measurable Objective *</Label>","line":344,"column":45,"nodeType":"JSXText","endLine":344,"endColumn":67},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Baseline Value\"","line":354,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":354,"endColumn":59},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"baseline\">Baseline Value</Label>","line":354,"column":45,"nodeType":"JSXText","endLine":354,"endColumn":59},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Target Value\"","line":363,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":363,"endColumn":55},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"target\">Target Value</Label>","line":363,"column":43,"nodeType":"JSXText","endLine":363,"endColumn":55},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Target Date\"","line":373,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":373,"endColumn":56},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"targetDate\">Target Date</Label>","line":373,"column":45,"nodeType":"JSXText","endLine":373,"endColumn":56},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Cancel\"","line":382,"column":104,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":384,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button variant=\"outline\" onClick={() => { resetForm(); setShowCreateDialog(false); }}>\n                  Cancel\n                </Button>","line":382,"column":104,"nodeType":"JSXText","endLine":384,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Create Goal\"","line":385,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":385,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button onClick={createGoal}>Create Goal</Button>","line":385,"column":46,"nodeType":"JSXText","endLine":385,"endColumn":57},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No IEP Goals Yet\"","line":397,"column":72,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":397,"endColumn":88},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-xl font-semibold text-foreground mb-2\">No IEP Goals Yet</h3>","line":397,"column":72,"nodeType":"JSXText","endLine":397,"endColumn":88},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Start by creating your first IEP goal to track\"","line":398,"column":76,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":399,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground text-center mb-6 max-w-md\">\n              Start by creating your first IEP goal to track {student.name}'s educational progress.\n            </p>","line":398,"column":76,"nodeType":"JSXText","endLine":399,"endColumn":62},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"'s educational progress.\"","line":399,"column":76,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":400,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground text-center mb-6 max-w-md\">\n              Start by creating your first IEP goal to track {student.name}'s educational progress.\n            </p>","line":399,"column":76,"nodeType":"JSXText","endLine":400,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Create First Goal\"","line":402,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":404,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button onClick={() => setShowCreateDialog(true)} className=\"bg-gradient-primary hover:opacity-90 font-dyslexia\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Create First Goal\n            </Button>","line":402,"column":48,"nodeType":"JSXText","endLine":404,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Progress\"","line":442,"column":59,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":442,"endColumn":67},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-sm font-medium\">Progress</span>","line":442,"column":59,"nodeType":"JSXText","endLine":442,"endColumn":67},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Measurable Objective\"","line":450,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":450,"endColumn":72},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-medium mb-2\">Measurable Objective</h4>","line":450,"column":52,"nodeType":"JSXText","endLine":450,"endColumn":72},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Created:\"","line":460,"column":27,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":460,"endColumn":36},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Created: {format(goal.createdDate, 'MMM dd, yyyy')}</span>","line":460,"column":27,"nodeType":"JSXText","endLine":460,"endColumn":36},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Target:\"","line":464,"column":27,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":464,"endColumn":35},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Target: {format(goal.targetDate, 'MMM dd, yyyy')}</span>","line":464,"column":27,"nodeType":"JSXText","endLine":464,"endColumn":35},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Milestones\"","line":471,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":471,"endColumn":59},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-medium\">Milestones</h4>","line":471,"column":49,"nodeType":"JSXText","endLine":471,"endColumn":59},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Add\"","line":484,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":486,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button \n                      variant=\"outline\" \n                      size=\"sm\"\n                      onClick={() => {\n                        const title = prompt(\"Milestone title:\");\n                        const description = prompt(\"Milestone description:\");\n                        const dateStr = prompt(\"Target date (YYYY-MM-DD):\");\n                        if (title && description && dateStr) {\n                          addMilestone(goal.id, title, description, new Date(dateStr));\n                        }\n                      }}\n                    >\n                      <Plus className=\"h-3 w-3 mr-1\" />\n                      Add\n                    </Button>","line":484,"column":56,"nodeType":"JSXText","endLine":486,"endColumn":21},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No milestones yet\"","line":489,"column":66,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":489,"endColumn":83},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground\">No milestones yet</p>","line":489,"column":66,"nodeType":"JSXText","endLine":489,"endColumn":83},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Update Progress\"","line":532,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":534,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => {\n                      const value = prompt(\"Enter current progress value:\");\n                      const notes = prompt(\"Progress notes (optional):\");\n                      if (value) {\n                        addDataPoint(goal.id, Number(value), notes || undefined);\n                      }\n                    }}\n                  >\n                    <TrendingUp className=\"h-4 w-4 mr-1\" />\n                    Update Progress\n                  </Button>","line":532,"column":60,"nodeType":"JSXText","endLine":534,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":66,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * @fileoverview GoalManager - Comprehensive goal tracking and management system\n * \n * Provides functionality for creating, tracking, and managing student IEP goals.\n * Supports milestones, progress tracking, and various goal categories.\n * \n * @module components/GoalManager\n */\n\nimport { useState, useEffect, useCallback } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogDescription } from \"@/components/ui/dialog\";\nimport { Goal, Student, GoalDataPoint, Milestone } from \"@/types/student\";\nimport { dataStorage } from \"@/lib/dataStorage\";\nimport { Calendar, Plus, Crosshair, TrendingUp, CheckCircle, Edit, Trash2, Calendar as CalendarIcon } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { format } from \"date-fns\";\nimport { logger } from \"@/lib/logger\";\n\ninterface GoalManagerProps {\n  student: Student;\n  onGoalUpdate?: () => void;\n}\n\n/**\n * GoalManager Component\n * \n * Manages IEP goals for a specific student, including creation, tracking,\n * progress monitoring, and milestone management.\n * \n * @component\n * @param {GoalManagerProps} props - Component props\n * @param {Student} props.student - The student whose goals are being managed\n * @param {Function} [props.onGoalUpdate] - Callback when goals are updated\n */\nexport const GoalManager = ({ student, onGoalUpdate }: GoalManagerProps) => {\n  const [goals, setGoals] = useState<Goal[]>([]);\n  const [showCreateDialog, setShowCreateDialog] = useState(false);\n  const [editingGoal, setEditingGoal] = useState<Goal | null>(null);\n  const [newGoal, setNewGoal] = useState({\n    title: \"\",\n    description: \"\",\n    category: \"behavioral\" as Goal['category'],\n    measurableObjective: \"\",\n    targetDate: \"\",\n    targetValue: 100,\n    baselineValue: 0\n  });\n\n  /**\n   * Load goals for the current student.\n   * Memoized to prevent recreation on every render.\n   */\n  const loadGoals = useCallback(() => {\n    const allGoals = dataStorage.getGoals();\n    const studentGoals = allGoals.filter(goal => goal.studentId === student.id);\n    setGoals(studentGoals);\n  }, [student.id]);\n\n  /**\n   * Effect to load goals when student changes.\n   */\n  useEffect(() => {\n    loadGoals();\n  }, [loadGoals]);\n\n  /**\n   * Generate a unique ID using crypto.randomUUID or fallback.\n   * This is more secure and collision-resistant than Math.random().\n   * \n   * @returns {string} A unique identifier\n   */\n  const generateId = (): string => {\n    // Use crypto.randomUUID if available (modern browsers)\n    if (typeof crypto !== 'undefined' && crypto.randomUUID) {\n      return crypto.randomUUID();\n    }\n    \n    // Fallback to timestamp + random for older browsers\n    // This is still much better than Math.random().toString(36)\n    const timestamp = Date.now().toString(36);\n    const randomPart = Math.random().toString(36).substring(2, 11);\n    const randomPart2 = Math.random().toString(36).substring(2, 11);\n    return `${timestamp}-${randomPart}-${randomPart2}`;\n  };\n\n  const createGoal = () => {\n    // Validate required fields\n    if (!newGoal.title.trim() || !newGoal.description.trim() || !newGoal.measurableObjective.trim()) {\n      toast.error(\"Please fill in all required fields\");\n      return;\n    }\n\n    // Validate target date\n    if (!newGoal.targetDate) {\n      toast.error(\"Please select a target date\");\n      return;\n    }\n\n    const targetDate = new Date(newGoal.targetDate);\n    if (isNaN(targetDate.getTime())) {\n      toast.error(\"Invalid target date\");\n      return;\n    }\n\n    // Ensure target date is in the future\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    if (targetDate < today) {\n      toast.error(\"Target date must be in the future\");\n      return;\n    }\n\n    // Validate baseline and target values\n    if (newGoal.targetValue <= newGoal.baselineValue) {\n      toast.error(\"Target value must be greater than baseline value\");\n      return;\n    }\n\n    const goal: Goal = {\n      id: generateId(),\n      studentId: student.id,\n      title: newGoal.title,\n      description: newGoal.description,\n      category: newGoal.category,\n      targetDate,\n      createdDate: new Date(),\n      status: \"active\",\n      measurableObjective: newGoal.measurableObjective,\n      currentProgress: 0,\n      milestones: [],\n      interventions: [],\n      baselineValue: newGoal.baselineValue,\n      targetValue: newGoal.targetValue,\n      dataPoints: [{\n        id: generateId(),\n        timestamp: new Date(),\n        value: newGoal.baselineValue,\n        notes: \"Baseline measurement\",\n        collectedBy: \"Teacher\"\n      }]\n    };\n\n    dataStorage.saveGoal(goal);\n    loadGoals();\n    resetForm();\n    setShowCreateDialog(false);\n    toast.success(\"Goal created successfully!\");\n    onGoalUpdate?.();\n  };\n\n  const updateGoal = (goalId: string, updates: Partial<Goal>) => {\n    const goalToUpdate = goals.find(g => g.id === goalId);\n    if (!goalToUpdate) return;\n\n    const updatedGoal = { ...goalToUpdate, ...updates };\n    dataStorage.saveGoal(updatedGoal);\n    loadGoals();\n    onGoalUpdate?.();\n  };\n\n  const addDataPoint = (goalId: string, value: number, notes?: string) => {\n    const goal = goals.find(g => g.id === goalId);\n    if (!goal) return;\n\n    const newDataPoint: GoalDataPoint = {\n      id: generateId(),\n      timestamp: new Date(),\n      value,\n      notes,\n      collectedBy: \"Teacher\"\n    };\n\n    const updatedDataPoints = [...goal.dataPoints, newDataPoint];\n    const progress = goal.targetValue ? ((value - (goal.baselineValue || 0)) / (goal.targetValue - (goal.baselineValue || 0))) * 100 : 0;\n    \n    updateGoal(goalId, {\n      dataPoints: updatedDataPoints,\n      currentProgress: Math.max(0, Math.min(100, progress))\n    });\n\n    toast.success(\"Progress updated!\");\n  };\n\n  const addMilestone = (goalId: string, title: string, description: string, targetDate: Date) => {\n    const goal = goals.find(g => g.id === goalId);\n    if (!goal) return;\n\n    const newMilestone: Milestone = {\n      id: generateId(),\n      title,\n      description,\n      targetDate,\n      isCompleted: false\n    };\n\n    updateGoal(goalId, {\n      milestones: [...goal.milestones, newMilestone]\n    });\n\n    toast.success(\"Milestone added!\");\n  };\n\n  const completeMilestone = (goalId: string, milestoneId: string) => {\n    const goal = goals.find(g => g.id === goalId);\n    if (!goal) return;\n\n    const updatedMilestones = goal.milestones.map(m =>\n      m.id === milestoneId \n        ? { ...m, isCompleted: true, completedDate: new Date() }\n        : m\n    );\n\n    updateGoal(goalId, { milestones: updatedMilestones });\n    toast.success(\"Milestone completed! 🎉\");\n  };\n\n  /**\n   * Delete a goal with proper confirmation and efficient storage update.\n   * \n   * @param {string} goalId - ID of the goal to delete\n   */\n  const deleteGoal = (goalId: string) => {\n    const goal = goals.find(g => g.id === goalId);\n    if (!goal) {\n      logger.warn('Attempted to delete non-existent goal', { goalId });\n      return;\n    }\n\n    try {\n      const confirmed = window.confirm(`Are you sure you want to delete the goal \"${goal.title}\"?`);\n      if (confirmed) {\n        // More efficient deletion: mark as deleted instead of rewriting all goals\n        const updatedGoal = { ...goal, status: 'discontinued' as Goal['status'], deletedAt: new Date() };\n        dataStorage.saveGoal(updatedGoal);\n        loadGoals();\n        toast.success(\"Goal deleted\");\n        onGoalUpdate?.();\n      }\n    } catch (error) {\n      logger.error('Failed to delete goal', error);\n      toast.error('Failed to delete goal. Please try again.');\n    }\n  };\n\n  const resetForm = () => {\n    setNewGoal({\n      title: \"\",\n      description: \"\",\n      category: \"behavioral\",\n      measurableObjective: \"\",\n      targetDate: \"\",\n      targetValue: 100,\n      baselineValue: 0\n    });\n    setEditingGoal(null);\n  };\n\n  const getStatusColor = (status: Goal['status']) => {\n    switch (status) {\n      case 'active': return 'bg-blue-500';\n      case 'achieved': return 'bg-green-500';\n      case 'modified': return 'bg-yellow-500';\n      case 'discontinued': return 'bg-red-500';\n      default: return 'bg-gray-500';\n    }\n  };\n\n  const getCategoryIcon = (category: Goal['category']) => {\n    switch (category) {\n      case 'behavioral': return '🎯';\n      case 'academic': return '📚';\n      case 'social': return '👥';\n      case 'sensory': return '🎨';\n      case 'communication': return '💬';\n      default: return '📋';\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-foreground\">IEP Goals</h2>\n          <p className=\"text-muted-foreground\">Track and monitor {student.name}'s progress toward educational objectives</p>\n        </div>\n        <Dialog open={showCreateDialog} onOpenChange={setShowCreateDialog}>\n          <DialogTrigger asChild>\n            <Button className=\"bg-gradient-primary hover:opacity-90 font-dyslexia\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              New Goal\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl\">\n            <DialogHeader>\n              <DialogTitle>Create New IEP Goal</DialogTitle>\n              <DialogDescription>\n                Enter goal details, targets, and measurable objectives.\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"title\">Goal Title *</Label>\n                <Input\n                  id=\"title\"\n                  value={newGoal.title}\n                  onChange={(e) => setNewGoal(prev => ({ ...prev, title: e.target.value }))}\n                  placeholder=\"e.g., Improve emotional regulation during transitions\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"category\">Category</Label>\n                <Select value={newGoal.category} onValueChange={(value: Goal['category']) => setNewGoal(prev => ({ ...prev, category: value }))}>\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"behavioral\">Behavioral</SelectItem>\n                    <SelectItem value=\"academic\">Academic</SelectItem>\n                    <SelectItem value=\"social\">Social</SelectItem>\n                    <SelectItem value=\"sensory\">Sensory</SelectItem>\n                    <SelectItem value=\"communication\">Communication</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div>\n                <Label htmlFor=\"description\">Description *</Label>\n                <Textarea\n                  id=\"description\"\n                  value={newGoal.description}\n                  onChange={(e) => setNewGoal(prev => ({ ...prev, description: e.target.value }))}\n                  placeholder=\"Detailed description of what the student will achieve...\"\n                />\n              </div>\n              <div>\n                <Label htmlFor=\"measurable\">Measurable Objective *</Label>\n                <Textarea\n                  id=\"measurable\"\n                  value={newGoal.measurableObjective}\n                  onChange={(e) => setNewGoal(prev => ({ ...prev, measurableObjective: e.target.value }))}\n                  placeholder=\"How will progress be measured? Include specific criteria...\"\n                />\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"baseline\">Baseline Value</Label>\n                  <Input\n                    id=\"baseline\"\n                    type=\"number\"\n                    value={newGoal.baselineValue}\n                    onChange={(e) => setNewGoal(prev => ({ ...prev, baselineValue: Number(e.target.value) }))}\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"target\">Target Value</Label>\n                  <Input\n                    id=\"target\"\n                    type=\"number\"\n                    value={newGoal.targetValue}\n                    onChange={(e) => setNewGoal(prev => ({ ...prev, targetValue: Number(e.target.value) }))}\n                  />\n                </div>\n              </div>\n              <div>\n                <Label htmlFor=\"targetDate\">Target Date</Label>\n                <Input\n                  id=\"targetDate\"\n                  type=\"date\"\n                  value={newGoal.targetDate}\n                  onChange={(e) => setNewGoal(prev => ({ ...prev, targetDate: e.target.value }))}\n                />\n              </div>\n              <div className=\"flex gap-2 justify-end\">\n                <Button variant=\"outline\" onClick={() => { resetForm(); setShowCreateDialog(false); }}>\n                  Cancel\n                </Button>\n                <Button onClick={createGoal}>Create Goal</Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Goals List */}\n      {goals.length === 0 ? (\n        <Card className=\"bg-gradient-card border-0 shadow-soft\">\n          <CardContent className=\"flex flex-col items-center justify-center py-16\">\n            <Crosshair className=\"h-16 w-16 text-muted-foreground mb-4\" />\n            <h3 className=\"text-xl font-semibold text-foreground mb-2\">No IEP Goals Yet</h3>\n            <p className=\"text-muted-foreground text-center mb-6 max-w-md\">\n              Start by creating your first IEP goal to track {student.name}'s educational progress.\n            </p>\n            <Button onClick={() => setShowCreateDialog(true)} className=\"bg-gradient-primary hover:opacity-90 font-dyslexia\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Create First Goal\n            </Button>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid gap-6\">\n          {goals.map((goal) => (\n            <Card key={goal.id} className=\"bg-gradient-card border-0 shadow-soft\">\n              <CardHeader>\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex items-start gap-3\">\n                    <span className=\"text-2xl\">{getCategoryIcon(goal.category)}</span>\n                    <div>\n                      <CardTitle className=\"flex items-center gap-2\">\n                        {goal.title}\n                        <Badge variant=\"outline\" className={`${getStatusColor(goal.status)} text-white border-0`}>\n                          {goal.status}\n                        </Badge>\n                      </CardTitle>\n                      <p className=\"text-muted-foreground mt-1\">{goal.description}</p>\n                      <Badge variant=\"secondary\" className=\"mt-2\">\n                        {goal.category}\n                      </Badge>\n                    </div>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <Button variant=\"ghost\" size=\"icon\" aria-label=\"Edit goal\" title=\"Edit goal\">\n                      <Edit className=\"h-4 w-4\" />\n                    </Button>\n                    <Button variant=\"ghost\" size=\"icon\" aria-label=\"Delete goal\" title=\"Delete goal\" onClick={() => deleteGoal(goal.id)}>\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                {/* Progress */}\n                <div className=\"mb-6\">\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <span className=\"text-sm font-medium\">Progress</span>\n                    <span className=\"text-sm text-muted-foreground\">{Math.round(goal.currentProgress)}%</span>\n                  </div>\n                  <Progress value={goal.currentProgress} className=\"h-3\" />\n                </div>\n\n                {/* Measurable Objective */}\n                <div className=\"mb-4\">\n                  <h4 className=\"font-medium mb-2\">Measurable Objective</h4>\n                  <p className=\"text-sm text-muted-foreground bg-muted/50 p-3 rounded-lg\">\n                    {goal.measurableObjective}\n                  </p>\n                </div>\n\n                {/* Timeline */}\n                <div className=\"flex items-center gap-4 mb-4\">\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <CalendarIcon className=\"h-4 w-4 text-muted-foreground\" />\n                    <span>Created: {format(goal.createdDate, 'MMM dd, yyyy')}</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <Crosshair className=\"h-4 w-4 text-muted-foreground\" />\n                    <span>Target: {format(goal.targetDate, 'MMM dd, yyyy')}</span>\n                  </div>\n                </div>\n\n                {/* Milestones */}\n                <div className=\"mb-4\">\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <h4 className=\"font-medium\">Milestones</h4>\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\"\n                      onClick={() => {\n                        const title = prompt(\"Milestone title:\");\n                        const description = prompt(\"Milestone description:\");\n                        const dateStr = prompt(\"Target date (YYYY-MM-DD):\");\n                        if (title && description && dateStr) {\n                          addMilestone(goal.id, title, description, new Date(dateStr));\n                        }\n                      }}\n                    >\n                      <Plus className=\"h-3 w-3 mr-1\" />\n                      Add\n                    </Button>\n                  </div>\n                  {goal.milestones.length === 0 ? (\n                    <p className=\"text-sm text-muted-foreground\">No milestones yet</p>\n                  ) : (\n                    <div className=\"space-y-2\">\n                      {goal.milestones.map((milestone) => (\n                        <div key={milestone.id} className=\"flex items-center gap-2 p-2 bg-muted/30 rounded\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            aria-label={milestone.isCompleted ? 'Milestone completed' : 'Mark milestone complete'}\n                            title={milestone.isCompleted ? 'Milestone completed' : 'Mark milestone complete'}\n                            onClick={() => !milestone.isCompleted && completeMilestone(goal.id, milestone.id)}\n                            disabled={milestone.isCompleted}\n                          >\n                            <CheckCircle className={`h-4 w-4 ${milestone.isCompleted ? 'text-green-500' : 'text-muted-foreground'}`} />\n                          </Button>\n                          <div className=\"flex-1\">\n                            <p className={`text-sm ${milestone.isCompleted ? 'line-through text-muted-foreground' : ''}`}>\n                              {milestone.title}\n                            </p>\n                            <p className=\"text-xs text-muted-foreground\">{milestone.description}</p>\n                          </div>\n                          <span className=\"text-xs text-muted-foreground\">\n                            {format(milestone.targetDate, 'MMM dd')}\n                          </span>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </div>\n\n                {/* Quick Progress Update */}\n                <div className=\"flex gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => {\n                      const value = prompt(\"Enter current progress value:\");\n                      const notes = prompt(\"Progress notes (optional):\");\n                      if (value) {\n                        addDataPoint(goal.id, Number(value), notes || undefined);\n                      }\n                    }}\n                  >\n                    <TrendingUp className=\"h-4 w-4 mr-1\" />\n                    Update Progress\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/HelpAndSupport.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/InteractiveDataVisualization.debug.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":105,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":108,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[296,299],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[296,299],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Interactive Data Visualization Debug\"","line":17,"column":20,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":17,"endColumn":56},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle>Interactive Data Visualization Debug</CardTitle>","line":17,"column":20,"nodeType":"JSXText","endLine":17,"endColumn":56},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Debug mode active - checking component loading\"","line":23,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":23,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Debug mode active - checking component loading</p>","line":23,"column":16,"nodeType":"JSXText","endLine":23,"endColumn":62},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotions:\"","line":26,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":26,"endColumn":26},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Emotions: {emotions?.length || 0} entries</p>","line":26,"column":16,"nodeType":"JSXText","endLine":26,"endColumn":26},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"entries\"","line":26,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":26,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Emotions: {emotions?.length || 0} entries</p>","line":26,"column":49,"nodeType":"JSXText","endLine":26,"endColumn":57},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory Inputs:\"","line":27,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":27,"endColumn":32},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Sensory Inputs: {sensoryInputs?.length || 0} entries</p>","line":27,"column":16,"nodeType":"JSXText","endLine":27,"endColumn":32},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"entries\"","line":27,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":27,"endColumn":68},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Sensory Inputs: {sensoryInputs?.length || 0} entries</p>","line":27,"column":60,"nodeType":"JSXText","endLine":27,"endColumn":68},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Tracking Entries:\"","line":28,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":28,"endColumn":34},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Tracking Entries: {trackingEntries?.length || 0} entries</p>","line":28,"column":16,"nodeType":"JSXText","endLine":28,"endColumn":34},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"entries\"","line":28,"column":64,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":28,"endColumn":72},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Tracking Entries: {trackingEntries?.length || 0} entries</p>","line":28,"column":64,"nodeType":"JSXText","endLine":28,"endColumn":72},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Student Name:\"","line":29,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":29,"endColumn":30},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Student Name: {studentName || 'Not provided'}</p>","line":29,"column":16,"nodeType":"JSXText","endLine":29,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":19,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { AlertCircle } from 'lucide-react';\nimport { logger } from '@/lib/logger';\n\nexport const InteractiveDataVisualization = ({ emotions, sensoryInputs, trackingEntries, studentName }: any) => {\n  logger.debug('[DEBUG] InteractiveDataVisualization props:', {\n    emotions: emotions?.length,\n    sensoryInputs: sensoryInputs?.length,\n    trackingEntries: trackingEntries?.length,\n    studentName\n  });\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle>Interactive Data Visualization Debug</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-4\">\n          <div className=\"flex items-center gap-2 text-yellow-600\">\n            <AlertCircle className=\"h-5 w-5\" />\n            <p>Debug mode active - checking component loading</p>\n          </div>\n          <div className=\"text-sm space-y-2\">\n            <p>Emotions: {emotions?.length || 0} entries</p>\n            <p>Sensory Inputs: {sensoryInputs?.length || 0} entries</p>\n            <p>Tracking Entries: {trackingEntries?.length || 0} entries</p>\n            <p>Student Name: {studentName || 'Not provided'}</p>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/InteractiveDataVisualization.diagnosis.tsx","messages":[{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":29,"column":40,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":29,"endColumn":64},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":34,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":34,"endColumn":51,"suggestions":[{"messageId":"addBrackets","fix":{"range":[1169,1342],"text":"{ logger.debug('Testing ECharts import...');\n          const echarts = await import('echarts');\n          if (!echarts) throw new Error('ECharts not loaded');\n          break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":40,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":40,"endColumn":65,"suggestions":[{"messageId":"addBrackets","fix":{"range":[1391,1602],"text":"{ logger.debug('Testing hooks import...');\n          const hooks = await import('@/hooks/useRealtimeData');\n          if (!hooks.useRealtimeData) throw new Error('useRealtimeData hook not found');\n          break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":46,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":50,"endColumn":14,"suggestions":[{"messageId":"addBrackets","fix":{"range":[1660,2262],"text":"{ logger.debug('Testing sub-components import...');\n          const [viz3d, timeline, filter] = await Promise.all([\n            import('@/components/lazy/LazyVisualization3D'),\n            import('@/components/TimelineVisualization'),\n            import('@/components/AdvancedFilterPanel')\n          ]);\n          if (!viz3d.LazyVisualization3D) throw new Error('LazyVisualization3D not found');\n          if (!timeline.TimelineVisualization) throw new Error('TimelineVisualization not found');\n          if (!filter.AdvancedFilterPanel) throw new Error('AdvancedFilterPanel not found');\n          break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2436,2439],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2436,2439],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":81,"column":38,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":81,"endColumn":62},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Interactive Data Visualization - Diagnosis\"","line":99,"column":20,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":99,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle>Interactive Data Visualization - Diagnosis</CardTitle>","line":99,"column":20,"nodeType":"JSXText","endLine":99,"endColumn":62},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Running diagnostic tests to identify loading issues...\"","line":103,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":105,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Diagnosis Summary\"","line":122,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":122,"endColumn":63},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-medium mb-2\">Diagnosis Summary</h4>","line":122,"column":46,"nodeType":"JSXText","endLine":122,"endColumn":63},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Total Tests:\"","line":124,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":124,"endColumn":31},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Total Tests: {tests.length}</p>","line":124,"column":18,"nodeType":"JSXText","endLine":124,"endColumn":31},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Passed:\"","line":125,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":125,"endColumn":26},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Passed: {tests.filter(t => t.status === 'passed').length}</p>","line":125,"column":18,"nodeType":"JSXText","endLine":125,"endColumn":26},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Failed:\"","line":126,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":126,"endColumn":26},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Failed: {tests.filter(t => t.status === 'failed').length}</p>","line":126,"column":18,"nodeType":"JSXText","endLine":126,"endColumn":26},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Refresh Page\"","line":134,"column":12,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":136,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button \n            onClick={() => window.location.reload()} \n            variant=\"outline\"\n            className=\"w-full\"\n          >\n            Refresh Page\n          </Button>","line":134,"column":12,"nodeType":"JSXText","endLine":136,"endColumn":11}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'runTest' and 'tests.length'. Either include them or remove the dependency array.","line":85,"column":6,"nodeType":"ArrayExpression","endLine":85,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [runTest, tests.length]","fix":{"range":[3272,3274],"text":"[runTest, tests.length]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":19,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { AlertCircle, CheckCircle, XCircle, Loader } from 'lucide-react';\nimport { logger } from '@/lib/logger';\n\nexport const InteractiveDataVisualizationDiagnosis = () => {\n  const [tests, setTests] = useState<{\n    name: string;\n    status: 'pending' | 'testing' | 'passed' | 'failed';\n    error?: string;\n  }[]>([\n    { name: 'Component Props', status: 'pending' },\n    { name: 'ECharts Import', status: 'pending' },\n    { name: 'Hooks Import', status: 'pending' },\n    { name: 'Sub-components Import', status: 'pending' },\n    { name: 'Memory Usage', status: 'pending' },\n  ]);\n\n  const runTest = async (index: number) => {\n    const newTests = [...tests];\n    newTests[index].status = 'testing';\n    setTests(newTests);\n\n    try {\n      switch (index) {\n        case 0: // Component Props Test\n          logger.debug('Testing component props...');\n          await new Promise(resolve => setTimeout(resolve, 100));\n          break;\n\n        case 1: // ECharts Import Test\n          logger.debug('Testing ECharts import...');\n          const echarts = await import('echarts');\n          if (!echarts) throw new Error('ECharts not loaded');\n          break;\n\n        case 2: // Hooks Import Test\n          logger.debug('Testing hooks import...');\n          const hooks = await import('@/hooks/useRealtimeData');\n          if (!hooks.useRealtimeData) throw new Error('useRealtimeData hook not found');\n          break;\n\n        case 3: // Sub-components Import Test\n          logger.debug('Testing sub-components import...');\n          const [viz3d, timeline, filter] = await Promise.all([\n            import('@/components/lazy/LazyVisualization3D'),\n            import('@/components/TimelineVisualization'),\n            import('@/components/AdvancedFilterPanel')\n          ]);\n          if (!viz3d.LazyVisualization3D) throw new Error('LazyVisualization3D not found');\n          if (!timeline.TimelineVisualization) throw new Error('TimelineVisualization not found');\n          if (!filter.AdvancedFilterPanel) throw new Error('AdvancedFilterPanel not found');\n          break;\n\n        case 4: // Memory Usage Test\n          logger.debug('Testing memory usage...');\n          if ('memory' in performance) {\n            const memory = (performance as any).memory;\n            const usedPercent = memory.usedJSHeapSize / memory.jsHeapSizeLimit;\n            if (usedPercent > 0.9) throw new Error('Memory usage too high: ' + Math.round(usedPercent * 100) + '%');\n          }\n          break;\n      }\n\n      newTests[index].status = 'passed';\n    } catch (error) {\n      newTests[index].status = 'failed';\n      newTests[index].error = error instanceof Error ? error.message : String(error);\n      logger.error(`Test ${tests[index].name} failed:`, error);\n    }\n\n    setTests(newTests);\n  };\n\n  useEffect(() => {\n    // Run all tests sequentially\n    const runAllTests = async () => {\n      for (let i = 0; i < tests.length; i++) {\n        await runTest(i);\n        await new Promise(resolve => setTimeout(resolve, 500)); // Small delay between tests\n      }\n    };\n    runAllTests();\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n  const getStatusIcon = (status: string) => {\n    switch (status) {\n      case 'pending': return <AlertCircle className=\"h-4 w-4 text-gray-400\" />;\n      case 'testing': return <Loader className=\"h-4 w-4 text-blue-500 animate-spin\" />;\n      case 'passed': return <CheckCircle className=\"h-4 w-4 text-green-500\" />;\n      case 'failed': return <XCircle className=\"h-4 w-4 text-red-500\" />;\n    }\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle>Interactive Data Visualization - Diagnosis</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-4\">\n          <p className=\"text-sm text-muted-foreground\">\n            Running diagnostic tests to identify loading issues...\n          </p>\n          \n          <div className=\"space-y-2\">\n            {tests.map((test) => (\n              <div key={test.name} className=\"flex items-center justify-between p-3 border rounded-lg\">\n                <div className=\"flex items-center gap-3\">\n                  {getStatusIcon(test.status)}\n                  <span className=\"font-medium\">{test.name}</span>\n                </div>\n                {test.error && (\n                  <span className=\"text-sm text-red-500\">{test.error}</span>\n                )}\n              </div>\n            ))}\n          </div>\n\n          <div className=\"mt-6 p-4 bg-muted rounded-lg\">\n            <h4 className=\"font-medium mb-2\">Diagnosis Summary</h4>\n            <div className=\"text-sm space-y-1\">\n              <p>Total Tests: {tests.length}</p>\n              <p>Passed: {tests.filter(t => t.status === 'passed').length}</p>\n              <p>Failed: {tests.filter(t => t.status === 'failed').length}</p>\n            </div>\n          </div>\n\n          <Button \n            onClick={() => window.location.reload()} \n            variant=\"outline\"\n            className=\"w-full\"\n          >\n            Refresh Page\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n\n// Export as default for lazy loading\nexport const InteractiveDataVisualization = InteractiveDataVisualizationDiagnosis;\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/InteractiveDataVisualization.minimal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[357,360],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[357,360],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[381,384],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[381,384],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[407,410],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[407,410],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Interactive Data Visualization -\"","line":21,"column":44,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":22,"endColumn":44},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n          <BarChart3 className=\"h-5 w-5\" />\n          Interactive Data Visualization - {studentName}\n        </CardTitle>","line":21,"column":44,"nodeType":"JSXText","endLine":22,"endColumn":44},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"This is a minimal version of the component for testing.\"","line":27,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":29,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-lg text-muted-foreground\">\n            This is a minimal version of the component for testing.\n          </p>","line":27,"column":56,"nodeType":"JSXText","endLine":29,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotions:\"","line":31,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":31,"endColumn":26},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Emotions: {emotions.length} entries</p>","line":31,"column":16,"nodeType":"JSXText","endLine":31,"endColumn":26},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"entries\"","line":31,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":31,"endColumn":51},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Emotions: {emotions.length} entries</p>","line":31,"column":43,"nodeType":"JSXText","endLine":31,"endColumn":51},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory Inputs:\"","line":32,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":32,"endColumn":32},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Sensory Inputs: {sensoryInputs.length} entries</p>","line":32,"column":16,"nodeType":"JSXText","endLine":32,"endColumn":32},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"entries\"","line":32,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":32,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Sensory Inputs: {sensoryInputs.length} entries</p>","line":32,"column":54,"nodeType":"JSXText","endLine":32,"endColumn":62},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Tracking Entries:\"","line":33,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":33,"endColumn":34},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Tracking Entries: {trackingEntries.length} entries</p>","line":33,"column":16,"nodeType":"JSXText","endLine":33,"endColumn":34},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"entries\"","line":33,"column":58,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":33,"endColumn":66},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Tracking Entries: {trackingEntries.length} entries</p>","line":33,"column":58,"nodeType":"JSXText","endLine":33,"endColumn":66}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":19,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { BarChart3 } from 'lucide-react';\n\n// Minimal version without complex dependencies\nexport const InteractiveDataVisualization = ({ \n  emotions = [], \n  sensoryInputs = [], \n  trackingEntries = [], \n  studentName = 'Student' \n}: {\n  emotions: any[];\n  sensoryInputs: any[];\n  trackingEntries: any[];\n  studentName: string;\n}) => {\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <BarChart3 className=\"h-5 w-5\" />\n          Interactive Data Visualization - {studentName}\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"text-center py-8\">\n          <p className=\"text-lg text-muted-foreground\">\n            This is a minimal version of the component for testing.\n          </p>\n          <div className=\"mt-4 space-y-2 text-sm\">\n            <p>Emotions: {emotions.length} entries</p>\n            <p>Sensory Inputs: {sensoryInputs.length} entries</p>\n            <p>Tracking Entries: {trackingEntries.length} entries</p>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/InteractiveDataVisualization.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[250,253],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[250,253],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[377,380],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[377,380],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1158,1161],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1158,1161],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1650,1653],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1650,1653],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":228,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7300,7303],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7300,7303],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":229,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7341,7344],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7341,7344],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":230,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":230,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7378,7381],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7378,7381],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { describe, it, expect, vi, beforeAll } from 'vitest';\nimport { render, screen, waitFor, within } from '@testing-library/react';\nimport userEvent from '@testing-library/user-event';\nlet InteractiveDataVisualization: any;\n\n// Mock the dependencies\nvi.mock('@/components/charts/EChartContainer', () => ({\n  EChartContainer: ({ option, height }: any) => (\n    <div data-testid=\"echart-container\" style={{ height }}>\n      EChart Mock - {JSON.stringify(option?.title?.text || 'No title')}\n    </div>\n  )\n}));\n\n// Mock ChartKit builders to return minimal valid options\nvi.mock('@/components/charts/ChartKit', () => ({\n  buildEmotionTrendsOption: () => ({ series: [{ type: 'line', data: [] }], title: { text: 'Mock Trends' } }),\n  buildAreaOption: () => ({ series: [{ type: 'line', areaStyle: {}, data: [] }] }),\n  buildScatterOption: () => ({ series: [{ type: 'scatter', data: [] }] }),\n  buildComposedOption: () => ({ series: [{ type: 'line', data: [] }, { type: 'bar', data: [] }] }),\n  buildCorrelationHeatmapOption: () => ({ series: [{ type: 'heatmap', data: [] }], title: { text: 'Mock Correlations' } }),\n  TrendRow: {} as any,\n}));\n\nvi.mock('./Visualization3D', () => ({\n  Visualization3D: () => <div data-testid=\"viz-3d\">3D Visualization Mock</div>\n}));\n\nvi.mock('./TimelineVisualization', () => ({\n  TimelineVisualization: () => <div data-testid=\"timeline-viz\">Timeline Visualization Mock</div>\n}));\n\nvi.mock('./AdvancedFilterPanel', () => ({\n  AdvancedFilterPanel: () => <div data-testid=\"filter-panel\">Advanced Filter Panel Mock</div>,\n  applyFilters: ({ filteredEmotions, filteredSensory, filteredTracking }: any) => ({\n    emotions: filteredEmotions,\n    sensoryInputs: filteredSensory,\n    trackingEntries: filteredTracking,\n  })\n}));\n\nvi.mock('@/hooks/useRealtimeData', () => ({\n  useRealtimeData: () => ({\n    emotions: [],\n    sensoryInputs: [],\n    trackingEntries: [],\n    connectionStatus: 'disconnected',\n    newDataCount: 0,\n    lastUpdate: null,\n    isLive: false,\n    clearNewDataIndicator: vi.fn(),\n    getHistoricalData: vi.fn(),\n    startStream: vi.fn(),\n    stopStream: vi.fn()\n  })\n}));\n\nbeforeAll(async () => {\n  ({ InteractiveDataVisualization } = await import('./InteractiveDataVisualization'));\n});\n\ndescribe('InteractiveDataVisualization', () => {\n  const now = new Date();\n  const oneHourLater = new Date(now.getTime() + 60 * 60 * 1000);\n  const mockEmotions = [\n    {\n      id: '1',\n      emotion: 'happy',\n      intensity: 4,\n      triggers: ['playtime'],\n      timestamp: now,\n      notes: 'Playing with blocks'\n    },\n    {\n      id: '2',\n      emotion: 'calm',\n      intensity: 3,\n      triggers: ['quiet time'],\n      timestamp: oneHourLater,\n      notes: 'Reading a book'\n    }\n  ];\n\n  const mockSensoryInputs = [\n    {\n      id: '1',\n      type: 'visual',\n      response: 'seeking',\n      intensity: 3,\n      timestamp: new Date(now.getTime() + 30 * 60 * 1000),\n      notes: 'Looking at colorful pictures'\n    },\n    {\n      id: '2',\n      type: 'auditory',\n      response: 'avoiding',\n      intensity: 4,\n      timestamp: new Date(now.getTime() + 90 * 60 * 1000),\n      notes: 'Loud noise from outside'\n    }\n  ];\n\n  const mockTrackingEntries = [\n    {\n      id: '1',\n      timestamp: now,\n      emotions: ['happy'],\n      sensoryInputs: ['visual'],\n      environmentalData: {\n        location: 'classroom',\n        noiseLevel: 3,\n        lighting: 'natural',\n        temperature: 22,\n        weather: 'sunny'\n      },\n      notes: 'Morning session'\n    }\n  ];\n\n  it('renders without crashing', () => {\n    const { container } = render(\n      <InteractiveDataVisualization\n        emotions={mockEmotions}\n        sensoryInputs={mockSensoryInputs}\n        trackingEntries={mockTrackingEntries}\n        studentName=\"Test Student\"\n      />\n    );\n    \n    expect(container).toBeTruthy();\n  });\n\n  it('displays student name', () => {\n    render(\n      <InteractiveDataVisualization\n        emotions={mockEmotions}\n        sensoryInputs={mockSensoryInputs}\n        trackingEntries={mockTrackingEntries}\n        studentName=\"Test Student\"\n      />\n    );\n    // Assert the header title that contains the student name\n    expect(screen.getByRole('heading', { level: 3, name: /Interactive Data Analysis -\\s*Test Student/i })).toBeInTheDocument();\n  });\n\n  it('renders chart container', async () => {\n    render(\n      <InteractiveDataVisualization\n        emotions={mockEmotions}\n        sensoryInputs={mockSensoryInputs}\n        trackingEntries={mockTrackingEntries}\n        studentName=\"Test Student\"\n      />\n    );\n    // Ensure the Trends tab is active to render the chart\n    // Ensure filters are reset to include all data (some defaults may filter)\n    const user = userEvent.setup();\n    const filtersButton = screen.getByRole('button', { name: /filters/i });\n    await user.click(filtersButton);\n    const resetButtons = screen.queryAllByRole('button', { name: /reset/i });\n    for (const b of resetButtons) {\n      if (b && 'click' in b) {\n        await user.click(b as HTMLButtonElement);\n      }\n    }\n    // Close the filters dialog to restore interactions\n    const closeButton = screen.queryByRole('button', { name: /close/i });\n    if (closeButton) await user.click(closeButton);\n\n    await waitFor(() => {\n      const chartContainers = screen.queryAllByTestId('echart-container');\n      expect(chartContainers.length).toBeGreaterThan(0);\n    });\n  });\n\n  it('displays data counts', async () => {\n    render(\n      <InteractiveDataVisualization\n        emotions={mockEmotions}\n        sensoryInputs={mockSensoryInputs}\n        trackingEntries={mockTrackingEntries}\n        studentName=\"Test Student\"\n      />\n    );\n    // Reset any filters and switch to Trends tab\n    const user = userEvent.setup();\n    const filtersButton = screen.getByRole('button', { name: /filters/i });\n    await user.click(filtersButton);\n    const resetButtons = screen.queryAllByRole('button', { name: /reset/i });\n    for (const b of resetButtons) {\n      if (b && 'click' in b) {\n        await user.click(b as HTMLButtonElement);\n      }\n    }\n    // Close the filters dialog to restore interactions\n    const closeButton = screen.queryByRole('button', { name: /close/i });\n    if (closeButton) await user.click(closeButton);\n\n    return waitFor(() => {\n      const counts = screen.getByLabelText(/data counts/i);\n      const scoped = within(counts);\n      expect(scoped.getByText(/2 emotions/i)).toBeInTheDocument();\n      expect(scoped.getByText(/2 sensory inputs/i)).toBeInTheDocument();\n      expect(scoped.getByText(/1 sessions/i)).toBeInTheDocument();\n    });\n  });\n\n  it('handles empty data gracefully', () => {\n    render(\n      <InteractiveDataVisualization\n        emotions={[]}\n        sensoryInputs={[]}\n        trackingEntries={[]}\n        studentName=\"Test Student\"\n      />\n    );\n    const counts = screen.getByLabelText(/data counts/i);\n    const scoped = within(counts);\n    expect(scoped.getByText(/0 emotions/)).toBeInTheDocument();\n    expect(scoped.getByText(/0 sensory inputs/)).toBeInTheDocument();\n    expect(scoped.getByText(/0 sessions/)).toBeInTheDocument();\n  });\n\n  it('handles invalid data gracefully', () => {\n    const { container } = render(\n      <InteractiveDataVisualization\n        emotions={null as any}\n        sensoryInputs={undefined as any}\n        trackingEntries={123 as any}\n        studentName=\"Test Student\"\n      />\n    );\n    \n    // Should render without crashing\n    expect(container).toBeTruthy();\n    \n    // Should show 0 counts for invalid data\n    const counts = screen.getByLabelText(/data counts/i);\n    const scoped = within(counts);\n    expect(scoped.getByText(/0 emotions/)).toBeInTheDocument();\n    expect(scoped.getByText(/0 sensory inputs/)).toBeInTheDocument();\n    expect(scoped.getByText(/0 sessions/)).toBeInTheDocument();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/InteractiveDataVisualization.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":112,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5494,5497],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5494,5497],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5616,5619],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5616,5619],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'x' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":186,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":186,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":196,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10319,10322],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10319,10322],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":257,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":257,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13657,13660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13657,13660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":258,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":258,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13706,13709],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13706,13709],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":259,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":259,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13751,13754],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13751,13754],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo, useRef, useCallback, memo, Suspense, lazy } from \"react\";\n// Unused Card components removed after refactoring\nimport { EmotionEntry, SensoryEntry, TrackingEntry, Student } from \"@/types/student\";\nimport { ErrorBoundary } from \"./ErrorBoundary\";\nimport { TeacherInsightsPanel } from '@/components/analysis/TeacherInsightsPanel';\nimport { LazyVisualization3D } from '@/components/lazy/LazyVisualization3D';\nimport { POC_MODE } from '@/lib/env';\nimport { TimelineVisualization } from './TimelineVisualization';\nimport { useRealtimeData } from '@/hooks/useRealtimeData';\nimport { useVisualizationState, VisualizationType } from '@/hooks/useVisualizationState';\nimport { useFilteredData } from '@/hooks/useFilteredData';\nimport { useDataAnalysis } from '@/hooks/useDataAnalysis';\nimport { VisualizationControls } from './VisualizationControls';\nimport { DashboardLayout } from './layouts/DashboardLayout';\nimport { GridLayout, FocusLayout, ComparisonLayout } from './layouts/VisualizationLayouts';\nconst TrendsChartLazy = lazy(() => import('./charts/TrendsChart').then(m => ({ default: m.TrendsChart })));\nconst CorrelationHeatmapLazy = lazy(() => import('./analysis/CorrelationHeatmap').then(m => ({ default: m.CorrelationHeatmap })));\nconst PatternAnalysisViewLazy = lazy(() => import('./analysis/PatternAnalysisView').then(m => ({ default: m.PatternAnalysisView })));\nconst EChartContainerLazy = lazy(() => import('@/components/charts/EChartContainer').then(m => ({ default: m.EChartContainer })));\nimport { analyticsExport, ExportFormat } from \"@/lib/analyticsExport\";\nimport { toast } from \"sonner\";\nimport { logger } from \"@/lib/logger\";\n\ninterface InteractiveDataVisualizationProps {\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  trackingEntries: TrackingEntry[];\n  studentName: string;\n}\n\n// Move static data outside component to prevent recreation\nconst POSITIVE_EMOTIONS = ['happy', 'calm', 'focused', 'excited', 'proud'] as const;\nconst NEGATIVE_EMOTIONS = ['sad', 'angry', 'anxious', 'frustrated', 'overwhelmed'] as const;\n\nexport const InteractiveDataVisualization = memo<InteractiveDataVisualizationProps>(({ \n  emotions: initialEmotions, \n  sensoryInputs: initialSensoryInputs, \n  trackingEntries: initialTrackingEntries, \n  studentName \n}) => {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [isExporting, setIsExporting] = React.useState(false);\n\n  const safeInitialEmotions = useMemo(() => Array.isArray(initialEmotions) ? initialEmotions : [], [initialEmotions]);\n  const safeInitialSensoryInputs = useMemo(() => Array.isArray(initialSensoryInputs) ? initialSensoryInputs : [], [initialSensoryInputs]);\n  const safeInitialTracking = useMemo(() => Array.isArray(initialTrackingEntries) ? initialTrackingEntries : [], [initialTrackingEntries]);\n\n  const availableEmotions = useMemo(() => Array.from(\n    new Set(safeInitialEmotions.map(e => e.emotion))\n  ), [safeInitialEmotions]);\n\n  const visualizationState = useVisualizationState(availableEmotions);\n  const { layoutMode, selectedChartType, filterCriteria, highlightState } = visualizationState;\n\n  const realtimeData = useRealtimeData(\n    {\n      emotions: safeInitialEmotions,\n      sensoryInputs: safeInitialSensoryInputs,\n      trackingEntries: safeInitialTracking\n    },\n    {\n      enabled: filterCriteria.realtime,\n      windowSize: visualizationState.selectedTimeRange === '7d' ? 7 * 24 * 60 :\n                  visualizationState.selectedTimeRange === '30d' ? 30 * 24 * 60 :\n                  visualizationState.selectedTimeRange === '90d' ? 90 * 24 * 60 : 0,\n      updateInterval: 1000,\n      smoothTransitions: true,\n      simulateData: true\n    }\n  );\n\n  const emotions = filterCriteria.realtime ? realtimeData.emotions : safeInitialEmotions;\n  const sensoryInputs = filterCriteria.realtime ? realtimeData.sensoryInputs : safeInitialSensoryInputs;\n  const trackingEntries = filterCriteria.realtime ? realtimeData.trackingEntries : safeInitialTracking;\n\n  const filteredData = useFilteredData(\n    emotions,\n    sensoryInputs,\n    trackingEntries,\n    visualizationState.selectedTimeRange,\n    filterCriteria,\n    highlightState\n  );\n\n  const analysisData = useDataAnalysis(filteredData);\n\n  const chartData = useMemo(() => {\n    interface ChartDataPoint {\n      date: string;\n      timestamp: Date;\n      emotionCount: number;\n      avgEmotionIntensity: number;\n      positiveEmotions: number;\n      negativeEmotions: number;\n      sensorySeekingCount: number;\n      sensoryAvoidingCount: number;\n      totalSensoryInputs: number;\n      [key: string]: string | number | Date;\n    }\n    // This logic to transform filteredData to chartData could also be a hook\n    // For now, keeping it here for simplicity\n    const dataMap = new Map<string, ChartDataPoint>();\n    filteredData.emotions.forEach(emotion => {\n        if (!emotion?.timestamp) return;\n        const date = emotion.timestamp.toISOString().split('T')[0];\n        if (!dataMap.has(date)) {\n          dataMap.set(date, { date, timestamp: emotion.timestamp, emotionCount: 0, avgEmotionIntensity: 0, positiveEmotions: 0, negativeEmotions: 0, sensorySeekingCount: 0, sensoryAvoidingCount: 0, totalSensoryInputs: 0 });\n        }\n        const data = dataMap.get(date)!;\n        data.emotionCount++;\n        data.avgEmotionIntensity = ((data.avgEmotionIntensity * (data.emotionCount - 1)) + emotion.intensity) / data.emotionCount;\n        if (POSITIVE_EMOTIONS.includes(emotion.emotion.toLowerCase() as any)) {\n          data.positiveEmotions++;\n        } else if (NEGATIVE_EMOTIONS.includes(emotion.emotion.toLowerCase() as any)) {\n          data.negativeEmotions++;\n        }\n      });\n      filteredData.sensoryInputs.forEach(sensory => {\n        if (!sensory?.timestamp) return;\n        const date = sensory.timestamp.toISOString().split('T')[0];\n        if (!dataMap.has(date)) {\n          dataMap.set(date, { date, timestamp: sensory.timestamp, emotionCount: 0, avgEmotionIntensity: 0, positiveEmotions: 0, negativeEmotions: 0, sensorySeekingCount: 0, sensoryAvoidingCount: 0, totalSensoryInputs: 0 });\n        }\n        const data = dataMap.get(date)!;\n        data.totalSensoryInputs++;\n        if (sensory.response?.toLowerCase().includes('seeking')) {\n          data.sensorySeekingCount++;\n        } else if (sensory.response?.toLowerCase().includes('avoiding')) {\n          data.sensoryAvoidingCount++;\n        }\n      });\n    return Array.from(dataMap.values()).sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());\n  }, [filteredData]);\n\n  const toggleFullscreen = useCallback(() => {\n    if (!document.fullscreenElement) {\n      containerRef.current?.requestFullscreen();\n      visualizationState.setIsFullscreen(true);\n    } else {\n      document.exitFullscreen();\n      visualizationState.setIsFullscreen(false);\n    }\n  }, [visualizationState]);\n\n  const togglePictureInPicture = useCallback(() => {\n    visualizationState.setIsPictureInPicture(!visualizationState.isPictureInPicture);\n    toast(visualizationState.isPictureInPicture ? 'Exited picture-in-picture mode' : 'Entered picture-in-picture mode');\n  }, [visualizationState]);\n\n  const handleExport = async (format: ExportFormat) => {\n    // This logic could be moved to a hook or helper\n    setIsExporting(true);\n    try {\n      const allTimestamps = [...filteredData.emotions.map(e => e.timestamp), ...filteredData.sensoryInputs.map(s => s.timestamp), ...filteredData.trackingEntries.map(t => t.timestamp)].filter(t => t);\n      let minTime = Number.MAX_SAFE_INTEGER, maxTime = Number.MIN_SAFE_INTEGER;\n      for (const timestamp of allTimestamps) {\n        const time = timestamp.getTime();\n        if (time < minTime) minTime = time;\n        if (time > maxTime) maxTime = time;\n      }\n      const dateRange = allTimestamps.length > 0 ? { start: new Date(minTime), end: new Date(maxTime) } : { start: new Date(), end: new Date() };\n      const studentData: Student = { id: 'current-student', name: studentName, grade: '', createdAt: new Date(), baselineData: { emotionalRegulation: { averageIntensity: 5, mostCommonEmotion: 'neutral', triggerFrequency: {} }, sensoryProcessing: { seekingBehaviors: {}, avoidingBehaviors: {}, preferredSensoryInput: [] }, environmentalFactors: { optimalConditions: {}, challengingConditions: [] }, collectedDate: new Date(), collectedBy: 'System' } };\n      const exportData: AnalyticsExportData = {\n        student: studentData,\n        dateRange,\n        data: { entries: filteredData.trackingEntries, emotions: filteredData.emotions, sensoryInputs: filteredData.sensoryInputs },\n        analytics: { patterns: analysisData.patterns, correlations: analysisData.correlationMatrix?.significantPairs.map(p => ({ ...p, id: crypto.randomUUID(), description: '', recommendations: [] })) || [], insights: analysisData.patterns.map(p => p.description), predictiveInsights: analysisData.predictiveInsights, anomalies: analysisData.anomalies }\n      };\n      await analyticsExport.exportTo(format, exportData);\n      toast.success(`Interactive analytics ${format.toUpperCase()} exported successfully`);\n    } catch (error) {\n      logger.error('Export failed', { error });\n      toast.error('Failed to export interactive analytics data');\n    } finally {\n      setIsExporting(false);\n    }\n  };\n\n  const renderVisualization = (type: VisualizationType) => {\n    switch (type) {\n      case 'trends':\n        if (visualizationState.projectionMode === '2d') {\n          // Build a 2D scatter projection based on selected plane\n          const plane = visualizationState.projectionPlane;\n          const mapPoint = (p: typeof chartData[number]) => {\n            const x = p.date;\n            const y = plane === 'xy' ? p.avgEmotionIntensity : plane === 'xz' ? p.avgEmotionIntensity : p.totalSensoryInputs;\n            return { name: p.date, value: [p.timestamp, y], avgEmotionIntensity: p.avgEmotionIntensity, totalSensoryInputs: p.totalSensoryInputs };\n          };\n          const data = chartData.map(mapPoint);\n          const option = {\n            xAxis: { type: 'time' },\n            yAxis: { type: 'value', name: plane === 'yz' ? 'Sensory load' : 'Emotional energy' },\n            series: [{ type: 'scatter', data, symbolSize: 8 }],\n            animation: !visualizationState.motionSafe,\n          } as any;\n          return (\n            <Suspense fallback={<div className=\"h-[360px] rounded-xl border bg-card motion-safe:animate-pulse\" aria-label=\"Loading chart\" />}> \n              <EChartContainerLazy option={option} height={360} />\n            </Suspense>\n          );\n        }\n        return (\n          <Suspense fallback={<div className=\"h-[360px] rounded-xl border bg-card motion-safe:animate-pulse\" aria-label=\"Loading chart\" />}> \n            <TrendsChartLazy chartData={chartData} selectedChartType={selectedChartType} />\n          </Suspense>\n        );\n      case 'correlations':\n        return (\n          <Suspense fallback={<div className=\"h-[420px] rounded-xl border bg-card motion-safe:animate-pulse\" aria-label=\"Loading heatmap\" />}> \n            <CorrelationHeatmapLazy correlationMatrix={analysisData.correlationMatrix} onRetry={() => {}} onShowAllTime={() => visualizationState.setSelectedTimeRange('all')} />\n          </Suspense>\n        );\n      case 'patterns':\n        return (\n          <Suspense fallback={<div className=\"h-[360px] rounded-xl border bg-card motion-safe:animate-pulse\" aria-label=\"Loading patterns\" />}> \n            <PatternAnalysisViewLazy {...analysisData} highlightState={highlightState} handleHighlight={() => {}} filteredData={filteredData} />\n          </Suspense>\n        );\n      case '3d':\n        if (POC_MODE) return null;\n        return <LazyVisualization3D emotions={filteredData.emotions} sensoryInputs={filteredData.sensoryInputs} trackingEntries={filteredData.trackingEntries} />;\n      case 'timeline':\n        return <TimelineVisualization emotions={filteredData.emotions} sensoryInputs={filteredData.sensoryInputs} trackingEntries={filteredData.trackingEntries} anomalies={analysisData.anomalies.map(a => ({ timestamp: a.timestamp, type: a.type, severity: a.severity }))} onTimeRangeChange={(start, end) => visualizationState.setFilterCriteria(prev => ({ ...prev, dateRange: { start, end } }))} realtime={filterCriteria.realtime} />;\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <ErrorBoundary>\n      <div ref={containerRef} className=\"space-y-6\">\n        <VisualizationControls\n          studentName={studentName}\n          isExporting={isExporting}\n          availableEmotions={availableEmotions}\n          filteredData={filteredData}\n          realtimeData={realtimeData}\n          visualizationState={visualizationState}\n          toggleFullscreen={toggleFullscreen}\n          togglePictureInPicture={togglePictureInPicture}\n          handleExport={handleExport}\n        />\n\n        {layoutMode === 'dashboard' && (\n          <div className=\"grid grid-cols-1 lg:grid-cols-[1fr_380px] gap-4 items-start\">\n            <DashboardLayout\n              renderTrendsChart={() => renderVisualization('trends')}\n              renderCorrelationHeatmap={() => renderVisualization('correlations')}\n              renderPatternAnalysis={() => renderVisualization('patterns')}\n              render3dVisualization={() => renderVisualization('3d')}\n              renderTimeline={() => renderVisualization('timeline')}\n              filteredData={filteredData}\n              correlationMatrix={analysisData.correlationMatrix}\n            />\n            <TeacherInsightsPanel\n              student={{ id: 'current-student', name: studentName, createdAt: new Date() } as any}\n              filteredData={filteredData as any}\n              analysis={analysisData as any}\n              activePreset={visualizationState.activePreset}\n              onCreateGoal={() => { /* wire later: route to goals with draft */ }}\n              onAddIntervention={() => { /* wire later */ }}\n              onScheduleBreak={() => { /* wire later */ }}\n              onJumpToTracking={() => { /* wire later */ }}\n            />\n          </div>\n        )}\n        {layoutMode === 'grid' && <GridLayout renderVisualization={renderVisualization} selectedVisualizations={visualizationState.selectedVisualizations} />}\n        {layoutMode === 'focus' && <FocusLayout renderVisualization={renderVisualization} focusedVisualization={visualizationState.focusedVisualization} />}\n        {layoutMode === 'comparison' && <ComparisonLayout renderVisualization={renderVisualization} selectedVisualizations={visualizationState.selectedVisualizations} />}\n      </div>\n    </ErrorBoundary>\n  );\n}, (prevProps, nextProps) => {\n  // Custom comparison for better memoization - avoid unnecessary rerenders\n  return (\n    prevProps.studentName === nextProps.studentName &&\n    prevProps.emotions.length === nextProps.emotions.length &&\n    prevProps.sensoryInputs.length === nextProps.sensoryInputs.length &&\n    prevProps.trackingEntries.length === nextProps.trackingEntries.length &&\n    // Check timestamp of first entries to detect data changes\n    (prevProps.emotions.length === 0 || nextProps.emotions.length === 0 ||\n     prevProps.emotions[0]?.timestamp?.getTime() === nextProps.emotions[0]?.timestamp?.getTime()) &&\n    (prevProps.sensoryInputs.length === 0 || nextProps.sensoryInputs.length === 0 ||\n     prevProps.sensoryInputs[0]?.timestamp?.getTime() === nextProps.sensoryInputs[0]?.timestamp?.getTime()) &&\n    (prevProps.trackingEntries.length === 0 || nextProps.trackingEntries.length === 0 ||\n     prevProps.trackingEntries[0]?.timestamp?.getTime() === nextProps.trackingEntries[0]?.timestamp?.getTime())\n  );\n});\n\nInteractiveDataVisualization.displayName = 'InteractiveDataVisualization';\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/LanguageSettings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/LoadingFallback.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/LoadingSpinner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/LoadingState.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"...\"","line":26,"column":40,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":27,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"...\"","line":38,"column":38,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":39,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"...\"","line":50,"column":40,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":51,"endColumn":11},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":54,"column":26,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":54,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { useTranslation } from '@/hooks/useTranslation';\n\ninterface LoadingStateProps {\n  type?: 'page' | 'card' | 'inline';\n  message?: string;\n  rows?: number;\n}\n\nexport const LoadingState: React.FC<LoadingStateProps> = ({ \n  type = 'card', \n  message,\n  rows = 3 \n}) => {\n  const { tCommon } = useTranslation();\n  const defaultMessage = String(tCommon('status.loading'));\n\n  if (type === 'page') {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto\" />\n          <p className=\"text-muted-foreground font-dyslexia\">\n            {message || defaultMessage}...\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  if (type === 'inline') {\n    return (\n      <div className=\"flex items-center gap-2 py-2\">\n        <div className=\"w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin\" />\n        <span className=\"text-sm text-muted-foreground font-dyslexia\">\n          {message || defaultMessage}...\n        </span>\n      </div>\n    );\n  }\n\n  return (\n    <Card>\n      <CardContent className=\"p-6 space-y-3\">\n        <div className=\"flex items-center gap-3 mb-4\">\n          <div className=\"w-5 h-5 border-2 border-primary border-t-transparent rounded-full animate-spin\" />\n          <span className=\"text-sm text-muted-foreground font-dyslexia\">\n            {message || defaultMessage}...\n          </span>\n        </div>\n        {Array.from({ length: rows }).map((_, i) => (\n          <Skeleton key={i} className=\"h-4 w-full\" />\n        ))}\n      </CardContent>\n    </Card>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/MockDataLoader.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CheckCircle' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generateAllMockData' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":81,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":100},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":44,"column":37,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":56,"endColumn":14},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":73,"column":30,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":73,"endColumn":54},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'selectedScenario'. Either include it or remove the dependency array.","line":108,"column":6,"nodeType":"ArrayExpression","endLine":108,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [selectedScenario]","fix":{"range":[4146,4148],"text":"[selectedScenario]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has an unnecessary dependency: 'isLoading'. Either exclude it or remove the dependency array.","line":127,"column":69,"nodeType":"ArrayExpression","endLine":127,"endColumn":80,"suggestions":[{"desc":"Update the dependencies array to be: []","fix":{"range":[4798,4809],"text":"[]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has an unnecessary dependency: 'isLoading'. Either exclude it or remove the dependency array.","line":130,"column":5,"nodeType":"ArrayExpression","endLine":130,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: []","fix":{"range":[4920,4931],"text":"[]"}}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Mock Data for Testing\"","line":137,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":139,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n          <Database className=\"h-5 w-5 text-primary\" />\n          Mock Data for Testing\n        </CardTitle>","line":137,"column":56,"nodeType":"JSXText","endLine":139,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Load realistic test data to explore pattern analysis and correlation features.\n          Mock data includes 3 students with 3-6 months of tracking data each.\"","line":142,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":145,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">\n          Load realistic test data to explore pattern analysis and correlation features.\n          Mock data includes 3 students with 3-6 months of tracking data each.\n        </div>","line":142,"column":56,"nodeType":"JSXText","endLine":145,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Students to be created:\"","line":150,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":150,"endColumn":71},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm font-medium\">Students to be created:</div>","line":150,"column":48,"nodeType":"JSXText","endLine":150,"endColumn":71},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Current Data:\"","line":164,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":164,"endColumn":63},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm font-medium\">Current Data:</div>","line":164,"column":50,"nodeType":"JSXText","endLine":164,"endColumn":63},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"students\"","line":166,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":166,"endColumn":59},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>• {currentStats.studentsCount} students</div>","line":166,"column":50,"nodeType":"JSXText","endLine":166,"endColumn":59},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"tracking entries\"","line":167,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":167,"endColumn":66},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>• {currentStats.entriesCount} tracking entries</div>","line":167,"column":49,"nodeType":"JSXText","endLine":167,"endColumn":66},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Contains mock data\"","line":168,"column":64,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":168,"endColumn":84},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-orange-600\">• Contains mock data</div>","line":168,"column":64,"nodeType":"JSXText","endLine":168,"endColumn":84},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Scenario\"","line":176,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":176,"endColumn":58},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm font-medium\">Scenario</div>","line":176,"column":50,"nodeType":"JSXText","endLine":176,"endColumn":58},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"All (Emma, Lars, Astrid)\"","line":185,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":185,"endColumn":65},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"all\">All (Emma, Lars, Astrid)</SelectItem>","line":185,"column":41,"nodeType":"JSXText","endLine":185,"endColumn":65},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emma (mild anxiety, improving)\"","line":186,"column":42,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":186,"endColumn":72},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"emma\">Emma (mild anxiety, improving)</SelectItem>","line":186,"column":42,"nodeType":"JSXText","endLine":186,"endColumn":72},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Lars (sensory challenges)\"","line":187,"column":42,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":187,"endColumn":67},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"lars\">Lars (sensory challenges)</SelectItem>","line":187,"column":42,"nodeType":"JSXText","endLine":187,"endColumn":67},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Astrid (steady improvement)\"","line":188,"column":44,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":188,"endColumn":71},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"astrid\">Astrid (steady improvement)</SelectItem>","line":188,"column":44,"nodeType":"JSXText","endLine":188,"endColumn":71},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Loading mock data...\"","line":197,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":197,"endColumn":80},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Load Mock Data\"","line":209,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":211,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n            className=\"flex-1 bg-gradient-primary hover:opacity-90\"\n            disabled={isLoading}\n            onClick={handleLoadMockData}\n          >\n            <Database className=\"h-4 w-4 mr-2\" />\n            Load Mock Data\n          </Button>","line":209,"column":50,"nodeType":"JSXText","endLine":211,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Clear All\"","line":221,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":223,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button \n                  variant=\"destructive\" \n                  size=\"sm\"\n                  disabled={isLoading}\n                >\n                  <Trash2 className=\"h-4 w-4 mr-2\" />\n                  Clear All\n                </Button>","line":221,"column":54,"nodeType":"JSXText","endLine":223,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Clear All Data?\"","line":227,"column":37,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":227,"endColumn":52},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <AlertDialogTitle>Clear All Data?</AlertDialogTitle>","line":227,"column":37,"nodeType":"JSXText","endLine":227,"endColumn":52},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"This will permanently delete all student data and tracking entries. \n                    This action cannot be undone.\"","line":228,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":231,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <AlertDialogDescription>\n                    This will permanently delete all student data and tracking entries. \n                    This action cannot be undone.\n                  </AlertDialogDescription>","line":228,"column":43,"nodeType":"JSXText","endLine":231,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Cancel\"","line":234,"column":38,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":234,"endColumn":44},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <AlertDialogCancel>Cancel</AlertDialogCancel>","line":234,"column":38,"nodeType":"JSXText","endLine":234,"endColumn":44},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Clear All Data\"","line":236,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":238,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <AlertDialogAction onClick={handleClearMockData} className=\"bg-destructive\">\n                    <Trash2 className=\"h-4 w-4 mr-2\" />\n                    Clear All Data\n                  </AlertDialogAction>","line":236,"column":56,"nodeType":"JSXText","endLine":238,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Features you can test:\"","line":247,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":247,"endColumn":75},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm font-medium mb-2\">Features you can test:</div>","line":247,"column":53,"nodeType":"JSXText","endLine":247,"endColumn":75},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Emotion pattern recognition\"","line":249,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":249,"endColumn":47},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>• Emotion pattern recognition</div>","line":249,"column":18,"nodeType":"JSXText","endLine":249,"endColumn":47},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Sensory input correlations\"","line":250,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":250,"endColumn":46},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>• Sensory input correlations</div>","line":250,"column":18,"nodeType":"JSXText","endLine":250,"endColumn":46},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Environmental factor analysis\"","line":251,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":251,"endColumn":49},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>• Environmental factor analysis</div>","line":251,"column":18,"nodeType":"JSXText","endLine":251,"endColumn":49},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Predictive insights & trends\"","line":252,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":252,"endColumn":48},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>• Predictive insights & trends</div>","line":252,"column":18,"nodeType":"JSXText","endLine":252,"endColumn":48},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Interactive data visualization\"","line":253,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":253,"endColumn":50},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>• Interactive data visualization</div>","line":253,"column":18,"nodeType":"JSXText","endLine":253,"endColumn":50},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Alert system & anomaly detection\"","line":254,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":254,"endColumn":52},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>• Alert system & anomaly detection</div>","line":254,"column":18,"nodeType":"JSXText","endLine":254,"endColumn":52}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":58,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback, useMemo, useRef, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from '@/components/ui/alert-dialog';\nimport { Progress } from '@/components/ui/progress';\nimport { toast } from 'sonner';\nimport { Database, Users, Trash2, CheckCircle } from 'lucide-react';\nimport { loadMockDataToStorage, clearMockDataFromStorage, generateMockStudents, generateAllMockData, loadScenarioDataToStorage } from '@/lib/mockDataGenerator';\nimport { dataStorage } from '@/lib/dataStorage';\n\n/**\n * MockDataLoader Component\n * Provides interface to load/clear mock student data for testing pattern analysis\n */\nexport const MockDataLoader = () => {\n  const [isLoading, setIsLoading] = useState(false);\n  const [loadingProgress, setLoadingProgress] = useState(0);\n  const [selectedScenario, setSelectedScenario] = useState<'all' | 'emma' | 'lars' | 'astrid'>('all');\n  const progressIntervalRef = useRef<NodeJS.Timeout | null>(null);\n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n  useEffect(() => {\n    // Cleanup on unmount\n    return () => {\n      if (progressIntervalRef.current) {\n        clearInterval(progressIntervalRef.current);\n      }\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n    };\n  }, []);\n\n  const handleLoadMockData = useCallback(async () => {\n    setIsLoading(true);\n    setLoadingProgress(0);\n\n    try {\n      // Simulate loading progress for better UX\n      setLoadingProgress(25);\n      \n      // Generate and load the data based on selected scenario\n      progressIntervalRef.current = setInterval(() => {\n        setLoadingProgress((oldProgress) => {\n          if (oldProgress >= 95) {\n            if (progressIntervalRef.current) {\n              clearInterval(progressIntervalRef.current);\n              progressIntervalRef.current = null;\n            }\n            return 100;\n          }\n          const diff = Math.random() * 10;\n          return Math.min(oldProgress + diff, 95);\n        });\n      }, 500);\n\n      if (selectedScenario === 'all') {\n        await loadMockDataToStorage();\n      } else {\n        await loadScenarioDataToStorage(selectedScenario);\n      }\n      \n      // Clear interval before setting final progress\n      if (progressIntervalRef.current) {\n        clearInterval(progressIntervalRef.current);\n        progressIntervalRef.current = null;\n      }\n      \n      setLoadingProgress(75);\n      \n      await new Promise(resolve => {\n        timeoutRef.current = setTimeout(resolve, 300);\n      });\n      setLoadingProgress(100);\n      \n      // Get stats for success message\n      const stats = dataStorage.getStorageStats();\n      \n      const description = selectedScenario === 'all'\n        ? `Loaded ${stats.studentsCount} students with ${stats.entriesCount} tracking entries`\n        : `Loaded scenario \"${selectedScenario}\" with ${stats.entriesCount} tracking entries`;\n      \n      toast.success('Mock data loaded successfully!', {\n        description,\n      });\n      \n      // Dispatch a custom event to notify other components that mock data has been loaded.\n      // This allows for dynamic updates without requiring a full page reload.\n      window.dispatchEvent(new CustomEvent('mockDataLoaded'));\n      \n    } catch (error) {\n      // Clean up interval on error\n      if (progressIntervalRef.current) {\n        clearInterval(progressIntervalRef.current);\n      }\n      toast.error('Failed to load mock data', {\n        description: error instanceof Error ? error.message : 'Unknown error occurred',\n      });\n    } finally {\n      // Ensure interval is cleared\n      if (progressIntervalRef.current) {\n        clearInterval(progressIntervalRef.current);\n      }\n      setIsLoading(false);\n      setLoadingProgress(0);\n    }\n  }, []);\n\n  const handleClearMockData = useCallback(async () => {\n    try {\n      clearMockDataFromStorage();\n      \n      toast.success('Mock data cleared successfully!');\n      \n      // Dispatch a custom event to force a refresh on components that listen for it.\n      window.dispatchEvent(new CustomEvent('mockDataLoaded'));\n      \n    } catch (error) {\n      toast.error('Failed to clear mock data', {\n        description: error instanceof Error ? error.message : 'Unknown error occurred',\n      });\n    }\n  }, []);\n\n  const mockStudents = useMemo(() => generateMockStudents(), []);\n  const currentStats = useMemo(() => dataStorage.getStorageStats(), [isLoading]);\n  const hasMockData = useMemo(\n    () => dataStorage.getStudents().some(s => s.id.startsWith('mock_')),\n    [isLoading]\n  );\n\n  return (\n    <Card className=\"bg-gradient-card border-0 shadow-soft\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Database className=\"h-5 w-5 text-primary\" />\n          Mock Data for Testing\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div className=\"text-sm text-muted-foreground\">\n          Load realistic test data to explore pattern analysis and correlation features.\n          Mock data includes 3 students with 3-6 months of tracking data each.\n        </div>\n\n\n        {/* Student Preview */}\n        <div className=\"space-y-2\">\n          <div className=\"text-sm font-medium\">Students to be created:</div>\n          <div className=\"space-y-1\">\n            {mockStudents.map(student => (\n              <div key={student.id} className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                <Users className=\"h-3 w-3\" />\n                <span>{student.name} ({student.grade})</span>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Current Data Stats */}\n        {currentStats.studentsCount > 0 && (\n          <div className=\"p-3 bg-muted/50 rounded-lg space-y-1\">\n            <div className=\"text-sm font-medium\">Current Data:</div>\n            <div className=\"text-xs text-muted-foreground space-y-1\">\n              <div>• {currentStats.studentsCount} students</div>\n              <div>• {currentStats.entriesCount} tracking entries</div>\n              {hasMockData && <div className=\"text-orange-600\">• Contains mock data</div>}\n            </div>\n          </div>\n        )}\n\n        {/* Scenario Selector */}\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n          <div className=\"space-y-1\">\n            <div className=\"text-sm font-medium\">Scenario</div>\n            <Select \n              value={selectedScenario}\n              onValueChange={(val) => setSelectedScenario((val as 'all' | 'emma' | 'lars' | 'astrid'))}\n            >\n              <SelectTrigger className=\"w-full\">\n                <SelectValue placeholder=\"Select scenario\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All (Emma, Lars, Astrid)</SelectItem>\n                <SelectItem value=\"emma\">Emma (mild anxiety, improving)</SelectItem>\n                <SelectItem value=\"lars\">Lars (sensory challenges)</SelectItem>\n                <SelectItem value=\"astrid\">Astrid (steady improvement)</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        {/* Loading Progress */}\n        {isLoading && (\n          <div className=\"space-y-2\">\n            <div className=\"text-sm text-muted-foreground\">Loading mock data...</div>\n            <Progress value={loadingProgress} className=\"h-2\" />\n          </div>\n        )}\n\n        {/* Action Buttons */}\n        <div className=\"flex gap-2 pt-2\">\n          <Button\n            className=\"flex-1 bg-gradient-primary hover:opacity-90\"\n            disabled={isLoading}\n            onClick={handleLoadMockData}\n          >\n            <Database className=\"h-4 w-4 mr-2\" />\n            Load Mock Data\n          </Button>\n\n          {hasMockData && (\n            <AlertDialog>\n              <AlertDialogTrigger asChild>\n                <Button \n                  variant=\"destructive\" \n                  size=\"sm\"\n                  disabled={isLoading}\n                >\n                  <Trash2 className=\"h-4 w-4 mr-2\" />\n                  Clear All\n                </Button>\n              </AlertDialogTrigger>\n              <AlertDialogContent>\n                <AlertDialogHeader>\n                  <AlertDialogTitle>Clear All Data?</AlertDialogTitle>\n                  <AlertDialogDescription>\n                    This will permanently delete all student data and tracking entries. \n                    This action cannot be undone.\n                  </AlertDialogDescription>\n                </AlertDialogHeader>\n                <AlertDialogFooter>\n                  <AlertDialogCancel>Cancel</AlertDialogCancel>\n                  <AlertDialogAction onClick={handleClearMockData} className=\"bg-destructive\">\n                    <Trash2 className=\"h-4 w-4 mr-2\" />\n                    Clear All Data\n                  </AlertDialogAction>\n                </AlertDialogFooter>\n              </AlertDialogContent>\n            </AlertDialog>\n          )}\n        </div>\n\n        {/* Features This Will Test */}\n        <div className=\"pt-3 border-t border-border\">\n          <div className=\"text-sm font-medium mb-2\">Features you can test:</div>\n          <div className=\"text-xs text-muted-foreground space-y-1\">\n            <div>• Emotion pattern recognition</div>\n            <div>• Sensory input correlations</div>\n            <div>• Environmental factor analysis</div>\n            <div>• Predictive insights & trends</div>\n            <div>• Interactive data visualization</div>\n            <div>• Alert system & anomaly detection</div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/NoData.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No data available for this visualization.\"","line":6,"column":8,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":6,"endColumn":49},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>No data available for this visualization.</p>","line":6,"column":8,"nodeType":"JSXText","endLine":6,"endColumn":49}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport React from 'react';\n\nexport const NoData = () => (\n  <div className=\"text-center py-8 text-muted-foreground\">\n    <p>No data available for this visualization.</p>\n  </div>\n);\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/POCBadge.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"POC Mode\"","line":6,"column":75,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":6,"endColumn":83},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\" className=\"uppercase tracking-wider text-xs\">POC Mode</Badge>","line":6,"column":75,"nodeType":"JSXText","endLine":6,"endColumn":83}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Badge } from '@/components/ui/badge';\n\nexport const POCBadge: React.FC = () => {\n  return (\n    <Badge variant=\"outline\" className=\"uppercase tracking-wider text-xs\">POC Mode</Badge>\n  );\n};\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/PaginatedSessionsList.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No sessions available in the selected period.\"","line":60,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":60,"endColumn":59},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>No sessions available in the selected period.</p>","line":60,"column":14,"nodeType":"JSXText","endLine":60,"endColumn":59},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Showing\"","line":72,"column":19,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":72,"endColumn":27},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Showing {startIndex}-{endIndex} of {totalItems}</span>","line":72,"column":19,"nodeType":"JSXText","endLine":72,"endColumn":27},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"of\"","line":72,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":72,"endColumn":54},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Showing {startIndex}-{endIndex} of {totalItems}</span>","line":72,"column":50,"nodeType":"JSXText","endLine":72,"endColumn":54},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"5\"","line":81,"column":39,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":81,"endColumn":40},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"10\"","line":82,"column":40,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":82,"endColumn":42},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"20\"","line":83,"column":40,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":83,"endColumn":42},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"50\"","line":84,"column":40,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":84,"endColumn":42},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Loading sessions...\"","line":92,"column":66,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":94,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"at\"","line":103,"column":61,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":103,"endColumn":65},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-medium text-foreground\">\n                      {entry.timestamp.toLocaleDateString()} at {entry.timestamp.toLocaleTimeString()}\n                    </span>","line":103,"column":61,"nodeType":"JSXText","endLine":103,"endColumn":65},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"emotions\"","line":107,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":108,"endColumn":23},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\" className=\"text-xs\">\n                        {entry.emotions.length} emotions\n                      </Badge>","line":107,"column":48,"nodeType":"JSXText","endLine":108,"endColumn":23},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"sensory\"","line":110,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":111,"endColumn":23},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\" className=\"text-xs\">\n                        {entry.sensoryInputs.length} sensory\n                      </Badge>","line":110,"column":53,"nodeType":"JSXText","endLine":111,"endColumn":23},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Environmental data\"","line":113,"column":70,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":115,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\" className=\"text-xs\">\n                          Environmental data\n                        </Badge>","line":113,"column":70,"nodeType":"JSXText","endLine":115,"endColumn":25},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":127,"column":37,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":127,"endColumn":40},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"+\"","line":132,"column":70,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":133,"endColumn":28},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"more\"","line":133,"column":55,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":134,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\" className=\"text-xs\">\n                          +{entry.emotions.length - 3} more\n                        </Badge>","line":133,"column":55,"nodeType":"JSXText","endLine":134,"endColumn":25},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Page\"","line":145,"column":64,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":146,"endColumn":24},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">\n                  Page {currentPage} of {totalPages}\n                </div>","line":145,"column":64,"nodeType":"JSXText","endLine":146,"endColumn":24},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"of\"","line":146,"column":37,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":146,"endColumn":41},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">\n                  Page {currentPage} of {totalPages}\n                </div>","line":146,"column":37,"nodeType":"JSXText","endLine":146,"endColumn":41}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":27,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { memo, useCallback } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { TrackingEntry } from '@/types/student';\nimport { useDataPagination } from '@/hooks/useDataPagination';\nimport { ChevronsLeft, ChevronLeft, ChevronRight, ChevronsRight } from 'lucide-react';\nimport { PageButton } from '@/components/ui/PageButton';\n\ninterface PaginatedSessionsListProps {\n  sessions: TrackingEntry[];\n  title?: string;\n}\n\n/**\n * PaginatedSessionsList Component\n * \n * Displays a paginated list of tracking entries (sessions) with detailed information\n * including emotions, sensory inputs, and environmental data.\n * \n * @component\n * @param {PaginatedSessionsListProps} props - Component props\n * @param {TrackingEntry[]} props.sessions - Array of tracking entries to display\n * @param {string} [props.title=\"Sessions in Selected Period\"] - Title for the sessions list\n * @returns {React.ReactElement} Rendered component\n */\nexport const PaginatedSessionsList: React.FC<PaginatedSessionsListProps> = memo(({\n  sessions,\n  title = \"Sessions in Selected Period\"\n}) => {\n  const {\n    paginatedData,\n    currentPage,\n    pageSize,\n    totalItems,\n    totalPages,\n    goToPage,\n    goToNextPage,\n    goToPreviousPage,\n    goToFirstPage,\n    goToLastPage,\n    changePageSize,\n    hasNextPage,\n    hasPreviousPage,\n    startIndex,\n    endIndex,\n    isEmpty,\n    isLoading,  // Added from new hook implementation\n  } = useDataPagination(sessions, { initialPageSize: 10 });\n\n  const handlePageSizeChange = useCallback((value: string) => {\n    changePageSize(parseInt(value));\n  }, [changePageSize]);\n\n  if (isEmpty && !isLoading) {\n    return (\n      <Card className=\"bg-gradient-card border-0 shadow-soft\">\n        <CardContent className=\"py-16 text-center text-muted-foreground\">\n          <p>No sessions available in the selected period.</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"bg-gradient-card border-0 shadow-soft\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center justify-between\">\n          <span>{title}</span>\n          <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n            <span>Showing {startIndex}-{endIndex} of {totalItems}</span>\n            <Select\n              value={pageSize.toString()}\n              onValueChange={handlePageSizeChange}\n            >\n              <SelectTrigger className=\"w-20 h-8\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"5\">5</SelectItem>\n                <SelectItem value=\"10\">10</SelectItem>\n                <SelectItem value=\"20\">20</SelectItem>\n                <SelectItem value=\"50\">50</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {isLoading ? (\n          <div className=\"text-center p-8 text-muted-foreground\">\n            Loading sessions...\n          </div>\n        ) : (\n          <div>\n            {/* Sessions List */}\n            <div className=\"space-y-4\">\n              {paginatedData.map((entry) => (\n                <div key={entry.id} className=\"border-l-4 border-primary pl-4 py-2 hover:bg-muted/50 transition-colors rounded-r\">\n                  <div className=\"flex items-center justify-between mb-1\">\n                    <span className=\"font-medium text-foreground\">\n                      {entry.timestamp.toLocaleDateString()} at {entry.timestamp.toLocaleTimeString()}\n                    </span>\n                    <div className=\"flex gap-2\">\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        {entry.emotions.length} emotions\n                      </Badge>\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        {entry.sensoryInputs.length} sensory\n                      </Badge>\n                      {entry.environmentalData && (\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          Environmental data\n                        </Badge>\n                      )}\n                    </div>\n                  </div>\n                  {entry.generalNotes && (\n                    <p className=\"text-sm text-muted-foreground mt-1 line-clamp-2\">\n                      {entry.generalNotes}\n                    </p>\n                  )}\n                  {entry.emotions.length > 0 && (\n                    <div className=\"flex flex-wrap gap-1 mt-2\">\n                      {entry.emotions.slice(0, 3).map((emotion, idx) => (\n                        <Badge key={idx} variant=\"secondary\" className=\"text-xs\">\n                          {emotion.emotion} ({emotion.intensity})\n                        </Badge>\n                      ))}\n                      {entry.emotions.length > 3 && (\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          +{entry.emotions.length - 3} more\n                        </Badge>\n                      )}\n                    </div>\n                  )}\n                </div>\n              ))}\n            </div>\n\n            {/* Pagination Controls */}\n            {totalPages > 1 && (\n              <div className=\"flex items-center justify-between pt-4 border-t\">\n                <div className=\"text-sm text-muted-foreground\">\n                  Page {currentPage} of {totalPages}\n                </div>\n                \n                <div className=\"flex items-center gap-1\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    aria-label=\"First page\"\n                    onClick={goToFirstPage}\n                    disabled={!hasPreviousPage}\n                  >\n                    <ChevronsLeft className=\"h-4 w-4\" />\n                  </Button>\n                  \n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    aria-label=\"Previous page\"\n                    onClick={goToPreviousPage}\n                    disabled={!hasPreviousPage}\n                  >\n                    <ChevronLeft className=\"h-4 w-4\" />\n                  </Button>\n\n                  {/* Page number buttons */}\n                  {Array.from({ length: Math.min(5, totalPages) }, (_, i) => {\n                    let pageNum;\n                    if (totalPages <= 5) {\n                      pageNum = i + 1;\n                    } else if (currentPage <= 3) {\n                      pageNum = i + 1;\n                    } else if (currentPage >= totalPages - 2) {\n                      pageNum = totalPages - 4 + i;\n                    } else {\n                      pageNum = currentPage - 2 + i;\n                    }\n\n                    return (\n                      <PageButton\n                        key={pageNum}\n                        pageNum={pageNum}\n                        isCurrent={currentPage === pageNum}\n                        onClick={goToPage}\n                      />\n                    );\n                  })}\n\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    aria-label=\"Next page\"\n                    onClick={goToNextPage}\n                    disabled={!hasNextPage}\n                  >\n                    <ChevronRight className=\"h-4 w-4\" />\n                  </Button>\n                  \n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    aria-label=\"Last page\"\n                    onClick={goToLastPage}\n                    disabled={!hasNextPage}\n                  >\n                    <ChevronsRight className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n            )}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n});\n\n// Add display name for React DevTools and debugging\nPaginatedSessionsList.displayName = 'PaginatedSessionsList';\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/PatternDetectionEmptyState.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/PeriodComparison.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'format' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'subDays' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'subWeeks' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":35},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"vs\"","line":178,"column":17,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":178,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>vs</span>","line":178,"column":17,"nodeType":"JSXText","endLine":178,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"vs\"","line":196,"column":67,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":197,"endColumn":20},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-muted-foreground mt-1\">\n                vs {metric.format ? metric.format(metric.previous) : metric.previous}\n              </div>","line":196,"column":67,"nodeType":"JSXText","endLine":197,"endColumn":20},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotion\"","line":209,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":209,"endColumn":69},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\" className=\"text-xs\">Emotion</Badge>","line":209,"column":62,"nodeType":"JSXText","endLine":209,"endColumn":69},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Most common changed from\"","line":210,"column":57,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":211,"endColumn":44},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-muted-foreground\">\n                  Most common changed from <span className=\"font-medium\">{comparisonStats.mostCommonEmotion}</span> to{\" \"}\n                  <span className=\"font-medium\">{currentStats.mostCommonEmotion}</span>\n                </span>","line":210,"column":57,"nodeType":"JSXText","endLine":211,"endColumn":44},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"to\"","line":211,"column":116,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":211,"endColumn":119},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-muted-foreground\">\n                  Most common changed from <span className=\"font-medium\">{comparisonStats.mostCommonEmotion}</span> to{\" \"}\n                  <span className=\"font-medium\">{currentStats.mostCommonEmotion}</span>\n                </span>","line":211,"column":116,"nodeType":"JSXText","endLine":211,"endColumn":119},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Intensity\"","line":219,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":219,"endColumn":71},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\" className=\"text-xs\">Intensity</Badge>","line":219,"column":62,"nodeType":"JSXText","endLine":219,"endColumn":71},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Average intensity\"","line":220,"column":57,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":221,"endColumn":36},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-muted-foreground\">\n                  Average intensity{\" \"}\n                  {currentStats.avgEmotionIntensity > comparisonStats.avgEmotionIntensity ? \"increased\" : \"decreased\"} by{\" \"}\n                  <span className=\"font-medium\">\n                    {Math.abs(currentStats.avgEmotionIntensity - comparisonStats.avgEmotionIntensity).toFixed(1)} points\n                  </span>\n                </span>","line":220,"column":57,"nodeType":"JSXText","endLine":221,"endColumn":36},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"by\"","line":222,"column":119,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":222,"endColumn":122},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-muted-foreground\">\n                  Average intensity{\" \"}\n                  {currentStats.avgEmotionIntensity > comparisonStats.avgEmotionIntensity ? \"increased\" : \"decreased\"} by{\" \"}\n                  <span className=\"font-medium\">\n                    {Math.abs(currentStats.avgEmotionIntensity - comparisonStats.avgEmotionIntensity).toFixed(1)} points\n                  </span>\n                </span>","line":222,"column":119,"nodeType":"JSXText","endLine":222,"endColumn":122},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"points\"","line":224,"column":114,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":225,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-medium\">\n                    {Math.abs(currentStats.avgEmotionIntensity - comparisonStats.avgEmotionIntensity).toFixed(1)} points\n                  </span>","line":224,"column":114,"nodeType":"JSXText","endLine":225,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory\"","line":232,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":232,"endColumn":69},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\" className=\"text-xs\">Sensory</Badge>","line":232,"column":62,"nodeType":"JSXText","endLine":232,"endColumn":69},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory seeking behavior\"","line":233,"column":57,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":234,"endColumn":43},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-muted-foreground\">\n                  Sensory seeking behavior{\" \"}\n                  {currentStats.seekingRatio > comparisonStats.seekingRatio ? \"increased\" : \"decreased\"} by{\" \"}\n                  <span className=\"font-medium\">\n                    {Math.abs((currentStats.seekingRatio - comparisonStats.seekingRatio) * 100).toFixed(1)}%\n                  </span>\n                </span>","line":233,"column":57,"nodeType":"JSXText","endLine":234,"endColumn":43},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"by\"","line":235,"column":105,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":235,"endColumn":108},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-muted-foreground\">\n                  Sensory seeking behavior{\" \"}\n                  {currentStats.seekingRatio > comparisonStats.seekingRatio ? \"increased\" : \"decreased\"} by{\" \"}\n                  <span className=\"font-medium\">\n                    {Math.abs((currentStats.seekingRatio - comparisonStats.seekingRatio) * 100).toFixed(1)}%\n                  </span>\n                </span>","line":235,"column":105,"nodeType":"JSXText","endLine":235,"endColumn":108}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":28,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useMemo } from \"react\";\nimport { format, subDays, subWeeks, subMonths, isWithinInterval } from \"date-fns\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { EmotionEntry, SensoryEntry } from \"@/types/student\";\nimport { TimeRange } from \"./DateRangeSelector\";\nimport { TrendingUp, TrendingDown, Minus, ArrowRight } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { useTranslation } from \"@/hooks/useTranslation\";\n\ninterface PeriodComparisonProps {\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  currentRange: TimeRange;\n  className?: string;\n}\n\ninterface PeriodStats {\n  emotionsCount: number;\n  sensoryCount: number;\n  avgEmotionIntensity: number;\n  mostCommonEmotion: string;\n  seekingRatio: number;\n  period: string;\n}\n\nexport const PeriodComparison = ({ emotions, sensoryInputs, currentRange, className }: PeriodComparisonProps) => {\n  const { tAnalytics, tStudent } = useTranslation();\n  const [comparisonPeriod, setComparisonPeriod] = useState<\"previous\" | \"same-last-month\" | \"same-last-year\">(\"previous\");\n\n  const getComparisonRange = (): TimeRange => {\n    const startTime = currentRange.start.getTime();\n    const endTime = currentRange.end.getTime();\n    const duration = endTime - startTime;\n    \n    switch (comparisonPeriod) {\n      case \"previous\":\n        return {\n          start: new Date(startTime - duration),\n          end: new Date(startTime - 1),\n          label: \"Previous period\"\n        };\n      case \"same-last-month\":\n        return {\n          start: subMonths(currentRange.start, 1),\n          end: subMonths(currentRange.end, 1),\n          label: \"Same period last month\"\n        };\n      case \"same-last-year\":\n        return {\n          start: new Date(currentRange.start.getFullYear() - 1, currentRange.start.getMonth(), currentRange.start.getDate()),\n          end: new Date(currentRange.end.getFullYear() - 1, currentRange.end.getMonth(), currentRange.end.getDate()),\n          label: \"Same period last year\"\n        };\n      default:\n        return currentRange;\n    }\n  };\n\n  const calculatePeriodStats = (emotions: EmotionEntry[], sensoryInputs: SensoryEntry[], range: TimeRange): PeriodStats => {\n    const filteredEmotions = emotions.filter(e => \n      isWithinInterval(e.timestamp, { start: range.start, end: range.end })\n    );\n    const filteredSensory = sensoryInputs.filter(s => \n      isWithinInterval(s.timestamp, { start: range.start, end: range.end })\n    );\n\n    const avgIntensity = filteredEmotions.length > 0 \n      ? filteredEmotions.reduce((sum, e) => sum + e.intensity, 0) / filteredEmotions.length \n      : 0;\n\n    const emotionCounts = filteredEmotions.reduce((acc, e) => {\n      acc[e.emotion] = (acc[e.emotion] || 0) + 1;\n      return acc;\n    }, {} as Record<string, number>);\n\n    const mostCommon = Object.entries(emotionCounts)\n      .sort(([,a], [,b]) => b - a)[0]?.[0] || \"None\";\n\n    const seekingCount = filteredSensory.filter(s => s.response === 'seeking').length;\n    const seekingRatio = filteredSensory.length > 0 ? seekingCount / filteredSensory.length : 0;\n\n    return {\n      emotionsCount: filteredEmotions.length,\n      sensoryCount: filteredSensory.length,\n      avgEmotionIntensity: avgIntensity,\n      mostCommonEmotion: mostCommon,\n      seekingRatio,\n      period: range.label\n    };\n  };\n\n  const comparisonRange = getComparisonRange();\n  const currentStats = calculatePeriodStats(emotions, sensoryInputs, currentRange);\n  const comparisonStats = calculatePeriodStats(emotions, sensoryInputs, comparisonRange);\n\n  const getTrendIcon = (current: number, previous: number) => {\n    if (current > previous) return <TrendingUp className=\"h-4 w-4 text-emerald-500\" />;\n    if (current < previous) return <TrendingDown className=\"h-4 w-4 text-red-500\" />;\n    return <Minus className=\"h-4 w-4 text-muted-foreground\" />;\n  };\n\n  const getTrendColor = (current: number, previous: number) => {\n    if (current > previous) return \"text-emerald-600\";\n    if (current < previous) return \"text-red-600\";\n    return \"text-muted-foreground\";\n  };\n\n  const getPercentageChange = (current: number, previous: number) => {\n    if (previous === 0) return current > 0 ? \"+100%\" : \"0%\";\n    const change = ((current - previous) / previous) * 100;\n    return `${change > 0 ? '+' : ''}${change.toFixed(1)}%`;\n  };\n\n  const comparisonMetrics = [\n    {\n      label: String(tAnalytics('interface.totalEmotions')),\n      current: currentStats.emotionsCount,\n      previous: comparisonStats.emotionsCount,\n    },\n    {\n      label: String(tStudent('interface.sensoryInputs')),\n      current: currentStats.sensoryCount,\n      previous: comparisonStats.sensoryCount,\n    },\n    {\n      label: String(tAnalytics('interface.avgIntensity')),\n      current: currentStats.avgEmotionIntensity,\n      previous: comparisonStats.avgEmotionIntensity,\n      format: (val: number) => val.toFixed(1)\n    },\n    {\n      label: String(tAnalytics('interface.seekingRatio')),\n      current: currentStats.seekingRatio,\n      previous: comparisonStats.seekingRatio,\n      format: (val: number) => `${(val * 100).toFixed(1)}%`\n    }\n  ];\n\n  return (\n    <Card className={cn(\"bg-gradient-card border-0 shadow-soft font-dyslexia\", className)}>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <ArrowRight className=\"h-5 w-5\" />\n            {String(tAnalytics('interface.periodComparison'))}\n          </CardTitle>\n          <div className=\"flex gap-2\">\n            <Button\n              variant={comparisonPeriod === \"previous\" ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => setComparisonPeriod(\"previous\")}\n              className=\"text-xs\"\n            >\n              {String(tAnalytics('interface.previous'))}\n            </Button>\n            <Button\n              variant={comparisonPeriod === \"same-last-month\" ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => setComparisonPeriod(\"same-last-month\")}\n              className=\"text-xs\"\n            >\n              {String(tAnalytics('interface.lastMonth'))}\n            </Button>\n            <Button\n              variant={comparisonPeriod === \"same-last-year\" ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => setComparisonPeriod(\"same-last-year\")}\n              className=\"text-xs\"\n            >\n              {String(tAnalytics('interface.lastYear'))}\n            </Button>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n          <span>{currentRange.label}</span>\n          <span>vs</span>\n          <span>{comparisonRange.label}</span>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n          {comparisonMetrics.map((metric) => (\n            <div key={metric.label} className=\"text-center\">\n              <div className=\"text-xs text-muted-foreground mb-1\">{metric.label}</div>\n              <div className=\"flex items-center justify-center gap-1 mb-1\">\n                <span className=\"text-lg font-semibold\">\n                  {metric.format ? metric.format(metric.current) : metric.current}\n                </span>\n                {getTrendIcon(metric.current, metric.previous)}\n              </div>\n              <div className={cn(\"text-xs font-medium\", getTrendColor(metric.current, metric.previous))}>\n                {getPercentageChange(metric.current, metric.previous)}\n              </div>\n              <div className=\"text-xs text-muted-foreground mt-1\">\n                vs {metric.format ? metric.format(metric.previous) : metric.previous}\n              </div>\n            </div>\n          ))}\n        </div>\n\n        {/* Key Changes */}\n        <div className=\"mt-6 pt-4 border-t border-border\">\n          <h4 className=\"text-sm font-medium mb-3\">{String(tAnalytics('interface.keyChanges'))}</h4>\n          <div className=\"space-y-2\">\n            {currentStats.mostCommonEmotion !== comparisonStats.mostCommonEmotion && (\n              <div className=\"flex items-center gap-2 text-sm\">\n                <Badge variant=\"outline\" className=\"text-xs\">Emotion</Badge>\n                <span className=\"text-muted-foreground\">\n                  Most common changed from <span className=\"font-medium\">{comparisonStats.mostCommonEmotion}</span> to{\" \"}\n                  <span className=\"font-medium\">{currentStats.mostCommonEmotion}</span>\n                </span>\n              </div>\n            )}\n            \n            {Math.abs(currentStats.avgEmotionIntensity - comparisonStats.avgEmotionIntensity) > 0.5 && (\n              <div className=\"flex items-center gap-2 text-sm\">\n                <Badge variant=\"outline\" className=\"text-xs\">Intensity</Badge>\n                <span className=\"text-muted-foreground\">\n                  Average intensity{\" \"}\n                  {currentStats.avgEmotionIntensity > comparisonStats.avgEmotionIntensity ? \"increased\" : \"decreased\"} by{\" \"}\n                  <span className=\"font-medium\">\n                    {Math.abs(currentStats.avgEmotionIntensity - comparisonStats.avgEmotionIntensity).toFixed(1)} points\n                  </span>\n                </span>\n              </div>\n            )}\n\n            {Math.abs(currentStats.seekingRatio - comparisonStats.seekingRatio) > 0.1 && (\n              <div className=\"flex items-center gap-2 text-sm\">\n                <Badge variant=\"outline\" className=\"text-xs\">Sensory</Badge>\n                <span className=\"text-muted-foreground\">\n                  Sensory seeking behavior{\" \"}\n                  {currentStats.seekingRatio > comparisonStats.seekingRatio ? \"increased\" : \"decreased\"} by{\" \"}\n                  <span className=\"font-medium\">\n                    {Math.abs((currentStats.seekingRatio - comparisonStats.seekingRatio) * 100).toFixed(1)}%\n                  </span>\n                </span>\n              </div>\n            )}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/PredictionTimeline.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/PremiumEmptyState.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":12},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":87,"column":22,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":87,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { motion } from 'framer-motion';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Plus, Users, BookOpen, Target } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ninterface PremiumEmptyStateProps {\n  title: string;\n  description: string;\n  buttonText: string;\n  onAddStudent: () => void;\n}\n\nexport const PremiumEmptyState = ({ \n  title, \n  description, \n  buttonText, \n  onAddStudent \n}: PremiumEmptyStateProps) => {\n  return (\n    <motion.div\n      initial={{ opacity: 0, scale: 0.9 }}\n      animate={{ opacity: 1, scale: 1 }}\n      transition={{ duration: 0.6, delay: 0.3 }}\n    >\n      <Card className=\"bg-gradient-card border-0 shadow-soft overflow-hidden relative\">\n        {/* Decorative background elements */}\n        <motion.div\n          className=\"absolute top-4 right-4 text-primary/10\"\n          animate={{ \n            rotate: [0, 360],\n            scale: [1, 1.1, 1]\n          }}\n          transition={{ \n            duration: 20,\n            repeat: Infinity,\n            ease: \"linear\"\n          }}\n        >\n          <BookOpen className=\"h-32 w-32\" />\n        </motion.div>\n        \n        <motion.div\n          className=\"absolute bottom-4 left-4 text-secondary/10\"\n          animate={{ \n            rotate: [360, 0],\n            scale: [1.1, 1, 1.1]\n          }}\n          transition={{ \n            duration: 15,\n            repeat: Infinity,\n            ease: \"linear\"\n          }}\n        >\n          <Target className=\"h-24 w-24\" />\n        </motion.div>\n\n        <CardContent className=\"flex flex-col items-center justify-center py-20 px-8 relative z-10\">\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.6, delay: 0.5 }}\n            className=\"relative mb-6\"\n          >\n            <motion.div\n              className=\"p-6 rounded-full bg-gradient-primary shadow-elegant\"\n              whileHover={{ scale: 1.05 }}\n              animate={{\n                boxShadow: [\n                  \"0 10px 30px -10px rgba(var(--primary), 0.3)\",\n                  \"0 20px 40px -10px rgba(var(--primary), 0.4)\",\n                  \"0 10px 30px -10px rgba(var(--primary), 0.3)\"\n                ]\n              }}\n              transition={{\n                duration: 3,\n                repeat: Infinity,\n                ease: \"easeInOut\"\n              }}\n            >\n              <Users className=\"h-12 w-12 text-white\" />\n            </motion.div>\n            \n            {/* Floating particles */}\n            {[...Array(6)].map((_, i) => (\n              <motion.div\n                key={i}\n                className=\"absolute w-2 h-2 bg-primary/30 rounded-full left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2\"\n                initial={{ \n                  x: 0, \n                  y: 0,\n                  opacity: 0\n                }}\n                animate={{ \n                  x: Math.cos(i * 60 * Math.PI / 180) * 60,\n                  y: Math.sin(i * 60 * Math.PI / 180) * 60,\n                  opacity: [0, 1, 0]\n                }}\n                transition={{\n                  duration: 2,\n                  repeat: Infinity,\n                  delay: i * 0.2,\n                  ease: \"easeInOut\"\n                }}\n              />\n            ))}\n          </motion.div>\n          \n          <motion.h3\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.6, delay: 0.7 }}\n            className=\"text-2xl font-semibold text-foreground mb-3 text-center\"\n          >\n            {title}\n          </motion.h3>\n          \n          <motion.p\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.6, delay: 0.9 }}\n            className=\"text-muted-foreground text-center mb-8 max-w-md leading-relaxed\"\n          >\n            {description}\n          </motion.p>\n          \n          <motion.div\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.6, delay: 1.1 }}\n            whileHover={{ scale: 1.02 }}\n            whileTap={{ scale: 0.98 }}\n          >\n            <Button \n              onClick={onAddStudent}\n              size=\"lg\"\n              className=\"bg-gradient-primary hover:opacity-90 font-dyslexia px-8 py-3 text-lg shadow-elegant hover:shadow-glow transition-all duration-300\"\n            >\n              <motion.div\n                className=\"flex items-center gap-2\"\n                whileHover={{ x: 2 }}\n                transition={{ duration: 0.2 }}\n              >\n                <Plus className=\"h-5 w-5\" />\n                {buttonText}\n              </motion.div>\n            </Button>\n          </motion.div>\n        </CardContent>\n      </Card>\n    </motion.div>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/PremiumHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ProgressDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Button' is defined but never used. Allowed unused vars must match /^_/u.","line":17,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'startOfWeek' is defined but never used. Allowed unused vars must match /^_/u.","line":24,"column":36,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'selectedTimeframe' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":49,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setSelectedTimeframe' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":49,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":49,"endColumn":49},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":159,"column":23,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":161,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'COLORS' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":189,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":189,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Total Goals\"","line":221,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":221,"endColumn":67},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"text-sm font-medium\">Total Goals</CardTitle>","line":221,"column":56,"nodeType":"JSXText","endLine":221,"endColumn":67},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"active,\"","line":229,"column":44,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":229,"endColumn":53},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground\">\n              {progressMetrics.activeGoals} active, {progressMetrics.achievedGoals} achieved\n            </p>","line":229,"column":44,"nodeType":"JSXText","endLine":229,"endColumn":53},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"achieved\"","line":229,"column":84,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":230,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground\">\n              {progressMetrics.activeGoals} active, {progressMetrics.achievedGoals} achieved\n            </p>","line":229,"column":84,"nodeType":"JSXText","endLine":230,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Overall Progress\"","line":236,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":236,"endColumn":72},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"text-sm font-medium\">Overall Progress</CardTitle>","line":236,"column":56,"nodeType":"JSXText","endLine":236,"endColumn":72},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"On Track\"","line":249,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":249,"endColumn":64},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"text-sm font-medium\">On Track</CardTitle>","line":249,"column":56,"nodeType":"JSXText","endLine":249,"endColumn":64},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"goals meeting expectations\"","line":256,"column":58,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":258,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground\">\n              goals meeting expectations\n            </p>","line":256,"column":58,"nodeType":"JSXText","endLine":258,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"At Risk\"","line":264,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":264,"endColumn":63},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"text-sm font-medium\">At Risk</CardTitle>","line":264,"column":56,"nodeType":"JSXText","endLine":264,"endColumn":63},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"goals needing attention\"","line":271,"column":58,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":273,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground\">\n              goals needing attention\n            </p>","line":271,"column":58,"nodeType":"JSXText","endLine":273,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Overview\"","line":280,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":280,"endColumn":49},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"overview\">Overview</TabsTrigger>","line":280,"column":41,"nodeType":"JSXText","endLine":280,"endColumn":49},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Trends\"","line":281,"column":39,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":281,"endColumn":45},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"trends\">Trends</TabsTrigger>","line":281,"column":39,"nodeType":"JSXText","endLine":281,"endColumn":45},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Categories\"","line":282,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":282,"endColumn":53},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"categories\">Categories</TabsTrigger>","line":282,"column":43,"nodeType":"JSXText","endLine":282,"endColumn":53},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Priorities\"","line":283,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":283,"endColumn":53},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"priorities\">Priorities</TabsTrigger>","line":283,"column":43,"nodeType":"JSXText","endLine":283,"endColumn":53},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Progress Trends (Last 3 Months)\"","line":290,"column":26,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":290,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle>Progress Trends (Last 3 Months)</CardTitle>","line":290,"column":26,"nodeType":"JSXText","endLine":290,"endColumn":57},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Recent Goal Updates\"","line":338,"column":26,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":338,"endColumn":45},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle>Recent Goal Updates</CardTitle>","line":338,"column":26,"nodeType":"JSXText","endLine":338,"endColumn":45},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Updated\"","line":356,"column":72,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":357,"endColumn":37},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground\">\n                            Updated {format(latestPoint.timestamp, 'MMM dd, yyyy')}\n                          </p>","line":356,"column":72,"nodeType":"JSXText","endLine":357,"endColumn":37},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Goal Completion Trends\"","line":376,"column":26,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":376,"endColumn":48},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle>Goal Completion Trends</CardTitle>","line":376,"column":26,"nodeType":"JSXText","endLine":376,"endColumn":48},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Progress by Category\"","line":419,"column":28,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":419,"endColumn":48},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle>Progress by Category</CardTitle>","line":419,"column":28,"nodeType":"JSXText","endLine":419,"endColumn":48},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Category Breakdown\"","line":461,"column":28,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":461,"endColumn":46},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle>Category Breakdown</CardTitle>","line":461,"column":28,"nodeType":"JSXText","endLine":461,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used. Allowed unused args must match /^_/u.","line":465,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":465,"endColumn":53},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"goals\"","line":469,"column":66,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":469,"endColumn":72},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\">{category.count} goals</Badge>","line":469,"column":66,"nodeType":"JSXText","endLine":469,"endColumn":72},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"% average progress\"","line":473,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":473,"endColumn":68},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>{category.progress}% average progress</span>","line":473,"column":50,"nodeType":"JSXText","endLine":473,"endColumn":68},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"achieved\"","line":474,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":474,"endColumn":59},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>{category.achieved} achieved</span>","line":474,"column":50,"nodeType":"JSXText","endLine":474,"endColumn":59},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Priority Goals Requiring Attention\"","line":487,"column":26,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":487,"endColumn":60},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle>Priority Goals Requiring Attention</CardTitle>","line":487,"column":26,"nodeType":"JSXText","endLine":487,"endColumn":60},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used. Allowed unused args must match /^_/u.","line":491,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":491,"endColumn":53},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Progress\"","line":506,"column":31,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":506,"endColumn":39},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Progress</span>","line":506,"column":31,"nodeType":"JSXText","endLine":506,"endColumn":39},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"⚠️ This goal is past its target date and may need review or extension.\"","line":512,"column":135,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":514,"endColumn":23},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"p-2 bg-destructive/10 border border-destructive/20 rounded text-sm text-destructive-foreground\">\n                        ⚠️ This goal is past its target date and may need review or extension.\n                      </div>","line":512,"column":135,"nodeType":"JSXText","endLine":514,"endColumn":23},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"📈 Consider increasing intervention intensity to meet target date.\"","line":517,"column":123,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":519,"endColumn":23},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"p-2 bg-warning/10 border border-warning/20 rounded text-sm text-warning-foreground\">\n                        📈 Consider increasing intervention intensity to meet target date.\n                      </div>","line":517,"column":123,"nodeType":"JSXText","endLine":519,"endColumn":23},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"All goals are on track!\"","line":526,"column":80,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":526,"endColumn":103},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-lg font-medium text-success-foreground\">All goals are on track!</p>","line":526,"column":80,"nodeType":"JSXText","endLine":526,"endColumn":103},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Great work keeping\"","line":527,"column":58,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":527,"endColumn":77},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">Great work keeping {student.name}'s progress moving forward.</p>","line":527,"column":58,"nodeType":"JSXText","endLine":527,"endColumn":77},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"'s progress moving forward.\"","line":527,"column":91,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":527,"endColumn":118},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">Great work keeping {student.name}'s progress moving forward.</p>","line":527,"column":91,"nodeType":"JSXText","endLine":527,"endColumn":118}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":64,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * @fileoverview ProgressDashboard - Comprehensive goal tracking and analytics visualization\n * \n * Provides detailed insights into student goal progress with multiple visualization types:\n * - Overall progress metrics and KPIs\n * - Time-series progress tracking\n * - Category-based performance analysis  \n * - Priority goal recommendations\n * \n * @module components/ProgressDashboard\n */\n\nimport { useState, useMemo, useEffect } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Goal, Student } from \"@/types/student\";\nimport type { EChartsOption } from \"echarts\";\nimport React from 'react';\nconst EChartContainer = React.lazy(() => import(\"@/components/charts/EChartContainer\").then(m => ({ default: m.EChartContainer })));\nimport { TrendingUp, Crosshair, Award, Clock, CheckCircle } from \"lucide-react\";\nimport { format, differenceInDays, startOfWeek, endOfWeek, eachWeekOfInterval, startOfMonth, endOfMonth } from \"date-fns\";\nimport { OptimizedAnimatedCounter } from \"@/components/optimized\";\n\ninterface ProgressDashboardProps {\n  student: Student;\n  goals: Goal[];\n}\n\n/**\n * ProgressDashboard Component\n * \n * Displays comprehensive analytics and visualizations for student goal progress.\n * Provides metrics, trends, category breakdowns, and priority recommendations.\n * \n * @component\n * @param {ProgressDashboardProps} props - Component props\n * @param {Student} props.student - Student whose progress is being tracked\n * @param {Goal[]} props.goals - Array of student goals to analyze\n * \n * @example\n * ```tsx\n * <ProgressDashboard student={currentStudent} goals={studentGoals} />\n * ```\n */\nexport const ProgressDashboard = ({ student, goals }: ProgressDashboardProps) => {\n  const [selectedTimeframe, setSelectedTimeframe] = useState<'week' | 'month' | 'quarter'>('month');\n  const [isAnalyzingTrends, setIsAnalyzingTrends] = useState(false);\n\n  /**\n   * Calculate key progress metrics from goals data.\n   * Memoized to prevent unnecessary recalculations on re-renders.\n   * \n   * @returns {Object} Progress metrics\n   * @returns {number} totalGoals - Total number of goals\n   * @returns {number} activeGoals - Number of active goals\n   * @returns {number} achievedGoals - Number of achieved goals\n   * @returns {number} overallProgress - Average progress percentage\n   * @returns {number} onTrackGoals - Goals meeting expected progress\n   * @returns {number} atRiskGoals - Goals falling behind schedule\n   */\n  const progressMetrics = useMemo(() => {\n    const activeGoals = goals.filter(g => g.status === 'active');\n    const achievedGoals = goals.filter(g => g.status === 'achieved');\n    const overallProgress = goals.length > 0 \n      ? goals.reduce((sum, goal) => sum + goal.currentProgress, 0) / goals.length \n      : 0;\n\n    const onTrackGoals = activeGoals.filter(goal => {\n      const daysUntilTarget = differenceInDays(goal.targetDate, new Date());\n      const expectedProgress = daysUntilTarget > 0 \n        ? Math.max(0, 100 - (daysUntilTarget / differenceInDays(goal.targetDate, goal.createdDate)) * 100)\n        : 100;\n      return goal.currentProgress >= expectedProgress * 0.8; // 80% of expected progress\n    });\n\n    const atRiskGoals = activeGoals.filter(goal => {\n      const daysUntilTarget = differenceInDays(goal.targetDate, new Date());\n      const expectedProgress = daysUntilTarget > 0 \n        ? Math.max(0, 100 - (daysUntilTarget / differenceInDays(goal.targetDate, goal.createdDate)) * 100)\n        : 100;\n      return goal.currentProgress < expectedProgress * 0.6; // Less than 60% of expected progress\n    });\n\n    return {\n      totalGoals: goals.length,\n      activeGoals: activeGoals.length,\n      achievedGoals: achievedGoals.length,\n      overallProgress,\n      onTrackGoals: onTrackGoals.length,\n      atRiskGoals: atRiskGoals.length\n    };\n  }, [goals]);\n\n  // Prepare chart data for progress over time\n\n\n  const progressChartData = useMemo(() => {\n    const allDataPoints: Array<{\n      date: Date;\n      goalId: string;\n      goalTitle: string;\n      value: number;\n      category: string;\n    }> = [];\n\n    goals.forEach(goal => {\n      goal.dataPoints.forEach(point => {\n        allDataPoints.push({\n          date: point.timestamp,\n          goalId: goal.id,\n          goalTitle: goal.title,\n          value: point.value,\n          category: goal.category\n        });\n      });\n    });\n\n    // Group by week for chart display\n    const now = new Date();\n    const startDate = startOfMonth(new Date(now.getFullYear(), now.getMonth() - 2, 1));\n    const endDate = endOfMonth(now);\n    \n    const weeks = eachWeekOfInterval({ start: startDate, end: endDate });\n    \n    const result = weeks.map(weekStart => {\n      const weekEnd = endOfWeek(weekStart);\n      const weekData = allDataPoints.filter(point => \n        point.date >= weekStart && point.date <= weekEnd\n      );\n\n      const avgProgress = weekData.length > 0\n        ? weekData.reduce((sum, point) => sum + point.value, 0) / weekData.length\n        : 0;\n\n      return {\n        week: format(weekStart, 'MMM dd'),\n        progress: Math.round(avgProgress),\n        dataPoints: weekData.length\n      };\n    });\n    return result;\n  }, [goals]);\n\n  /**\n   * Effect to show a brief loading state when goals data changes.\n   * This provides visual feedback during data processing and prevents jarring updates.\n   * Includes proper cleanup to prevent memory leaks.\n   * \n   * @dependencies goals - Triggers when goals data changes\n   */\n  useEffect(() => {\n    // Set loading state for smooth transitions\n    setIsAnalyzingTrends(true);\n    \n    // Create timeout for loading animation\n    const timeoutId = setTimeout(() => {\n      setIsAnalyzingTrends(false);\n    }, 300);\n    \n    // Cleanup function to prevent memory leaks\n    return () => {\n      clearTimeout(timeoutId);\n      // Ensure loading state is reset if component unmounts during loading\n      setIsAnalyzingTrends(false);\n    };\n  }, [goals]);\n\n  // Category progress data\n  const categoryData = useMemo(() => {\n    const categories = ['behavioral', 'academic', 'social', 'sensory', 'communication'];\n    return categories.map(category => {\n      const categoryGoals = goals.filter(g => g.category === category);\n      const avgProgress = categoryGoals.length > 0\n        ? categoryGoals.reduce((sum, goal) => sum + goal.currentProgress, 0) / categoryGoals.length\n        : 0;\n      \n      return {\n        category: category.charAt(0).toUpperCase() + category.slice(1),\n        progress: Math.round(avgProgress),\n        count: categoryGoals.length,\n        achieved: categoryGoals.filter(g => g.status === 'achieved').length\n      };\n    }).filter(item => item.count > 0);\n  }, [goals]);\n\n  const COLORS = ['hsl(var(--primary))', 'hsl(var(--secondary))', 'hsl(var(--accent))', 'hsl(var(--info))', 'hsl(var(--success))'];\n\n  const getStatusColor = (status: Goal['status']) => {\n    switch (status) {\n      case 'active': return 'text-info';\n      case 'achieved': return 'text-success';\n      case 'modified': return 'text-warning';\n      case 'discontinued': return 'text-destructive';\n      default: return 'text-gray-600';\n    }\n  };\n\n  const getPriorityGoals = () => {\n    const now = new Date();\n    return goals\n      .filter(g => g.status === 'active')\n      .map(goal => ({\n        ...goal,\n        daysUntilTarget: differenceInDays(goal.targetDate, now),\n        urgencyScore: (100 - goal.currentProgress) / Math.max(1, differenceInDays(goal.targetDate, now))\n      }))\n      .sort((a, b) => b.urgencyScore - a.urgencyScore)\n      .slice(0, 5);\n  };\n\n\n return (\n    <div className=\"space-y-6\">\n      {/* Overview Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <Card className=\"bg-gradient-card border-0 shadow-soft\">\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Goals</CardTitle>\n            <Crosshair className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-primary\">\n              <OptimizedAnimatedCounter value={progressMetrics.totalGoals} />\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              {progressMetrics.activeGoals} active, {progressMetrics.achievedGoals} achieved\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-gradient-card border-0 shadow-soft\">\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Overall Progress</CardTitle>\n            <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-primary\">\n              <OptimizedAnimatedCounter value={Math.round(progressMetrics.overallProgress)} />%\n            </div>\n            <Progress value={progressMetrics.overallProgress} className=\"mt-2\" />\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-gradient-card border-0 shadow-soft\">\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">On Track</CardTitle>\n            <CheckCircle className=\"h-4 w-4 text-green-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">\n              <OptimizedAnimatedCounter value={progressMetrics.onTrackGoals} />\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              goals meeting expectations\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"bg-gradient-card border-0 shadow-soft\">\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">At Risk</CardTitle>\n            <Clock className=\"h-4 w-4 text-red-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-red-600\">\n              <OptimizedAnimatedCounter value={progressMetrics.atRiskGoals} />\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              goals needing attention\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Tabs defaultValue=\"overview\" className=\"space-y-4\">\n        <TabsList className=\"grid w-full grid-cols-4\">\n          <TabsTrigger value=\"overview\">Overview</TabsTrigger>\n          <TabsTrigger value=\"trends\">Trends</TabsTrigger>\n          <TabsTrigger value=\"categories\">Categories</TabsTrigger>\n          <TabsTrigger value=\"priorities\">Priorities</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"overview\" className=\"space-y-4\">\n          {/* Progress Over Time Chart */}\n          <Card className=\"bg-gradient-card border-0 shadow-soft\">\n            <CardHeader>\n              <CardTitle>Progress Trends (Last 3 Months)</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {isAnalyzingTrends ? (\n                <div aria-label=\"Loading trends chart\" className=\"h-[300px] w-full\">\n                  <div className=\"h-full w-full animate-pulse rounded-md border border-border/50 bg-muted/20\" />\n                </div>\n              ) : (() => {\n                const option: EChartsOption = {\n                  dataset: { source: progressChartData },\n                  grid: { top: 24, right: 16, bottom: 32, left: 40 },\n                  xAxis: { type: \"category\", name: \"Week\", nameGap: 24 },\n                  yAxis: { type: \"value\", name: \"Progress (%)\", nameGap: 28, min: 0, max: 100 },\n                  tooltip: {\n                    trigger: \"axis\",\n                    axisPointer: { type: \"line\" },\n                    valueFormatter: (val) => (typeof val === \"number\" ? `${Math.round(val)}%` : String(val)),\n                  },\n                  legend: { show: false },\n                  series: [\n                    {\n                      type: \"line\",\n                      smooth: true,\n                      showSymbol: true,\n                      symbolSize: 6,\n                      encode: { x: \"week\", y: \"progress\" },\n                      lineStyle: { width: 2 },\n                      areaStyle: { opacity: 0.08 },\n                    },\n                  ],\n                };\n                return (\n                  <React.Suspense fallback={<div className=\"h-[300px] rounded-md border bg-card motion-safe:animate-pulse\" aria-label=\"Loading progress trends\" />}> \n                    <EChartContainer \n                      option={option} \n                      height={300} \n                      aria-label=\"Progress trends line chart\"\n                      exportRegistration={{ id: 'progress-trends', type: 'progress', title: 'Progress Trends (Last 3 Months)' }}\n                    />\n                  </React.Suspense>\n                );\n              })()}\n            </CardContent>\n          </Card>\n\n          {/* Recent Goal Activities */}\n          <Card className=\"bg-gradient-card border-0 shadow-soft\">\n            <CardHeader>\n              <CardTitle>Recent Goal Updates</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                {goals\n                  .filter(goal => goal.dataPoints.length > 1)\n                  .sort((a, b) => {\n                    const aLatest = Math.max(...a.dataPoints.map(dp => dp.timestamp.getTime()));\n                    const bLatest = Math.max(...b.dataPoints.map(dp => dp.timestamp.getTime()));\n                    return bLatest - aLatest;\n                  })\n                  .slice(0, 5)\n                  .map(goal => {\n                    const latestPoint = goal.dataPoints.sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime())[0];\n                    return (\n                      <div key={goal.id} className=\"flex items-center justify-between p-3 bg-muted/30 rounded-lg\">\n                        <div className=\"flex-1\">\n                          <p className=\"font-medium\">{goal.title}</p>\n                          <p className=\"text-sm text-muted-foreground\">\n                            Updated {format(latestPoint.timestamp, 'MMM dd, yyyy')}\n                          </p>\n                        </div>\n                        <div className=\"text-right\">\n                          <Badge variant=\"outline\" className={getStatusColor(goal.status)}>\n                            {Math.round(goal.currentProgress)}%\n                          </Badge>\n                        </div>\n                      </div>\n                    );\n                  })}\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"trends\" className=\"space-y-4\">\n          <Card className=\"bg-gradient-card border-0 shadow-soft\">\n            <CardHeader>\n              <CardTitle>Goal Completion Trends</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {(() => {\n                const option: EChartsOption = {\n                  dataset: { source: categoryData },\n                  grid: { top: 24, right: 16, bottom: 32, left: 40 },\n                  xAxis: { type: \"category\", name: \"Category\", nameGap: 24 },\n                  yAxis: { type: \"value\", name: \"Progress (%)\", nameGap: 28, min: 0, max: 100 },\n                  tooltip: {\n                    trigger: \"axis\",\n                    axisPointer: { type: \"shadow\" },\n                    valueFormatter: (val) => (typeof val === \"number\" ? `${Math.round(val)}%` : String(val)),\n                  },\n                  legend: { show: false },\n                  series: [\n                    {\n                      type: \"bar\",\n                      encode: { x: \"category\", y: \"progress\" },\n                      barWidth: \"50%\",\n                      itemStyle: { borderRadius: [4, 4, 0, 0] },\n                    },\n                  ],\n                };\n                  return (\n                    <React.Suspense fallback={<div className=\"h-[300px] rounded-md border bg-card motion-safe:animate-pulse\" aria-label=\"Loading category chart\" />}> \n                      <EChartContainer \n                        option={option} \n                        height={300} \n                        aria-label=\"Goal completion by category bar chart\"\n                        exportRegistration={{ id: 'goal-completion-by-category', type: 'progress', title: 'Goal Completion by Category' }}\n                      />\n                    </React.Suspense>\n                  );\n              })()}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"categories\" className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <Card className=\"bg-gradient-card border-0 shadow-soft\">\n              <CardHeader>\n                <CardTitle>Progress by Category</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {(() => {\n                  const option: EChartsOption = {\n                    dataset: {\n                      source: categoryData.map((d) => ({ name: d.category, value: d.progress })),\n                    },\n                    tooltip: {\n                      trigger: \"item\",\n                      valueFormatter: (val) => (typeof val === \"number\" ? `${Math.round(val)}%` : String(val)),\n                    },\n                    legend: { bottom: 0, type: \"scroll\" },\n                    series: [\n                      {\n                        type: \"pie\",\n                        radius: [\"50%\", \"70%\"],\n                        avoidLabelOverlap: true,\n                        label: {\n                          show: true,\n                          formatter: \"{b}: {c}%\",\n                        },\n                        encode: { itemName: \"name\", value: \"value\" },\n                      },\n                    ],\n                  };\n                  return (\n                    <React.Suspense fallback={<div className=\"h-[250px] rounded-md border bg-card motion-safe:animate-pulse\" aria-label=\"Loading donut chart\" />}> \n                      <EChartContainer \n                        option={option} \n                        height={250} \n                        aria-label=\"Progress by category donut chart\"\n                        exportRegistration={{ id: 'progress-by-category', type: 'progress', title: 'Progress by Category' }}\n                      />\n                    </React.Suspense>\n                  );\n                })()}\n              </CardContent>\n            </Card>\n\n            <Card className=\"bg-gradient-card border-0 shadow-soft\">\n              <CardHeader>\n                <CardTitle>Category Breakdown</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  {categoryData.map((category, index) => (\n                    <div key={category.category} className=\"space-y-2\">\n                      <div className=\"flex justify-between items-center\">\n                        <span className=\"font-medium\">{category.category}</span>\n                        <Badge variant=\"outline\">{category.count} goals</Badge>\n                      </div>\n                      <Progress value={category.progress} className=\"h-2\" />\n                      <div className=\"flex justify-between text-xs text-muted-foreground\">\n                        <span>{category.progress}% average progress</span>\n                        <span>{category.achieved} achieved</span>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"priorities\" className=\"space-y-4\">\n          <Card className=\"bg-gradient-card border-0 shadow-soft\">\n            <CardHeader>\n              <CardTitle>Priority Goals Requiring Attention</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                {getPriorityGoals().map((goal, index) => (\n                  <div key={goal.id} className=\"p-4 border border-border rounded-lg space-y-3\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1\">\n                        <h4 className=\"font-medium\">{goal.title}</h4>\n                        <p className=\"text-sm text-muted-foreground\">{goal.category}</p>\n                      </div>\n                      <div className=\"text-right\">\n                        <Badge variant={goal.daysUntilTarget < 30 ? \"destructive\" : \"outline\"}>\n                          {goal.daysUntilTarget > 0 ? `${goal.daysUntilTarget} days left` : 'Overdue'}\n                        </Badge>\n                      </div>\n                    </div>\n                    <div className=\"space-y-2\">\n                      <div className=\"flex justify-between text-sm\">\n                        <span>Progress</span>\n                        <span>{Math.round(goal.currentProgress)}%</span>\n                      </div>\n                      <Progress value={goal.currentProgress} className=\"h-2\" />\n                    </div>\n                    {goal.daysUntilTarget < 0 && (\n                      <div className=\"p-2 bg-destructive/10 border border-destructive/20 rounded text-sm text-destructive-foreground\">\n                        ⚠️ This goal is past its target date and may need review or extension.\n                      </div>\n                    )}\n                    {goal.urgencyScore > 2 && goal.daysUntilTarget > 0 && (\n                      <div className=\"p-2 bg-warning/10 border border-warning/20 rounded text-sm text-warning-foreground\">\n                        📈 Consider increasing intervention intensity to meet target date.\n                      </div>\n                    )}\n                  </div>\n                ))}\n                {getPriorityGoals().length === 0 && (\n                  <div className=\"text-center py-8\">\n                    <Award className=\"h-12 w-12 text-success mx-auto mb-2\" />\n                    <p className=\"text-lg font-medium text-success-foreground\">All goals are on track!</p>\n                    <p className=\"text-muted-foreground\">Great work keeping {student.name}'s progress moving forward.</p>\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/QuickEntryTemplates.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Sparkles' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Brain' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Sun' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Moon' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":48},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RefreshCw' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":59},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'X' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":67,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":68},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'editingTemplate' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":173,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":173,"endColumn":25},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Quick Entry Templates\"","line":302,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":304,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n            <Zap className=\"h-5 w-5 text-primary\" />\n            Quick Entry Templates\n          </CardTitle>","line":302,"column":53,"nodeType":"JSXText","endLine":304,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"New Template\"","line":309,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":309,"endColumn":64},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"hidden sm:inline\">New Template</span>","line":309,"column":52,"nodeType":"JSXText","endLine":309,"endColumn":64},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Create Quick Entry Template\"","line":314,"column":30,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":314,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DialogTitle>Create Quick Entry Template</DialogTitle>","line":314,"column":30,"nodeType":"JSXText","endLine":314,"endColumn":57},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Define a name, optional description, category, and default values.\"","line":315,"column":36,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":317,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DialogDescription>\n                  Define a name, optional description, category, and default values.\n                </DialogDescription>","line":315,"column":36,"nodeType":"JSXText","endLine":317,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Template Name\"","line":321,"column":83,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":321,"endColumn":96},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label className=\"text-sm font-medium\" htmlFor={templateNameId}>Template Name</label>","line":321,"column":83,"nodeType":"JSXText","endLine":321,"endColumn":96},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Description\"","line":330,"column":90,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":330,"endColumn":101},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label className=\"text-sm font-medium\" htmlFor={templateDescriptionId}>Description</label>","line":330,"column":90,"nodeType":"JSXText","endLine":330,"endColumn":101},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Category\"","line":343,"column":20,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":345,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label\n                    id={templateCategoryLabelId}\n                    className=\"text-sm font-medium\"\n                    htmlFor={templateCategoryTriggerId}\n                  >\n                    Category\n                  </label>","line":343,"column":20,"nodeType":"JSXText","endLine":345,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Morning\"","line":357,"column":51,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":357,"endColumn":58},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"morning\">Morning</SelectItem>","line":357,"column":51,"nodeType":"JSXText","endLine":357,"endColumn":58},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Transition\"","line":358,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":358,"endColumn":64},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"transition\">Transition</SelectItem>","line":358,"column":54,"nodeType":"JSXText","endLine":358,"endColumn":64},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Learning\"","line":359,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":359,"endColumn":60},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"learning\">Learning</SelectItem>","line":359,"column":52,"nodeType":"JSXText","endLine":359,"endColumn":60},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Break\"","line":360,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":360,"endColumn":54},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"break\">Break</SelectItem>","line":360,"column":49,"nodeType":"JSXText","endLine":360,"endColumn":54},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Afternoon\"","line":361,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":361,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"afternoon\">Afternoon</SelectItem>","line":361,"column":53,"nodeType":"JSXText","endLine":361,"endColumn":62},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Custom\"","line":362,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":362,"endColumn":56},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"custom\">Custom</SelectItem>","line":362,"column":50,"nodeType":"JSXText","endLine":362,"endColumn":56},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Cancel\"","line":367,"column":82,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":369,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button variant=\"outline\" onClick={() => setIsCreating(false)}>\n                    Cancel\n                  </Button>","line":367,"column":82,"nodeType":"JSXText","endLine":369,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Create Template\"","line":370,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":372,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button onClick={createTemplate}>\n                    Create Template\n                  </Button>","line":370,"column":52,"nodeType":"JSXText","endLine":372,"endColumn":19},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":412,"column":37,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":412,"endColumn":40},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"+\"","line":417,"column":72,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":418,"endColumn":28},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"more\"","line":418,"column":58,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":419,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"secondary\" className=\"text-xs\">\n                          +{template.emotions.length - 2} more\n                        </Badge>","line":418,"column":58,"nodeType":"JSXText","endLine":419,"endColumn":25},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Apply Template\"","line":429,"column":22,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":431,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n                      size=\"sm\"\n                      onClick={() => applyTemplate(template)}\n                      className=\"flex-1 mr-2\"\n                    >\n                      Apply Template\n                    </Button>","line":429,"column":22,"nodeType":"JSXText","endLine":431,"endColumn":21},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No quick entry templates yet\"","line":465,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":465,"endColumn":44},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>No quick entry templates yet</p>","line":465,"column":16,"nodeType":"JSXText","endLine":465,"endColumn":44},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Create templates for common tracking scenarios\"","line":466,"column":36,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":466,"endColumn":82},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm\">Create templates for common tracking scenarios</p>","line":466,"column":36,"nodeType":"JSXText","endLine":466,"endColumn":82}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":47,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { EmotionEntry, SensoryEntry } from '@/types/student';\nimport { Sparkles, Zap, Brain, Clock, Sun, Moon, RefreshCw, Plus, X, Trash2, Edit, Star } from 'lucide-react';\nimport { toast } from 'sonner';\nimport { logger } from '@/lib/logger';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogDescription } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\n\ninterface QuickTemplate {\n  id: string;\n  name: string;\n  description: string;\n  category: 'morning' | 'transition' | 'learning' | 'break' | 'afternoon' | 'custom';\n  emotions: Partial<EmotionEntry>[];\n  sensoryInputs: Partial<SensoryEntry>[];\n  isDefault: boolean;\n  usageCount: number;\n  lastUsed?: Date;\n}\n\ninterface QuickEntryTemplatesProps {\n  studentId: string;\n  onApplyTemplate: (emotions: Partial<EmotionEntry>[], sensoryInputs: Partial<SensoryEntry>[]) => void;\n}\n\nconst defaultTemplates: QuickTemplate[] = [\n  {\n    id: 'morning-routine',\n    name: 'Morning Arrival',\n    description: 'Standard morning check-in for classroom entry',\n    category: 'morning',\n    emotions: [\n      { emotion: 'calm', intensity: 3 },\n      { emotion: 'excited', intensity: 2 }\n    ],\n    sensoryInputs: [\n      { sensoryType: 'visual', response: 'neutral', intensity: 2 },\n      { sensoryType: 'auditory', response: 'seeking', intensity: 3 }\n    ],\n    isDefault: true,\n    usageCount: 0\n  },\n  {\n    id: 'transition-stress',\n    name: 'Transition Difficulty',\n    description: 'Quick entry for challenging transitions',\n    category: 'transition',\n    emotions: [\n      { emotion: 'anxious', intensity: 4 },\n      { emotion: 'angry', intensity: 3 }\n    ],\n    sensoryInputs: [\n      { sensoryType: 'auditory', response: 'avoiding', intensity: 4 },\n      { sensoryType: 'tactile', response: 'seeking', intensity: 4 }\n    ],\n    isDefault: true,\n    usageCount: 0\n  },\n  {\n    id: 'focused-learning',\n    name: 'Engaged Learning',\n    description: 'Positive learning engagement state',\n    category: 'learning',\n    emotions: [\n      { emotion: 'calm', intensity: 4 },\n      { emotion: 'excited', intensity: 3 }\n    ],\n    sensoryInputs: [\n      { sensoryType: 'visual', response: 'seeking', intensity: 3 },\n      { sensoryType: 'proprioceptive', response: 'neutral', intensity: 2 }\n    ],\n    isDefault: true,\n    usageCount: 0\n  },\n  {\n    id: 'sensory-break',\n    name: 'Sensory Break',\n    description: 'During or after sensory regulation break',\n    category: 'break',\n    emotions: [\n      { emotion: 'calm', intensity: 4 }\n    ],\n    sensoryInputs: [\n      { sensoryType: 'proprioceptive', response: 'seeking', intensity: 4 },\n      { sensoryType: 'vestibular', response: 'seeking', intensity: 3 }\n    ],\n    isDefault: true,\n    usageCount: 0\n  },\n  {\n    id: 'afternoon-fatigue',\n    name: 'Afternoon Fatigue',\n    description: 'End-of-day tiredness and regulation',\n    category: 'afternoon',\n    emotions: [\n      { emotion: 'sad', intensity: 2 },\n      { emotion: 'calm', intensity: 2 }\n    ],\n    sensoryInputs: [\n      { sensoryType: 'auditory', response: 'avoiding', intensity: 3 },\n      { sensoryType: 'visual', response: 'avoiding', intensity: 2 }\n    ],\n    isDefault: true,\n    usageCount: 0\n  }\n];\n\n/**\n * QuickEntryTemplates Component\n * \n * Provides pre-configured templates for quick emotion and sensory input entries.\n * Templates are persisted per student in localStorage for convenience.\n * \n * @component\n * @param {QuickEntryTemplatesProps} props - Component props\n * @param {string} props.studentId - ID of the current student\n * @param {Function} props.onApplyTemplate - Callback when a template is applied\n */\nexport const QuickEntryTemplates: React.FC<QuickEntryTemplatesProps> = ({\n  studentId,\n  onApplyTemplate\n}) => {\n  /**\n   * Initialize templates from localStorage with error handling.\n   * Falls back to default templates if parsing fails or data is corrupted.\n   */\n  const [templates, setTemplates] = useState<QuickTemplate[]>(() => {\n    try {\n      const saved = localStorage.getItem(`quickTemplates_${studentId}`);\n      if (!saved) return defaultTemplates;\n      \n      // Attempt to parse saved templates\n      const parsed = JSON.parse(saved);\n      \n      // Validate that parsed data is an array\n      if (!Array.isArray(parsed)) {\n        logger.warn('Invalid template data in localStorage, using defaults', { studentId });\n        return defaultTemplates;\n      }\n      \n      // Basic validation of template structure\n      const isValidTemplate = (t: unknown): t is QuickTemplate => {\n        return t && \n               typeof t.id === 'string' && \n               typeof t.name === 'string' &&\n               Array.isArray(t.emotions) &&\n               Array.isArray(t.sensoryInputs);\n      };\n      \n      // Filter out invalid templates\n      const validTemplates = parsed.filter(isValidTemplate);\n      \n      // If no valid templates found, return defaults\n      if (validTemplates.length === 0) {\n        logger.warn('No valid templates found in localStorage, using defaults', { studentId });\n        return defaultTemplates;\n      }\n      \n      return validTemplates;\n    } catch (error) {\n      // Log error and fall back to defaults\n      logger.error('Failed to parse saved templates, using defaults', error);\n      return defaultTemplates;\n    }\n  });\n  \n  const [isCreating, setIsCreating] = useState(false);\n  const [editingTemplate, setEditingTemplate] = useState<QuickTemplate | null>(null);\n  const [newTemplate, setNewTemplate] = useState<Partial<QuickTemplate>>({\n    name: '',\n    description: '',\n    category: 'custom',\n    emotions: [],\n    sensoryInputs: [],\n    isDefault: false,\n    usageCount: 0\n  });\n\n  const templateNameId = React.useId();\n  const templateDescriptionId = React.useId();\n  const templateCategoryTriggerId = React.useId();\n  const templateCategoryLabelId = React.useId();\n\n  /**\n   * Save templates to localStorage with error handling.\n   * Logs errors but doesn't crash the application if saving fails.\n   * \n   * @param {QuickTemplate[]} updatedTemplates - Templates to save\n   */\n  const saveTemplates = (updatedTemplates: QuickTemplate[]) => {\n    setTemplates(updatedTemplates);\n    try {\n      localStorage.setItem(`quickTemplates_${studentId}`, JSON.stringify(updatedTemplates));\n    } catch (error) {\n      // Handle quota exceeded or other storage errors\n      logger.error('Failed to save templates to localStorage', error);\n      toast.error('Failed to save template changes. Storage may be full.');\n    }\n  };\n\n  const applyTemplate = (template: QuickTemplate) => {\n    // Add student ID to entries\n    const emotions = template.emotions.map(emotion => ({\n      ...emotion,\n      studentId,\n      id: `temp_${Date.now()}_${Math.random()}`,\n      timestamp: new Date()\n    }));\n    \n    const sensoryInputs = template.sensoryInputs.map(sensory => ({\n      ...sensory,\n      studentId,\n      id: `temp_${Date.now()}_${Math.random()}`,\n      timestamp: new Date()\n    }));\n\n    // Update usage statistics\n    const updatedTemplates = templates.map(t => \n      t.id === template.id \n        ? { ...t, usageCount: t.usageCount + 1, lastUsed: new Date() }\n        : t\n    );\n    saveTemplates(updatedTemplates);\n\n    onApplyTemplate(emotions, sensoryInputs);\n    toast.success(`Applied template: ${template.name}`);\n  };\n\n  const deleteTemplate = (templateId: string) => {\n    const template = templates.find(t => t.id === templateId);\n    if (template?.isDefault) {\n      toast.error(\"Cannot delete default templates\");\n      return;\n    }\n    \n    const updatedTemplates = templates.filter(t => t.id !== templateId);\n    saveTemplates(updatedTemplates);\n    toast.success(\"Template deleted\");\n  };\n\n  const createTemplate = () => {\n    if (!newTemplate.name?.trim()) {\n      toast.error(\"Template name is required\");\n      return;\n    }\n\n    const template: QuickTemplate = {\n      id: `custom_${Date.now()}`,\n      name: newTemplate.name!,\n      description: newTemplate.description || '',\n      category: (newTemplate.category as \"morning\" | \"transition\" | \"learning\" | \"break\" | \"afternoon\" | \"custom\") || 'custom',\n      emotions: newTemplate.emotions || [],\n      sensoryInputs: newTemplate.sensoryInputs || [],\n      isDefault: false,\n      usageCount: 0\n    };\n\n    const updatedTemplates = [...templates, template];\n    saveTemplates(updatedTemplates);\n    setNewTemplate({\n      name: '',\n      description: '',\n      category: 'custom',\n      emotions: [],\n      sensoryInputs: [],\n      isDefault: false,\n      usageCount: 0\n    });\n    setIsCreating(false);\n    toast.success(\"Template created successfully\");\n  };\n\n  const getCategoryColor = (category: string) => {\n    switch (category) {\n      case 'morning': return 'bg-gradient-to-r from-yellow-400 to-orange-400';\n      case 'transition': return 'bg-gradient-to-r from-red-400 to-pink-400';\n      case 'learning': return 'bg-gradient-to-r from-blue-400 to-indigo-400';\n      case 'break': return 'bg-gradient-to-r from-green-400 to-teal-400';\n      case 'afternoon': return 'bg-gradient-to-r from-purple-400 to-indigo-400';\n      default: return 'bg-gradient-to-r from-gray-400 to-gray-500';\n    }\n  };\n\n  const sortedTemplates = [...templates].sort((a, b) => {\n    // Sort by: 1) Most used, 2) Most recently used, 3) Default first, 4) Name\n    if (a.usageCount !== b.usageCount) return b.usageCount - a.usageCount;\n    if (a.lastUsed && b.lastUsed) return b.lastUsed.getTime() - a.lastUsed.getTime();\n    if (a.isDefault !== b.isDefault) return a.isDefault ? -1 : 1;\n    return a.name.localeCompare(b.name);\n  });\n\n  return (\n    <Card className=\"bg-gradient-card border-0 shadow-soft\">\n      <CardHeader className=\"pb-4\">\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <Zap className=\"h-5 w-5 text-primary\" />\n            Quick Entry Templates\n          </CardTitle>\n          <Dialog open={isCreating} onOpenChange={setIsCreating}>\n            <DialogTrigger asChild>\n              <Button size=\"sm\" variant=\"outline\" aria-label=\"Create new template\" title=\"Create new template\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                <span className=\"hidden sm:inline\">New Template</span>\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-md\">\n              <DialogHeader>\n                <DialogTitle>Create Quick Entry Template</DialogTitle>\n                <DialogDescription>\n                  Define a name, optional description, category, and default values.\n                </DialogDescription>\n              </DialogHeader>\n              <div className=\"space-y-4\">\n                <div>\n                  <label className=\"text-sm font-medium\" htmlFor={templateNameId}>Template Name</label>\n                  <Input\n                    id={templateNameId}\n                    placeholder=\"e.g., Sensory Overload Response\"\n                    value={newTemplate.name || ''}\n                    onChange={(e) => setNewTemplate(prev => ({ ...prev, name: e.target.value }))}\n                  />\n                </div>\n                <div>\n                  <label className=\"text-sm font-medium\" htmlFor={templateDescriptionId}>Description</label>\n                  <Textarea\n                    id={templateDescriptionId}\n                    placeholder=\"Brief description of when to use this template\"\n                    value={newTemplate.description || ''}\n                    onChange={(e) => setNewTemplate(prev => ({ ...prev, description: e.target.value }))}\n                  />\n                </div>\n                <div>\n                  <label\n                    id={templateCategoryLabelId}\n                    className=\"text-sm font-medium\"\n                    htmlFor={templateCategoryTriggerId}\n                  >\n                    Category\n                  </label>\n                  <Select\n                    value={newTemplate.category}\n                    onValueChange={(value) => setNewTemplate(prev => ({ ...prev, category: value as \"morning\" | \"transition\" | \"learning\" | \"break\" | \"afternoon\" | \"custom\" }))}\n                  >\n                    <SelectTrigger\n                      id={templateCategoryTriggerId}\n                      aria-labelledby={templateCategoryLabelId}\n                    >\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"morning\">Morning</SelectItem>\n                      <SelectItem value=\"transition\">Transition</SelectItem>\n                      <SelectItem value=\"learning\">Learning</SelectItem>\n                      <SelectItem value=\"break\">Break</SelectItem>\n                      <SelectItem value=\"afternoon\">Afternoon</SelectItem>\n                      <SelectItem value=\"custom\">Custom</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"flex justify-end gap-2\">\n                  <Button variant=\"outline\" onClick={() => setIsCreating(false)}>\n                    Cancel\n                  </Button>\n                  <Button onClick={createTemplate}>\n                    Create Template\n                  </Button>\n                </div>\n              </div>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </CardHeader>\n\n      <CardContent>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {sortedTemplates.map((template) => (\n            <Card key={template.id} className=\"relative overflow-hidden border-border/50 hover:shadow-md transition-shadow\">\n              {template.usageCount > 0 && (\n                <div className=\"absolute top-2 right-2 flex items-center gap-1\">\n                  <Star className=\"h-3 w-3 text-yellow-500 fill-current\" />\n                  <span className=\"text-xs text-muted-foreground\">{template.usageCount}</span>\n                </div>\n              )}\n              \n              <div className={`h-2 ${getCategoryColor(template.category)}`} />\n              \n              <CardContent className=\"p-4\">\n                <div className=\"space-y-3\">\n                  <div>\n                    <h4 className=\"font-semibold text-sm\">{template.name}</h4>\n                    <p className=\"text-xs text-muted-foreground line-clamp-2\">\n                      {template.description}\n                    </p>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n                      <Clock className=\"h-3 w-3\" />\n                      <Badge variant=\"outline\" className=\"text-xs capitalize\">\n                        {template.category}\n                      </Badge>\n                    </div>\n                    \n                    <div className=\"flex flex-wrap gap-1\">\n                      {template.emotions.slice(0, 2).map((emotion, idx) => (\n                        <Badge key={idx} variant=\"secondary\" className=\"text-xs\">\n                          {emotion.emotion} ({emotion.intensity})\n                        </Badge>\n                      ))}\n                      {template.emotions.length > 2 && (\n                        <Badge variant=\"secondary\" className=\"text-xs\">\n                          +{template.emotions.length - 2} more\n                        </Badge>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"flex items-center justify-between pt-2\">\n                    <Button\n                      size=\"sm\"\n                      onClick={() => applyTemplate(template)}\n                      className=\"flex-1 mr-2\"\n                    >\n                      Apply Template\n                    </Button>\n                    \n                    {!template.isDefault && (\n                      <div className=\"flex gap-1\">\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          aria-label=\"Edit template\"\n                          title=\"Edit template\"\n                          onClick={() => setEditingTemplate(template)}\n                        >\n                          <Edit className=\"h-3 w-3\" />\n                        </Button>\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          aria-label=\"Delete template\"\n                          title=\"Delete template\"\n                          onClick={() => deleteTemplate(template.id)}\n                        >\n                          <Trash2 className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n\n        {templates.length === 0 && (\n          <div className=\"text-center py-8 text-muted-foreground\">\n            <Zap className=\"h-12 w-12 mx-auto mb-3 opacity-50\" />\n            <p>No quick entry templates yet</p>\n            <p className=\"text-sm\">Create templates for common tracking scenarios</p>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ReportBuilder.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Progress' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Mail' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":53},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":65},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Crosshair' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":67,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":76},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'printRef' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":78,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":78,"endColumn":17},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":409,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":411,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Create Report\"","line":473,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":475,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button className=\"bg-gradient-primary hover:opacity-90 font-dyslexia\">\n              <FileText className=\"h-4 w-4 mr-2\" />\n              Create Report\n            </Button>","line":473,"column":52,"nodeType":"JSXText","endLine":475,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogDescription } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Student, Goal, TrackingEntry, EmotionEntry, SensoryEntry } from \"@/types/student\";\nimport { FileText, Download, Printer, Mail, Calendar, TrendingUp, Crosshair } from \"lucide-react\";\nimport { format, startOfMonth, endOfMonth, subMonths } from \"date-fns\";\nimport { toast } from \"sonner\";\nimport { downloadBlob } from \"@/lib/utils\";\nimport { useTranslation } from '@/hooks/useTranslation';\n\ninterface ReportBuilderProps {\n  student: Student;\n  goals: Goal[];\n  trackingEntries: TrackingEntry[];\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n}\n\ninterface ReportTemplate {\n  id: string;\n  name: string;\n  description: string;\n  sections: string[];\n}\n\nconst reportTemplates: ReportTemplate[] = [\n  {\n    id: 'progress-summary',\n    name: 'reports.templates.progress-summary.name',\n    description: 'reports.templates.progress-summary.description',\n    sections: ['student-info', 'goal-progress', 'recent-activities', 'recommendations']\n  },\n  {\n    id: 'iep-meeting',\n    name: 'reports.templates.iep-meeting.name',\n    description: 'reports.templates.iep-meeting.description',\n    sections: ['student-info', 'goal-progress', 'behavioral-patterns', 'environmental-factors', 'recommendations', 'next-steps']\n  },\n  {\n    id: 'behavioral-analysis',\n    name: 'reports.templates.behavioral-analysis.name',\n    description: 'reports.templates.behavioral-analysis.description',\n    sections: ['student-info', 'behavioral-patterns', 'sensory-patterns', 'environmental-factors', 'interventions']\n  },\n  {\n    id: 'quarterly-review',\n    name: 'reports.templates.quarterly-review.name',\n    description: 'reports.templates.quarterly-review.description',\n    sections: ['student-info', 'goal-progress', 'data-trends', 'achievements', 'challenges', 'next-quarter-planning']\n  }\n];\n\nexport const ReportBuilder = ({ student, goals, trackingEntries, emotions, sensoryInputs }: ReportBuilderProps) => {\n  const { tCommon } = useTranslation();\n  const [showBuilder, setShowBuilder] = useState(false);\n  const [selectedTemplate, setSelectedTemplate] = useState<string>('progress-summary');\n  const [reportData, setReportData] = useState({\n    title: '',\n    dateRange: {\n      start: format(startOfMonth(subMonths(new Date(), 1)), 'yyyy-MM-dd'),\n      end: format(endOfMonth(new Date()), 'yyyy-MM-dd')\n    },\n    sections: [] as string[],\n    includeCharts: true,\n    includeRawData: false,\n    customNotes: '',\n    reportingTeacher: '',\n    schoolDistrict: ''\n  });\n  const printRef = useRef<HTMLDivElement>(null);\n\n  const handleTemplateChange = (templateId: string) => {\n    const template = reportTemplates.find(t => t.id === templateId);\n    if (template) {\n      setSelectedTemplate(templateId);\n      setReportData(prev => ({\n        ...prev,\n        title: tCommon(template.name as unknown as string),\n        sections: template.sections\n      }));\n    }\n  };\n\n  /**\n   * Generate comprehensive report data with error handling.\n   * Safely processes date ranges and handles edge cases.\n   * \n   * @returns {Object} Aggregated report data for rendering\n   */\n  const generateReportData = () => {\n    // Parse dates with validation\n    const startDate = new Date(reportData.dateRange.start);\n    const endDate = new Date(reportData.dateRange.end);\n    \n    // Validate date parsing\n    if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {\n      toast.error(tCommon('reports.builder.errors.invalidDateRange'));\n      return null;\n    }\n    \n    if (startDate > endDate) {\n      toast.error(tCommon('reports.builder.errors.startBeforeEnd'));\n      return null;\n    }\n\n    // Filter data by date range\n    const filteredEntries = trackingEntries.filter(entry => \n      entry.timestamp >= startDate && entry.timestamp <= endDate\n    );\n    const filteredEmotions = emotions.filter(emotion => \n      emotion.timestamp >= startDate && emotion.timestamp <= endDate\n    );\n    const filteredSensory = sensoryInputs.filter(sensory => \n      sensory.timestamp >= startDate && sensory.timestamp <= endDate\n    );\n\n    // Calculate progress metrics\n    const goalProgress = goals.map(goal => {\n      const progressInPeriod = goal.dataPoints.filter(dp => \n        dp.timestamp >= startDate && dp.timestamp <= endDate\n      );\n      const progressChange = progressInPeriod.length > 1 \n        ? progressInPeriod[progressInPeriod.length - 1].value - progressInPeriod[0].value\n        : 0;\n\n      return {\n        ...goal,\n        progressInPeriod: progressInPeriod.length,\n        progressChange,\n        currentValue: goal.dataPoints.length > 0 ? goal.dataPoints[goal.dataPoints.length - 1].value : 0\n      };\n    });\n\n    // Emotion patterns\n    const emotionSummary = filteredEmotions.reduce((acc, emotion) => {\n      acc[emotion.emotion] = (acc[emotion.emotion] || 0) + 1;\n      return acc;\n    }, {} as Record<string, number>);\n\n    const avgEmotionIntensity = filteredEmotions.length > 0\n      ? filteredEmotions.reduce((sum, e) => sum + e.intensity, 0) / filteredEmotions.length\n      : 0;\n\n    // Sensory patterns\n    const sensorySeekingCount = filteredSensory.filter(s => s.response === 'seeking').length;\n    const sensoryAvoidingCount = filteredSensory.filter(s => s.response === 'avoiding').length;\n\n    const sensorySummary = filteredSensory.reduce((acc, sensory) => {\n      acc[sensory.sensoryType] = (acc[sensory.sensoryType] || 0) + 1;\n      return acc;\n    }, {} as Record<string, number>);\n\n    return {\n      period: { start: startDate, end: endDate },\n      totalSessions: filteredEntries.length,\n      goalProgress,\n      emotionSummary,\n      avgEmotionIntensity,\n      sensorySummary,\n      sensorySeekingCount,\n      sensoryAvoidingCount,\n      achievements: goalProgress.filter(g => g.progressChange > 0),\n      challenges: goalProgress.filter(g => g.progressChange < 0 || g.currentProgress < 50)\n    };\n  };\n\n  const generatePDF = () => {\n    const reportAnalysis = generateReportData();\n    \n    // In a real implementation, this would use a PDF library like jsPDF or Puppeteer\n    // For now, we'll create a printable HTML version\n    \n    const printWindow = window.open('', '_blank');\n    if (!printWindow) return;\n\n    const htmlContent = `\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>${reportData.title} - ${student.name}</title>\n          <style>\n            body { \n              font-family: Arial, sans-serif; \n              margin: 40px; \n              line-height: 1.6;\n              color: #333;\n            }\n            .header { \n              text-align: center; \n              border-bottom: 2px solid #4f46e5; \n              padding-bottom: 20px; \n              margin-bottom: 30px;\n            }\n            .section { \n              margin-bottom: 30px; \n              page-break-inside: avoid;\n            }\n            .section h2 { \n              color: #4f46e5; \n              border-bottom: 1px solid #e5e7eb; \n              padding-bottom: 10px;\n            }\n            .goal-card {\n              border: 1px solid #e5e7eb;\n              border-radius: 8px;\n              padding: 15px;\n              margin-bottom: 15px;\n              background: #f9fafb;\n            }\n            .progress-bar {\n              background: #e5e7eb;\n              height: 10px;\n              border-radius: 5px;\n              overflow: hidden;\n              margin: 10px 0;\n            }\n            .progress-fill {\n              background: #4f46e5;\n              height: 100%;\n              transition: width 0.3s ease;\n            }\n            .metric {\n              display: inline-block;\n              margin: 10px 15px 10px 0;\n              padding: 10px;\n              background: #f3f4f6;\n              border-radius: 6px;\n              min-width: 120px;\n              text-align: center;\n            }\n            .metric-value {\n              font-size: 24px;\n              font-weight: bold;\n              color: #4f46e5;\n            }\n            .metric-label {\n              font-size: 12px;\n              color: #6b7280;\n              text-transform: uppercase;\n            }\n            @media print {\n              body { margin: 20px; }\n              .section { page-break-inside: avoid; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class=\"header\">\n            <h1>${reportData.title}</h1>\n            <h2>${student.name}</h2>\n            <p>Report Period: ${format(reportAnalysis.period.start, 'MMMM dd, yyyy')} - ${format(reportAnalysis.period.end, 'MMMM dd, yyyy')}</p>\n            <p>Generated: ${format(new Date(), 'MMMM dd, yyyy')}</p>\n            ${reportData.reportingTeacher ? `<p>Prepared by: ${reportData.reportingTeacher}</p>` : ''}\n            ${reportData.schoolDistrict ? `<p>School District: ${reportData.schoolDistrict}</p>` : ''}\n          </div>\n\n          ${reportData.sections.includes('student-info') ? `\n            <div class=\"section\">\n              <h2>Student Information</h2>\n              <p><strong>Name:</strong> ${student.name}</p>\n              ${student.grade ? `<p><strong>Grade:</strong> ${student.grade}</p>` : ''}\n              ${student.dateOfBirth ? `<p><strong>Date of Birth:</strong> ${student.dateOfBirth}</p>` : ''}\n              <p><strong>Program Start Date:</strong> ${format(student.createdAt, 'MMMM dd, yyyy')}</p>\n              ${student.notes ? `<p><strong>Notes:</strong> ${student.notes}</p>` : ''}\n            </div>\n          ` : ''}\n\n          ${reportData.sections.includes('goal-progress') ? `\n            <div class=\"section\">\n              <h2>IEP Goal Progress</h2>\n              ${reportAnalysis.goalProgress.map(goal => `\n                <div class=\"goal-card\">\n                  <h3>${goal.title}</h3>\n                  <p><strong>Category:</strong> ${goal.category}</p>\n                  <p><strong>Target Date:</strong> ${format(goal.targetDate, 'MMMM dd, yyyy')}</p>\n                  <p><strong>Current Progress:</strong> ${Math.round(goal.currentProgress)}%</p>\n                  <div class=\"progress-bar\">\n                    <div class=\"progress-fill\" style=\"width: ${goal.currentProgress}%\"></div>\n                  </div>\n                  <p><strong>Measurable Objective:</strong> ${goal.measurableObjective}</p>\n                  ${goal.progressInPeriod > 0 ? `<p><strong>Data Points in Period:</strong> ${goal.progressInPeriod}</p>` : ''}\n                  ${goal.progressChange !== 0 ? `<p><strong>Change in Period:</strong> ${goal.progressChange > 0 ? '+' : ''}${goal.progressChange.toFixed(1)}</p>` : ''}\n                </div>\n              `).join('')}\n            </div>\n          ` : ''}\n\n          ${reportData.sections.includes('behavioral-patterns') ? `\n            <div class=\"section\">\n              <h2>Emotional and Behavioral Patterns</h2>\n              <div class=\"metric\">\n                <div class=\"metric-value\">${reportAnalysis.totalSessions}</div>\n                <div class=\"metric-label\">Total Sessions</div>\n              </div>\n              <div class=\"metric\">\n                <div class=\"metric-value\">${reportAnalysis.avgEmotionIntensity.toFixed(1)}</div>\n                <div class=\"metric-label\">Avg Intensity</div>\n              </div>\n              \n              <h3>Emotion Distribution</h3>\n              ${Object.entries(reportAnalysis.emotionSummary).map(([emotion, count]) => `\n                <p><strong>${emotion.charAt(0).toUpperCase() + emotion.slice(1)}:</strong> ${count} occurrences</p>\n              `).join('')}\n            </div>\n          ` : ''}\n\n          ${reportData.sections.includes('sensory-patterns') ? `\n            <div class=\"section\">\n              <h2>Sensory Processing Patterns</h2>\n              <div class=\"metric\">\n                <div class=\"metric-value\">${reportAnalysis.sensorySeekingCount}</div>\n                <div class=\"metric-label\">Seeking Behaviors</div>\n              </div>\n              <div class=\"metric\">\n                <div class=\"metric-value\">${reportAnalysis.sensoryAvoidingCount}</div>\n                <div class=\"metric-label\">Avoiding Behaviors</div>\n              </div>\n              \n              <h3>Sensory Type Distribution</h3>\n              ${Object.entries(reportAnalysis.sensorySummary).map(([type, count]) => `\n                <p><strong>${type.charAt(0).toUpperCase() + type.slice(1)}:</strong> ${count} entries</p>\n              `).join('')}\n            </div>\n          ` : ''}\n\n          ${reportData.sections.includes('achievements') ? `\n            <div class=\"section\">\n              <h2>Achievements and Progress</h2>\n              ${reportAnalysis.achievements.length > 0 ? \n                reportAnalysis.achievements.map(goal => `\n                  <div class=\"goal-card\">\n                    <h4>${goal.title}</h4>\n                    <p>Progress improved by ${goal.progressChange.toFixed(1)} points</p>\n                    <p>Current: ${Math.round(goal.currentProgress)}% complete</p>\n                  </div>\n                `).join('') : \n                '<p>No significant progress improvements detected in this period.</p>'\n              }\n            </div>\n          ` : ''}\n\n          ${reportData.sections.includes('challenges') ? `\n            <div class=\"section\">\n              <h2>Areas Needing Attention</h2>\n              ${reportAnalysis.challenges.length > 0 ? \n                reportAnalysis.challenges.map(goal => `\n                  <div class=\"goal-card\">\n                    <h4>${goal.title}</h4>\n                    <p>Current Progress: ${Math.round(goal.currentProgress)}%</p>\n                    ${goal.progressChange < 0 ? `<p>⚠️ Progress declined by ${Math.abs(goal.progressChange).toFixed(1)} points</p>` : ''}\n                    ${goal.currentProgress < 50 ? '<p>📈 Consider intensifying interventions</p>' : ''}\n                  </div>\n                `).join('') : \n                '<p>No significant challenges identified in this period.</p>'\n              }\n            </div>\n          ` : ''}\n\n          ${reportData.sections.includes('recommendations') ? `\n            <div class=\"section\">\n              <h2>Recommendations</h2>\n              <ul>\n                ${reportAnalysis.challenges.length > 0 ? \n                  '<li>Consider reviewing and adjusting intervention strategies for goals showing limited progress</li>' : ''\n                }\n                ${reportAnalysis.avgEmotionIntensity > 3.5 ? \n                  '<li>High emotional intensity noted - consider additional calming strategies</li>' : ''\n                }\n                ${reportAnalysis.sensoryAvoidingCount > reportAnalysis.sensorySeekingCount ? \n                  '<li>Student shows more sensory avoiding behaviors - review environmental accommodations</li>' : ''\n                }\n                ${reportAnalysis.totalSessions < 8 ? \n                  '<li>Consider increasing data collection frequency for better trend analysis</li>' : ''\n                }\n                <li>Continue current successful strategies and interventions</li>\n                <li>Regular team meetings to discuss progress and adjust goals as needed</li>\n              </ul>\n            </div>\n          ` : ''}\n\n          ${reportData.customNotes ? `\n            <div class=\"section\">\n              <h2>Additional Notes</h2>\n              <p>${reportData.customNotes.replace(/\\n/g, '<br>')}</p>\n            </div>\n          ` : ''}\n\n          <div class=\"section\">\n            <h2>Data Collection Summary</h2>\n            <p>This report is based on ${reportAnalysis.totalSessions} tracking sessions, ${emotions.length} emotional observations, and ${sensoryInputs.length} sensory input recordings collected from ${format(reportAnalysis.period.start, 'MMMM dd, yyyy')} to ${format(reportAnalysis.period.end, 'MMMM dd, yyyy')}.</p>\n          </div>\n        </body>\n      </html>\n    `;\n\n    printWindow.document.write(htmlContent);\n    printWindow.document.close();\n    printWindow.focus();\n    \n    // Auto-print after a brief delay to allow rendering\n    setTimeout(() => {\n      printWindow.print();\n    }, 1000);\n\n    toast.success(tCommon('reports.builder.toast.reportGenerated'));\n  };\n\n  const exportCSV = () => {\n    const reportAnalysis = generateReportData();\n    \n    // Create CSV content\n    const csvContent = [\n      // Headers\n      ['Report Type', 'Student Name', 'Period Start', 'Period End', 'Total Sessions', 'Goals Count'],\n      // Data\n      [\n        reportData.title,\n        student.name,\n        format(reportAnalysis.period.start, 'yyyy-MM-dd'),\n        format(reportAnalysis.period.end, 'yyyy-MM-dd'),\n        reportAnalysis.totalSessions.toString(),\n        goals.length.toString()\n      ],\n      [],\n      ['Goal Progress'],\n      ['Goal Title', 'Category', 'Current Progress (%)', 'Target Date', 'Status'],\n      ...reportAnalysis.goalProgress.map(goal => [\n        goal.title,\n        goal.category,\n        Math.round(goal.currentProgress).toString(),\n        format(goal.targetDate, 'yyyy-MM-dd'),\n        goal.status\n      ]),\n      [],\n      ['Emotion Summary'],\n      ['Emotion', 'Count'],\n      ...Object.entries(reportAnalysis.emotionSummary),\n      [],\n      ['Sensory Summary'],\n      ['Sensory Type', 'Count'],\n      ...Object.entries(reportAnalysis.sensorySummary)\n    ];\n\n    const csvString = csvContent.map(row => \n      row.map(cell => `\"${cell}\"`).join(',')\n    ).join('\\n');\n\n    // Download CSV\n    const blob = new Blob([csvString], { type: 'text/csv' });\n    downloadBlob(blob, `${student.name.replace(/\\s+/g, '_')}_${reportData.title.replace(/\\s+/g, '_')}_${format(new Date(), 'yyyy-MM-dd')}.csv`);\n\n    toast.success(tCommon('reports.builder.toast.csvExported'));\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"text-lg font-semibold\">{tCommon('reports.builder.title')}</h3>\n          <p className=\"text-muted-foreground\">{tCommon('reports.builder.description')}</p>\n        </div>\n        <Dialog open={showBuilder} onOpenChange={setShowBuilder}>\n          <DialogTrigger asChild>\n            <Button className=\"bg-gradient-primary hover:opacity-90 font-dyslexia\">\n              <FileText className=\"h-4 w-4 mr-2\" />\n              Create Report\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>{tCommon('reports.builder.title')}</DialogTitle>\n              <DialogDescription>\n                {String(tCommon('reports.builder.description'))}\n              </DialogDescription>\n            </DialogHeader>\n            \n            <div className=\"space-y-6\">\n              {/* Template Selection */}\n              <div>\n                <Label>{tCommon('reports.builder.form.reportTemplate')}</Label>\n                <Select value={selectedTemplate} onValueChange={handleTemplateChange}>\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {reportTemplates.map(template => (\n                      <SelectItem key={template.id} value={template.id}>\n                        {tCommon(template.name as unknown as string)}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <p className=\"text-sm text-muted-foreground mt-1\">\n                  {tCommon((reportTemplates.find(t => t.id === selectedTemplate)?.description || '') as unknown as string)}\n                </p>\n              </div>\n\n              {/* Report Configuration */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"reportTitle\">{tCommon('reports.builder.form.reportTitle')}</Label>\n                  <Input\n                    id=\"reportTitle\"\n                    value={reportData.title}\n                    onChange={(e) => setReportData(prev => ({ ...prev, title: e.target.value }))}\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"teacher\">{tCommon('reports.builder.form.reportingTeacher')}</Label>\n                  <Input\n                    id=\"teacher\"\n                    value={reportData.reportingTeacher}\n                    onChange={(e) => setReportData(prev => ({ ...prev, reportingTeacher: e.target.value }))}\n                    placeholder={tCommon('reports.builder.form.reportingTeacherPlaceholder')}\n                  />\n                </div>\n              </div>\n\n              {/* Date Range */}\n              <div>\n                <Label>{tCommon('reports.builder.form.reportPeriod')}</Label>\n                <div className=\"grid grid-cols-2 gap-4 mt-1\">\n                  <div>\n                    <Label htmlFor=\"startDate\" className=\"text-sm\">{tCommon('reports.builder.form.startDate')}</Label>\n                    <Input\n                      id=\"startDate\"\n                      type=\"date\"\n                      value={reportData.dateRange.start}\n                      onChange={(e) => setReportData(prev => ({\n                        ...prev,\n                        dateRange: { ...prev.dateRange, start: e.target.value }\n                      }))}\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"endDate\" className=\"text-sm\">{tCommon('reports.builder.form.endDate')}</Label>\n                    <Input\n                      id=\"endDate\"\n                      type=\"date\"\n                      value={reportData.dateRange.end}\n                      onChange={(e) => setReportData(prev => ({\n                        ...prev,\n                        dateRange: { ...prev.dateRange, end: e.target.value }\n                      }))}\n                    />\n                  </div>\n                </div>\n              </div>\n\n              {/* Sections */}\n              <div>\n                <Label>{tCommon('reports.builder.form.reportSections')}</Label>\n                <div className=\"grid grid-cols-2 gap-2 mt-2\">\n                  {[\n                    'student-info',\n                    'goal-progress',\n                    'behavioral-patterns',\n                    'sensory-patterns',\n                    'environmental-factors',\n                    'achievements',\n                    'challenges',\n                    'recommendations',\n                    'next-steps',\n                    'interventions'\n                  ].map(id => ({ id, label: tCommon(`reports.builder.sections.${id}`) })).map(section => (\n                    <div key={section.id} className=\"flex items-center space-x-2\">\n                      <Checkbox\n                        id={section.id}\n                        checked={reportData.sections.includes(section.id)}\n                        onCheckedChange={(checked) => {\n                          setReportData(prev => ({\n                            ...prev,\n                            sections: checked \n                              ? [...prev.sections, section.id]\n                              : prev.sections.filter(s => s !== section.id)\n                          }));\n                        }}\n                      />\n                      <Label htmlFor={section.id} className=\"text-sm\">{section.label}</Label>\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              {/* Options */}\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center space-x-2\">\n                  <Checkbox\n                    id=\"includeCharts\"\n                    checked={reportData.includeCharts}\n                    onCheckedChange={(checked) => setReportData(prev => ({ ...prev, includeCharts: !!checked }))}\n                  />\n                  <Label htmlFor=\"includeCharts\">{tCommon('reports.builder.form.includeCharts')}</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <Checkbox\n                    id=\"includeRawData\"\n                    checked={reportData.includeRawData}\n                    onCheckedChange={(checked) => setReportData(prev => ({ ...prev, includeRawData: !!checked }))}\n                  />\n                  <Label htmlFor=\"includeRawData\">{tCommon('reports.builder.form.includeRawData')}</Label>\n                </div>\n              </div>\n\n              {/* Custom Notes */}\n              <div>\n                <Label htmlFor=\"customNotes\">{tCommon('reports.builder.form.additionalNotes')}</Label>\n                <Textarea\n                  id=\"customNotes\"\n                  value={reportData.customNotes}\n                  onChange={(e) => setReportData(prev => ({ ...prev, customNotes: e.target.value }))}\n                  placeholder={tCommon('reports.builder.form.additionalNotesPlaceholder')}\n                  rows={3}\n                />\n              </div>\n\n              {/* Action Buttons */}\n              <div className=\"flex gap-2 justify-end\">\n                <Button variant=\"outline\" onClick={exportCSV}>\n                  <Download className=\"h-4 w-4 mr-2\" />\n                  {tCommon('reports.builder.form.exportCsv')}\n                </Button>\n                <Button onClick={generatePDF}>\n                  <Printer className=\"h-4 w-4 mr-2\" />\n                  {tCommon('reports.builder.form.generatePdf')}\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Quick Reports */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        {reportTemplates.map(template => (\n          <Card key={template.id} className=\"bg-gradient-card border-0 shadow-soft cursor-pointer hover:shadow-lg transition-shadow\"\n                onClick={() => {\n                  handleTemplateChange(template.id);\n                  setShowBuilder(true);\n                }}>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm\">{tCommon(template.name as unknown as string)}</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-xs text-muted-foreground mb-3\">{tCommon(template.description as unknown as string)}</p>\n              <Badge variant=\"outline\" className=\"text-xs\">\n                {tCommon('reports.sectionsCount', { count: template.sections.length })}\n              </Badge>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    </div>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/SensoryTracker.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"/5\"","line":158,"column":68,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":159,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Body Location (Optional)\"","line":193,"column":70,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":193,"endColumn":94},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-sm font-medium text-foreground mb-3\">Body Location (Optional)</h3>","line":193,"column":70,"nodeType":"JSXText","endLine":193,"endColumn":94},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Coping Strategies Used\"","line":222,"column":70,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":222,"endColumn":92},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-sm font-medium text-foreground mb-3\">Coping Strategies Used</h3>","line":222,"column":70,"nodeType":"JSXText","endLine":222,"endColumn":92},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"+\"","line":248,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":249,"endColumn":21},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"×\"","line":261,"column":29,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":262,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Miljø (Valgfritt)\"","line":270,"column":68,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":270,"endColumn":85},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-sm font-medium text-foreground mb-3\">Miljø (Valgfritt)</h3>","line":270,"column":68,"nodeType":"JSXText","endLine":270,"endColumn":85}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { SensoryEntry } from \"@/types/student\";\nimport { Eye, Ear, Hand, RotateCcw, Activity } from \"lucide-react\";\nimport { useTranslation } from \"@/hooks/useTranslation\";\n\ninterface SensoryTrackerProps {\n  onSensoryAdd: (sensory: Omit<SensoryEntry, 'id' | 'timestamp'>) => void;\n  studentId: string;\n}\n\nconst sensoryTypes = [\n  { type: 'visual' as const, icon: Eye },\n  { type: 'auditory' as const, icon: Ear },\n  { type: 'tactile' as const, icon: Hand },\n  { type: 'vestibular' as const, icon: RotateCcw },\n  { type: 'proprioceptive' as const, icon: Activity },\n];\n\nconst responses = [\n  { type: 'seeking' as const },\n  { type: 'avoiding' as const },\n  { type: 'neutral' as const },\n  { type: 'overwhelmed' as const },\n];\n\n// Common body locations for sensory experiences\nconst bodyLocations = [\n  'Head', 'Eyes', 'Ears', 'Mouth', 'Neck', 'Shoulders',\n  'Arms', 'Hands', 'Chest', 'Back', 'Stomach', 'Legs', 'Feet'\n];\n\n// Common coping strategy suggestions\nconst copingStrategySuggestions = [\n  'Deep breathing', 'Take a break', 'Use fidget tool', 'Movement break',\n  'Quiet space', 'Headphones', 'Weighted blanket', 'Sensory walk',\n  'Compression', 'Joint compressions', 'Chewing gum', 'Water break'\n];\n\nexport const SensoryTracker = ({ onSensoryAdd, studentId }: SensoryTrackerProps) => {\n  const { tTracking, tCommon } = useTranslation();\n  const [selectedType, setSelectedType] = useState<string>('');\n  const [selectedResponse, setSelectedResponse] = useState<string>('');\n  const [intensity, setIntensity] = useState<number>(3);\n  // Intensity range: 1-5 only, capped\n  const handleIntensity = (value: number) => {\n    const clamped = Math.max(1, Math.min(5, value));\n    setIntensity(clamped);\n  };\n  const [notes, setNotes] = useState('');\n  const [environment, setEnvironment] = useState('');\n  const [location, setLocation] = useState('');\n  const [copingStrategies, setCopingStrategies] = useState<string[]>([]);\n  const [newCopingStrategy, setNewCopingStrategy] = useState('');\n\n  const handleAddCopingStrategy = () => {\n    if (newCopingStrategy.trim() && !copingStrategies.includes(newCopingStrategy.trim())) {\n      setCopingStrategies([...copingStrategies, newCopingStrategy.trim()]);\n      setNewCopingStrategy('');\n    }\n  };\n\n  const handleRemoveCopingStrategy = (strategy: string) => {\n    setCopingStrategies(copingStrategies.filter(s => s !== strategy));\n  };\n\n  const handleSubmit = () => {\n    if (!selectedType || !selectedResponse) return;\n\n    onSensoryAdd({\n      studentId,\n      sensoryType: selectedType as SensoryEntry['sensoryType'],\n      response: selectedResponse as SensoryEntry['response'],\n      intensity: intensity as SensoryEntry['intensity'],\n      location: location || undefined,\n      notes: notes.trim() || undefined,\n      environment: environment.trim() || undefined,\n      copingStrategies: copingStrategies.length > 0 ? copingStrategies : undefined,\n    });\n\n    // Reset form\n    setSelectedType('');\n    setSelectedResponse('');\n    setIntensity(3);\n    setLocation('');\n    setNotes('');\n    setEnvironment('');\n    setCopingStrategies([]);\n  };\n\n  return (\n    <Card className=\"font-dyslexia bg-gradient-card border-0\">\n      <CardHeader>\n        <CardTitle className=\"text-xl text-foreground\">{String(tTracking('sensory.title'))}</CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        {/* Sensory Type Selection */}\n        <div>\n          <h3 className=\"text-sm font-medium text-foreground mb-3\">{String(tTracking('sensory.selectType'))}</h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n            {sensoryTypes.map((type) => {\n              const Icon = type.icon;\n              return (\n                <Button\n                  key={type.type}\n                  variant={selectedType === type.type ? \"default\" : \"outline\"}\n                  className={`h-16 flex items-center gap-3 justify-start font-dyslexia hover-lift press-scale transition-all duration-300 ${\n                    selectedType === type.type \n                      ? 'bg-gradient-primary shadow-glow animate-bounce-in' \n                      : 'hover:scale-105 animate-fade-in hover:shadow-soft'\n                  }`}\n                  onClick={() => setSelectedType(type.type)}\n                  aria-label={`Select sensory type: ${String(tTracking(`sensory.types.${type.type}`))}`}\n                  aria-pressed={selectedType === type.type}\n                >\n                  <Icon className=\"h-5 w-5 transform transition-transform duration-200 hover:scale-110\" />\n                  <div className=\"text-left\">\n                    <div className=\"font-medium\">{String(tTracking(`sensory.types.${type.type}`))}</div>\n                  </div>\n                </Button>\n              );\n            })}\n          </div>\n        </div>\n\n        {/* Response Type */}\n        {selectedType && (\n          <div>\n            <h3 className=\"text-sm font-medium text-foreground mb-3\">{String(tTracking('sensory.response'))}</h3>\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n              {responses.map((response) => (\n                <Button\n                  key={response.type}\n                  variant={selectedResponse === response.type ? \"default\" : \"outline\"}\n                  className={`h-16 flex-col gap-1 font-dyslexia hover-lift press-scale transition-all duration-300 ${\n                    selectedResponse === response.type \n                      ? 'bg-gradient-primary shadow-glow animate-bounce-in' \n                      : 'hover:scale-105 animate-fade-in hover:shadow-soft'\n                  }`}\n                  onClick={() => setSelectedResponse(response.type)}\n                  aria-label={`Select response: ${String(tTracking(`sensory.responses.${response.type}`))}`}\n                  aria-pressed={selectedResponse === response.type}\n                >\n                  <span className=\"font-medium\">{String(tTracking(`sensory.responses.${response.type}`))}</span>\n                </Button>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Intensity Scale */}\n{selectedResponse && (\n          <div>\n            <h3 className=\"text-sm font-medium text-foreground mb-3\">\n              {String(tTracking('sensory.intensity'))}: {intensity}/5\n            </h3>\n            <div className=\"flex gap-2\">\n              {[1, 2, 3, 4, 5].map((level) => (\n                <Button\n                  key={level}\n                  variant={intensity === level ? \"default\" : \"outline\"}\n                  size=\"sm\"\n                  className={`w-12 h-12 rounded-full font-dyslexia ${\n                    intensity === level ? 'bg-gradient-primary' : ''\n                  }`}\n                  onClick={() => handleIntensity(level)}\n                  title={String(tTracking(`sensory.intensityLevels.${level}`))}\n                  aria-label={`Intensity level ${level}`}\n                  aria-pressed={intensity === level}\n                >\n                  {level}\n                </Button>\n              ))}\n            </div>\n            <input\n              type=\"number\"\n              value={intensity}\n              min={1}\n              max={5}\n              onChange={e => handleIntensity(Number(e.target.value))}\n              className=\"w-16 px-2 py-1 mt-2 rounded border\"\n              aria-label=\"Manual intensity input\"\n            />\n          </div>\n        )}\n\n        {/* Body Location */}\n        {selectedType && (\n          <div>\n            <h3 className=\"text-sm font-medium text-foreground mb-3\">Body Location (Optional)</h3>\n            <div className=\"flex flex-wrap gap-2\">\n              {bodyLocations.map((loc) => (\n                <Badge\n                  key={loc}\n                  variant={location === loc ? \"default\" : \"outline\"}\n                  className=\"cursor-pointer font-dyslexia hover-lift transition-all duration-200\"\n                  onClick={() => setLocation(location === loc ? '' : loc)}\n                  role=\"button\"\n                  tabIndex={0}\n                  aria-pressed={location === loc}\n                  aria-label={`Select body location: ${loc}`}\n                  onKeyDown={(e) => {\n                    if (e.key === 'Enter' || e.key === ' ') {\n                      e.preventDefault();\n                      setLocation(location === loc ? '' : loc);\n                    }\n                  }}\n                >\n                  {loc}\n                </Badge>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Coping Strategies */}\n        {selectedResponse && (\n          <div>\n            <h3 className=\"text-sm font-medium text-foreground mb-3\">Coping Strategies Used</h3>\n            <div className=\"flex gap-2 mb-2\">\n              <input\n                type=\"text\"\n                value={newCopingStrategy}\n                onChange={(e) => setNewCopingStrategy(e.target.value)}\n                onKeyPress={(e) => e.key === 'Enter' && handleAddCopingStrategy()}\n                placeholder=\"Add a coping strategy...\"\n                aria-label=\"Legg til mestringsstrategi\"\n                className=\"flex-1 px-3 py-2 border border-border rounded-lg font-dyslexia bg-input focus:ring-2 focus:ring-ring focus:border-transparent\"\n              />\n              <Button onClick={handleAddCopingStrategy} size=\"sm\" variant=\"outline\">\n                {String(tCommon('buttons.add'))}\n              </Button>\n            </div>\n            <div className=\"flex flex-wrap gap-2 mb-2\">\n              {copingStrategySuggestions.map((strategy) => (\n                <Badge\n                  key={strategy}\n                  variant=\"outline\"\n                  className=\"cursor-pointer font-dyslexia text-xs\"\n                  onClick={() => {\n                    if (!copingStrategies.includes(strategy)) {\n                      setCopingStrategies([...copingStrategies, strategy]);\n                    }\n                  }}\n                >\n                  + {strategy}\n                </Badge>\n              ))}\n            </div>\n            <div className=\"flex flex-wrap gap-2\">\n              {copingStrategies.map((strategy) => (\n                <Badge\n                  key={strategy}\n                  variant=\"secondary\"\n                  className=\"font-dyslexia cursor-pointer\"\n                  onClick={() => handleRemoveCopingStrategy(strategy)}\n                >\n                  {strategy} ×\n                </Badge>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Environment */}\n        <div>\n          <h3 className=\"text-sm font-medium text-foreground mb-3\">Miljø (Valgfritt)</h3>\n          <input\n            type=\"text\"\n            value={environment}\n            onChange={(e) => setEnvironment(e.target.value)}\n            placeholder=\"f.eks. Klasserom, Lekeplass, Bibliotek...\"\n            aria-label=\"Beskriv miljøet\"\n            className=\"w-full px-3 py-2 border border-border rounded-lg font-dyslexia bg-input focus:ring-2 focus:ring-ring focus:border-transparent\"\n          />\n        </div>\n\n        {/* Notes */}\n        <div>\n          <h3 className=\"text-sm font-medium text-foreground mb-3\">{String(tTracking('sensory.notes'))}</h3>\n          <Textarea\n            value={notes}\n            onChange={(e) => setNotes(e.target.value)}\n            placeholder=\"Ytterligere observasjoner om den sensoriske responsen...\"\n            className=\"font-dyslexia bg-input border-border focus:ring-ring\"\n            rows={3}\n          />\n        </div>\n\n        <Button \n          onClick={handleSubmit}\n          disabled={!selectedType || !selectedResponse}\n          className=\"w-full font-dyslexia bg-gradient-primary hover:opacity-90 transition-all duration-200\"\n        >\n          {String(tTracking('sensory.addInput'))}\n        </Button>\n      </CardContent>\n    </Card>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/StorageManager.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Storage Management\"","line":94,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":96,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n          <Database className=\"h-5 w-5\" />\n          Storage Management\n        </CardTitle>","line":94,"column":43,"nodeType":"JSXText","endLine":96,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Manage your local storage to ensure smooth operation\"","line":97,"column":26,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":99,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardDescription>\n          Manage your local storage to ensure smooth operation\n        </CardDescription>","line":97,"column":26,"nodeType":"JSXText","endLine":99,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Storage Usage\"","line":104,"column":44,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":104,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"font-medium mb-2\">Storage Usage</h3>","line":104,"column":44,"nodeType":"JSXText","endLine":104,"endColumn":57},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Used\"","line":107,"column":21,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":107,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Used</span>","line":107,"column":21,"nodeType":"JSXText","endLine":107,"endColumn":25},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"/ ~5 MB\"","line":108,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":108,"endColumn":60},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>{formatBytes(storageInfo.used)} / ~5 MB</span>","line":108,"column":52,"nodeType":"JSXText","endLine":108,"endColumn":60},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Data Statistics\"","line":121,"column":44,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":121,"endColumn":59},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"font-medium mb-2\">Data Statistics</h3>","line":121,"column":44,"nodeType":"JSXText","endLine":121,"endColumn":59},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Students:\"","line":123,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":123,"endColumn":28},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Students: {stats.studentsCount}</div>","line":123,"column":18,"nodeType":"JSXText","endLine":123,"endColumn":28},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Entries:\"","line":124,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":124,"endColumn":27},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Entries: {stats.entriesCount}</div>","line":124,"column":18,"nodeType":"JSXText","endLine":124,"endColumn":27},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Goals:\"","line":125,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":125,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Goals: {stats.goalsCount}</div>","line":125,"column":18,"nodeType":"JSXText","endLine":125,"endColumn":25},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Alerts:\"","line":126,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":126,"endColumn":26},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Alerts: {stats.alertsCount}</div>","line":126,"column":18,"nodeType":"JSXText","endLine":126,"endColumn":26},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Clear data older than 30 days\"","line":151,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":153,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n            variant=\"outline\"\n            onClick={handleClearOldData}\n            className=\"w-full justify-start\"\n          >\n            <Trash2 className=\"h-4 w-4 mr-2\" />\n            Clear data older than 30 days\n          </Button>","line":151,"column":48,"nodeType":"JSXText","endLine":153,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Clear non-essential data\"","line":159,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":161,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n            variant=\"outline\"\n            onClick={handleClearNonEssential}\n            className=\"w-full justify-start\"\n          >\n            <Trash2 className=\"h-4 w-4 mr-2\" />\n            Clear non-essential data\n          </Button>","line":159,"column":48,"nodeType":"JSXText","endLine":161,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Clear ALL data (irreversible)\"","line":167,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":169,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n            variant=\"destructive\"\n            onClick={handleClearAll}\n            className=\"w-full justify-start\"\n          >\n            <Trash2 className=\"h-4 w-4 mr-2\" />\n            Clear ALL data (irreversible)\n          </Button>","line":167,"column":48,"nodeType":"JSXText","endLine":169,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Storage is healthy with sufficient space available.\"","line":175,"column":31,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":177,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <AlertDescription>\n              Storage is healthy with sufficient space available.\n            </AlertDescription>","line":175,"column":31,"nodeType":"JSXText","endLine":177,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":28,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Progress } from '@/components/ui/progress';\nimport { Button } from '@/components/ui/button';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Database, Trash2, AlertCircle, CheckCircle } from 'lucide-react';\nimport { storageUtils } from '@/lib/storageUtils';\nimport { dataStorage } from '@/lib/dataStorage';\nimport { toast } from 'sonner';\nimport { cn } from '@/lib/utils';\nimport { logger } from '@/lib/logger';\n\n/**\n * StorageManager Component\n * \n * Provides UI for managing local storage, including viewing usage statistics\n * and clearing different types of data. Includes safety checks and error handling.\n * \n * @component\n * @returns {React.ReactElement} Rendered storage management interface\n */\nexport const StorageManager = () => {\n  const [storageInfo, setStorageInfo] = useState(storageUtils.getStorageInfo());\n  const [stats, setStats] = useState(dataStorage.getStorageStats());\n\n  const refreshStats = () => {\n    setStorageInfo(storageUtils.getStorageInfo());\n    setStats(dataStorage.getStorageStats());\n  };\n\n  const handleClearOldData = () => {\n    try {\n      storageUtils.clearOldTrackingData(30);\n      toast.success('Old data cleared successfully');\n      refreshStats();\n    } catch (error) {\n      logger.error('Failed to clear old tracking data', error);\n      toast.error('Failed to clear old data');\n    }\n  };\n\n  const handleClearNonEssential = () => {\n    try {\n      storageUtils.clearNonEssentialData();\n      toast.success('Non-essential data cleared');\n      refreshStats();\n    } catch (error) {\n      logger.error('Failed to clear non-essential data', error);\n      toast.error('Failed to clear non-essential data');\n    }\n  };\n\n  /**\n   * Handle clearing all data with proper confirmation dialog.\n   * Uses a more robust approach than browser confirm().\n   */\n  const handleClearAll = () => {\n    // Using window.confirm with proper error handling\n    // In production, consider using a custom modal component\n    try {\n      const confirmed = window.confirm('Are you sure you want to clear ALL data? This cannot be undone!');\n      if (confirmed) {\n        try {\n          dataStorage.clearAllData();\n          toast.success('All data cleared');\n          // Use window.location.replace for better history management\n          window.location.replace('/');\n        } catch (error) {\n          logger.error('Failed to clear all data', error);\n          toast.error('Failed to clear all data');\n        }\n      }\n    } catch (error) {\n      // Handle cases where confirm might fail (e.g., in some test environments)\n      logger.error('Confirmation dialog failed', error);\n      toast.error('Could not show confirmation dialog');\n    }\n  };\n\n  const formatBytes = (bytes: number) => {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  };\n\n  const usagePercentage = (storageInfo.used / 5000000) * 100;\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Database className=\"h-5 w-5\" />\n          Storage Management\n        </CardTitle>\n        <CardDescription>\n          Manage your local storage to ensure smooth operation\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {/* Storage Usage */}\n        <div>\n          <h3 className=\"font-medium mb-2\">Storage Usage</h3>\n          <div className=\"space-y-2\">\n            <div className=\"flex justify-between text-sm\">\n              <span>Used</span>\n              <span>{formatBytes(storageInfo.used)} / ~5 MB</span>\n            </div>\n          <div className=\"w-full\">\n            <Progress\n              value={Math.min(usagePercentage, 100)}\n              className=\"h-2\"\n            />\n          </div>\n          </div>\n        </div>\n\n        {/* Storage Stats */}\n        <div>\n          <h3 className=\"font-medium mb-2\">Data Statistics</h3>\n          <div className=\"grid grid-cols-2 gap-2 text-sm\">\n            <div>Students: {stats.studentsCount}</div>\n            <div>Entries: {stats.entriesCount}</div>\n            <div>Goals: {stats.goalsCount}</div>\n            <div>Alerts: {stats.alertsCount}</div>\n          </div>\n        </div>\n\n        {/* Warnings */}\n        {usagePercentage > 70 && (\n          <Alert className={cn(\n            usagePercentage > 90 ? 'border-red-500' : 'border-yellow-500'\n          )}>\n            <AlertCircle className=\"h-4 w-4\" />\n            <AlertDescription>\n              {usagePercentage > 90\n                ? 'Storage is almost full! Clear some data to prevent errors.'\n                : 'Storage usage is getting high. Consider clearing old data.'}\n            </AlertDescription>\n          </Alert>\n        )}\n\n        {/* Actions */}\n        <div className=\"space-y-2\">\n          <Button\n            variant=\"outline\"\n            onClick={handleClearOldData}\n            className=\"w-full justify-start\"\n          >\n            <Trash2 className=\"h-4 w-4 mr-2\" />\n            Clear data older than 30 days\n          </Button>\n          <Button\n            variant=\"outline\"\n            onClick={handleClearNonEssential}\n            className=\"w-full justify-start\"\n          >\n            <Trash2 className=\"h-4 w-4 mr-2\" />\n            Clear non-essential data\n          </Button>\n          <Button\n            variant=\"destructive\"\n            onClick={handleClearAll}\n            className=\"w-full justify-start\"\n          >\n            <Trash2 className=\"h-4 w-4 mr-2\" />\n            Clear ALL data (irreversible)\n          </Button>\n        </div>\n\n        {storageInfo.available && (\n          <Alert className=\"border-green-500\">\n            <CheckCircle className=\"h-4 w-4\" />\n            <AlertDescription>\n              Storage is healthy with sufficient space available.\n            </AlertDescription>\n          </Alert>\n        )}\n      </CardContent>\n    </Card>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/StudentProfileSidebar.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Hovedseksjoner\"","line":109,"column":119,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":111,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SidebarGroupLabel className=\"text-muted-foreground text-xs font-medium uppercase tracking-wider px-3 py-2\">\n            Hovedseksjoner\n          </SidebarGroupLabel>","line":109,"column":119,"nodeType":"JSXText","endLine":111,"endColumn":11},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":118,"column":104,"nodeType":"BlockStatement","messageId":"unexpected","endLine":118,"endColumn":106,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3632,3632],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":122,"column":61,"nodeType":"BlockStatement","messageId":"unexpected","endLine":122,"endColumn":63,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3865,3865],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Verktøy\"","line":144,"column":119,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":146,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SidebarGroupLabel className=\"text-muted-foreground text-xs font-medium uppercase tracking-wider px-3 py-2\">\n            Verktøy\n          </SidebarGroupLabel>","line":144,"column":119,"nodeType":"JSXText","endLine":146,"endColumn":11},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":153,"column":106,"nodeType":"BlockStatement","messageId":"unexpected","endLine":153,"endColumn":108,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[5226,5226],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":156,"column":61,"nodeType":"BlockStatement","messageId":"unexpected","endLine":156,"endColumn":63,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[5380,5380],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuItem,\n  SidebarMenuButton,\n  useSidebar,\n} from '@/components/ui/sidebar';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { Student } from '@/types/student';\nimport { logger } from '@/lib/logger';\n\ninterface StudentProfileSidebarProps {\n  student: Student;\n  activeSection: string;\n  onSectionChange: (section: string) => void;\n}\n\nexport function StudentProfileSidebar({ \n  student, \n  activeSection, \n  onSectionChange \n}: StudentProfileSidebarProps) {\n  const { state, isMobile, setOpenMobile } = useSidebar();\n  const { tStudent, tCommon } = useTranslation();\n\n  const menuItems = [\n    {\n      section: 'dashboard',\n      title: tCommon('navigation.dashboard'),\n      icon: 'dashboard',\n      description: 'Oversikt og sammendrag'\n    },\n    {\n      section: 'analytics',\n      title: tCommon('navigation.analytics'),\n      icon: 'analytics',\n      description: 'Datanalyse og innsikter'\n    },\n    {\n      section: 'goals',\n      title: 'Mål',\n      icon: 'flag',\n      description: 'Målstyring og progresjon'\n    },\n    {\n      section: 'progress',\n      title: 'Fremgang',\n      icon: 'trending_up',\n      description: 'Utviklingsanalyse'\n    },\n    {\n      section: 'reports',\n      title: tCommon('navigation.reports'),\n      icon: 'description',\n      description: 'Rapporter og eksport'\n    }\n  ];\n\n  const toolItems = [\n    {\n      section: 'search',\n      title: tStudent('interface.advancedSearch'),\n      icon: 'search',\n      description: 'Avansert søk'\n    },\n    {\n      section: 'templates',\n      title: tStudent('interface.quickTemplates'),\n      icon: 'flash_on',\n      description: 'Hurtigmaler'\n    },\n    {\n      section: 'compare',\n      title: 'Sammenligning',\n      icon: 'compare_arrows',\n      description: 'Periodesammenligning'\n    }\n  ];\n\n  const isActive = (section: string) => activeSection === section;\n\n  return (\n    <Sidebar className={`${state === \"collapsed\" ? \"w-14\" : \"w-64\"} bg-card/95 border-border backdrop-blur-sm z-50`}>\n      <SidebarContent className=\"bg-transparent\">\n        {/* Student Header */}\n        <div className={`p-4 border-b border-border/20 bg-card/50 backdrop-blur-sm ${state === \"collapsed\" ? 'px-2' : ''}`}>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-primary to-primary/70 flex items-center justify-center text-primary-foreground font-bold text-sm shadow-lg\">\n              {student.name.split(' ').map(n => n[0]).join('').toUpperCase()}\n            </div>\n            {state !== \"collapsed\" && (\n              <div className=\"min-w-0 flex-1\">\n                <h3 className=\"font-semibold text-sm truncate text-foreground\">{student.name}</h3>\n                {student.grade && (\n                  <p className=\"text-xs text-muted-foreground\">{student.grade}</p>\n                )}\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Main Navigation */}\n        <SidebarGroup>\n          <SidebarGroupLabel className=\"text-muted-foreground text-xs font-medium uppercase tracking-wider px-3 py-2\">\n            Hovedseksjoner\n          </SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {menuItems.map((item) => (\n                <SidebarMenuItem key={item.section}>\n                  <SidebarMenuButton\n                    onClick={() => {\n                      try { logger.debug('[UI] Sidebar nav click', { section: item.section }); } catch {}\n                      onSectionChange(item.section);\n                      // Close mobile drawer after selection to reveal content\n                      if (isMobile) {\n                        try { setOpenMobile(false); } catch {}\n                      }\n                    }}\n                    className={`cursor-pointer mx-2 rounded-lg transition-all duration-200 ${\n                      isActive(item.section) \n                        ? 'bg-primary text-primary-foreground shadow-lg' \n                        : 'text-foreground hover:bg-accent hover:text-accent-foreground'\n                    }`}\n                  >\n                    <span className=\"material-icons text-base\">{item.icon}</span>\n                    {state !== \"collapsed\" && (\n                     <span className=\"text-sm ml-3\">{String(item.title)}</span>\n                    )}\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n\n        {/* Tools Section */}\n        <SidebarGroup>\n          <SidebarGroupLabel className=\"text-muted-foreground text-xs font-medium uppercase tracking-wider px-3 py-2\">\n            Verktøy\n          </SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {toolItems.map((item) => (\n                <SidebarMenuItem key={item.section}>\n                  <SidebarMenuButton\n                    onClick={() => {\n                      try { logger.debug('[UI] Sidebar tools click', { section: item.section }); } catch {}\n                      onSectionChange(item.section);\n                      if (isMobile) {\n                        try { setOpenMobile(false); } catch {}\n                      }\n                    }}\n                    className={`cursor-pointer mx-2 rounded-lg transition-all duration-200 ${\n                      isActive(item.section) \n                        ? 'bg-primary text-primary-foreground shadow-lg' \n                        : 'text-foreground hover:bg-accent hover:text-accent-foreground'\n                    }`}\n                  >\n                    <span className=\"material-icons text-base\">{item.icon}</span>\n                    {state !== \"collapsed\" && (\n                      <span className=\"text-sm ml-3\">{String(item.title)}</span>\n                    )}\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n\n      </SidebarContent>\n    </Sidebar>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/TestingDebugPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleInvalidateStudent' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":244,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":244,"endColumn":32},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"System Testing & Debug Panel\"","line":255,"column":40,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":257,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n            <Bug className=\"h-5 w-5\" />\n            System Testing & Debug Panel\n          </CardTitle>","line":255,"column":40,"nodeType":"JSXText","endLine":257,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Test current system functionality and data integrity\"","line":261,"column":58,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":263,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground\">\n              Test current system functionality and data integrity\n            </p>","line":261,"column":58,"nodeType":"JSXText","endLine":263,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Running Tests...\"","line":275,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":275,"endColumn":70},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Run System Tests\"","line":280,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":280,"endColumn":70},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"hidden sm:inline\">Run System Tests</span>","line":280,"column":54,"nodeType":"JSXText","endLine":280,"endColumn":70},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Test Results:\"","line":288,"column":51,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":288,"endColumn":64},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"text-sm font-medium\">Test Results:</h4>","line":288,"column":51,"nodeType":"JSXText","endLine":288,"endColumn":64},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Quick Stats:\"","line":307,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":307,"endColumn":66},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"text-sm font-medium mb-2\">Quick Stats:</h4>","line":307,"column":54,"nodeType":"JSXText","endLine":307,"endColumn":66},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Students\"","line":311,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":311,"endColumn":70},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground\">Students</p>","line":311,"column":62,"nodeType":"JSXText","endLine":311,"endColumn":70},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Entries\"","line":315,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":315,"endColumn":69},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground\">Entries</p>","line":315,"column":62,"nodeType":"JSXText","endLine":315,"endColumn":69},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Analytics\"","line":319,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":319,"endColumn":71},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground\">Analytics</p>","line":319,"column":62,"nodeType":"JSXText","endLine":319,"endColumn":71},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Analytics Cache Management\"","line":330,"column":44,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":332,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n            <Archive className=\"h-5 w-5\" />\n            Analytics Cache Management\n          </CardTitle>","line":330,"column":44,"nodeType":"JSXText","endLine":332,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Cache Hit Rate\"","line":340,"column":57,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":340,"endColumn":71},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-sm font-medium\">Cache Hit Rate</span>","line":340,"column":57,"nodeType":"JSXText","endLine":340,"endColumn":71},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Cache Size\"","line":349,"column":69,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":349,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs text-muted-foreground\">Cache Size</span>","line":349,"column":69,"nodeType":"JSXText","endLine":349,"endColumn":79},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Memory Usage\"","line":353,"column":69,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":353,"endColumn":81},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs text-muted-foreground\">Memory Usage</span>","line":353,"column":69,"nodeType":"JSXText","endLine":353,"endColumn":81},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Hits\"","line":364,"column":66,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":364,"endColumn":70},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground\">Hits</p>","line":364,"column":66,"nodeType":"JSXText","endLine":364,"endColumn":70},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Misses\"","line":369,"column":66,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":369,"endColumn":72},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground\">Misses</p>","line":369,"column":66,"nodeType":"JSXText","endLine":369,"endColumn":72},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sets\"","line":374,"column":66,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":374,"endColumn":70},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground\">Sets</p>","line":374,"column":66,"nodeType":"JSXText","endLine":374,"endColumn":70},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Cache Actions\"","line":381,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":381,"endColumn":66},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"text-sm font-medium\">Cache Actions</h4>","line":381,"column":53,"nodeType":"JSXText","endLine":381,"endColumn":66},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Clear All Cache\"","line":392,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":392,"endColumn":69},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"hidden sm:inline\">Clear All Cache</span>","line":392,"column":54,"nodeType":"JSXText","endLine":392,"endColumn":69},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Clean Expired\"","line":403,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":403,"endColumn":67},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"hidden sm:inline\">Clean Expired</span>","line":403,"column":54,"nodeType":"JSXText","endLine":403,"endColumn":67},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Cache TTL: 5 minutes\"","line":408,"column":22,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":408,"endColumn":44},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>• Cache TTL: 5 minutes</p>","line":408,"column":22,"nodeType":"JSXText","endLine":408,"endColumn":44},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Eviction: LRU (Least Recently Used)\"","line":409,"column":22,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":409,"endColumn":59},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>• Eviction: LRU (Least Recently Used)</p>","line":409,"column":22,"nodeType":"JSXText","endLine":409,"endColumn":59},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Invalidations:\"","line":410,"column":22,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":410,"endColumn":39},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>• Invalidations: {cacheStats.invalidations || 0}</p>","line":410,"column":22,"nodeType":"JSXText","endLine":410,"endColumn":39}],"suppressedMessages":[{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":69,"column":22,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":71,"endColumn":13,"suppressions":[{"kind":"directive","justification":"Interval is created inside useEffect with proper cleanup"}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":44,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport {\n  Bug,\n  CheckCircle,\n  AlertTriangle,\n  RefreshCw,\n  Database,\n  Users,\n  BarChart3,\n  TestTube,\n  Archive,\n  Trash2,\n  Zap,\n  Activity\n} from 'lucide-react';\nimport { analyticsManager } from '@/lib/analyticsManager';\nimport { universalAnalyticsInitializer } from '@/lib/universalAnalyticsInitializer';\nimport { dataStorage } from '@/lib/dataStorage';\nimport { useAnalyticsWorker } from '@/hooks/useAnalyticsWorker';\nimport { usePerformanceCache } from '@/hooks/usePerformanceCache';\nimport { AnalyticsConfigTest } from '@/components/AnalyticsConfigTest';\nimport { toast } from 'sonner';\nimport { logger } from '@/lib/logger';\n\ninterface TestingDebugPanelProps {\n  className?: string;\n}\n\ninterface TestResult {\n  name: string;\n  status: 'pass' | 'fail' | 'warn' | 'running';\n  message: string;\n}\n\ninterface TestData {\n  test: boolean;\n  timestamp: number;\n}\n\ntype TestStatus = TestResult['status'];\n\n\nexport const TestingDebugPanel: React.FC<TestingDebugPanelProps> = ({ className = \"\" }) => {\n  const [isRunningTests, setIsRunningTests] = useState(false);\n  const [testResults, setTestResults] = useState<TestResult[]>([]);\n  \n  // Analytics worker with cache stats\n  const analyticsWorker = useAnalyticsWorker({ \n    enableCacheStats: true,\n    cacheTTL: 5 * 60 * 1000 // 5 minutes\n  });\n  \n  // Direct cache instance for UI testing\n  const uiCache = usePerformanceCache({ \n    enableStats: true,\n    maxSize: 100,\n    ttl: 5 * 60 * 1000\n  });\n\n  // Update cache stats every second\n  const [cacheStats, setCacheStats] = useState(analyticsWorker.cacheStats);\n  \n  useEffect(() => {\n    // eslint-disable-next-line no-restricted-syntax -- Interval is created inside useEffect with proper cleanup\n    const interval = setInterval(() => {\n      setCacheStats(analyticsWorker.cacheStats);\n    }, 1000);\n    \n    return () => clearInterval(interval);\n  }, [analyticsWorker.cacheStats]);\n\n  const runSystemTests = async () => {\n    setIsRunningTests(true);\n    setTestResults([]);\n    \n    const results: TestResult[] = [];\n    \n    try {\n      // Test 1: Data Storage\n      results.push({\n        name: \"Data Storage\",\n        status: \"running\",\n        message: \"Testing localStorage operations...\"\n      });\n      setTestResults([...results]);\n      \n      const students = dataStorage.getStudents();\n      const entries = dataStorage.getTrackingEntries();\n      const storageStats = dataStorage.getStorageStats();\n      \n      results[0] = {\n        name: \"Data Storage\",\n        status: storageStats.studentsCount >= 0 ? \"pass\" : \"fail\",\n        message: `Found ${storageStats.studentsCount} students, ${storageStats.entriesCount} entries`\n      };\n      setTestResults([...results]);\n      \n      // Test 2: Analytics Initialization\n      results.push({\n        name: \"Analytics System\",\n        status: \"running\",\n        message: \"Testing analytics initialization...\"\n      });\n      setTestResults([...results]);\n      \n      const initStatus = universalAnalyticsInitializer.getInitializationStatus();\n      \n      results[1] = {\n        name: \"Analytics System\",\n        status: initStatus.isInitialized ? \"pass\" : \"warn\",\n        message: `${initStatus.studentsWithAnalytics}/${initStatus.totalStudents} students have analytics`\n      };\n      setTestResults([...results]);\n      \n      // Test 3: New Student Creation (without mock data)\n      results.push({\n        name: \"New Student Flow\",\n        status: \"running\",\n        message: \"Testing new student creation...\"\n      });\n      setTestResults([...results]);\n      \n      // Create a test student temporarily\n      const testStudentId = 'test-' + Date.now();\n      analyticsManager.initializeStudentAnalytics(testStudentId);\n      const testStatus = analyticsManager.getAnalyticsStatus().find(s => s.studentId === testStudentId);\n      \n      results[2] = {\n        name: \"New Student Flow\",\n        status: testStatus?.isInitialized && !testStatus?.hasMinimumData ? \"pass\" : \"fail\",\n        message: testStatus?.isInitialized && !testStatus?.hasMinimumData \n          ? \"✓ New students start with clean slate\" \n          : \"✗ New students may have unexpected data\"\n      };\n      setTestResults([...results]);\n      \n      // Test 4: Empty State Handling\n      results.push({\n        name: \"Empty State Handling\",\n        status: \"running\",\n        message: \"Testing empty data scenarios...\"\n      });\n      setTestResults([...results]);\n      \n      const emptyStudents = students.filter(student => {\n        const studentEntries = entries.filter(entry => entry.studentId === student.id);\n        return studentEntries.length === 0;\n      });\n      \n      results[3] = {\n        name: \"Empty State Handling\",\n        status: \"pass\",\n        message: `Found ${emptyStudents.length} students with no data (will show empty states)`\n      };\n      setTestResults([...results]);\n      \n      // Test 5: Pattern Detection Ready\n      results.push({\n        name: \"Pattern Detection\",\n        status: \"running\",\n        message: \"Testing pattern detection capability...\"\n      });\n      setTestResults([...results]);\n      \n      const studentsWithData = students.filter(student => {\n        const studentEntries = entries.filter(entry => entry.studentId === student.id);\n        return studentEntries.length >= 3;\n      });\n      \n      results[4] = {\n        name: \"Pattern Detection\",\n        status: studentsWithData.length > 0 ? \"pass\" : \"warn\",\n        message: `${studentsWithData.length} students have enough data for pattern detection`\n      };\n      setTestResults([...results]);\n      \n      // Test 6: Cache Performance\n      results.push({\n        name: \"Cache Performance\",\n        status: \"running\",\n        message: \"Testing cache functionality...\"\n      });\n      setTestResults([...results]);\n      \n      // Test cache operations\n      const testKey = 'test-cache-' + Date.now();\n      const testData: TestData = { test: true, timestamp: Date.now() };\n      uiCache.set(testKey, testData);\n      const retrieved = uiCache.get(testKey) as TestData | undefined;\n      \n      results[5] = {\n        name: \"Cache Performance\",\n        status: retrieved?.test === true ? \"pass\" : \"fail\",\n        message: cacheStats ? `Hit rate: ${cacheStats.hitRate.toFixed(1)}%, Size: ${cacheStats.size} items` : \"Cache stats unavailable\"\n      };\n      setTestResults([...results]);\n      \n      toast.success(\"System tests completed successfully\");\n      \n    } catch (error) {\n      logger.error('System test error', { error });\n      results.push({\n        name: \"Test Error\",\n        status: \"fail\",\n        message: `Error: ${error instanceof Error ? error.message : 'Unknown error'}`\n      });\n      setTestResults([...results]);\n      toast.error(\"Some tests failed\");\n    } finally {\n      setIsRunningTests(false);\n    }\n  };\n\n  const getStatusIcon = useCallback((status: TestStatus): React.ReactElement => {\n    switch (status) {\n      case 'pass': return <CheckCircle className=\"h-4 w-4 text-green-600\" />;\n      case 'fail': return <AlertTriangle className=\"h-4 w-4 text-red-600\" />;\n      case 'warn': return <AlertTriangle className=\"h-4 w-4 text-yellow-600\" />;\n      case 'running': return <RefreshCw className=\"h-4 w-4 text-blue-600 animate-spin\" />;\n      default: return <TestTube className=\"h-4 w-4 text-muted-foreground\" />;\n    }\n  }, []);\n\n  const getStatusColor = useCallback((status: TestStatus): 'default' | 'destructive' | 'secondary' | 'outline' => {\n    switch (status) {\n      case 'pass': return 'default';\n      case 'fail': return 'destructive';\n      case 'warn': return 'secondary';\n      case 'running': return 'outline';\n      default: return 'secondary';\n    }\n  }, []);\n\n  const handleClearCache = useCallback(() => {\n    analyticsWorker.clearCache();\n    uiCache.clear();\n    toast.success(\"Analytics cache cleared successfully\");\n  }, [analyticsWorker, uiCache]);\n\n  const handleInvalidateStudent = useCallback((studentId: string) => {\n    analyticsWorker.invalidateCacheForStudent(studentId);\n    toast.success(`Cache invalidated for student ${studentId}`);\n  }, [analyticsWorker]);\n\n  return (\n    <div className={`space-y-4 ${className}`}>\n      {/* Main Testing Panel */}\n      <Card className=\"bg-gradient-card border-0 shadow-soft\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Bug className=\"h-5 w-5\" />\n            System Testing & Debug Panel\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <p className=\"text-sm text-muted-foreground\">\n              Test current system functionality and data integrity\n            </p>\n            <Button\n              onClick={runSystemTests}\n              disabled={isRunningTests}\n              size=\"sm\"\n              variant=\"outline\"\n              aria-label=\"Run system tests\"\n              title=\"Run system tests\"\n            >\n              {isRunningTests ? (\n                <>\n                  <RefreshCw className=\"h-4 w-4 mr-2 animate-spin\" />\n                  <span className=\"hidden sm:inline\">Running Tests...</span>\n                </>\n              ) : (\n                <>\n                  <TestTube className=\"h-4 w-4 mr-2\" />\n                  <span className=\"hidden sm:inline\">Run System Tests</span>\n                </>\n              )}\n            </Button>\n          </div>\n\n          {testResults.length > 0 && (\n            <div className=\"space-y-3\">\n              <h4 className=\"text-sm font-medium\">Test Results:</h4>\n              {testResults.map((result) => (\n                <div key={result.name} className=\"flex items-center justify-between p-3 bg-muted/50 rounded-lg\">\n                  <div className=\"flex items-center gap-3\">\n                    {getStatusIcon(result.status)}\n                    <div>\n                      <p className=\"font-medium text-sm\">{result.name}</p>\n                      <p className=\"text-xs text-muted-foreground\">{result.message}</p>\n                    </div>\n                  </div>\n                  <Badge variant={getStatusColor(result.status)} className=\"text-xs\">\n                    {result.status.toUpperCase()}\n                  </Badge>\n                </div>\n              ))}\n            </div>\n          )}\n\n          <div className=\"pt-4 border-t border-border\">\n            <h4 className=\"text-sm font-medium mb-2\">Quick Stats:</h4>\n            <div className=\"grid grid-cols-3 gap-3 text-center\">\n              <div>\n                <Users className=\"h-4 w-4 mx-auto mb-1 text-muted-foreground\" />\n                <p className=\"text-xs text-muted-foreground\">Students</p>\n              </div>\n              <div>\n                <Database className=\"h-4 w-4 mx-auto mb-1 text-muted-foreground\" />\n                <p className=\"text-xs text-muted-foreground\">Entries</p>\n              </div>\n              <div>\n                <BarChart3 className=\"h-4 w-4 mx-auto mb-1 text-muted-foreground\" />\n                <p className=\"text-xs text-muted-foreground\">Analytics</p>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Cache Management Panel */}\n      <Card className=\"bg-gradient-card border-0 shadow-soft\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Archive className=\"h-5 w-5\" />\n            Analytics Cache Management\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {cacheStats && (\n            <>\n              {/* Cache Statistics */}\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm font-medium\">Cache Hit Rate</span>\n                  <div className=\"flex items-center gap-2\">\n                    <Progress value={cacheStats.hitRate} className=\"w-24\" />\n                    <span className=\"text-sm font-mono\">{cacheStats.hitRate.toFixed(1)}%</span>\n                  </div>\n                </div>\n                \n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"flex flex-col\">\n                    <span className=\"text-xs text-muted-foreground\">Cache Size</span>\n                    <span className=\"text-lg font-semibold\">{cacheStats.size} / {analyticsWorker.cacheSize}</span>\n                  </div>\n                  <div className=\"flex flex-col\">\n                    <span className=\"text-xs text-muted-foreground\">Memory Usage</span>\n                    <span className=\"text-lg font-semibold\">\n                      {cacheStats.memoryUsage ? `${(cacheStats.memoryUsage / 1024).toFixed(1)} KB` : 'N/A'}\n                    </span>\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-3 gap-2 pt-2\">\n                  <div className=\"text-center p-2 bg-muted/50 rounded\">\n                    <Activity className=\"h-4 w-4 mx-auto mb-1 text-green-600\" />\n                    <p className=\"text-xs font-medium\">{cacheStats.hits}</p>\n                    <p className=\"text-xs text-muted-foreground\">Hits</p>\n                  </div>\n                  <div className=\"text-center p-2 bg-muted/50 rounded\">\n                    <AlertTriangle className=\"h-4 w-4 mx-auto mb-1 text-yellow-600\" />\n                    <p className=\"text-xs font-medium\">{cacheStats.misses}</p>\n                    <p className=\"text-xs text-muted-foreground\">Misses</p>\n                  </div>\n                  <div className=\"text-center p-2 bg-muted/50 rounded\">\n                    <Zap className=\"h-4 w-4 mx-auto mb-1 text-blue-600\" />\n                    <p className=\"text-xs font-medium\">{cacheStats.sets}</p>\n                    <p className=\"text-xs text-muted-foreground\">Sets</p>\n                  </div>\n                </div>\n              </div>\n\n              {/* Cache Actions */}\n              <div className=\"pt-4 border-t border-border space-y-3\">\n                <h4 className=\"text-sm font-medium\">Cache Actions</h4>\n                <div className=\"flex gap-2\">\n                <Button\n                  size=\"sm\"\n                  variant=\"outline\"\n                  onClick={handleClearCache}\n                  className=\"flex-1\"\n                  aria-label=\"Clear all analytics cache\"\n                  title=\"Clear all analytics cache\"\n                >\n                  <Trash2 className=\"h-4 w-4 mr-2\" />\n                  <span className=\"hidden sm:inline\">Clear All Cache</span>\n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant=\"outline\"\n                  onClick={() => uiCache.cleanup()}\n                  className=\"flex-1\"\n                  aria-label=\"Clean expired cache entries\"\n                  title=\"Clean expired cache entries\"\n                >\n                  <RefreshCw className=\"h-4 w-4 mr-2\" />\n                  <span className=\"hidden sm:inline\">Clean Expired</span>\n                </Button>\n                </div>\n                \n                <div className=\"text-xs text-muted-foreground\">\n                  <p>• Cache TTL: 5 minutes</p>\n                  <p>• Eviction: LRU (Least Recently Used)</p>\n                  <p>• Invalidations: {cacheStats.invalidations || 0}</p>\n                </div>\n              </div>\n            </>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Analytics Configuration Test Panel */}\n      <AnalyticsConfigTest />\n    </div>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/TestingToolsSection.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Testing & Development Tools\"","line":20,"column":44,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":20,"endColumn":71},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-2xl font-bold\">Testing & Development Tools</h2>","line":20,"column":44,"nodeType":"JSXText","endLine":20,"endColumn":71},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Tools for testing pattern analysis features and debugging data issues\"","line":21,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":23,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">\n          Tools for testing pattern analysis features and debugging data issues\n        </p>","line":21,"column":46,"nodeType":"JSXText","endLine":23,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Mock Data Generator\"","line":31,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":33,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n              <Database className=\"h-5 w-5 text-primary\" />\n              Mock Data Generator\n            </CardTitle>","line":31,"column":60,"nodeType":"JSXText","endLine":33,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Load realistic test data to explore pattern analysis features\"","line":36,"column":63,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":38,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground mb-4\">\n              Load realistic test data to explore pattern analysis features\n            </p>","line":36,"column":63,"nodeType":"JSXText","endLine":38,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Load Mock Data\"","line":42,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":44,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button className=\"w-full bg-gradient-primary hover:opacity-90\">\n                  <Database className=\"h-4 w-4 mr-2\" />\n                  Load Mock Data\n                </Button>","line":42,"column":56,"nodeType":"JSXText","endLine":44,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Mock Data for Testing & Analysis\"","line":48,"column":32,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":48,"endColumn":64},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DialogTitle>Mock Data for Testing & Analysis</DialogTitle>","line":48,"column":32,"nodeType":"JSXText","endLine":48,"endColumn":64},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Load realistic sample students and entries to explore features safely.\"","line":49,"column":38,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":51,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DialogDescription>\n                    Load realistic sample students and entries to explore features safely.\n                  </DialogDescription>","line":49,"column":38,"nodeType":"JSXText","endLine":51,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Debug Panel\"","line":63,"column":55,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":65,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n              <Bug className=\"h-5 w-5 text-primary\" />\n              Debug Panel\n            </CardTitle>","line":63,"column":55,"nodeType":"JSXText","endLine":65,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Advanced debugging and data inspection tools\"","line":68,"column":63,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":70,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground mb-4\">\n              Advanced debugging and data inspection tools\n            </p>","line":68,"column":63,"nodeType":"JSXText","endLine":70,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Open Debug Panel\"","line":74,"column":51,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":76,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button variant=\"outline\" className=\"w-full\">\n                  <Bug className=\"h-4 w-4 mr-2\" />\n                  Open Debug Panel\n                </Button>","line":74,"column":51,"nodeType":"JSXText","endLine":76,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Debug & Data Inspection\"","line":80,"column":32,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":80,"endColumn":55},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DialogTitle>Debug & Data Inspection</DialogTitle>","line":80,"column":32,"nodeType":"JSXText","endLine":80,"endColumn":55},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Advanced debugging tools for inspecting state, storage, and analytics.\"","line":81,"column":38,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":83,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DialogDescription>\n                    Advanced debugging tools for inspecting state, storage, and analytics.\n                  </DialogDescription>","line":81,"column":38,"nodeType":"JSXText","endLine":83,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Pattern Analysis Testing Guide\"","line":95,"column":58,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":97,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n              <Beaker className=\"h-5 w-5 text-primary\" />\n              Pattern Analysis Testing Guide\n            </CardTitle>","line":95,"column":58,"nodeType":"JSXText","endLine":97,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"To test pattern analysis features effectively:\"","line":101,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":103,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground\">\n                To test pattern analysis features effectively:\n              </p>","line":101,"column":60,"nodeType":"JSXText","endLine":103,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Data Requirements:\"","line":106,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":106,"endColumn":78},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-medium text-sm mb-2\">Data Requirements:</h4>","line":106,"column":60,"nodeType":"JSXText","endLine":106,"endColumn":78},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• At least 10 tracking entries for basic patterns\"","line":108,"column":25,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":108,"endColumn":74},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>• At least 10 tracking entries for basic patterns</li>","line":108,"column":25,"nodeType":"JSXText","endLine":108,"endColumn":74},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• 30+ entries for correlation analysis\"","line":109,"column":25,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":109,"endColumn":63},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>• 30+ entries for correlation analysis</li>","line":109,"column":25,"nodeType":"JSXText","endLine":109,"endColumn":63},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• 90+ entries for predictive insights\"","line":110,"column":25,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":110,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>• 90+ entries for predictive insights</li>","line":110,"column":25,"nodeType":"JSXText","endLine":110,"endColumn":62},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Multiple students for comparative analysis\"","line":111,"column":25,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":111,"endColumn":69},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>• Multiple students for comparative analysis</li>","line":111,"column":25,"nodeType":"JSXText","endLine":111,"endColumn":69},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Features to Test:\"","line":115,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":115,"endColumn":77},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-medium text-sm mb-2\">Features to Test:</h4>","line":115,"column":60,"nodeType":"JSXText","endLine":115,"endColumn":77},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Emotion trend analysis\"","line":117,"column":25,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":117,"endColumn":49},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>• Emotion trend analysis</li>","line":117,"column":25,"nodeType":"JSXText","endLine":117,"endColumn":49},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Sensory correlation matrices\"","line":118,"column":25,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":118,"endColumn":55},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>• Sensory correlation matrices</li>","line":118,"column":25,"nodeType":"JSXText","endLine":118,"endColumn":55},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Environmental impact patterns\"","line":119,"column":25,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":119,"endColumn":56},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>• Environmental impact patterns</li>","line":119,"column":25,"nodeType":"JSXText","endLine":119,"endColumn":56},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• Anomaly detection alerts\"","line":120,"column":25,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":120,"endColumn":51},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>• Anomaly detection alerts</li>","line":120,"column":25,"nodeType":"JSXText","endLine":120,"endColumn":51}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":48,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogDescription } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { MockDataLoader } from \"@/components/MockDataLoader\";\nimport { TestingDebugPanel } from \"@/components/TestingDebugPanel\";\nimport { Database, Bug, Beaker } from \"lucide-react\";\nimport { IS_PROD } from \"@/lib/env\";\n\n/**\n * TestingToolsSection Component\n * Provides easy access to testing and debugging tools\n */\nexport const TestingToolsSection = () => {\n  if (IS_PROD) {\n    return null;\n  }\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h2 className=\"text-2xl font-bold\">Testing & Development Tools</h2>\n        <p className=\"text-muted-foreground\">\n          Tools for testing pattern analysis features and debugging data issues\n        </p>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n        {/* Mock Data Loader */}\n        <Card className=\"bg-gradient-card border-0 shadow-soft\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Database className=\"h-5 w-5 text-primary\" />\n              Mock Data Generator\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-sm text-muted-foreground mb-4\">\n              Load realistic test data to explore pattern analysis features\n            </p>\n            <Dialog>\n              <DialogTrigger asChild>\n                <Button className=\"w-full bg-gradient-primary hover:opacity-90\">\n                  <Database className=\"h-4 w-4 mr-2\" />\n                  Load Mock Data\n                </Button>\n              </DialogTrigger>\n              <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\n                <DialogHeader>\n                  <DialogTitle>Mock Data for Testing & Analysis</DialogTitle>\n                  <DialogDescription>\n                    Load realistic sample students and entries to explore features safely.\n                  </DialogDescription>\n                </DialogHeader>\n                <MockDataLoader />\n              </DialogContent>\n            </Dialog>\n          </CardContent>\n        </Card>\n\n        {/* Debug Panel */}\n        <Card className=\"bg-gradient-card border-0 shadow-soft\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Bug className=\"h-5 w-5 text-primary\" />\n              Debug Panel\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-sm text-muted-foreground mb-4\">\n              Advanced debugging and data inspection tools\n            </p>\n            <Dialog>\n              <DialogTrigger asChild>\n                <Button variant=\"outline\" className=\"w-full\">\n                  <Bug className=\"h-4 w-4 mr-2\" />\n                  Open Debug Panel\n                </Button>\n              </DialogTrigger>\n              <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\n                <DialogHeader>\n                  <DialogTitle>Debug & Data Inspection</DialogTitle>\n                  <DialogDescription>\n                    Advanced debugging tools for inspecting state, storage, and analytics.\n                  </DialogDescription>\n                </DialogHeader>\n                <TestingDebugPanel />\n              </DialogContent>\n            </Dialog>\n          </CardContent>\n        </Card>\n\n        {/* Pattern Analysis Testing */}\n        <Card className=\"bg-gradient-card border-0 shadow-soft col-span-full\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Beaker className=\"h-5 w-5 text-primary\" />\n              Pattern Analysis Testing Guide\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <p className=\"text-sm text-muted-foreground\">\n                To test pattern analysis features effectively:\n              </p>\n              <div className=\"grid md:grid-cols-2 gap-4\">\n                <div>\n                  <h4 className=\"font-medium text-sm mb-2\">Data Requirements:</h4>\n                  <ul className=\"text-xs text-muted-foreground space-y-1\">\n                    <li>• At least 10 tracking entries for basic patterns</li>\n                    <li>• 30+ entries for correlation analysis</li>\n                    <li>• 90+ entries for predictive insights</li>\n                    <li>• Multiple students for comparative analysis</li>\n                  </ul>\n                </div>\n                <div>\n                  <h4 className=\"font-medium text-sm mb-2\">Features to Test:</h4>\n                  <ul className=\"text-xs text-muted-foreground space-y-1\">\n                    <li>• Emotion trend analysis</li>\n                    <li>• Sensory correlation matrices</li>\n                    <li>• Environmental impact patterns</li>\n                    <li>• Anomaly detection alerts</li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/TimelineVisualization.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'addDays' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Maximize2' is defined but never used. Allowed unused vars must match /^_/u.","line":14,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'trackingEntries' is defined but never used. Allowed unused args must match /^_/u.","line":62,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":62,"endColumn":18},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":108,"column":25,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":108,"endColumn":58},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":112,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":112,"endColumn":84},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":304,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":304,"endColumn":60},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":305,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":305,"endColumn":56},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":318,"column":22,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":327,"endColumn":12},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":336,"column":22,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":345,"endColumn":13},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":439,"column":24,"nodeType":"TemplateLiteral","messageId":"noArrayIndex","endLine":439,"endColumn":43},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getIcon' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":470,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":470,"endColumn":20},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'timeRange'. Either include it or remove the dependency array.","line":526,"column":53,"nodeType":"ArrayExpression","endLine":526,"endColumn":101,"suggestions":[{"desc":"Update the dependencies array to be: [timeRange, timeScale, dimensions.width, dimensions.height]","fix":{"range":[16219,16267],"text":"[timeRange, timeScale, dimensions.width, dimensions.height]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has a missing dependency: 'dimensions.width'. Either include it or remove the dependency array.","line":528,"column":58,"nodeType":"ArrayExpression","endLine":528,"endColumn":101,"suggestions":[{"desc":"Update the dependencies array to be: [dataStreams, dimensions.height, dimensions.width, timeScale]","fix":{"range":[16328,16371],"text":"[dataStreams, dimensions.height, dimensions.width, timeScale]"}}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Timeline Visualization\"","line":535,"column":42,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":537,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n            <Clock className=\"h-5 w-5\" />\n            Timeline Visualization\n          </CardTitle>","line":535,"column":42,"nodeType":"JSXText","endLine":537,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Live\"","line":540,"column":66,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":542,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"default\" className=\"animate-pulse\">\n                Live\n              </Badge>","line":540,"column":66,"nodeType":"JSXText","endLine":542,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-sm text-muted-foreground\">\n                {playbackSpeed}x\n              </span>","line":633,"column":32,"nodeType":"JSXText","endLine":634,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotions\"","line":646,"column":51,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":648,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Toggle\n                size=\"sm\"\n                pressed={streamVisibility.emotions}\n                onPressedChange={(pressed) => \n                  setStreamVisibility(prev => ({ ...prev, emotions: pressed }))\n                }\n              >\n                <Brain className=\"h-4 w-4 mr-1\" />\n                Emotions\n              </Toggle>","line":646,"column":51,"nodeType":"JSXText","endLine":648,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory\"","line":656,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":658,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Toggle\n                size=\"sm\"\n                pressed={streamVisibility.sensory}\n                onPressedChange={(pressed) => \n                  setStreamVisibility(prev => ({ ...prev, sensory: pressed }))\n                }\n              >\n                <Eye className=\"h-4 w-4 mr-1\" />\n                Sensory\n              </Toggle>","line":656,"column":49,"nodeType":"JSXText","endLine":658,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Anomalies\"","line":666,"column":57,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":668,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Toggle\n                size=\"sm\"\n                pressed={streamVisibility.anomalies}\n                onPressedChange={(pressed) => \n                  setStreamVisibility(prev => ({ ...prev, anomalies: pressed }))\n                }\n              >\n                <AlertCircle className=\"h-4 w-4 mr-1\" />\n                Anomalies\n              </Toggle>","line":666,"column":57,"nodeType":"JSXText","endLine":668,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"minutes\"","line":676,"column":64,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":677,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-medium\">\n              {differenceInMinutes(timeRange[1], timeRange[0])} minutes\n            </span>","line":676,"column":64,"nodeType":"JSXText","endLine":677,"endColumn":13},{"ruleId":"no-restricted-syntax","severity":1,"message":"Avoid inline styles (style={{}}). Use Tailwind CSS classes or CSS custom properties for styling. See rule 3wIMH0UDSwsNj5RYGo17Vg. Exception: Radix primitives with // RADIX_INLINE_STYLE_ALLOWED comment.","line":727,"column":15,"nodeType":"JSXAttribute","messageId":"restrictedSyntax","endLine":729,"endColumn":17},{"ruleId":"no-restricted-syntax","severity":1,"message":"Avoid inline styles (style={{}}). Use Tailwind CSS classes or CSS custom properties for styling. See rule 3wIMH0UDSwsNj5RYGo17Vg. Exception: Radix primitives with // RADIX_INLINE_STYLE_ALLOWED comment.","line":734,"column":19,"nodeType":"JSXAttribute","messageId":"restrictedSyntax","endLine":734,"endColumn":66},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Data Streams\"","line":756,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":756,"endColumn":66},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-medium text-sm mb-2\">Data Streams</h4>","line":756,"column":54,"nodeType":"JSXText","endLine":756,"endColumn":66},{"ruleId":"no-restricted-syntax","severity":1,"message":"Avoid inline styles (style={{}}). Use Tailwind CSS classes or CSS custom properties for styling. See rule 3wIMH0UDSwsNj5RYGo17Vg. Exception: Radix primitives with // RADIX_INLINE_STYLE_ALLOWED comment.","line":762,"column":21,"nodeType":"JSXAttribute","messageId":"restrictedSyntax","endLine":762,"endColumn":62},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Events:\"","line":773,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":773,"endColumn":26},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Events: {timelineEvents.length}</p>","line":773,"column":18,"nodeType":"JSXText","endLine":773,"endColumn":26},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Zoom:\"","line":774,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":774,"endColumn":24},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Zoom: {Math.round(zoomLevel * 100)}%</p>","line":774,"column":18,"nodeType":"JSXText","endLine":774,"endColumn":24},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Selection:\"","line":776,"column":20,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":776,"endColumn":31},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Selection: {differenceInMinutes(brushSelection[1], brushSelection[0])} min</p>","line":776,"column":20,"nodeType":"JSXText","endLine":776,"endColumn":31},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"min\"","line":776,"column":90,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":776,"endColumn":94},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Selection: {differenceInMinutes(brushSelection[1], brushSelection[0])} min</p>","line":776,"column":90,"nodeType":"JSXText","endLine":776,"endColumn":94}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":39,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef, useEffect, useMemo, useCallback } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Slider } from '@/components/ui/slider';\nimport { Toggle } from '@/components/ui/toggle';\nimport { EmotionEntry, SensoryEntry, TrackingEntry } from '@/types/student';\nimport { format, subDays, addDays, differenceInMinutes, isWithinInterval } from 'date-fns';\nimport { \n  Clock, \n  ZoomIn, \n  ZoomOut, \n  RotateCcw, \n  Maximize2,\n  Play,\n  Pause,\n  ChevronLeft,\n  ChevronRight,\n  Activity,\n  Brain,\n  Eye,\n  AlertCircle\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { logger } from '@/lib/logger';\n\ninterface TimelineVisualizationProps {\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  trackingEntries: TrackingEntry[];\n  anomalies?: Array<{\n    timestamp: Date;\n    type: string;\n    severity: 'low' | 'medium' | 'high';\n  }>;\n  onTimeRangeChange?: (start: Date, end: Date) => void;\n  realtime?: boolean;\n}\n\ninterface TimelineEvent {\n  id: string;\n  timestamp: Date;\n  type: 'emotion' | 'sensory' | 'tracking' | 'anomaly';\n  label: string;\n  value?: number;\n  color: string;\n  metadata?: Record<string, string | number>;\n}\n\ninterface DataStream {\n  id: string;\n  label: string;\n  color: string;\n  data: Array<{ timestamp: Date; value: number }>;\n  visible: boolean;\n  yScale: [number, number];\n}\n\nexport const TimelineVisualization: React.FC<TimelineVisualizationProps> = ({\n  emotions,\n  sensoryInputs,\n  trackingEntries,\n  anomalies = [],\n  onTimeRangeChange,\n  realtime = false\n}) => {\n  const svgRef = useRef<SVGSVGElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [dimensions, setDimensions] = useState({ width: 800, height: 400 });\n  \n  // Timeline state\n  const [timeRange, setTimeRange] = useState<[Date, Date]>(() => {\n    const now = new Date();\n    return [subDays(now, 7), now];\n  });\n  const [zoomLevel, setZoomLevel] = useState(1);\n  const [panOffset, setPanOffset] = useState(0);\n  const [brushSelection, setBrushSelection] = useState<[Date, Date] | null>(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [playbackSpeed, setPlaybackSpeed] = useState(1);\n  const [hoveredEvent, setHoveredEvent] = useState<TimelineEvent | null>(null);\n  const [isDragging, setIsDragging] = useState(false);\n  const dragStartDateRef = useRef<Date | null>(null);\n  \n  // Data stream visibility\n  const [streamVisibility, setStreamVisibility] = useState({\n    emotions: true,\n    sensory: true,\n    anomalies: true\n  });\n\n  // Calculate dimensions on mount and resize with throttling\n  useEffect(() => {\n    let resizeTimeoutId: ReturnType<typeof setTimeout> | null = null;\n    \n    const updateDimensions = () => {\n      if (containerRef.current) {\n        const { width, height } = containerRef.current.getBoundingClientRect();\n        setDimensions({ width: width - 40, height: height - 200 });\n      }\n    };\n    \n    // Throttled resize handler to prevent excessive re-renders\n    const throttledUpdateDimensions = () => {\n      if (resizeTimeoutId) {\n        clearTimeout(resizeTimeoutId);\n      }\n      resizeTimeoutId = setTimeout(updateDimensions, 100);\n    };\n\n    updateDimensions();\n    window.addEventListener('resize', throttledUpdateDimensions, { passive: true });\n    \n    return () => {\n      window.removeEventListener('resize', throttledUpdateDimensions);\n      if (resizeTimeoutId) {\n        clearTimeout(resizeTimeoutId);\n      }\n    };\n  }, []);\n\n  // Process data into timeline events\n  const timelineEvents = useMemo((): TimelineEvent[] => {\n    const events: TimelineEvent[] = [];\n\n    // Process emotions\n    if (streamVisibility.emotions) {\n      emotions.forEach((emotion, i) => {\n        events.push({\n          id: `emotion-${i}`,\n          timestamp: emotion.timestamp,\n          type: 'emotion',\n          label: emotion.emotion,\n          value: emotion.intensity,\n          color: '#10B981',\n          metadata: {\n            intensity: emotion.intensity,\n            triggers: emotion.triggers?.join(', ') || 'None'\n          }\n        });\n      });\n    }\n\n    // Process sensory inputs\n    if (streamVisibility.sensory) {\n      sensoryInputs.forEach((input, i) => {\n        events.push({\n          id: `sensory-${i}`,\n          timestamp: input.timestamp,\n          type: 'sensory',\n          label: `${input.sensoryType}: ${input.response}`,\n          color: '#3B82F6',\n          metadata: {\n            type: input.sensoryType,\n            response: input.response\n          }\n        });\n      });\n    }\n\n    // Process anomalies\n    if (streamVisibility.anomalies) {\n      anomalies.forEach((anomaly, i) => {\n        events.push({\n          id: `anomaly-${i}`,\n          timestamp: anomaly.timestamp,\n          type: 'anomaly',\n          label: anomaly.type,\n          color: anomaly.severity === 'high' ? '#EF4444' : \n                 anomaly.severity === 'medium' ? '#F59E0B' : '#FCD34D'\n        });\n      });\n    }\n\n    return events.filter(event => \n      isWithinInterval(event.timestamp, { start: timeRange[0], end: timeRange[1] })\n    );\n  }, [emotions, sensoryInputs, anomalies, timeRange, streamVisibility]);\n\n  // Process data streams\n  const dataStreams = useMemo((): DataStream[] => {\n    const streams: DataStream[] = [];\n\n    // Emotion intensity stream\n    const emotionData = emotions\n      .filter(e => isWithinInterval(e.timestamp, { start: timeRange[0], end: timeRange[1] }))\n      .map(e => ({ timestamp: e.timestamp, value: e.intensity }))\n      .sort((a, b) => a.timestamp.getTime() - b.timestamp.getTime());\n\n    if (emotionData.length > 0) {\n      streams.push({\n        id: 'emotion-intensity',\n        label: 'Emotion Intensity',\n        color: '#10B981',\n        data: emotionData,\n        visible: streamVisibility.emotions,\n        yScale: [0, 10]\n      });\n    }\n\n    // Sensory response stream (aggregated by hour)\n    const sensoryByHour = new Map<string, { seeking: number; avoiding: number; neutral: number }>();\n    sensoryInputs\n      .filter(s => isWithinInterval(s.timestamp, { start: timeRange[0], end: timeRange[1] }))\n      .forEach(input => {\n        const hourKey = format(input.timestamp, 'yyyy-MM-dd HH:00');\n        if (!sensoryByHour.has(hourKey)) {\n          sensoryByHour.set(hourKey, { seeking: 0, avoiding: 0, neutral: 0 });\n        }\n        const hourData = sensoryByHour.get(hourKey);\n        if (!hourData) {\n          // This shouldn't happen, but add safety check\n          logger.warn('Unexpected missing hour data', { hourKey });\n          return;\n        }\n        if (input.response?.includes('seeking')) hourData.seeking++;\n        else if (input.response?.includes('avoiding')) hourData.avoiding++;\n        else hourData.neutral++;\n      });\n\n    const sensoryData = Array.from(sensoryByHour.entries())\n      .map(([hourKey, data]) => ({\n        timestamp: new Date(hourKey),\n        value: data.seeking - data.avoiding // Net sensory response\n      }))\n      .sort((a, b) => a.timestamp.getTime() - b.timestamp.getTime());\n\n    if (sensoryData.length > 0) {\n      const minValue = Math.min(...sensoryData.map(d => d.value));\n      const maxValue = Math.max(...sensoryData.map(d => d.value));\n      streams.push({\n        id: 'sensory-response',\n        label: 'Sensory Response (Seeking - Avoiding)',\n        color: '#3B82F6',\n        data: sensoryData,\n        visible: streamVisibility.sensory,\n        yScale: [minValue - 1, maxValue + 1]\n      });\n    }\n\n    return streams;\n  }, [emotions, sensoryInputs, timeRange, streamVisibility]);\n\n  // Timeline calculations\n  const timeScale = useCallback((date: Date): number => {\n    const totalDuration = timeRange[1].getTime() - timeRange[0].getTime();\n    const offset = date.getTime() - timeRange[0].getTime();\n    return (offset / totalDuration) * dimensions.width * zoomLevel + panOffset;\n  }, [timeRange, dimensions.width, zoomLevel, panOffset]);\n\n  const inverseTimeScale = useCallback((x: number): Date => {\n    const adjustedX = (x - panOffset) / zoomLevel;\n    const totalDuration = timeRange[1].getTime() - timeRange[0].getTime();\n    const offset = (adjustedX / dimensions.width) * totalDuration;\n    return new Date(timeRange[0].getTime() + offset);\n  }, [timeRange, dimensions.width, zoomLevel, panOffset]);\n\n  // Handle zoom\n  const handleZoom = (delta: number) => {\n    const newZoom = Math.max(0.5, Math.min(10, zoomLevel + delta));\n    setZoomLevel(newZoom);\n  };\n\n  // Handle pan\n  const handlePan = (delta: number) => {\n    setPanOffset(prev => prev + delta);\n  };\n\n  // Handle brush selection\n  const handleMouseDown = useCallback((e: React.MouseEvent<SVGElement>) => {\n    if (!svgRef.current) return;\n    const rect = svgRef.current.getBoundingClientRect();\n    const x = e.clientX - rect.left;\n    const startDate = inverseTimeScale(x);\n    \n    dragStartDateRef.current = startDate;\n    setIsDragging(true);\n  }, [inverseTimeScale]);\n\n  // Handle mouse events for brush selection with proper cleanup\n  useEffect(() => {\n    if (!isDragging || !dragStartDateRef.current || !svgRef.current) return;\n\n    const rect = svgRef.current.getBoundingClientRect();\n    const startDate = dragStartDateRef.current;\n\n    const handleMouseMove = (e: MouseEvent) => {\n      const currentX = e.clientX - rect.left;\n      const currentDate = inverseTimeScale(currentX);\n      setBrushSelection([\n        startDate < currentDate ? startDate : currentDate,\n        startDate < currentDate ? currentDate : startDate\n      ]);\n    };\n\n    const handleMouseUp = () => {\n      if (brushSelection && onTimeRangeChange) {\n        onTimeRangeChange(brushSelection[0], brushSelection[1]);\n      }\n      setIsDragging(false);\n      dragStartDateRef.current = null;\n    };\n\n    document.addEventListener('mousemove', handleMouseMove);\n    document.addEventListener('mouseup', handleMouseUp);\n\n    // Cleanup function to remove listeners\n    return () => {\n      document.removeEventListener('mousemove', handleMouseMove);\n      document.removeEventListener('mouseup', handleMouseUp);\n    };\n  }, [isDragging, brushSelection, onTimeRangeChange, inverseTimeScale]);\n\n  // Playback animation\n  useEffect(() => {\n    if (!isPlaying) return;\n\n    const interval = setInterval(() => {\n      setTimeRange(prev => {\n        const duration = prev[1].getTime() - prev[0].getTime();\n        const step = (duration / 100) * playbackSpeed;\n        return [\n          new Date(prev[0].getTime() + step),\n          new Date(prev[1].getTime() + step)\n        ];\n      });\n    }, 100);\n\n    return () => clearInterval(interval);\n  }, [isPlaying, playbackSpeed]);\n\n  // Real-time updates\n  useEffect(() => {\n    if (!realtime) return;\n\n    const interval = setInterval(() => {\n      const now = new Date();\n      setTimeRange(prev => {\n        const duration = prev[1].getTime() - prev[0].getTime();\n        return [\n          new Date(now.getTime() - duration),\n          now\n        ];\n      });\n    }, 5000); // Update every 5 seconds\n\n    return () => clearInterval(interval);\n  }, [realtime]);\n\n  // Render timeline grid\n  const renderGrid = () => {\n    const gridLines = [];\n    const labels = [];\n    const startTime = timeRange[0].getTime();\n    const endTime = timeRange[1].getTime();\n    const duration = endTime - startTime;\n    \n    // Determine appropriate time interval based on zoom\n    let interval: number;\n    let formatStr: string;\n    if (duration < 3600000) { // Less than 1 hour\n      interval = 300000; // 5 minutes\n      formatStr = 'HH:mm';\n    } else if (duration < 86400000) { // Less than 1 day\n      interval = 3600000; // 1 hour\n      formatStr = 'HH:mm';\n    } else if (duration < 604800000) { // Less than 1 week\n      interval = 86400000; // 1 day\n      formatStr = 'MMM dd';\n    } else {\n      interval = 604800000; // 1 week\n      formatStr = 'MMM dd';\n    }\n\n    for (let time = startTime; time <= endTime; time += interval) {\n      const x = timeScale(new Date(time));\n      if (x >= 0 && x <= dimensions.width) {\n        gridLines.push(\n          <line\n            key={`grid-${time}`}\n            x1={x}\n            y1={0}\n            x2={x}\n            y2={dimensions.height}\n            stroke=\"#e5e7eb\"\n            strokeDasharray=\"2,2\"\n          />\n        );\n        labels.push(\n          <text\n            key={`label-${time}`}\n            x={x}\n            y={dimensions.height - 5}\n            textAnchor=\"middle\"\n            fontSize=\"12\"\n            fill=\"#6b7280\"\n          >\n            {format(new Date(time), formatStr)}\n          </text>\n        );\n      }\n    }\n\n    return { gridLines, labels };\n  };\n\n  // Render data streams\n  const renderDataStreams = () => {\n    return dataStreams.filter(stream => stream.visible).map(stream => {\n      const yScale = (value: number) => {\n        const [min, max] = stream.yScale;\n        const normalized = (value - min) / (max - min);\n        return dimensions.height * 0.8 - normalized * (dimensions.height * 0.6);\n      };\n\n      const pathData = stream.data\n        .map((point, i) => {\n          const x = timeScale(point.timestamp);\n          const y = yScale(point.value);\n          return `${i === 0 ? 'M' : 'L'} ${x} ${y}`;\n        })\n        .join(' ');\n\n      return (\n        <g key={stream.id}>\n          <path\n            d={pathData}\n            fill=\"none\"\n            stroke={stream.color}\n            strokeWidth=\"2\"\n            opacity=\"0.8\"\n          />\n          {stream.data.map((point, i) => {\n            const x = timeScale(point.timestamp);\n            const y = yScale(point.value);\n            if (x >= 0 && x <= dimensions.width) {\n              return (\n                <circle\n                  key={`${stream.id}-${i}`}\n                  cx={x}\n                  cy={y}\n                  r=\"3\"\n                  fill={stream.color}\n                  className=\"cursor-pointer hover:r-5\"\n                  onMouseEnter={() => setHoveredEvent({\n                    id: `${stream.id}-${i}`,\n                    timestamp: point.timestamp,\n                    type: 'tracking',\n                    label: `${stream.label}: ${point.value.toFixed(1)}`,\n                    value: point.value,\n                    color: stream.color\n                  })}\n                  onMouseLeave={() => setHoveredEvent(null)}\n                />\n              );\n            }\n            return null;\n          })}\n        </g>\n      );\n    });\n  };\n\n  // Render events\n  const renderEvents = () => {\n    return timelineEvents.map(event => {\n      const x = timeScale(event.timestamp);\n      if (x < 0 || x > dimensions.width) return null;\n\n      const getIcon = () => {\n        switch (event.type) {\n          case 'emotion': return <Brain className=\"h-4 w-4\" />;\n          case 'sensory': return <Eye className=\"h-4 w-4\" />;\n          case 'anomaly': return <AlertCircle className=\"h-4 w-4\" />;\n          default: return <Activity className=\"h-4 w-4\" />;\n        }\n      };\n\n      return (\n        <g key={event.id}>\n          <line\n            x1={x}\n            y1={dimensions.height * 0.2}\n            x2={x}\n            y2={dimensions.height * 0.8}\n            stroke={event.color}\n            strokeWidth=\"1\"\n            opacity=\"0.3\"\n          />\n          <circle\n            cx={x}\n            cy={dimensions.height * 0.2}\n            r=\"8\"\n            fill={event.color}\n            className=\"cursor-pointer\"\n            onMouseEnter={() => setHoveredEvent(event)}\n            onMouseLeave={() => setHoveredEvent(null)}\n          />\n        </g>\n      );\n    });\n  };\n\n  // Render brush selection\n  const renderBrushSelection = () => {\n    if (!brushSelection) return null;\n\n    const x1 = timeScale(brushSelection[0]);\n    const x2 = timeScale(brushSelection[1]);\n\n    return (\n      <rect\n        x={Math.min(x1, x2)}\n        y={0}\n        width={Math.abs(x2 - x1)}\n        height={dimensions.height}\n        fill=\"hsl(var(--primary))\"\n        opacity=\"0.1\"\n        stroke=\"hsl(var(--primary))\"\n        strokeWidth=\"2\"\n        strokeDasharray=\"4,2\"\n      />\n    );\n  };\n\n  const { gridLines, labels } = useMemo(renderGrid, [timeScale, dimensions.width, dimensions.height]);\n\n  const renderedDataStreams = useMemo(renderDataStreams, [dataStreams, timeScale, dimensions.height]);\n\n  return (\n    <Card className=\"w-full\">\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <Clock className=\"h-5 w-5\" />\n            Timeline Visualization\n          </CardTitle>\n          <div className=\"flex items-center gap-2\">\n            {realtime && (\n              <Badge variant=\"default\" className=\"animate-pulse\">\n                Live\n              </Badge>\n            )}\n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              aria-label=\"Reset view\"\n              title=\"Reset view\"\n              onClick={() => {\n                setZoomLevel(1);\n                setPanOffset(0);\n                setBrushSelection(null);\n              }}\n            >\n              <RotateCcw className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        {/* Controls */}\n        <div className=\"mb-4 space-y-4\">\n          <div className=\"flex items-center gap-4\">\n            {/* Zoom controls */}\n            <div className=\"flex items-center gap-2\">\n              <Button\n                size=\"icon\"\n                variant=\"ghost\"\n                aria-label=\"Zoom out\"\n                title=\"Zoom out\"\n                onClick={() => handleZoom(-0.5)}\n                disabled={zoomLevel <= 0.5}\n              >\n                <ZoomOut className=\"h-4 w-4\" />\n              </Button>\n              <span className=\"text-sm font-medium w-16 text-center\">\n                {Math.round(zoomLevel * 100)}%\n              </span>\n              <Button\n                size=\"icon\"\n                variant=\"ghost\"\n                aria-label=\"Zoom in\"\n                title=\"Zoom in\"\n                onClick={() => handleZoom(0.5)}\n                disabled={zoomLevel >= 10}\n              >\n                <ZoomIn className=\"h-4 w-4\" />\n              </Button>\n            </div>\n\n            {/* Pan controls */}\n            <div className=\"flex items-center gap-2\">\n              <Button\n                size=\"icon\"\n                variant=\"ghost\"\n                aria-label=\"Pan left\"\n                title=\"Pan left\"\n                onClick={() => handlePan(50)}\n              >\n                <ChevronLeft className=\"h-4 w-4\" />\n              </Button>\n              <Button\n                size=\"icon\"\n                variant=\"ghost\"\n                aria-label=\"Pan right\"\n                title=\"Pan right\"\n                onClick={() => handlePan(-50)}\n              >\n                <ChevronRight className=\"h-4 w-4\" />\n              </Button>\n            </div>\n\n            {/* Playback controls */}\n            <div className=\"flex items-center gap-2\">\n              <Button\n                size=\"icon\"\n                variant={isPlaying ? 'default' : 'ghost'}\n                aria-label={isPlaying ? 'Pause playback' : 'Start playback'}\n                title={isPlaying ? 'Pause playback' : 'Start playback'}\n                onClick={() => setIsPlaying(!isPlaying)}\n              >\n                {isPlaying ? <Pause className=\"h-4 w-4\" /> : <Play className=\"h-4 w-4\" />}\n              </Button>\n              <Slider\n                value={[playbackSpeed]}\n                onValueChange={([value]) => setPlaybackSpeed(value)}\n                min={0.25}\n                max={4}\n                step={0.25}\n                className=\"w-24\"\n              />\n              <span className=\"text-sm text-muted-foreground\">\n                {playbackSpeed}x\n              </span>\n            </div>\n\n            {/* Stream visibility toggles */}\n            <div className=\"flex items-center gap-2 ml-auto\">\n              <Toggle\n                size=\"sm\"\n                pressed={streamVisibility.emotions}\n                onPressedChange={(pressed) => \n                  setStreamVisibility(prev => ({ ...prev, emotions: pressed }))\n                }\n              >\n                <Brain className=\"h-4 w-4 mr-1\" />\n                Emotions\n              </Toggle>\n              <Toggle\n                size=\"sm\"\n                pressed={streamVisibility.sensory}\n                onPressedChange={(pressed) => \n                  setStreamVisibility(prev => ({ ...prev, sensory: pressed }))\n                }\n              >\n                <Eye className=\"h-4 w-4 mr-1\" />\n                Sensory\n              </Toggle>\n              <Toggle\n                size=\"sm\"\n                pressed={streamVisibility.anomalies}\n                onPressedChange={(pressed) => \n                  setStreamVisibility(prev => ({ ...prev, anomalies: pressed }))\n                }\n              >\n                <AlertCircle className=\"h-4 w-4 mr-1\" />\n                Anomalies\n              </Toggle>\n            </div>\n          </div>\n\n          {/* Time range display */}\n          <div className=\"flex items-center justify-between text-sm text-muted-foreground\">\n            <span>{format(timeRange[0], 'MMM dd, yyyy HH:mm')}</span>\n            <span className=\"font-medium\">\n              {differenceInMinutes(timeRange[1], timeRange[0])} minutes\n            </span>\n            <span>{format(timeRange[1], 'MMM dd, yyyy HH:mm')}</span>\n          </div>\n        </div>\n\n        {/* Timeline visualization */}\n        <div ref={containerRef} className=\"relative bg-gray-50 rounded-lg overflow-hidden\">\n          <svg\n            ref={svgRef}\n            width={dimensions.width}\n            height={dimensions.height}\n            className=\"cursor-crosshair\"\n            onMouseDown={handleMouseDown}\n          >\n            {/* Grid lines */}\n            {gridLines}\n\n            {/* Data streams */}\n            {renderedDataStreams}\n\n            {/* Events */}\n            {renderEvents()}\n\n            {/* Brush selection */}\n            {renderBrushSelection()}\n\n            {/* Time labels */}\n            {labels}\n\n            {/* Current time indicator (for realtime mode) */}\n            {realtime && (\n              <line\n                x1={timeScale(new Date())}\n                y1={0}\n                x2={timeScale(new Date())}\n                y2={dimensions.height}\n                stroke=\"#ef4444\"\n                strokeWidth=\"2\"\n                strokeDasharray=\"4,2\"\n              />\n            )}\n          </svg>\n\n          {/* Tooltip */}\n          {hoveredEvent && (\n            <div\n              className={cn(\n                \"absolute bg-background border rounded-lg shadow-lg p-3 pointer-events-none\",\n                \"top-5\"\n              )}\n              style={{\n                left: `${Math.min(timeScale(hoveredEvent.timestamp), dimensions.width - 200)}px`\n              }}\n            >\n              <div className=\"flex items-center gap-2 mb-1\">\n                <div \n                  className={cn(\"w-3 h-3 rounded-full\")}\n                  style={{ backgroundColor: hoveredEvent.color }}\n                />\n                <span className=\"font-medium capitalize\">{hoveredEvent.type}</span>\n              </div>\n              <p className=\"text-sm\">{hoveredEvent.label}</p>\n              <p className=\"text-xs text-muted-foreground\">\n                {format(hoveredEvent.timestamp, 'MMM dd, yyyy HH:mm:ss')}\n              </p>\n              {hoveredEvent.metadata && (\n                <div className=\"mt-1 pt-1 border-t\">\n                  {Object.entries(hoveredEvent.metadata).map(([key, value]) => (\n                    <p key={key} className=\"text-xs text-muted-foreground\">\n                      {key}: {value}\n                    </p>\n                  ))}\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Legend */}\n          <div className=\"absolute bottom-4 left-4 bg-background/90 backdrop-blur-sm rounded-lg p-3 shadow-lg\">\n            <h4 className=\"font-medium text-sm mb-2\">Data Streams</h4>\n            <div className=\"space-y-1\">\n              {dataStreams.filter(s => s.visible).map(stream => (\n                <div key={stream.id} className=\"flex items-center gap-2\">\n                  <div \n                    className={cn(\"w-3 h-3 rounded-full\")}\n                    style={{ backgroundColor: stream.color }}\n                  />\n                  <span className=\"text-xs\">{stream.label}</span>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          {/* Stats */}\n          <div className=\"absolute top-4 right-4 bg-background/90 backdrop-blur-sm rounded-lg p-3 shadow-lg\">\n            <div className=\"text-xs space-y-1\">\n              <p>Events: {timelineEvents.length}</p>\n              <p>Zoom: {Math.round(zoomLevel * 100)}%</p>\n              {brushSelection && (\n                <p>Selection: {differenceInMinutes(brushSelection[1], brushSelection[0])} min</p>\n              )}\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/UniversalAnalyticsStatus.tsx","messages":[{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":66,"column":22,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":66,"endColumn":52},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Loading analytics status...\"","line":76,"column":58,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":76,"endColumn":85},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Universal Analytics Status\"","line":91,"column":42,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":93,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n            <Users className=\"h-5 w-5\" />\n            Universal Analytics Status\n          </CardTitle>","line":91,"column":42,"nodeType":"JSXText","endLine":93,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"System Status\"","line":117,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":119,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-medium\">\n              System Status\n            </span>","line":117,"column":43,"nodeType":"JSXText","endLine":119,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Students with Analytics\"","line":132,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":134,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">\n              Students with Analytics\n            </div>","line":132,"column":60,"nodeType":"JSXText","endLine":134,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Students with Data\"","line":141,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":143,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">\n              Students with Data\n            </div>","line":141,"column":60,"nodeType":"JSXText","endLine":143,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Student Details:\"","line":150,"column":71,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":150,"endColumn":87},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-medium text-sm text-muted-foreground\">Student Details:</h4>","line":150,"column":71,"nodeType":"JSXText","endLine":150,"endColumn":87},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Health:\"","line":161,"column":64,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":162,"endColumn":29},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\" className=\"text-xs\">\n                    Health: {student.healthScore}%\n                  </Badge>","line":161,"column":64,"nodeType":"JSXText","endLine":162,"endColumn":29},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Pattern Detection Active\"","line":165,"column":66,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":167,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"default\" className=\"text-xs\">\n                      Pattern Detection Active\n                    </Badge>","line":165,"column":66,"nodeType":"JSXText","endLine":167,"endColumn":21},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"✨ Universal pattern detection is active for all students!\"","line":180,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":182,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-sm font-medium\">\n                ✨ Universal pattern detection is active for all students!\n              </span>","line":180,"column":53,"nodeType":"JSXText","endLine":182,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Add your first student to see universal analytics in action. Pattern detection will start immediately!\"","line":190,"column":59,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":192,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-info-foreground text-sm\">\n              Add your first student to see universal analytics in action. Pattern detection will start immediately!\n            </div>","line":190,"column":59,"nodeType":"JSXText","endLine":192,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":20,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { RefreshCw, CheckCircle, AlertCircle, Users } from 'lucide-react';\nimport { universalAnalyticsInitializer } from '@/lib/universalAnalyticsInitializer';\nimport { analyticsManager } from '@/lib/analyticsManager';\nimport { logger } from '@/lib/logger';\n\ninterface AnalyticsStatusData {\n  isInitialized: boolean;\n  studentsWithAnalytics: number;\n  totalStudents: number;\n  studentStatuses: Array<{\n    studentId: string;\n    studentName: string;\n    isInitialized: boolean;\n    hasMinimumData: boolean;\n    healthScore: number;\n  }>;\n}\n\nexport const UniversalAnalyticsStatus = () => {\n  const [status, setStatus] = useState<AnalyticsStatusData | null>(null);\n  const [isRefreshing, setIsRefreshing] = useState(false);\n  // Ensure universal initialization on mount to cover all students, including new and mock\n  useEffect(() => {\n    // Lazy-load to avoid import cycles\n    import('@/lib/analyticsManager')\n      .then(mod => mod.ensureUniversalAnalyticsInitialization?.())\n      .catch(() => {/* noop */});\n  }, []);\n\n  const loadStatus = async () => {\n    try {\n      const initStatus = universalAnalyticsInitializer.getInitializationStatus();\n      const analyticsStatuses = analyticsManager.getAnalyticsStatus();\n      \n      setStatus({\n        isInitialized: initStatus.isInitialized,\n        studentsWithAnalytics: initStatus.studentsWithAnalytics,\n        totalStudents: initStatus.totalStudents,\n        studentStatuses: analyticsStatuses\n      });\n    } catch (error) {\n      logger.error('Error loading analytics status', { error });\n    }\n  };\n\n  const handleRefresh = async () => {\n    setIsRefreshing(true);\n    try {\n      await universalAnalyticsInitializer.forceReinitialization();\n      await loadStatus();\n    } catch (error) {\n      logger.error('Error refreshing analytics', { error });\n    } finally {\n      setIsRefreshing(false);\n    }\n  };\n\n  useEffect(() => {\n    loadStatus();\n    \n    // Auto-refresh every 30 seconds\n    const interval = setInterval(loadStatus, 30000);\n    return () => clearInterval(interval);\n  }, []);\n\n  if (!status) {\n    return (\n      <Card className=\"bg-gradient-card border-0 shadow-medium\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center justify-center\">\n            <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-primary\"></div>\n            <span className=\"ml-2 text-muted-foreground\">Loading analytics status...</span>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const allStudentsInitialized = status.studentsWithAnalytics === status.totalStudents && status.totalStudents > 0;\n  const hasStudentsWithData = status.studentStatuses.some(s => s.hasMinimumData);\n\n  return (\n    <Card className=\"bg-gradient-card border-0 shadow-medium\">\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <Users className=\"h-5 w-5\" />\n            Universal Analytics Status\n          </CardTitle>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            aria-label=\"Refresh analytics status\"\n            title=\"Refresh analytics status\"\n            onClick={handleRefresh}\n            disabled={isRefreshing}\n            className=\"h-8\"\n          >\n            <RefreshCw className={`h-4 w-4 ${isRefreshing ? 'animate-spin' : ''}`} />\n          </Button>\n        </div>\n      </CardHeader>\n      \n      <CardContent className=\"space-y-4\">\n        {/* Overall Status */}\n        <div className=\"flex items-center justify-between p-3 bg-background/50 rounded-lg\">\n          <div className=\"flex items-center gap-2\">\n            {allStudentsInitialized ? (\n              <CheckCircle className=\"h-5 w-5 text-success\" />\n            ) : (\n              <AlertCircle className=\"h-5 w-5 text-warning\" />\n            )}\n            <span className=\"font-medium\">\n              System Status\n            </span>\n          </div>\n          <Badge variant={allStudentsInitialized ? \"default\" : \"secondary\"}>\n            {allStudentsInitialized ? 'Fully Initialized' : 'Initializing'}\n          </Badge>\n        </div>\n\n        {/* Statistics */}\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div className=\"text-center p-3 bg-primary/5 rounded-lg\">\n            <div className=\"text-2xl font-bold text-primary\">\n              {status.studentsWithAnalytics}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">\n              Students with Analytics\n            </div>\n          </div>\n          \n          <div className=\"text-center p-3 bg-secondary/5 rounded-lg\">\n            <div className=\"text-2xl font-bold text-secondary\">\n              {status.studentStatuses.filter(s => s.hasMinimumData).length}\n            </div>\n            <div className=\"text-sm text-muted-foreground\">\n              Students with Data\n            </div>\n          </div>\n        </div>\n\n        {/* Student Details */}\n        {status.studentStatuses.length > 0 && (\n          <div className=\"space-y-2\">\n            <h4 className=\"font-medium text-sm text-muted-foreground\">Student Details:</h4>\n            {status.studentStatuses.map(student => (\n              <div key={student.studentId} className=\"flex items-center justify-between p-2 bg-background/30 rounded\">\n                <div className=\"flex items-center gap-2\">\n                  <div className={`w-2 h-2 rounded-full ${\n                    student.hasMinimumData ? 'bg-success' : \n                    student.isInitialized ? 'bg-warning' : 'bg-gray-400'\n                  }`} />\n                  <span className=\"text-sm font-medium\">{student.studentName}</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Badge variant=\"outline\" className=\"text-xs\">\n                    Health: {student.healthScore}%\n                  </Badge>\n                  {student.hasMinimumData && (\n                    <Badge variant=\"default\" className=\"text-xs\">\n                      Pattern Detection Active\n                    </Badge>\n                  )}\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n\n        {/* Success Message */}\n        {allStudentsInitialized && hasStudentsWithData && (\n          <div className=\"p-3 bg-success/10 border border-success/20 rounded-lg\">\n            <div className=\"flex items-center gap-2 text-success-foreground\">\n              <CheckCircle className=\"h-4 w-4\" />\n              <span className=\"text-sm font-medium\">\n                ✨ Universal pattern detection is active for all students!\n              </span>\n            </div>\n          </div>\n        )}\n\n        {/* Instructions */}\n        {status.totalStudents === 0 && (\n          <div className=\"p-3 bg-info/10 border border-info/20 rounded-lg\">\n            <div className=\"text-info-foreground text-sm\">\n              Add your first student to see universal analytics in action. Pattern detection will start immediately!\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/VirtualScrollArea.tsx","messages":[{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":236,"column":32,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":242,"endColumn":11},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":281,"column":22,"nodeType":"BinaryExpression","messageId":"noArrayIndex","endLine":281,"endColumn":48}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef, useMemo, useCallback, useEffect } from \"react\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { cn } from \"@/lib/utils\";\n\n/**\n * @fileoverview VirtualScrollArea - A performance-optimized virtual scrolling component\n * \n * Virtual scrolling is a technique where only the visible items (plus a small buffer)\n * are rendered in the DOM, while maintaining the illusion of a complete scrollable list.\n * This dramatically improves performance when dealing with large datasets.\n * \n * ## Benefits:\n * - **Reduced Memory Usage**: Only visible items are kept in the DOM\n * - **Faster Initial Render**: Rendering 20 items vs 10,000 items\n * - **Improved Scroll Performance**: Less DOM manipulation during scrolling\n * - **Scalability**: Can handle datasets with millions of items\n * \n * ## Implementation Details:\n * The component uses a \"window\" rendering technique:\n * 1. Calculates which items should be visible based on scroll position\n * 2. Renders only those items plus an overscan buffer\n * 3. Uses CSS transforms to position items correctly\n * 4. Maintains a virtual height to preserve scrollbar behavior\n * \n * ## Performance Considerations:\n * - Items must have a fixed height for accurate positioning\n * - The overscan buffer helps prevent flickering during fast scrolling\n * - Using React.memo on renderItem can further improve performance\n * \n * @module components/VirtualScrollArea\n */\n\n/**\n * A virtualized scroll area component for efficiently rendering long lists.\n *\n * This component enhances performance by rendering only the items currently visible\n * within the viewport, plus a specified number of \"overscan\" items before and after\n * the visible range. This approach minimizes the number of DOM elements, leading to\n * faster rendering and lower memory usage, which is especially beneficial for\n * applications displaying large datasets.\n *\n * It is built on top of the `@/components/ui/scroll-area` component and handles\n * the logic for calculating which items to display as the user scrolls.\n *\n * @example\n * // Basic usage with simple string items\n * ```tsx\n * const items = Array.from({ length: 1000 }, (_, i) => `Item ${i + 1}`);\n *\n * const MyListComponent = () => (\n *   <VirtualScrollArea\n *     items={items}\n *     itemHeight={40}\n *     containerHeight={400}\n *     renderItem={(item, index) => (\n *       <div key={index} className=\"leading-10 px-2.5\">\n *         {item}\n *       </div>\n *     )}\n *     className=\"border rounded-md\"\n *   />\n * );\n * ```\n * \n * @example\n * // Usage with complex objects and memoized render function\n * ```tsx\n * interface User {\n *   id: string;\n *   name: string;\n *   email: string;\n *   avatar: string;\n * }\n * \n * const users: User[] = fetchUsers(); // Your data source\n * \n * const UserListItem = React.memo<{ user: User; index: number }>(({ user, index }) => (\n *   <div className=\"flex items-center p-2 hover:bg-gray-50\">\n *     <img src={user.avatar} alt={user.name} className=\"w-10 h-10 rounded-full mr-3\" />\n *     <div>\n *       <div className=\"font-semibold\">{user.name}</div>\n *       <div className=\"text-sm text-gray-500\">{user.email}</div>\n *     </div>\n *   </div>\n * ));\n * \n * const UserList = () => (\n *   <VirtualScrollArea\n *     items={users}\n *     itemHeight={60}\n *     containerHeight={600}\n *     renderItem={(user, index) => <UserListItem key={user.id} user={user} index={index} />}\n *     overscan={10} // Increase overscan for smoother scrolling\n *   />\n * );\n * ```\n * \n * @example\n * // Usage with dynamic container height\n * ```tsx\n * const DynamicHeightList = () => {\n *   const [containerHeight, setContainerHeight] = useState(0);\n *   const containerRef = useRef<HTMLDivElement>(null);\n * \n *   useEffect(() => {\n *     const updateHeight = () => {\n *       if (containerRef.current) {\n *         setContainerHeight(containerRef.current.clientHeight);\n *       }\n *     };\n * \n *     updateHeight();\n *     window.addEventListener('resize', updateHeight);\n *     return () => window.removeEventListener('resize', updateHeight);\n *   }, []);\n * \n *   return (\n *     <div ref={containerRef} className=\"h-full\">\n *       {containerHeight > 0 && (\n *         <VirtualScrollArea\n *           items={items}\n *           itemHeight={50}\n *           containerHeight={containerHeight}\n *           renderItem={(item, index) => <ItemComponent item={item} />}\n *         />\n *       )}\n *     </div>\n *   );\n * };\n * ```\n */\ninterface VirtualScrollAreaProps<T> {\n  /**\n   * The array of items to be rendered in the list.\n   * Can be of any type, as long as `renderItem` can handle it.\n   * @type {T[]}\n   */\n  items: T[];\n  /**\n   * The fixed height of each item in the list, in pixels.\n   * This is crucial for calculating the position of virtualized items.\n   * @type {number}\n   */\n  itemHeight: number;\n  /**\n   * The total height of the scrollable container, in pixels.\n   * @type {number}\n   */\n  containerHeight: number;\n  /**\n   * A function that takes an item and its index and returns a React node to be rendered.\n   * This function is called for each visible item.\n   * @param {T} item - The item data to render.\n   * @param {number} index - The index of the item in the original `items` array.\n   * @returns {React.ReactNode} The JSX element to render for the item.\n   */\n  renderItem: (item: T, index: number) => React.ReactNode;\n  /**\n   * Optional CSS class name(s) to apply to the root `ScrollArea` component.\n   * @type {string}\n   * @default \"\"\n   */\n  className?: string;\n  /**\n   * The number of items to render outside the visible viewport, both above and below.\n   * A larger overscan can reduce flickering on fast scrolls at the cost of rendering more elements.\n   * @type {number}\n   * @default 5\n   */\n  overscan?: number;\n}\n\n/**\n * Renders a virtualized scroll area for efficiently displaying long lists.\n *\n * @template T - The type of items in the list.\n * @param {VirtualScrollAreaProps<T>} props - The props for the component.\n * @returns {React.ReactElement} The rendered virtual scroll area component.\n */\nexport function VirtualScrollArea<T>({\n  items,\n  itemHeight,\n  containerHeight,\n  renderItem,\n  className = \"\",\n  overscan = 5,\n}: VirtualScrollAreaProps<T>) {\n  const [scrollTop, setScrollTop] = useState(0);\n  const scrollElementRef = useRef<HTMLDivElement>(null);\n  const scrollTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const lastScrollTopRef = useRef(0);\n\n  // Clamp totalHeight to 0 (no negative wrapper heights when items is empty)\n  const totalHeight = Math.max(0, items.length * itemHeight);\n\n  /**\n   * Calculate visible range based on scroll position.\n   * Memoized to prevent unnecessary recalculations.\n   * \n   * @returns {Object} Object containing start and end indices of visible items\n   */\n  const visibleRange = useMemo(() => {\n    const start = Math.max(0, Math.floor(scrollTop / itemHeight) - overscan);\n    const end = Math.min(\n      items.length - 1,\n      Math.floor((scrollTop + containerHeight) / itemHeight) + overscan\n    );\n    return { start, end };\n  }, [scrollTop, itemHeight, containerHeight, items.length, overscan]);\n\n  /**\n   * Extract visible items from the full items array.\n   * Memoized to prevent unnecessary array operations.\n   * \n   * @returns {T[]} Array of items currently visible (plus overscan)\n   */\n  const visibleItems = useMemo(() => {\n    return items.slice(visibleRange.start, visibleRange.end + 1);\n  }, [items, visibleRange]);\n\n  /**\n   * Throttled scroll handler to prevent excessive state updates.\n   * Uses requestAnimationFrame for smooth scrolling performance.\n   * \n   * @param {React.UIEvent<HTMLDivElement>} event - The scroll event\n   */\n  const handleScroll = useCallback((event: React.UIEvent<HTMLDivElement>) => {\n    const currentScrollTop = event.currentTarget.scrollTop;\n    \n    // Clear existing timeout\n    if (scrollTimeoutRef.current) {\n      clearTimeout(scrollTimeoutRef.current);\n    }\n    \n    // Throttle scroll updates using requestAnimationFrame\n    scrollTimeoutRef.current = setTimeout(() => {\n      // Only update if scroll position actually changed\n      if (Math.abs(currentScrollTop - lastScrollTopRef.current) > 1) {\n        lastScrollTopRef.current = currentScrollTop;\n        setScrollTop(currentScrollTop);\n      }\n    }, 16); // ~60fps throttling\n  }, []);\n\n  /**\n   * Cleanup effect to clear timeouts on unmount.\n   * Prevents memory leaks from pending timeouts.\n   */\n  useEffect(() => {\n    return () => {\n      if (scrollTimeoutRef.current) {\n        clearTimeout(scrollTimeoutRef.current);\n      }\n    };\n  }, []);\n\n  // Generate dynamic classes for container height\n  const containerHeightClass = containerHeight ? `h-[${containerHeight}px]` : 'h-full';\n  \n  // CSS custom properties for dynamic values - follows rule 3wIMH0UDSwsNj5RYGo17Vg\n  const cssVariables = {\n    '--virtual-total-height': `${totalHeight}px`,\n    '--virtual-translate-y': `${visibleRange.start * itemHeight}px`,\n    '--virtual-item-height': `${itemHeight}px`\n  } as React.CSSProperties;\n  \n  return (\n    <ScrollArea \n      className={cn(className, \"relative\", containerHeightClass)}\n      style={cssVariables}\n    >\n      <div \n        ref={scrollElementRef}\n        onScroll={handleScroll}\n        className={cn(\"overflow-auto\", containerHeightClass)}\n      >\n        <div className=\"relative h-[var(--virtual-total-height)]\">\n          <div className=\"relative translate-y-[var(--virtual-translate-y)]\">\n            {visibleItems.map((item, index) => (\n              <div\n                key={visibleRange.start + index}\n                className=\"relative h-[var(--virtual-item-height)]\"\n              >\n                {renderItem(item, visibleRange.start + index)}\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n    </ScrollArea>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/Visualization3D.poc.stub.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/Visualization3D.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Box' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Sphere' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":48},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ZoomIn' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ZoomOut' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Move3d' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":49},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"×\"","line":59,"column":12,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":61,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'state' is defined but never used. Allowed unused args must match /^_/u.","line":88,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":88,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'correlationData' is defined but never used. Allowed unused args must match /^_/u.","line":215,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":215,"endColumn":18},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"3D Correlation Visualization\"","line":359,"column":38,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":361,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n          <Eye className=\"h-5 w-5\" />\n          3D Correlation Visualization\n        </CardTitle>","line":359,"column":38,"nodeType":"JSXText","endLine":361,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"X Axis\"","line":372,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":374,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label\n                id={xAxisLabelId}\n                className=\"text-sm font-medium mb-1 block\"\n                htmlFor={xAxisTriggerId}\n              >\n                X Axis\n              </label>","line":372,"column":16,"nodeType":"JSXText","endLine":374,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Y Axis\"","line":394,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":396,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label\n                id={yAxisLabelId}\n                className=\"text-sm font-medium mb-1 block\"\n                htmlFor={yAxisTriggerId}\n              >\n                Y Axis\n              </label>","line":394,"column":16,"nodeType":"JSXText","endLine":396,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Z Axis\"","line":416,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":418,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label\n                id={zAxisLabelId}\n                className=\"text-sm font-medium mb-1 block\"\n                htmlFor={zAxisTriggerId}\n              >\n                Z Axis\n              </label>","line":416,"column":16,"nodeType":"JSXText","endLine":418,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Color By\"","line":440,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":442,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label\n                id={colorByLabelId}\n                className=\"text-sm font-medium mb-1 block\"\n                htmlFor={colorByTriggerId}\n              >\n                Color By\n              </label>","line":440,"column":16,"nodeType":"JSXText","endLine":442,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Category\"","line":448,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":448,"endColumn":56},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"category\">Category</SelectItem>","line":448,"column":48,"nodeType":"JSXText","endLine":448,"endColumn":56},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Intensity\"","line":449,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":449,"endColumn":58},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"intensity\">Intensity</SelectItem>","line":449,"column":49,"nodeType":"JSXText","endLine":449,"endColumn":58},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Filter Category\"","line":459,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":461,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label\n                id={filterCategoryLabelId}\n                className=\"text-sm font-medium mb-1 block\"\n                htmlFor={filterCategoryTriggerId}\n              >\n                Filter Category\n              </label>","line":459,"column":16,"nodeType":"JSXText","endLine":461,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"All\"","line":467,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":467,"endColumn":46},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"all\">All</SelectItem>","line":467,"column":43,"nodeType":"JSXText","endLine":467,"endColumn":46},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotions\"","line":468,"column":47,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":468,"endColumn":55},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"emotion\">Emotions</SelectItem>","line":468,"column":47,"nodeType":"JSXText","endLine":468,"endColumn":55},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory\"","line":469,"column":47,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":469,"endColumn":54},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"sensory\">Sensory</SelectItem>","line":469,"column":47,"nodeType":"JSXText","endLine":469,"endColumn":54},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Environmental\"","line":470,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":470,"endColumn":66},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"environmental\">Environmental</SelectItem>","line":470,"column":53,"nodeType":"JSXText","endLine":470,"endColumn":66},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Point Size:\"","line":476,"column":83,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":477,"endColumn":29},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p id={pointSizeLabelId} className=\"text-sm font-medium mb-1 block\">\n                Point Size: {pointSize.toFixed(2)}\n              </p>","line":476,"column":83,"nodeType":"JSXText","endLine":477,"endColumn":29},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Reduced motion enabled\"","line":495,"column":156,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":497,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"absolute top-4 right-4 z-10 bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-200 px-3 py-1 rounded-md text-sm\">\n              Reduced motion enabled\n            </div>","line":495,"column":156,"nodeType":"JSXText","endLine":497,"endColumn":13},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":510,"column":15,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":510,"endColumn":86},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":511,"column":15,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":511,"endColumn":74},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Legend\"","line":577,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":577,"endColumn":60},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-medium text-sm mb-2\">Legend</h4>","line":577,"column":54,"nodeType":"JSXText","endLine":577,"endColumn":60},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotions\"","line":583,"column":47,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":583,"endColumn":55},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs\">Emotions</span>","line":583,"column":47,"nodeType":"JSXText","endLine":583,"endColumn":55},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory\"","line":587,"column":47,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":587,"endColumn":54},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs\">Sensory</span>","line":587,"column":47,"nodeType":"JSXText","endLine":587,"endColumn":54},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Environmental\"","line":591,"column":47,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":591,"endColumn":60},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs\">Environmental</span>","line":591,"column":47,"nodeType":"JSXText","endLine":591,"endColumn":60},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Low → High\"","line":598,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":598,"endColumn":55},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs\">Low → High</span>","line":598,"column":45,"nodeType":"JSXText","endLine":598,"endColumn":55},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Points:\"","line":606,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":606,"endColumn":26},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Points: {filteredPoints.length}</p>","line":606,"column":18,"nodeType":"JSXText","endLine":606,"endColumn":26},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Total Sessions:\"","line":607,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":607,"endColumn":34},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Total Sessions: {trackingEntries.length}</p>","line":607,"column":18,"nodeType":"JSXText","endLine":607,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":52,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useRef, useState, useMemo } from 'react';\nimport { Canvas, useFrame, useThree } from '@react-three/fiber';\nimport { OrbitControls, Text, Html, Box, Sphere } from '@react-three/drei';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { EmotionEntry, SensoryEntry, TrackingEntry } from '@/types/student';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Slider } from '@/components/ui/slider';\nimport { Eye, RotateCcw, ZoomIn, ZoomOut, Move3d } from 'lucide-react';\nimport * as THREE from 'three';\nimport { colorForeground } from '@/lib/resolveCssColorVar';\nimport { useReducedMotion } from '@/hooks/useReducedMotion';\nimport { useTranslation } from '@/hooks/useTranslation';\n\ninterface Visualization3DProps {\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  trackingEntries: TrackingEntry[];\n  correlationData?: {\n    x: string;\n    y: string;\n    z: string;\n    correlation: number;\n  }[];\n}\n\ninterface DataPoint3D {\n  id: string;\n  x: number;\n  y: number;\n  z: number;\n  label: string;\n  category: 'emotion' | 'sensory' | 'environmental';\n  intensity?: number;\n  timestamp: Date;\n  metadata: Record<string, string | number>;\n}\n\ninterface TooltipProps {\n  point: DataPoint3D;\n  onClose: () => void;\n}\n\n// Tooltip component for data points\nconst Tooltip3D: React.FC<TooltipProps> = ({ point, onClose }) => {\n  const { tAnalytics } = useTranslation();\n  \n  return (\n    <Html>\n      <div className=\"bg-background border rounded-lg shadow-lg p-3 min-w-[200px]\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <Badge variant=\"outline\" className=\"capitalize\">\n            {point.category}\n          </Badge>\n          <button \n            onClick={onClose}\n            className=\"text-muted-foreground hover:text-foreground transition-colors motion-reduce:transition-none\"\n          >\n            ×\n          </button>\n        </div>\n        <p className=\"font-medium\">{point.label}</p>\n        <div className=\"text-sm text-muted-foreground mt-1 space-y-1\">\n          <p>{tAnalytics('visualization3d.tooltip.xAxis')}: {point.x.toFixed(2)}</p>\n          <p>{tAnalytics('visualization3d.tooltip.yAxis')}: {point.y.toFixed(2)}</p>\n          <p>{tAnalytics('visualization3d.tooltip.zAxis')}: {point.z.toFixed(2)}</p>\n          {point.intensity && <p>{tAnalytics('visualization3d.tooltip.intensity')}: {point.intensity}</p>}\n        </div>\n      </div>\n    </Html>\n  );\n};\n\n// Data point component\nconst DataPoint: React.FC<{\n  position: [number, number, number];\n  color: string;\n  size: number;\n  point: DataPoint3D;\n  onHover: (point: DataPoint3D | null) => void;\n  isHighlighted: boolean;\n  reducedMotion?: boolean;\n}> = ({ position, color, size, point, onHover, isHighlighted, reducedMotion = false }) => {\n  const meshRef = useRef<THREE.Mesh>(null);\n  const [hovered, setHovered] = useState(false);\n\n  useFrame((state) => {\n    if (meshRef.current) {\n      const scale = hovered || isHighlighted ? 1.5 : 1;\n      \n      if (reducedMotion) {\n        // Instant scaling for reduced motion\n        meshRef.current.scale.set(scale, scale, scale);\n      } else {\n        // Smooth animation\n        meshRef.current.scale.lerp(new THREE.Vector3(scale, scale, scale), 0.1);\n        \n        // Only rotate on hover if motion is allowed\n        if (hovered) {\n          meshRef.current.rotation.y += 0.02;\n        }\n      }\n    }\n  });\n\n  return (\n    <mesh\n      ref={meshRef}\n      position={position}\n      onPointerOver={(e) => {\n        e.stopPropagation();\n        setHovered(true);\n        onHover(point);\n      }}\n      onPointerOut={(e) => {\n        e.stopPropagation();\n        setHovered(false);\n        onHover(null);\n      }}\n    >\n      <sphereGeometry args={[size, 32, 16]} />\n      <meshStandardMaterial \n        color={color} \n        emissive={color} \n        emissiveIntensity={hovered || isHighlighted ? 0.5 : 0.2}\n        metalness={0.3}\n        roughness={0.4}\n      />\n    </mesh>\n  );\n};\n\n// Axis labels\nconst AxisLabels: React.FC<{ xLabel: string; yLabel: string; zLabel: string }> = ({ \n  xLabel, \n  yLabel, \n  zLabel \n}) => {\n  const size = 5;\n  \n  return (\n    <>\n      {/* X Axis */}\n      <Text\n        position={[size + 0.5, 0, 0]}\n        fontSize={0.5}\n        color={colorForeground()}\n        anchorX=\"left\"\n      >\n        {xLabel}\n      </Text>\n      <mesh position={[size / 2, 0, 0]} rotation={[0, 0, Math.PI / 2]}>\n        <boxGeometry args={[0.02, size, 0.02]} />\n        <meshBasicMaterial color=\"#ff0000\" />\n      </mesh>\n\n      {/* Y Axis */}\n      <Text\n        position={[0, size + 0.5, 0]}\n        fontSize={0.5}\n        color={colorForeground()}\n        anchorX=\"center\"\n      >\n        {yLabel}\n      </Text>\n      <mesh position={[0, size / 2, 0]}>\n        <boxGeometry args={[0.02, size, 0.02]} />\n        <meshBasicMaterial color=\"#00ff00\" />\n      </mesh>\n\n      {/* Z Axis */}\n      <Text\n        position={[0, 0, size + 0.5]}\n        fontSize={0.5}\n        color={colorForeground()}\n        anchorX=\"center\"\n      >\n        {zLabel}\n      </Text>\n      <mesh position={[0, 0, size / 2]} rotation={[Math.PI / 2, 0, 0]}>\n        <boxGeometry args={[0.02, size, 0.02]} />\n        <meshBasicMaterial color=\"#0000ff\" />\n      </mesh>\n    </>\n  );\n};\n\n// Camera controls component (rendered as DOM overlay via <Html/>)\nconst CameraControls: React.FC<{ onReset: () => void }> = ({ onReset }) => {\n  const { camera } = useThree();\n  return (\n    <Html fullscreen>\n      <div className=\"absolute bottom-4 right-4 flex flex-col gap-2 pointer-events-auto\">\n        <Button\n          size=\"sm\"\n          variant=\"outline\"\n          onClick={() => {\n            camera.position.set(10, 10, 10);\n            camera.lookAt(0, 0, 0);\n            onReset();\n          }}\n        >\n          <RotateCcw className=\"h-4 w-4\" />\n        </Button>\n      </div>\n    </Html>\n  );\n};\n\nexport const Visualization3D: React.FC<Visualization3DProps> = ({\n  emotions,\n  sensoryInputs,\n  trackingEntries,\n  correlationData\n}) => {\n  const prefersReducedMotion = useReducedMotion();\n  const [hoveredPoint, setHoveredPoint] = useState<DataPoint3D | null>(null);\n  const [selectedPoint, setSelectedPoint] = useState<DataPoint3D | null>(null);\n  const [xAxis, setXAxis] = useState<string>('emotionIntensity');\n  const [yAxis, setYAxis] = useState<string>('sensoryResponse');\n  const [zAxis, setZAxis] = useState<string>('time');\n  const [colorBy, setColorBy] = useState<string>('category');\n  const [pointSize, setPointSize] = useState<number>(0.2);\n  const [filterCategory, setFilterCategory] = useState<string>('all');\n  const xAxisLabelId = React.useId();\n  const xAxisTriggerId = React.useId();\n  const yAxisLabelId = React.useId();\n  const yAxisTriggerId = React.useId();\n  const zAxisLabelId = React.useId();\n  const zAxisTriggerId = React.useId();\n  const colorByLabelId = React.useId();\n  const colorByTriggerId = React.useId();\n  const filterCategoryLabelId = React.useId();\n  const filterCategoryTriggerId = React.useId();\n  const pointSizeLabelId = React.useId();\n\n  // Process data into 3D points\n  const dataPoints = useMemo((): DataPoint3D[] => {\n    const points: DataPoint3D[] = [];\n    \n    // Create a map of timestamps to aggregate data\n    const timeMap = new Map<string, {\n      emotions: EmotionEntry[];\n      sensory: SensoryEntry[];\n      tracking: TrackingEntry;\n    }>();\n\n    // Aggregate data by timestamp\n    trackingEntries.forEach(entry => {\n      const key = entry.timestamp.toISOString();\n      const relatedEmotions = emotions.filter(e => \n        Math.abs(e.timestamp.getTime() - entry.timestamp.getTime()) < 3600000 // Within 1 hour\n      );\n      const relatedSensory = sensoryInputs.filter(s =>\n        Math.abs(s.timestamp.getTime() - entry.timestamp.getTime()) < 3600000\n      );\n      \n      timeMap.set(key, {\n        emotions: relatedEmotions,\n        sensory: relatedSensory,\n        tracking: entry\n      });\n    });\n\n    // Convert to 3D points\n    timeMap.forEach((data, key) => {\n      const avgEmotionIntensity = data.emotions.length > 0\n        ? data.emotions.reduce((sum, e) => sum + e.intensity, 0) / data.emotions.length\n        : 5;\n      \n      const sensorySeeking = data.sensory.filter(s => s.response.includes('seeking')).length;\n      const sensoryAvoiding = data.sensory.filter(s => s.response.includes('avoiding')).length;\n      const sensoryScore = sensorySeeking - sensoryAvoiding;\n      \n      const timeValue = new Date(key).getTime() / 1000 / 3600; // Convert to hours\n      \n      points.push({\n        id: `tracking-${key}`,\n        x: xAxis === 'emotionIntensity' ? avgEmotionIntensity : \n           xAxis === 'sensoryResponse' ? sensoryScore :\n           xAxis === 'time' ? timeValue : 0,\n        y: yAxis === 'emotionIntensity' ? avgEmotionIntensity :\n           yAxis === 'sensoryResponse' ? sensoryScore :\n           yAxis === 'time' ? timeValue : 0,\n        z: zAxis === 'emotionIntensity' ? avgEmotionIntensity :\n           zAxis === 'sensoryResponse' ? sensoryScore :\n           zAxis === 'time' ? timeValue : 0,\n        label: `Session ${new Date(key).toLocaleDateString()}`,\n        category: 'environmental',\n        intensity: avgEmotionIntensity,\n        timestamp: new Date(key),\n        metadata: {\n          emotions: data.emotions.length,\n          sensory: data.sensory.length,\n          avgIntensity: avgEmotionIntensity,\n          sensoryScore\n        }\n      });\n    });\n\n    // Normalize coordinates to -5 to 5 range\n    const normalize = (values: number[]) => {\n      const min = Math.min(...values);\n      const max = Math.max(...values);\n      const range = max - min || 1;\n      return values.map(v => ((v - min) / range) * 10 - 5);\n    };\n\n    const xValues = points.map(p => p.x);\n    const yValues = points.map(p => p.y);\n    const zValues = points.map(p => p.z);\n\n    const normalizedX = normalize(xValues);\n    const normalizedY = normalize(yValues);\n    const normalizedZ = normalize(zValues);\n\n    points.forEach((point, i) => {\n      point.x = normalizedX[i];\n      point.y = normalizedY[i];\n      point.z = normalizedZ[i];\n    });\n\n    return points;\n  }, [emotions, sensoryInputs, trackingEntries, xAxis, yAxis, zAxis]);\n\n  // Filter points based on category\n  const filteredPoints = useMemo(() => {\n    if (filterCategory === 'all') return dataPoints;\n    return dataPoints.filter(p => p.category === filterCategory);\n  }, [dataPoints, filterCategory]);\n\n  // Get color for data point\n  const getPointColor = (point: DataPoint3D): string => {\n    if (colorBy === 'category') {\n      switch (point.category) {\n        case 'emotion': return '#10B981';\n        case 'sensory': return '#3B82F6';\n        case 'environmental': return '#F59E0B';\n        default: return '#6B7280';\n      }\n    } else if (colorBy === 'intensity' && point.intensity) {\n      const intensity = point.intensity / 10;\n      return `hsl(${120 - intensity * 120}, 70%, 50%)`;\n    }\n    return '#6B7280';\n  };\n\n  const axisOptions = [\n    { value: 'emotionIntensity', label: 'Emotion Intensity' },\n    { value: 'sensoryResponse', label: 'Sensory Response' },\n    { value: 'time', label: 'Time' }\n  ];\n\n  return (\n    <Card className=\"w-full\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Eye className=\"h-5 w-5\" />\n          3D Correlation Visualization\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        {/* Controls */}\n        <div className=\"mb-4 space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div>\n              <label\n                id={xAxisLabelId}\n                className=\"text-sm font-medium mb-1 block\"\n                htmlFor={xAxisTriggerId}\n              >\n                X Axis\n              </label>\n              <Select value={xAxis} onValueChange={setXAxis}>\n                <SelectTrigger id={xAxisTriggerId} aria-labelledby={xAxisLabelId}>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {axisOptions.map(opt => (\n                    <SelectItem key={opt.value} value={opt.value}>\n                      {opt.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            \n            <div>\n              <label\n                id={yAxisLabelId}\n                className=\"text-sm font-medium mb-1 block\"\n                htmlFor={yAxisTriggerId}\n              >\n                Y Axis\n              </label>\n              <Select value={yAxis} onValueChange={setYAxis}>\n                <SelectTrigger id={yAxisTriggerId} aria-labelledby={yAxisLabelId}>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {axisOptions.map(opt => (\n                    <SelectItem key={opt.value} value={opt.value}>\n                      {opt.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            \n            <div>\n              <label\n                id={zAxisLabelId}\n                className=\"text-sm font-medium mb-1 block\"\n                htmlFor={zAxisTriggerId}\n              >\n                Z Axis\n              </label>\n              <Select value={zAxis} onValueChange={setZAxis}>\n                <SelectTrigger id={zAxisTriggerId} aria-labelledby={zAxisLabelId}>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {axisOptions.map(opt => (\n                    <SelectItem key={opt.value} value={opt.value}>\n                      {opt.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div>\n              <label\n                id={colorByLabelId}\n                className=\"text-sm font-medium mb-1 block\"\n                htmlFor={colorByTriggerId}\n              >\n                Color By\n              </label>\n              <Select value={colorBy} onValueChange={setColorBy}>\n                <SelectTrigger id={colorByTriggerId} aria-labelledby={colorByLabelId}>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"category\">Category</SelectItem>\n                  <SelectItem value=\"intensity\">Intensity</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            \n            <div>\n              <label\n                id={filterCategoryLabelId}\n                className=\"text-sm font-medium mb-1 block\"\n                htmlFor={filterCategoryTriggerId}\n              >\n                Filter Category\n              </label>\n              <Select value={filterCategory} onValueChange={setFilterCategory}>\n                <SelectTrigger id={filterCategoryTriggerId} aria-labelledby={filterCategoryLabelId}>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">All</SelectItem>\n                  <SelectItem value=\"emotion\">Emotions</SelectItem>\n                  <SelectItem value=\"sensory\">Sensory</SelectItem>\n                  <SelectItem value=\"environmental\">Environmental</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            \n            <div>\n              <p id={pointSizeLabelId} className=\"text-sm font-medium mb-1 block\">\n                Point Size: {pointSize.toFixed(2)}\n              </p>\n              <Slider\n                value={[pointSize]}\n                onValueChange={([value]) => setPointSize(value)}\n                min={0.1}\n                max={0.5}\n                step={0.05}\n                className=\"mt-2\"\n                aria-labelledby={pointSizeLabelId}\n              />\n            </div>\n          </div>\n        </div>\n\n        {/* 3D Visualization */}\n        <div className=\"relative w-full h-[600px] bg-gray-50 rounded-lg overflow-hidden\">\n          {prefersReducedMotion && (\n            <div className=\"absolute top-4 right-4 z-10 bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-200 px-3 py-1 rounded-md text-sm\">\n              Reduced motion enabled\n            </div>\n          )}\n          <Canvas\n            camera={{ position: [10, 10, 10], fov: 50 }}\n            className=\"w-full h-full\"\n            onCreated={({ gl }) => {\n              const canvas = gl.domElement;\n              const onLost = (e: Event) => {\n                e.preventDefault();\n              };\n              const onRestored = () => {\n                // no-op: react-three-fiber re-renders; keep minimal\n              };\n              canvas.addEventListener('webglcontextlost', onLost, { passive: false });\n              canvas.addEventListener('webglcontextrestored', onRestored);\n            }}\n          >\n            <ambientLight intensity={0.5} />\n            <pointLight position={[10, 10, 10]} />\n            <pointLight position={[-10, -10, -10]} intensity={0.5} />\n            \n            {/* Grid helper */}\n            <gridHelper args={[20, 20, 0x888888, 0xcccccc]} />\n            \n            {/* Axes */}\n            <AxisLabels \n              xLabel={axisOptions.find(o => o.value === xAxis)?.label || ''}\n              yLabel={axisOptions.find(o => o.value === yAxis)?.label || ''}\n              zLabel={axisOptions.find(o => o.value === zAxis)?.label || ''}\n            />\n            \n            {/* Data points */}\n            {filteredPoints.map((point) => (\n              <DataPoint\n                key={point.id}\n                position={[point.x, point.y, point.z]}\n                color={getPointColor(point)}\n                size={pointSize}\n                point={point}\n                onHover={setHoveredPoint}\n                isHighlighted={selectedPoint?.id === point.id}\n                reducedMotion={prefersReducedMotion}\n              />\n            ))}\n            \n            {/* Tooltip */}\n            {hoveredPoint && !selectedPoint && (\n              <Tooltip3D \n                point={hoveredPoint} \n                onClose={() => setHoveredPoint(null)} \n              />\n            )}\n            \n            {/* Selected point tooltip */}\n            {selectedPoint && (\n              <Tooltip3D \n                point={selectedPoint} \n                onClose={() => setSelectedPoint(null)} \n              />\n            )}\n            \n            {/* Controls */}\n            <OrbitControls \n              enableDamping={!prefersReducedMotion}\n              dampingFactor={prefersReducedMotion ? 0 : 0.05}\n              enablePan\n              panSpeed={0.5}\n              rotateSpeed={prefersReducedMotion ? 0.3 : 0.5}\n              zoomSpeed={0.5}\n              minDistance={5}\n              maxDistance={50}\n            />\n            \n            <CameraControls onReset={() => {\n              setHoveredPoint(null);\n              setSelectedPoint(null);\n            }} />\n          </Canvas>\n          \n        <div className=\"absolute top-4 left-4 bg-background/90 backdrop-blur-sm rounded-lg p-3 shadow-lg\">\n            <h4 className=\"font-medium text-sm mb-2\">Legend</h4>\n            <div className=\"space-y-1\">\n              {colorBy === 'category' && (\n                <>\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"w-3 h-3 rounded-full bg-[#10B981]\" />\n                    <span className=\"text-xs\">Emotions</span>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"w-3 h-3 rounded-full bg-[#3B82F6]\" />\n                    <span className=\"text-xs\">Sensory</span>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"w-3 h-3 rounded-full bg-[#F59E0B]\" />\n                    <span className=\"text-xs\">Environmental</span>\n                  </div>\n                </>\n              )}\n              {colorBy === 'intensity' && (\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-20 h-3 bg-gradient-to-r from-green-500 via-yellow-500 to-red-500 rounded\" />\n                  <span className=\"text-xs\">Low → High</span>\n                </div>\n              )}\n            </div>\n          </div>\n          \n          <div className=\"absolute bottom-4 left-4 bg-background/90 backdrop-blur-sm rounded-lg p-3 shadow-lg\">\n            <div className=\"text-xs space-y-1\">\n              <p>Points: {filteredPoints.length}</p>\n              <p>Total Sessions: {trackingEntries.length}</p>\n            </div>\n          </div>\n        </div>\n        </CardContent>\n      </Card>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/VisualizationControls.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Interactive Data Analysis -\"","line":106,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":107,"endColumn":39},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n          <Activity className=\"h-5 w-5\" />\n          Interactive Data Analysis - {studentName}\n          {filterCriteria.realtime && (\n            <Badge variant=\"default\" className=\"animate-pulse ml-2\">\n              <Wifi className=\"h-3 w-3 mr-1\" />\n              Live\n            </Badge>\n          )}\n        </CardTitle>","line":106,"column":43,"nodeType":"JSXText","endLine":107,"endColumn":39},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Live\"","line":110,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":112,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"default\" className=\"animate-pulse ml-2\">\n              <Wifi className=\"h-3 w-3 mr-1\" />\n              Live\n            </Badge>","line":110,"column":48,"nodeType":"JSXText","endLine":112,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Filters\"","line":153,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":155,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button variant=\"outline\" size=\"sm\" aria-label=\"Open filters panel\" title=\"Open filters panel\">\n                <Filter className=\"h-4 w-4 mr-2\" />\n                Filters\n                {Object.keys(filterCriteria).filter(k =>\n                  JSON.stringify(filterCriteria[k as keyof typeof filterCriteria]) !==\n                  JSON.stringify({\n                    dateRange: { start: null, end: null },\n                    emotions: { types: [], intensityRange: [0, 10], includeTriggers: [], excludeTriggers: [] },\n                    sensory: { types: [], responses: [], intensityRange: [0, 10] },\n                    environmental: {\n                      locations: [],\n                      activities: [],\n                      conditions: { noiseLevel: [0, 10], temperature: [15, 30], lighting: [] },\n                      weather: [],\n                      timeOfDay: []\n                    },\n                    patterns: { anomaliesOnly: false, minConfidence: 0, patternTypes: [] },\n                    realtime: false\n                  }[k as keyof typeof filterCriteria])\n                ).length > 0 && (\n                  <Badge variant=\"default\" className=\"ml-1\">\n                    Active\n                  </Badge>\n                )}\n              </Button>","line":153,"column":52,"nodeType":"JSXText","endLine":155,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Active\"","line":172,"column":61,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":174,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"default\" className=\"ml-1\">\n                    Active\n                  </Badge>","line":172,"column":61,"nodeType":"JSXText","endLine":174,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Advanced Filters\"","line":180,"column":29,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":180,"endColumn":45},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SheetTitle>Advanced Filters</SheetTitle>","line":180,"column":29,"nodeType":"JSXText","endLine":180,"endColumn":45},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Configure multi-dimensional filters for your data analysis\"","line":181,"column":35,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":183,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SheetDescription>\n                  Configure multi-dimensional filters for your data analysis\n                </SheetDescription>","line":181,"column":35,"nodeType":"JSXText","endLine":183,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Layout\"","line":208,"column":86,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":210,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n                variant=\"outline\"\n                size=\"sm\"\n                aria-label=\"Select layout mode\"\n                title=\"Select layout mode\"\n                data-testid=\"layout-mode-trigger\"\n              >\n                {layoutMode === 'grid' && <Grid3x3 className=\"h-4 w-4 mr-2\" />}\n                {layoutMode === 'focus' && <Focus className=\"h-4 w-4 mr-2\" />}\n                {layoutMode === 'comparison' && <Columns className=\"h-4 w-4 mr-2\" />}\n                {layoutMode === 'dashboard' && <Activity className=\"h-4 w-4 mr-2\" />}\n                Layout\n              </Button>","line":208,"column":86,"nodeType":"JSXText","endLine":210,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Dashboard\"","line":214,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":216,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DropdownMenuItem onClick={() => setLayoutMode('dashboard')}>\n                <Activity className=\"h-4 w-4 mr-2\" />\n                Dashboard\n              </DropdownMenuItem>","line":214,"column":54,"nodeType":"JSXText","endLine":216,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Grid View\"","line":218,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":220,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DropdownMenuItem onClick={() => setLayoutMode('grid')}>\n                <Grid3x3 className=\"h-4 w-4 mr-2\" />\n                Grid View\n              </DropdownMenuItem>","line":218,"column":53,"nodeType":"JSXText","endLine":220,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Focus Mode\"","line":222,"column":51,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":224,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DropdownMenuItem onClick={() => setLayoutMode('focus')}>\n                <Focus className=\"h-4 w-4 mr-2\" />\n                Focus Mode\n              </DropdownMenuItem>","line":222,"column":51,"nodeType":"JSXText","endLine":224,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Comparison\"","line":226,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":228,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DropdownMenuItem onClick={() => setLayoutMode('comparison')}>\n                <Columns className=\"h-4 w-4 mr-2\" />\n                Comparison\n              </DropdownMenuItem>","line":226,"column":53,"nodeType":"JSXText","endLine":228,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"View\"","line":235,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":237,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button variant=\"outline\" size=\"sm\" aria-label=\"View options\" title=\"View options\">\n                <Settings className=\"h-4 w-4 mr-2\" />\n                View\n              </Button>","line":235,"column":54,"nodeType":"JSXText","endLine":237,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"2D: Emotional energy vs Sensory load (XY)\"","line":246,"column":97,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":246,"endColumn":138},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DropdownMenuItem onClick={() => visualizationState.setProjectionPlane('xy')}>2D: Emotional energy vs Sensory load (XY)</DropdownMenuItem>","line":246,"column":97,"nodeType":"JSXText","endLine":246,"endColumn":138},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"2D: Emotional energy vs Time (XZ)\"","line":247,"column":97,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":247,"endColumn":130},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DropdownMenuItem onClick={() => visualizationState.setProjectionPlane('xz')}>2D: Emotional energy vs Time (XZ)</DropdownMenuItem>","line":247,"column":97,"nodeType":"JSXText","endLine":247,"endColumn":130},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"2D: Sensory load vs Time (YZ)\"","line":248,"column":97,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":248,"endColumn":126},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DropdownMenuItem onClick={() => visualizationState.setProjectionPlane('yz')}>2D: Sensory load vs Time (YZ)</DropdownMenuItem>","line":248,"column":97,"nodeType":"JSXText","endLine":248,"endColumn":126},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Picture-in-Picture\"","line":260,"column":63,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":262,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DropdownMenuItem onClick={togglePictureInPicture}>\n                <PictureInPicture2 className=\"h-4 w-4 mr-2\" />\n                Picture-in-Picture\n              </DropdownMenuItem>","line":260,"column":63,"nodeType":"JSXText","endLine":262,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Clear Highlights\"","line":267,"column":55,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":269,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DropdownMenuItem onClick={() => {\n                setHighlightState({ type: null, id: null, relatedIds: [] });\n              }}>\n                <RefreshCw className=\"h-4 w-4 mr-2\" />\n                Clear Highlights\n              </DropdownMenuItem>","line":267,"column":55,"nodeType":"JSXText","endLine":269,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Export as PDF\"","line":285,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":287,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DropdownMenuItem\n                onClick={() => handleExport('pdf')}\n                disabled={isExporting}\n              >\n                <FileText className=\"h-4 w-4 mr-2\" />\n                Export as PDF\n              </DropdownMenuItem>","line":285,"column":54,"nodeType":"JSXText","endLine":287,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Export as CSV\"","line":292,"column":61,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":294,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DropdownMenuItem\n                onClick={() => handleExport('csv')}\n                disabled={isExporting}\n              >\n                <FileSpreadsheet className=\"h-4 w-4 mr-2\" />\n                Export as CSV\n              </DropdownMenuItem>","line":292,"column":61,"nodeType":"JSXText","endLine":294,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Export as JSON\"","line":299,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":301,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DropdownMenuItem\n                onClick={() => handleExport('json')}\n                disabled={isExporting}\n              >\n                <FileJson className=\"h-4 w-4 mr-2\" />\n                Export as JSON\n              </DropdownMenuItem>","line":299,"column":54,"nodeType":"JSXText","endLine":301,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Chart Type\"","line":313,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":315,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label\n              id={chartTypeLabelId}\n              className=\"text-sm font-medium\"\n              htmlFor={chartTypeTriggerId}\n            >\n              Chart Type\n            </label>","line":313,"column":14,"nodeType":"JSXText","endLine":315,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Line Chart\"","line":321,"column":42,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":321,"endColumn":52},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"line\">Line Chart</SelectItem>","line":321,"column":42,"nodeType":"JSXText","endLine":321,"endColumn":52},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Area Chart\"","line":322,"column":42,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":322,"endColumn":52},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"area\">Area Chart</SelectItem>","line":322,"column":42,"nodeType":"JSXText","endLine":322,"endColumn":52},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Scatter Plot\"","line":323,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":323,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"scatter\">Scatter Plot</SelectItem>","line":323,"column":45,"nodeType":"JSXText","endLine":323,"endColumn":57},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Combined\"","line":324,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":324,"endColumn":54},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"composed\">Combined</SelectItem>","line":324,"column":46,"nodeType":"JSXText","endLine":324,"endColumn":54},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Select Emotions\"","line":330,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":330,"endColumn":63},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm font-medium\">Select Emotions</p>","line":330,"column":48,"nodeType":"JSXText","endLine":330,"endColumn":63},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Time Range\"","line":358,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":360,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label\n              id={timeRangeLabelId}\n              className=\"text-sm font-medium\"\n              htmlFor={timeRangeTriggerId}\n            >\n              Time Range\n            </label>","line":358,"column":14,"nodeType":"JSXText","endLine":360,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Last 7 days\"","line":366,"column":40,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":366,"endColumn":51},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"7d\">Last 7 days</SelectItem>","line":366,"column":40,"nodeType":"JSXText","endLine":366,"endColumn":51},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Last 30 days\"","line":367,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":367,"endColumn":53},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"30d\">Last 30 days</SelectItem>","line":367,"column":41,"nodeType":"JSXText","endLine":367,"endColumn":53},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Last 90 days\"","line":368,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":368,"endColumn":53},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"90d\">Last 90 days</SelectItem>","line":368,"column":41,"nodeType":"JSXText","endLine":368,"endColumn":53},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"All time\"","line":369,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":369,"endColumn":49},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"all\">All time</SelectItem>","line":369,"column":41,"nodeType":"JSXText","endLine":369,"endColumn":49},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"emotions\"","line":376,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":377,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\" className=\"bg-success/10 text-success border-success/20\">\n              {filteredData.emotions.length} emotions\n            </Badge>","line":376,"column":45,"nodeType":"JSXText","endLine":377,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"sensory inputs\"","line":379,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":380,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\" className=\"bg-info/10 text-info border-info/20\">\n              {filteredData.sensoryInputs.length} sensory inputs\n            </Badge>","line":379,"column":50,"nodeType":"JSXText","endLine":380,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"sessions\"","line":382,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":383,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\" className=\"bg-primary/10 text-primary border-primary/20\">\n              {filteredData.trackingEntries.length} sessions\n            </Badge>","line":382,"column":52,"nodeType":"JSXText","endLine":383,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"new\"","line":386,"column":44,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":387,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"default\" className=\"bg-warning/80 text-warning-foreground\">\n                {realtimeData.newDataCount} new\n              </Badge>","line":386,"column":44,"nodeType":"JSXText","endLine":387,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":70,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Sheet, SheetContent, SheetDescription, SheetHeader, SheetTitle, SheetTrigger } from '@/components/ui/sheet';\nimport { Toggle } from '@/components/ui/toggle';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSeparator,\n} from '@/components/ui/dropdown-menu';\nimport {\n  Activity,\n  Filter,\n  Grid3x3,\n  Focus,\n  Columns,\n  Settings,\n  Maximize2,\n  PictureInPicture2,\n  RefreshCw,\n  Download,\n  FileText,\n  FileSpreadsheet,\n  FileJson,\n  Wifi,\n} from 'lucide-react';\nimport { AdvancedFilterPanel } from './AdvancedFilterPanel';\nimport { useVisualizationState, ChartType, TimeRange, VisualizationType } from '@/hooks/useVisualizationState';\nimport { EmotionEntry, SensoryEntry, TrackingEntry } from '@/types/student';\nimport { ExportFormat } from '@/lib/analyticsExport';\n\ninterface VisualizationControlsProps {\n  studentName: string;\n  isExporting: boolean;\n  availableEmotions: string[];\n  filteredData: {\n    emotions: EmotionEntry[];\n    sensoryInputs: SensoryEntry[];\n    trackingEntries: TrackingEntry[];\n  };\n  realtimeData: {\n    newDataCount: number;\n  };\n\n  // State and setters from useVisualizationState\n  visualizationState: ReturnType<typeof useVisualizationState>;\n\n  // Handlers\n  toggleFullscreen: () => void;\n  togglePictureInPicture: () => void;\n  handleExport: (format: ExportFormat) => void;\n}\n\nexport const VisualizationControls: React.FC<VisualizationControlsProps> = ({\n  studentName,\n  isExporting,\n  availableEmotions,\n  filteredData,\n  realtimeData,\n  visualizationState,\n  toggleFullscreen,\n  togglePictureInPicture,\n  handleExport,\n}) => {\n  const {\n    selectedChartType,\n    setSelectedChartType,\n    selectedTimeRange,\n    setSelectedTimeRange,\n    selectedEmotions,\n    setSelectedEmotions,\n    layoutMode,\n    setLayoutMode,\n    focusedVisualization,\n    setFocusedVisualization,\n    isFullscreen,\n    showFilterPanel,\n    setShowFilterPanel,\n    selectedVisualizations,\n    setSelectedVisualizations,\n    setHighlightState,\n    filterCriteria,\n    setFilterCriteria,\n  } = visualizationState;\n\n  const motionPrefersReduced = typeof window !== 'undefined' && window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n  if (motionPrefersReduced && !visualizationState.motionSafe) {\n    visualizationState.setMotionSafe(true);\n    visualizationState.setProjectionMode('2d');\n  }\n\n  const chartTypeLabelId = React.useId();\n  const chartTypeTriggerId = React.useId();\n  const timeRangeLabelId = React.useId();\n  const timeRangeTriggerId = React.useId();\n\n  return (\n    <Card>\n      <CardHeader className=\"flex flex-row items-center justify-between\">\n        <CardTitle className=\"flex items-center gap-2\">\n          <Activity className=\"h-5 w-5\" />\n          Interactive Data Analysis - {studentName}\n          {filterCriteria.realtime && (\n            <Badge variant=\"default\" className=\"animate-pulse ml-2\">\n              <Wifi className=\"h-3 w-3 mr-1\" />\n              Live\n            </Badge>\n          )}\n        </CardTitle>\n        <div className=\"flex items-center gap-2\" aria-label=\"Visualization controls\">\n          {/* Guided question chips */}\n          <div className=\"hidden md:flex items-center gap-2 mr-2\">\n            {[\n              { id: 'peaks', label: 'When do peaks happen?' },\n              { id: 'load_by_activity', label: 'Which activities raise load?' },\n              { id: 'calming', label: 'What calms fastest?' },\n            ].map((p) => (\n              <Button\n                key={p.id}\n                variant={visualizationState.activePreset === p.id ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={() => {\n                  visualizationState.setActivePreset(p.id);\n                  // Simple preset effects (MVP)\n                  if (p.id === 'peaks') {\n                    setSelectedTimeRange('30d');\n                    setSelectedChartType('scatter');\n                    setFilterCriteria({\n                      ...filterCriteria,\n                      patterns: { ...filterCriteria.patterns, minConfidence: 0.6 },\n                    });\n                    setFocusedVisualization('trends');\n                  } else if (p.id === 'calming') {\n                    setSelectedTimeRange('7d');\n                    setSelectedChartType('line');\n                    setFocusedVisualization('timeline');\n                  }\n                }}\n              >\n                {p.label}\n              </Button>\n            ))}\n          </div>\n\n          <Sheet open={showFilterPanel} onOpenChange={setShowFilterPanel}>\n            <SheetTrigger asChild>\n              <Button variant=\"outline\" size=\"sm\" aria-label=\"Open filters panel\" title=\"Open filters panel\">\n                <Filter className=\"h-4 w-4 mr-2\" />\n                Filters\n                {Object.keys(filterCriteria).filter(k =>\n                  JSON.stringify(filterCriteria[k as keyof typeof filterCriteria]) !==\n                  JSON.stringify({\n                    dateRange: { start: null, end: null },\n                    emotions: { types: [], intensityRange: [0, 10], includeTriggers: [], excludeTriggers: [] },\n                    sensory: { types: [], responses: [], intensityRange: [0, 10] },\n                    environmental: {\n                      locations: [],\n                      activities: [],\n                      conditions: { noiseLevel: [0, 10], temperature: [15, 30], lighting: [] },\n                      weather: [],\n                      timeOfDay: []\n                    },\n                    patterns: { anomaliesOnly: false, minConfidence: 0, patternTypes: [] },\n                    realtime: false\n                  }[k as keyof typeof filterCriteria])\n                ).length > 0 && (\n                  <Badge variant=\"default\" className=\"ml-1\">\n                    Active\n                  </Badge>\n                )}\n              </Button>\n            </SheetTrigger>\n            <SheetContent side=\"right\" className=\"w-[400px] sm:w-[540px]\">\n              <SheetHeader>\n                <SheetTitle>Advanced Filters</SheetTitle>\n                <SheetDescription>\n                  Configure multi-dimensional filters for your data analysis\n                </SheetDescription>\n              </SheetHeader>\n              <div className=\"mt-6\">\n                <AdvancedFilterPanel\n                  emotions={filteredData.emotions}\n                  sensoryInputs={filteredData.sensoryInputs}\n                  trackingEntries={filteredData.trackingEntries}\n                  onFilterChange={setFilterCriteria}\n                />\n              </div>\n            </SheetContent>\n          </Sheet>\n\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                aria-label=\"Select layout mode\"\n                title=\"Select layout mode\"\n                data-testid=\"layout-mode-trigger\"\n              >\n                {layoutMode === 'grid' && <Grid3x3 className=\"h-4 w-4 mr-2\" />}\n                {layoutMode === 'focus' && <Focus className=\"h-4 w-4 mr-2\" />}\n                {layoutMode === 'comparison' && <Columns className=\"h-4 w-4 mr-2\" />}\n                {layoutMode === 'dashboard' && <Activity className=\"h-4 w-4 mr-2\" />}\n                Layout\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\">\n              <DropdownMenuItem onClick={() => setLayoutMode('dashboard')}>\n                <Activity className=\"h-4 w-4 mr-2\" />\n                Dashboard\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => setLayoutMode('grid')}>\n                <Grid3x3 className=\"h-4 w-4 mr-2\" />\n                Grid View\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => setLayoutMode('focus')}>\n                <Focus className=\"h-4 w-4 mr-2\" />\n                Focus Mode\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={() => setLayoutMode('comparison')}>\n                <Columns className=\"h-4 w-4 mr-2\" />\n                Comparison\n              </DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button variant=\"outline\" size=\"sm\" aria-label=\"View options\" title=\"View options\">\n                <Settings className=\"h-4 w-4 mr-2\" />\n                View\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\">\n              <DropdownMenuItem onClick={() => visualizationState.setProjectionMode(visualizationState.projectionMode === '3d' ? '2d' : '3d')}>\n                {visualizationState.projectionMode === '3d' ? 'Switch to 2D' : 'Switch to 3D'}\n              </DropdownMenuItem>\n              {visualizationState.projectionMode === '2d' && (\n                <>\n                  <DropdownMenuSeparator />\n                  <DropdownMenuItem onClick={() => visualizationState.setProjectionPlane('xy')}>2D: Emotional energy vs Sensory load (XY)</DropdownMenuItem>\n                  <DropdownMenuItem onClick={() => visualizationState.setProjectionPlane('xz')}>2D: Emotional energy vs Time (XZ)</DropdownMenuItem>\n                  <DropdownMenuItem onClick={() => visualizationState.setProjectionPlane('yz')}>2D: Sensory load vs Time (YZ)</DropdownMenuItem>\n                </>\n              )}\n              <DropdownMenuSeparator />\n              <DropdownMenuItem onClick={() => visualizationState.setMotionSafe(!visualizationState.motionSafe)}>\n                {visualizationState.motionSafe ? 'Disable motion-safe' : 'Enable motion-safe'}\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={toggleFullscreen}>\n                <Maximize2 className=\"h-4 w-4 mr-2\" />\n                {isFullscreen ? 'Exit Fullscreen' : 'Fullscreen'}\n              </DropdownMenuItem>\n              <DropdownMenuItem onClick={togglePictureInPicture}>\n                <PictureInPicture2 className=\"h-4 w-4 mr-2\" />\n                Picture-in-Picture\n              </DropdownMenuItem>\n              <DropdownMenuSeparator />\n              <DropdownMenuItem onClick={() => {\n                setHighlightState({ type: null, id: null, relatedIds: [] });\n              }}>\n                <RefreshCw className=\"h-4 w-4 mr-2\" />\n                Clear Highlights\n              </DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button variant=\"outline\" size=\"sm\" disabled={isExporting} aria-label=\"Export analytics\" title=\"Export analytics\">\n                <Download className=\"h-4 w-4 mr-2\" />\n                {isExporting ? 'Exporting...' : 'Export'}\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\">\n              <DropdownMenuItem\n                onClick={() => handleExport('pdf')}\n                disabled={isExporting}\n              >\n                <FileText className=\"h-4 w-4 mr-2\" />\n                Export as PDF\n              </DropdownMenuItem>\n              <DropdownMenuItem\n                onClick={() => handleExport('csv')}\n                disabled={isExporting}\n              >\n                <FileSpreadsheet className=\"h-4 w-4 mr-2\" />\n                Export as CSV\n              </DropdownMenuItem>\n              <DropdownMenuItem\n                onClick={() => handleExport('json')}\n                disabled={isExporting}\n              >\n                <FileJson className=\"h-4 w-4 mr-2\" />\n                Export as JSON\n              </DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex flex-wrap gap-4\">\n          <div className=\"space-y-2\">\n            <label\n              id={chartTypeLabelId}\n              className=\"text-sm font-medium\"\n              htmlFor={chartTypeTriggerId}\n            >\n              Chart Type\n            </label>\n            <Select value={selectedChartType} onValueChange={(value: ChartType) => setSelectedChartType(value)}>\n              <SelectTrigger id={chartTypeTriggerId} className=\"w-32\" aria-labelledby={chartTypeLabelId}>\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"line\">Line Chart</SelectItem>\n                <SelectItem value=\"area\">Area Chart</SelectItem>\n                <SelectItem value=\"scatter\">Scatter Plot</SelectItem>\n                <SelectItem value=\"composed\">Combined</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"space-y-2\">\n            <p className=\"text-sm font-medium\">Select Emotions</p>\n            <div className=\"grid grid-cols-2 gap-2 w-64 p-2 border rounded-md\">\n              {availableEmotions.map(emotion => {\n                const checked = selectedEmotions.includes(emotion);\n                return (\n                  <label key={emotion} className=\"flex items-center gap-2 text-sm\">\n                    <Checkbox\n                      checked={checked}\n                      onCheckedChange={(v) => {\n                        const isChecked = Boolean(v);\n                        setSelectedEmotions(prev =>\n                          isChecked ? [...prev, emotion] : prev.filter(e => e !== emotion)\n                        );\n                      }}\n                      aria-label={`Toggle ${emotion}`}\n                    />\n                    <span className=\"capitalize\">{emotion}</span>\n                  </label>\n                );\n              })}\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            <label\n              id={timeRangeLabelId}\n              className=\"text-sm font-medium\"\n              htmlFor={timeRangeTriggerId}\n            >\n              Time Range\n            </label>\n            <Select value={selectedTimeRange} onValueChange={(value: TimeRange) => setSelectedTimeRange(value)}>\n              <SelectTrigger id={timeRangeTriggerId} className=\"w-32\" aria-labelledby={timeRangeLabelId}>\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"7d\">Last 7 days</SelectItem>\n                <SelectItem value=\"30d\">Last 30 days</SelectItem>\n                <SelectItem value=\"90d\">Last 90 days</SelectItem>\n                <SelectItem value=\"all\">All time</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"flex items-center gap-2 mt-8\" aria-label=\"Data counts\">\n            <Badge variant=\"outline\" className=\"bg-success/10 text-success border-success/20\">\n              {filteredData.emotions.length} emotions\n            </Badge>\n            <Badge variant=\"outline\" className=\"bg-info/10 text-info border-info/20\">\n              {filteredData.sensoryInputs.length} sensory inputs\n            </Badge>\n            <Badge variant=\"outline\" className=\"bg-primary/10 text-primary border-primary/20\">\n              {filteredData.trackingEntries.length} sessions\n            </Badge>\n            {filterCriteria.realtime && (\n              <Badge variant=\"default\" className=\"bg-warning/80 text-warning-foreground\">\n                {realtimeData.newDataCount} new\n              </Badge>\n            )}\n          </div>\n        </div>\n\n        {layoutMode === 'focus' && (\n          <div className=\"mt-4 flex gap-2\">\n            {(['trends', 'correlations', 'patterns', '3d', 'timeline'] as VisualizationType[]).map(type => (\n              <Toggle\n                key={type}\n                size=\"sm\"\n                pressed={focusedVisualization === type}\n                onPressedChange={() => setFocusedVisualization(focusedVisualization === type ? null : type)}\n                className=\"capitalize\"\n              >\n                {type === '3d' ? '3D View' : type}\n              </Toggle>\n            ))}\n          </div>\n        )}\n\n        {(layoutMode === 'grid' || layoutMode === 'comparison') && (\n          <div className=\"mt-4 flex gap-2\">\n            {(['trends', 'correlations', 'patterns', '3d', 'timeline'] as VisualizationType[]).map(type => (\n              <Toggle\n                key={type}\n                size=\"sm\"\n                pressed={selectedVisualizations.includes(type)}\n                onPressedChange={(pressed) => {\n                  if (pressed) {\n                    setSelectedVisualizations([...selectedVisualizations, type]);\n                  } else {\n                    setSelectedVisualizations(selectedVisualizations.filter(v => v !== type));\n                  }\n                }}\n                className=\"capitalize\"\n              >\n                {type === '3d' ? '3D View' : type}\n              </Toggle>\n            ))}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/__tests__/AnalyticsDashboard.tabs.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[952,955],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[952,955],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1648,1651],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1648,1651],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1795,1798],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1795,1798],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2210,2213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2210,2213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'panel' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":147,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":147,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { describe, test, expect, vi, beforeEach } from 'vitest';\nimport { MemoryRouter } from 'react-router-dom';\nimport { render, screen, waitFor } from '@testing-library/react';\nimport userEvent from '@testing-library/user-event';\nimport { AnalyticsDashboard } from '@/components/AnalyticsDashboard';\n\n// Minimal stubs and providers\nvi.mock('@/hooks/useTranslation', () => ({\n  useTranslation: () => ({\n    tCommon: (k: string) => k,\n    tStudent: (k: string) => k,\n    tAnalytics: (k: string) => k,\n  }),\n}));\n\nvi.mock('@/hooks/useAnalyticsWorker', () => ({\n  useAnalyticsWorker: () => ({\n    results: { patterns: [], correlations: [], insights: [] },\n    isAnalyzing: false,\n    error: null,\n    runAnalysis: vi.fn(),\n    invalidateCacheForStudent: vi.fn(),\n  }),\n}));\n\n// Lazy panels are code-split; mock them to simple markers\nvi.mock('@/components/lazy/LazyChartsPanel', () => ({\n  LazyChartsPanel: ({ filteredData }: any) => (\n    <div data-testid=\"charts-panel\">charts:{filteredData?.entries?.length ?? 0}</div>\n  ),\n}));\nvi.mock('@/components/lazy/LazyPatternsPanel', () => ({\n  LazyPatternsPanel: () => <div data-testid=\"patterns-panel\">patterns</div>,\n}));\nvi.mock('@/components/lazy/LazyCorrelationsPanel', () => ({\n  LazyCorrelationsPanel: () => (\n    <div data-testid=\"correlations-panel\">correlations</div>\n  ),\n}));\nvi.mock('@/components/lazy/LazyAlertsPanel', () => ({\n  LazyAlertsPanel: () => <div data-testid=\"alerts-panel\">alerts</div>,\n}));\n\n// Sync tab param hook: interact with window.location.search\nvi.mock('@/hooks/useSyncedTabParam', () => {\n  return {\n    useSyncedTabParam: ({ defaultTab }: any = { defaultTab: 'charts' }) => {\n      const params = new URLSearchParams(window.location.search);\n      const initial = (params.get('tab') as any) || defaultTab;\n      const [tab, setTab] = React.useState(initial);\n      React.useEffect(() => {\n        const p = new URLSearchParams(window.location.search);\n        p.set('tab', tab);\n        const url = `${window.location.pathname}?${p.toString()}`;\n        window.history.replaceState({}, '', url);\n      }, [tab]);\n      return [tab, setTab];\n    },\n  };\n});\n\nconst student = { id: 's1', name: 'A' } as any;\nconst filteredData = { entries: [], emotions: [], sensoryInputs: [] };\n\nfunction renderWithRouter(ui: React.ReactElement, initialEntries: string[] = ['/']) {\n  return render(<MemoryRouter initialEntries={initialEntries}>{ui}</MemoryRouter>);\n}\n\n// Scope: tabbed UI behaviors (lazy mounting, URL sync, accessibility)\ndescribe('AnalyticsDashboard tabs', () => {\n  beforeEach(() => {\n    // Reset URL before each test to avoid cross-test leakage\n    window.history.replaceState({}, '', '/');\n  });\n  test('initial render defaults to charts tab and only charts content in DOM', async () => {\n    renderWithRouter(<AnalyticsDashboard student={student} filteredData={filteredData} />);\n\n    // Charts content present\n    expect(await screen.findByTestId('charts-panel')).toBeInTheDocument();\n\n    // Patterns and correlations panels not in DOM until selected\n    expect(screen.queryByTestId('patterns-panel')).toBeNull();\n    expect(screen.queryByTestId('correlations-panel')).toBeNull();\n\n    // Correlations tab testid remains present and clickable\n    const correlationsTab = screen.getByTestId('dashboard-correlations-tab');\n    expect(correlationsTab).toBeInTheDocument();\n    expect(correlationsTab).toBeEnabled();\n  });\n\n  test('URL param tab=patterns mounts only PatternsPanel; switching updates URL', async () => {\n// Set real URL since the hook reads window.location\n    window.history.replaceState({}, '', '/?tab=patterns');\n    renderWithRouter(\n      <AnalyticsDashboard student={student} filteredData={filteredData} />\n    );\n\n    // Only patterns content\n    expect(await screen.findByTestId('patterns-panel')).toBeInTheDocument();\n    expect(screen.queryByTestId('charts-panel')).toBeNull();\n    expect(screen.queryByTestId('correlations-panel')).toBeNull();\n\n    // Switch to correlations and verify URL updates\n    const correlationsTab = screen.getByTestId('dashboard-correlations-tab');\n    await userEvent.click(correlationsTab);\n    await waitFor(() => {\n      expect(new URLSearchParams(window.location.search).get('tab')).toBe('correlations');\n    });\n    expect(await screen.findByTestId('correlations-panel')).toBeInTheDocument();\n    expect(screen.queryByTestId('patterns-panel')).toBeNull();\n  });\n\n  test('reloading with tab=correlations shows correlations tab active', async () => {\nwindow.history.replaceState({}, '', '/?tab=correlations');\n    renderWithRouter(\n      <AnalyticsDashboard student={student} filteredData={filteredData} />\n    );\n    expect(await screen.findByTestId('correlations-panel')).toBeInTheDocument();\n    // Ensure charts not mounted\n    expect(screen.queryByTestId('charts-panel')).toBeNull();\n  });\n\n  test('live region announces tab label on change', async () => {\n    renderWithRouter(<AnalyticsDashboard student={student} filteredData={filteredData} />);\n    const liveRegion = screen.getByRole('status');\n\n    // Initially charts\n    expect(liveRegion.textContent || '').toMatch(/tabs\\.charts/);\n\n    // Switch to patterns\n    await userEvent.click(screen.getByTestId('dashboard-patterns-tab'));\n    await waitFor(() => {\n      expect((liveRegion.textContent || '')).toMatch(/tabs\\.patterns/);\n    });\n  });\n\ntest('skip link focuses first tab panel', async () => {\n    // Ensure default charts tab\n    window.history.replaceState({}, '', '/');\n    renderWithRouter(<AnalyticsDashboard student={student} filteredData={filteredData} />);\n    const skip = screen.getByRole('link', { name: /skipToContent/i });\n\n    await userEvent.tab(); // move focus to body\n    await userEvent.click(skip);\n\n    const panel = await screen.findByTestId('charts-panel');\n    // Focus should be on tabpanel container (TabsContent) since we set tabIndex=-1 on it\n    const tabpanel = document.getElementById('analytics-tabpanel');\n    expect(tabpanel).toBeTruthy();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/analysis/CorrelationHeatmap.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Insufficient data for correlation analysis\"","line":26,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":26,"endColumn":56},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Insufficient data for correlation analysis</p>","line":26,"column":14,"nodeType":"JSXText","endLine":26,"endColumn":56},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"At least 10 tracking entries needed\"","line":27,"column":34,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":27,"endColumn":69},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm\">At least 10 tracking entries needed</p>","line":27,"column":34,"nodeType":"JSXText","endLine":27,"endColumn":69},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Retry\"","line":35,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":37,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n              size=\"sm\"\n              variant=\"outline\"\n              aria-label=\"Retry correlation analysis\"\n              title=\"Retry correlation analysis\"\n              onClick={onRetry}\n            >\n              Retry\n            </Button>","line":35,"column":14,"nodeType":"JSXText","endLine":37,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Show all time\"","line":44,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":46,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n              size=\"sm\"\n              variant=\"ghost\"\n              aria-label=\"Show all time range\"\n              title=\"Show all time range\"\n              onClick={onShowAllTime}\n            >\n              Show all time\n            </Button>","line":44,"column":14,"nodeType":"JSXText","endLine":46,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport React from 'react';\nconst EChartContainer = React.lazy(() => import('@/components/charts/EChartContainer').then(m => ({ default: m.EChartContainer })));\nimport { buildCorrelationHeatmapOption } from '@/components/charts/ChartKit';\nimport { Button } from '@/components/ui/button';\nimport { BarChart3 } from 'lucide-react';\nimport { CorrelationMatrix } from '@/lib/enhancedPatternAnalysis';\nimport { EChartsOption } from 'echarts';\n\ninterface CorrelationHeatmapProps {\n  correlationMatrix: CorrelationMatrix | null;\n  onRetry: () => void;\n  onShowAllTime: () => void;\n}\n\nexport const CorrelationHeatmap: React.FC<CorrelationHeatmapProps> = ({\n  correlationMatrix,\n  onRetry,\n  onShowAllTime,\n}) => {\n  if (!correlationMatrix) {\n    return (\n      <div className=\"flex items-center justify-center h-64 text-muted-foreground\">\n        <div className=\"text-center\">\n          <BarChart3 className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n          <p>Insufficient data for correlation analysis</p>\n          <p className=\"text-sm\">At least 10 tracking entries needed</p>\n          <div className=\"mt-3 flex items-center justify-center gap-2\">\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              aria-label=\"Retry correlation analysis\"\n              title=\"Retry correlation analysis\"\n              onClick={onRetry}\n            >\n              Retry\n            </Button>\n            <Button\n              size=\"sm\"\n              variant=\"ghost\"\n              aria-label=\"Show all time range\"\n              title=\"Show all time range\"\n              onClick={onShowAllTime}\n            >\n              Show all time\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const option: EChartsOption = buildCorrelationHeatmapOption(correlationMatrix);\n  return (\n    <React.Suspense fallback={<div className=\"h-[420px] rounded-xl border bg-card motion-safe:animate-pulse\" aria-label=\"Loading heatmap\" />}> \n      <EChartContainer option={option} height={420} />\n    </React.Suspense>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/analysis/PatternAnalysisView.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No patterns detected yet\"","line":79,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":79,"endColumn":38},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>No patterns detected yet</p>","line":79,"column":14,"nodeType":"JSXText","endLine":79,"endColumn":38},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Need more data for pattern analysis\"","line":80,"column":34,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":80,"endColumn":69},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm\">Need more data for pattern analysis</p>","line":80,"column":34,"nodeType":"JSXText","endLine":80,"endColumn":69},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Detected Patterns (\"","line":91,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":92,"endColumn":32},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-lg font-semibold flex items-center gap-2\">\n            <Target className=\"h-5 w-5\" />\n            Detected Patterns ({patterns.length})\n          </h3>","line":91,"column":43,"nodeType":"JSXText","endLine":92,"endColumn":32},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":97,"column":22,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":97,"endColumn":27},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Pattern\"","line":109,"column":78,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":109,"endColumn":86},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-medium capitalize\">{pattern.type} Pattern</h4>","line":109,"column":78,"nodeType":"JSXText","endLine":109,"endColumn":86},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"% confident\"","line":111,"column":65,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":112,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge className={getConfidenceColor(pattern.confidence)}>\n                          {Math.round(pattern.confidence * 100)}% confident\n                        </Badge>","line":111,"column":65,"nodeType":"JSXText","endLine":112,"endColumn":25},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Frequency:\"","line":114,"column":73,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":115,"endColumn":36},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground mb-2\">\n                        Frequency: {pattern.frequency} occurrences\n                      </p>","line":114,"column":73,"nodeType":"JSXText","endLine":115,"endColumn":36},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"occurrences\"","line":115,"column":55,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":116,"endColumn":23},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground mb-2\">\n                        Frequency: {pattern.frequency} occurrences\n                      </p>","line":115,"column":55,"nodeType":"JSXText","endLine":116,"endColumn":23},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Recommendations:\"","line":119,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":119,"endColumn":78},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm font-medium\">Recommendations:</p>","line":119,"column":62,"nodeType":"JSXText","endLine":119,"endColumn":78},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":121,"column":37,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":121,"endColumn":38},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Predictive Insights (\"","line":140,"column":47,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":141,"endColumn":34},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-lg font-semibold flex items-center gap-2\">\n            <TrendingUp className=\"h-5 w-5\" />\n            Predictive Insights ({predictiveInsights.length})\n          </h3>","line":140,"column":47,"nodeType":"JSXText","endLine":141,"endColumn":34},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":145,"column":26,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":145,"endColumn":31},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"% confidence\"","line":161,"column":65,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":162,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\">\n                          {Math.round(insight.confidence * 100)}% confidence\n                        </Badge>","line":161,"column":65,"nodeType":"JSXText","endLine":162,"endColumn":25},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Prediction:\"","line":171,"column":67,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":171,"endColumn":78},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm font-medium mb-1\">Prediction:</p>","line":171,"column":67,"nodeType":"JSXText","endLine":171,"endColumn":78},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Recommendations:\"","line":195,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":195,"endColumn":78},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm font-medium\">Recommendations:</p>","line":195,"column":62,"nodeType":"JSXText","endLine":195,"endColumn":78},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":197,"column":37,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":197,"endColumn":38},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Severity:\"","line":208,"column":59,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":209,"endColumn":39},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground flex items-center gap-1\">\n                            <Shield className=\"h-3 w-3\" />\n                            Severity: <span className=\"font-medium capitalize\">{insight.severity}</span>\n                          </p>","line":208,"column":59,"nodeType":"JSXText","endLine":209,"endColumn":39},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Detected Anomalies (\"","line":225,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":226,"endColumn":33},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-lg font-semibold flex items-center gap-2\">\n            <AlertTriangle className=\"h-5 w-5\" />\n            Detected Anomalies ({anomalies.length})\n          </h3>","line":225,"column":50,"nodeType":"JSXText","endLine":226,"endColumn":33},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":231,"column":22,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":231,"endColumn":27},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Anomaly\"","line":242,"column":70,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":242,"endColumn":78},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-medium mb-1\">{anomaly.type} Anomaly</h4>","line":242,"column":70,"nodeType":"JSXText","endLine":242,"endColumn":78},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Severity:\"","line":243,"column":73,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":244,"endColumn":35},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground mb-2\">\n                        Severity: <span className=\"font-medium capitalize\">{anomaly.severity}</span>\n                      </p>","line":243,"column":73,"nodeType":"JSXText","endLine":244,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":37,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  Zap,\n  Target,\n  Eye,\n  Brain,\n  Thermometer,\n  Activity,\n  TrendingUp,\n  AlertTriangle,\n  Clock,\n  CheckCircle,\n  TrendingDown,\n  Lightbulb,\n  Shield,\n} from 'lucide-react';\nimport {\n  PatternResult,\n  PredictiveInsight,\n  AnomalyDetection,\n} from '@/lib/enhancedPatternAnalysis';\nimport { ConfidenceIndicator } from '@/components/ConfidenceIndicator';\nimport { cn } from '@/lib/utils';\nimport { format, differenceInDays } from 'date-fns';\nimport { HighlightState } from '@/hooks/useVisualizationState';\n\ninterface PatternAnalysisViewProps {\n  patterns: PatternResult[];\n  predictiveInsights: PredictiveInsight[];\n  anomalies: AnomalyDetection[];\n  isAnalyzing: boolean;\n  highlightState: HighlightState;\n  handleHighlight: (type: HighlightState['type'], id: string) => void;\n  filteredData: {\n    emotions: { timestamp: Date; intensity: number }[];\n    sensoryInputs: { timestamp: Date }[];\n  };\n}\n\nexport const PatternAnalysisView: React.FC<PatternAnalysisViewProps> = ({\n  patterns,\n  predictiveInsights,\n  anomalies,\n  isAnalyzing,\n  highlightState,\n  handleHighlight,\n  filteredData,\n}) => {\n  const getPatternIcon = (type: string) => {\n    switch (type.toLowerCase()) {\n      case 'emotion': return <Brain className=\"h-4 w-4\" />;\n      case 'sensory': return <Eye className=\"h-4 w-4\" />;\n      case 'environmental': return <Thermometer className=\"h-4 w-4\" />;\n      default: return <Activity className=\"h-4 w-4\" />;\n    }\n  };\n\n  const getConfidenceColor = (confidence: number) => {\n    if (confidence >= 0.8) return 'text-success-foreground bg-success border-success/30';\n    if (confidence >= 0.6) return 'text-warning-foreground bg-warning border-warning/30';\n    return 'text-destructive-foreground bg-destructive border-destructive/30';\n  };\n\n  if (isAnalyzing) {\n    return (\n      <div aria-label=\"Loading chart data\" className=\"h-[400px] w-full\">\n        <div className=\"h-full w-full animate-pulse rounded-md border border-border/50 bg-muted/20\" />\n      </div>\n    );\n  }\n\n  if (patterns.length === 0 && predictiveInsights.length === 0) {\n    return (\n      <div className=\"flex items-center justify-center h-64 text-muted-foreground\">\n        <div className=\"text-center\">\n          <Zap className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n          <p>No patterns detected yet</p>\n          <p className=\"text-sm\">Need more data for pattern analysis</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {patterns.length > 0 && (\n        <div className=\"space-y-4\">\n          <h3 className=\"text-lg font-semibold flex items-center gap-2\">\n            <Target className=\"h-5 w-5\" />\n            Detected Patterns ({patterns.length})\n          </h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            {patterns.map((pattern, index) => (\n              <Card\n                key={index}\n                className={cn(\n                  \"bg-gradient-card cursor-pointer transition-all\",\n                  highlightState.type === 'emotion' && pattern.type === 'emotion' && \"ring-2 ring-primary\"\n                )}\n                onClick={() => handleHighlight('emotion', `pattern-${index}`)}\n              >\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-start gap-3\">\n                    {getPatternIcon(pattern.type)}\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <h4 className=\"font-medium capitalize\">{pattern.type} Pattern</h4>\n                        <Badge className={getConfidenceColor(pattern.confidence)}>\n                          {Math.round(pattern.confidence * 100)}% confident\n                        </Badge>\n                      </div>\n                      <p className=\"text-sm text-muted-foreground mb-2\">\n                        Frequency: {pattern.frequency} occurrences\n                      </p>\n                      {(pattern.recommendations?.length ?? 0) > 0 && (\n                        <div className=\"space-y-1\">\n                          <p className=\"text-sm font-medium\">Recommendations:</p>\n                          {(pattern.recommendations ?? []).slice(0, 2).map((rec, i) => (\n                            <p key={i} className=\"text-xs text-muted-foreground flex items-start gap-1\">\n                              <Lightbulb className=\"h-3 w-3 mt-0.5 flex-shrink-0\" />\n                              {rec}\n                            </p>\n                          ))}\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {predictiveInsights.length > 0 && (\n        <div className=\"space-y-4\">\n          <h3 className=\"text-lg font-semibold flex items-center gap-2\">\n            <TrendingUp className=\"h-5 w-5\" />\n            Predictive Insights ({predictiveInsights.length})\n          </h3>\n          <div className=\"space-y-4\">\n            {predictiveInsights.map((insight, index) => (\n              <Card key={index} className=\"bg-gradient-card\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-start gap-3\">\n                    <div className=\"flex-shrink-0\">\n                      {insight.severity === 'high' ? (\n                        <AlertTriangle className=\"h-5 w-5 text-destructive\" />\n                      ) : insight.severity === 'medium' ? (\n                        <Clock className=\"h-5 w-5 text-warning\" />\n                      ) : (\n                        <CheckCircle className=\"h-5 w-5 text-success\" />\n                      )}\n                    </div>\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <h4 className=\"font-medium\">{insight.title}</h4>\n                        <Badge variant=\"outline\">\n                          {Math.round(insight.confidence * 100)}% confidence\n                        </Badge>\n                      </div>\n\n                      <p className=\"text-sm text-muted-foreground mb-2\">\n                        {insight.description}\n                      </p>\n\n                      {insight.prediction && (\n                        <div className=\"mb-2\">\n                          <p className=\"text-sm font-medium mb-1\">Prediction:</p>\n                          <div className=\"flex items-center gap-2 text-sm\">\n                            {insight.prediction.trend === 'increasing' ? (\n                            <TrendingUp className=\"h-4 w-4 text-success\" />\n                            ) : insight.prediction.trend === 'decreasing' ? (\n                              <TrendingDown className=\"h-4 w-4 text-destructive\" />\n                            ) : (\n                              <Activity className=\"h-4 w-4 text-info\" />\n                            )}\n                            <span className=\"capitalize\">{insight.prediction.trend}</span>\n                            <ConfidenceIndicator\n                              confidence={insight.prediction.accuracy}\n                              dataPoints={filteredData.emotions.length + filteredData.sensoryInputs.length}\n                              timeSpanDays={filteredData.emotions.length > 0 && filteredData.emotions[0] ?\n                                Math.abs(differenceInDays(new Date(), filteredData.emotions[0].timestamp)) : 0}\n                              rSquared={insight.prediction.accuracy}\n                              className=\"ml-1\"\n                            />\n                          </div>\n                        </div>\n                      )}\n\n                      {insight.recommendations.length > 0 && (\n                        <div className=\"space-y-1\">\n                          <p className=\"text-sm font-medium\">Recommendations:</p>\n                          {insight.recommendations.slice(0, 3).map((rec, i) => (\n                            <p key={i} className=\"text-xs text-muted-foreground flex items-start gap-1\">\n                              <Lightbulb className=\"h-3 w-3 mt-0.5 flex-shrink-0\" />\n                              {rec}\n                            </p>\n                          ))}\n                        </div>\n                      )}\n\n                      {insight.severity && (\n                        <div className=\"mt-2 pt-2 border-t border-border\">\n                          <p className=\"text-xs text-muted-foreground flex items-center gap-1\">\n                            <Shield className=\"h-3 w-3\" />\n                            Severity: <span className=\"font-medium capitalize\">{insight.severity}</span>\n                          </p>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {anomalies.length > 0 && (\n        <div className=\"space-y-4\">\n          <h3 className=\"text-lg font-semibold flex items-center gap-2\">\n            <AlertTriangle className=\"h-5 w-5\" />\n            Detected Anomalies ({anomalies.length})\n          </h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            {anomalies.map((anomaly, index) => (\n              <Card\n                key={index}\n                className={cn(\n                  \"bg-gradient-card border-orange-200 cursor-pointer\",\n                  highlightState.type === 'anomaly' && highlightState.id === `anomaly-${index}` && \"ring-2 ring-orange-500\"\n                )}\n                onClick={() => handleHighlight('anomaly', `anomaly-${index}`)}\n              >\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-start gap-3\">\n                    <AlertTriangle className=\"h-4 w-4 text-orange-500 flex-shrink-0 mt-0.5\" />\n                    <div className=\"flex-1\">\n                      <h4 className=\"font-medium mb-1\">{anomaly.type} Anomaly</h4>\n                      <p className=\"text-sm text-muted-foreground mb-2\">\n                        Severity: <span className=\"font-medium capitalize\">{anomaly.severity}</span>\n                      </p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {format(anomaly.timestamp, 'MMM dd, yyyy')}\n                      </p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/analysis/TeacherInsightsPanel.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"n/a\"","line":33,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":33,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\">n/a</Badge>","line":33,"column":54,"nodeType":"JSXText","endLine":33,"endColumn":57},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Insights for\"","line":63,"column":44,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":64,"endColumn":24},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"text-lg flex items-center gap-2\">\n          <Lightbulb className=\"h-5 w-5\" />\n          Insights for {student.name}\n        </CardTitle>","line":63,"column":44,"nodeType":"JSXText","endLine":64,"endColumn":24},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"You’re viewing:\"","line":70,"column":58,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":71,"endColumn":29},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">\n            You’re viewing: <span className=\"font-medium\">{activePreset.replaceAll('_',' ')}</span>\n          </div>","line":70,"column":58,"nodeType":"JSXText","endLine":71,"endColumn":29},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Limited data — results may change as more sessions are recorded. Try tracking for at least 7 days and 10 sessions for stronger findings.\"","line":76,"column":63,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":78,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"p-3 rounded-lg bg-muted/40 text-sm\">\n            Limited data — results may change as more sessions are recorded. Try tracking for at least 7 days and 10 sessions for stronger findings.\n          </div>","line":76,"column":63,"nodeType":"JSXText","endLine":78,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Pattern detected\"","line":85,"column":51,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":87,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"font-medium flex items-center gap-2\">\n                <TrendingUp className=\"h-4 w-4\" />\n                Pattern detected\n              </div>","line":85,"column":51,"nodeType":"JSXText","endLine":87,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Correlation\"","line":96,"column":42,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":96,"endColumn":53},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"font-medium\">Correlation</div>","line":96,"column":42,"nodeType":"JSXText","endLine":96,"endColumn":53},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"↔\"","line":97,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":97,"endColumn":63},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"r =\"","line":98,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":98,"endColumn":64},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-muted-foreground\">r = {topCorr.correlation.toFixed(2)} ({topCorr.significance})</div>","line":98,"column":60,"nodeType":"JSXText","endLine":98,"endColumn":64},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Recent Anomaly\"","line":105,"column":67,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":106,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"flex items-center gap-2 font-medium\">\n              <AlertTriangle className=\"h-4 w-4 text-amber-600\" /> Recent Anomaly\n            </div>","line":105,"column":67,"nodeType":"JSXText","endLine":106,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Create Goal\"","line":112,"column":105,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":112,"endColumn":116},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button variant=\"outline\" size=\"sm\" onClick={onCreateGoal}><Target className=\"h-4 w-4 mr-1\" />Create Goal</Button>","line":112,"column":105,"nodeType":"JSXText","endLine":112,"endColumn":116},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Add Intervention\"","line":113,"column":75,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":113,"endColumn":91},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button variant=\"outline\" size=\"sm\" onClick={onAddIntervention}>Add Intervention</Button>","line":113,"column":75,"nodeType":"JSXText","endLine":113,"endColumn":91},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Schedule Break\"","line":114,"column":73,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":114,"endColumn":87},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button variant=\"outline\" size=\"sm\" onClick={onScheduleBreak}>Schedule Break</Button>","line":114,"column":73,"nodeType":"JSXText","endLine":114,"endColumn":87},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Track Now\"","line":115,"column":74,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":115,"endColumn":83},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button variant=\"outline\" size=\"sm\" onClick={onJumpToTracking}>Track Now</Button>","line":115,"column":74,"nodeType":"JSXText","endLine":115,"endColumn":83},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Data:\"","line":118,"column":61,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":119,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-muted-foreground pt-2\">\n          Data: {sessions} sessions, {emotions} emotions\n        </div>","line":118,"column":61,"nodeType":"JSXText","endLine":119,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"sessions,\"","line":119,"column":27,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":119,"endColumn":38},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-muted-foreground pt-2\">\n          Data: {sessions} sessions, {emotions} emotions\n        </div>","line":119,"column":27,"nodeType":"JSXText","endLine":119,"endColumn":38},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"emotions\"","line":119,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":120,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-muted-foreground pt-2\">\n          Data: {sessions} sessions, {emotions} emotions\n        </div>","line":119,"column":48,"nodeType":"JSXText","endLine":120,"endColumn":9}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":31,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Student, TrackingEntry, EmotionEntry, SensoryEntry } from '@/types/student';\nimport { TrendingUp, AlertTriangle, Target, Lightbulb } from 'lucide-react';\n\ntype AnalysisBundle = {\n  patterns?: Array<{ pattern?: string; description?: string; confidence?: number; type?: string; dataPoints?: number }>;\n  predictiveInsights?: Array<{ title?: string; description?: string; confidence?: number; timeframe?: string }>;\n  anomalies?: Array<{ description: string; timestamp: Date; severity: 'low'|'medium'|'high' }>;\n  correlationMatrix?: { significantPairs?: Array<{ factor1: string; factor2: string; correlation: number; significance: string }> } | null;\n  isAnalyzing?: boolean;\n};\n\ninterface Props {\n  student: Student;\n  filteredData: {\n    entries: TrackingEntry[];\n    emotions: EmotionEntry[];\n    sensoryInputs: SensoryEntry[];\n  };\n  analysis: AnalysisBundle;\n  activePreset?: string | null;\n  onCreateGoal?: () => void;\n  onAddIntervention?: () => void;\n  onScheduleBreak?: () => void;\n  onJumpToTracking?: () => void;\n  className?: string;\n}\n\nconst scoreToBadge = (p?: number) => {\n  if (!p && p !== 0) return <Badge variant=\"outline\">n/a</Badge>;\n  const pct = Math.round(p * 100);\n  const variant = p >= 0.7 ? 'default' : p >= 0.4 ? 'secondary' : 'destructive';\n  return <Badge variant={variant}>{pct}%</Badge>;\n};\n\nexport const TeacherInsightsPanel: React.FC<Props> = ({\n  student,\n  filteredData,\n  analysis,\n  activePreset,\n  onCreateGoal,\n  onAddIntervention,\n  onScheduleBreak,\n  onJumpToTracking,\n  className = ''\n}) => {\n  const sessions = filteredData?.entries?.length ?? 0;\n  const emotions = filteredData?.emotions?.length ?? 0;\n\n  const limited = sessions < 10 || new Set(filteredData.entries.map(e => e.timestamp.toDateString())).size < 7;\n  const pairs = analysis.correlationMatrix?.significantPairs || [];\n  const topCorr = pairs[0];\n  const topPattern = (analysis.patterns || []).sort((a,b) => (b.confidence ?? 0) - (a.confidence ?? 0))[0];\n  const anomaly = (analysis.anomalies || [])[0];\n\n  return (\n    <Card className={`w-full md:w-[360px] lg:w-[400px] bg-card/60 border border-border/60 ${className}`}>\n      <CardHeader>\n        <CardTitle className=\"text-lg flex items-center gap-2\">\n          <Lightbulb className=\"h-5 w-5\" />\n          Insights for {student.name}\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n\n        {activePreset && (\n          <div className=\"text-sm text-muted-foreground\">\n            You’re viewing: <span className=\"font-medium\">{activePreset.replaceAll('_',' ')}</span>\n          </div>\n        )}\n\n        {limited && (\n          <div className=\"p-3 rounded-lg bg-muted/40 text-sm\">\n            Limited data — results may change as more sessions are recorded. Try tracking for at least 7 days and 10 sessions for stronger findings.\n          </div>\n        )}\n\n        {topPattern && (\n          <div className=\"p-3 rounded-lg border\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"font-medium flex items-center gap-2\">\n                <TrendingUp className=\"h-4 w-4\" />\n                Pattern detected\n              </div>\n              {scoreToBadge(topPattern.confidence)}\n            </div>\n            <div className=\"text-sm mt-1\">{topPattern.description || topPattern.pattern}</div>\n          </div>\n        )}\n\n        {topCorr && (\n          <div className=\"p-3 rounded-lg border\">\n            <div className=\"font-medium\">Correlation</div>\n            <div className=\"text-sm mt-1\">{topCorr.factor1} ↔ {topCorr.factor2}</div>\n            <div className=\"text-xs text-muted-foreground\">r = {topCorr.correlation.toFixed(2)} ({topCorr.significance})</div>\n          </div>\n        )}\n\n        {anomaly && (\n          <div className=\"p-3 rounded-lg border\">\n            <div className=\"flex items-center gap-2 font-medium\">\n              <AlertTriangle className=\"h-4 w-4 text-amber-600\" /> Recent Anomaly\n            </div>\n            <div className=\"text-sm mt-1\">{anomaly.description}</div>\n          </div>\n        )}\n\n        <div className=\"pt-2 grid grid-cols-2 gap-2\">\n          <Button variant=\"outline\" size=\"sm\" onClick={onCreateGoal}><Target className=\"h-4 w-4 mr-1\" />Create Goal</Button>\n          <Button variant=\"outline\" size=\"sm\" onClick={onAddIntervention}>Add Intervention</Button>\n          <Button variant=\"outline\" size=\"sm\" onClick={onScheduleBreak}>Schedule Break</Button>\n          <Button variant=\"outline\" size=\"sm\" onClick={onJumpToTracking}>Track Now</Button>\n        </div>\n\n        <div className=\"text-xs text-muted-foreground pt-2\">\n          Data: {sessions} sessions, {emotions} emotions\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/analytics-panels/AlertsPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'filteredData' is defined but never used. Allowed unused args must match /^_/u.","line":15,"column":56,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":68}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { memo } from 'react';\nimport { TrackingEntry, EmotionEntry, SensoryEntry } from '@/types/student';\nimport { analyticsConfig } from '@/lib/analyticsConfig';\nimport { AlertManager } from '@/components/AlertManager';\n\nexport interface AlertsPanelProps {\n  filteredData: {\n    entries: TrackingEntry[];\n    emotions: EmotionEntry[];\n    sensoryInputs: SensoryEntry[];\n  };\n  studentId?: string;\n}\n\nexport const AlertsPanel = memo(function AlertsPanel({ filteredData, studentId }: AlertsPanelProps): React.ReactElement {\n  // Pull thresholds if needed by future extensions to filter or highlight alerts\n  const thresholds = analyticsConfig.getThresholds?.() ?? {};\n  void thresholds; // avoid unused var for now\n\n  return (\n    <div className=\"space-y-4\">\n      <AlertManager studentId={studentId} />\n    </div>\n  );\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/analytics-panels/ChartsPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/analytics-panels/ChatComposer.tsx","messages":[{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":43,"column":20,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":43,"endColumn":21},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Send\"","line":64,"column":96,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":64,"endColumn":100},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button onClick={onSubmit} disabled={disabled || pending || value.trim().length === 0}>Send</Button>","line":64,"column":96,"nodeType":"JSXText","endLine":64,"endColumn":100}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Textarea } from '@/components/ui/textarea';\n\nexport interface ChatComposerProps {\n  value: string;\n  onChange: (next: string) => void;\n  onSubmit: () => void;\n  placeholder: string;\n  pending?: boolean;\n  disabled?: boolean;\n  className?: string;\n  suggestions?: string[];\n}\n\n/**\n * Minimal, reusable chat composer with optional suggestion chips.\n * This is a scaffold for the v2 UI; behaviors (sticky, toolbelt) can expand later.\n */\nexport function ChatComposer({\n  value,\n  onChange,\n  onSubmit,\n  placeholder,\n  pending = false,\n  disabled = false,\n  className,\n  suggestions = ['Hvorfor?', 'Hva hvis...', 'Hvilke tiltak anbefales?'],\n}: ChatComposerProps): React.ReactElement {\n  const handleKeyDown: React.KeyboardEventHandler<HTMLTextAreaElement> = (e) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      onSubmit();\n    }\n  };\n\n  return (\n    <div className={className}>\n      {suggestions.length > 0 && (\n        <div className=\"mb-2 flex flex-wrap gap-1\">\n          {suggestions.map((s, i) => (\n            <button\n              key={i}\n              type=\"button\"\n              onClick={() => onChange(s)}\n              className=\"rounded border px-2 py-0.5 text-[11px] text-muted-foreground hover:bg-accent/40\"\n              aria-label={`Forslag: ${s}`}\n            >\n              {s}\n            </button>\n          ))}\n        </div>\n      )}\n      <div className=\"flex items-end gap-2\">\n        <Textarea\n          value={value}\n          onChange={(e) => onChange(e.target.value)}\n          onKeyDown={handleKeyDown}\n          placeholder={placeholder}\n          className=\"min-h-[44px]\"\n          disabled={disabled || pending}\n          aria-label={placeholder}\n        />\n        <Button onClick={onSubmit} disabled={disabled || pending || value.trim().length === 0}>Send</Button>\n      </div>\n    </div>\n  );\n}\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/analytics-panels/CorrelationsPanel.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"↔\"","line":97,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":97,"endColumn":51}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { memo } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { HoverCard, HoverCardContent, HoverCardTrigger } from '@/components/ui/hover-card';\nimport { Info, BarChart3, Clock } from 'lucide-react';\nimport { TrackingEntry, EmotionEntry, SensoryEntry } from '@/types/student';\nimport { CorrelationResult } from '@/lib/patternAnalysis';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { hashOfString } from '@/lib/key';\n\n// Keep charting dependencies inside this chunk to align with manualChunks strategy\nimport React from 'react';\nconst EChartContainer = React.lazy(() => import('@/components/charts/EChartContainer').then(m => ({ default: m.EChartContainer })));\nimport type { EChartsOption } from 'echarts';\nimport { buildCorrelationHeatmapOption } from '@/components/charts/ChartKit';\nimport { enhancedPatternAnalysis } from '@/lib/enhancedPatternAnalysis';\n\nexport interface CorrelationsPanelProps {\n  filteredData: {\n    entries: TrackingEntry[];\n    emotions: EmotionEntry[];\n    sensoryInputs: SensoryEntry[];\n  };\n}\n\nexport const CorrelationsPanel = memo(function CorrelationsPanel({ filteredData }: CorrelationsPanelProps): React.ReactElement {\n  const { tAnalytics } = useTranslation();\n  const environmentalCorrelations: CorrelationResult[] = [];\n  const hasEnoughData = (filteredData.entries?.length ?? 0) >= 10;\n\n  let option: EChartsOption | null = null;\n  if (hasEnoughData) {\n    try {\n      const matrix = enhancedPatternAnalysis.generateCorrelationMatrix(filteredData.entries);\n      option = buildCorrelationHeatmapOption(matrix);\n    } catch {\n      option = null;\n    }\n  }\n\n  return (\n    <Card className=\"bg-gradient-card border-0 shadow-soft\">\n      <CardHeader className=\"flex items-start justify-between gap-3\">\n        <div>\n          <CardTitle data-testid=\"environmental-correlations-title\">{String(tAnalytics('correlations.title'))}</CardTitle>\n          <p className=\"text-sm text-muted-foreground\">{String(tAnalytics('correlations.subtitle'))}</p>\n        </div>\n        <HoverCard openDelay={150} closeDelay={100}>\n          <HoverCardTrigger asChild>\n            <button aria-label={String(tAnalytics('correlations.helpTrigger'))} className=\"inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-xs hover:bg-accent/30\">\n              <Info className=\"h-4 w-4\" />\n              {String(tAnalytics('correlations.helpTrigger'))}\n            </button>\n          </HoverCardTrigger>\n          <HoverCardContent className=\"w-80 text-sm leading-relaxed\">\n            <p>{String(tAnalytics('correlations.helpBody.p1'))}</p>\n            <p className=\"mt-1\">{String(tAnalytics('correlations.helpBody.p2'))}</p>\n          </HoverCardContent>\n        </HoverCard>\n      </CardHeader>\n      <CardContent>\n        {!hasEnoughData && (\n          <div className=\"text-center py-8 text-muted-foreground\">\n            <BarChart3 className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n            <p>{String(tAnalytics('correlations.empty.title'))}</p>\n            <p className=\"text-sm\">{String(tAnalytics('correlations.empty.moreData'))}</p>\n          </div>\n        )}\n        {hasEnoughData && option && (\n          <>\n            <div className=\"rounded-xl border bg-card\">\n              <React.Suspense fallback={<div className=\"h-[420px] rounded-xl border bg-card motion-safe:animate-pulse\" aria-label=\"Loading correlations\" />}> \n                <EChartContainer option={option} height={420} />\n              </React.Suspense>\n            </div>\n            <div className=\"mt-3 flex items-center gap-3 text-xs text-muted-foreground\">\n              <span>{String(tAnalytics('correlations.legend.negative'))}</span>\n              <span className=\"h-3 w-3 rounded bg-destructive\" />\n              <span>{String(tAnalytics('correlations.legend.zero'))}</span>\n              <span className=\"h-3 w-3 rounded border bg-muted\" />\n              <span>{String(tAnalytics('correlations.legend.positive'))}</span>\n              <span className=\"h-3 w-3 rounded bg-emotion-happy\" />\n            </div>\n          </>\n        )}\n        {hasEnoughData && !option && (\n          <div className=\"text-center py-8 text-muted-foreground\">\n            <Clock className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n            <p>{String(tAnalytics('correlations.fallback.title'))}</p>\n            <div className=\"space-y-4 mt-4\">\n              {environmentalCorrelations.map((correlation: CorrelationResult) => (\n                <Card key={hashOfString(`${correlation.factor1}-${correlation.factor2}-${correlation.significance}`)} className=\"border-l-4 border-l-blue-500\">\n                  <CardContent className=\"pt-4\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1\">\n                        <h4 className=\"font-medium text-foreground\">\n                          {correlation.factor1} ↔ {correlation.factor2}\n                        </h4>\n                        <p className=\"text-sm text-muted-foreground mt-1\">{correlation.description}</p>\n                      </div>\n                      <div className=\"text-right\">\n                        <Badge variant={correlation.significance === 'high' ? 'default' : 'outline'}>\n                          {correlation.significance} {String(tAnalytics('correlations.labels.significance'))}\n                        </Badge>\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          {String(tAnalytics('correlations.labels.rPrefix'))}{typeof (correlation as CorrelationResult & { correlation?: number }).correlation === 'number'\n                            ? (correlation as CorrelationResult & { correlation?: number }).correlation.toFixed(3)\n                            : '0.000'}\n                        </p>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n});\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/analytics-panels/EntryDetailsDrawer.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Detaljer\"","line":51,"column":23,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":51,"endColumn":31},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SheetTitle>Detaljer</SheetTitle>","line":51,"column":23,"nodeType":"JSXText","endLine":51,"endColumn":31},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Ingen data\"","line":54,"column":63,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":54,"endColumn":73},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"mt-4 text-sm text-muted-foreground\">Ingen data</div>","line":54,"column":63,"nodeType":"JSXText","endLine":54,"endColumn":73},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Notat\"","line":64,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":64,"endColumn":51},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"font-medium\">Notat</div>","line":64,"column":46,"nodeType":"JSXText","endLine":64,"endColumn":51},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Følelser\"","line":70,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":70,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm font-medium\">Følelser</div>","line":70,"column":54,"nodeType":"JSXText","endLine":70,"endColumn":62},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensorikk\"","line":80,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":80,"endColumn":63},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm font-medium\">Sensorikk</div>","line":80,"column":54,"nodeType":"JSXText","endLine":80,"endColumn":63},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Kontekst\"","line":90,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":90,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm font-medium\">Kontekst</div>","line":90,"column":54,"nodeType":"JSXText","endLine":90,"endColumn":62},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Kopier som tekst\"","line":108,"column":72,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":108,"endColumn":88},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button variant=\"outline\" size=\"sm\" onClick={copyAsText}>Kopier som tekst</Button>","line":108,"column":72,"nodeType":"JSXText","endLine":108,"endColumn":88}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Sheet, SheetContent, SheetHeader, SheetTitle } from '@/components/ui/sheet';\nimport { Button } from '@/components/ui/button';\nimport type { SourceItem } from '@/types/analytics';\n\nexport interface EntryDetailsDrawerProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  source: SourceItem | null;\n}\n\nexport function EntryDetailsDrawer({ open, onOpenChange, source }: EntryDetailsDrawerProps): React.ReactElement {\n  const ts = React.useMemo(() => {\n    if (!source?.timestamp) return '';\n    try { return new Date(source.timestamp).toISOString().replace('T', ' ').slice(0, 16); } catch { return String(source.timestamp); }\n  }, [source?.timestamp]);\n\n  const copyAsText = async () => {\n    try {\n      const parts: string[] = [];\n      if (!source) return;\n      parts.push(`${source.activity || source.place || 'Hendelse'} (${ts})`);\n      if (source.note) parts.push(`Notat: ${source.note}`);\n      if (source.emotions?.length) {\n        parts.push(`Følelser: ${source.emotions.map(e => `${e.emotion}${typeof e.intensity === 'number' ? ` (${e.intensity})` : ''}`).join(', ')}`);\n      }\n      if (source.sensory?.length) {\n        parts.push(`Sensorikk: ${source.sensory.map(s => `${s.type || s.response || 'sensor'}` + (s.response ? `: ${s.response}` : '') + (typeof s.intensity === 'number' ? ` (${s.intensity})` : '')).join(', ')}`);\n      }\n      if (source.environment) {\n        const envParts: string[] = [];\n        if (source.environment.lighting) envParts.push(`lys: ${source.environment.lighting}`);\n        if (typeof source.environment.noiseLevel === 'number') envParts.push(`støy: ${source.environment.noiseLevel}`);\n        if (typeof source.environment.temperature === 'number') envParts.push(`temperatur: ${source.environment.temperature}`);\n        if (typeof source.environment.humidity === 'number') envParts.push(`fukt: ${source.environment.humidity}`);\n        if (source.environment.timeOfDay) envParts.push(`tid: ${source.environment.timeOfDay}`);\n        if (typeof source.environment.studentCount === 'number') envParts.push(`elever: ${source.environment.studentCount}`);\n        if (envParts.length) parts.push(`Miljø: ${envParts.join(', ')}`);\n        if (source.environment.notes) parts.push(`Miljønotat: ${source.environment.notes}`);\n      }\n      await navigator.clipboard.writeText(parts.join('\\n'));\n    } catch {\n      // no-op\n    }\n  };\n\n  return (\n    <Sheet open={open} onOpenChange={onOpenChange}>\n      <SheetContent side=\"right\" className=\"max-w-md w-full\">\n        <SheetHeader>\n          <SheetTitle>Detaljer</SheetTitle>\n        </SheetHeader>\n        {!source && (\n          <div className=\"mt-4 text-sm text-muted-foreground\">Ingen data</div>\n        )}\n        {source && (\n          <div className=\"mt-4 space-y-3\">\n            <div>\n              <div className=\"text-sm font-medium\">{source.activity || source.place || 'Hendelse'}</div>\n              <div className=\"text-xs text-muted-foreground\">{ts}</div>\n            </div>\n            {source.note && (\n              <div className=\"text-sm\">\n                <div className=\"font-medium\">Notat</div>\n                <div className=\"whitespace-pre-wrap break-words\">{source.note}</div>\n              </div>\n            )}\n            {source.emotions?.length ? (\n              <div>\n                <div className=\"text-sm font-medium\">Følelser</div>\n                <ul className=\"mt-1 text-sm list-disc pl-5\">\n                  {source.emotions.map((e) => (\n                    <li key={e.id}>{e.emotion}{typeof e.intensity === 'number' ? ` (intensitet ${e.intensity})` : ''}{e.notes ? ` – ${e.notes}` : ''}</li>\n                  ))}\n                </ul>\n              </div>\n            ) : null}\n            {source.sensory?.length ? (\n              <div>\n                <div className=\"text-sm font-medium\">Sensorikk</div>\n                <ul className=\"mt-1 text-sm list-disc pl-5\">\n                  {source.sensory.map((s) => (\n                    <li key={s.id}>{s.type || s.response || 'sensor'}{s.response ? `: ${s.response}` : ''}{typeof s.intensity === 'number' ? ` (intensitet ${s.intensity})` : ''}{s.notes ? ` – ${s.notes}` : ''}</li>\n                  ))}\n                </ul>\n              </div>\n            ) : null}\n            {(source.place || source.socialContext || source.environment) ? (\n              <div>\n                <div className=\"text-sm font-medium\">Kontekst</div>\n                <div className=\"text-sm text-muted-foreground\">\n                  {[source.place, source.socialContext].filter(Boolean).join(' · ')}\n                </div>\n                {source.environment && (\n                  <div className=\"mt-1 text-sm text-muted-foreground\">\n                    {source.environment.lighting ? `Lys: ${source.environment.lighting}. ` : ''}\n                    {typeof source.environment.noiseLevel === 'number' ? `Støy: ${source.environment.noiseLevel}. ` : ''}\n                    {typeof source.environment.temperature === 'number' ? `Temperatur: ${source.environment.temperature}. ` : ''}\n                    {typeof source.environment.humidity === 'number' ? `Fukt: ${source.environment.humidity}. ` : ''}\n                    {typeof source.environment.studentCount === 'number' ? `Elever: ${source.environment.studentCount}. ` : ''}\n                    {source.environment.timeOfDay ? `Tid: ${source.environment.timeOfDay}. ` : ''}\n                    {source.environment.weather ? `Vær: ${source.environment.weather}. ` : ''}\n                  </div>\n                )}\n              </div>\n            ) : null}\n            <div className=\"pt-2\">\n              <Button variant=\"outline\" size=\"sm\" onClick={copyAsText}>Kopier som tekst</Button>\n            </div>\n          </div>\n        )}\n      </SheetContent>\n    </Sheet>\n  );\n}\n\n \n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/analytics-panels/ExplanationChat.tsx","messages":[{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":47,"column":105,"nodeType":"BlockStatement","messageId":"unexpected","endLine":47,"endColumn":107,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1913,1913],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":63,"column":49,"nodeType":"BlockStatement","messageId":"unexpected","endLine":63,"endColumn":51,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2545,2545],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":76,"column":51,"nodeType":"BlockStatement","messageId":"unexpected","endLine":76,"endColumn":53,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3204,3204],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used. Allowed unused caught errors must match /^_/u.","line":77,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":77,"endColumn":15},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":104,"column":74,"nodeType":"BlockStatement","messageId":"unexpected","endLine":104,"endColumn":76,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4294,4294],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":107,"column":74,"nodeType":"BlockStatement","messageId":"unexpected","endLine":107,"endColumn":76,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4409,4409],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":109,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":109,"endColumn":93},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":110,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":110,"endColumn":89},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":117,"column":93,"nodeType":"BlockStatement","messageId":"unexpected","endLine":117,"endColumn":95,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4950,4950],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":120,"column":97,"nodeType":"BlockStatement","messageId":"unexpected","endLine":120,"endColumn":99,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[5121,5121],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'no-cond-assign').","line":131,"column":7,"severity":1,"nodeType":null,"fix":{"range":[5584,5626],"text":" "}},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":136,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":136,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[5814,5814],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":152,"column":21,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":152,"endColumn":24},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"AI\"","line":154,"column":63,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":154,"endColumn":65},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Kilder fra data (\"","line":188,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":188,"endColumn":60},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"font-medium\">Kilder fra data ({sList.length})</span>","line":188,"column":43,"nodeType":"JSXText","endLine":188,"endColumn":60},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Klikk for å skjule\"","line":191,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":191,"endColumn":70},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"hidden sm:inline\">Klikk for å skjule</span>","line":191,"column":52,"nodeType":"JSXText","endLine":191,"endColumn":70},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Klikk for å vise\"","line":194,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":194,"endColumn":68},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"hidden sm:inline\">Klikk for å vise</span>","line":194,"column":52,"nodeType":"JSXText","endLine":194,"endColumn":68},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"`S${idx + 1}`\"","line":232,"column":121,"nodeType":"TemplateLiteral","messageId":"noStringsInJSX","endLine":232,"endColumn":134},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Kilder fra data (\"","line":244,"column":83,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":244,"endColumn":100},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <summary className=\"cursor-pointer select-none text-muted-foreground\">Kilder fra data ({sources.length})</summary>","line":244,"column":83,"nodeType":"JSXText","endLine":244,"endColumn":100},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":247,"column":26,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":247,"endColumn":27},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Henvisninger\"","line":256,"column":55,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":256,"endColumn":67},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"mb-1 text-muted-foreground\">Henvisninger</div>","line":256,"column":55,"nodeType":"JSXText","endLine":256,"endColumn":67},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'idx' is defined but never used. Allowed unused args must match /^_/u.","line":258,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":258,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":27,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import React from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Textarea } from '@/components/ui/textarea';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { openRouterClient } from '@/lib/ai/openrouterClient';\nimport type { ChatMessage } from '@/lib/ai/types';\nimport { toast } from 'sonner';\nimport { Copy, ChevronDown } from 'lucide-react';\nimport type { SourceItem } from '@/types/analytics';\nimport { buildCitationList, type CitationListItem } from './citation-utils';\nimport { sanitizePlainNorwegian, type AllowedContexts } from '@/lib/evidence/evidenceBuilder';\nimport { EntryDetailsDrawer } from './EntryDetailsDrawer';\n\nexport interface ExplanationChatProps {\n  aiEnabled: boolean;\n  systemPrompt: string;\n  initialMessages?: ChatMessage[];\n  onMessagesChange?: (messages: ChatMessage[]) => void;\n  className?: string;\n  sources?: string[];\n  sourcesRich?: SourceItem[];\n  allowed?: AllowedContexts;\n}\n\n// Citation list helpers moved to a small shared utility to avoid HMR export shape issues.\n\nexport function ExplanationChat({\n  aiEnabled,\n  systemPrompt,\n  initialMessages = [],\n  onMessagesChange,\n  className,\n  sources = [],\n  sourcesRich = [],\n  allowed\n}: ExplanationChatProps): React.ReactElement {\n  const [messages, setMessages] = React.useState<ChatMessage[]>(() => initialMessages);\n  const [input, setInput] = React.useState<string>('');\n  const [pending, setPending] = React.useState<boolean>(false);\n  const listRef = React.useRef<HTMLDivElement>(null);\n  const textareaRef = React.useRef<HTMLTextAreaElement>(null);\n  const { tAnalytics } = useTranslation();\n  const [detailsOpen, setDetailsOpen] = React.useState<boolean>(false);\n  const [selectedSource, setSelectedSource] = React.useState<SourceItem | null>(null);\n\n  React.useEffect(() => {\n    try { listRef.current?.scrollTo({ top: listRef.current.scrollHeight, behavior: 'smooth' }); } catch {}\n  }, [messages, pending]);\n\n  const onChangeRef = React.useRef(onMessagesChange);\n  React.useEffect(() => { onChangeRef.current = onMessagesChange; }, [onMessagesChange]);\n  React.useEffect(() => {\n    onChangeRef.current?.(messages);\n  }, [messages]);\n\n  const send = async () => {\n    const trimmed = input.trim();\n    if (!aiEnabled) { toast.error(String(tAnalytics('insights.chat.disabled'))); return; }\n    if (pending || trimmed.length === 0) return;\n    const next: ChatMessage[] = [...messages, { role: 'user', content: trimmed }];\n    setMessages(next);\n    setInput('');\n    try { textareaRef.current?.focus(); } catch {}\n    setPending(true);\n    try {\n      const chatMsgs: ChatMessage[] = [{ role: 'system', content: systemPrompt }, ...next.slice(-20)];\n      const { content } = await openRouterClient.chat(chatMsgs, undefined, { suppressToasts: true });\n      const base = String(content)\n        .replace(/\\*\\*(.*?)\\*\\*/g, '$1')\n        .replace(/__(.*?)__/g, '$1')\n        .replace(/`{1,3}([^`]+)`{1,3}/g, '$1')\n        .replace(/\\s+\\n/g, '\\n')\n        .trim();\n      const cleaned = allowed ? sanitizePlainNorwegian(base, allowed) : base;\n      setMessages((prev) => [...prev, { role: 'assistant', content: cleaned }]);\n      try { textareaRef.current?.focus(); } catch {}\n    } catch (e) {\n      toast.error('Kunne ikke hente AI-svar');\n    } finally {\n      setPending(false);\n    }\n  };\n\n  const handleKeyDown: React.KeyboardEventHandler<HTMLTextAreaElement> = (e) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      void send();\n    }\n  };\n\n  // Persisted UI state for sources panel (per session)\n  const STORAGE_KEYS = React.useMemo(() => ({\n    collapsed: 'explanationChat.sourcesCollapsed',\n    showAll: 'explanationChat.showAllSources'\n  }), []);\n  const [showAllSources, setShowAllSources] = React.useState<boolean>(() => {\n    try { const v = sessionStorage.getItem('explanationChat.showAllSources'); return v ? v === '1' : false; } catch { return false; }\n  });\n  const [sourcesCollapsed, setSourcesCollapsed] = React.useState<boolean>(() => {\n    try { const v = sessionStorage.getItem('explanationChat.sourcesCollapsed'); return v ? v === '1' : false; } catch { return false; }\n  });\n  React.useEffect(() => {\n    function handleCollapseAll() {\n      try { setSourcesCollapsed(true); setShowAllSources(false); } catch {}\n    }\n    function handleExpandAll() {\n      try { setSourcesCollapsed(false); setShowAllSources(true); } catch {}\n    }\n    window.addEventListener('explanationV2:collapseAll', handleCollapseAll as EventListener);\n    window.addEventListener('explanationV2:expandAll', handleExpandAll as EventListener);\n    return () => {\n      window.removeEventListener('explanationV2:collapseAll', handleCollapseAll as EventListener);\n      window.removeEventListener('explanationV2:expandAll', handleExpandAll as EventListener);\n    };\n  }, []);\n  React.useEffect(() => {\n    try { sessionStorage.setItem(STORAGE_KEYS.showAll, showAllSources ? '1' : '0'); } catch {}\n  }, [showAllSources, STORAGE_KEYS.showAll]);\n  React.useEffect(() => {\n    try { sessionStorage.setItem(STORAGE_KEYS.collapsed, sourcesCollapsed ? '1' : '0'); } catch {}\n  }, [sourcesCollapsed, STORAGE_KEYS.collapsed]);\n  const sList = React.useMemo<CitationListItem[]>(() => buildCitationList(sourcesRich), [sourcesRich]);\n\n  const usedCitationKeys = React.useMemo(() => {\n    const lastAssistant = [...messages].reverse().find((m) => m.role === 'assistant');\n    if (!lastAssistant) return new Set<string>();\n    const set = new Set<string>();\n    try {\n      const re = /\\[S(\\d+)\\]/g;\n      let m: RegExpExecArray | null;\n      // eslint-disable-next-line no-cond-assign\n      while ((m = re.exec(lastAssistant.content))) {\n        const n = Number(m[1]);\n        if (Number.isFinite(n) && n >= 1 && n <= sList.length) set.add(`S${n}`);\n      }\n    } catch {}\n    return set;\n  }, [messages, sList.length]);\n\n  const openDetails = (si: SourceItem) => {\n    setSelectedSource(si);\n    setDetailsOpen(true);\n  };\n\n  return (\n    <div className={className}>\n      <div ref={listRef} className=\"flex-1 min-h-[12rem] md:min-h-[14rem] lg:min-h-[16rem] overflow-auto rounded border bg-card p-3 space-y-3\" aria-live=\"polite\">\n        {messages.length === 0 && (\n          <p className=\"text-sm text-muted-foreground\">{String(tAnalytics('insights.chat.placeholder'))}</p>\n        )}\n        {messages.map((m, idx) => (\n          <div key={idx} className={m.role === 'user' ? 'text-right' : 'text-left'}>\n            <div className={`group inline-flex max-w-[85%] items-start gap-2 ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>\n              {m.role !== 'user' && <span className=\"sr-only\">AI</span>}\n              <div className={`rounded px-3 py-2 text-sm leading-relaxed whitespace-pre-wrap break-words ${m.role === 'user' ? 'bg-primary text-primary-foreground' : 'bg-muted text-foreground'}`}>\n                {m.content}\n              </div>\n              <button\n                type=\"button\"\n                className=\"invisible group-hover:visible inline-flex h-7 w-7 items-center justify-center rounded border text-muted-foreground hover:bg-accent/40\"\n                aria-label=\"Kopier melding\"\n                title=\"Kopier melding\"\n                onClick={async () => {\n                  try { await navigator.clipboard.writeText(m.content); toast.success(String(tAnalytics('insights.chat.copyOk'))); } catch { toast.error(String(tAnalytics('insights.chat.copyFail'))); }\n                }}\n              >\n                <Copy className=\"h-3.5 w-3.5\" />\n              </button>\n            </div>\n          </div>\n        ))}\n        {pending && (\n          <div className=\"text-left\">\n            <div className=\"inline-block rounded px-3 py-2 text-sm bg-muted text-muted-foreground\">{String(tAnalytics('insights.chat.aiTyping'))}</div>\n          </div>\n        )}\n      </div>\n      {sList.length > 0 ? (\n        <div className=\"mt-2 rounded border bg-muted/30 p-2 text-xs\">\n          <button\n            type=\"button\"\n            onClick={() => setSourcesCollapsed((v) => !v)}\n            aria-expanded={!sourcesCollapsed}\n            aria-controls=\"sources-list\"\n            className=\"mb-1 flex w-full items-center justify-between rounded px-1 py-1 text-muted-foreground hover:bg-accent/30\"\n            title=\"Toggle kildeliste\"\n          >\n            <span className=\"font-medium\">Kilder fra data ({sList.length})</span>\n            <span className={`inline-flex items-center gap-1 text-[11px]`}>\n              {!sourcesCollapsed && (\n                <span className=\"hidden sm:inline\">Klikk for å skjule</span>\n              )}\n              {sourcesCollapsed && (\n                <span className=\"hidden sm:inline\">Klikk for å vise</span>\n              )}\n              <ChevronDown className={`h-3.5 w-3.5 transition-transform ${sourcesCollapsed ? '' : 'rotate-180'}`} />\n            </span>\n          </button>\n          {!sourcesCollapsed && (\n            <div className=\"mb-1 flex items-center justify-end text-muted-foreground\">\n              <button\n                type=\"button\"\n                className=\"rounded border px-2 py-0.5 text-[11px] hover:bg-accent/40\"\n                onClick={() => setShowAllSources((v) => !v)}\n                aria-expanded={showAllSources}\n              >\n                {showAllSources ? 'Vis færre' : 'Vis mer'}\n              </button>\n            </div>\n          )}\n          {!sourcesCollapsed && (\n            <ul id=\"sources-list\" className=\"grid gap-1\">\n              {(showAllSources ? sList : sList.slice(-5)).map(({ key, source }, idx) => {\n              const ts = (() => { try { return new Date(source.timestamp).toISOString().replace('T', ' ').slice(0, 16); } catch { return String(source.timestamp); } })();\n              const primary = `${source.activity || source.place || 'sosial kontekst'} ${ts}`;\n              const emo = (source.emotions || []).map((e) => `${e.emotion}${typeof e.intensity === 'number' ? ` (${e.intensity})` : ''}`).join(', ');\n              const sen = (source.sensory || []).map((s) => `${s.type || 'sensor'}${s.response ? `: ${s.response}` : ''}${typeof s.intensity === 'number' ? ` (${s.intensity})` : ''}`).join(', ');\n              const meta = [source.note ? `notat: ${source.note}` : '', emo ? `følelser: ${emo}` : '', sen ? `sensorikk: ${sen}` : ''].filter(Boolean).join(' · ');\n              return (\n                <li key={key}>\n                  <button\n                    type=\"button\"\n                    onClick={() => openDetails(source)}\n                    className=\"w-full text-left rounded border bg-card px-2 py-1 hover:bg-accent/50 focus:outline-none focus:ring-2 focus:ring-ring\"\n                    aria-label={`Åpne detaljer for ${primary}`}\n                  >\n                    <div className=\"flex items-center justify-between gap-2\">\n                      <div className=\"truncate text-foreground\">\n                        <span className=\"font-medium\">{primary}</span>\n                        {meta && <div className=\"mt-0.5 text-[11px] text-muted-foreground line-clamp-2\">{meta}</div>}\n                      </div>\n                      <span className=\"ml-2 shrink-0 rounded bg-muted px-1.5 py-0.5 text-[10px] text-muted-foreground\">{`S${idx + 1}`}</span>\n                    </div>\n                  </button>\n                </li>\n              );\n              })}\n            </ul>\n          )}\n        </div>\n      ) : (\n        sources.length > 0 && (\n          <details className=\"mt-2 rounded border bg-muted/30 p-2 text-xs\">\n            <summary className=\"cursor-pointer select-none text-muted-foreground\">Kilder fra data ({sources.length})</summary>\n            <ul className=\"mt-2 list-disc pl-4 space-y-1\">\n              {sources.slice(0, 10).map((s, i) => (\n                <li key={i}>{s}</li>\n              ))}\n            </ul>\n          </details>\n        )\n      )}\n\n      {sList.length > 0 && (\n        <div className=\"mt-2 rounded border bg-muted/30 p-2 text-xs\">\n          <div className=\"mb-1 text-muted-foreground\">Henvisninger</div>\n          <div className=\"flex flex-wrap gap-1\">\n            {sList.map(({ key, source }, idx) => (\n              <button\n                key={key}\n                type=\"button\"\n                onClick={() => openDetails(source)}\n                className={`rounded border px-2 py-0.5 text-[11px] ${usedCitationKeys.has(key) ? 'bg-primary/10 border-primary text-primary' : 'text-muted-foreground hover:bg-accent/40'}`}\n                aria-label={`Åpne detaljer for henvisning ${key}`}\n                title={`${key}`}\n              >\n                {key}\n              </button>\n            ))}\n          </div>\n        </div>\n      )}\n      <div className=\"mt-2 flex items-end gap-2\">\n        <Textarea\n          ref={textareaRef}\n          value={input}\n          onChange={(e) => setInput(e.target.value)}\n          onKeyDown={handleKeyDown}\n          placeholder={String(tAnalytics('insights.chat.placeholder'))}\n          className=\"min-h-[44px]\"\n          disabled={!aiEnabled || pending}\n          aria-label={String(tAnalytics('insights.chat.placeholder'))}\n        />\n        <Button onClick={() => void send()} disabled={!aiEnabled || pending || input.trim().length === 0}>{String(tAnalytics('insights.chat.send'))}</Button>\n      </div>\n      <EntryDetailsDrawer open={detailsOpen} onOpenChange={setDetailsOpen} source={selectedSource} />\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/analytics-panels/ExplanationContent.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Kopier\"","line":39,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":40,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n            variant=\"outline\"\n            size=\"sm\"\n            disabled={!hasText}\n            onClick={() => hasText && onCopy?.(text as string)}\n            aria-label=\"Kopier tekst\"\n            title=\"Kopier tekst\"\n          >\n            <Copy className=\"h-4 w-4 mr-2\" />Kopier\n          </Button>","line":39,"column":46,"nodeType":"JSXText","endLine":40,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Rapport\"","line":49,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":50,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n            variant=\"secondary\"\n            size=\"sm\"\n            disabled={!hasText}\n            onClick={() => hasText && onAddToReport?.(text as string)}\n            aria-label=\"Legg til i rapport\"\n            title=\"Legg til i rapport\"\n          >\n            <FileText className=\"h-4 w-4 mr-2\" />Rapport\n          </Button>","line":49,"column":50,"nodeType":"JSXText","endLine":50,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Henter forklaring…\"","line":56,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":56,"endColumn":66},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">Henter forklaring…</p>","line":56,"column":48,"nodeType":"JSXText","endLine":56,"endColumn":66}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Copy, FileText } from 'lucide-react';\n\nexport interface ExplanationContentProps {\n  title: string;\n  status: 'idle' | 'loading' | 'ok' | 'error';\n  text?: string;\n  error?: string;\n  onCopy?: (text: string) => void;\n  onAddToReport?: (text: string) => void;\n  placeholder?: React.ReactNode;\n}\n\nexport function ExplanationContent({\n  title,\n  status,\n  text,\n  error,\n  onCopy,\n  onAddToReport,\n  placeholder\n}: ExplanationContentProps): React.ReactElement {\n  const hasText = Boolean(text && text.trim().length > 0);\n\n  return (\n    <div className=\"flex h-full flex-col\">\n      <div className=\"flex items-center justify-between\">\n        <h4 className=\"text-base font-semibold\">{title}</h4>\n        <div className=\"flex items-center gap-2\">\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            disabled={!hasText}\n            onClick={() => hasText && onCopy?.(text as string)}\n            aria-label=\"Kopier tekst\"\n            title=\"Kopier tekst\"\n          >\n            <Copy className=\"h-4 w-4 mr-2\" />Kopier\n          </Button>\n          <Button\n            variant=\"secondary\"\n            size=\"sm\"\n            disabled={!hasText}\n            onClick={() => hasText && onAddToReport?.(text as string)}\n            aria-label=\"Legg til i rapport\"\n            title=\"Legg til i rapport\"\n          >\n            <FileText className=\"h-4 w-4 mr-2\" />Rapport\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"mt-3 flex-1 rounded-lg border bg-card p-3 overflow-auto whitespace-pre-wrap break-words text-sm leading-relaxed\">\n        {status === 'loading' && (\n          <p className=\"text-muted-foreground\">Henter forklaring…</p>\n        )}\n        {status === 'error' && (\n          <p className=\"text-destructive\">{error || 'Klarte ikke hente forklaring. Prøv igjen.'}</p>\n        )}\n        {status === 'idle' && !hasText && (\n          <div className=\"text-muted-foreground\">{placeholder || 'Velg et mønster for å se forklaring.'}</div>\n        )}\n        {status === 'ok' && hasText && (\n          <div className=\"prose prose-sm max-w-none dark:prose-invert\">\n            {text}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/analytics-panels/ExplanationDock.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1123,1126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1123,1126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1140,1143],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1140,1143],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1162,1165],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1162,1165],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":55,"column":96,"nodeType":"BlockStatement","messageId":"unexpected","endLine":55,"endColumn":98,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1912,1912],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":58,"column":95,"nodeType":"BlockStatement","messageId":"unexpected","endLine":58,"endColumn":97,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2048,2048],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":60,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":60,"endColumn":93},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":61,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":61,"endColumn":89},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2618,2621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2618,2621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2643,2646],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2643,2646],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":119,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":122,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2673,2676],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2673,2676],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2796,2799],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2796,2799],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":73,"column":105,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":108,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2829,2832],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2829,2832],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Forklaring\"","line":77,"column":20,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":77,"endColumn":30},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle>Forklaring</CardTitle>","line":77,"column":20,"nodeType":"JSXText","endLine":77,"endColumn":30},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Data readiness for sosiale triggere:\"","line":83,"column":152,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":84,"endColumn":54},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className={readiness.label === 'ready' ? 'text-green-500' : readiness.label === 'partial' ? 'text-yellow-500' : 'text-orange-500'}>\n                Data readiness for sosiale triggere: {Math.round(readiness.score * 100)}% ({readiness.label})\n              </span>","line":83,"column":152,"nodeType":"JSXText","endLine":84,"endColumn":54},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"% (\"","line":84,"column":89,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":84,"endColumn":92},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className={readiness.label === 'ready' ? 'text-green-500' : readiness.label === 'partial' ? 'text-yellow-500' : 'text-orange-500'}>\n                Data readiness for sosiale triggere: {Math.round(readiness.score * 100)}% ({readiness.label})\n              </span>","line":84,"column":89,"nodeType":"JSXText","endLine":84,"endColumn":92},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":91,"column":64,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":91,"endColumn":65},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Legg til sosiale eksempler (dev)\"","line":100,"column":22,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":102,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={async () => { await seedSocialDemoData(dataset.entries[0].studentId); }}\n                    >\n                      Legg til sosiale eksempler (dev)\n                    </Button>","line":100,"column":22,"nodeType":"JSXText","endLine":102,"endColumn":21},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Chat om forklaringen\"","line":139,"column":78,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":139,"endColumn":98},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h5 className=\"mb-2 text-sm font-medium text-muted-foreground\">Chat om forklaringen</h5>","line":139,"column":78,"nodeType":"JSXText","endLine":139,"endColumn":98},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6045,6048],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6045,6048],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":116,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":119,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6080,6083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6080,6083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":161,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":164,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6125,6128],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6125,6128],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":157,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6777,6780],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6777,6780],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":157,"column":220,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":223,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6950,6953],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6950,6953],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":162,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7358,7361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7358,7361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7528,7531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7528,7531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":30,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { ExplanationContent } from './ExplanationContent';\nimport { evaluateSocialTriggerReadiness } from '@/lib/dataSufficiency';\nimport { ExplanationChat } from './ExplanationChat';\nimport { computeAllowedContexts } from '@/lib/evidence/evidenceBuilder';\nimport { seedSocialDemoData } from '@/lib/mock/socialSeeder';\nimport { Button } from '@/components/ui/button';\nimport type { SourceItem } from '@/types/analytics';\nimport { analyticsConfig } from '@/lib/analyticsConfig';\nimport { ExplanationTabs } from './ExplanationTabs';\n\nexport interface ExplanationDockProps {\n  patternTitle?: string;\n  status: 'idle' | 'loading' | 'ok' | 'error';\n  text?: string;\n  error?: string;\n  onCopy?: (text: string) => void;\n  onAddToReport?: (text: string) => void;\n  // Chat props\n  aiEnabled?: boolean;\n  systemPrompt?: string;\n  chatMessages?: import('@/lib/ai/types').ChatMessage[];\n  onChatChange?: (msgs: import('@/lib/ai/types').ChatMessage[]) => void;\n  // Data context for readiness indicator\n  dataset?: { entries: any[]; emotions: any[]; sensoryInputs: any[] };\n  // Rich sources for clickable citations/details\n  sourcesRich?: SourceItem[];\n}\n\nexport function ExplanationDock({\n  patternTitle,\n  status,\n  text,\n  error,\n  onCopy,\n  onAddToReport,\n  aiEnabled = false,\n  systemPrompt = '',\n  chatMessages = [],\n  onChatChange,\n  dataset,\n  sourcesRich\n}: ExplanationDockProps): React.ReactElement {\n  const enableV2 = React.useMemo(() => {\n    try {\n      return !!analyticsConfig.getConfig().features?.explanationV2;\n    } catch {\n      return false;\n    }\n  }, []);\n  const readinessDetailsRef = React.useRef<HTMLDetailsElement | null>(null);\n  React.useEffect(() => {\n    function handleCollapseAll() {\n      try { if (readinessDetailsRef.current) readinessDetailsRef.current.open = false; } catch {}\n    }\n    function handleExpandAll() {\n      try { if (readinessDetailsRef.current) readinessDetailsRef.current.open = true; } catch {}\n    }\n    window.addEventListener('explanationV2:collapseAll', handleCollapseAll as EventListener);\n    window.addEventListener('explanationV2:expandAll', handleExpandAll as EventListener);\n    return () => {\n      window.removeEventListener('explanationV2:collapseAll', handleCollapseAll as EventListener);\n      window.removeEventListener('explanationV2:expandAll', handleExpandAll as EventListener);\n    };\n  }, []);\n  const readiness = React.useMemo(() => {\n    try {\n      if (!dataset) return null;\n      return evaluateSocialTriggerReadiness(dataset.entries as any, dataset.emotions as any, dataset.sensoryInputs as any);\n    } catch { return null; }\n  }, [dataset]);\n  const isDev = typeof import.meta !== 'undefined' && ((import.meta as any).env?.DEV || (import.meta as any).env?.MODE === 'development');\n  return (\n    <Card className=\"h-full\">\n      <CardHeader>\n        <CardTitle>Forklaring</CardTitle>\n      </CardHeader>\n      <CardContent className=\"h-[calc(100vh-8rem)] 2xl:h-[calc(100vh-6rem)] overflow-hidden\">\n        {readiness && (\n          <details ref={readinessDetailsRef} className=\"mb-2 rounded border px-3 py-2 text-xs\" aria-label=\"Data readiness for sosiale triggere\">\n            <summary className=\"cursor-pointer select-none\">\n              <span className={readiness.label === 'ready' ? 'text-green-500' : readiness.label === 'partial' ? 'text-yellow-500' : 'text-orange-500'}>\n                Data readiness for sosiale triggere: {Math.round(readiness.score * 100)}% ({readiness.label})\n              </span>\n            </summary>\n            {(readiness.reasons.length > 0 || (isDev && dataset?.entries?.[0]?.studentId)) && (\n              <div className=\"mt-2\">\n                {readiness.reasons.length > 0 && (\n                  <ul className=\"list-disc pl-4 text-muted-foreground\">\n                    {readiness.reasons.map((r, i) => (<li key={i}>{r}</li>))}\n                  </ul>\n                )}\n                {isDev && dataset?.entries?.[0]?.studentId && (\n                  <div className=\"mt-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={async () => { await seedSocialDemoData(dataset.entries[0].studentId); }}\n                    >\n                      Legg til sosiale eksempler (dev)\n                    </Button>\n                  </div>\n                )}\n              </div>\n            )}\n          </details>\n        )}\n\n        {enableV2 ? (\n          <ExplanationTabs\n            patternTitle={patternTitle}\n            status={status}\n            text={text}\n            error={error}\n            onCopy={onCopy}\n            onAddToReport={onAddToReport}\n            aiEnabled={aiEnabled}\n            systemPrompt={systemPrompt}\n            chatMessages={chatMessages}\n            onChatChange={onChatChange}\n            dataset={dataset}\n            sourcesRich={sourcesRich}\n            className=\"h-full\"\n          />\n        ) : (\n          <div className=\"grid h-full grid-rows-[1fr_auto] gap-3\">\n            <div className=\"min-h-0\">\n              <ExplanationContent\n                title={patternTitle || 'Ingen mønster valgt'}\n                status={status}\n                text={text}\n                error={error}\n                onCopy={onCopy}\n                onAddToReport={onAddToReport}\n              />\n            </div>\n            <div className=\"border-t pt-2 min-h-[30vh]\">\n              <h5 className=\"mb-2 text-sm font-medium text-muted-foreground\">Chat om forklaringen</h5>\n              <ExplanationChat\n                aiEnabled={aiEnabled}\n                systemPrompt={systemPrompt}\n                initialMessages={chatMessages}\n                onMessagesChange={onChatChange}\n                sourcesRich={sourcesRich}\n                allowed={(() => {\n                  try {\n                    if (!dataset) return undefined;\n                    return computeAllowedContexts({ entries: dataset.entries as any, emotions: dataset.emotions as any, sensoryInputs: dataset.sensoryInputs as any });\n                  } catch { return undefined; }\n                })()}\n                sources={(() => {\n                  if (!dataset) return [];\n                  try {\n                    const entries = dataset.entries || [];\n                    const socialRe = /(sosial|sosiale|venn|venner|kompis|klasse|klasserom|gruppe|grupp(e|eoppgave)?|team|pararbeid|friminutt|pause|lunsj|frokost|middag|kveld(s)?stell|morgen(s)?rutine|morgenstell|morgenrutine|kantine|ute|inne|hjemme|avlast|interaksj|samarbeid|samspill|konflikt|lek|leke|presentasjon|diskusjon|overgang(er)?|medelever|familie|besøk)/i;\n                    return entries.filter((t: any) => socialRe.test(`${t?.environmentalData?.classroom?.activity || ''} ${t?.environmentalData?.location || ''} ${t?.notes || t?.generalNotes || ''}`)).slice(-10).map((t: any) => {\n                      const ts = new Date(t.timestamp).toISOString().replace('T', ' ').slice(0, 16);\n                      const act = t?.environmentalData?.classroom?.activity?.toString() || '';\n                      const loc = t?.environmentalData?.location || '';\n                      const label = act || loc || 'sosial kontekst';\n                      const emo = (t.emotions || []).map((e: any) => `${e.emotion} (intensitet ${typeof e.intensity === 'number' ? e.intensity : '?'})`).join(', ');\n                      const sen = (t.sensoryInputs || []).map((s: any) => `${s.sensoryType || s.type}: ${s.response}${typeof s.intensity === 'number' ? ` (intensitet ${s.intensity})` : ''}`).join(', ');\n                      const happened = (t.notes || t.generalNotes || '').trim();\n                      const parts = [ `${label} (${ts})`, happened ? `hendelse: ${happened}` : '', emo ? `følelser: ${emo}` : '', sen ? `sensorikk: ${sen}` : '' ].filter(Boolean);\n                      return parts.join(' · ');\n                    });\n                  } catch { return []; }\n                })()}\n              />\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/analytics-panels/ExplanationSheet.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[992,995],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[992,995],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1009,1012],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1009,1012],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1031,1034],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1031,1034],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":50,"column":78,"nodeType":"BlockStatement","messageId":"unexpected","endLine":50,"endColumn":80,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1680,1680],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":53,"column":77,"nodeType":"BlockStatement","messageId":"unexpected","endLine":53,"endColumn":79,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1798,1798],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":55,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":55,"endColumn":93},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":56,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":56,"endColumn":89},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Forklaring\"","line":66,"column":23,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":66,"endColumn":33},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SheetTitle>Forklaring</SheetTitle>","line":66,"column":23,"nodeType":"JSXText","endLine":66,"endColumn":33},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Chat om forklaringen\"","line":98,"column":80,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":98,"endColumn":100},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h5 className=\"mb-2 text-sm font-medium text-muted-foreground\">Chat om forklaringen</h5>","line":98,"column":80,"nodeType":"JSXText","endLine":98,"endColumn":100},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4121,4124],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4121,4124],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":118,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":121,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4156,4159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4156,4159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":163,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":166,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4201,4204],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4201,4204],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Sheet, SheetContent, SheetHeader, SheetTitle } from '@/components/ui/sheet';\nimport { ExplanationContent } from './ExplanationContent';\nimport { ExplanationChat } from './ExplanationChat';\nimport { computeAllowedContexts } from '@/lib/evidence/evidenceBuilder';\nimport type { SourceItem } from '@/types/analytics';\nimport { analyticsConfig } from '@/lib/analyticsConfig';\nimport { ExplanationTabs } from './ExplanationTabs';\n\nexport interface ExplanationSheetProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  patternTitle?: string;\n  status: 'idle' | 'loading' | 'ok' | 'error';\n  text?: string;\n  error?: string;\n  onCopy?: (text: string) => void;\n  onAddToReport?: (text: string) => void;\n  // Chat props\n  aiEnabled?: boolean;\n  systemPrompt?: string;\n  chatMessages?: import('@/lib/ai/types').ChatMessage[];\n  onChatChange?: (msgs: import('@/lib/ai/types').ChatMessage[]) => void;\n  sourcesRich?: SourceItem[];\n  dataset?: { entries: any[]; emotions: any[]; sensoryInputs: any[] };\n}\n\nexport function ExplanationSheet({\n  open,\n  onOpenChange,\n  patternTitle,\n  status,\n  text,\n  error,\n  onCopy,\n  onAddToReport,\n  aiEnabled = false,\n  systemPrompt = '',\n  chatMessages = [],\n  onChatChange,\n  sourcesRich,\n  dataset\n}: ExplanationSheetProps): React.ReactElement {\n  const enableV2 = React.useMemo(() => {\n    try { return !!analyticsConfig.getConfig().features?.explanationV2; } catch { return false; }\n  }, []);\n  const detailsRef = React.useRef<HTMLDetailsElement | null>(null);\n  React.useEffect(() => {\n    function handleCollapseAll() {\n      try { if (detailsRef.current) detailsRef.current.open = false; } catch {}\n    }\n    function handleExpandAll() {\n      try { if (detailsRef.current) detailsRef.current.open = true; } catch {}\n    }\n    window.addEventListener('explanationV2:collapseAll', handleCollapseAll as EventListener);\n    window.addEventListener('explanationV2:expandAll', handleExpandAll as EventListener);\n    return () => {\n      window.removeEventListener('explanationV2:collapseAll', handleCollapseAll as EventListener);\n      window.removeEventListener('explanationV2:expandAll', handleExpandAll as EventListener);\n    };\n  }, []);\n  return (\n    <Sheet open={open} onOpenChange={onOpenChange}>\n      <SheetContent side=\"bottom\" className=\"h-[75vh] md:h-[80vh]\">\n        <SheetHeader>\n          <SheetTitle>Forklaring</SheetTitle>\n        </SheetHeader>\n        <div className=\"mt-2 h-[calc(75vh-5rem)] md:h-[calc(80vh-5rem)] overflow-hidden\">\n          {enableV2 ? (\n            <ExplanationTabs\n              patternTitle={patternTitle}\n              status={status}\n              text={text}\n              error={error}\n              onCopy={onCopy}\n              onAddToReport={onAddToReport}\n              aiEnabled={aiEnabled}\n              systemPrompt={systemPrompt}\n              chatMessages={chatMessages}\n              onChatChange={onChatChange}\n              sourcesRich={sourcesRich}\n              dataset={dataset}\n              className=\"h-full\"\n            />\n          ) : (\n            <div className=\"grid h-full grid-rows-[1fr_auto] gap-3\">\n              <div className=\"min-h-0\">\n                <ExplanationContent\n                  title={patternTitle || 'Ingen mønster valgt'}\n                  status={status}\n                  text={text}\n                  error={error}\n                  onCopy={onCopy}\n                  onAddToReport={onAddToReport}\n                />\n              </div>\n              <div className=\"border-t pt-2\">\n                <h5 className=\"mb-2 text-sm font-medium text-muted-foreground\">Chat om forklaringen</h5>\n                <ExplanationChat\n                  aiEnabled={aiEnabled}\n                  systemPrompt={systemPrompt}\n                  initialMessages={chatMessages}\n                  onMessagesChange={onChatChange}\n                  sourcesRich={sourcesRich}\n                  allowed={(() => {\n                    try {\n                      if (!dataset) return undefined;\n                      return computeAllowedContexts({ entries: dataset.entries as any, emotions: dataset.emotions as any, sensoryInputs: dataset.sensoryInputs as any });\n                    } catch { return undefined; }\n                  })()}\n                />\n              </div>\n            </div>\n          )}\n        </div>\n      </SheetContent>\n    </Sheet>\n  );\n}\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/analytics-panels/ExplanationTabs.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[950,953],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[950,953],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[967,970],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[967,970],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[989,992],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[989,992],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":67,"column":101,"nodeType":"BlockStatement","messageId":"unexpected","endLine":67,"endColumn":103,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2713,2713],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3234,3237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3234,3237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3277,3280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3277,3280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3330,3333],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3330,3333],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'no-cond-assign').","line":97,"column":7,"severity":1,"nodeType":null,"fix":{"range":[3836,3878],"text":" "}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3923,3926],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3923,3926],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":102,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":102,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4081,4081],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Chat\"","line":111,"column":39,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":111,"endColumn":43},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"chat\">Chat</TabsTrigger>","line":111,"column":39,"nodeType":"JSXText","endLine":111,"endColumn":43},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Kilder\"","line":112,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":112,"endColumn":47},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"kilder\">Kilder</TabsTrigger>","line":112,"column":41,"nodeType":"JSXText","endLine":112,"endColumn":47},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Henvisninger\"","line":113,"column":47,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":113,"endColumn":59},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"henvisninger\">Henvisninger</TabsTrigger>","line":113,"column":47,"nodeType":"JSXText","endLine":113,"endColumn":59},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":121,"column":146,"nodeType":"BlockStatement","messageId":"unexpected","endLine":121,"endColumn":148,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4955,4955],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Skjul alt\"","line":124,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":126,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\n              type=\"button\"\n              className=\"rounded border px-2 py-1 text-[11px] text-muted-foreground hover:bg-accent/40\"\n              title=\"Skjul alt\"\n              onClick={() => {\n                try { window.dispatchEvent(new CustomEvent('explanationV2:collapseAll')); logger.info('[UI] explanationV2.collapseAll'); } catch {}\n                setShowAllKilder(false);\n              }}\n            >\n              Skjul alt\n            </button>","line":124,"column":14,"nodeType":"JSXText","endLine":126,"endColumn":13},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":132,"column":142,"nodeType":"BlockStatement","messageId":"unexpected","endLine":132,"endColumn":144,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[5430,5430],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Vis alt\"","line":135,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":137,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <button\n              type=\"button\"\n              className=\"rounded border px-2 py-1 text-[11px] text-muted-foreground hover:bg-accent/40\"\n              title=\"Vis alt\"\n              onClick={() => {\n                try { window.dispatchEvent(new CustomEvent('explanationV2:expandAll')); logger.info('[UI] explanationV2.expandAll'); } catch {}\n                setShowAllKilder(true);\n              }}\n            >\n              Vis alt\n            </button>","line":135,"column":14,"nodeType":"JSXText","endLine":137,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Åpne fanen for å laste kilder…\"","line":164,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":164,"endColumn":90},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">Åpne fanen for å laste kilder…</div>","line":164,"column":60,"nodeType":"JSXText","endLine":164,"endColumn":90},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Ingen kilder tilgjengelig.\"","line":166,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":166,"endColumn":86},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">Ingen kilder tilgjengelig.</div>","line":166,"column":60,"nodeType":"JSXText","endLine":166,"endColumn":86},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Kilder fra data (\"","line":170,"column":64,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":170,"endColumn":81},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">Kilder fra data ({sourcesList.length})</div>","line":170,"column":64,"nodeType":"JSXText","endLine":170,"endColumn":81},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'idx' is defined but never used. Allowed unused args must match /^_/u.","line":181,"column":94,"nodeType":null,"messageId":"unusedVar","endLine":181,"endColumn":97},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Åpne fanen for å vise henvisninger…\"","line":208,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":208,"endColumn":95},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">Åpne fanen for å vise henvisninger…</div>","line":208,"column":60,"nodeType":"JSXText","endLine":208,"endColumn":95},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Ingen henvisninger.\"","line":210,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":210,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">Ingen henvisninger.</div>","line":210,"column":60,"nodeType":"JSXText","endLine":210,"endColumn":79},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Henvisninger\"","line":213,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":213,"endColumn":74},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">Henvisninger</div>","line":213,"column":62,"nodeType":"JSXText","endLine":213,"endColumn":74}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":35,"fixableErrorCount":0,"fixableWarningCount":1,"source":"import React from 'react';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { ExplanationContent } from './ExplanationContent';\nimport { ExplanationChat } from './ExplanationChat';\nimport { buildCitationList, type CitationListItem } from './citation-utils';\nimport { computeAllowedContexts } from '@/lib/evidence/evidenceBuilder';\nimport type { SourceItem } from '@/types/analytics';\nimport { logger } from '@/lib/logger';\n\nexport interface ExplanationTabsProps {\n  // Core explanation props\n  patternTitle?: string;\n  status: 'idle' | 'loading' | 'ok' | 'error';\n  text?: string;\n  error?: string;\n  onCopy?: (text: string) => void;\n  onAddToReport?: (text: string) => void;\n  // Chat props\n  aiEnabled?: boolean;\n  systemPrompt?: string;\n  chatMessages?: import('@/lib/ai/types').ChatMessage[];\n  onChatChange?: (msgs: import('@/lib/ai/types').ChatMessage[]) => void;\n  // Data context\n  dataset?: { entries: any[]; emotions: any[]; sensoryInputs: any[] };\n  sourcesRich?: SourceItem[];\n  className?: string;\n}\n\n/**\n * New, tabbed explanation panel that separates Chat, Kilder, and Henvisninger.\n * This is intentionally simple for first scaffolding; richer behaviors like\n * virtualization and sticky composer will be layered on next.\n */\nexport function ExplanationTabs({\n  patternTitle,\n  status,\n  text,\n  error,\n  onCopy,\n  onAddToReport,\n  aiEnabled = false,\n  systemPrompt = '',\n  chatMessages = [],\n  onChatChange,\n  dataset,\n  sourcesRich = [],\n  className\n}: ExplanationTabsProps): React.ReactElement {\n  const toSlug = (s?: string) => (s || 'pattern').toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');\n  const storageBase = React.useMemo(() => `explanationV2.${toSlug(patternTitle)}`, [patternTitle]);\n  const readStorage = (k: string, fallback: string) => {\n    try { const v = localStorage.getItem(`${storageBase}.${k}`); return v || fallback; } catch { return fallback; }\n  };\n  const writeStorage = (k: string, v: string) => {\n    try { localStorage.setItem(`${storageBase}.${k}`, v); } catch { /* no-op */ }\n  };\n\n  const [tab, setTab] = React.useState<string>(() => readStorage('tab', 'chat'));\n  const [visited, setVisited] = React.useState<{ kilder: boolean; henvisninger: boolean }>(() => ({\n    kilder: readStorage('visited.kilder', '0') === '1',\n    henvisninger: readStorage('visited.henvisninger', '0') === '1',\n  }));\n  const [showAllKilder, setShowAllKilder] = React.useState<boolean>(() => readStorage('kilder.showAll', '0') === '1');\n  const handleTabChange = (val: string) => {\n    setTab(val);\n    writeStorage('tab', val);\n    try { logger.info('[UI] explanationV2.tabChange', { tab: val, pattern: patternTitle }); } catch {}\n    if (val === 'kilder' && !visited.kilder) {\n      setVisited((v) => { const n = { ...v, kilder: true }; writeStorage('visited.kilder', '1'); return n; });\n    }\n    if (val === 'henvisninger' && !visited.henvisninger) {\n      setVisited((v) => { const n = { ...v, henvisninger: true }; writeStorage('visited.henvisninger', '1'); return n; });\n    }\n  };\n  const allowed = React.useMemo(() => {\n    try {\n      if (!dataset) return undefined;\n      return computeAllowedContexts({\n        entries: dataset.entries as any,\n        emotions: dataset.emotions as any,\n        sensoryInputs: dataset.sensoryInputs as any,\n      });\n    } catch {\n      return undefined;\n    }\n  }, [dataset]);\n\n  const sourcesList = React.useMemo<CitationListItem[]>(() => buildCitationList(sourcesRich), [sourcesRich]);\n\n  const usedCitationKeys = React.useMemo(() => {\n    const lastAssistant = [...(chatMessages || [])].reverse().find((m) => m.role === 'assistant');\n    if (!lastAssistant) return new Set<string>();\n    const set = new Set<string>();\n    try {\n      const re = /\\[S(\\d+)\\]/g;\n      let m: RegExpExecArray | null;\n      // eslint-disable-next-line no-cond-assign\n      while ((m = re.exec((lastAssistant as any).content))) {\n        const n = Number(m[1]);\n        if (Number.isFinite(n) && n >= 1 && n <= sourcesList.length) set.add(`S${n}`);\n      }\n    } catch {}\n    return set;\n  }, [chatMessages, sourcesList.length]);\n\n  return (\n    <div className={className}>\n      <Tabs value={tab} onValueChange={handleTabChange}>\n        <div className=\"flex items-center justify-between gap-2\">\n          <TabsList>\n            <TabsTrigger value=\"chat\">Chat</TabsTrigger>\n            <TabsTrigger value=\"kilder\">Kilder</TabsTrigger>\n            <TabsTrigger value=\"henvisninger\">Henvisninger</TabsTrigger>\n          </TabsList>\n          <div className=\"flex items-center gap-2\">\n            <button\n              type=\"button\"\n              className=\"rounded border px-2 py-1 text-[11px] text-muted-foreground hover:bg-accent/40\"\n              title=\"Skjul alt\"\n              onClick={() => {\n                try { window.dispatchEvent(new CustomEvent('explanationV2:collapseAll')); logger.info('[UI] explanationV2.collapseAll'); } catch {}\n                setShowAllKilder(false);\n              }}\n            >\n              Skjul alt\n            </button>\n            <button\n              type=\"button\"\n              className=\"rounded border px-2 py-1 text-[11px] text-muted-foreground hover:bg-accent/40\"\n              title=\"Vis alt\"\n              onClick={() => {\n                try { window.dispatchEvent(new CustomEvent('explanationV2:expandAll')); logger.info('[UI] explanationV2.expandAll'); } catch {}\n                setShowAllKilder(true);\n              }}\n            >\n              Vis alt\n            </button>\n          </div>\n        </div>\n\n        <TabsContent value=\"chat\" className=\"mt-3\">\n          <div className=\"grid h-full grid-rows-[auto_1fr] gap-3\">\n            <ExplanationContent\n              title={patternTitle || 'Ingen mønster valgt'}\n              status={status}\n              text={text}\n              error={error}\n              onCopy={onCopy}\n              onAddToReport={onAddToReport}\n            />\n            <ExplanationChat\n              aiEnabled={aiEnabled}\n              systemPrompt={systemPrompt}\n              initialMessages={chatMessages}\n              onMessagesChange={onChatChange}\n              sourcesRich={sourcesRich}\n              allowed={allowed}\n            />\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"kilder\" className=\"mt-3\">\n          {tab !== 'kilder' && !visited.kilder ? (\n            <div className=\"text-sm text-muted-foreground\">Åpne fanen for å laste kilder…</div>\n          ) : sourcesList.length === 0 ? (\n            <div className=\"text-sm text-muted-foreground\">Ingen kilder tilgjengelig.</div>\n          ) : (\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"text-sm text-muted-foreground\">Kilder fra data ({sourcesList.length})</div>\n                <button\n                  type=\"button\"\n                  className=\"rounded border px-2 py-0.5 text-[11px] text-muted-foreground hover:bg-accent/40\"\n                  onClick={() => { setShowAllKilder((v) => { const n = !v; writeStorage('kilder.showAll', n ? '1' : '0'); return n; }); }}\n                  aria-expanded={showAllKilder}\n                >\n                  {showAllKilder ? 'Vis færre' : 'Vis mer'}\n                </button>\n              </div>\n              <ul className=\"grid gap-2\">\n                {(showAllKilder ? sourcesList : sourcesList.slice(-8)).map(({ key, source }, idx) => {\n                  const ts = (() => {\n                    try { return new Date(source.timestamp).toISOString().replace('T', ' ').slice(0, 16); } catch { return String(source.timestamp); }\n                  })();\n                  const primary = `${source.activity || source.place || 'sosial kontekst'} ${ts}`;\n                  const emo = (source.emotions || []).map((e) => `${e.emotion}${typeof e.intensity === 'number' ? ` (${e.intensity})` : ''}`).join(', ');\n                  const sen = (source.sensory || []).map((s) => `${s.type || 'sensor'}${s.response ? `: ${s.response}` : ''}${typeof s.intensity === 'number' ? ` (${s.intensity})` : ''}`).join(', ');\n                  const meta = [source.note ? `notat: ${source.note}` : '', emo ? `følelser: ${emo}` : '', sen ? `sensorikk: ${sen}` : ''].filter(Boolean).join(' · ');\n                  return (\n                    <li key={key} className=\"rounded border bg-card px-3 py-2\">\n                      <div className=\"flex items-center justify-between gap-2\">\n                        <div className=\"min-w-0\">\n                          <div className=\"truncate font-medium\">{primary}</div>\n                          {meta && <div className=\"mt-0.5 text-[12px] text-muted-foreground line-clamp-2\">{meta}</div>}\n                        </div>\n                        <span className=\"ml-2 shrink-0 rounded bg-muted px-1.5 py-0.5 text-[10px] text-muted-foreground\">{key}</span>\n                      </div>\n                    </li>\n                  );\n                })}\n              </ul>\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"henvisninger\" className=\"mt-3\">\n          {tab !== 'henvisninger' && !visited.henvisninger ? (\n            <div className=\"text-sm text-muted-foreground\">Åpne fanen for å vise henvisninger…</div>\n          ) : sourcesList.length === 0 ? (\n            <div className=\"text-sm text-muted-foreground\">Ingen henvisninger.</div>\n          ) : (\n            <div className=\"space-y-2\">\n              <div className=\"text-sm text-muted-foreground\">Henvisninger</div>\n              <div className=\"flex flex-wrap gap-1\">\n                {sourcesList.map(({ key }) => (\n                  <span\n                    key={key}\n                    className={`rounded border px-2 py-0.5 text-[11px] ${usedCitationKeys.has(key) ? 'bg-primary/10 border-primary text-primary' : 'text-muted-foreground'}`}\n                  >\n                    {key}\n                  </span>\n                ))}\n              </div>\n            </div>\n          )}\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/analytics-panels/PatternsPanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'z' is defined but never used. Allowed unused vars must match /^_/u.","line":17,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":17,"endColumn":11},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":72,"column":30,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":72,"endColumn":69},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4419,4422],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4419,4422],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":101,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4483,4486],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4483,4486],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":138,"column":99,"nodeType":"BlockStatement","messageId":"unexpected","endLine":138,"endColumn":101,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[6524,6524],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":146,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6866,6869],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6866,6869],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":147,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6914,6917],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6914,6917],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":148,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6972,6975],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6972,6975],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":151,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7075,7078],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7075,7078],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7123,7126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7123,7126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":153,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7181,7184],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7181,7184],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":180,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8611,8614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8611,8614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":186,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8866,8869],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8866,8869],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":209,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":209,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[9960,9960],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":217,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10199,10202],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10199,10202],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":219,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":219,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10336,10339],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10336,10339],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":228,"column":92,"nodeType":"BlockStatement","messageId":"unexpected","endLine":228,"endColumn":94,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[10832,10832],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":241,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":241,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11671,11674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11671,11674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":242,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":242,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11721,11724],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11721,11724],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":243,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":243,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11781,11784],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11781,11784],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":248,"column":110,"nodeType":"BlockStatement","messageId":"unexpected","endLine":248,"endColumn":112,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[12045,12045],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":249,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12075,12078],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12075,12078],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":263,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":263,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12644,12647],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12644,12647],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":263,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":263,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12666,12669],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12666,12669],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":272,"column":96,"nodeType":"BlockStatement","messageId":"unexpected","endLine":272,"endColumn":98,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[13028,13028],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'text' is defined but never used. Allowed unused args must match /^_/u.","line":285,"column":30,"nodeType":null,"messageId":"unusedVar","endLine":285,"endColumn":34},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":287,"column":59,"nodeType":"BlockStatement","messageId":"unexpected","endLine":287,"endColumn":61,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[13428,13428],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":318,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14857,14860],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14857,14860],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":319,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":319,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15021,15024],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15021,15024],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":320,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":320,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15135,15138],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15135,15138],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":323,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":323,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15291,15294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15291,15294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":324,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":324,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15337,15340],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15337,15340],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":325,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":325,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15393,15396],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15393,15396],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":329,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":329,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15507,15510],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15507,15510],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":330,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":330,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15553,15556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15553,15556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":331,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":331,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15609,15612],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15609,15612],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":379,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":379,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18307,18310],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18307,18310],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":385,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":385,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18723,18726],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18723,18726],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useCallback has a missing dependency: 'results'. Either include it or remove the dependency array.","line":437,"column":6,"nodeType":"ArrayExpression","endLine":437,"endColumn":92,"suggestions":[{"desc":"Update the dependencies array to be: [filteredData.entries, filteredData.emotions, filteredData.sensoryInputs, results, currentText]","fix":{"range":[21821,21907],"text":"[filteredData.entries, filteredData.emotions, filteredData.sensoryInputs, results, currentText]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sourcesList' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":440,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":440,"endColumn":20},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":704,"column":27,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":704,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":705,"column":128,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":705,"endColumn":131,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35871,35874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35871,35874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":42,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { memo, useEffect } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Brain, Eye, BarChart3, Clock, Info, TrendingUp } from 'lucide-react';\nimport { useAnalyticsWorker } from '@/hooks/useAnalyticsWorker';\nimport { TrackingEntry, EmotionEntry, SensoryEntry, Student } from '@/types/student';\nimport { PatternResult } from '@/lib/patternAnalysis';\nimport { generateInsightsStructured } from '@/lib/insights';\nimport { stableKeyFromPattern } from '@/lib/key';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { hashOfString } from '@/lib/key';\nimport { openRouterClient } from '@/lib/ai/openrouterClient';\nimport { buildEvidenceForPattern, computeAllowedContexts, sanitizePlainNorwegian } from '@/lib/evidence/evidenceBuilder';\nimport { loadAiConfig } from '@/lib/aiConfig';\nimport { validateAIResponse } from '@/lib/evidence/validation';\nimport { z } from 'zod';\nimport { logger } from '@/lib/logger';\nimport { toast } from 'sonner';\nimport { ExplanationDock } from './ExplanationDock';\nimport { ExplanationSheet } from './ExplanationSheet';\nimport type { SourceItem } from '@/types/analytics';\nimport { ResizableSplitLayout } from '@/components/layouts/ResizableSplitLayout';\nimport { analyticsConfig } from '@/lib/analyticsConfig';\n\nexport interface PatternsPanelProps {\n  filteredData: {\n    entries: TrackingEntry[];\n    emotions: EmotionEntry[];\n    sensoryInputs: SensoryEntry[];\n  };\n  useAI?: boolean;\n  student?: Student;\n}\n\nconst getPatternIcon = (type: string): React.ReactElement => {\n  switch (type) {\n    case 'emotion':\n      return <Brain className=\"h-4 w-4\" />;\n    case 'sensory':\n      return <Eye className=\"h-4 w-4\" />;\n    case 'environmental':\n      return <BarChart3 className=\"h-4 w-4\" />;\n    default:\n      return <TrendingUp className=\"h-4 w-4\" />;\n  }\n};\n\nconst getConfidenceColor = (confidence: number): string => {\n  if (confidence > 0.7) return 'text-green-600';\n  if (confidence > 0.4) return 'text-yellow-600';\n  return 'text-orange-600';\n};\n\nexport const PatternsPanel = memo(function PatternsPanel({ filteredData, useAI = false, student }: PatternsPanelProps): React.ReactElement {\n  const { results, isAnalyzing, error, runAnalysis } = useAnalyticsWorker({ precomputeOnIdle: false });\n  const { tAnalytics } = useTranslation();\n  const [explanations, setExplanations] = React.useState<Record<string, { status: 'idle' | 'loading' | 'ok' | 'error'; text?: string; error?: string }>>({});\n  const [selectedKey, setSelectedKey] = React.useState<string | null>(null);\n  const [selectedTitle, setSelectedTitle] = React.useState<string>('');\n  const [isSheetOpen, setIsSheetOpen] = React.useState<boolean>(false);\n  const dockRef = React.useRef<HTMLDivElement>(null);\n\n  // Track viewport to decide dock vs sheet\n  const [isSmallViewport, setIsSmallViewport] = React.useState<boolean>(false);\n  React.useEffect(() => {\n    if (typeof window === 'undefined') return;\n    const mq = window.matchMedia('(max-width: 1023px)');\n    const onChange = () => setIsSmallViewport(mq.matches);\n    onChange();\n    // Support older Safari\n    if (mq.addEventListener) mq.addEventListener('change', onChange); else mq.addListener(onChange);\n    return () => { if (mq.removeEventListener) mq.removeEventListener('change', onChange); else mq.removeListener(onChange); };\n  }, []);\n  // Determine AI availability (guard explanation feature when key is missing)\n  const aiConfig = loadAiConfig();\n  const aiKeyPresent = React.useMemo(() => {\n    if (aiConfig?.apiKey && String(aiConfig.apiKey).trim().length > 0) return true;\n    try {\n      const ls = (typeof localStorage !== 'undefined')\n        ? ((localStorage.getItem('OPENROUTER_API_KEY') || localStorage.getItem('VITE_OPENROUTER_API_KEY') || '').trim())\n        : '';\n      return ls.length > 0;\n    } catch {\n      return false;\n    }\n  }, [aiConfig?.apiKey]);\n\n  useEffect(() => {\n    runAnalysis(filteredData, { useAI, student });\n    return () => {\n      // ensure worker side effects are cleaned by the hook on unmount\n    };\n  }, [filteredData, runAnalysis, useAI, student]);\n\n  const patterns: PatternResult[] = results?.patterns || [];\n  const structured = generateInsightsStructured(\n    {\n      patterns: results?.patterns || [],\n      correlations: (results as any)?.correlations || [],\n      predictiveInsights: (results as any)?.predictiveInsights || [],\n    },\n    filteredData.emotions,\n    filteredData.entries\n  );\n\n  const explainKey = (p: PatternResult) => stableKeyFromPattern(p);\n\n  const buildPrompt = (p: PatternResult) => {\n    const total = filteredData.entries?.length || 0;\n    const pct = p.dataPoints > 0 ? Math.round((p.frequency / Math.max(1, p.dataPoints)) * 100) : undefined;\n    const recs = Array.isArray(p.recommendations) && p.recommendations.length > 0 ? `\\nExisting recommendations: ${p.recommendations.join('; ')}` : '';\n    const studentName = student?.name || 'studenten';\n    return [\n      `Du er en hjelpelærer som forklarer mønstre tydelig for foresatte og lærere.`,\n      `Viktige føringer: Svar alltid på norsk (bokmål). Ikke bruk Markdown eller annen formatering (ingen **, *, #, kodeblokker). Svar som ren tekst.`,\n      `Bruk korte setninger og en enkel punktliste med bindestrek (-) der det passer.`,\n      `Oppgave: Forklar kort hva dette mønsteret betyr for ${studentName}, hvorfor det kan oppstå, og foreslå 2–3 konkrete tiltak.`,\n      `Unngå kliniske diagnoser. Skriv vennlig, konkret og uten teknisk sjargong.`,\n      `Mønster: ${p.pattern} (type: ${p.type})`,\n      `Beskrivelse: ${p.description}`,\n      typeof pct === 'number' ? `Andel nylige økter: ${pct}% (data: ${p.frequency}/${p.dataPoints}, tidsrom: ${p.timeframe})` : `Datapunkter: ${p.dataPoints} (tidsrom: ${p.timeframe})`,\n      recs,\n      total ? `Totalt antall økter i utvalget: ${total}.` : '',\n      `Format:`,\n      `- Kort forklaring (1–2 setninger)`,\n      `- Mulige årsaker (punkter)`,\n      `- Forslag til tiltak (punkter)`\n    ].filter(Boolean).join('\\n');\n  };\n\n  const requestExplanation = async (p: PatternResult) => {\n    const key = explainKey(p);\n    setExplanations((prev) => ({ ...prev, [key]: { status: 'loading' } }));\n    try {\n      // Guard: if no API key is present, short-circuit with a friendly message\n      if (!aiKeyPresent) {\n        try { logger.warn('[PatternsPanel] AI explanation unavailable: missing API key'); } catch {}\n        setExplanations((prev) => ({\n          ...prev,\n          [key]: { status: 'error', error: String(tAnalytics('ai.toggle.unavailable', { defaultValue: 'AI er ikke tilgjengelig (mangler API-nøkkel).' })) },\n        }));\n        return;\n      }\n      const evidence = buildEvidenceForPattern({\n        entries: filteredData.entries as any,\n        emotions: filteredData.emotions as any,\n        sensoryInputs: filteredData.sensoryInputs as any,\n      });\n      const allowed = computeAllowedContexts({\n        entries: filteredData.entries as any,\n        emotions: filteredData.emotions as any,\n        sensoryInputs: filteredData.sensoryInputs as any,\n      });\n      const prompt = [\n        buildPrompt(p),\n        '',\n        'Tillatte kontekster (bruk bare disse hvis relevant):',\n        `Steder: ${allowed.places.length ? allowed.places.join(', ') : 'ikke logget'}`,\n        `Aktiviteter: ${allowed.activities.length ? allowed.activities.join(', ') : 'ikke logget'}`,\n        `Triggere: ${allowed.triggers.length ? allowed.triggers.join(', ') : 'ikke logget'}`,\n        '',\n        'Eksempler (referer til dem med ID):',\n        ...evidence.map(e => `- [${e.id}] ${e.timestamp} · ${e.description}`),\n        '',\n        'Regler:',\n        '- Ikke nevne sted/aktivitet/årsak som ikke finnes i listen over.',\n        '- Bruk ID-er fra eksempler når du viser til konkrete hendelser.',\n      ].join('\\n');\n      const aiCfg = loadAiConfig();\n      // Use centralized validation\n      const { data } = await openRouterClient.chatJSON([\n        { role: 'system', content: 'Du svarer alltid på norsk (bokmål). Ingen Markdown eller stjerner; ren tekst. Bruk kun fakta fra evidence og tillatte kontekster. Referer til eksempler via ID der det passer.' },\n        { role: 'user', content: `${prompt}\\n\\nReturner JSON i formatet: { summary, causes[], interventions[], examples[] } hvor examples bruker id-ene over.` },\n      ], { \n        modelName: aiCfg.modelName, \n        baseUrl: aiCfg.baseUrl, \n        temperature: 0.2, \n        maxTokens: 550, \n        localOnly: (aiCfg as any).localOnly, \n        ensureJson: true, \n        refine: (val: unknown) => validateAIResponse(val) \n      });\n\n      // Human-friendly example rendering (map IDs to names based on evidence)\n      const friendlyExamples = (data.examples || []).map((ex: any) => {\n        const ev = evidence.find((e) => e.id === ex.id);\n        if (!ev) {\n          return ex.whyRelevant ? `- ${ex.whyRelevant}` : '';\n        }\n        let name = '';\n        try {\n          const ts = new Date(ev.timestamp).toISOString().replace('T', ' ').slice(0, 16);\n          if (ev.kind === 'tracking') {\n            // Prefer first part before separator as short name\n            const base = (ev.description || '').split('·')[0].trim();\n            name = base || 'Registrering';\n            return `- ${name} (${ts})${ex.whyRelevant ? ' – ' + ex.whyRelevant : ''}`;\n          }\n          if (ev.kind === 'emotion') {\n            const m = (ev.description || '').match(/^(.+?)\\s+intensitet\\s+(\\d+)/i);\n            name = m ? `Følelse: ${m[1]} (${m[2]})` : `Følelse`;\n            return `- ${name} (${ts})${ex.whyRelevant ? ' – ' + ex.whyRelevant : ''}`;\n          }\n          if (ev.kind === 'sensory') {\n            name = `Sensorikk: ${ev.description}`;\n            return `- ${name} (${ts})${ex.whyRelevant ? ' – ' + ex.whyRelevant : ''}`;\n          }\n        } catch {}\n        return ex.whyRelevant ? `- ${ex.whyRelevant}` : '';\n      }).filter(Boolean);\n\n      const render = [\n        data.summary,\n        '',\n        data.causes?.length ? 'Mulige årsaker:' : '',\n        ...(data.causes || []).map((c: any) => `- ${c.text}`),\n        data.interventions?.length ? '\\nForslag til tiltak:' : '',\n        ...(data.interventions || []).map((i: any) => `- ${i.text}`),\n        friendlyExamples.length ? '\\nEksempler:' : '',\n        ...friendlyExamples,\n      ].filter(Boolean).join('\\n');\n\n      const cleaned = sanitizePlainNorwegian(render, allowed);\n      setExplanations((prev) => ({ ...prev, [key]: { status: 'ok', text: cleaned } }));\n    } catch (e) {\n      // Non-fatal: explanation may fail; try a plain-text fallback, then show nice error\n      try { logger.warn('[PatternsPanel] explanation request failed', e as Error); } catch {}\n      try {\n        const aiCfg = loadAiConfig();\n        const fallbackPrompt = [\n          buildPrompt(p),\n          '',\n          'Returner kun ren tekst uten Markdown. Lag korte punkter. Inkluder 2–3 konkrete tiltak og 2–3 korte eksempler (med enkle, menneskelige navn – ikke tekniske ID-er).',\n        ].join('\\n');\n        const { content } = await openRouterClient.chat([\n          { role: 'system', content: 'Svar på norsk (bokmål). Ingen Markdown – kun ren tekst. Hold det kort og bruk enkle navn på eksempler.' },\n          { role: 'user', content: fallbackPrompt },\n        ], { modelName: aiCfg.modelName, baseUrl: aiCfg.baseUrl, temperature: 0.2, maxTokens: 550 }, { suppressToasts: true });\n        const cleaned = sanitizePlainNorwegian(String(content), computeAllowedContexts({\n          entries: filteredData.entries as any,\n          emotions: filteredData.emotions as any,\n          sensoryInputs: filteredData.sensoryInputs as any,\n        }));\n        setExplanations((prev) => ({ ...prev, [key]: { status: 'ok', text: cleaned } }));\n        return;\n      } catch (fallbackErr) {\n        try { logger.warn('[PatternsPanel] fallback explanation also failed', fallbackErr as Error); } catch {}\n        const anyErr = e as any;\n        const errMsg = typeof anyErr?.userMessage === 'string' && anyErr.userMessage.trim().length > 0\n          ? anyErr.userMessage\n          : (typeof anyErr?.message === 'string' && anyErr.message.trim().length > 0\n            ? anyErr.message\n            : 'Klarte ikke hente forklaring. Prøv igjen.');\n        setExplanations((prev) => ({ ...prev, [key]: { status: 'error', error: errMsg } }));\n      }\n    }\n  };\n\n  const handleExplainClick = (p: PatternResult) => {\n    const key = explainKey(p);\n    setSelectedKey(key);\n    setSelectedTitle(String((p as any).pattern ?? (p as any).name ?? 'Mønster'));\n    const st = explanations[key]?.status;\n    if (!st || st === 'idle') {\n      void requestExplanation(p);\n    }\n    // Desktop: scroll dock into view; Mobile: open sheet\n    if (isSmallViewport) {\n      setIsSheetOpen(true);\n    } else {\n      try { dockRef.current?.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); } catch {}\n    }\n  };\n\n  const handleCopy = async (text: string) => {\n    try {\n      await navigator.clipboard.writeText(text);\n      toast.success('Kopiert til utklippstavlen');\n    } catch {\n      toast.error('Kunne ikke kopiere');\n    }\n  };\n\n  const handleAddToReport = (text: string) => {\n    // Placeholder for integration with report builder\n    try { toast.info('Lagt til i rapportutkast'); } catch {}\n  };\n\n  const current = selectedKey ? explanations[selectedKey] : undefined;\n  const currentStatus: 'idle' | 'loading' | 'ok' | 'error' = current?.status || 'idle';\n  const currentText: string | undefined = current?.text;\n  const currentError: string | undefined = current?.error;\n\n  // Simple per-pattern chat storage (in-memory for the session)\n  const [chatByKey, setChatByKey] = React.useState<Record<string, { role: 'user' | 'assistant' | 'system'; content: string }[]>>({});\n  const chatMessages = selectedKey ? (chatByKey[selectedKey] || []) : [];\n  const updateChat = React.useCallback((msgs: { role: 'user' | 'assistant' | 'system'; content: string }[]) => {\n    setChatByKey((prev) => {\n      const key = selectedKey;\n      if (!key) return prev;\n      if (prev[key] === msgs) return prev; // avoid unnecessary state churn\n      return { ...prev, [key]: msgs.slice(-20) };\n    });\n  }, [selectedKey]);\n\n  // Build compact, grounded system prompt for the chat\n  const buildSystemPrompt = React.useCallback((): string => {\n    const total = filteredData.entries?.length || 0;\n    const allEntries = filteredData.entries || [];\n    const recent = allEntries.slice(-40);\n    const allEmotions = filteredData.emotions || [];\n    const emotions = allEmotions.slice(-160);\n    const allSensory = filteredData.sensoryInputs || [];\n    const sensory = allSensory.slice(-160);\n\n    // Basic compactors\n    const fmtEntry = (e: any) => `${e.timestamp || e.time || ''} · ${e.activity || e.title || 'økt'}${e.note ? ` · ${String(e.note).slice(0, 80)}` : ''}`.trim();\n    const fmtEmotion = (e: any) => `${e.type || e.emotion}:${e.intensity ?? e.value ?? ''}@${e.timestamp || ''}`;\n    const fmtSensory = (s: any) => `${s.type || s.kind}:${s.level ?? ''}@${s.timestamp || ''}`;\n\n    const evidence = buildEvidenceForPattern({\n      entries: filteredData.entries as any,\n      emotions: filteredData.emotions as any,\n      sensoryInputs: filteredData.sensoryInputs as any,\n      limit: 40,\n    });\n    const allowed = computeAllowedContexts({\n      entries: filteredData.entries as any,\n      emotions: filteredData.emotions as any,\n      sensoryInputs: filteredData.sensoryInputs as any,\n    });\n\n    // Heuristic tagging for social-related examples, to help the AI answer\n    const socialRe = /(sosial|sosiale|venn|venner|kompis|klasse|klasserom|gruppe|grupp(e|eoppgave)?|team|pararbeid|friminutt|pause|lunsj|frokost|middag|kveld(s)?stell|morgen(s)?rutine|morgenstell|morgenrutine|kantine|ute|inne|hjemme|avlast|interaksj|samarbeid|samspill|konflikt|lek|leke|presentasjon|diskusjon|overgang(er)?|medelever|familie|besøk)/i;\n    const socialExamplesFromEvidence = evidence.filter((e) => socialRe.test(String(e.description)));\n    // Scan the full timeline (not only evidence) for social contexts in structured fields and notes\n    const socialFromTimeline = allEntries\n      .map((t) => ({\n        id: `tracking:${t.id}`,\n        ts: t.timestamp,\n        act: t.environmentalData?.classroom?.activity?.toString() || '',\n        loc: t.environmentalData?.location || '',\n        note: t.notes || t.generalNotes || '',\n      }))\n      .filter((x) => socialRe.test(`${x.act} ${x.loc} ${x.note}`))\n      .slice(-60)\n      .map((x) => {\n        const ts = new Date(x.ts).toISOString().replace('T', ' ').slice(0, 16);\n        const label = `${x.act || x.loc || 'sosial kontekst'}`;\n        return `- ${label} (${ts})${x.note ? ' – ' + x.note : ''}`;\n      });\n    const socialExamples = [\n      ...socialExamplesFromEvidence.map((e) => {\n        const ts = new Date(e.timestamp).toISOString().replace('T', ' ').slice(0, 16);\n        return `- ${e.description} (${ts})`;\n      }),\n      ...socialFromTimeline,\n    ].slice(0, 60);\n\n    // Global aggregates across the entire dataset (not just recent)\n    const agg = (arr: (string | undefined)[]) => {\n      const counts = new Map<string, number>();\n      for (const v of arr) {\n        const k = (v || '').toString().trim().toLowerCase();\n        if (!k) continue; counts.set(k, (counts.get(k) || 0) + 1);\n      }\n      return Array.from(counts.entries()).sort((a, b) => b[1] - a[1]).slice(0, 12).map(([k, c]) => `${k} (${c})`);\n    };\n    const topActivities = agg(allEntries.map((e) => e.environmentalData?.classroom?.activity?.toString()));\n    const topPlaces = agg([ ...allEntries.map((e) => e.environmentalData?.location), ...allSensory.map((s) => s.location) ]);\n    const topTriggers = agg(allEmotions.flatMap((em) => (em.triggers || []) as string[]));\n\n    // Timespan summary across all data\n    const times = allEntries.map(e => e.timestamp.getTime());\n    const spanDays = times.length > 1 ? Math.max(1, Math.round((Math.max(...times) - Math.min(...times)) / (1000*60*60*24))) : 0;\n\n    // Summaries of detected patterns/correlations (when available)\n    const detectedPatterns = (results?.patterns || []).slice(0, 8).map((p: any) => {\n      const name = (p.pattern || p.name || '').toString();\n      const pct = typeof p.confidence === 'number' ? `${Math.round(p.confidence * 100)}%` : '';\n      const freq = typeof p.frequency === 'number' && typeof p.dataPoints === 'number' ? `${p.frequency}/${p.dataPoints}` : '';\n      return `- ${name}${pct ? ` (${pct})` : ''}${freq ? ` · ${freq}` : ''}`;\n    });\n    const correlations = (results as any)?.correlations as Array<{ factor1: string; factor2: string; correlation?: number }> | undefined;\n    const correlationSummary = Array.isArray(correlations)\n      ? correlations.slice(0, 8).map((c) => `- ${c.factor1} ↔ ${c.factor2}${typeof c.correlation === 'number' ? ` (r=${c.correlation.toFixed(2)})` : ''}`)\n      : [];\n\n    const summary = [\n      'Du svarer alltid på norsk (bokmål). Ingen Markdown; ren tekst.',\n      'Svar må være konkrete og korte, med punktliste når det passer.',\n      'Bruk bare fakta fra konteksten under. Hvis informasjon mangler, skriv først én setning som forklarer hva som mangler og foreslå hva brukeren kan gjøre for å få et bedre svar. Deretter svarer du på det som KAN besvares fra konteksten. Svar ALDRI kun med ordet \"ukjent\".',\n      'Når brukeren spør om sosiale triggere:',\n      '- Start med å sjekke listen \"Sosiale eksempler\" (under) og oppgi topp 3 relevante ID-er.',\n      '- Hvis listen er tom, søk i \"Eksempler\" etter ord som gruppe, friminutt, diskusjon, presentasjon, samarbeid, konflikt, venner, klasse.',\n      '- Hvis du fortsatt ikke finner klare eksempler, foreslå konkrete datapunkter/tidsstempler fra \"Siste økter\" eller \"Emosjoner\" som sannsynlige kandidater og forklar hvorfor, slik at brukeren kan verifisere dem.',\n      'Ikke skriv tekniske ID-er (som [tracking:...]). Gi eksemplene korte navn basert på sted/aktivitet og tidspunkt (f.eks. \"Friminutt i kantina 12:15\").',\n      '',\n      `Utvalg: ${total} økter totalt (tidsrom: ${spanDays} dager). Viser de siste ${recent.length} i detalj nedenfor.`,\n      '',\n      currentText ? `Forklaring (sammendrag):\\n${currentText}` : 'Forklaring: ukjent',\n      '',\n      detectedPatterns.length ? 'Mønstre oppdaget:' : '',\n      ...detectedPatterns,\n      detectedPatterns.length ? '' : '',\n      correlationSummary.length ? 'Korrelasjoner (topp):' : '',\n      ...correlationSummary,\n      correlationSummary.length ? '' : '',\n      'Kontekst (hele datasettet):',\n      topPlaces.length ? `Steder (topp): ${topPlaces.join(', ')}` : '',\n      topActivities.length ? `Aktiviteter (topp): ${topActivities.join(', ')}` : '',\n      topTriggers.length ? `Triggere (topp): ${topTriggers.join(', ')}` : '',\n      '',\n      'Tillatte kontekster:',\n      `Tillatte kontekster:`,\n      `Steder: ${(allowed.places || []).join(', ') || 'ikke logget'}`,\n      `Aktiviteter: ${(allowed.activities || []).join(', ') || 'ikke logget'}`,\n      `Triggere: ${(allowed.triggers || []).join(', ') || 'ikke logget'}`,\n      '',\n      'Eksempler (ID og beskrivelse):',\n      ...evidence.slice(0, 40).map((e) => `- [${e.id}] ${e.timestamp} · ${e.description}`),\n      '',\n      socialExamples.length ? 'Sosiale eksempler (fra hele datasettet):' : '',\n      ...socialExamples.slice(0, 60),\n      socialExamples.length ? '' : '',\n      'Siste økter:',\n      ...recent.map(fmtEntry).slice(0, 40),\n      '',\n      'Emosjoner (seneste):',\n      ...emotions.map(fmtEmotion).slice(0, 60),\n      '',\n      'Sensorikk (seneste):',\n      ...sensory.map(fmtSensory).slice(0, 60),\n    ].join('\\n');\n    return summary;\n  }, [filteredData.entries, filteredData.emotions, filteredData.sensoryInputs, currentText]);\n\n  // Build lightweight sources list for transparency (top social examples)\n  const sourcesList = React.useMemo(() => {\n    try {\n      const allEntries = filteredData.entries || [];\n      const socialRe = /(sosial|sosiale|venn|venner|kompis|klasse|klasserom|gruppe|grupp(e|eoppgave)?|team|pararbeid|friminutt|pause|lunsj|frokost|middag|kveld(s)?stell|morgen(s)?rutine|morgenstell|morgenrutine|kantine|ute|inne|hjemme|avlast|interaksj|samarbeid|samspill|konflikt|lek|leke|presentasjon|diskusjon|overgang(er)?|medelever|familie|besøk)/i;\n      return allEntries\n        .filter((t) => socialRe.test(`${t.environmentalData?.classroom?.activity || ''} ${t.environmentalData?.location || ''} ${t.notes || t.generalNotes || ''}`))\n        .slice(-10)\n        .map((t) => {\n          const ts = new Date(t.timestamp).toISOString().replace('T', ' ').slice(0, 16);\n          const act = t.environmentalData?.classroom?.activity?.toString() || '';\n          const loc = t.environmentalData?.location || '';\n          const label = act || loc || 'sosial kontekst';\n          const emo = (t.emotions || []).map((e) => `${e.emotion} (intensitet ${typeof e.intensity === 'number' ? e.intensity : '?'})`).join(', ');\n          const sen = (t.sensoryInputs || []).map((s) => `${s.sensoryType || s.type}: ${s.response}${typeof s.intensity === 'number' ? ` (intensitet ${s.intensity})` : ''}`).join(', ');\n          const happened = (t.notes || t.generalNotes || '').trim();\n          const parts = [\n            `${label} (${ts})`,\n            happened ? `hendelse: ${happened}` : '',\n            emo ? `følelser: ${emo}` : '',\n            sen ? `sensorikk: ${sen}` : ''\n          ].filter(Boolean);\n          return parts.join(' · ');\n        });\n    } catch { return []; }\n  }, [filteredData.entries]);\n\n  // Build rich sources for clickable inspection and citations (top social examples)\n  const sourcesRich: SourceItem[] = React.useMemo(() => {\n    try {\n      const entries = filteredData.entries || [];\n      const socialRe = /(sosial|sosiale|venn|venner|kompis|klasse|klasserom|gruppe|grupp(e|eoppgave)?|team|pararbeid|friminutt|pause|lunsj|frokost|middag|kveld(s)?stell|morgen(s)?rutine|morgenstell|morgenrutine|kantine|ute|inne|hjemme|avlast|interaksj|samarbeid|samspill|konflikt|lek|leke|presentasjon|diskusjon|overgang(er)?|medelever|familie|besøk)/i;\n      return entries\n        .filter((t) => socialRe.test(`${t.environmentalData?.classroom?.activity || ''} ${t.environmentalData?.location || ''} ${t.notes || t.generalNotes || ''}`))\n        .slice(-20)\n        .map((t): SourceItem => ({\n          id: `tracking:${t.id}`,\n          timestamp: t.timestamp.toISOString(),\n          activity: t.environmentalData?.classroom?.activity?.toString(),\n          place: t.environmentalData?.location,\n          socialContext: t.environmentalData?.socialContext,\n          note: (t.notes || t.generalNotes || '').trim() || undefined,\n          emotions: (t.emotions || []).map((e) => ({ id: e.id, emotion: e.emotion, intensity: e.intensity, notes: e.notes })),\n          sensory: (t.sensoryInputs || []).map((s) => ({ id: s.id, type: s.sensoryType || s.type, response: s.response, intensity: s.intensity, notes: s.notes })),\n          environment: t.environmentalData ? {\n            lighting: t.environmentalData.roomConditions?.lighting,\n            noiseLevel: t.environmentalData.roomConditions?.noiseLevel,\n            temperature: t.environmentalData.roomConditions?.temperature,\n            humidity: t.environmentalData.roomConditions?.humidity,\n            weather: t.environmentalData.weather?.condition,\n            timeOfDay: t.environmentalData.classroom?.timeOfDay,\n            studentCount: t.environmentalData.classroom?.studentCount,\n            notes: t.environmentalData.notes,\n          } : undefined,\n        }))\n        .slice(-20);\n    } catch { return []; }\n  }, [filteredData.entries]);\n\n  // Create S1..Sn mapping for the chat system prompt (labels only, no internal IDs)\n  const citationsSeed: string[] = React.useMemo(() => {\n    const top = sourcesRich.slice(-10);\n    return top.map((s, idx) => {\n      const n = idx + 1;\n      let ts = '';\n      try { ts = new Date(s.timestamp).toISOString().replace('T', ' ').slice(0, 16); } catch { ts = String(s.timestamp); }\n      const label = s.activity || s.place || 'sosial kontekst';\n      return `S${n}: ${label} ${ts}${s.note ? ` – ${s.note.slice(0, 80)}` : ''}`;\n    });\n  }, [sourcesRich]);\n\n  const enableSplit = React.useMemo(() => {\n    try { return !!analyticsConfig.getConfig().features?.explanationV2 && !isSmallViewport; } catch { return !isSmallViewport; }\n  }, [isSmallViewport]);\n\n  const leftContent = (\n        <div className=\"space-y-4\">\n      <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between\">\n          <CardTitle>{String(tAnalytics('insights.patterns'))}</CardTitle>\n          <Button variant=\"outline\" onClick={() => runAnalysis(filteredData, { useAI, student })} disabled={isAnalyzing}>\n            {isAnalyzing ? String(tAnalytics('states.analyzing')) : String(tAnalytics('actions.refreshAnalysis'))}\n          </Button>\n        </CardHeader>\n        <CardContent>\n          {isAnalyzing && (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <Clock className=\"h-12 w-12 mx-auto mb-4 motion-safe:animate-spin opacity-50\" />\n              <p>{String(tAnalytics('states.analyzing'))}</p>\n            </div>\n          )}\n          {!isAnalyzing && error && (\n            <div className=\"text-center py-8 text-destructive\">\n              <p>{error}</p>\n            </div>\n          )}\n          {!isAnalyzing && !error && patterns.length === 0 && (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <Clock className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n              <p>{String(tAnalytics('empty.noPatterns'))}</p>\n              <p className=\"text-sm\">{String(tAnalytics('insights.noPatterns'))}</p>\n            </div>\n          )}\n          {!isAnalyzing && !error && patterns.length > 0 && (\n            <div className=\"space-y-4\">\n            {patterns.map((pattern: PatternResult) => (\n                <Card key={stableKeyFromPattern(pattern)} className=\"border-l-4 border-l-primary\">\n                  <CardContent className=\"pt-4\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex items-start gap-3\">\n                        {getPatternIcon(pattern.type)}\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-2\">\n                            <h4 className=\"font-medium text-foreground\">\n                              {String((pattern as PatternResult & { pattern?: string; name?: string }).pattern ?? (pattern as PatternResult & { pattern?: string; name?: string }).name ?? 'Pattern')\n                                .replace('-', ' ')\n                                .replace(/\\b\\w/g, (l: string) => l.toUpperCase())}\n                            </h4>\n                            <button\n                              aria-label={String(tAnalytics('insights.explainPattern'))}\n                              className=\"inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[10px] leading-none text-muted-foreground hover:bg-accent/40\"\n                              onClick={() => handleExplainClick(pattern)}\n                              disabled={!aiKeyPresent}\n                              title={!aiKeyPresent ? String(tAnalytics('ai.toggle.unavailable', { defaultValue: 'AI er ikke tilgjengelig (mangler API-nøkkel).' })) : undefined}\n                            >\n                              <Info className=\"h-3 w-3\" />\n                              {String(tAnalytics('insights.explainPattern'))}\n                            </button>\n                          </div>\n                          <p className=\"text-sm text-muted-foreground mt-1\">\n                            {String((pattern as PatternResult & { description?: string }).description ?? '')}\n                          </p>\n                          {pattern.recommendations && (\n                            <div className=\"mt-3\">\n                              <h5 className=\"text-sm font-medium mb-2\">{String(tAnalytics('insights.recommendations'))}</h5>\n                              <ul className=\"text-sm text-muted-foreground space-y-1\">\n{pattern.recommendations.map((rec) => (\n                                  <li key={hashOfString(rec)} className=\"flex items-start gap-2\">\n                                    <span className=\"text-primary\">•</span>\n                                    <span>{rec}</span>\n                                  </li>\n                                ))}\n                              </ul>\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                      <div className=\"text-right\">\n                        <Badge variant=\"outline\" className={getConfidenceColor(pattern.confidence)}>\n                          {String(tAnalytics('insights.confidencePercent', { percentage: Math.round(pattern.confidence * 100) }))}\n                        </Badge>\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          {String(tAnalytics('confidence.calculation.dataPoints'))}: {pattern.dataPoints}\n                        </p>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n        </div>\n  );\n\n  const rightContent = (\n        <div className=\"h-full\" ref={dockRef}>\n          <ExplanationDock\n            patternTitle={selectedTitle}\n            status={currentStatus}\n            text={currentText}\n            error={currentError}\n            onCopy={handleCopy}\n            onAddToReport={handleAddToReport}\n            aiEnabled={aiKeyPresent}\n            systemPrompt={[\n              buildSystemPrompt(),\n              '',\n              'Bruk kildehenvisninger [S1], [S2], ... når du refererer til konkrete eksempler. Henvis KUN til S-listen under. Ikke bruk tekniske ID-er.',\n              citationsSeed.length ? 'Kildehenvisninger (S1..Sn):' : '',\n              ...citationsSeed,\n            ].filter(Boolean).join('\\n')}\n            chatMessages={chatMessages}\n            onChatChange={updateChat}\n            dataset={{ entries: filteredData.entries, emotions: filteredData.emotions, sensoryInputs: filteredData.sensoryInputs }}\n            sourcesRich={sourcesRich}\n          />\n        </div>\n  );\n\n  return (\n    <>\n      {enableSplit ? (\n        <ResizableSplitLayout\n          storageKey={`split:${student?.id || 'unknown'}`}\n          left={leftContent}\n          right={rightContent}\n          className=\"lg:gap-4\"\n        />\n      ) : (\n        <div className=\"lg:grid lg:grid-cols-[1fr_minmax(380px,520px)] 2xl:grid-cols-[1fr_minmax(420px,560px)] lg:gap-4\">\n          {leftContent}\n          {/* Right column: persistent dock on large screens */}\n          <div className=\"hidden lg:block sticky top-4 self-start\" ref={dockRef}>\n            <ExplanationDock\n              patternTitle={selectedTitle}\n              status={currentStatus}\n              text={currentText}\n              error={currentError}\n              onCopy={handleCopy}\n              onAddToReport={handleAddToReport}\n              aiEnabled={aiKeyPresent}\n              systemPrompt={[\n                buildSystemPrompt(),\n                '',\n                'Bruk kildehenvisninger [S1], [S2], ... når du refererer til konkrete eksempler. Henvis KUN til S-listen under. Ikke bruk tekniske ID-er.',\n                citationsSeed.length ? 'Kildehenvisninger (S1..Sn):' : '',\n                ...citationsSeed,\n              ].filter(Boolean).join('\\n')}\n              chatMessages={chatMessages}\n              onChatChange={updateChat}\n              dataset={{ entries: filteredData.entries, emotions: filteredData.emotions, sensoryInputs: filteredData.sensoryInputs }}\n              sourcesRich={sourcesRich}\n            />\n          </div>\n        </div>\n      )}\n\n      {/* Mobile sheet */}\n      <ExplanationSheet\n        open={isSheetOpen}\n        onOpenChange={setIsSheetOpen}\n        patternTitle={selectedTitle}\n        status={currentStatus}\n        text={currentText}\n        error={currentError}\n        onCopy={handleCopy}\n        onAddToReport={handleAddToReport}\n        aiEnabled={aiKeyPresent}\n        systemPrompt={[\n          buildSystemPrompt(),\n          '',\n          'Bruk kildehenvisninger [S1], [S2], ... når du refererer til konkrete eksempler. Henvis KUN til S-listen under. Ikke bruk tekniske ID-er.',\n          citationsSeed.length ? 'Kildehenvisninger (S1..Sn):' : '',\n          ...citationsSeed,\n        ].filter(Boolean).join('\\n')}\n        chatMessages={chatMessages}\n        onChatChange={updateChat}\n        sourcesRich={sourcesRich}\n        dataset={{ entries: filteredData.entries, emotions: filteredData.emotions, sensoryInputs: filteredData.sensoryInputs }}\n      />\n\n      <Card>\n        <CardHeader>\n          <CardTitle>{String(tAnalytics('insights.title'))}</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isAnalyzing && <p className=\"text-muted-foreground\">{String(tAnalytics('states.analyzing'))}</p>}\n          {!isAnalyzing && structured.length === 0 && (\n            <p className=\"text-muted-foreground\">{String(tAnalytics('insights.noPatterns'))}</p>\n          )}\n          {!isAnalyzing && structured.length > 0 && (\n            <div className=\"space-y-3\">\n              {structured.map((msg, idx) => (\n                <div key={idx} className=\"p-3 bg-muted/50 rounded-lg\">\n                  <p className=\"text-sm text-foreground\">{String(tAnalytics(msg.key.replace(/^analytics\\./, ''), msg.params as any))}</p>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </>\n  );\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/analytics-panels/citation-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/analyticsTabs.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/charts/ChartKit.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":345,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":345,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10894,10897],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10894,10897],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":385,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":385,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12249,12252],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12249,12252],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { chartColor } from '@/lib/chartColor';\nimport type { EChartsOption, SeriesOption } from 'echarts';\nimport type { CorrelationMatrix } from '@/lib/enhancedPatternAnalysis';\n\n/**\n * ChartKit – option builders\n *\n * These helpers produce ECharts options using a stable schema and\n * explicitly disable hover-dimming on series. We set emphasis.disabled,\n * focus: 'none', and a fully opaque blur state to improve readability\n * and avoid the visual effect of lines \"disappearing\" when hovering.\n */\n\n/**\n * Strongly-typed input row for trend charts. Keep this flat and numeric so the\n * chart layer is deterministic and tooltips never receive object-shaped values.\n */\nexport interface TrendRow {\n  date: string; // yyyy-MM-dd (displayed on x-axis)\n  avgEmotionIntensity: number;\n  positiveEmotions: number;\n  negativeEmotions: number;\n  totalSensoryInputs: number;\n}\n\n/** Configuration for the emotion trends chart. */\nexport interface EmotionTrendsConfig {\n  title?: string;\n  showMovingAverage: boolean;\n  movingAverageWindow: number; // e.g., 7 for 7d MA\n  useDualYAxis: boolean; // sensory on right axis\n  thresholds?: { emotion?: number; sensory?: number };\n}\n\n/**\n * Compute a simple moving average array for a numeric series.\n */\nfunction computeMovingAverage(values: number[], window: number): number[] {\n  if (!Number.isFinite(window) || window <= 1) return values.slice();\n  const ma: number[] = new Array(values.length).fill(0);\n  let sum = 0;\n  for (let i = 0; i < values.length; i++) {\n    sum += values[i] ?? 0;\n    const outIndex = i - window;\n    if (outIndex >= 0) sum -= values[outIndex] ?? 0;\n    const denom = Math.min(i + 1, window);\n    ma[i] = Number((sum / denom).toFixed(2));\n  }\n  return ma;\n}\n\n/** Ensure numbers are finite; coerce invalid values to 0 for stable visuals. */\nfunction toFiniteNumber(value: unknown): number {\n  const n = typeof value === 'number' ? value : Number(value);\n  return Number.isFinite(n) ? n : 0;\n}\n\n/**\n * Build an ECharts option for the main Emotion & Sensory trends chart.\n * Pure function – safe to unit test.\n */\nexport function buildEmotionTrendsOption(rows: TrendRow[], config: EmotionTrendsConfig): EChartsOption {\n  const dates = rows.map(r => r.date);\n  const avg = rows.map(r => toFiniteNumber(r.avgEmotionIntensity));\n  const pos = rows.map(r => toFiniteNumber(r.positiveEmotions));\n  const neg = rows.map(r => toFiniteNumber(r.negativeEmotions));\n  const sensory = rows.map(r => toFiniteNumber(r.totalSensoryInputs));\n\n  const avgMA = config.showMovingAverage\n    ? computeMovingAverage(avg, Math.max(2, config.movingAverageWindow))\n    : [];\n\n  const series: SeriesOption[] = [\n    {\n      type: 'line',\n      name: 'Avg Emotion Intensity',\n      data: avg,\n      smooth: true,\n      showSymbol: false,\n      sampling: 'lttb',\n      lineStyle: { width: 3 },\n      emphasis: { focus: 'none', disabled: true },\n      blur: { itemStyle: { opacity: 1 }, lineStyle: { opacity: 1 } },\n      markLine: config.thresholds?.emotion\n        ? {\n            silent: true,\n            data: [\n              {\n                yAxis: config.thresholds.emotion,\n                label: { position: 'end', formatter: 'Emotion Threshold' },\n                lineStyle: { type: 'dashed', width: 2 },\n              },\n            ],\n          }\n        : undefined,\n    },\n    ...(config.showMovingAverage\n      ? ([\n          {\n            type: 'line',\n            name: `Avg Intensity (${config.movingAverageWindow}d MA)`,\n            data: avgMA,\n            smooth: true,\n            showSymbol: false,\n            sampling: 'lttb',\n            lineStyle: { width: 2 },\n            emphasis: { focus: 'none', disabled: true },\n            blur: { itemStyle: { opacity: 1 }, lineStyle: { opacity: 1 } },\n          },\n        ] as SeriesOption[])\n      : []),\n    {\n      type: 'line',\n      name: 'Positive Emotions',\n      data: pos,\n      smooth: true,\n      showSymbol: false,\n      sampling: 'lttb',\n      lineStyle: { width: 2 },\n      emphasis: { focus: 'none', disabled: true },\n      blur: { itemStyle: { opacity: 1 }, lineStyle: { opacity: 1 } },\n    },\n    {\n      type: 'line',\n      name: 'Negative Emotions',\n      data: neg,\n      smooth: true,\n      showSymbol: false,\n      sampling: 'lttb',\n      lineStyle: { width: 2 },\n      emphasis: { focus: 'none', disabled: true },\n      blur: { itemStyle: { opacity: 1 }, lineStyle: { opacity: 1 } },\n    },\n    {\n      type: 'line',\n      name: 'Sensory Inputs',\n      data: sensory,\n      smooth: true,\n      showSymbol: false,\n      sampling: 'lttb',\n      lineStyle: { width: 2, type: 'dashed' },\n      emphasis: { focus: 'none', disabled: true },\n      blur: { itemStyle: { opacity: 1 }, lineStyle: { opacity: 1 } },\n      yAxisIndex: config.useDualYAxis ? 1 : 0,\n      markLine: config.thresholds?.sensory\n        ? {\n            silent: true,\n            data: [\n              {\n                yAxis: config.thresholds.sensory,\n                label: { position: 'end', formatter: 'Sensory Threshold' },\n                lineStyle: { type: 'dashed', width: 2 },\n              },\n            ],\n          }\n        : undefined,\n    },\n  ];\n\n  const option: EChartsOption = {\n    title: config.title\n      ? { left: 'center', top: 0, text: config.title }\n      : undefined,\n    legend: {\n      hoverLink: false,\n      bottom: 0,\n      data: [\n        'Avg Emotion Intensity',\n        ...(config.showMovingAverage ? [`Avg Intensity (${config.movingAverageWindow}d MA)`] : []),\n        'Positive Emotions',\n        'Negative Emotions',\n        'Sensory Inputs',\n      ],\n      selected: {\n        'Avg Emotion Intensity': true,\n        ...(config.showMovingAverage ? { [`Avg Intensity (${config.movingAverageWindow}d MA)`]: true } : {}),\n        'Positive Emotions': true,\n        'Negative Emotions': true,\n        'Sensory Inputs': false,\n      },\n    },\n    tooltip: { trigger: 'axis', confine: true },\n    toolbox: {\n      show: true,\n      right: 16,\n      top: 16,\n      feature: {\n        dataZoom: { yAxisIndex: 'none', title: { zoom: 'Zoom', back: 'Reset' } },\n        restore: { title: 'Reset' },\n        saveAsImage: { title: 'Save', pixelRatio: 2 },\n      },\n    },\n    dataZoom: [\n      { type: 'inside', start: 0, end: 100, minValueSpan: 7 },\n      {\n        show: true,\n        type: 'slider',\n        bottom: 50,\n        start: 0,\n        end: 100,\n        height: 20,\n      },\n    ],\n    xAxis: { type: 'category', boundaryGap: false, data: dates },\n    yAxis: config.useDualYAxis\n      ? [\n          { type: 'value', max: 10, min: 0, interval: 2, name: 'Intensity' },\n          { type: 'value', name: 'Sensory Inputs', alignTicks: true, min: 'dataMin' },\n        ]\n      : [{ type: 'value', max: 10, min: 0, interval: 2, name: 'Intensity' }],\n    series,\n    grid: { bottom: 72 },\n  };\n\n  return option;\n}\n\n/** Simpler area option builder using the same TrendRow type. */\nexport function buildAreaOption(rows: TrendRow[]): EChartsOption {\n  const dates = rows.map(r => r.date);\n  return {\n    tooltip: { trigger: 'axis' },\n    legend: {},\n    xAxis: { type: 'category', data: dates },\n    yAxis: [{ type: 'value' }],\n    series: [\n      {\n        type: 'line',\n        name: 'Avg Emotion Intensity',\n        data: rows.map(r => toFiniteNumber(r.avgEmotionIntensity)),\n        smooth: true,\n        showSymbol: false,\n        areaStyle: {},\n        lineStyle: { width: 3 },\n        emphasis: { focus: 'none' },\n      },\n      {\n        type: 'line',\n        name: 'Positive Emotions',\n        data: rows.map(r => toFiniteNumber(r.positiveEmotions)),\n        smooth: true,\n        showSymbol: false,\n        areaStyle: {},\n        lineStyle: { width: 2 },\n        emphasis: { focus: 'none' },\n      },\n    ],\n  } as EChartsOption;\n}\n\n/** Scatter option with numeric axes for correlation-like view. */\nexport function buildScatterOption(rows: TrendRow[]): EChartsOption {\n  return {\n    tooltip: { trigger: 'item' },\n    legend: {},\n    xAxis: { type: 'value', name: 'Avg Emotion Intensity' },\n    yAxis: { type: 'value', name: 'Sensory Inputs' },\n    series: [\n      {\n        name: 'Daily Data Points',\n        type: 'scatter',\n        data: rows.map(r => [toFiniteNumber(r.avgEmotionIntensity), toFiniteNumber(r.totalSensoryInputs)]),\n        symbolSize: 8,\n        emphasis: { focus: 'none' },\n      },\n    ],\n  } as EChartsOption;\n}\n\n/** Composed bar+line option builder using the same rows. */\nexport function buildComposedOption(rows: TrendRow[]): EChartsOption {\n  const dates = rows.map(r => r.date);\n  return {\n    tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' } },\n    legend: {},\n    xAxis: { type: 'category', data: dates },\n    yAxis: [{ type: 'value' }, { type: 'value' }],\n    series: [\n      {\n        type: 'bar',\n        name: 'Positive Emotions',\n        data: rows.map(r => toFiniteNumber(r.positiveEmotions)),\n        yAxisIndex: 0,\n        emphasis: { focus: 'none' },\n      },\n      {\n        type: 'bar',\n        name: 'Negative Emotions',\n        data: rows.map(r => toFiniteNumber(r.negativeEmotions)),\n        yAxisIndex: 0,\n        emphasis: { focus: 'none' },\n      },\n      {\n        type: 'line',\n        name: 'Avg Intensity',\n        data: rows.map(r => toFiniteNumber(r.avgEmotionIntensity)),\n        yAxisIndex: 1,\n        smooth: true,\n        lineStyle: { width: 3 },\n        showSymbol: false,\n        emphasis: { focus: 'none' },\n      },\n    ],\n  } as EChartsOption;\n}\n\n/** Correlation heatmap option builder (ECharts). */\nexport function buildCorrelationHeatmapOption(matrix: CorrelationMatrix): EChartsOption {\n  const factors = matrix.factors ?? [];\n  const values: Array<[number, number, number]> = [];\n  for (let i = 0; i < matrix.matrix.length; i++) {\n    const row = matrix.matrix[i] || [];\n    for (let j = 0; j < row.length; j++) {\n      const vRaw = row[j];\n      const v = typeof vRaw === 'number' && Number.isFinite(vRaw) ? vRaw : 0;\n      values.push([j, i, Number(v.toFixed(2))]);\n    }\n  }\n\n  // Map for quick significance lookup in tooltip\n  const significanceMap = new Map<string, { significance: string; correlation: number }>();\n  for (const p of matrix.significantPairs || []) {\n    const key1 = `${p.factor1}__${p.factor2}`;\n    const key2 = `${p.factor2}__${p.factor1}`;\n    significanceMap.set(key1, { significance: p.significance, correlation: p.correlation });\n    significanceMap.set(key2, { significance: p.significance, correlation: p.correlation });\n  }\n\n  const option: EChartsOption = {\n    grid: { top: 80, left: 120, right: 64, bottom: 60, containLabel: true },\n    xAxis: {\n      type: 'category',\n      data: factors,\n      axisLabel: { rotate: 40, margin: 16 },\n    },\n    yAxis: {\n      type: 'category',\n      data: factors,\n      axisLabel: { margin: 12 },\n    },\n    tooltip: {\n      trigger: 'item',\n      confine: true,\n      appendToBody: true,\n      formatter: (p: any) => {\n        const i = p?.value?.[1];\n        const j = p?.value?.[0];\n        const f1 = factors[i] ?? '';\n        const f2 = factors[j] ?? '';\n        const key = `${f1}__${f2}`;\n        const sig = significanceMap.get(key)?.significance;\n        const corr = typeof p?.value?.[2] === 'number' ? p.value[2] : Number(p.value?.[2]) || 0;\n        const sign = corr > 0 ? 'Positive' : corr < 0 ? 'Negative' : 'Neutral';\n        return `<div style=\"font-weight:600;margin-bottom:6px\">${f1} ↔ ${f2}</div>\n                <div>Correlation: <b>${corr.toFixed(2)}</b> (${sign})</div>\n                ${sig ? `<div>Significance: <b>${sig}</b></div>` : ''}`;\n      }\n    },\n    visualMap: {\n      min: -1,\n      max: 1,\n      calculable: true,\n      orient: 'vertical',\n      right: 8,\n      top: 40,\n      text: ['Positiv', 'Negativ'],\n      inRange: {\n        // Diverging palette from semantic tokens\n        color: [\n          chartColor('--destructive', 1, '0 84% 60%'), \n          chartColor('--muted-foreground', 1, '240 8% 63%'), \n          chartColor('--success', 1, '142 71% 45%')\n        ]\n      },\n      itemWidth: 12,\n      itemHeight: 100,\n      textStyle: { color: 'hsl(var(--muted-foreground))' },\n    },\n    series: [\n      {\n        type: 'heatmap',\n        data: values,\n        label: {\n          show: true,\n          formatter: (params: any) => {\n            const v = typeof params?.value?.[2] === 'number' ? params.value[2] : Number(params?.value?.[2]) || 0;\n            // Only label moderate/strong correlations to reduce clutter\n            return Math.abs(v) >= 0.25 ? v.toFixed(2) : '';\n          },\n        },\n        itemStyle: {\n          borderWidth: 1,\n          borderColor: chartColor('--secondary', 0.5, '247 15% 17%') // Use semantic token with alpha\n        },\n        emphasis: { disabled: true, focus: 'none' },\n        progressive: 0,\n        // Larger cells for readability\n        // ECharts sizes cells automatically based on grid/category count\n      },\n    ],\n  };\n\n  return option;\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/charts/EChartContainer.tsx","messages":[{"ruleId":"no-restricted-syntax","severity":1,"message":"Avoid inline styles (style={{}}). Use Tailwind CSS classes or CSS custom properties for styling. See rule 3wIMH0UDSwsNj5RYGo17Vg. Exception: Radix primitives with // RADIX_INLINE_STYLE_ALLOWED comment.","line":486,"column":7,"nodeType":"JSXAttribute","messageId":"restrictedSyntax","endLine":492,"endColumn":9},{"ruleId":"no-restricted-syntax","severity":1,"message":"Avoid inline styles (style={{}}). Use Tailwind CSS classes or CSS custom properties for styling. See rule 3wIMH0UDSwsNj5RYGo17Vg. Exception: Radix primitives with // RADIX_INLINE_STYLE_ALLOWED comment.","line":502,"column":11,"nodeType":"JSXAttribute","messageId":"restrictedSyntax","endLine":502,"endColumn":63},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":504,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":504,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19434,19437],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19434,19437],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":505,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":505,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19475,19478],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19475,19478],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useEffect has a missing dependency: 'props.exportRegistration'. Either include it or remove the dependency array.","line":546,"column":6,"nodeType":"ArrayExpression","endLine":546,"endColumn":225,"suggestions":[{"desc":"Update the dependencies array to be: [props.exportRegistration.id, props.exportRegistration.title, props.exportRegistration.studentId, props.exportRegistration.type, props.exportRegistration.filters, props.exportRegistration.dateRange, exportMethods, props.exportRegistration]","fix":{"range":[20798,21017],"text":"[props.exportRegistration.id, props.exportRegistration.title, props.exportRegistration.studentId, props.exportRegistration.type, props.exportRegistration.filters, props.exportRegistration.dateRange, exportMethods, props.exportRegistration]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo, memo, useRef } from \"react\";\nimport ReactECharts from \"echarts-for-react\";\n// Use our trimmed ECharts core to keep the chart chunk small\nimport { echarts } from '@/lib/echartsCore';\nimport type {\n  EChartsOption,\n  GridComponentOption,\n  TooltipComponentOption,\n  XAXisComponentOption,\n  YAXisComponentOption\n} from \"echarts\";\nimport { cn } from \"@/lib/utils\";\nimport { logger } from \"@/lib/logger\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport type ReactEChartsType from \"echarts-for-react\";\nimport { useChartExport } from \"@/hooks/useChartExport\";\nimport { chartRegistry, type ChartType } from \"@/lib/chartRegistry\";\n\ntype EventsMap = Record<string, (params: unknown) => void>;\n\nexport type EChartExportRegistration = {\n  /** Unique id for registry; provide to group charts and ensure stable keys */\n  id?: string;\n  /** Optional chart type to aid titling and selection */\n  type?: ChartType;\n  /** Optional human-readable title used in PDF */\n  title?: string;\n  /** Optional student id for scoping */\n  studentId?: string;\n  /** Optional filters used to build the chart (for export metadata) */\n  filters?: Record<string, unknown>;\n  /** Optional date range used by the chart */\n  dateRange?: { start: Date; end: Date };\n};\n\nexport type EChartContainerProps = {\n  option: EChartsOption;\n  className?: string;\n  height?: number | string;\n  width?: number | string;\n  onEvents?: EventsMap;\n  style?: React.CSSProperties;\n  /**\n   * Optional runtime overrides for emphasis/tooltip/theme settings.\n   * These are shallow-merged after the base theme to allow per-instance control.\n   */\n  chartDefaults?: Partial<EChartsOption>;\n  /** Optional registration so this chart can be included in PDF export */\n  exportRegistration?: EChartExportRegistration;\n  /** INTERNAL: ref to ReactECharts instance for export hooks */\n  __innerChartRef__?: React.Ref<ReactEChartsType>;\n};\n\n/**\n * EChartContainer\n *\n * Centralized ECharts theming and safety guards for our visualizations.\n *\n * Key behavioral decision: We disable all hover-dimming/focus states.\n * Many browsers/GPU combos apply opacity transitions to non-hovered series,\n * which caused users to perceive the chart as \"disappearing\" on hover.\n * We enforce stable opacity via emphasis.disabled and a blur state with\n * opacity 1 so every series remains fully visible at all times.\n */\n\n// Emotion-specific colors for autism-friendly visualization\nconst emotionColors = {\n  happy: \"hsl(90 70% 65%)\",      // Soft green\n  calm: \"hsl(180 45% 75%)\",      // Soft blue\n  anxious: \"hsl(40 65% 70%)\",    // Soft yellow/orange\n  sad: \"hsl(220 45% 65%)\",       // Muted blue\n  angry: \"hsl(10 70% 65%)\",      // Soft red\n  excited: \"hsl(280 55% 70%)\",   // Soft purple\n  overwhelmed: \"hsl(300 40% 60%)\", // Muted magenta\n  neutral: \"hsl(240 8% 63%)\"     // Gray\n};\n\n// (sensory-specific color map removed; not used here)\n\nconst baseTheme = {\n    color: [\n      \"hsl(var(--primary))\",        // Primary purple\n      emotionColors.calm,            // Calm blue\n      emotionColors.happy,           // Happy green\n      emotionColors.anxious,         // Anxious yellow\n      emotionColors.sad,             // Sad blue\n      emotionColors.excited,         // Excited purple\n      emotionColors.overwhelmed,     // Overwhelmed magenta\n      emotionColors.neutral          // Neutral gray\n    ],\n    backgroundColor: \"transparent\",\n    textStyle: {\n      color: \"hsl(var(--foreground))\",\n      fontFamily: \"Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial\",\n      fontSize: 13\n    },\n    grid: {\n      top: 48,\n      right: 24,\n      bottom: 48,\n      left: 56,\n      containLabel: true,\n      backgroundColor: \"rgba(0, 0, 0, 0.02)\",\n      borderColor: \"transparent\"\n    },\n    axisPointer: { \n      lineStyle: { \n        color: \"hsl(var(--primary))\", \n        width: 2,\n        type: 'dashed'\n      },\n      label: {\n        backgroundColor: \"hsl(var(--card))\",\n        borderColor: \"hsl(var(--primary))\",\n        borderWidth: 1,\n        color: \"hsl(var(--foreground))\",\n        fontSize: 12,\n        padding: [4, 8]\n      }\n    },\n    tooltip: {\n      trigger: \"axis\",\n      confine: true,\n      // Append tooltip to body to avoid clipping/paint issues inside transformed/overflow containers\n      appendToBody: true,\n      // Avoid animation-induced flicker on some GPUs\n      transitionDuration: 0,\n      enterable: true,\n      backgroundColor: \"hsl(var(--card))\",\n      borderColor: \"hsl(var(--primary) / 0.5)\",\n      borderWidth: 1,\n      textStyle: { \n        color: \"hsl(var(--foreground))\", \n        fontSize: 14,\n        fontWeight: 500\n      },\n      padding: [12, 16],\n      // Robust formatter for dataset-encoded series\n      formatter: function (params: unknown) {\n        type TP = {\n          seriesName?: string;\n          color?: string;\n          name?: string;\n          axisValueLabel?: string;\n          value?: unknown;\n          encode?: { y?: number | string | Array<number | string> };\n          data?: Record<string, unknown> | unknown;\n        };\n        const toNumber = (v: unknown) => (typeof v === 'number' ? v : Number(v));\n        const formatValue = (v: unknown) => {\n          const n = toNumber(v);\n          return Number.isFinite(n) ? n.toFixed(1) : String(v ?? '');\n        };\n        const getEmotionIcon = (name: string | undefined) => {\n          const icons: Record<string, string> = {\n            happy: '😊', sad: '😢', anxious: '😰', calm: '😌', excited: '🤗', angry: '😤', overwhelmed: '😵', default: '🔵'\n          };\n          return typeof name === 'string' ? (icons[name.toLowerCase()] || icons.default) : icons.default;\n        };\n        const seriesNameToKey = (name?: string): string | undefined => {\n          if (!name) return undefined;\n          const n = name.toLowerCase();\n          if (n.includes('avg emotion intensity')) return 'avgEmotionIntensity';\n          if (n.includes('7d') || n.includes('ma')) return 'avgEmotionIntensityMA7';\n          if (n.includes('positive')) return 'positiveEmotions';\n          if (n.includes('negative')) return 'negativeEmotions';\n          if (n.includes('sensory')) return 'totalSensoryInputs';\n          return undefined;\n        };\n\n        const valueFromParam = (p: TP) => {\n          const encY = (p as TP).encode?.y;\n          let yKey = Array.isArray(encY) ? (encY[0] as string | number) : encY;\n          if (yKey == null) {\n            const inferred = seriesNameToKey((p as TP).seriesName as string | undefined);\n            if (inferred) yKey = inferred as unknown as string;\n          }\n          // Prefer numeric value if provided directly\n          if (typeof (p as TP)?.value === 'number') return (p as TP).value as number;\n          // If value is an array (multi-dim), try y index\n          if (Array.isArray((p as TP)?.value)) {\n            if (typeof yKey === 'number') return ((p as TP).value as unknown[])[yKey] as number;\n          }\n          // If value is an object with named dimensions\n          if ((p as TP)?.value && typeof (p as TP).value === 'object' && !Array.isArray((p as TP).value)) {\n            if (typeof yKey === 'string' && (yKey in ((p as TP).value as Record<string, unknown>))) {\n              return ((p as TP).value as Record<string, unknown>)[yKey] as number;\n            }\n            // fallback: first numeric property\n            const obj = (p as TP).value as Record<string, unknown>;\n            for (const k of Object.keys(obj)) {\n              const v = obj[k];\n              if (typeof v === 'number' && Number.isFinite(v)) return v;\n            }\n          }\n          // If dataset row object is present, use y key from encode\n          if ((p as TP)?.data && typeof (p as TP).data === 'object') {\n            if (typeof yKey === 'string' && yKey in ((p as TP).data as Record<string, unknown>)) return ((p as TP).data as Record<string, unknown>)[yKey] as number;\n          }\n          return (p as TP)?.value; // fallback\n        };\n        // Multi-series - use semantic HTML with minimal necessary styles\n        if (Array.isArray(params) && params.length > 0) {\n          const date = (params[0] as TP)?.axisValueLabel || '';\n          let content = `<div class=\"chart-tooltip-header\">${date}</div>`;\n          params.forEach((p) => {\n            const tp = p as TP;\n            if (tp && typeof tp === 'object') {\n              const val = valueFromParam(tp);\n              const icon = getEmotionIcon(tp.seriesName);\n              // Only use color for the series marker, which needs the actual color value\n              content += `\n                <div class=\"chart-tooltip-item\">\n                  <span class=\"chart-tooltip-icon\">${icon}</span>\n                  <span class=\"chart-tooltip-label\" style=\"color: ${tp.color};\">${tp.seriesName ?? ''}:</span>\n                  <span class=\"chart-tooltip-value\">${formatValue(val)}</span>\n                </div>`;\n            }\n          });\n          return content;\n        }\n        // Single-series - use semantic HTML with minimal necessary styles\n        if (params && typeof params === 'object') {\n          const p = params as TP;\n          const val = valueFromParam(p);\n          const icon = getEmotionIcon(p.seriesName);\n          return `\n            <div class=\"chart-tooltip-header\">${p.name ?? ''}</div>\n            <div class=\"chart-tooltip-item\"> \n              <span class=\"chart-tooltip-icon\">${icon}</span>\n              <span class=\"chart-tooltip-label\" style=\"color: ${p.color};\">${p.seriesName ?? ''}:</span>\n              <span class=\"chart-tooltip-value\">${formatValue(val)}</span>\n            </div>`;\n        }\n        return '';\n      },\n      // Simplified tooltip styling with CSS variables\n      extraCssText: `\n        border-radius: 8px;\n        box-shadow: 0 2px 8px hsla(0, 0%, 0%, 0.1);\n      ` + `\n        .chart-tooltip-header {\n          font-weight: 600;\n          margin-bottom: 8px;\n          color: hsl(var(--foreground));\n        }\n        .chart-tooltip-item {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          margin: 4px 0;\n        }\n        .chart-tooltip-icon {\n          font-size: 16px;\n        }\n        .chart-tooltip-label {\n          font-weight: 500;\n        }\n        .chart-tooltip-value {\n          font-weight: 600;\n          color: hsl(var(--foreground));\n        }\n      `\n    },\n    xAxis: {\n      axisLine: { \n        lineStyle: { \n          color: \"hsl(var(--border))\",\n          width: 2\n        } \n      },\n      axisTick: { \n        show: true,\n        lineStyle: { color: \"hsl(var(--border))\" }\n      },\n      axisLabel: { \n        color: \"hsl(var(--foreground))\", \n        fontSize: 12,\n        fontWeight: 500,\n        margin: 12\n      },\n      splitLine: { \n        lineStyle: { \n          color: \"hsl(var(--border) / 0.15)\",\n          type: 'dashed'\n        } \n      }\n    },\n    yAxis: {\n      axisLine: { \n        show: true, \n        lineStyle: { \n          color: \"hsl(var(--border))\",\n          width: 2\n        } \n      },\n      axisTick: { \n        show: true,\n        lineStyle: { color: \"hsl(var(--border))\" }\n      },\n      axisLabel: { \n        color: \"hsl(var(--foreground))\", \n        fontSize: 12,\n        fontWeight: 500,\n        margin: 12\n      },\n      splitLine: { \n        lineStyle: { \n          color: \"hsl(var(--border) / 0.15)\",\n          type: 'dashed'\n        } \n      },\n      nameTextStyle: {\n        color: \"hsl(var(--muted-foreground))\",\n        fontSize: 12,\n        padding: [0, 0, 8, 0]\n      }\n    },\n    legend: {\n      show: true,\n      top: 0,\n      right: 0,\n      icon: 'circle',\n      itemWidth: 12,\n      itemHeight: 12,\n      itemGap: 16,\n      textStyle: {\n        color: \"hsl(var(--foreground))\",\n        fontSize: 14,\n        fontWeight: 500\n      },\n      inactiveColor: \"hsl(var(--muted-foreground) / 0.5)\",\n      pageTextStyle: {\n        color: \"hsl(var(--foreground))\"\n      }\n    },\n    animation: true,\n    animationDuration: 800,\n    animationEasing: 'cubicOut'\n} as const;\n\nfunction EChartContainerBase({\n  option,\n  className,\n  height = 320,\n  width = \"100%\",\n  onEvents,\n  style,\n  chartDefaults,\n  __innerChartRef__\n}: EChartContainerProps) {\n  // Defensive: guard against undefined/empty/invalid options\n  const safeOption: EChartsOption = useMemo(() => {\n    try {\n      if (!option || typeof option !== \"object\") {\n        if (import.meta?.env?.DEV) {\n          logger.warn(\"[EChartContainer] Received invalid option, using fallback\");\n        }\n        return { series: [], xAxis: {}, yAxis: {} } as EChartsOption;\n    }\n      const series = (option as EChartsOption & { series?: unknown }).series as unknown;\n      if (series == null) {\n        return { ...option, series: [] } as EChartsOption;\n      }\n      if (Array.isArray(series)) {\n        // Ensure each series has a type to avoid echarts throwing\n        const normalized = (series as unknown[]).map((s) => (s && typeof s === \"object\" ? s : {}));\n        return { ...(option as EChartsOption), series: normalized } as EChartsOption;\n      }\n      // Non-array series objects are allowed by echarts, keep as-is\n      return option as EChartsOption;\n    } catch (e) {\n      if (import.meta?.env?.DEV) {\n        logger.error(\"[EChartContainer] Option normalization failed\", { error: e });\n      }\n      return { series: [], xAxis: {}, yAxis: {} } as EChartsOption;\n    }\n  }, [option]);\n\n  const themed = useMemo(() => {\n    try {\n      const xAxis = (safeOption as EChartsOption).xAxis as XAXisComponentOption | XAXisComponentOption[] | undefined;\n      const yAxis = (safeOption as EChartsOption).yAxis as YAXisComponentOption | YAXisComponentOption[] | undefined;\n\n      const normalizeXAxis = (xa?: XAXisComponentOption | XAXisComponentOption[]) =>\n        Array.isArray(xa)\n          ? xa.map((x) => ({ ...baseTheme.xAxis, ...x } as XAXisComponentOption))\n          : ({ ...baseTheme.xAxis, ...(xa as XAXisComponentOption) } as XAXisComponentOption);\n\n      const normalizeYAxis = (ya?: YAXisComponentOption | YAXisComponentOption[]) =>\n        Array.isArray(ya)\n          ? ya.map((y) => ({ ...baseTheme.yAxis, ...y } as YAXisComponentOption))\n          : ({ ...baseTheme.yAxis, ...(ya as YAXisComponentOption) } as YAXisComponentOption);\n\n      // Apply global defaults to every chart and every series\n       // Enforce no-dimming behavior for all charts that pass through here\n       const withGlobalSeriesDefaults = (opt: EChartsOption): EChartsOption => {\n        const s = (opt.series ?? []) as unknown[];\n        if (!Array.isArray(s)) return opt;\n        const enhanced = (s as Array<Record<string, unknown>>).map((series) => {\n          const existingEmphasis = (series.emphasis ?? {}) as Record<string, unknown>;\n           // Keep series fully opaque on hover; disable blur/dim transitions entirely.\n           // Rationale: prevents non-hovered series from fading, which previously\n           // looked like the graph disappearing to some users.\n          const mergedEmphasis = {\n            ...existingEmphasis,\n            disabled: true,\n            focus: 'none',\n            blurScope: 'global',\n            lineStyle: { opacity: 1 },\n            itemStyle: {\n              opacity: 1,\n              shadowBlur: 10,\n              shadowColor: 'rgba(255,255,255,0.18)',\n              borderWidth: 1,\n              borderColor: 'rgba(255,255,255,0.35)'\n            },\n          } as Record<string, unknown>;\n          const mergedBlur = {\n            lineStyle: { opacity: 1 },\n            itemStyle: { opacity: 1 },\n          } as Record<string, unknown>;\n          return { ...series, emphasis: mergedEmphasis, blur: mergedBlur, select: { disabled: true } } as Record<string, unknown>;\n        });\n        return { ...opt, series: enhanced } as EChartsOption;\n      };\n\n      const themedOption: EChartsOption = withGlobalSeriesDefaults({\n        ...(safeOption as EChartsOption),\n        backgroundColor: baseTheme.backgroundColor,\n        textStyle: { ...baseTheme.textStyle, ...(safeOption as EChartsOption).textStyle },\n        grid: { ...baseTheme.grid, ...(safeOption as EChartsOption).grid } as GridComponentOption,\n        xAxis: normalizeXAxis(xAxis),\n        yAxis: normalizeYAxis(yAxis),\n        color: (safeOption as EChartsOption).color ?? (baseTheme.color as unknown as string[]),\n        tooltip: { ...baseTheme.tooltip, ...(safeOption as EChartsOption).tooltip } as TooltipComponentOption,\n        legend: (safeOption as EChartsOption).legend as Record<string, unknown>,\n        stateAnimation: { duration: 0 },\n        ...(chartDefaults || {}),\n      });\n\n      return themedOption;\n    } catch (e) {\n      if (import.meta?.env?.DEV) {\n        logger.error(\"[EChartContainer] Theme merge failed\", { \n          error: e,\n          optionPreview: (() => {\n            try { return JSON.stringify(safeOption, (_k, v) => (v instanceof Date ? v.toISOString() : v)); } catch { return \"[unserializable]\"; }\n          })()\n        });\n      }\n      return { series: [] } as EChartsOption;\n    }\n  }, [safeOption, chartDefaults]);\n\n  // Fail-soft: treat non-array truthy series as having data, but avoid crashing render\n  const hasSeries = (() => {\n    const s = (themed as EChartsOption & { series?: unknown }).series as unknown;\n    return Array.isArray(s) ? s.length > 0 : Boolean(s);\n  })();\n\n  // Avoid remounting chart instance on hover/pointer changes – only recreate on deep structural changes\n  const optionSignature = useMemo(() => {\n    try {\n      const opt = themed as EChartsOption & { series?: unknown; dataset?: { source?: unknown } };\n      const rawSeries = (opt.series ?? []) as unknown;\n      const series = Array.isArray(rawSeries)\n        ? (rawSeries as Array<Record<string, unknown>>)\n        : rawSeries\n        ? [rawSeries as Record<string, unknown>]\n        : [];\n      const seriesKinds = series.map((s) => String((s?.type as string) ?? ''));\n      const yAxisVal = (opt as unknown as { yAxis?: unknown }).yAxis as unknown;\n      const yAxes = Array.isArray(yAxisVal as unknown[]) ? (yAxisVal as unknown[]).length : 1;\n      // Only depend on high-level shape, not data lengths which can change with hover/zoom\n      return JSON.stringify({ seriesKinds, yAxes });\n    } catch {\n      return 'shape-default';\n    }\n  }, [themed]);\n\n  return (\n    <div\n      className={cn(\"rounded-xl border bg-card w-full\", className)}\n      data-testid=\"echart-container\"\n      style={{ // RADIX_INLINE_STYLE_ALLOWED - ECharts container needs explicit overflow control\n        // Let tooltips/axis pointers render outside if needed; prevents canvas disappearing in some browsers\n        overflow: \"visible\",\n        // Ensure container has a visible size even if parent has no intrinsic height\n        minHeight: typeof height === \"number\" ? height : undefined,\n        width: typeof width === \"number\" ? width : undefined,\n      }}\n    >\n      {hasSeries ? (\n        <ReactECharts\n          // Keep a stable component instance to prevent disappearing canvas on hover\n          key={optionSignature}\n          option={themed}\n          notMerge\n          lazyUpdate={false}\n          // Keep chart itself explicitly sized\n          style={{ height, width: width ?? \"100%\", ...style }} // RADIX_INLINE_STYLE_ALLOWED - ReactECharts requires style prop for dimensions\n          onEvents={onEvents}\n          echarts={echarts as unknown as any}\n          ref={__innerChartRef__ as any}\n        />\n      ) : (\n        <div className=\"p-4\">\n          <Skeleton className=\"h-[240px] w-full rounded-md\" />\n          <div className=\"mt-2 h-4 w-1/3 bg-muted rounded\" />\n        </div>\n      )}\n    </div>\n  );\n}\n\n\nfunction EChartContainerWithExport(props: EChartContainerProps & { exportRegistration?: EChartExportRegistration }) {\n  const innerRef = useRef<ReactEChartsType>(null as unknown as ReactEChartsType);\n\n  const exportMethods = useChartExport(innerRef as unknown as React.RefObject<ReactEChartsType>);\n\n  // Register/unregister with registry when id provided\n  React.useEffect(() => {\n    const reg = props.exportRegistration;\n    if (reg?.id) {\n      chartRegistry.register({\n        id: reg.id,\n        type: reg.type ?? 'custom',\n        title: reg.title ?? 'Chart',\n        studentId: reg.studentId,\n        filters: reg.filters,\n        dateRange: reg.dateRange,\n        getMethods: () => exportMethods,\n      });\n      // keep metadata up to date when inputs change\n      chartRegistry.updateMetadata(reg.id, {\n        type: reg.type ?? 'custom',\n        title: reg.title ?? 'Chart',\n        ...(reg.filters ? { filters: reg.filters } : {}),\n        ...(reg.dateRange ? { dateRange: reg.dateRange } : {}),\n      });\n      return () => chartRegistry.unregister(reg.id!);\n    }\n    return;\n  }, [props.exportRegistration?.id, props.exportRegistration?.title, props.exportRegistration?.studentId, props.exportRegistration?.type, props.exportRegistration?.filters, props.exportRegistration?.dateRange, exportMethods]);\n\n  return (\n    <EChartContainerBase {...props} __innerChartRef__={innerRef} />\n  );\n}\n\nexport const EChartContainer = memo(EChartContainerWithExport);\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/charts/TrendsChart.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No data available for selected time range\"","line":34,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":34,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>No data available for selected time range</p>","line":34,"column":16,"nodeType":"JSXText","endLine":34,"endColumn":57},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Try expanding the time range or adjusting filters\"","line":35,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":35,"endColumn":90},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs mt-1\">Try expanding the time range or adjusting filters</p>","line":35,"column":41,"nodeType":"JSXText","endLine":35,"endColumn":90},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":62,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":62,"endColumn":36,"suggestions":[{"messageId":"addBrackets","fix":{"range":[2091,2455],"text":"{ const emotionThreshold = 7;\n        const sensoryThreshold = 5;\n        option = buildEmotionTrendsOption(rows, {\n          title: 'Emotion Trends Over Time',\n          showMovingAverage: true,\n          movingAverageWindow: 7,\n          useDualYAxis: true,\n          thresholds: { emotion: emotionThreshold, sensory: sensoryThreshold },\n        });\n        break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":63,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":63,"endColumn":36,"suggestions":[{"messageId":"addBrackets","fix":{"range":[2091,2455],"text":"{ const emotionThreshold = 7;\n        const sensoryThreshold = 5;\n        option = buildEmotionTrendsOption(rows, {\n          title: 'Emotion Trends Over Time',\n          showMovingAverage: true,\n          movingAverageWindow: 7,\n          useDualYAxis: true,\n          thresholds: { emotion: emotionThreshold, sensory: sensoryThreshold },\n        });\n        break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Could not render chart\"","line":90,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":90,"endColumn":36},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Could not render chart</p>","line":90,"column":14,"nodeType":"JSXText","endLine":90,"endColumn":36},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"An internal error occurred while building the chart\"","line":91,"column":39,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":91,"endColumn":90},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs mt-1\">An internal error occurred while building the chart</p>","line":91,"column":39,"nodeType":"JSXText","endLine":91,"endColumn":90}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nconst EChartContainer = React.lazy(() => import('./EChartContainer').then(m => ({ default: m.EChartContainer })));\nimport { buildEmotionTrendsOption, buildAreaOption, buildScatterOption, buildComposedOption, TrendRow as ChartKitTrendRow } from './ChartKit';\nimport { Activity } from 'lucide-react';\nimport { logger } from '@/lib/logger';\nimport { ChartType } from '@/hooks/useVisualizationState';\nimport { EChartsOption } from 'echarts';\n\ninterface ChartDataPoint {\n  date: string;\n  timestamp: Date;\n  emotionCount: number;\n  avgEmotionIntensity: number;\n  positiveEmotions: number;\n  negativeEmotions: number;\n  sensorySeekingCount: number;\n  sensoryAvoidingCount: number;\n  totalSensoryInputs: number;\n  [key: string]: string | number | Date;\n}\n\ninterface TrendsChartProps {\n  chartData: ChartDataPoint[];\n  selectedChartType: ChartType;\n}\n\nexport const TrendsChart: React.FC<TrendsChartProps> = ({ chartData, selectedChartType }) => {\n  try {\n    if (chartData.length === 0) {\n      return (\n        <div className=\"flex items-center justify-center h-64 text-muted-foreground\">\n          <div className=\"text-center\">\n            <Activity className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n            <p>No data available for selected time range</p>\n            <p className=\"text-xs mt-1\">Try expanding the time range or adjusting filters</p>\n          </div>\n        </div>\n      );\n    }\n\n    const rows: ChartKitTrendRow[] = chartData.map(d => ({\n      date: d.date,\n      avgEmotionIntensity: Number(d.avgEmotionIntensity) || 0,\n      positiveEmotions: Number(d.positiveEmotions) || 0,\n      negativeEmotions: Number(d.negativeEmotions) || 0,\n      totalSensoryInputs: Number(d.totalSensoryInputs) || 0,\n    }));\n\n    let option: EChartsOption;\n\n    switch (selectedChartType) {\n      case 'area':\n        option = buildAreaOption(rows);\n        break;\n      case 'scatter':\n        option = buildScatterOption(rows);\n        break;\n      case 'composed':\n        option = buildComposedOption(rows);\n        break;\n      default: // line fallback\n        const emotionThreshold = 7;\n        const sensoryThreshold = 5;\n        option = buildEmotionTrendsOption(rows, {\n          title: 'Emotion Trends Over Time',\n          showMovingAverage: true,\n          movingAverageWindow: 7,\n          useDualYAxis: true,\n          thresholds: { emotion: emotionThreshold, sensory: sensoryThreshold },\n        });\n        break;\n    }\n\n    return (\n      <React.Suspense fallback={<div className=\"h-[400px] rounded-xl border bg-card motion-safe:animate-pulse\" aria-label=\"Loading trends\" />}> \n        <EChartContainer \n          option={option} \n          height={400}\n          exportRegistration={{ id: 'trends-main', type: 'trends', title: 'Emotion & Sensory Trends' }}\n        />\n      </React.Suspense>\n    );\n\n  } catch (error) {\n    logger.error(\"TrendsChart.renderChart failed\", { error });\n    return (\n      <div className=\"flex items-center justify-center h-64 text-muted-foreground\">\n        <div className=\"text-center\">\n          <Activity className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n          <p>Could not render chart</p>\n          <p className=\"text-xs mt-1\">An internal error occurred while building the chart</p>\n        </div>\n      </div>\n    );\n  }\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/dev/EnvDebug.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AI_ANALYSIS_ENABLED' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AI_MODEL_NAME' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":44},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'OPENROUTER_API_KEY' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":64},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AI_BASE_URL' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":66,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":77},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AI_LOCAL_ONLY' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":79,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":92},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Env / AI Debug\"","line":29,"column":20,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":29,"endColumn":34},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle>Env / AI Debug</CardTitle>","line":29,"column":20,"nodeType":"JSXText","endLine":29,"endColumn":34},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"AI enabled (loadAiConfig):\"","line":32,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":32,"endColumn":41},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>AI enabled (loadAiConfig): <strong>{String(ai.enabled)}</strong></div>","line":32,"column":14,"nodeType":"JSXText","endLine":32,"endColumn":41},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Model (loadAiConfig):\"","line":33,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":33,"endColumn":36},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Model (loadAiConfig): <code>{ai.modelName || '(none)'}</code></div>","line":33,"column":14,"nodeType":"JSXText","endLine":33,"endColumn":36},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"API key present (loadAiConfig):\"","line":34,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":34,"endColumn":46},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>API key present (loadAiConfig): <strong>{String(!!ai.apiKey)}</strong> <span className=\"text-muted-foreground\">({masked(ai.apiKey)})</span></div>","line":34,"column":14,"nodeType":"JSXText","endLine":34,"endColumn":46},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Base URL (loadAiConfig):\"","line":35,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":35,"endColumn":39},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Base URL (loadAiConfig): <code>{String((ai as any).baseUrl || 'https://openrouter.ai/api/v1')}</code></div>","line":35,"column":14,"nodeType":"JSXText","endLine":35,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2304,2307],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2304,2307],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Local only (loadAiConfig):\"","line":36,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":36,"endColumn":41},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Local only (loadAiConfig): <strong>{String((ai as any).localOnly || false)}</strong></div>","line":36,"column":14,"nodeType":"JSXText","endLine":36,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2429,2432],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2429,2432],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"AI enabled (live env):\"","line":37,"column":31,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":37,"endColumn":54},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"mt-2\">AI enabled (live env): <strong>{String(aiLive.enabled)}</strong></div>","line":37,"column":31,"nodeType":"JSXText","endLine":37,"endColumn":54},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Model (live env):\"","line":38,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":38,"endColumn":32},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Model (live env): <code>{aiLive.modelName}</code></div>","line":38,"column":14,"nodeType":"JSXText","endLine":38,"endColumn":32},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"API key present (live env):\"","line":39,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":39,"endColumn":42},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>API key present (live env): <strong>{String(!!aiLive.apiKey)}</strong> <span className=\"text-muted-foreground\">({masked(aiLive.apiKey)})</span></div>","line":39,"column":14,"nodeType":"JSXText","endLine":39,"endColumn":42},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Base URL (live env):\"","line":40,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":40,"endColumn":35},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Base URL (live env): <code>{aiLive.baseUrl}</code></div>","line":40,"column":14,"nodeType":"JSXText","endLine":40,"endColumn":35},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Live Vite env:\"","line":41,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":41,"endColumn":67},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"mt-2 text-muted-foreground\">Live Vite env:</div>","line":41,"column":53,"nodeType":"JSXText","endLine":41,"endColumn":67},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"VITE_OPENROUTER_API_KEY present:\"","line":42,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":42,"endColumn":47},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>VITE_OPENROUTER_API_KEY present: <strong>{String(!!env.VITE_OPENROUTER_API_KEY)}</strong> <span className=\"text-muted-foreground\">({masked(env.VITE_OPENROUTER_API_KEY)})</span></div>","line":42,"column":14,"nodeType":"JSXText","endLine":42,"endColumn":47},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"VITE_AI_ANALYSIS_ENABLED:\"","line":43,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":43,"endColumn":40},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>VITE_AI_ANALYSIS_ENABLED: <code>{String(env.VITE_AI_ANALYSIS_ENABLED)}</code></div>","line":43,"column":14,"nodeType":"JSXText","endLine":43,"endColumn":40},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"VITE_AI_MODEL_NAME:\"","line":44,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":44,"endColumn":34},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>VITE_AI_MODEL_NAME: <code>{String(env.VITE_AI_MODEL_NAME)}</code></div>","line":44,"column":14,"nodeType":"JSXText","endLine":44,"endColumn":34},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"VITE_AI_LOCAL_ONLY:\"","line":45,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":45,"endColumn":34},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>VITE_AI_LOCAL_ONLY: <code>{String(env.VITE_AI_LOCAL_ONLY || false)}</code></div>","line":45,"column":14,"nodeType":"JSXText","endLine":45,"endColumn":34},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"VITE_AI_BASE_URL:\"","line":46,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":46,"endColumn":32},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>VITE_AI_BASE_URL: <code>{String(env.VITE_AI_BASE_URL || '(default)')}</code></div>","line":46,"column":14,"nodeType":"JSXText","endLine":46,"endColumn":32},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"localStorage OPENROUTER_API_KEY present:\"","line":47,"column":31,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":47,"endColumn":72},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"mt-1\">localStorage OPENROUTER_API_KEY present: <strong>{String(!!lsKey)}</strong> <span className=\"text-muted-foreground\">({masked(lsKey)})</span></div>","line":47,"column":31,"nodeType":"JSXText","endLine":47,"endColumn":72},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Tip: set with\"","line":48,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":48,"endColumn":70},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-muted-foreground\">Tip: set with <code>localStorage.setItem('OPENROUTER_API_KEY', 'sk-or-…')</code></div>","line":48,"column":56,"nodeType":"JSXText","endLine":48,"endColumn":70},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"localStorage.setItem('OPENROUTER_API_KEY', 'sk-or-…')\"","line":48,"column":76,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":48,"endColumn":129},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <code>localStorage.setItem('OPENROUTER_API_KEY', 'sk-or-…')</code>","line":48,"column":76,"nodeType":"JSXText","endLine":48,"endColumn":129},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Note: Module-level constants can be stale after env changes; the app uses live env shown above.\"","line":49,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":49,"endColumn":143},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-muted-foreground\">Note: Module-level constants can be stale after env changes; the app uses live env shown above.</div>","line":49,"column":48,"nodeType":"JSXText","endLine":49,"endColumn":143},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Mode:\"","line":50,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":50,"endColumn":20},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Mode: <code>{String(env.MODE)}</code></div>","line":50,"column":14,"nodeType":"JSXText","endLine":50,"endColumn":20},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"AI Telemetry\"","line":54,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":54,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"font-medium mb-1\">AI Telemetry</div>","line":54,"column":45,"nodeType":"JSXText","endLine":54,"endColumn":57},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Requests:\"","line":60,"column":22,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":60,"endColumn":32},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Requests: <strong>{s.requests}</strong></div>","line":60,"column":22,"nodeType":"JSXText","endLine":60,"endColumn":32},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Success:\"","line":61,"column":22,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":61,"endColumn":31},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Success: <strong>{s.successes}</strong></div>","line":61,"column":22,"nodeType":"JSXText","endLine":61,"endColumn":31},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Failures:\"","line":62,"column":22,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":62,"endColumn":32},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Failures: <strong>{s.failures}</strong></div>","line":62,"column":22,"nodeType":"JSXText","endLine":62,"endColumn":32},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Retries:\"","line":63,"column":22,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":63,"endColumn":31},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Retries: <strong>{s.retries}</strong></div>","line":63,"column":22,"nodeType":"JSXText","endLine":63,"endColumn":31},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"JSON valid:\"","line":64,"column":22,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":64,"endColumn":34},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>JSON valid: <strong>{s.jsonValid}</strong></div>","line":64,"column":22,"nodeType":"JSXText","endLine":64,"endColumn":34},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Parse errors:\"","line":65,"column":22,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":65,"endColumn":36},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Parse errors: <strong>{s.jsonParseErrors}</strong></div>","line":65,"column":22,"nodeType":"JSXText","endLine":65,"endColumn":36},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Validate errors:\"","line":66,"column":22,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":66,"endColumn":39},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Validate errors: <strong>{s.jsonValidateErrors}</strong></div>","line":66,"column":22,"nodeType":"JSXText","endLine":66,"endColumn":39},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Avg latency:\"","line":67,"column":22,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":67,"endColumn":35},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Avg latency: <strong>{s.avgLatency} ms</strong></div>","line":67,"column":22,"nodeType":"JSXText","endLine":67,"endColumn":35},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <strong>{s.avgLatency} ms</strong>","line":67,"column":57,"nodeType":"JSXText","endLine":67,"endColumn":60},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"JSON gyldighet (global):\"","line":68,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":68,"endColumn":70},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"col-span-2\">JSON gyldighet (global): <strong>{pct}%</strong></div>","line":68,"column":45,"nodeType":"JSXText","endLine":68,"endColumn":70},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sist oppdatert:\"","line":69,"column":67,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":69,"endColumn":83},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"col-span-2 text-muted-foreground\">Sist oppdatert: {new Date(s.lastUpdated).toLocaleString()}</div>","line":69,"column":67,"nodeType":"JSXText","endLine":69,"endColumn":83},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Reset telemetry\"","line":74,"column":83,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":74,"endColumn":98},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button size=\"sm\" variant=\"outline\" onClick={() => aiMetrics.reset()}>Reset telemetry</Button>","line":74,"column":83,"nodeType":"JSXText","endLine":74,"endColumn":98}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":74,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { loadAiConfig } from '@/lib/aiConfig';\nimport { AI_ANALYSIS_ENABLED, AI_MODEL_NAME, OPENROUTER_API_KEY, AI_BASE_URL, AI_LOCAL_ONLY } from '@/lib/env';\nimport { getRuntimeEnv } from '@/lib/runtimeEnv';\nimport { aiMetrics } from '@/lib/ai/metrics';\n\nexport function EnvDebug(): JSX.Element | null {\n  if (!import.meta.env.DEV) return null;\n  const ai = loadAiConfig();\n  const env = getRuntimeEnv();\n  const masked = (s?: string) => (typeof s === 'string' && s.length > 8 ? s.slice(0, 4) + '…' + s.slice(-4) : s || '');\n  const toBool = (v: unknown) => (v ?? '').toString().toLowerCase() === '1' || (v ?? '').toString().toLowerCase() === 'true' || (v ?? '').toString().toLowerCase() === 'yes';\n  // Derive runtime values directly from live env for sanity-checking\n  const aiLive = {\n    enabled: toBool(env.VITE_AI_ANALYSIS_ENABLED),\n    modelName: typeof env.VITE_AI_MODEL_NAME === 'string' && env.VITE_AI_MODEL_NAME.trim().length > 0 ? (env.VITE_AI_MODEL_NAME as string) : '(unset)',\n    apiKey: typeof env.VITE_OPENROUTER_API_KEY === 'string' ? (env.VITE_OPENROUTER_API_KEY as string) : '',\n    baseUrl: typeof env.VITE_AI_BASE_URL === 'string' && (env.VITE_AI_BASE_URL as string).trim().length > 0 ? (env.VITE_AI_BASE_URL as string) : 'https://openrouter.ai/api/v1',\n    localOnly: toBool(env.VITE_AI_LOCAL_ONLY),\n  };\n  const getLS = (k: string) => { try { return typeof localStorage !== 'undefined' ? localStorage.getItem(k) || '' : ''; } catch { return ''; } };\n  const lsKey = getLS('OPENROUTER_API_KEY') || getLS('VITE_OPENROUTER_API_KEY');\n\n  return (\n    <Card className=\"bg-gradient-card border-0 shadow-soft\">\n      <CardHeader>\n        <CardTitle>Env / AI Debug</CardTitle>\n      </CardHeader>\n      <CardContent className=\"text-sm space-y-1\">\n        <div>AI enabled (loadAiConfig): <strong>{String(ai.enabled)}</strong></div>\n        <div>Model (loadAiConfig): <code>{ai.modelName || '(none)'}</code></div>\n        <div>API key present (loadAiConfig): <strong>{String(!!ai.apiKey)}</strong> <span className=\"text-muted-foreground\">({masked(ai.apiKey)})</span></div>\n        <div>Base URL (loadAiConfig): <code>{String((ai as any).baseUrl || 'https://openrouter.ai/api/v1')}</code></div>\n        <div>Local only (loadAiConfig): <strong>{String((ai as any).localOnly || false)}</strong></div>\n        <div className=\"mt-2\">AI enabled (live env): <strong>{String(aiLive.enabled)}</strong></div>\n        <div>Model (live env): <code>{aiLive.modelName}</code></div>\n        <div>API key present (live env): <strong>{String(!!aiLive.apiKey)}</strong> <span className=\"text-muted-foreground\">({masked(aiLive.apiKey)})</span></div>\n        <div>Base URL (live env): <code>{aiLive.baseUrl}</code></div>\n        <div className=\"mt-2 text-muted-foreground\">Live Vite env:</div>\n        <div>VITE_OPENROUTER_API_KEY present: <strong>{String(!!env.VITE_OPENROUTER_API_KEY)}</strong> <span className=\"text-muted-foreground\">({masked(env.VITE_OPENROUTER_API_KEY)})</span></div>\n        <div>VITE_AI_ANALYSIS_ENABLED: <code>{String(env.VITE_AI_ANALYSIS_ENABLED)}</code></div>\n        <div>VITE_AI_MODEL_NAME: <code>{String(env.VITE_AI_MODEL_NAME)}</code></div>\n        <div>VITE_AI_LOCAL_ONLY: <code>{String(env.VITE_AI_LOCAL_ONLY || false)}</code></div>\n        <div>VITE_AI_BASE_URL: <code>{String(env.VITE_AI_BASE_URL || '(default)')}</code></div>\n        <div className=\"mt-1\">localStorage OPENROUTER_API_KEY present: <strong>{String(!!lsKey)}</strong> <span className=\"text-muted-foreground\">({masked(lsKey)})</span></div>\n        <div className=\"text-xs text-muted-foreground\">Tip: set with <code>localStorage.setItem('OPENROUTER_API_KEY', 'sk-or-…')</code></div>\n        <div className=\"text-muted-foreground\">Note: Module-level constants can be stale after env changes; the app uses live env shown above.</div>\n        <div>Mode: <code>{String(env.MODE)}</code></div>\n\n        {/* AI Telemetry */}\n        <div className=\"mt-4 pt-3 border-t border-border/50\">\n          <div className=\"font-medium mb-1\">AI Telemetry</div>\n          {(() => {\n            const s = aiMetrics.summary();\n            const pct = Math.round((s.jsonValidity || 0) * 100);\n            return (\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs\">\n                <div>Requests: <strong>{s.requests}</strong></div>\n                <div>Success: <strong>{s.successes}</strong></div>\n                <div>Failures: <strong>{s.failures}</strong></div>\n                <div>Retries: <strong>{s.retries}</strong></div>\n                <div>JSON valid: <strong>{s.jsonValid}</strong></div>\n                <div>Parse errors: <strong>{s.jsonParseErrors}</strong></div>\n                <div>Validate errors: <strong>{s.jsonValidateErrors}</strong></div>\n                <div>Avg latency: <strong>{s.avgLatency} ms</strong></div>\n                <div className=\"col-span-2\">JSON gyldighet (global): <strong>{pct}%</strong></div>\n                <div className=\"col-span-2 text-muted-foreground\">Sist oppdatert: {new Date(s.lastUpdated).toLocaleString()}</div>\n              </div>\n            );\n          })()}\n          <div className=\"mt-2\">\n            <Button size=\"sm\" variant=\"outline\" onClick={() => aiMetrics.reset()}>Reset telemetry</Button>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/dev/ModelDiagnosticsPanel.tsx","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useTranslation\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":39,"column":42,"nodeType":"Identifier","endLine":39,"endColumn":56},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":40,"column":41,"nodeType":"Identifier","endLine":40,"endColumn":49},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":41,"column":47,"nodeType":"Identifier","endLine":41,"endColumn":55},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":42,"column":45,"nodeType":"Identifier","endLine":42,"endColumn":53},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":45,"column":31,"nodeType":"Identifier","endLine":45,"endColumn":39},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":51,"column":39,"nodeType":"Identifier","endLine":51,"endColumn":47},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useState\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":52,"column":37,"nodeType":"Identifier","endLine":52,"endColumn":45},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useId\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":55,"column":22,"nodeType":"Identifier","endLine":55,"endColumn":27},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useRef\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":56,"column":25,"nodeType":"Identifier","endLine":56,"endColumn":31},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useId\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":57,"column":22,"nodeType":"Identifier","endLine":57,"endColumn":27},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":60,"column":33,"nodeType":"Identifier","endLine":60,"endColumn":40},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has an unnecessary dependency: 'historyVersion'. Either exclude it or remove the dependency array.","line":63,"column":6,"nodeType":"ArrayExpression","endLine":63,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [modelFilter]","fix":{"range":[2321,2350],"text":"[modelFilter]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useCallback\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":68,"column":20,"nodeType":"Identifier","endLine":68,"endColumn":31},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useEffect\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":72,"column":3,"nodeType":"Identifier","endLine":72,"endColumn":12},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useCallback\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":80,"column":24,"nodeType":"Identifier","endLine":80,"endColumn":35},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useCallback\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":98,"column":26,"nodeType":"Identifier","endLine":98,"endColumn":37},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useCallback\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":104,"column":28,"nodeType":"Identifier","endLine":104,"endColumn":39},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useCallback\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":110,"column":26,"nodeType":"Identifier","endLine":110,"endColumn":37},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":111,"column":36,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":111,"endColumn":52},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useCallback\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":115,"column":23,"nodeType":"Identifier","endLine":115,"endColumn":34},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has an unnecessary dependency: 'logger'. Either exclude it or remove the dependency array. Outer scope values like 'logger' aren't valid dependencies because mutating them doesn't re-render the component.","line":181,"column":6,"nodeType":"ArrayExpression","endLine":181,"endColumn":87,"suggestions":[{"desc":"Update the dependencies array to be: [announce, cvForm, modelFilter, tAnalytics, validateForm, yieldToBrowser]","fix":{"range":[6881,6962],"text":"[announce, cvForm, modelFilter, tAnalytics, validateForm, yieldToBrowser]"}}]},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useCallback\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":183,"column":23,"nodeType":"Identifier","endLine":183,"endColumn":34},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":189,"column":35,"nodeType":"Identifier","endLine":189,"endColumn":42},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useCallback\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":194,"column":25,"nodeType":"Identifier","endLine":194,"endColumn":36}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'announce' and 'tAnalytics'. Either include them or remove the dependency array.","line":77,"column":6,"nodeType":"ArrayExpression","endLine":77,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [announce, filteredCount, tAnalytics]","fix":{"range":[2840,2855],"text":"[announce, filteredCount, tAnalytics]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":24,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useCallback, useEffect, useId, useMemo, useRef, useState } from 'react';\nimport type { ModelType } from '@/lib/mlModels';\nimport { getEvaluationHistory, clearEvaluationHistory, type EvaluationRun, recordEvaluation } from '@/lib/modelEvaluation';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Label } from '@/components/ui/label';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Separator } from '@/components/ui/separator';\nimport { VirtualScrollArea } from '@/components/VirtualScrollArea';\nimport { logger } from '@/lib/logger';\nimport { generateTimestampId } from '@/lib/uuid';\n\ninterface ModelDiagnosticsPanelProps {\n  className?: string;\n}\n\ntype ModelFilter = 'all' | ModelType;\n\ntype TimeSeriesStrategy = 'rolling' | 'expanding';\n\ninterface CVFormState {\n  strategy: TimeSeriesStrategy;\n  windowSize: number;\n  horizon: number;\n  folds: number;\n}\n\ninterface AnnounceMessage {\n  id: string;\n  text: string;\n  tone: 'polite' | 'assertive';\n}\n\nexport function ModelDiagnosticsPanel(props: ModelDiagnosticsPanelProps): React.ReactElement | null {\n  if (!import.meta.env.DEV) return null;\n\n  const { tAnalytics, formatDateTime } = useTranslation();\n  const [modelFilter, setModelFilter] = useState<ModelFilter>('all');\n  const [historyVersion, setHistoryVersion] = useState<number>(0);\n  const [announcements, setAnnouncements] = useState<AnnounceMessage[]>([]);\n\n  // Form state with strict types\n  const [cvForm, setCvForm] = useState<CVFormState>({\n    strategy: 'rolling',\n    windowSize: 24,\n    horizon: 1,\n    folds: 5,\n  });\n  const [formErrors, setFormErrors] = useState<Partial<Record<keyof CVFormState, string>>>({});\n  const [isRunning, setIsRunning] = useState<boolean>(false);\n\n  // A11y IDs\n  const skipLinkId = useId();\n  const liveRegionRef = useRef<HTMLDivElement | null>(null);\n  const formDescId = useId();\n\n  // Read and memoize evaluation history\n  const runs: EvaluationRun[] = useMemo(() => {\n    const list = getEvaluationHistory(modelFilter === 'all' ? undefined : (modelFilter as ModelType));\n    return list;\n  }, [modelFilter, historyVersion]);\n\n  const filteredCount = runs.length;\n\n  // Announce helper\n  const announce = useCallback((text: string, tone: 'polite' | 'assertive' = 'polite'): void => {\n    setAnnouncements((prev) => [...prev, { id: generateTimestampId('aria'), text, tone }]);\n  }, []);\n\n  useEffect(() => {\n    if (filteredCount >= 0) {\n      announce(tAnalytics('dev.modelDiagnostics.announced.loaded', { count: filteredCount }), 'polite');\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [filteredCount]);\n\n  // Validate form\n  const validateForm = useCallback((next: CVFormState): boolean => {\n    const errs: Partial<Record<keyof CVFormState, string>> = {};\n    if (!Number.isFinite(next.windowSize) || next.windowSize <= 0) {\n      errs.windowSize = tAnalytics('dev.modelDiagnostics.errors.windowSize');\n    }\n    if (!Number.isFinite(next.horizon) || next.horizon <= 0) {\n      errs.horizon = tAnalytics('dev.modelDiagnostics.errors.horizon');\n    }\n    if (!Number.isFinite(next.folds) || next.folds <= 0) {\n      errs.folds = tAnalytics('dev.modelDiagnostics.errors.folds');\n    }\n    setFormErrors(errs);\n    if (Object.keys(errs).length > 0) {\n      announce(tAnalytics('dev.modelDiagnostics.announced.formInvalid'), 'assertive');\n    }\n    return Object.keys(errs).length === 0;\n  }, [announce, tAnalytics]);\n\n  const onChangeNumber = useCallback((key: keyof Pick<CVFormState, 'windowSize' | 'horizon' | 'folds'>) => (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = Number(e.target.value);\n    const next = { ...cvForm, [key]: value } as CVFormState;\n    setCvForm(next);\n  }, [cvForm]);\n\n  const onChangeStrategy = useCallback((value: string) => {\n    const next = { ...cvForm, strategy: (value as TimeSeriesStrategy) } as CVFormState;\n    setCvForm(next);\n  }, [cvForm]);\n\n  // Cooperative yield to avoid blocking the main thread\n  const yieldToBrowser = useCallback(async () => {\n    await new Promise<void>((r) => setTimeout(r, 0));\n  }, []);\n\n  // Run TS CV lazily to avoid pulling ML chunk until needed\n  const handleRunCV = useCallback(async () => {\n    const valid = validateForm(cvForm);\n    if (!valid) return;\n    setIsRunning(true);\n    try {\n      const [{ CrossValidator }, tf] = await Promise.all([\n        import('@/lib/validation/crossValidation'),\n        import('@tensorflow/tfjs'),\n      ]);\n\n      // Yield after loading heavy libs\n      await yieldToBrowser();\n\n      // Compute minimal dataset length to allow the requested number of folds\n      const gap = 0;\n      const n = Math.max(cvForm.windowSize + (cvForm.horizon + gap) * cvForm.folds, cvForm.windowSize + 1);\n\n      // Allocate tensors in a separate tick\n      const features = tf.tensor2d(new Array(n * 2).fill(0), [n, 2]);\n      const labels = tf.tensor2d(new Array(n * 2).fill(0), [n, 2]);\n      const trainingData = { features, labels } as unknown as import('@/types/ml').TrainingData;\n\n      await yieldToBrowser();\n\n      const validator = new CrossValidator();\n      // Generating folds can be heavy; do it after a yield and keep pure\n      const folds = validator.generateTimeSeriesFolds(trainingData, {\n        strategy: cvForm.strategy,\n        windowSize: cvForm.windowSize,\n        horizon: cvForm.horizon,\n        gap,\n        folds: cvForm.folds,\n      });\n\n      await yieldToBrowser();\n\n      // Record a lightweight EvaluationRun entry to history\n      const run: EvaluationRun = {\n        id: generateTimestampId('eval'),\n        modelType: (modelFilter === 'all' ? ('emotion-prediction' as ModelType) : (modelFilter as ModelType)),\n        timestamp: Date.now(),\n        dataSignature: '',\n        configSignature: '',\n        taskType: 'regression',\n        metrics: { regression: { mae: undefined, mse: undefined, rmse: undefined, r2: undefined, mape: undefined } },\n        cv: {\n          strategy: 'time-series',\n          windowSize: cvForm.windowSize,\n          horizon: cvForm.horizon,\n          folds: folds.length,\n        },\n        notes: `dev:ts-cv:${cvForm.strategy}`,\n        schemaVersion: '1',\n      };\n      recordEvaluation(run);\n      setHistoryVersion((v) => v + 1);\n      announce(tAnalytics('dev.modelDiagnostics.announced.cvComplete', { folds: folds.length }), 'polite');\n\n      // Cleanup tensors\n      tf.dispose([features, labels]);\n    } catch (error) {\n      logger.error('[ModelDiagnosticsPanel] Failed to run time-series CV', error);\n      announce(tAnalytics('dev.modelDiagnostics.announced.cvFailed'), 'assertive');\n    } finally {\n      setIsRunning(false);\n    }\n  }, [announce, cvForm, logger, modelFilter, tAnalytics, validateForm, yieldToBrowser]);\n\n  const handleClear = useCallback(() => {\n    clearEvaluationHistory(modelFilter === 'all' ? undefined : (modelFilter as ModelType));\n    setHistoryVersion((v) => v + 1);\n    announce(tAnalytics('dev.modelDiagnostics.announced.cleared'), 'polite');\n  }, [announce, modelFilter, tAnalytics]);\n\n  const modelTypes: ModelType[] = useMemo(() => (\n    ['emotion-prediction', 'sensory-response', 'baseline-clustering'] as ModelType[]\n  ), []);\n\n  // Render helpers\n  const renderRunItem = useCallback((run: EvaluationRun): React.ReactNode => {\n    const title = `${run.modelType} — ${run.cv?.strategy ?? run.taskType}`;\n    const subtitle = formatDateTime(new Date(run.timestamp));\n    const cv = run.cv ? `${tAnalytics('dev.modelDiagnostics.list.strategy')}: ${run.cv.strategy} • ${tAnalytics('dev.modelDiagnostics.list.windowSize')}: ${run.cv.windowSize} • ${tAnalytics('dev.modelDiagnostics.list.horizon')}: ${run.cv.horizon} • ${tAnalytics('dev.modelDiagnostics.list.folds')}: ${run.cv.folds ?? '-'}` : '-';\n    return (\n      <div className=\"px-3 py-2\" key={run.id}>\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <div className=\"text-sm font-medium text-foreground\">{title}</div>\n            <div className=\"text-xs text-muted-foreground\">{subtitle}</div>\n          </div>\n          <div className=\"text-xs text-muted-foreground\">{cv}</div>\n        </div>\n      </div>\n    );\n  }, [formatDateTime, tAnalytics]);\n\n  const historyContainerHeight = 320; // px, fixed for virtualization\n  const itemHeight = 56; // px per item row\n\n  return (\n    <section aria-labelledby=\"model-diagnostics-heading\" role=\"region\" className={props.className}>\n      <a href={`#${skipLinkId}`} className=\"sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 bg-primary text-primary-foreground px-2 py-1 rounded\">\n        {tAnalytics('dev.modelDiagnostics.a11y.skipToContent')}\n      </a>\n\n      <Card className=\"glass-card\">\n        <CardHeader>\n          <CardTitle id=\"model-diagnostics-heading\" className=\"text-lg\">\n            {tAnalytics('dev.modelDiagnostics.title')}\n          </CardTitle>\n        </CardHeader>\n        <CardContent id={skipLinkId}>\n          <div className=\"grid gap-4\">\n            <div className=\"flex flex-col md:flex-row md:items-end gap-3\" role=\"form\" aria-describedby={formDescId}>\n              <div id={formDescId} className=\"sr-only\">\n                {tAnalytics('dev.modelDiagnostics.formDescription')}\n              </div>\n\n              <div className=\"w-full md:w-40\">\n                <Label htmlFor=\"model-type-filter\">{tAnalytics('dev.modelDiagnostics.filters.modelType')}</Label>\n                <Select value={modelFilter} onValueChange={(v) => setModelFilter(v as ModelFilter)}>\n                  <SelectTrigger id=\"model-type-filter\" aria-label={tAnalytics('dev.modelDiagnostics.filters.modelType')}>\n                    <SelectValue placeholder={tAnalytics('dev.modelDiagnostics.filters.all')} />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">{tAnalytics('dev.modelDiagnostics.filters.all')}</SelectItem>\n                    {modelTypes.map((mt) => (\n                      <SelectItem key={mt} value={mt}>{mt}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <Separator className=\"hidden md:block\" />\n\n              <div className=\"w-full md:w-44\">\n                <Label htmlFor=\"cv-strategy\">{tAnalytics('dev.modelDiagnostics.cv.strategy')}</Label>\n                <Select value={cvForm.strategy} onValueChange={onChangeStrategy}>\n                  <SelectTrigger id=\"cv-strategy\" aria-label={tAnalytics('dev.modelDiagnostics.cv.strategy')}>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"rolling\">{tAnalytics('dev.modelDiagnostics.cv.rolling')}</SelectItem>\n                    <SelectItem value=\"expanding\">{tAnalytics('dev.modelDiagnostics.cv.expanding')}</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"w-full md:w-28\">\n                <Label htmlFor=\"cv-windowSize\">{tAnalytics('dev.modelDiagnostics.cv.windowSize')}</Label>\n                <Input\n                  id=\"cv-windowSize\"\n                  type=\"number\"\n                  inputMode=\"numeric\"\n                  value={cvForm.windowSize}\n                  onChange={onChangeNumber('windowSize')}\n                  aria-invalid={Boolean(formErrors.windowSize)}\n                  aria-describedby={formErrors.windowSize ? 'cv-windowSize-error' : undefined}\n                />\n                {formErrors.windowSize && (\n                  <div id=\"cv-windowSize-error\" className=\"mt-1 text-xs text-destructive\">\n                    {formErrors.windowSize}\n                  </div>\n                )}\n              </div>\n\n              <div className=\"w-full md:w-28\">\n                <Label htmlFor=\"cv-horizon\">{tAnalytics('dev.modelDiagnostics.cv.horizon')}</Label>\n                <Input\n                  id=\"cv-horizon\"\n                  type=\"number\"\n                  inputMode=\"numeric\"\n                  value={cvForm.horizon}\n                  onChange={onChangeNumber('horizon')}\n                  aria-invalid={Boolean(formErrors.horizon)}\n                  aria-describedby={formErrors.horizon ? 'cv-horizon-error' : undefined}\n                />\n                {formErrors.horizon && (\n                  <div id=\"cv-horizon-error\" className=\"mt-1 text-xs text-destructive\">\n                    {formErrors.horizon}\n                  </div>\n                )}\n              </div>\n\n              <div className=\"w-full md:w-28\">\n                <Label htmlFor=\"cv-folds\">{tAnalytics('dev.modelDiagnostics.cv.folds')}</Label>\n                <Input\n                  id=\"cv-folds\"\n                  type=\"number\"\n                  inputMode=\"numeric\"\n                  value={cvForm.folds}\n                  onChange={onChangeNumber('folds')}\n                  aria-invalid={Boolean(formErrors.folds)}\n                  aria-describedby={formErrors.folds ? 'cv-folds-error' : undefined}\n                />\n                {formErrors.folds && (\n                  <div id=\"cv-folds-error\" className=\"mt-1 text-xs text-destructive\">\n                    {formErrors.folds}\n                  </div>\n                )}\n              </div>\n\n              <div className=\"flex gap-2\">\n                <Button onClick={handleRunCV} disabled={isRunning}>\n                  {isRunning ? tAnalytics('dev.modelDiagnostics.running') : tAnalytics('dev.modelDiagnostics.runTsCv')}\n                </Button>\n                <Button variant=\"outline\" onClick={handleClear}>\n                  {tAnalytics('dev.modelDiagnostics.clearHistory')}\n                </Button>\n              </div>\n            </div>\n\n            <div className=\"mt-2\" aria-live=\"polite\" ref={liveRegionRef}>\n              {/* Announce updates once; render visually hidden list to trigger SR */}\n              <ul className=\"sr-only\">\n                {announcements.map((a) => (\n                  <li key={a.id} aria-live={a.tone}>{a.text}</li>\n                ))}\n              </ul>\n            </div>\n\n            <div>\n              <h2 className=\"text-base font-semibold text-foreground\">\n                {tAnalytics('dev.modelDiagnostics.latestRuns')} ({filteredCount})\n              </h2>\n              <div className=\"mt-2 border rounded-md\">\n                <VirtualScrollArea\n                  items={runs}\n                  itemHeight={itemHeight}\n                  containerHeight={historyContainerHeight}\n                  overscan={6}\n                  renderItem={(item) => renderRunItem(item)}\n                  className=\"rounded-md\"\n                />\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </section>\n  );\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/layouts/DashboardLayout.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Trends\"","line":43,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":45,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"trends\" className=\"flex items-center gap-2\">\n          <TrendingUp className=\"h-4 w-4\" />\n          Trends\n        </TabsTrigger>","line":43,"column":45,"nodeType":"JSXText","endLine":45,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Correlations\"","line":47,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":49,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"correlations\" className=\"flex items-center gap-2\">\n          <Target className=\"h-4 w-4\" />\n          Correlations\n        </TabsTrigger>","line":47,"column":41,"nodeType":"JSXText","endLine":49,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Patterns\"","line":51,"column":38,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":53,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"patterns\" className=\"flex items-center gap-2\">\n          <Zap className=\"h-4 w-4\" />\n          Patterns\n        </TabsTrigger>","line":51,"column":38,"nodeType":"JSXText","endLine":53,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"3D View\"","line":56,"column":40,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":58,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"3d\" className=\"flex items-center gap-2\">\n            <Eye className=\"h-4 w-4\" />\n            3D View\n          </TabsTrigger>","line":56,"column":40,"nodeType":"JSXText","endLine":58,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Timeline\"","line":61,"column":40,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":63,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"timeline\" className=\"flex items-center gap-2\">\n          <Clock className=\"h-4 w-4\" />\n          Timeline\n        </TabsTrigger>","line":61,"column":40,"nodeType":"JSXText","endLine":63,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Avg Emotion Intensity\"","line":73,"column":76,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":73,"endColumn":97},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm font-medium text-muted-foreground\">Avg Emotion Intensity</p>","line":73,"column":76,"nodeType":"JSXText","endLine":73,"endColumn":97},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Positive Emotion Rate\"","line":89,"column":76,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":89,"endColumn":97},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm font-medium text-muted-foreground\">Positive Emotion Rate</p>","line":89,"column":76,"nodeType":"JSXText","endLine":89,"endColumn":97},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory Seeking Rate\"","line":107,"column":76,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":107,"endColumn":96},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm font-medium text-muted-foreground\">Sensory Seeking Rate</p>","line":107,"column":76,"nodeType":"JSXText","endLine":107,"endColumn":96},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Significant Correlations\"","line":129,"column":26,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":129,"endColumn":50},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle>Significant Correlations</CardTitle>","line":129,"column":26,"nodeType":"JSXText","endLine":129,"endColumn":50},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":134,"column":29,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":134,"endColumn":34},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"↔\"","line":137,"column":106,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":137,"endColumn":108},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"correlation (r =\"","line":141,"column":73,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":141,"endColumn":91},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground\">\n                        {pair.correlation > 0 ? 'Positive' : 'Negative'} correlation (r = {pair.correlation.toFixed(3)})\n                      </p>","line":141,"column":73,"nodeType":"JSXText","endLine":141,"endColumn":91}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":22,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { POC_MODE } from '@/lib/env';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Badge } from '@/components/ui/badge';\nimport {\n  TrendingUp,\n  Target,\n  Zap,\n  Eye,\n  Clock,\n  Brain,\n  Activity,\n} from 'lucide-react';\nimport { CorrelationMatrix } from '@/lib/enhancedPatternAnalysis';\n\ninterface DashboardLayoutProps {\n  renderTrendsChart: () => React.ReactNode;\n  renderCorrelationHeatmap: () => React.ReactNode;\n  renderPatternAnalysis: () => React.ReactNode;\n  render3dVisualization: () => React.ReactNode;\n  renderTimeline: () => React.ReactNode;\n  filteredData: {\n    emotions: { intensity: number; emotion: string }[];\n    sensoryInputs: { response?: string }[];\n  };\n  correlationMatrix: CorrelationMatrix | null;\n}\n\nexport const DashboardLayout: React.FC<DashboardLayoutProps> = ({\n  renderTrendsChart,\n  renderCorrelationHeatmap,\n  renderPatternAnalysis,\n  render3dVisualization,\n  renderTimeline,\n  filteredData,\n  correlationMatrix,\n}) => {\n  return (\n    <Tabs defaultValue=\"trends\" className=\"w-full\">\n      <TabsList className=\"grid w-full grid-cols-5\" aria-label=\"Visualization tabs\">\n        <TabsTrigger value=\"trends\" className=\"flex items-center gap-2\">\n          <TrendingUp className=\"h-4 w-4\" />\n          Trends\n        </TabsTrigger>\n        <TabsTrigger value=\"correlations\" className=\"flex items-center gap-2\">\n          <Target className=\"h-4 w-4\" />\n          Correlations\n        </TabsTrigger>\n        <TabsTrigger value=\"patterns\" className=\"flex items-center gap-2\">\n          <Zap className=\"h-4 w-4\" />\n          Patterns\n        </TabsTrigger>\n        {!POC_MODE && (\n          <TabsTrigger value=\"3d\" className=\"flex items-center gap-2\">\n            <Eye className=\"h-4 w-4\" />\n            3D View\n          </TabsTrigger>\n        )}\n        <TabsTrigger value=\"timeline\" className=\"flex items-center gap-2\">\n          <Clock className=\"h-4 w-4\" />\n          Timeline\n        </TabsTrigger>\n      </TabsList>\n\n      <TabsContent value=\"trends\" className=\"space-y-6\">\n        {renderTrendsChart()}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          <Card>\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">Avg Emotion Intensity</p>\n                  <p className=\"text-2xl font-bold\">\n                    {filteredData.emotions.length > 0\n                      ? (filteredData.emotions.reduce((sum, e) => sum + e.intensity, 0) / filteredData.emotions.length).toFixed(1)\n                      : '0'\n                    }\n                  </p>\n                </div>\n                <Brain className=\"h-8 w-8 text-muted-foreground\" />\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">Positive Emotion Rate</p>\n                  <p className=\"text-2xl font-bold\">\n                    {filteredData.emotions.length > 0\n                      ? Math.round((filteredData.emotions.filter(e =>\n                          ['happy', 'calm', 'focused', 'excited', 'proud'].includes(e.emotion.toLowerCase())\n                        ).length / filteredData.emotions.length) * 100)\n                      : 0\n                    }%\n                  </p>\n                </div>\n                <Eye className=\"h-8 w-8 text-muted-foreground\" />\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">Sensory Seeking Rate</p>\n                  <p className=\"text-2xl font-bold\">\n                    {filteredData.sensoryInputs.length > 0\n                      ? Math.round((filteredData.sensoryInputs.filter(s =>\n                          s.response?.toLowerCase().includes('seeking')\n                        ).length / filteredData.sensoryInputs.length) * 100)\n                      : 0\n                    }%\n                  </p>\n                </div>\n                <Activity className=\"h-8 w-8 text-muted-foreground\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </TabsContent>\n\n      <TabsContent value=\"correlations\" className=\"space-y-6\">\n        {renderCorrelationHeatmap()}\n        {correlationMatrix && correlationMatrix.significantPairs.length > 0 && (\n          <Card>\n            <CardHeader>\n              <CardTitle>Significant Correlations</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-3\">\n                {correlationMatrix.significantPairs.slice(0, 5).map((pair, index) => (\n                  <div key={index} className=\"flex items-center justify-between p-3 border rounded-lg\">\n                    <div className=\"flex-1\">\n                      <p className=\"font-medium\">\n                        {pair.factor1.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())} ↔{' '}\n                        {pair.factor2.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}\n                      </p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {pair.correlation > 0 ? 'Positive' : 'Negative'} correlation (r = {pair.correlation.toFixed(3)})\n                      </p>\n                    </div>\n                    <Badge variant={pair.significance === 'high' ? 'default' : 'outline'}>\n                      {pair.significance}\n                    </Badge>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </TabsContent>\n\n      <TabsContent value=\"patterns\" className=\"space-y-6\">\n        {renderPatternAnalysis()}\n      </TabsContent>\n\n      {!POC_MODE && (\n        <TabsContent value=\"3d\">\n          {render3dVisualization()}\n        </TabsContent>\n      )}\n\n      <TabsContent value=\"timeline\">\n        {renderTimeline()}\n      </TabsContent>\n    </Tabs>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/layouts/ResizableSplitLayout.tsx","messages":[{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":55,"column":83,"nodeType":"BlockStatement","messageId":"unexpected","endLine":55,"endColumn":85,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2039,2039],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":57,"column":102,"nodeType":"BlockStatement","messageId":"unexpected","endLine":57,"endColumn":104,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2177,2177],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":64,"column":104,"nodeType":"BlockStatement","messageId":"unexpected","endLine":64,"endColumn":106,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2385,2385],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'startX' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":77,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":77,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'startRatio' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":78,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":78,"endColumn":21},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":80,"column":76,"nodeType":"BlockStatement","messageId":"unexpected","endLine":80,"endColumn":78,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3004,3004],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":97,"column":90,"nodeType":"BlockStatement","messageId":"unexpected","endLine":97,"endColumn":92,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3578,3578],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":102,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":102,"endColumn":58},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":103,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":103,"endColumn":70},{"ruleId":"no-restricted-syntax","severity":1,"message":"Avoid inline styles (style={{}}). Use Tailwind CSS classes or CSS custom properties for styling. See rule 3wIMH0UDSwsNj5RYGo17Vg. Exception: Radix primitives with // RADIX_INLINE_STYLE_ALLOWED comment.","line":136,"column":7,"nodeType":"JSXAttribute","messageId":"restrictedSyntax","endLine":141,"endColumn":9},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5003,5006],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5003,5006],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { cn } from '@/lib/utils';\nimport { logger } from '@/lib/logger';\n\nexport interface ResizableSplitLayoutProps {\n  left: React.ReactNode;\n  right: React.ReactNode;\n  defaultRatio?: number; // proportion for left pane [0..1]\n  minLeftPx?: number;\n  minRightPx?: number;\n  storageKey: string;\n  collapsedRight?: boolean;\n  onCollapsedChange?: (collapsed: boolean) => void;\n  onResizeStart?: () => void;\n  onResizeEnd?: (ratio: number) => void;\n  className?: string;\n}\n\n/**\n * ResizableSplitLayout\n *\n * Accessible, high-performance split layout with a draggable separator.\n * - Keyboard: focus the separator and use ArrowLeft/Right (Shift = larger step)\n * - Pointer: drag the handle (requestAnimationFrame throttled)\n * - Double-click on the handle resets to defaultRatio\n * - State persistence using localStorage via storageKey\n */\nexport function ResizableSplitLayout({\n  left,\n  right,\n  defaultRatio = 0.55,\n  minLeftPx = 320,\n  minRightPx = 360,\n  storageKey,\n  collapsedRight: collapsedRightProp,\n  onCollapsedChange,\n  onResizeStart,\n  onResizeEnd,\n  className,\n}: ResizableSplitLayoutProps): React.ReactElement {\n  const containerRef = React.useRef<HTMLDivElement | null>(null);\n  const [ratio, setRatio] = React.useState<number>(() => {\n    try { const v = localStorage.getItem(`${storageKey}:ratio`); return v ? Math.min(0.9, Math.max(0.1, parseFloat(v))) : defaultRatio; } catch { return defaultRatio; }\n  });\n  const [collapsedRight, setCollapsedRight] = React.useState<boolean>(() => {\n    if (typeof collapsedRightProp === 'boolean') return collapsedRightProp;\n    try { const v = localStorage.getItem(`${storageKey}:collapsedRight`); return v === '1'; } catch { return false; }\n  });\n\n  React.useEffect(() => {\n    if (typeof collapsedRightProp === 'boolean') setCollapsedRight(collapsedRightProp);\n  }, [collapsedRightProp]);\n\n  const persist = (nextRatio: number, nextCollapsed: boolean | null = null) => {\n    try { localStorage.setItem(`${storageKey}:ratio`, String(nextRatio)); } catch {}\n    if (nextCollapsed !== null) {\n      try { localStorage.setItem(`${storageKey}:collapsedRight`, nextCollapsed ? '1' : '0'); } catch {}\n    }\n  };\n\n  const setCollapsed = (v: boolean) => {\n    setCollapsedRight(v);\n    persist(ratio, v);\n    try { onCollapsedChange?.(v); logger.info('[UI] split.collapse.change', { collapsed: v }); } catch {}\n  };\n\n  const clampRatio = (r: number, containerWidth: number) => {\n    const minLeftRatio = minLeftPx / containerWidth;\n    const minRightRatio = minRightPx / containerWidth;\n    return Math.min(1 - minRightRatio, Math.max(minLeftRatio, r));\n  };\n\n  const onPointerDown: React.PointerEventHandler<HTMLDivElement> = (e) => {\n    if (!containerRef.current) return;\n    const container = containerRef.current;\n    const bounds = container.getBoundingClientRect();\n    const startX = e.clientX;\n    const startRatio = ratio;\n    let frame = 0;\n    try { onResizeStart?.(); logger.info('[UI] split.drag.start'); } catch {}\n\n    const move = (clientX: number) => {\n      const containerWidth = bounds.width;\n      const leftPx = Math.max(0, Math.min(containerWidth, clientX - bounds.left));\n      const next = clampRatio(leftPx / containerWidth, containerWidth);\n      setRatio(next);\n    };\n\n    const onPointerMove = (ev: PointerEvent) => {\n      if (frame) return;\n      frame = requestAnimationFrame(() => {\n        frame = 0;\n        move(ev.clientX);\n      });\n    };\n    const onPointerUp = () => {\n      try { onResizeEnd?.(ratio); logger.info('[UI] split.drag.end', { ratio }); } catch {}\n      persist(ratio);\n      window.removeEventListener('pointermove', onPointerMove);\n      window.removeEventListener('pointerup', onPointerUp);\n    };\n    window.addEventListener('pointermove', onPointerMove);\n    window.addEventListener('pointerup', onPointerUp, { once: true });\n  };\n\n  const onKeyDown: React.KeyboardEventHandler<HTMLDivElement> = (e) => {\n    if (!containerRef.current) return;\n    const containerWidth = containerRef.current.getBoundingClientRect().width;\n    const step = (e.shiftKey ? 0.08 : 0.02);\n    if (e.key === 'ArrowLeft') {\n      e.preventDefault();\n      const next = clampRatio(ratio - step, containerWidth);\n      setRatio(next); persist(next);\n    } else if (e.key === 'ArrowRight') {\n      e.preventDefault();\n      const next = clampRatio(ratio + step, containerWidth);\n      setRatio(next); persist(next);\n    } else if (e.key === 'Enter' || e.key === ' ') {\n      e.preventDefault();\n      setCollapsed(!collapsedRight);\n    }\n  };\n\n  const onDoubleClick: React.MouseEventHandler<HTMLDivElement> = () => {\n    setRatio(defaultRatio); persist(defaultRatio);\n  };\n\n  const gridTemplate = collapsedRight\n    ? '1fr var(--split-handle) 0px'\n    : `${Math.round(ratio * 100)}% var(--split-handle) 1fr`;\n\n  return (\n    <div\n      ref={containerRef}\n      className={cn('relative h-full w-full', className)}\n      style={{\n        // handle width as CSS var\n        ['--split-handle' as any]: '12px',\n        display: 'grid',\n        gridTemplateColumns: gridTemplate,\n      }}\n    >\n      <div className=\"min-w-0 overflow-hidden border-r\">{left}</div>\n      <div\n        role=\"separator\"\n        aria-orientation=\"vertical\"\n        tabIndex={0}\n        aria-label=\"Resizer\"\n        onPointerDown={onPointerDown}\n        onKeyDown={onKeyDown}\n        onDoubleClick={onDoubleClick}\n        className=\"group relative flex items-stretch justify-center cursor-col-resize outline-none\"\n      >\n        <div className=\"pointer-events-none absolute inset-y-0 w-px bg-border\" />\n        <button\n          type=\"button\"\n          className=\"m-auto h-16 w-1.5 rounded-full bg-border group-hover:bg-foreground/30 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring\"\n          aria-label=\"Dra for å endre størrelse\"\n          title=\"Dra for å endre størrelse • Dobbeltklikk for å nullstille • Enter for å skjule/vis\"\n          onClick={(e) => { e.preventDefault(); }}\n        />\n      </div>\n      <div className={cn('min-w-0 overflow-hidden', collapsedRight ? 'hidden' : '')}>{right}</div>\n    </div>\n  );\n}\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/layouts/VisualizationLayouts.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Select visualizations to display\"","line":21,"column":36,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":21,"endColumn":68},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-lg\">Select visualizations to display</p>","line":21,"column":36,"nodeType":"JSXText","endLine":21,"endColumn":68},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Choose from the options above\"","line":22,"column":36,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":22,"endColumn":65},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm\">Choose from the options above</p>","line":22,"column":36,"nodeType":"JSXText","endLine":22,"endColumn":65},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Select a visualization to focus on\"","line":49,"column":36,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":49,"endColumn":70},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-lg\">Select a visualization to focus on</p>","line":49,"column":36,"nodeType":"JSXText","endLine":49,"endColumn":70},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Choose from the options above\"","line":50,"column":36,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":50,"endColumn":65},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm\">Choose from the options above</p>","line":50,"column":36,"nodeType":"JSXText","endLine":50,"endColumn":65}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Grid3x3, Focus } from 'lucide-react';\nimport { VisualizationType } from '@/hooks/useVisualizationState';\n\ninterface LayoutProps {\n  renderVisualization: (type: VisualizationType) => React.ReactNode;\n}\n\ninterface GridLayoutProps extends LayoutProps {\n  selectedVisualizations: VisualizationType[];\n}\n\nexport const GridLayout: React.FC<GridLayoutProps> = ({ selectedVisualizations, renderVisualization }) => {\n  if (selectedVisualizations.length === 0) {\n    return (\n      <Card className=\"col-span-full\">\n        <CardContent className=\"flex items-center justify-center h-96\">\n          <div className=\"text-center text-muted-foreground\">\n            <Grid3x3 className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n            <p className=\"text-lg\">Select visualizations to display</p>\n            <p className=\"text-sm\">Choose from the options above</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n      {selectedVisualizations.map(type => (\n        <div key={type}>{renderVisualization(type)}</div>\n      ))}\n    </div>\n  );\n};\n\ninterface FocusLayoutProps extends LayoutProps {\n  focusedVisualization: VisualizationType | null;\n}\n\nexport const FocusLayout: React.FC<FocusLayoutProps> = ({ focusedVisualization, renderVisualization }) => {\n  if (!focusedVisualization) {\n    return (\n      <Card>\n        <CardContent className=\"flex items-center justify-center h-96\">\n          <div className=\"text-center text-muted-foreground\">\n            <Focus className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n            <p className=\"text-lg\">Select a visualization to focus on</p>\n            <p className=\"text-sm\">Choose from the options above</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {renderVisualization(focusedVisualization)}\n    </div>\n  );\n};\n\n// For now, ComparisonLayout can be the same as GridLayout. It can be specialized later.\nexport const ComparisonLayout = GridLayout;\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/lazy/LazyAlertsPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/lazy/LazyAnalyticsDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tCommon' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":22,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { Suspense, lazy } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Brain } from 'lucide-react';\nimport { Student, TrackingEntry, EmotionEntry, SensoryEntry } from '@/types/student';\nimport { useTranslation } from '@/hooks/useTranslation';\n\n// Lazy load the heavy analytics dashboard component\nconst AnalyticsDashboard = lazy(() => import('@/components/AnalyticsDashboard').then(m => ({ default: m.AnalyticsDashboard })));\n\ninterface LazyAnalyticsDashboardProps {\n  student: Student;\n  filteredData: {\n    entries: TrackingEntry[];\n    emotions: EmotionEntry[];\n    sensoryInputs: SensoryEntry[];\n  };\n  useAI?: boolean;\n}\n\nconst AnalyticsDashboardFallback: React.FC = () => {\n  const { tAnalytics, tCommon } = useTranslation();\n  return (\n    <div className=\"space-y-6\">\n      {/* Header skeleton */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Brain className=\"h-5 w-5\" />\n            {String(tAnalytics('dashboard.titleLoading'))}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex items-center justify-between\">\n            <Skeleton className=\"h-8 w-48\" />\n            <div className=\"flex gap-2\">\n              <Skeleton className=\"h-8 w-24\" />\n              <Skeleton className=\"h-8 w-24\" />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Content skeleton (single region to keep DOM minimal) */}\n      <Card>\n        <CardHeader>\n          <Skeleton className=\"h-6 w-48\" />\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            <Skeleton className=\"h-[300px] w-full\" />\n            <div className=\"grid grid-cols-3 gap-4\">\n              <Skeleton className=\"h-20 w-full\" />\n              <Skeleton className=\"h-20 w-full\" />\n              <Skeleton className=\"h-20 w-full\" />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};\n\nexport const LazyAnalyticsDashboard: React.FC<LazyAnalyticsDashboardProps> = (props) => {\n  return (\n    <Suspense fallback={<AnalyticsDashboardFallback />}>\n      <AnalyticsDashboard {...props} />\n    </Suspense>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/lazy/LazyChartsPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/lazy/LazyCorrelationsPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/lazy/LazyInteractiveDataVisualization.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Loading Interactive Visualization...\"","line":11,"column":55,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":13,"endColumn":7},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Failed to load Interactive Visualization\"","line":38,"column":44,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":40,"endColumn":7},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2 text-destructive\">\n        <AlertCircle className=\"h-5 w-5\" />\n        Failed to load Interactive Visualization\n      </CardTitle>","line":38,"column":44,"nodeType":"JSXText","endLine":40,"endColumn":7},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"The interactive data visualization component could not be loaded. \n        This might be due to missing dependencies or a temporary loading issue.\"","line":43,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":46,"endColumn":7},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground\">\n        The interactive data visualization component could not be loaded. \n        This might be due to missing dependencies or a temporary loading issue.\n      </p>","line":43,"column":52,"nodeType":"JSXText","endLine":46,"endColumn":7},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Please refresh the page or contact support if the issue persists.\"","line":47,"column":57,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":49,"endColumn":7},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground mt-2\">\n        Please refresh the page or contact support if the issue persists.\n      </p>","line":47,"column":57,"nodeType":"JSXText","endLine":49,"endColumn":7},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":81,"column":21,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":99,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createLazyComponent } from './LazyLoadWrapper';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Activity, AlertCircle } from 'lucide-react';\nimport { logger } from '@/lib/logger';\n\nconst LoadingFallback = () => (\n  <Card>\n    <CardHeader>\n      <CardTitle className=\"flex items-center gap-2\">\n        <Activity className=\"h-5 w-5 animate-pulse\" />\n        Loading Interactive Visualization...\n      </CardTitle>\n    </CardHeader>\n    <CardContent className=\"space-y-4\">\n      <div className=\"flex gap-4 mb-6\">\n        <Skeleton className=\"h-10 w-32\" />\n        <Skeleton className=\"h-10 w-32\" />\n        <Skeleton className=\"h-6 w-48\" />\n      </div>\n      <div className=\"space-y-6\">\n        <Skeleton className=\"h-8 w-64\" />\n        <Skeleton className=\"h-96 w-full\" />\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          <Skeleton className=\"h-24 w-full\" />\n          <Skeleton className=\"h-24 w-full\" />\n          <Skeleton className=\"h-24 w-full\" />\n        </div>\n      </div>\n    </CardContent>\n  </Card>\n);\n\nconst ErrorFallback = () => (\n  <Card className=\"border-destructive/20\">\n    <CardHeader>\n      <CardTitle className=\"flex items-center gap-2 text-destructive\">\n        <AlertCircle className=\"h-5 w-5\" />\n        Failed to load Interactive Visualization\n      </CardTitle>\n    </CardHeader>\n    <CardContent>\n      <p className=\"text-sm text-muted-foreground\">\n        The interactive data visualization component could not be loaded. \n        This might be due to missing dependencies or a temporary loading issue.\n      </p>\n      <p className=\"text-sm text-muted-foreground mt-2\">\n        Please refresh the page or contact support if the issue persists.\n      </p>\n    </CardContent>\n  </Card>\n);\n\nexport const LazyInteractiveDataVisualization = createLazyComponent(\n  () => {\n    logger.debug('[LazyInteractiveDataVisualization] Starting to load component');\n\n    // Helper: load the primary component with a timeout, then fall back.\n    const loadPrimary = async () => {\n      const mod = await import('@/components/InteractiveDataVisualization');\n      if (!mod.InteractiveDataVisualization) {\n        throw new Error('InteractiveDataVisualization export not found');\n      }\n      return { default: mod.InteractiveDataVisualization };\n    };\n\n    const loadMinimal = async () => {\n      const mod = await import('@/components/InteractiveDataVisualization.minimal');\n      return { default: mod.InteractiveDataVisualization };\n    };\n\n    const loadDebug = async () => {\n      const mod = await import('@/components/InteractiveDataVisualization.debug');\n      return { default: mod.InteractiveDataVisualization };\n    };\n\n    // Race primary import against a timeout to avoid indefinite Suspense\n    return new Promise<{ default: React.ComponentType<unknown> }>((resolve, reject) => {\n      let settled = false;\n      const timeoutMs = 4000; // 4s safety timeout\n      const timer = setTimeout(async () => {\n        if (settled) return;\n        logger.warn('[LazyInteractiveDataVisualization] Primary import timed out, attempting minimal fallback');\n        try {\n          const res = await loadMinimal();\n          settled = true;\n          resolve(res);\n        } catch (e1) {\n          logger.error('[LazyInteractiveDataVisualization] Minimal fallback failed, attempting debug', e1);\n          try {\n            const res = await loadDebug();\n            settled = true;\n            resolve(res);\n          } catch (e2) {\n            settled = true;\n            reject(e2);\n          }\n        }\n      }, timeoutMs);\n\n      loadPrimary()\n        .then(res => {\n          if (settled) return;\n          settled = true;\n          clearTimeout(timer);\n          logger.debug('[LazyInteractiveDataVisualization] Component loaded successfully');\n          resolve(res);\n        })\n        .catch(async (error) => {\n          if (settled) return;\n          logger.warn('[LazyInteractiveDataVisualization] Primary import failed, trying minimal', error);\n          try {\n            const res = await loadMinimal();\n            settled = true;\n            clearTimeout(timer);\n            resolve(res);\n          } catch (e1) {\n            logger.error('[LazyInteractiveDataVisualization] Minimal version failed', e1);\n            try {\n              const res = await loadDebug();\n              settled = true;\n              clearTimeout(timer);\n              resolve(res);\n            } catch (e2) {\n              settled = true;\n              clearTimeout(timer);\n              logger.error('[LazyInteractiveDataVisualization] All versions failed', e2);\n              reject(error);\n            }\n          }\n        });\n    });\n  },\n  <LoadingFallback />,\n  <ErrorFallback />\n);\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/lazy/LazyLoadWrapper.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Loading component...\"","line":21,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":21,"endColumn":76},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Failed to load component\"","line":37,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":37,"endColumn":77},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-destructive font-medium\">Failed to load component</p>","line":37,"column":53,"nodeType":"JSXText","endLine":37,"endColumn":77},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Please refresh the page or try again later.\"","line":38,"column":59,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":40,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground mt-2\">\n          Please refresh the page or try again later.\n        </p>","line":38,"column":59,"nodeType":"JSXText","endLine":40,"endColumn":9},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ErrorBoundary' is defined but never used. Allowed unused vars must match /^_/u.","line":70,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":70,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used. Allowed unused args must match /^_/u.","line":76,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":76,"endColumn":40},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":94,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":94,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { Suspense, lazy } from 'react';\nimport type { ComponentType } from 'react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Loader2 } from 'lucide-react';\nimport { ErrorWrapper } from '@/components/ErrorWrapper';\nimport { logger } from '@/lib/logger';\n\ninterface LazyLoadWrapperProps {\n  fallback?: React.ReactNode;\n  errorFallback?: React.ReactNode;\n  children: React.ReactNode;\n}\n\nconst DefaultFallback = () => (\n  <Card>\n    <CardContent className=\"p-6\">\n      <div className=\"flex items-center justify-center space-y-4\">\n        <div className=\"text-center\">\n          <Loader2 className=\"h-8 w-8 animate-spin mx-auto mb-4 text-primary\" />\n          <p className=\"text-sm text-muted-foreground\">Loading component...</p>\n        </div>\n      </div>\n      <div className=\"space-y-3 mt-6\">\n        <Skeleton className=\"h-4 w-full\" />\n        <Skeleton className=\"h-4 w-3/4\" />\n        <Skeleton className=\"h-32 w-full\" />\n      </div>\n    </CardContent>\n  </Card>\n);\n\nconst DefaultErrorFallback = () => (\n  <Card className=\"border-destructive/20\">\n    <CardContent className=\"p-6\">\n      <div className=\"text-center\">\n        <p className=\"text-destructive font-medium\">Failed to load component</p>\n        <p className=\"text-sm text-muted-foreground mt-2\">\n          Please refresh the page or try again later.\n        </p>\n      </div>\n    </CardContent>\n  </Card>\n);\n\nexport const LazyLoadWrapper: React.FC<LazyLoadWrapperProps> = ({\n  fallback = <DefaultFallback />,\n  errorFallback = <DefaultErrorFallback />,\n  children\n}) => {\n  return (\n    <ErrorWrapper fallback={errorFallback}>\n      <Suspense fallback={fallback}>\n        {children}\n      </Suspense>\n    </ErrorWrapper>\n  );\n};\n\n// Error Boundary Component\ninterface ErrorBoundaryProps {\n  fallback: React.ReactNode;\n  children: React.ReactNode;\n}\n\ninterface ErrorBoundaryState {\n  hasError: boolean;\n}\n\nclass ErrorBoundary extends React.Component<ErrorBoundaryProps, ErrorBoundaryState> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  static getDerivedStateFromError(error: Error): ErrorBoundaryState {\n    return { hasError: true };\n  }\n\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\n    logger.error('LazyLoadWrapper Error:', error, errorInfo);\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return this.props.fallback;\n    }\n\n    return this.props.children;\n  }\n}\n\n// Utility function to create lazy-loaded components with proper error handling\nexport function createLazyComponent<T extends ComponentType<unknown>>(\n  importFunc: () => Promise<{ default: T }>,\n  fallback?: React.ReactNode,\n  errorFallback?: React.ReactNode\n): (props: React.ComponentProps<T>) => JSX.Element {\n  const LazyComponent = lazy(importFunc);\n\n  return function WrappedLazyComponent(props: React.ComponentProps<T>): JSX.Element {\n    return (\n      <LazyLoadWrapper fallback={fallback} errorFallback={errorFallback}>\n        <LazyComponent {...props} />\n      </LazyLoadWrapper>\n    );\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/lazy/LazyPatternsPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/lazy/LazyReportBuilder.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Loading Report Builder...\"","line":10,"column":55,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":12,"endColumn":7}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createLazyComponent } from './LazyLoadWrapper';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { FileText } from 'lucide-react';\n\nconst LoadingFallback = () => (\n  <Card>\n    <CardHeader>\n      <CardTitle className=\"flex items-center gap-2\">\n        <FileText className=\"h-5 w-5 animate-pulse\" />\n        Loading Report Builder...\n      </CardTitle>\n    </CardHeader>\n    <CardContent className=\"space-y-4\">\n      <div className=\"flex gap-3 mb-6\">\n        <Skeleton className=\"h-10 w-32\" />\n        <Skeleton className=\"h-10 w-32\" />\n        <Skeleton className=\"h-10 w-32\" />\n        <Skeleton className=\"h-10 w-32\" />\n      </div>\n      <Skeleton className=\"h-10 w-full\" />\n      <div className=\"space-y-3\">\n        <Skeleton className=\"h-4 w-full\" />\n        <Skeleton className=\"h-4 w-3/4\" />\n        <Skeleton className=\"h-32 w-full\" />\n      </div>\n    </CardContent>\n  </Card>\n);\n\nexport const LazyReportBuilder = createLazyComponent(\n  () => import('@/components/ReportBuilder').then(module => ({\n    default: module.ReportBuilder\n  })),\n  <LoadingFallback />\n);","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/lazy/LazyVisualization3D.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"3D Correlation Visualization\"","line":26,"column":36,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":28,"endColumn":7},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n        <Eye className=\"h-5 w-5\" />\n        3D Correlation Visualization\n      </CardTitle>","line":26,"column":36,"nodeType":"JSXText","endLine":28,"endColumn":7},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Loading 3D visualization...\"","line":52,"column":58,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":52,"endColumn":85}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { Suspense, lazy } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Eye } from 'lucide-react';\nimport { EmotionEntry, SensoryEntry, TrackingEntry } from '@/types/student';\n\n// Lazy load the heavy 3D component\nconst Visualization3D = lazy(() => import('@/components/Visualization3D').then(m => ({ default: m.Visualization3D })));\n\ninterface LazyVisualization3DProps {\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  trackingEntries: TrackingEntry[];\n  correlationData?: {\n    x: string;\n    y: string;\n    z: string;\n    correlation: number;\n  }[];\n}\n\nconst Visualization3DFallback: React.FC = () => (\n  <Card className=\"w-full\">\n    <CardHeader>\n      <CardTitle className=\"flex items-center gap-2\">\n        <Eye className=\"h-5 w-5\" />\n        3D Correlation Visualization\n      </CardTitle>\n    </CardHeader>\n    <CardContent>\n      <div className=\"space-y-4\">\n        {/* Controls skeleton */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          <div className=\"space-y-2\">\n            <Skeleton className=\"h-4 w-16\" />\n            <Skeleton className=\"h-10 w-full\" />\n          </div>\n          <div className=\"space-y-2\">\n            <Skeleton className=\"h-4 w-16\" />\n            <Skeleton className=\"h-10 w-full\" />\n          </div>\n          <div className=\"space-y-2\">\n            <Skeleton className=\"h-4 w-16\" />\n            <Skeleton className=\"h-10 w-full\" />\n          </div>\n        </div>\n        \n        {/* 3D visualization skeleton */}\n        <div className=\"relative w-full h-[600px] bg-muted/50 rounded-lg overflow-hidden flex items-center justify-center\" role=\"status\" aria-live=\"polite\">\n          <div className=\"text-center space-y-2\">\n            <div className=\"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full mx-auto\"></div>\n            <p className=\"text-sm text-muted-foreground\">Loading 3D visualization...</p>\n          </div>\n        </div>\n      </div>\n    </CardContent>\n  </Card>\n);\n\nexport const LazyVisualization3D: React.FC<LazyVisualization3DProps> = (props) => {\n  return (\n    <Suspense fallback={<Visualization3DFallback />}>\n      <Visualization3D {...props} />\n    </Suspense>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/optimized/OptimizedAnalyticsDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BrainCircuit' is defined but never used. Allowed unused vars must match /^_/u.","line":18,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Target' is defined but never used. Allowed unused vars must match /^_/u.","line":18,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used. Allowed unused vars must match /^_/u.","line":18,"column":43,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":53},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tStudent' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":74,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":74,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tCommon' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":74,"column":33,"nodeType":null,"messageId":"unusedVar","endLine":74,"endColumn":40},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'showSettings' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":76,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":76,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":116,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4288,4291],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4288,4291],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":116,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4310,4313],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4310,4313],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":322,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":322,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10879,10882],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10879,10882],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No patterns detected yet.\"","line":325,"column":44,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":325,"endColumn":69},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">No patterns detected yet.</p>","line":325,"column":44,"nodeType":"JSXText","endLine":325,"endColumn":69},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":328,"column":19,"nodeType":"TemplateLiteral","messageId":"noArrayIndex","endLine":328,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":336,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":336,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11312,11315],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11312,11315],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No correlations found.\"","line":339,"column":44,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":339,"endColumn":66},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">No correlations found.</p>","line":339,"column":44,"nodeType":"JSXText","endLine":339,"endColumn":66},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":342,"column":19,"nodeType":"TemplateLiteral","messageId":"noArrayIndex","endLine":342,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":350,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":350,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11750,11753],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11750,11753],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No insights available.\"","line":353,"column":44,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":353,"endColumn":66},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">No insights available.</p>","line":353,"column":44,"nodeType":"JSXText","endLine":353,"endColumn":66},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":356,"column":19,"nodeType":"TemplateLiteral","messageId":"noArrayIndex","endLine":356,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":364,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":364,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12171,12174],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12171,12174],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No predictions available.\"","line":367,"column":44,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":367,"endColumn":69},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">No predictions available.</p>","line":367,"column":44,"nodeType":"JSXText","endLine":367,"endColumn":69},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":370,"column":19,"nodeType":"TemplateLiteral","messageId":"noArrayIndex","endLine":370,"endColumn":40}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":24,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * @fileoverview OptimizedAnalyticsDashboard - Performance-optimized analytics dashboard\n * \n * This component demonstrates best practices for React performance optimization:\n * - Component memoization with React.memo\n * - Expensive calculations memoized with useMemo\n * - Event handlers optimized with useCallback\n * - Data normalization moved to memoized computation\n * \n * @module components/optimized/OptimizedAnalyticsDashboard\n */\n\nimport { memo, useMemo, useCallback, useState, useEffect, useRef } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Badge } from '@/components/ui/badge';\nimport { BarChart3, BrainCircuit, Target, TrendingUp, Settings, Download, Database } from 'lucide-react';\nimport { toast } from 'sonner';\nimport { logger } from '@/lib/logger';\nimport { analyticsManager } from '@/lib/analyticsManager';\nimport { useAnalyticsWorker } from '@/hooks/useAnalyticsWorker';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { Student, TrackingEntry, EmotionEntry, SensoryEntry } from '@/types/student';\nimport { ExportFormat } from '@/types/analytics';\nimport { TABS } from '../analyticsTabs';\n\ninterface OptimizedAnalyticsDashboardProps {\n  student: Student;\n  filteredData: {\n    entries: TrackingEntry[];\n    emotions: EmotionEntry[];\n    sensoryInputs: SensoryEntry[];\n  };\n}\n\n/**\n * Memoized data normalization function\n * Converts timestamps to Date instances safely\n */\nconst normalizeData = (data: OptimizedAnalyticsDashboardProps['filteredData']) => {\n  const coerceDate = (value: unknown): Date => {\n    try {\n      if (value instanceof Date && !isNaN(value.getTime())) return value;\n      if (typeof value === 'string' || typeof value === 'number') {\n        const dt = new Date(value);\n        return isNaN(dt.getTime()) ? new Date() : dt;\n      }\n      return new Date();\n    } catch {\n      return new Date();\n    }\n  };\n\n  return {\n    entries: (data.entries || []).map(e => ({ ...e, timestamp: coerceDate(e.timestamp) })),\n    emotions: (data.emotions || []).map(e => ({ ...e, timestamp: coerceDate(e.timestamp) })),\n    sensoryInputs: (data.sensoryInputs || []).map(s => ({ ...s, timestamp: coerceDate(s.timestamp) })),\n  };\n};\n\n/**\n * OptimizedAnalyticsDashboard Component\n * \n * Performance-optimized version with:\n * - Memoized data transformations\n * - Optimized event handlers\n * - Reduced re-renders through proper dependency management\n */\nexport const OptimizedAnalyticsDashboard = memo(({\n  student,\n  filteredData = { entries: [], emotions: [], sensoryInputs: [] },\n}: OptimizedAnalyticsDashboardProps) => {\n  const { tStudent, tAnalytics, tCommon } = useTranslation();\n  const [isExporting, setIsExporting] = useState(false);\n  const [showSettings, setShowSettings] = useState(false);\n  const [isSeeding, setIsSeeding] = useState(false);\n  const visualizationRef = useRef<HTMLDivElement>(null);\n  \n  const { \n    results, \n    isAnalyzing, \n    runAnalysis, \n    invalidateCacheForStudent \n  } = useAnalyticsWorker({ precomputeOnIdle: true });\n\n  // Memoize normalized data to prevent recalculation on every render\n  const normalizedData = useMemo(\n    () => normalizeData(filteredData),\n    [filteredData]\n  );\n\n  // Memoize derived data from results\n  const patterns = useMemo(() => results?.patterns || [], [results]);\n  const correlations = useMemo(() => results?.correlations || [], [results]);\n  const insights = useMemo(() => results?.insights || [], [results]);\n  const predictiveInsights = useMemo(() => results?.predictiveInsights || [], [results]);\n  const anomalies = useMemo(() => results?.anomalies || [], [results]);\n\n  // Calculate date range with memoization\n  const dateRange = useMemo(() => {\n    if (!normalizedData.entries.length) {\n      return { start: new Date(), end: new Date() };\n    }\n\n    const timestamps = normalizedData.entries.map(e => e.timestamp.getTime());\n    return {\n      start: new Date(Math.min(...timestamps)),\n      end: new Date(Math.max(...timestamps))\n    };\n  }, [normalizedData.entries]);\n\n  // Memoized dev mode check\n  const isDevSeedEnabled = useMemo(() => {\n    try {\n      const env: any = (import.meta as any)?.env ?? {};\n      return Boolean(env?.DEV || env?.MODE === 'development');\n    } catch {\n      return false;\n    }\n  }, []);\n\n  // Optimized seed handler with useCallback\n  const handleSeedDemo = useCallback(async () => {\n    setIsSeeding(true);\n    try {\n      const mod = await import('@/lib/mock/mockSeeders');\n      const { seedDemoData } = mod;\n      const result = await seedDemoData({ \n        forExistingStudents: true, \n        createNewStudents: 1, \n        batchesPerStudent: 1 \n      });\n      \n      toast.success(\n        String(tAnalytics('dev.seed.success', { \n          students: result.totalStudentsAffected, \n          entries: result.totalEntriesCreated \n        }))\n      );\n      \n      invalidateCacheForStudent(student.id);\n      runAnalysis(normalizedData);\n    } catch (error) {\n      logger.error('[OptimizedAnalyticsDashboard] Demo seed failed', { error });\n      toast.error(String(tAnalytics('dev.seed.failure')));\n    } finally {\n      setIsSeeding(false);\n    }\n  }, [normalizedData, invalidateCacheForStudent, runAnalysis, student.id, tAnalytics]);\n\n  // Optimized export handler\n  const handleExport = useCallback(async (format: ExportFormat) => {\n    setIsExporting(true);\n    try {\n      const exportData = {\n        student,\n        dateRange,\n        data: normalizedData,\n        analytics: {\n          patterns,\n          correlations,\n          insights,\n          predictiveInsights,\n          anomalies\n        },\n        charts: format === 'pdf' && visualizationRef.current\n          ? [{\n              element: visualizationRef.current,\n              title: String(tAnalytics('export.chartTitle'))\n            }]\n          : undefined,\n      };\n\n      // Dynamic import for export functionality\n      const mod = await import('@/lib/analyticsExport');\n      await mod.analyticsExport.exportTo(format, exportData);\n      \n      toast.success(String(tAnalytics('export.success')));\n    } catch (error) {\n      logger.error('[OptimizedAnalyticsDashboard] Export failed', { error });\n      toast.error(String(tAnalytics('export.failure')));\n    } finally {\n      setIsExporting(false);\n    }\n  }, [\n    student, \n    dateRange, \n    normalizedData, \n    patterns, \n    correlations, \n    insights, \n    predictiveInsights, \n    anomalies, \n    tAnalytics\n  ]);\n\n  // Effect to trigger analysis when data changes\n  useEffect(() => {\n    if (normalizedData?.entries?.length > 0) {\n      runAnalysis(normalizedData);\n    }\n    analyticsManager.initializeStudentAnalytics(student.id);\n  }, [student.id, normalizedData, runAnalysis]);\n\n  // Memoized tab change handler\n  const handleTabChange = useCallback((value: string) => {\n    // Track tab change for analytics\n    logger.info('[OptimizedAnalyticsDashboard] Tab changed', { tab: value });\n  }, []);\n\n  // Memoized settings toggle\n  const toggleSettings = useCallback(() => {\n    setShowSettings(prev => !prev);\n  }, []);\n\n  return (\n    <Card className=\"bg-gradient-card border-0 shadow-soft\">\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <BarChart3 className=\"h-6 w-6 text-primary\" />\n            <CardTitle className=\"text-2xl font-bold\">\n              {tAnalytics('title')}\n            </CardTitle>\n            {isAnalyzing && (\n              <Badge variant=\"secondary\" className=\"animate-pulse\">\n                {tAnalytics('analyzing')}\n              </Badge>\n            )}\n          </div>\n          \n          <div className=\"flex gap-2\">\n            {isDevSeedEnabled && (\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={handleSeedDemo}\n                disabled={isSeeding}\n              >\n                <Database className=\"h-4 w-4 mr-1\" />\n                {isSeeding ? tAnalytics('dev.seed.loading') : tAnalytics('dev.seed.button')}\n              </Button>\n            )}\n            \n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => handleExport('pdf')}\n              disabled={isExporting}\n            >\n              <Download className=\"h-4 w-4 mr-1\" />\n              {tAnalytics('export.button')}\n            </Button>\n            \n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={toggleSettings}\n              aria-label={tAnalytics('settings.toggle')}\n            >\n              <Settings className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </CardHeader>\n\n      <CardContent>\n        <Tabs \n          defaultValue=\"patterns\" \n          className=\"w-full\"\n          onValueChange={handleTabChange}\n        >\n          <TabsList className=\"grid w-full grid-cols-4 mb-6\">\n            {Object.entries(TABS).map(([key, config]) => (\n              <TabsTrigger \n                key={key} \n                value={key}\n                data-testid={config.testId}\n              >\n                <config.icon className=\"h-4 w-4 mr-2\" />\n                {tAnalytics(`tabs.${key}`)}\n              </TabsTrigger>\n            ))}\n          </TabsList>\n\n          {/* Tab contents would be implemented here */}\n          {/* Each tab content should be a separate memoized component */}\n          \n          <TabsContent value=\"patterns\" className=\"space-y-4\">\n            <PatternsTabContent patterns={patterns} />\n          </TabsContent>\n\n          <TabsContent value=\"correlations\" className=\"space-y-4\">\n            <CorrelationsTabContent correlations={correlations} />\n          </TabsContent>\n\n          <TabsContent value=\"insights\" className=\"space-y-4\">\n            <InsightsTabContent insights={insights} />\n          </TabsContent>\n\n          <TabsContent value=\"predictions\" className=\"space-y-4\">\n            <PredictionsTabContent predictions={predictiveInsights} />\n          </TabsContent>\n        </Tabs>\n      </CardContent>\n    </Card>\n  );\n}, (prevProps, nextProps) => {\n  // Custom comparison function for deeper equality check\n  return (\n    prevProps.student.id === nextProps.student.id &&\n    prevProps.filteredData.entries.length === nextProps.filteredData.entries.length &&\n    prevProps.filteredData.emotions.length === nextProps.filteredData.emotions.length &&\n    prevProps.filteredData.sensoryInputs.length === nextProps.filteredData.sensoryInputs.length\n  );\n});\n\nOptimizedAnalyticsDashboard.displayName = 'OptimizedAnalyticsDashboard';\n\n// Memoized sub-components for tab content\nconst PatternsTabContent = memo(({ patterns }: { patterns: any[] }) => (\n  <div className=\"space-y-4\">\n    {patterns.length === 0 ? (\n      <p className=\"text-muted-foreground\">No patterns detected yet.</p>\n    ) : (\n      patterns.map((pattern, index) => (\n        <div key={`pattern-${index}`} className=\"p-4 bg-muted/30 rounded-lg\">\n          {/* Pattern visualization */}\n        </div>\n      ))\n    )}\n  </div>\n));\n\nconst CorrelationsTabContent = memo(({ correlations }: { correlations: any[] }) => (\n  <div className=\"space-y-4\">\n    {correlations.length === 0 ? (\n      <p className=\"text-muted-foreground\">No correlations found.</p>\n    ) : (\n      correlations.map((correlation, index) => (\n        <div key={`correlation-${index}`} className=\"p-4 bg-muted/30 rounded-lg\">\n          {/* Correlation visualization */}\n        </div>\n      ))\n    )}\n  </div>\n));\n\nconst InsightsTabContent = memo(({ insights }: { insights: any[] }) => (\n  <div className=\"space-y-4\">\n    {insights.length === 0 ? (\n      <p className=\"text-muted-foreground\">No insights available.</p>\n    ) : (\n      insights.map((insight, index) => (\n        <div key={`insight-${index}`} className=\"p-4 bg-muted/30 rounded-lg\">\n          {/* Insight display */}\n        </div>\n      ))\n    )}\n  </div>\n));\n\nconst PredictionsTabContent = memo(({ predictions }: { predictions: any[] }) => (\n  <div className=\"space-y-4\">\n    {predictions.length === 0 ? (\n      <p className=\"text-muted-foreground\">No predictions available.</p>\n    ) : (\n      predictions.map((prediction, index) => (\n        <div key={`prediction-${index}`} className=\"p-4 bg-muted/30 rounded-lg\">\n          {/* Prediction display */}\n        </div>\n      ))\n    )}\n  </div>\n));\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/optimized/OptimizedAnimatedCounter.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/optimized/OptimizedCorrelationHeatmap.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No correlation data available\"","line":110,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":110,"endColumn":75},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">No correlation data available</p>","line":110,"column":46,"nodeType":"JSXText","endLine":110,"endColumn":75}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * @fileoverview OptimizedCorrelationHeatmap - Performance-optimized correlation visualization\n * \n * Key optimizations:\n * - Component wrapped with React.memo\n * - Expensive data transformations memoized with useMemo\n * - O(n²) complexity optimized with Map-based lookups\n * - Chart configuration memoized\n * \n * @module components/optimized/OptimizedCorrelationHeatmap\n */\n\nimport React, { memo, useMemo } from 'react';\nimport { ResponsiveHeatMap } from '@nivo/heatmap';\nimport { CorrelationResult } from '@/lib/patternAnalysis';\n\ninterface OptimizedCorrelationHeatmapProps {\n  data: CorrelationResult[];\n}\n\n/**\n * OptimizedCorrelationHeatmap Component\n * \n * Performance improvements:\n * - Memoized factor extraction\n * - Optimized correlation lookup using Map\n * - Memoized chart configuration\n * - Component memoization with custom comparison\n */\nexport const OptimizedCorrelationHeatmap = memo<OptimizedCorrelationHeatmapProps>(({ data }) => {\n  // Memoize factor extraction\n  const factors = useMemo(() => {\n    const factorSet = new Set<string>();\n    data.forEach(d => {\n      factorSet.add(d.factor1);\n      factorSet.add(d.factor2);\n    });\n    return Array.from(factorSet);\n  }, [data]);\n\n  // Create optimized correlation lookup map to avoid O(n²) searching\n  const correlationMap = useMemo(() => {\n    const map = new Map<string, number>();\n    \n    // Build lookup map with both directions\n    data.forEach(d => {\n      const key1 = `${d.factor1}:${d.factor2}`;\n      const key2 = `${d.factor2}:${d.factor1}`;\n      map.set(key1, d.correlation);\n      map.set(key2, d.correlation);\n    });\n    \n    return map;\n  }, [data]);\n\n  // Memoize chart data transformation\n  const chartData = useMemo(() => {\n    return factors.map(factor1 => ({\n      id: factor1,\n      data: factors.map(factor2 => {\n        // Use Map lookup instead of array.find for O(1) access\n        const key = `${factor1}:${factor2}`;\n        const correlation = correlationMap.get(key) ?? 0;\n        \n        return {\n          x: factor2,\n          y: correlation,\n        };\n      }),\n    }));\n  }, [factors, correlationMap]);\n\n  // Memoize chart configuration\n  const chartConfig = useMemo(() => ({\n    margin: { top: 100, right: 60, bottom: 60, left: 60 },\n    axisTop: {\n      tickSize: 5,\n      tickPadding: 5,\n      tickRotation: -90,\n      legend: '',\n      legendOffset: -70,\n    },\n    axisLeft: {\n      tickSize: 5,\n      tickPadding: 5,\n      tickRotation: 0,\n      legend: '',\n      legendOffset: -40,\n    },\n    cellBorderColor: { from: 'color', modifiers: [['darker', 0.4]] },\n    labelTextColor: { from: 'color', modifiers: [['brighter', 1.8]] },\n    defs: [\n      {\n        id: 'lines',\n        type: 'patternLines',\n        background: 'inherit',\n        color: 'rgba(0, 0, 0, 0.1)',\n        rotation: -45,\n        lineWidth: 4,\n        spacing: 7,\n      },\n    ],\n    fill: [{ id: 'lines' }],\n  }), []);\n\n  // Early return if no data\n  if (!data || data.length === 0) {\n    return (\n      <div className=\"h-[400px] flex items-center justify-center\">\n        <p className=\"text-muted-foreground\">No correlation data available</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-[400px]\">\n      <ResponsiveHeatMap\n        data={chartData}\n        keys={factors}\n        indexBy=\"id\"\n        margin={chartConfig.margin}\n        axisTop={chartConfig.axisTop}\n        axisLeft={chartConfig.axisLeft}\n        colors=\"bwr\"\n        cellOpacity={1}\n        cellBorderWidth={1}\n        cellBorderColor={chartConfig.cellBorderColor}\n        labelTextColor={chartConfig.labelTextColor}\n        defs={chartConfig.defs}\n        fill={chartConfig.fill}\n        animate={true}\n        motionStiffness={80}\n        motionDamping={9}\n        hoverTarget=\"cell\"\n        cellHoverOthersOpacity={0.25}\n      />\n    </div>\n  );\n}, (prevProps, nextProps) => {\n  // Custom comparison for deep equality check\n  // Only re-render if data actually changes\n  if (prevProps.data.length !== nextProps.data.length) {\n    return false;\n  }\n  \n  // Check if correlation values have changed\n  for (let i = 0; i < prevProps.data.length; i++) {\n    const prev = prevProps.data[i];\n    const next = nextProps.data[i];\n    if (\n      prev.factor1 !== next.factor1 ||\n      prev.factor2 !== next.factor2 ||\n      prev.correlation !== next.correlation\n    ) {\n      return false;\n    }\n  }\n  \n  return true; // Props are equal, skip re-render\n});\n\nOptimizedCorrelationHeatmap.displayName = 'OptimizedCorrelationHeatmap';\n\nexport default OptimizedCorrelationHeatmap;\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/optimized/OptimizedDataRequirementsCalculator.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used. Allowed unused vars must match /^_/u.","line":18,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used. Allowed unused vars must match /^_/u.","line":18,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":38},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useMemo has missing dependencies: 'emotions', 'entries', and 'sensoryInputs'. Either include them or remove the dependency array.","line":155,"column":6,"nodeType":"ArrayExpression","endLine":155,"endColumn":61,"suggestions":[{"desc":"Update the dependencies array to be: [emotions, sensoryInputs, entries]","fix":{"range":[4462,4517],"text":"[emotions, sensoryInputs, entries]"}}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Datakrav for sikkerhetsnivå\"","line":234,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":236,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n            <Target className=\"h-5 w-5\" />\n            Datakrav for sikkerhetsnivå\n          </CardTitle>","line":234,"column":43,"nodeType":"JSXText","endLine":236,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Ingen data registrert ennå. Start med å samle data for å se fremgang mot sikkerhetsnivåer.\"","line":240,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":242,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground mb-4\">\n            Ingen data registrert ennå. Start med å samle data for å se fremgang mot sikkerhetsnivåer.\n          </p>","line":240,"column":53,"nodeType":"JSXText","endLine":242,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Start datainnsamling\"","line":243,"column":37,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":245,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button variant=\"outline\">\n            Start datainnsamling\n          </Button>","line":243,"column":37,"nodeType":"JSXText","endLine":245,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Datakrav for sikkerhetsnivå\"","line":255,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":257,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n          <Target className=\"h-5 w-5\" />\n          Datakrav for sikkerhetsnivå\n        </CardTitle>","line":255,"column":41,"nodeType":"JSXText","endLine":257,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"datapunkter samlet\"","line":259,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":259,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>{currentStatus.dataPoints} datapunkter samlet</span>","line":259,"column":43,"nodeType":"JSXText","endLine":259,"endColumn":62},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"dager med data\"","line":260,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":260,"endColumn":56},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>{currentStatus.daysSpan} dager med data</span>","line":260,"column":41,"nodeType":"JSXText","endLine":260,"endColumn":56},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Nåværende sikkerhetsnivå\"","line":267,"column":40,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":267,"endColumn":64},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"font-medium\">Nåværende sikkerhetsnivå</p>","line":267,"column":40,"nodeType":"JSXText","endLine":267,"endColumn":64},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":272,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":272,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8728,8731],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8728,8731],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"sikkerhet\"","line":273,"column":24,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":274,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant={badgeVariant as any}>\n            {badgeText} sikkerhet\n          </Badge>","line":273,"column":24,"nodeType":"JSXText","endLine":274,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Fremgang mot\"","line":281,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":281,"endColumn":56},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-medium\">Fremgang mot {nextTarget.requirement.description}</h4>","line":281,"column":43,"nodeType":"JSXText","endLine":281,"endColumn":56},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"% fullført\"","line":283,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":284,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-sm text-muted-foreground\">\n                {Math.round(nextTarget.progress)}% fullført\n              </span>","line":283,"column":50,"nodeType":"JSXText","endLine":284,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Anbefalt: Samle\"","line":306,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":307,"endColumn":35},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm font-medium\">\n                  Anbefalt: Samle {recommendedRate} datapunkt{recommendedRate > 1 ? 'er' : ''} per dag\n                </p>","line":306,"column":52,"nodeType":"JSXText","endLine":307,"endColumn":35},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"datapunkt\"","line":307,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":307,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm font-medium\">\n                  Anbefalt: Samle {recommendedRate} datapunkt{recommendedRate > 1 ? 'er' : ''} per dag\n                </p>","line":307,"column":52,"nodeType":"JSXText","endLine":307,"endColumn":62},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"per dag\"","line":307,"column":95,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":308,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm font-medium\">\n                  Anbefalt: Samle {recommendedRate} datapunkt{recommendedRate > 1 ? 'er' : ''} per dag\n                </p>","line":307,"column":95,"nodeType":"JSXText","endLine":308,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Måloppnåelse:\"","line":309,"column":67,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":310,"endColumn":33},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground mt-1\">\n                  Måloppnåelse: {formatDate(nextTarget.targetDate)}\n                </p>","line":309,"column":67,"nodeType":"JSXText","endLine":310,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":32,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * @fileoverview OptimizedDataRequirementsCalculator - Performance-optimized data requirements tracking\n * \n * Key optimizations:\n * - Component wrapped with React.memo\n * - All expensive calculations memoized\n * - Optimized timestamp processing\n * - Reduced nested map operations\n * \n * @module components/optimized/OptimizedDataRequirementsCalculator\n */\n\nimport { useMemo, memo } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { Button } from '@/components/ui/button';\nimport { Calendar, Target, TrendingUp, AlertCircle, CheckCircle } from 'lucide-react';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { EmotionEntry, SensoryEntry, TrackingEntry } from '@/types/student';\nimport { differenceInDays, addDays } from 'date-fns';\n\ninterface OptimizedDataRequirementsCalculatorProps {\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  entries: TrackingEntry[];\n  className?: string;\n}\n\ninterface ConfidenceRequirement {\n  level: 'low' | 'medium' | 'high';\n  percentage: number;\n  minDataPoints: number;\n  minDays: number;\n  minRSquared: number;\n  color: string;\n  description: string;\n}\n\ninterface DataStatus {\n  dataPoints: number;\n  daysSpan: number;\n  entriesCount: number;\n  startDate: Date;\n  hasData: boolean;\n}\n\ninterface ProgressCalculation {\n  requirement: ConfidenceRequirement;\n  progress: number;\n  dataPoints: {\n    current: number;\n    needed: number;\n    progress: number;\n  };\n  days: {\n    current: number;\n    needed: number;\n    progress: number;\n  };\n  daysToTarget: number;\n  targetDate: Date;\n  isAchieved: boolean;\n}\n\n/**\n * OptimizedDataRequirementsCalculator Component\n * \n * Performance improvements:\n * - Memoized requirements configuration\n * - Optimized timestamp processing with single pass\n * - Memoized progress calculations\n * - Component memoization with custom comparison\n */\nexport const OptimizedDataRequirementsCalculator = memo<OptimizedDataRequirementsCalculatorProps>(({ \n  emotions, \n  sensoryInputs, \n  entries, \n  className \n}) => {\n  const { tAnalytics, formatDate } = useTranslation();\n\n  // Define confidence level requirements - memoized based on translations\n  const requirements: ConfidenceRequirement[] = useMemo(() => [\n    {\n      level: 'low',\n      percentage: 25,\n      minDataPoints: 5,\n      minDays: 7,\n      minRSquared: 0.3,\n      color: 'bg-orange-500',\n      description: String(tAnalytics('confidence.low'))\n    },\n    {\n      level: 'medium',\n      percentage: 50,\n      minDataPoints: 15,\n      minDays: 21,\n      minRSquared: 0.5,\n      color: 'bg-yellow-500',\n      description: String(tAnalytics('confidence.medium'))\n    },\n    {\n      level: 'high',\n      percentage: 75,\n      minDataPoints: 30,\n      minDays: 42,\n      minRSquared: 0.7,\n      color: 'bg-green-500',\n      description: String(tAnalytics('confidence.high'))\n    }\n  ], [tAnalytics]);\n\n  // Calculate current data status with optimized timestamp processing\n  const currentStatus: DataStatus = useMemo(() => {\n    const totalDataPoints = emotions.length + sensoryInputs.length;\n    \n    // Optimize timestamp processing - single pass with early exit\n    if (totalDataPoints === 0 && entries.length === 0) {\n      return {\n        dataPoints: 0,\n        daysSpan: 0,\n        entriesCount: 0,\n        startDate: new Date(),\n        hasData: false\n      };\n    }\n\n    // Process timestamps more efficiently\n    let minTimestamp = Infinity;\n    let maxTimestamp = -Infinity;\n    \n    // Process all timestamps in single pass\n    const processTimestamp = (timestamp: Date) => {\n      const time = timestamp.getTime();\n      if (time < minTimestamp) minTimestamp = time;\n      if (time > maxTimestamp) maxTimestamp = time;\n    };\n\n    emotions.forEach(e => processTimestamp(e.timestamp));\n    sensoryInputs.forEach(s => processTimestamp(s.timestamp));\n    entries.forEach(e => processTimestamp(e.timestamp));\n\n    const startDate = minTimestamp === Infinity ? new Date() : new Date(minTimestamp);\n    const endDate = maxTimestamp === -Infinity ? new Date() : new Date(maxTimestamp);\n    const daysSpan = minTimestamp === Infinity ? 0 : differenceInDays(endDate, startDate) + 1;\n\n    return {\n      dataPoints: totalDataPoints,\n      daysSpan,\n      entriesCount: entries.length,\n      startDate,\n      hasData: totalDataPoints > 0\n    };\n  }, [emotions.length, sensoryInputs.length, entries.length]);\n\n  // Calculate progress toward each confidence level\n  const progressCalculations: ProgressCalculation[] = useMemo(() => {\n    return requirements.map(req => {\n      const dataPointsProgress = Math.min(100, (currentStatus.dataPoints / req.minDataPoints) * 100);\n      const daysProgress = Math.min(100, (currentStatus.daysSpan / req.minDays) * 100);\n      const overallProgress = Math.min(dataPointsProgress, daysProgress);\n\n      const dataPointsNeeded = Math.max(0, req.minDataPoints - currentStatus.dataPoints);\n      const daysNeeded = Math.max(0, req.minDays - currentStatus.daysSpan);\n\n      // Estimate days to target (assuming 1 data point per day)\n      const daysToTarget = Math.max(dataPointsNeeded, daysNeeded);\n      const targetDate = addDays(new Date(), daysToTarget);\n\n      return {\n        requirement: req,\n        progress: overallProgress,\n        dataPoints: {\n          current: currentStatus.dataPoints,\n          needed: dataPointsNeeded,\n          progress: dataPointsProgress\n        },\n        days: {\n          current: currentStatus.daysSpan,\n          needed: daysNeeded,\n          progress: daysProgress\n        },\n        daysToTarget,\n        targetDate,\n        isAchieved: overallProgress >= 100\n      };\n    });\n  }, [requirements, currentStatus]);\n\n  // Get next target confidence level - memoized\n  const { nextTarget, currentLevel } = useMemo(() => {\n    const next = progressCalculations.find(p => !p.isAchieved);\n    const level = progressCalculations.filter(p => p.isAchieved).length;\n    return { nextTarget: next, currentLevel: level };\n  }, [progressCalculations]);\n\n  // Calculate recommended daily collection rate - memoized\n  const recommendedRate = useMemo(() => {\n    if (!nextTarget) return null;\n    const dailyRate = Math.ceil(nextTarget.dataPoints.needed / Math.max(nextTarget.daysToTarget, 1));\n    return Math.max(1, dailyRate);\n  }, [nextTarget]);\n\n  // Memoized level status text\n  const levelStatusText = useMemo(() => {\n    switch (currentLevel) {\n      case 0: return 'Under lavt nivå';\n      case 1: return 'Lavt nivå oppnådd';\n      case 2: return 'Middels nivå oppnådd';\n      default: return 'Høyt nivå oppnådd';\n    }\n  }, [currentLevel]);\n\n  // Memoized badge variant\n  const badgeVariant = useMemo(() => {\n    if (currentLevel >= 3) return 'default';\n    if (currentLevel >= 1) return 'secondary';\n    return 'outline';\n  }, [currentLevel]);\n\n  // Memoized badge text\n  const badgeText = useMemo(() => {\n    if (currentLevel >= 3) return 'Høy';\n    if (currentLevel >= 1) return 'Middels';\n    return 'Lav';\n  }, [currentLevel]);\n\n  if (!currentStatus.hasData) {\n    return (\n      <Card className={className}>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Target className=\"h-5 w-5\" />\n            Datakrav for sikkerhetsnivå\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"text-center py-8\">\n          <AlertCircle className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n          <p className=\"text-muted-foreground mb-4\">\n            Ingen data registrert ennå. Start med å samle data for å se fremgang mot sikkerhetsnivåer.\n          </p>\n          <Button variant=\"outline\">\n            Start datainnsamling\n          </Button>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className={className}>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Target className=\"h-5 w-5\" />\n          Datakrav for sikkerhetsnivå\n        </CardTitle>\n        <div className=\"flex items-center gap-4 text-sm text-muted-foreground\">\n          <span>{currentStatus.dataPoints} datapunkter samlet</span>\n          <span>{currentStatus.daysSpan} dager med data</span>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        {/* Current Status */}\n        <div className=\"flex items-center justify-between p-4 bg-muted/50 rounded-lg\">\n          <div>\n            <p className=\"font-medium\">Nåværende sikkerhetsnivå</p>\n            <p className=\"text-sm text-muted-foreground\">\n              {levelStatusText}\n            </p>\n          </div>\n          <Badge variant={badgeVariant as any}>\n            {badgeText} sikkerhet\n          </Badge>\n        </div>\n\n        {/* Progress toward next level */}\n        {nextTarget && (\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <h4 className=\"font-medium\">Fremgang mot {nextTarget.requirement.description}</h4>\n              <span className=\"text-sm text-muted-foreground\">\n                {Math.round(nextTarget.progress)}% fullført\n              </span>\n            </div>\n            \n            <Progress value={nextTarget.progress} className=\"h-2\" />\n            \n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <DataProgressItem\n                label=\"Datapunkter\"\n                current={nextTarget.dataPoints.current}\n                required={nextTarget.requirement.minDataPoints}\n                progress={nextTarget.dataPoints.progress}\n              />\n              <DataProgressItem\n                label=\"Dager\"\n                current={nextTarget.days.current}\n                required={nextTarget.requirement.minDays}\n                progress={nextTarget.days.progress}\n              />\n            </div>\n\n            {recommendedRate && recommendedRate > 0 && (\n              <div className=\"p-3 bg-primary/10 rounded-lg\">\n                <p className=\"text-sm font-medium\">\n                  Anbefalt: Samle {recommendedRate} datapunkt{recommendedRate > 1 ? 'er' : ''} per dag\n                </p>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  Måloppnåelse: {formatDate(nextTarget.targetDate)}\n                </p>\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* Achievement indicators */}\n        <div className=\"space-y-2\">\n          {progressCalculations.map((calc) => (\n            <AchievementIndicator\n              key={calc.requirement.level}\n              requirement={calc.requirement}\n              isAchieved={calc.isAchieved}\n              progress={calc.progress}\n            />\n          ))}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}, (prevProps, nextProps) => {\n  // Custom comparison for optimal re-rendering\n  return (\n    prevProps.emotions.length === nextProps.emotions.length &&\n    prevProps.sensoryInputs.length === nextProps.sensoryInputs.length &&\n    prevProps.entries.length === nextProps.entries.length &&\n    prevProps.className === nextProps.className\n  );\n});\n\nOptimizedDataRequirementsCalculator.displayName = 'OptimizedDataRequirementsCalculator';\n\n// Memoized sub-components\nconst DataProgressItem = memo<{\n  label: string;\n  current: number;\n  required: number;\n  progress: number;\n}>(({ label, current, required, progress }) => (\n  <div className=\"space-y-2\">\n    <div className=\"flex items-center justify-between text-sm\">\n      <span>{label}</span>\n      <span className=\"text-muted-foreground\">\n        {current} / {required}\n      </span>\n    </div>\n    <Progress value={progress} className=\"h-1\" />\n  </div>\n));\n\nDataProgressItem.displayName = 'DataProgressItem';\n\nconst AchievementIndicator = memo<{\n  requirement: ConfidenceRequirement;\n  isAchieved: boolean;\n  progress: number;\n}>(({ requirement, isAchieved, progress }) => (\n  <div className=\"flex items-center gap-3\">\n    <div className={`h-2 w-2 rounded-full ${isAchieved ? requirement.color : 'bg-muted'}`} />\n    <span className={`text-sm ${isAchieved ? '' : 'text-muted-foreground'}`}>\n      {requirement.description}\n    </span>\n    {isAchieved ? (\n      <CheckCircle className=\"h-4 w-4 text-green-500 ml-auto\" />\n    ) : (\n      <span className=\"text-xs text-muted-foreground ml-auto\">\n        {Math.round(progress)}%\n      </span>\n    )}\n  </div>\n));\n\nAchievementIndicator.displayName = 'AchievementIndicator';\n\nexport default OptimizedDataRequirementsCalculator;\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/optimized/OptimizedDataVisualization.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No data to display yet\"","line":53,"column":36,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":53,"endColumn":58},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-lg\">No data to display yet</p>","line":53,"column":36,"nodeType":"JSXText","endLine":53,"endColumn":58},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Start tracking emotions and sensory inputs to see visualizations\"","line":54,"column":36,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":54,"endColumn":100},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm\">Start tracking emotions and sensory inputs to see visualizations</p>","line":54,"column":36,"nodeType":"JSXText","endLine":54,"endColumn":100},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Data Insights for\"","line":64,"column":69,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":65,"endColumn":29},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-2xl font-semibold text-foreground mb-2\">\n          Data Insights for {studentName}\n        </h2>","line":64,"column":69,"nodeType":"JSXText","endLine":65,"endColumn":29},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Tracking\"","line":68,"column":51,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":69,"endColumn":20},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">\n          {selectedRange && `${selectedRange} • `}\n          Tracking {emotions.length} emotions and {sensoryInputs.length} sensory inputs\n        </p>","line":68,"column":51,"nodeType":"JSXText","endLine":69,"endColumn":20},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"emotions and\"","line":69,"column":37,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":69,"endColumn":51},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">\n          {selectedRange && `${selectedRange} • `}\n          Tracking {emotions.length} emotions and {sensoryInputs.length} sensory inputs\n        </p>","line":69,"column":37,"nodeType":"JSXText","endLine":69,"endColumn":51},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"sensory inputs\"","line":69,"column":73,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":70,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">\n          {selectedRange && `${selectedRange} • `}\n          Tracking {emotions.length} emotions and {sensoryInputs.length} sensory inputs\n        </p>","line":69,"column":73,"nodeType":"JSXText","endLine":70,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotion Trends Over Time\"","line":78,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":80,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n              <TrendingUp className=\"h-5 w-5\" />\n              Emotion Trends Over Time\n            </CardTitle>","line":78,"column":49,"nodeType":"JSXText","endLine":80,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotion Distribution\"","line":159,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":161,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n                <PieChartIcon className=\"h-5 w-5\" />\n                Emotion Distribution\n              </CardTitle>","line":159,"column":53,"nodeType":"JSXText","endLine":161,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory Response Patterns\"","line":207,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":209,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n                <BarChart3 className=\"h-5 w-5\" />\n                Sensory Response Patterns\n              </CardTitle>","line":207,"column":50,"nodeType":"JSXText","endLine":209,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":18,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { memo } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport type { EChartsOption } from \"echarts\";\nimport { EChartContainer } from \"@/components/charts/EChartContainer\";\nimport { EmotionEntry, SensoryEntry } from \"@/types/student\";\nimport { TrendingUp, BarChart3, PieChart as PieChartIcon } from \"lucide-react\";\nimport { useProgressiveChartData } from '@/hooks/useProgressiveChartData';\nimport { ErrorBoundary } from '@/components/ErrorBoundary';\nimport { buildEmotionTrendsOption, TrendRow } from '@/components/charts/ChartKit';\n\ninterface DataVisualizationProps {\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  studentName: string;\n  showTimeFilter?: boolean;\n  selectedRange?: string;\n}\n\nconst emotionColors = {\n  happy: '#10B981',\n  calm: '#06B6D4',\n  excited: '#8B5CF6',\n  sad: '#3B82F6',\n  anxious: '#F59E0B',\n  angry: '#EF4444',\n} as const;\n\n/**\n * Optimized DataVisualization component with React.memo and useMemo for expensive computations\n */\nexport const OptimizedDataVisualization = memo(({ \n  emotions, \n  sensoryInputs, \n  studentName, \n  showTimeFilter: _showTimeFilter = false, \n  selectedRange \n}: DataVisualizationProps) => {\n  \n  const { data, state } = useProgressiveChartData({\n    emotions,\n    sensoryInputs,\n    entries: [],\n    analyticsResults: null,\n  });\n\n  // Early return for empty state\n  if (emotions.length === 0 && sensoryInputs.length === 0) {\n    return (\n      <Card className=\"font-dyslexia bg-gradient-card border-0\">\n        <CardContent className=\"flex items-center justify-center h-64\">\n          <div className=\"text-center text-muted-foreground\">\n            <BarChart3 className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n            <p className=\"text-lg\">No data to display yet</p>\n            <p className=\"text-sm\">Start tracking emotions and sensory inputs to see visualizations</p>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6 font-dyslexia\">\n      <div className=\"text-center\">\n        <h2 className=\"text-2xl font-semibold text-foreground mb-2\">\n          Data Insights for {studentName}\n        </h2>\n        <p className=\"text-muted-foreground\">\n          {selectedRange && `${selectedRange} • `}\n          Tracking {emotions.length} emotions and {sensoryInputs.length} sensory inputs\n        </p>\n      </div>\n\n      {/* Emotion Trends */}\n      {(state.steps.emotionTrends || data.emotionTrends.length > 0) && (\n        <Card className=\"bg-gradient-card border-0\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <TrendingUp className=\"h-5 w-5\" />\n              Emotion Trends Over Time\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <ErrorBoundary>\n              {state.isLoading && !state.steps.emotionTrends ? (\n                <div aria-label=\"Loading emotion trends\" className=\"h-[300px] w-full\">\n                  <div className=\"h-full w-full animate-pulse rounded-md border border-border/50 bg-muted/20\" />\n                </div>\n              ) : (() => {\n                // Aggregate daily rows compatible with ChartKit TrendRow\n                const byDate = new Map<string, TrendRow & { count: number }>();\n                for (const e of emotions) {\n                  const d = e.timestamp instanceof Date ? e.timestamp : new Date(e.timestamp);\n                  if (Number.isNaN(d.getTime())) continue;\n                  const key = d.toISOString().slice(0, 10);\n                  if (!byDate.has(key)) {\n                    byDate.set(key, {\n                      date: key,\n                      avgEmotionIntensity: 0,\n                      positiveEmotions: 0,\n                      negativeEmotions: 0,\n                      totalSensoryInputs: 0,\n                      count: 0,\n                    });\n                  }\n                  const row = byDate.get(key)!;\n                  const intensity = typeof e.intensity === 'number' ? e.intensity : Number(e.intensity) || 0;\n                  row.avgEmotionIntensity = (row.avgEmotionIntensity * row.count + intensity) / (row.count + 1);\n                  row.count += 1;\n                  const name = String(e.emotion || '').toLowerCase();\n                  if ([\"happy\",\"calm\",\"focused\",\"excited\",\"proud\"].includes(name)) row.positiveEmotions += 1;\n                  if ([\"sad\",\"angry\",\"anxious\",\"frustrated\",\"overwhelmed\"].includes(name)) row.negativeEmotions += 1;\n                }\n                for (const s of sensoryInputs) {\n                  const d = s.timestamp instanceof Date ? s.timestamp : new Date(s.timestamp);\n                  if (Number.isNaN(d.getTime())) continue;\n                  const key = d.toISOString().slice(0, 10);\n                  if (!byDate.has(key)) {\n                    byDate.set(key, {\n                      date: key,\n                      avgEmotionIntensity: 0,\n                      positiveEmotions: 0,\n                      negativeEmotions: 0,\n                      totalSensoryInputs: 0,\n                      count: 0,\n                    });\n                  }\n                  const row = byDate.get(key)!;\n                  row.totalSensoryInputs += 1;\n                }\n                const rows = Array.from(byDate.values())\n                  .sort((a, b) => a.date.localeCompare(b.date))\n                  .map(({ count, ...r }) => r);\n\n                const option: EChartsOption = buildEmotionTrendsOption(rows, {\n                  title: undefined,\n                  showMovingAverage: true,\n                  movingAverageWindow: 7,\n                  useDualYAxis: true,\n                  thresholds: { emotion: 7, sensory: 5 },\n                });\n                return <EChartContainer \n                  option={option} \n                  height={300} \n                  aria-label=\"Emotion trends line chart\"\n                  exportRegistration={{ id: 'emotion-trends', type: 'trends', title: 'Emotion Trends' }}\n                />;\n              })()}\n            </ErrorBoundary>\n          </CardContent>\n        </Card>\n      )}\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Emotion Distribution */}\n        {(data.emotionDistribution.length > 0 || state.isLoading) && (\n          <Card className=\"bg-gradient-card border-0\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <PieChartIcon className=\"h-5 w-5\" />\n                Emotion Distribution\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <ErrorBoundary>\n                {state.isLoading && !state.steps.emotionDistribution ? (\n                  <div aria-label=\"Loading emotion distribution\" className=\"h-[250px] w-full\">\n                    <div className=\"h-full w-full animate-pulse rounded-md border border-border/50 bg-muted/20\" />\n                  </div>\n                ) : (() => {\n                  type PieItemCallbackParam = { name?: string };\n                  const option: EChartsOption = {\n                    dataset: { source: data.emotionDistribution.map((d) => ({ name: d.name, value: d.value })) },\n                    tooltip: { trigger: \"item\" },\n                    legend: { bottom: 0, type: \"scroll\" },\n                    series: [\n                      {\n                        type: \"pie\",\n                        radius: [\"45%\", \"70%\"],\n                        label: { formatter: \"{b}: {@value} ({d}%)\" },\n                        encode: { itemName: \"name\", value: \"value\" },\n                        itemStyle: {\n                          color: (params: PieItemCallbackParam) => {\n                            const key = (params?.name || \"\") as keyof typeof emotionColors;\n                            return emotionColors[key] || \"#8884d8\";\n                          },\n                        },\n                      },\n                    ],\n                  };\n                  return <EChartContainer \n                    option={option} \n                    height={250} \n                    aria-label=\"Emotion distribution donut chart\"\n                    exportRegistration={{ id: 'emotion-distribution', type: 'distribution', title: 'Emotion Distribution' }}\n                  />;\n                })()}\n              </ErrorBoundary>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Sensory Responses */}\n        {(data.sensoryResponses.length > 0 || state.isLoading) && (\n          <Card className=\"bg-gradient-card border-0\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <BarChart3 className=\"h-5 w-5\" />\n                Sensory Response Patterns\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <ErrorBoundary>\n                {state.isLoading && !state.steps.sensoryResponses ? (\n                  <div aria-label=\"Loading sensory responses\" className=\"h-[250px] w-full\">\n                    <div className=\"h-full w-full animate-pulse rounded-md border border-border/50 bg-muted/20\" />\n                  </div>\n                ) : (() => {\n                  const option: EChartsOption = {\n                    dataset: { source: data.sensoryResponses },\n                    grid: { top: 24, right: 16, bottom: 32, left: 40 },\n                    xAxis: { type: \"category\", name: \"Type\", nameGap: 24 },\n                    yAxis: { type: \"value\", name: \"Count\", nameGap: 28, minInterval: 1 },\n                    tooltip: { trigger: \"axis\", axisPointer: { type: \"shadow\" } },\n                    legend: { top: 0 },\n                    series: [\n                      { type: \"bar\", name: \"Seeking\", encode: { x: \"type\", y: \"seeking\" }, itemStyle: { color: \"#10B981\" } },\n                      { type: \"bar\", name: \"Avoiding\", encode: { x: \"type\", y: \"avoiding\" }, itemStyle: { color: \"#EF4444\" } },\n                      { type: \"bar\", name: \"Neutral\", encode: { x: \"type\", y: \"neutral\" }, itemStyle: { color: \"#6B7280\" } },\n                    ],\n                  };\n                  return <EChartContainer \n                    option={option} \n                    height={250} \n                    aria-label=\"Sensory response patterns stacked bars\"\n                    exportRegistration={{ id: 'sensory-responses', type: 'distribution', title: 'Sensory Response Patterns' }}\n                  />;\n                })()}\n              </ErrorBoundary>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}, (prevProps, nextProps) => {\n  // Custom comparison for better performance\n  // Re-render only if data actually changed\n  return (\n    prevProps.studentName === nextProps.studentName &&\n    prevProps.selectedRange === nextProps.selectedRange &&\n    prevProps.showTimeFilter === nextProps.showTimeFilter &&\n    prevProps.emotions.length === nextProps.emotions.length &&\n    prevProps.sensoryInputs.length === nextProps.sensoryInputs.length &&\n    // Deep check only if lengths are same\n    (prevProps.emotions.length === 0 || \n      prevProps.emotions[0]?.timestamp === nextProps.emotions[0]?.timestamp) &&\n    (prevProps.sensoryInputs.length === 0 || \n      prevProps.sensoryInputs[0]?.timestamp === nextProps.sensoryInputs[0]?.timestamp)\n  );\n});\n\nOptimizedDataVisualization.displayName = 'OptimizedDataVisualization';","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/optimized/OptimizedEnhancedPersonalizedInsights.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Loading insights...\"","line":156,"column":17,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":156,"endColumn":36},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Personalized Insights for\"","line":164,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":165,"endColumn":39},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n            <Lightbulb className=\"h-5 w-5\" />\n            Personalized Insights for {student.name}\n          </CardTitle>","line":164,"column":46,"nodeType":"JSXText","endLine":165,"endColumn":39},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Start tracking emotions and sensory inputs to generate personalized insights\"","line":170,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":170,"endColumn":124},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">Start tracking emotions and sensory inputs to generate personalized insights</p>","line":170,"column":48,"nodeType":"JSXText","endLine":170,"endColumn":124},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Personalized Insights for\"","line":182,"column":61,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":183,"endColumn":41},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n              <Lightbulb className=\"h-5 w-5 text-primary\" />\n              Personalized Insights for {student.name}\n            </CardTitle>","line":182,"column":61,"nodeType":"JSXText","endLine":183,"endColumn":41},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Total Data Points\"","line":203,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":203,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">Total Data Points</div>","line":203,"column":62,"nodeType":"JSXText","endLine":203,"endColumn":79},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Data Consistency\"","line":207,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":207,"endColumn":78},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">Data Consistency</div>","line":207,"column":62,"nodeType":"JSXText","endLine":207,"endColumn":78},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotional Stability\"","line":211,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":211,"endColumn":81},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">Emotional Stability</div>","line":211,"column":62,"nodeType":"JSXText","endLine":211,"endColumn":81},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Intensity Trend\"","line":223,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":223,"endColumn":77},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">Intensity Trend</div>","line":223,"column":62,"nodeType":"JSXText","endLine":223,"endColumn":77},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"AI Insights\"","line":231,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":231,"endColumn":52},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"insights\">AI Insights</TabsTrigger>","line":231,"column":41,"nodeType":"JSXText","endLine":231,"endColumn":52},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Strengths\"","line":232,"column":42,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":232,"endColumn":51},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"strengths\">Strengths</TabsTrigger>","line":232,"column":42,"nodeType":"JSXText","endLine":232,"endColumn":51},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Growth Areas\"","line":233,"column":39,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":233,"endColumn":51},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"growth\">Growth Areas</TabsTrigger>","line":233,"column":39,"nodeType":"JSXText","endLine":233,"endColumn":51},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Patterns\"","line":234,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":234,"endColumn":49},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"patterns\">Patterns</TabsTrigger>","line":234,"column":41,"nodeType":"JSXText","endLine":234,"endColumn":49},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Alerts\"","line":235,"column":42,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":235,"endColumn":48},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <TabsTrigger value=\"anomalies\">Alerts</TabsTrigger>","line":235,"column":42,"nodeType":"JSXText","endLine":235,"endColumn":48},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":241,"column":26,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":241,"endColumn":31},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Forecast:\"","line":256,"column":66,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":257,"endColumn":41},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm font-medium\">\n                              Forecast: {insight.prediction.value.toFixed(1)} \n                              <Badge variant=\"outline\" className=\"ml-2\">\n                                {insight.prediction.trend}\n                              </Badge>\n                            </div>","line":256,"column":66,"nodeType":"JSXText","endLine":257,"endColumn":41},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Recommendations:\"","line":266,"column":70,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":266,"endColumn":86},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h5 className=\"text-sm font-medium mb-2\">Recommendations:</h5>","line":266,"column":70,"nodeType":"JSXText","endLine":266,"endColumn":86},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":269,"column":42,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":269,"endColumn":50},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"% confidence\"","line":288,"column":97,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":289,"endColumn":23},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge \n                        variant={insight.confidence > 0.7 ? 'default' : 'outline'}\n                        className={\n                          insight.confidence > 0.7 ? 'bg-green-100 text-green-800' :\n                          insight.confidence > 0.4 ? 'bg-yellow-100 text-yellow-800' :\n                          'bg-red-100 text-red-800'\n                        }\n                      >\n                       <OptimizedAnimatedCounter value={Math.round(insight.confidence * 100)} />% confidence\n                      </Badge>","line":288,"column":97,"nodeType":"JSXText","endLine":289,"endColumn":23},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Continue collecting data to generate predictive insights\"","line":301,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":301,"endColumn":74},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Continue collecting data to generate predictive insights</p>","line":301,"column":18,"nodeType":"JSXText","endLine":301,"endColumn":74},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":309,"column":26,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":309,"endColumn":31},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Strength Level:\"","line":320,"column":75,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":320,"endColumn":90},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs text-muted-foreground\">Strength Level:</span>","line":320,"column":75,"nodeType":"JSXText","endLine":320,"endColumn":90},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Strengths will be identified as patterns emerge from data collection\"","line":333,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":333,"endColumn":86},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Strengths will be identified as patterns emerge from data collection</p>","line":333,"column":18,"nodeType":"JSXText","endLine":333,"endColumn":86},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":341,"column":26,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":341,"endColumn":31},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"priority\"","line":367,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":368,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant={\n                          opportunity.priority === 'high' ? 'destructive' :\n                          opportunity.priority === 'medium' ? 'default' :\n                          'secondary'\n                        }>\n                          {opportunity.priority} priority\n                        </Badge>","line":367,"column":49,"nodeType":"JSXText","endLine":368,"endColumn":25},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Action Steps:\"","line":373,"column":68,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":373,"endColumn":81},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h5 className=\"text-sm font-medium mb-2\">Action Steps:</h5>","line":373,"column":68,"nodeType":"JSXText","endLine":373,"endColumn":81},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":376,"column":40,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":376,"endColumn":48},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Growth opportunities will be identified based on data patterns\"","line":392,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":392,"endColumn":80},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Growth opportunities will be identified based on data patterns</p>","line":392,"column":18,"nodeType":"JSXText","endLine":392,"endColumn":80},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":401,"column":28,"nodeType":"TemplateLiteral","messageId":"noArrayIndex","endLine":401,"endColumn":46},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotional Pattern:\"","line":406,"column":55,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":406,"endColumn":74},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-semibold\">Emotional Pattern: {pattern.pattern.replace('-', ' ')}</h4>","line":406,"column":55,"nodeType":"JSXText","endLine":406,"endColumn":74},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"% confidence\"","line":410,"column":101,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":411,"endColumn":27},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\">\n                           <OptimizedAnimatedCounter value={Math.round(pattern.confidence * 100)} />% confidence\n                          </Badge>","line":410,"column":101,"nodeType":"JSXText","endLine":411,"endColumn":27},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"data points\"","line":413,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":414,"endColumn":27},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs text-muted-foreground\">\n                            {pattern.dataPoints} data points\n                          </span>","line":413,"column":49,"nodeType":"JSXText","endLine":414,"endColumn":27},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":422,"column":28,"nodeType":"TemplateLiteral","messageId":"noArrayIndex","endLine":422,"endColumn":46},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory Pattern:\"","line":427,"column":55,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":427,"endColumn":72},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-semibold\">Sensory Pattern: {pattern.pattern.replace('-', ' ')}</h4>","line":427,"column":55,"nodeType":"JSXText","endLine":427,"endColumn":72},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"% confidence\"","line":431,"column":101,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":432,"endColumn":27},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\">\n                           <OptimizedAnimatedCounter value={Math.round(pattern.confidence * 100)} />% confidence\n                          </Badge>","line":431,"column":101,"nodeType":"JSXText","endLine":432,"endColumn":27},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"data points\"","line":434,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":435,"endColumn":27},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs text-muted-foreground\">\n                            {pattern.dataPoints} data points\n                          </span>","line":434,"column":49,"nodeType":"JSXText","endLine":435,"endColumn":27},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Patterns will emerge as more data is collected\"","line":446,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":446,"endColumn":64},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>Patterns will emerge as more data is collected</p>","line":446,"column":18,"nodeType":"JSXText","endLine":446,"endColumn":64},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":454,"column":26,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":454,"endColumn":31},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"severity\"","line":474,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":475,"endColumn":25},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant={\n                          anomaly.severity === 'high' ? 'destructive' :\n                          anomaly.severity === 'medium' ? 'default' :\n                          'secondary'\n                        }>\n                          {anomaly.severity} severity\n                        </Badge>","line":474,"column":45,"nodeType":"JSXText","endLine":475,"endColumn":25},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Recommended Actions:\"","line":482,"column":68,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":482,"endColumn":88},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h5 className=\"text-sm font-medium mb-2\">Recommended Actions:</h5>","line":482,"column":68,"nodeType":"JSXText","endLine":482,"endColumn":88},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":485,"column":40,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":485,"endColumn":48},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No significant anomalies detected in recent data\"","line":501,"column":18,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":501,"endColumn":66},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>No significant anomalies detected in recent data</p>","line":501,"column":18,"nodeType":"JSXText","endLine":501,"endColumn":66}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":72,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Progress } from '@/components/ui/progress';\nimport { EmotionEntry, SensoryEntry, TrackingEntry, Student } from '@/types/student';\nimport { enhancedPatternAnalysis, PredictiveInsight, AnomalyDetection as Anomaly } from '@/lib/enhancedPatternAnalysis';\nimport { patternAnalysis, PatternResult as Pattern } from '@/lib/patternAnalysis';\nimport { differenceInDays, format, subDays } from 'date-fns';\nimport {\n  Brain,\n  TrendingUp,\n  TrendingDown,\n  Eye,\n  Lightbulb,\n  Target,\n  AlertTriangle,\n  CheckCircle,\n  Activity,\n  BarChart3,\n  Heart,\n  Shield\n} from 'lucide-react';\nimport { useOptimizedMemo, useAsyncMemo } from '@/hooks/useOptimizedMemo';\nimport { OptimizedAnimatedCounter } from './OptimizedAnimatedCounter';\n\nconst useDashboardMetrics = (filteredData) => {\n  return useOptimizedMemo(() => {\n    const totalDays = differenceInDays(new Date(), filteredData.emotions[0]?.timestamp || new Date());\n    const avgDailyEmotions = filteredData.emotions.length / Math.max(1, totalDays);\n    const avgEmotionIntensity = filteredData.emotions.reduce((sum, e) => sum + e.intensity, 0) / Math.max(1, filteredData.emotions.length);\n    const recentWeek = filteredData.emotions.filter(e => e.timestamp >= subDays(new Date(), 7));\n    const recentAvgIntensity = recentWeek.reduce((sum, e) => sum + e.intensity, 0) / Math.max(1, recentWeek.length);\n    const intensityTrend = recentAvgIntensity - avgEmotionIntensity;\n    return {\n      dataConsistency: Math.min(100, (avgDailyEmotions / 3) * 100),\n      emotionalStability: Math.max(0, 100 - (avgEmotionIntensity * 20)),\n      intensityTrend,\n      totalDataPoints: filteredData.emotions.length + filteredData.sensoryInputs.length\n    };\n  }, [filteredData], 'progressMetrics');\n};\n\ninterface EnhancedPersonalizedInsightsProps {\n  student: Student;\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  trackingEntries: TrackingEntry[];\n}\n\nexport const OptimizedEnhancedPersonalizedInsights: React.FC<EnhancedPersonalizedInsightsProps> = ({\n  student,\n  emotions,\n  sensoryInputs,\n  trackingEntries\n}) => {\n  const [selectedTimeframe, setSelectedTimeframe] = useState<'7d' | '30d' | '90d'>('30d');\n\n  const filteredData = useOptimizedMemo(() => {\n    const cutoff = subDays(new Date(), selectedTimeframe === '7d' ? 7 : selectedTimeframe === '30d' ? 30 : 90);\n    return {\n      emotions: emotions.filter(e => e.timestamp >= cutoff),\n      sensoryInputs: sensoryInputs.filter(s => s.timestamp >= cutoff),\n      trackingEntries: trackingEntries.filter(t => t.timestamp >= cutoff)\n    };\n  }, [emotions, sensoryInputs, trackingEntries, selectedTimeframe], 'filteredData');\n\n  const { data: insights, loading: insightsLoading } = useAsyncMemo<{\n    predictiveInsights: PredictiveInsight[];\n    anomalies: Anomaly[];\n    emotionPatterns: Pattern[];\n    sensoryPatterns: Pattern[];\n  } | null>(async () => {\n    if (filteredData.emotions.length === 0 && filteredData.sensoryInputs.length === 0) {\n      return null;\n    }\n    const [predictiveInsights, anomalies] = await Promise.all([\n      enhancedPatternAnalysis.generatePredictiveInsights(filteredData.emotions, filteredData.sensoryInputs, filteredData.trackingEntries),\n      enhancedPatternAnalysis.detectAnomalies(filteredData.emotions, filteredData.sensoryInputs, filteredData.trackingEntries)\n    ]);\n    return {\n      predictiveInsights,\n      anomalies,\n      emotionPatterns: patternAnalysis.analyzeEmotionPatterns(filteredData.emotions),\n      sensoryPatterns: patternAnalysis.analyzeSensoryPatterns(filteredData.sensoryInputs)\n    };\n  }, [filteredData], null);\n  \n  const personalStrengths = useOptimizedMemo(() => {\n    const strengths = [];\n    const positiveEmotions = filteredData.emotions.filter(e =>\n      ['happy', 'calm', 'focused', 'proud', 'excited'].includes(e.emotion.toLowerCase())\n    );\n    if (positiveEmotions.length > filteredData.emotions.length * 0.6) {\n      strengths.push({\n        title: 'Emotional Resilience',\n        description: `${student.name} maintains positive emotions ${Math.round(positiveEmotions.length / filteredData.emotions.length * 100)}% of the time`,\n        icon: Heart,\n        confidence: 0.8\n      });\n    }\n    const consistentSensory = filteredData.sensoryInputs.filter(s =>\n      s.response.toLowerCase().includes('appropriate') ||\n      s.response.toLowerCase().includes('comfortable')\n    );\n    if (consistentSensory.length > filteredData.sensoryInputs.length * 0.5) {\n      strengths.push({\n        title: 'Sensory Self-Regulation',\n        description: `Shows good sensory processing in ${Math.round(consistentSensory.length / filteredData.sensoryInputs.length * 100)}% of situations`,\n        icon: Shield,\n        confidence: 0.7\n      });\n    }\n    return strengths;\n  }, [filteredData, student.name], 'personalStrengths');\n\n  const growthOpportunities = useOptimizedMemo(() => {\n    const opportunities = [];\n    const challengingEmotions = filteredData.emotions.filter(e =>\n      e.intensity >= 4 && ['anxious', 'frustrated', 'overwhelmed'].includes(e.emotion.toLowerCase())\n    );\n    if (challengingEmotions.length > 0) {\n      opportunities.push({\n        title: 'Stress Management',\n        description: `Opportunities to develop coping strategies for high-intensity emotions`,\n        recommendations: [\n          'Practice deep breathing exercises',\n          'Implement sensory breaks',\n          'Create calm-down strategies'\n        ],\n        priority: 'high'\n      });\n    }\n    const sensorySeekingCount = filteredData.sensoryInputs.filter(s =>\n      s.response.toLowerCase().includes('seeking')\n    ).length;\n    if (sensorySeekingCount > filteredData.sensoryInputs.length * 0.7) {\n      opportunities.push({\n        title: 'Sensory Regulation',\n        description: `High sensory seeking behavior suggests need for structured sensory input`,\n        recommendations: [\n          'Schedule regular sensory breaks',\n          'Provide fidget tools',\n          'Create sensory-rich learning activities'\n        ],\n        priority: 'medium'\n      });\n    }\n    return opportunities;\n  }, [filteredData], 'growthOpportunities');\n\n  const progressMetrics = useDashboardMetrics(filteredData);\n  \n  if (insightsLoading) {\n    return <div>Loading insights...</div>\n  }\n\n  if (!insights) {\n    return (\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Lightbulb className=\"h-5 w-5\" />\n            Personalized Insights for {student.name}\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"text-center py-8\">\n          <Activity className=\"h-16 w-16 mx-auto mb-4 opacity-50 text-muted-foreground\" />\n          <p className=\"text-muted-foreground\">Start tracking emotions and sensory inputs to generate personalized insights</p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"flex items-center gap-2\">\n              <Lightbulb className=\"h-5 w-5 text-primary\" />\n              Personalized Insights for {student.name}\n            </CardTitle>\n            <div className=\"flex gap-2\">\n              {(['7d', '30d', '90d'] as const).map((timeframe) => (\n                <Button\n                  key={timeframe}\n                  variant={selectedTimeframe === timeframe ? 'default' : 'outline'}\n                  size=\"sm\"\n                  onClick={() => setSelectedTimeframe(timeframe)}\n                >\n                  {timeframe === '7d' ? '7 days' : timeframe === '30d' ? '30 days' : '90 days'}\n                </Button>\n              ))}\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-primary\"><OptimizedAnimatedCounter value={progressMetrics.totalDataPoints} /></div>\n              <div className=\"text-sm text-muted-foreground\">Total Data Points</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-primary\"><OptimizedAnimatedCounter value={Math.round(progressMetrics.dataConsistency)} />%</div>\n              <div className=\"text-sm text-muted-foreground\">Data Consistency</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"text-2xl font-bold text-primary\"><OptimizedAnimatedCounter value={Math.round(progressMetrics.emotionalStability)} />%</div>\n              <div className=\"text-sm text-muted-foreground\">Emotional Stability</div>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"flex items-center justify-center gap-1\">\n                <span className=\"text-2xl font-bold text-primary\">\n                  {progressMetrics.intensityTrend > 0 ? '+' : ''}{progressMetrics.intensityTrend.toFixed(1)}\n                </span>\n                {progressMetrics.intensityTrend > 0 ? \n                  <TrendingUp className=\"h-4 w-4 text-red-500\" /> : \n                  <TrendingDown className=\"h-4 w-4 text-green-500\" />\n                }\n              </div>\n              <div className=\"text-sm text-muted-foreground\">Intensity Trend</div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Tabs defaultValue=\"insights\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-5\">\n          <TabsTrigger value=\"insights\">AI Insights</TabsTrigger>\n          <TabsTrigger value=\"strengths\">Strengths</TabsTrigger>\n          <TabsTrigger value=\"growth\">Growth Areas</TabsTrigger>\n          <TabsTrigger value=\"patterns\">Patterns</TabsTrigger>\n          <TabsTrigger value=\"anomalies\">Alerts</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"insights\" className=\"space-y-4\">\n          {insights.predictiveInsights.length > 0 ? (\n            insights.predictiveInsights.map((insight, index) => (\n              <Card key={index} className=\"border-l-4 border-l-primary\">\n                <CardContent className=\"pt-4\">\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex items-start gap-3 flex-1\">\n                      <div className=\"p-2 rounded-full bg-primary/10\">\n                        {insight.type === 'prediction' ? <Target className=\"h-4 w-4 text-primary\" /> :\n                         insight.type === 'trend' ? <TrendingUp className=\"h-4 w-4 text-primary\" /> :\n                         insight.type === 'risk' ? <AlertTriangle className=\"h-4 w-4 text-orange-500\" /> :\n                         <Lightbulb className=\"h-4 w-4 text-primary\" />}\n                      </div>\n                      <div className=\"flex-1\">\n                        <h4 className=\"font-semibold text-foreground\">{insight.title}</h4>\n                        <p className=\"text-sm text-muted-foreground mt-1\">{insight.description}</p>\n                        {insight.prediction && (\n                          <div className=\"mt-2 p-2 bg-muted/50 rounded-lg\">\n                            <div className=\"text-sm font-medium\">\n                              Forecast: {insight.prediction.value.toFixed(1)} \n                              <Badge variant=\"outline\" className=\"ml-2\">\n                                {insight.prediction.trend}\n                              </Badge>\n                            </div>\n                          </div>\n                        )}\n                        {insight.recommendations.length > 0 && (\n                          <div className=\"mt-3\">\n                            <h5 className=\"text-sm font-medium mb-2\">Recommendations:</h5>\n                            <ul className=\"text-sm text-muted-foreground space-y-1\">\n                              {insight.recommendations.map((rec, recIndex) => (\n                                <li key={recIndex} className=\"flex items-start gap-2\">\n                                  <CheckCircle className=\"h-3 w-3 mt-0.5 text-green-500 flex-shrink-0\" />\n                                  <span>{rec}</span>\n                                </li>\n                              ))}\n                            </ul>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"text-right\">\n                      <Badge \n                        variant={insight.confidence > 0.7 ? 'default' : 'outline'}\n                        className={\n                          insight.confidence > 0.7 ? 'bg-green-100 text-green-800' :\n                          insight.confidence > 0.4 ? 'bg-yellow-100 text-yellow-800' :\n                          'bg-red-100 text-red-800'\n                        }\n                      >\n                       <OptimizedAnimatedCounter value={Math.round(insight.confidence * 100)} />% confidence\n                      </Badge>\n                      <div className=\"text-xs text-muted-foreground mt-1\">\n                        {insight.timeframe}\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          ) : (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <Brain className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n              <p>Continue collecting data to generate predictive insights</p>\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"strengths\" className=\"space-y-4\">\n          {personalStrengths.length > 0 ? (\n            personalStrengths.map((strength, index) => (\n              <Card key={index} className=\"border-l-4 border-l-green-500\">\n                <CardContent className=\"pt-4\">\n                  <div className=\"flex items-start gap-3\">\n                    <div className=\"p-2 rounded-full bg-green-100\">\n                      <strength.icon className=\"h-4 w-4 text-green-600\" />\n                    </div>\n                    <div className=\"flex-1\">\n                      <h4 className=\"font-semibold text-foreground\">{strength.title}</h4>\n                      <p className=\"text-sm text-muted-foreground mt-1\">{strength.description}</p>\n                      <div className=\"mt-2\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-xs text-muted-foreground\">Strength Level:</span>\n                          <Progress value={strength.confidence * 100} className=\"w-24 h-2\" />\n                          <span className=\"text-xs font-medium\"><OptimizedAnimatedCounter value={Math.round(strength.confidence * 100)} />%</span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          ) : (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <Heart className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n              <p>Strengths will be identified as patterns emerge from data collection</p>\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"growth\" className=\"space-y-4\">\n          {growthOpportunities.length > 0 ? (\n            growthOpportunities.map((opportunity, index) => (\n              <Card key={index} className={`border-l-4 ${\n                opportunity.priority === 'high' ? 'border-l-orange-500' :\n                opportunity.priority === 'medium' ? 'border-l-yellow-500' :\n                'border-l-blue-500'\n              }`}>\n                <CardContent className=\"pt-4\">\n                  <div className=\"flex items-start gap-3\">\n                    <div className={`p-2 rounded-full ${\n                      opportunity.priority === 'high' ? 'bg-orange-100' :\n                      opportunity.priority === 'medium' ? 'bg-yellow-100' :\n                      'bg-blue-100'\n                    }`}>\n                      <Target className={`h-4 w-4 ${\n                        opportunity.priority === 'high' ? 'text-orange-600' :\n                        opportunity.priority === 'medium' ? 'text-yellow-600' :\n                        'text-blue-600'\n                      }`} />\n                    </div>\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2\">\n                        <h4 className=\"font-semibold text-foreground\">{opportunity.title}</h4>\n                        <Badge variant={\n                          opportunity.priority === 'high' ? 'destructive' :\n                          opportunity.priority === 'medium' ? 'default' :\n                          'secondary'\n                        }>\n                          {opportunity.priority} priority\n                        </Badge>\n                      </div>\n                      <p className=\"text-sm text-muted-foreground mt-1\">{opportunity.description}</p>\n                      {opportunity.recommendations.length > 0 && (\n                        <div className=\"mt-3\">\n                          <h5 className=\"text-sm font-medium mb-2\">Action Steps:</h5>\n                          <ul className=\"text-sm text-muted-foreground space-y-1\">\n                            {opportunity.recommendations.map((rec, recIndex) => (\n                              <li key={recIndex} className=\"flex items-start gap-2\">\n                                <span className=\"text-primary\">•</span>\n                                <span>{rec}</span>\n                              </li>\n                            ))}\n                          </ul>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          ) : (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <Target className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n              <p>Growth opportunities will be identified based on data patterns</p>\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"patterns\" className=\"space-y-4\">\n          {(insights.emotionPatterns.length > 0 || insights.sensoryPatterns.length > 0) ? (\n            <>\n              {insights.emotionPatterns.map((pattern, index) => (\n                <Card key={`emotion-${index}`} className=\"border-l-4 border-l-purple-500\">\n                  <CardContent className=\"pt-4\">\n                    <div className=\"flex items-start gap-3\">\n                      <Brain className=\"h-5 w-5 text-purple-500 mt-0.5\" />\n                      <div className=\"flex-1\">\n                        <h4 className=\"font-semibold\">Emotional Pattern: {pattern.pattern.replace('-', ' ')}</h4>\n                        <p className=\"text-sm text-muted-foreground mt-1\">{pattern.description}</p>\n                        <div className=\"flex items-center gap-4 mt-2\">\n                          <Badge variant=\"outline\">\n                           <OptimizedAnimatedCounter value={Math.round(pattern.confidence * 100)} />% confidence\n                          </Badge>\n                          <span className=\"text-xs text-muted-foreground\">\n                            {pattern.dataPoints} data points\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n              {insights.sensoryPatterns.map((pattern, index) => (\n                <Card key={`sensory-${index}`} className=\"border-l-4 border-l-cyan-500\">\n                  <CardContent className=\"pt-4\">\n                    <div className=\"flex items-start gap-3\">\n                      <Eye className=\"h-5 w-5 text-cyan-500 mt-0.5\" />\n                      <div className=\"flex-1\">\n                        <h4 className=\"font-semibold\">Sensory Pattern: {pattern.pattern.replace('-', ' ')}</h4>\n                        <p className=\"text-sm text-muted-foreground mt-1\">{pattern.description}</p>\n                        <div className=\"flex items-center gap-4 mt-2\">\n                          <Badge variant=\"outline\">\n                           <OptimizedAnimatedCounter value={Math.round(pattern.confidence * 100)} />% confidence\n                          </Badge>\n                          <span className=\"text-xs text-muted-foreground\">\n                            {pattern.dataPoints} data points\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </>\n          ) : (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <BarChart3 className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n              <p>Patterns will emerge as more data is collected</p>\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"anomalies\" className=\"space-y-4\">\n          {insights.anomalies.length > 0 ? (\n            insights.anomalies.map((anomaly, index) => (\n              <Card key={index} className={`border-l-4 ${\n                anomaly.severity === 'high' ? 'border-l-red-500' :\n                anomaly.severity === 'medium' ? 'border-l-orange-500' :\n                'border-l-yellow-500'\n              }`}>\n                <CardContent className=\"pt-4\">\n                  <div className=\"flex items-start gap-3\">\n                    <AlertTriangle className={`h-5 w-5 mt-0.5 ${\n                      anomaly.severity === 'high' ? 'text-red-500' :\n                      anomaly.severity === 'medium' ? 'text-orange-500' :\n                      'text-yellow-500'\n                    }`} />\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2\">\n                        <h4 className=\"font-semibold\">{anomaly.description}</h4>\n                        <Badge variant={\n                          anomaly.severity === 'high' ? 'destructive' :\n                          anomaly.severity === 'medium' ? 'default' :\n                          'secondary'\n                        }>\n                          {anomaly.severity} severity\n                        </Badge>\n                      </div>\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        {format(anomaly.timestamp, 'MMM dd, yyyy - HH:mm')}\n                      </p>\n                      {anomaly.recommendations.length > 0 && (\n                        <div className=\"mt-3\">\n                          <h5 className=\"text-sm font-medium mb-2\">Recommended Actions:</h5>\n                          <ul className=\"text-sm text-muted-foreground space-y-1\">\n                            {anomaly.recommendations.map((rec, recIndex) => (\n                              <li key={recIndex} className=\"flex items-start gap-2\">\n                                <span className=\"text-primary\">•</span>\n                                <span>{rec}</span>\n                              </li>\n                            ))}\n                          </ul>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          ) : (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <Shield className=\"h-16 w-16 mx-auto mb-4 opacity-50\" />\n              <p>No significant anomalies detected in recent data</p>\n            </div>\n          )}\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/optimized/OptimizedGoalManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used. Allowed unused vars must match /^_/u.","line":26,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'logger' is defined but never used. Allowed unused vars must match /^_/u.","line":29,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'editingGoal' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":90,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":90,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setEditingGoal' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":90,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":90,"endColumn":37},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"IEP Goals & Tracking\"","line":344,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":344,"endColumn":66},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-2xl font-bold\">IEP Goals & Tracking</h2>","line":344,"column":46,"nodeType":"JSXText","endLine":344,"endColumn":66},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Create New Goal\"","line":350,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":352,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button className=\"bg-gradient-primary hover:opacity-90\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Create New Goal\n            </Button>","line":350,"column":48,"nodeType":"JSXText","endLine":352,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Create New IEP Goal\"","line":356,"column":28,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":356,"endColumn":47},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DialogTitle>Create New IEP Goal</DialogTitle>","line":356,"column":28,"nodeType":"JSXText","endLine":356,"endColumn":47},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Define a specific, measurable goal for\"","line":357,"column":34,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":358,"endColumn":56},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DialogDescription>\n                Define a specific, measurable goal for {student.name}'s educational progress.\n              </DialogDescription>","line":357,"column":34,"nodeType":"JSXText","endLine":358,"endColumn":56},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"'s educational progress.\"","line":358,"column":70,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":359,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DialogDescription>\n                Define a specific, measurable goal for {student.name}'s educational progress.\n              </DialogDescription>","line":358,"column":70,"nodeType":"JSXText","endLine":359,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Goal Title *\"","line":364,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":364,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"goal-title\">Goal Title *</Label>","line":364,"column":45,"nodeType":"JSXText","endLine":364,"endColumn":57},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Description *\"","line":374,"column":51,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":374,"endColumn":64},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"goal-description\">Description *</Label>","line":374,"column":51,"nodeType":"JSXText","endLine":374,"endColumn":64},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Category *\"","line":385,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":385,"endColumn":58},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"goal-category\">Category *</Label>","line":385,"column":48,"nodeType":"JSXText","endLine":385,"endColumn":58},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Behavioral\"","line":391,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":391,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"behavioral\">Behavioral</SelectItem>","line":391,"column":52,"nodeType":"JSXText","endLine":391,"endColumn":62},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Academic\"","line":392,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":392,"endColumn":58},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"academic\">Academic</SelectItem>","line":392,"column":50,"nodeType":"JSXText","endLine":392,"endColumn":58},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Social\"","line":393,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":393,"endColumn":54},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"social\">Social</SelectItem>","line":393,"column":48,"nodeType":"JSXText","endLine":393,"endColumn":54},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Communication\"","line":394,"column":55,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":394,"endColumn":68},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"communication\">Communication</SelectItem>","line":394,"column":55,"nodeType":"JSXText","endLine":394,"endColumn":68},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Motor Skills\"","line":395,"column":47,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":395,"endColumn":59},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"motor\">Motor Skills</SelectItem>","line":395,"column":47,"nodeType":"JSXText","endLine":395,"endColumn":59},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory\"","line":396,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":396,"endColumn":56},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"sensory\">Sensory</SelectItem>","line":396,"column":49,"nodeType":"JSXText","endLine":396,"endColumn":56},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Cognitive\"","line":397,"column":51,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":397,"endColumn":60},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"cognitive\">Cognitive</SelectItem>","line":397,"column":51,"nodeType":"JSXText","endLine":397,"endColumn":60},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotional\"","line":398,"column":51,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":398,"endColumn":60},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"emotional\">Emotional</SelectItem>","line":398,"column":51,"nodeType":"JSXText","endLine":398,"endColumn":60},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Self-Care\"","line":399,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":399,"endColumn":59},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"selfCare\">Self-Care</SelectItem>","line":399,"column":50,"nodeType":"JSXText","endLine":399,"endColumn":59},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Vocational\"","line":400,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":400,"endColumn":62},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"vocational\">Vocational</SelectItem>","line":400,"column":52,"nodeType":"JSXText","endLine":400,"endColumn":62},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Measurable Objective *\"","line":406,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":406,"endColumn":71},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"goal-objective\">Measurable Objective *</Label>","line":406,"column":49,"nodeType":"JSXText","endLine":406,"endColumn":71},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Baseline Value\"","line":418,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":418,"endColumn":64},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"goal-baseline\">Baseline Value</Label>","line":418,"column":50,"nodeType":"JSXText","endLine":418,"endColumn":64},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Target Value\"","line":427,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":427,"endColumn":60},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"goal-target\">Target Value</Label>","line":427,"column":48,"nodeType":"JSXText","endLine":427,"endColumn":60},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Target Date *\"","line":438,"column":44,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":438,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"goal-date\">Target Date *</Label>","line":438,"column":44,"nodeType":"JSXText","endLine":438,"endColumn":57},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Cancel\"","line":448,"column":72,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":450,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button variant=\"outline\" onClick={handleDialogCancel}>\n                  Cancel\n                </Button>","line":448,"column":72,"nodeType":"JSXText","endLine":450,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Create Goal\"","line":451,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":451,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button onClick={createGoal}>Create Goal</Button>","line":451,"column":46,"nodeType":"JSXText","endLine":451,"endColumn":57},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No IEP Goals Yet\"","line":492,"column":66,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":492,"endColumn":82},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-xl font-semibold text-foreground mb-2\">No IEP Goals Yet</h3>","line":492,"column":66,"nodeType":"JSXText","endLine":492,"endColumn":82},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Start by creating your first IEP goal to track\"","line":493,"column":70,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":494,"endColumn":56},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground text-center mb-6 max-w-md\">\n        Start by creating your first IEP goal to track {studentName}'s educational progress.\n      </p>","line":493,"column":70,"nodeType":"JSXText","endLine":494,"endColumn":56},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"'s educational progress.\"","line":494,"column":69,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":495,"endColumn":7},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground text-center mb-6 max-w-md\">\n        Start by creating your first IEP goal to track {studentName}'s educational progress.\n      </p>","line":494,"column":69,"nodeType":"JSXText","endLine":495,"endColumn":7},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Create First Goal\"","line":497,"column":42,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":499,"endColumn":7},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button onClick={onCreateClick} className=\"bg-gradient-primary hover:opacity-90 font-dyslexia\">\n        <Plus className=\"h-4 w-4 mr-2\" />\n        Create First Goal\n      </Button>","line":497,"column":42,"nodeType":"JSXText","endLine":499,"endColumn":7},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Update Progress\"","line":562,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":564,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button variant=\"outline\" size=\"sm\" onClick={handleUpdateProgress}>\n          <TrendingUp className=\"h-4 w-4 mr-1\" />\n          Update Progress\n        </Button>","line":562,"column":50,"nodeType":"JSXText","endLine":564,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Progress\"","line":575,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":575,"endColumn":53},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-sm font-medium\">Progress</span>","line":575,"column":45,"nodeType":"JSXText","endLine":575,"endColumn":53},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Measurable Objective\"","line":586,"column":38,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":586,"endColumn":58},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-medium mb-2\">Measurable Objective</h4>","line":586,"column":38,"nodeType":"JSXText","endLine":586,"endColumn":58},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Created:\"","line":599,"column":13,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":599,"endColumn":22},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Created: {format(goal.createdDate, 'MMM dd, yyyy')}</span>","line":599,"column":13,"nodeType":"JSXText","endLine":599,"endColumn":22},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Target:\"","line":603,"column":13,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":603,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Target: {format(goal.targetDate, 'MMM dd, yyyy')}</span>","line":603,"column":13,"nodeType":"JSXText","endLine":603,"endColumn":21},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Milestones\"","line":626,"column":37,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":626,"endColumn":47},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-medium\">Milestones</h4>","line":626,"column":37,"nodeType":"JSXText","endLine":626,"endColumn":47},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Add\"","line":628,"column":44,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":630,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button variant=\"outline\" size=\"sm\" onClick={onAdd}>\n          <Plus className=\"h-3 w-3 mr-1\" />\n          Add\n        </Button>","line":628,"column":44,"nodeType":"JSXText","endLine":630,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No milestones yet\"","line":633,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":633,"endColumn":71},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground\">No milestones yet</p>","line":633,"column":54,"nodeType":"JSXText","endLine":633,"endColumn":71}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":76,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * @fileoverview OptimizedGoalManager - Performance-optimized goal management component\n * \n * Key optimizations:\n * - All event handlers are memoized with useCallback\n * - No inline functions in JSX\n * - Component wrapped with React.memo\n * - List items use stable keys (not array indices)\n * - Expensive operations are memoized\n * \n * @module components/optimized/OptimizedGoalManager\n */\n\nimport { useState, useEffect, useCallback, useMemo, memo } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogDescription } from \"@/components/ui/dialog\";\nimport { Goal, Student, GoalDataPoint, Milestone } from \"@/types/student\";\nimport { dataStorage } from \"@/lib/dataStorage\";\nimport { Calendar, Plus, Crosshair, TrendingUp, CheckCircle, Edit, Trash2, Calendar as CalendarIcon } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { format } from \"date-fns\";\nimport { logger } from \"@/lib/logger\";\n\ninterface OptimizedGoalManagerProps {\n  student: Student;\n  onGoalUpdate?: () => void;\n}\n\n/**\n * Generate a unique ID using crypto.randomUUID or fallback\n */\nconst generateId = (): string => {\n  if (typeof crypto !== 'undefined' && crypto.randomUUID) {\n    return crypto.randomUUID();\n  }\n  const timestamp = Date.now().toString(36);\n  const randomPart = Math.random().toString(36).substring(2, 11);\n  const randomPart2 = Math.random().toString(36).substring(2, 11);\n  return `${timestamp}-${randomPart}-${randomPart2}`;\n};\n\n/**\n * Get icon for goal category\n */\nconst getCategoryIcon = (category: Goal['category']): string => {\n  const icons: Record<Goal['category'], string> = {\n    behavioral: '🎯',\n    academic: '📚',\n    social: '👥',\n    communication: '💬',\n    motor: '🏃',\n    sensory: '👁️',\n    cognitive: '🧠',\n    emotional: '❤️',\n    selfCare: '🧘',\n    vocational: '💼'\n  };\n  return icons[category] || '🎯';\n};\n\n/**\n * Get status color for goal\n */\nconst getStatusColor = (status: Goal['status']): string => {\n  const colors: Record<Goal['status'], string> = {\n    active: 'bg-green-500',\n    paused: 'bg-yellow-500',\n    completed: 'bg-blue-500',\n    archived: 'bg-gray-500'\n  };\n  return colors[status] || 'bg-gray-500';\n};\n\n/**\n * OptimizedGoalManager Component\n */\nexport const OptimizedGoalManager = memo(({ \n  student, \n  onGoalUpdate \n}: OptimizedGoalManagerProps) => {\n  const [goals, setGoals] = useState<Goal[]>([]);\n  const [showCreateDialog, setShowCreateDialog] = useState(false);\n  const [editingGoal, setEditingGoal] = useState<Goal | null>(null);\n  const [newGoal, setNewGoal] = useState({\n    title: \"\",\n    description: \"\",\n    category: \"behavioral\" as Goal['category'],\n    measurableObjective: \"\",\n    targetDate: \"\",\n    targetValue: 100,\n    baselineValue: 0\n  });\n\n  // Memoized goal loading function\n  const loadGoals = useCallback(() => {\n    const allGoals = dataStorage.getGoals();\n    const studentGoals = allGoals.filter(goal => goal.studentId === student.id);\n    setGoals(studentGoals);\n  }, [student.id]);\n\n  // Load goals on mount and when student changes\n  useEffect(() => {\n    loadGoals();\n  }, [loadGoals]);\n\n  // Memoized form reset\n  const resetForm = useCallback(() => {\n    setNewGoal({\n      title: \"\",\n      description: \"\",\n      category: \"behavioral\",\n      measurableObjective: \"\",\n      targetDate: \"\",\n      targetValue: 100,\n      baselineValue: 0\n    });\n  }, []);\n\n  // Memoized goal creation handler\n  const createGoal = useCallback(() => {\n    if (!newGoal.title.trim() || !newGoal.description.trim() || !newGoal.measurableObjective.trim()) {\n      toast.error(\"Please fill in all required fields\");\n      return;\n    }\n\n    if (!newGoal.targetDate) {\n      toast.error(\"Please select a target date\");\n      return;\n    }\n\n    const targetDate = new Date(newGoal.targetDate);\n    if (isNaN(targetDate.getTime())) {\n      toast.error(\"Invalid target date\");\n      return;\n    }\n\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    if (targetDate < today) {\n      toast.error(\"Target date must be in the future\");\n      return;\n    }\n\n    if (newGoal.targetValue <= newGoal.baselineValue) {\n      toast.error(\"Target value must be greater than baseline value\");\n      return;\n    }\n\n    const goal: Goal = {\n      id: generateId(),\n      studentId: student.id,\n      title: newGoal.title,\n      description: newGoal.description,\n      category: newGoal.category,\n      targetDate,\n      createdDate: new Date(),\n      status: \"active\",\n      measurableObjective: newGoal.measurableObjective,\n      currentProgress: 0,\n      milestones: [],\n      interventions: [],\n      baselineValue: newGoal.baselineValue,\n      targetValue: newGoal.targetValue,\n      dataPoints: [{\n        id: generateId(),\n        timestamp: new Date(),\n        value: newGoal.baselineValue,\n        notes: \"Baseline measurement\",\n        collectedBy: \"Teacher\"\n      }]\n    };\n\n    dataStorage.saveGoal(goal);\n    loadGoals();\n    resetForm();\n    setShowCreateDialog(false);\n    toast.success(\"Goal created successfully!\");\n    onGoalUpdate?.();\n  }, [newGoal, student.id, loadGoals, resetForm, onGoalUpdate]);\n\n  // Memoized goal update handler\n  const updateGoal = useCallback((goalId: string, updates: Partial<Goal>) => {\n    const goalToUpdate = goals.find(g => g.id === goalId);\n    if (!goalToUpdate) return;\n\n    const updatedGoal = { ...goalToUpdate, ...updates };\n    dataStorage.saveGoal(updatedGoal);\n    loadGoals();\n    onGoalUpdate?.();\n  }, [goals, loadGoals, onGoalUpdate]);\n\n  // Memoized goal deletion handler\n  const deleteGoal = useCallback((goalId: string) => {\n    const goal = goals.find(g => g.id === goalId);\n    if (!goal) return;\n\n    if (window.confirm(`Are you sure you want to delete the goal \"${goal.title}\"?`)) {\n      dataStorage.deleteGoal(goalId);\n      loadGoals();\n      toast.success(\"Goal deleted successfully\");\n      onGoalUpdate?.();\n    }\n  }, [goals, loadGoals, onGoalUpdate]);\n\n  // Memoized data point addition handler\n  const addDataPoint = useCallback((goalId: string, value: number, notes?: string) => {\n    const goal = goals.find(g => g.id === goalId);\n    if (!goal) return;\n\n    const newDataPoint: GoalDataPoint = {\n      id: generateId(),\n      timestamp: new Date(),\n      value,\n      notes,\n      collectedBy: \"Teacher\"\n    };\n\n    const updatedDataPoints = [...goal.dataPoints, newDataPoint];\n    const progress = goal.targetValue \n      ? ((value - (goal.baselineValue || 0)) / (goal.targetValue - (goal.baselineValue || 0))) * 100 \n      : 0;\n    \n    updateGoal(goalId, {\n      dataPoints: updatedDataPoints,\n      currentProgress: Math.max(0, Math.min(100, progress))\n    });\n\n    toast.success(\"Progress updated!\");\n  }, [goals, updateGoal]);\n\n  // Memoized milestone addition handler\n  const addMilestone = useCallback((goalId: string, title: string, description: string, targetDate: Date) => {\n    const goal = goals.find(g => g.id === goalId);\n    if (!goal) return;\n\n    const newMilestone: Milestone = {\n      id: generateId(),\n      title,\n      description,\n      targetDate,\n      isCompleted: false\n    };\n\n    updateGoal(goalId, {\n      milestones: [...goal.milestones, newMilestone]\n    });\n\n    toast.success(\"Milestone added!\");\n  }, [goals, updateGoal]);\n\n  // Memoized milestone completion handler\n  const completeMilestone = useCallback((goalId: string, milestoneId: string) => {\n    const goal = goals.find(g => g.id === goalId);\n    if (!goal) return;\n\n    const updatedMilestones = goal.milestones.map(m =>\n      m.id === milestoneId\n        ? { ...m, isCompleted: true, completedDate: new Date() }\n        : m\n    );\n\n    updateGoal(goalId, { milestones: updatedMilestones });\n    toast.success(\"Milestone completed!\");\n  }, [goals, updateGoal]);\n\n  // Handler for milestone prompt\n  const handleAddMilestoneClick = useCallback((goalId: string) => {\n    const title = prompt(\"Milestone title:\");\n    const description = prompt(\"Milestone description:\");\n    const dateStr = prompt(\"Target date (YYYY-MM-DD):\");\n    if (title && description && dateStr) {\n      addMilestone(goalId, title, description, new Date(dateStr));\n    }\n  }, [addMilestone]);\n\n  // Handler for progress update\n  const handleUpdateProgressClick = useCallback((goalId: string) => {\n    const value = prompt(\"Enter current progress value:\");\n    const notes = prompt(\"Progress notes (optional):\");\n    if (value) {\n      addDataPoint(goalId, Number(value), notes || undefined);\n    }\n  }, [addDataPoint]);\n\n  // Handler for dialog cancel\n  const handleDialogCancel = useCallback(() => {\n    resetForm();\n    setShowCreateDialog(false);\n  }, [resetForm]);\n\n  // Memoized input handlers\n  const handleTitleChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setNewGoal(prev => ({ ...prev, title: e.target.value }));\n  }, []);\n\n  const handleDescriptionChange = useCallback((e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    setNewGoal(prev => ({ ...prev, description: e.target.value }));\n  }, []);\n\n  const handleCategoryChange = useCallback((value: string) => {\n    setNewGoal(prev => ({ ...prev, category: value as Goal['category'] }));\n  }, []);\n\n  const handleObjectiveChange = useCallback((e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    setNewGoal(prev => ({ ...prev, measurableObjective: e.target.value }));\n  }, []);\n\n  const handleBaselineChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setNewGoal(prev => ({ ...prev, baselineValue: Number(e.target.value) }));\n  }, []);\n\n  const handleTargetValueChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setNewGoal(prev => ({ ...prev, targetValue: Number(e.target.value) }));\n  }, []);\n\n  const handleTargetDateChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    setNewGoal(prev => ({ ...prev, targetDate: e.target.value }));\n  }, []);\n\n  // Memoized sorted goals\n  const sortedGoals = useMemo(() => {\n    return [...goals].sort((a, b) => {\n      // Sort by status (active first) then by created date\n      const statusOrder = { active: 0, paused: 1, completed: 2, archived: 3 };\n      const statusDiff = statusOrder[a.status] - statusOrder[b.status];\n      if (statusDiff !== 0) return statusDiff;\n      return b.createdDate.getTime() - a.createdDate.getTime();\n    });\n  }, [goals]);\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-3\">\n          <Crosshair className=\"h-6 w-6 text-primary\" />\n          <h2 className=\"text-2xl font-bold\">IEP Goals & Tracking</h2>\n        </div>\n        \n        <Dialog open={showCreateDialog} onOpenChange={setShowCreateDialog}>\n          <DialogTrigger asChild>\n            <Button className=\"bg-gradient-primary hover:opacity-90\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Create New Goal\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>Create New IEP Goal</DialogTitle>\n              <DialogDescription>\n                Define a specific, measurable goal for {student.name}'s educational progress.\n              </DialogDescription>\n            </DialogHeader>\n            \n            <div className=\"space-y-4 mt-4\">\n              <div>\n                <Label htmlFor=\"goal-title\">Goal Title *</Label>\n                <Input\n                  id=\"goal-title\"\n                  placeholder=\"e.g., Improve Reading Comprehension\"\n                  value={newGoal.title}\n                  onChange={handleTitleChange}\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"goal-description\">Description *</Label>\n                <Textarea\n                  id=\"goal-description\"\n                  placeholder=\"Describe the goal in detail...\"\n                  value={newGoal.description}\n                  onChange={handleDescriptionChange}\n                  rows={3}\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"goal-category\">Category *</Label>\n                <Select value={newGoal.category} onValueChange={handleCategoryChange}>\n                  <SelectTrigger id=\"goal-category\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"behavioral\">Behavioral</SelectItem>\n                    <SelectItem value=\"academic\">Academic</SelectItem>\n                    <SelectItem value=\"social\">Social</SelectItem>\n                    <SelectItem value=\"communication\">Communication</SelectItem>\n                    <SelectItem value=\"motor\">Motor Skills</SelectItem>\n                    <SelectItem value=\"sensory\">Sensory</SelectItem>\n                    <SelectItem value=\"cognitive\">Cognitive</SelectItem>\n                    <SelectItem value=\"emotional\">Emotional</SelectItem>\n                    <SelectItem value=\"selfCare\">Self-Care</SelectItem>\n                    <SelectItem value=\"vocational\">Vocational</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              \n              <div>\n                <Label htmlFor=\"goal-objective\">Measurable Objective *</Label>\n                <Textarea\n                  id=\"goal-objective\"\n                  placeholder=\"e.g., Student will read grade-level text with 80% comprehension...\"\n                  value={newGoal.measurableObjective}\n                  onChange={handleObjectiveChange}\n                  rows={3}\n                />\n              </div>\n              \n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"goal-baseline\">Baseline Value</Label>\n                  <Input\n                    id=\"goal-baseline\"\n                    type=\"number\"\n                    value={newGoal.baselineValue}\n                    onChange={handleBaselineChange}\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"goal-target\">Target Value</Label>\n                  <Input\n                    id=\"goal-target\"\n                    type=\"number\"\n                    value={newGoal.targetValue}\n                    onChange={handleTargetValueChange}\n                  />\n                </div>\n              </div>\n              \n              <div>\n                <Label htmlFor=\"goal-date\">Target Date *</Label>\n                <Input\n                  id=\"goal-date\"\n                  type=\"date\"\n                  value={newGoal.targetDate}\n                  onChange={handleTargetDateChange}\n                />\n              </div>\n              \n              <div className=\"flex gap-2 justify-end\">\n                <Button variant=\"outline\" onClick={handleDialogCancel}>\n                  Cancel\n                </Button>\n                <Button onClick={createGoal}>Create Goal</Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Goals List */}\n      {sortedGoals.length === 0 ? (\n        <EmptyState studentName={student.name} onCreateClick={() => setShowCreateDialog(true)} />\n      ) : (\n        <div className=\"grid gap-6\">\n          {sortedGoals.map((goal) => (\n            <GoalCard\n              key={goal.id}\n              goal={goal}\n              onDelete={deleteGoal}\n              onAddMilestone={handleAddMilestoneClick}\n              onUpdateProgress={handleUpdateProgressClick}\n              onCompleteMilestone={completeMilestone}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n});\n\nOptimizedGoalManager.displayName = 'OptimizedGoalManager';\n\n// Memoized sub-components\nconst EmptyState = memo(({ \n  studentName, \n  onCreateClick \n}: { \n  studentName: string; \n  onCreateClick: () => void;\n}) => (\n  <Card className=\"bg-gradient-card border-0 shadow-soft\">\n    <CardContent className=\"flex flex-col items-center justify-center py-16\">\n      <Crosshair className=\"h-16 w-16 text-muted-foreground mb-4\" />\n      <h3 className=\"text-xl font-semibold text-foreground mb-2\">No IEP Goals Yet</h3>\n      <p className=\"text-muted-foreground text-center mb-6 max-w-md\">\n        Start by creating your first IEP goal to track {studentName}'s educational progress.\n      </p>\n      <Button onClick={onCreateClick} className=\"bg-gradient-primary hover:opacity-90 font-dyslexia\">\n        <Plus className=\"h-4 w-4 mr-2\" />\n        Create First Goal\n      </Button>\n    </CardContent>\n  </Card>\n));\n\nEmptyState.displayName = 'EmptyState';\n\nconst GoalCard = memo(({\n  goal,\n  onDelete,\n  onAddMilestone,\n  onUpdateProgress,\n  onCompleteMilestone\n}: {\n  goal: Goal;\n  onDelete: (id: string) => void;\n  onAddMilestone: (id: string) => void;\n  onUpdateProgress: (id: string) => void;\n  onCompleteMilestone: (goalId: string, milestoneId: string) => void;\n}) => {\n  const handleDelete = useCallback(() => onDelete(goal.id), [goal.id, onDelete]);\n  const handleAddMilestone = useCallback(() => onAddMilestone(goal.id), [goal.id, onAddMilestone]);\n  const handleUpdateProgress = useCallback(() => onUpdateProgress(goal.id), [goal.id, onUpdateProgress]);\n\n  return (\n    <Card className=\"bg-gradient-card border-0 shadow-soft\">\n      <CardHeader>\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex items-start gap-3\">\n            <span className=\"text-2xl\">{getCategoryIcon(goal.category)}</span>\n            <div>\n              <CardTitle className=\"flex items-center gap-2\">\n                {goal.title}\n                <Badge variant=\"outline\" className={`${getStatusColor(goal.status)} text-white border-0`}>\n                  {goal.status}\n                </Badge>\n              </CardTitle>\n              <p className=\"text-muted-foreground mt-1\">{goal.description}</p>\n              <Badge variant=\"secondary\" className=\"mt-2\">\n                {goal.category}\n              </Badge>\n            </div>\n          </div>\n          <div className=\"flex gap-2\">\n            <Button variant=\"ghost\" size=\"icon\" aria-label=\"Edit goal\" title=\"Edit goal\">\n              <Edit className=\"h-4 w-4\" />\n            </Button>\n            <Button variant=\"ghost\" size=\"icon\" aria-label=\"Delete goal\" title=\"Delete goal\" onClick={handleDelete}>\n              <Trash2 className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <GoalProgress goal={goal} />\n        <GoalObjective objective={goal.measurableObjective} />\n        <GoalTimeline goal={goal} />\n        <GoalMilestones \n          goal={goal} \n          onAdd={handleAddMilestone}\n          onComplete={onCompleteMilestone}\n        />\n        <Button variant=\"outline\" size=\"sm\" onClick={handleUpdateProgress}>\n          <TrendingUp className=\"h-4 w-4 mr-1\" />\n          Update Progress\n        </Button>\n      </CardContent>\n    </Card>\n  );\n});\n\nGoalCard.displayName = 'GoalCard';\n\nconst GoalProgress = memo(({ goal }: { goal: Goal }) => (\n  <div className=\"mb-6\">\n    <div className=\"flex items-center justify-between mb-2\">\n      <span className=\"text-sm font-medium\">Progress</span>\n      <span className=\"text-sm text-muted-foreground\">{Math.round(goal.currentProgress)}%</span>\n    </div>\n    <Progress value={goal.currentProgress} className=\"h-3\" />\n  </div>\n));\n\nGoalProgress.displayName = 'GoalProgress';\n\nconst GoalObjective = memo(({ objective }: { objective: string }) => (\n  <div className=\"mb-4\">\n    <h4 className=\"font-medium mb-2\">Measurable Objective</h4>\n    <p className=\"text-sm text-muted-foreground bg-muted/50 p-3 rounded-lg\">\n      {objective}\n    </p>\n  </div>\n));\n\nGoalObjective.displayName = 'GoalObjective';\n\nconst GoalTimeline = memo(({ goal }: { goal: Goal }) => (\n  <div className=\"flex items-center gap-4 mb-4\">\n    <div className=\"flex items-center gap-2 text-sm\">\n      <CalendarIcon className=\"h-4 w-4 text-muted-foreground\" />\n      <span>Created: {format(goal.createdDate, 'MMM dd, yyyy')}</span>\n    </div>\n    <div className=\"flex items-center gap-2 text-sm\">\n      <Crosshair className=\"h-4 w-4 text-muted-foreground\" />\n      <span>Target: {format(goal.targetDate, 'MMM dd, yyyy')}</span>\n    </div>\n  </div>\n));\n\nGoalTimeline.displayName = 'GoalTimeline';\n\nconst GoalMilestones = memo(({\n  goal,\n  onAdd,\n  onComplete\n}: {\n  goal: Goal;\n  onAdd: () => void;\n  onComplete: (goalId: string, milestoneId: string) => void;\n}) => {\n  const handleComplete = useCallback((milestoneId: string) => {\n    onComplete(goal.id, milestoneId);\n  }, [goal.id, onComplete]);\n\n  return (\n    <div className=\"mb-4\">\n      <div className=\"flex items-center justify-between mb-2\">\n        <h4 className=\"font-medium\">Milestones</h4>\n        <Button variant=\"outline\" size=\"sm\" onClick={onAdd}>\n          <Plus className=\"h-3 w-3 mr-1\" />\n          Add\n        </Button>\n      </div>\n      {goal.milestones.length === 0 ? (\n        <p className=\"text-sm text-muted-foreground\">No milestones yet</p>\n      ) : (\n        <div className=\"space-y-2\">\n          {goal.milestones.map((milestone) => (\n            <MilestoneItem\n              key={milestone.id}\n              milestone={milestone}\n              onComplete={handleComplete}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n});\n\nGoalMilestones.displayName = 'GoalMilestones';\n\nconst MilestoneItem = memo(({\n  milestone,\n  onComplete\n}: {\n  milestone: Milestone;\n  onComplete: (id: string) => void;\n}) => {\n  const handleClick = useCallback(() => {\n    if (!milestone.isCompleted) {\n      onComplete(milestone.id);\n    }\n  }, [milestone.isCompleted, milestone.id, onComplete]);\n\n  return (\n    <div className=\"flex items-center gap-2 p-2 bg-muted/30 rounded\">\n      <Button\n        variant=\"ghost\"\n        size=\"icon\"\n        aria-label={milestone.isCompleted ? 'Milestone completed' : 'Mark milestone complete'}\n        title={milestone.isCompleted ? 'Milestone completed' : 'Mark milestone complete'}\n        onClick={handleClick}\n        disabled={milestone.isCompleted}\n      >\n        <CheckCircle className={`h-4 w-4 ${milestone.isCompleted ? 'text-green-500' : 'text-muted-foreground'}`} />\n      </Button>\n      <div className=\"flex-1\">\n        <p className={`text-sm ${milestone.isCompleted ? 'line-through text-muted-foreground' : ''}`}>\n          {milestone.title}\n        </p>\n        <p className=\"text-xs text-muted-foreground\">{milestone.description}</p>\n      </div>\n      <span className=\"text-xs text-muted-foreground\">\n        {format(milestone.targetDate, 'MMM dd')}\n      </span>\n    </div>\n  );\n});\n\nMilestoneItem.displayName = 'MilestoneItem';\n\nexport default OptimizedGoalManager;\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/optimized/OptimizedStudentCard.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Grade\"","line":36,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":36,"endColumn":66},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground\">Grade {student.grade}</p>","line":36,"column":60,"nodeType":"JSXText","endLine":36,"endColumn":66},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"View Profile\"","line":48,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":50,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n            variant=\"default\"\n            size=\"sm\"\n            onClick={() => onView(student)}\n            className=\"flex-1\"\n          >\n            <User className=\"h-4 w-4 mr-2\" />\n            View Profile\n          </Button>","line":48,"column":46,"nodeType":"JSXText","endLine":50,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Track\"","line":57,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":59,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => onTrack(student)}\n            className=\"flex-1\"\n          >\n            <Activity className=\"h-4 w-4 mr-2\" />\n            Track\n          </Button>","line":57,"column":50,"nodeType":"JSXText","endLine":59,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { memo } from 'react';\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { User, Activity } from \"lucide-react\";\nimport { Student } from \"@/types/student\";\n\ninterface StudentCardProps {\n  student: Student;\n  onView: (student: Student) => void;\n  onTrack: (student: Student) => void;\n}\n\n/**\n * Optimized StudentCard component with React.memo to prevent unnecessary re-renders\n * Only re-renders when student prop or callbacks change\n */\nexport const OptimizedStudentCard = memo(({ student, onView, onTrack }: StudentCardProps) => {\n  const getInitials = (name: string) => {\n    return name\n      .split(' ')\n      .map(n => n[0])\n      .join('')\n      .toUpperCase();\n  };\n\n  return (\n    <Card className=\"overflow-hidden hover:shadow-lg transition-shadow duration-200\">\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-start justify-between mb-4\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center\">\n              <span className=\"text-primary font-semibold\">{getInitials(student.name)}</span>\n            </div>\n            <div>\n              <h3 className=\"font-semibold text-foreground\">{student.name}</h3>\n              <p className=\"text-sm text-muted-foreground\">Grade {student.grade}</p>\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"flex gap-2\">\n          <Button\n            variant=\"default\"\n            size=\"sm\"\n            onClick={() => onView(student)}\n            className=\"flex-1\"\n          >\n            <User className=\"h-4 w-4 mr-2\" />\n            View Profile\n          </Button>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => onTrack(student)}\n            className=\"flex-1\"\n          >\n            <Activity className=\"h-4 w-4 mr-2\" />\n            Track\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}, (prevProps, nextProps) => {\n  // Custom comparison function for better performance\n  // Only re-render if student data actually changed\n  return (\n    prevProps.student.id === nextProps.student.id &&\n    prevProps.student.name === nextProps.student.name &&\n    prevProps.student.grade === nextProps.student.grade &&\n    prevProps.onView === nextProps.onView &&\n    prevProps.onTrack === nextProps.onTrack\n  );\n});\n\nOptimizedStudentCard.displayName = 'OptimizedStudentCard';","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/optimized/OptimizedStudentList.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":30},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No students found\"","line":41,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":41,"endColumn":63},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">No students found</p>","line":41,"column":46,"nodeType":"JSXText","endLine":41,"endColumn":63}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { memo, useMemo, useCallback } from 'react';\nimport { VirtualScrollArea } from './VirtualScrollArea';\nimport { PremiumStudentCard } from '../ui/PremiumStudentCard';\nimport { Student } from '@/types/student';\n\ninterface OptimizedStudentListProps {\n  students: Student[];\n  onViewStudent: (studentId: string) => void;\n  onTrackStudent: (studentId: string) => void;\n  onDeleteStudent: (studentId: string) => void;\n  containerHeight?: number;\n  itemHeight?: number;\n}\n\nconst StudentCardMemo = memo(PremiumStudentCard);\n\nexport const OptimizedStudentList: React.FC<OptimizedStudentListProps> = memo(({\n  students,\n  onViewStudent,\n  onTrackStudent,\n  onDeleteStudent,\n  containerHeight = 600,\n  itemHeight = 180\n}) => {\n  const renderStudent = useCallback(\n    (student: Student, index: number) => (\n      <StudentCardMemo\n        key={student.id}\n        student={student}\n        index={index}\n        onView={() => onViewStudent(student.id)}\n        onTrack={() => onTrackStudent(student.id)}\n        onDelete={() => onDeleteStudent(student.id)}\n      />\n    ), [onViewStudent, onTrackStudent, onDeleteStudent]\n  );\n\n  if (students.length === 0) {\n    return (\n      <div className=\"text-center py-12\">\n        <p className=\"text-muted-foreground\">No students found</p>\n      </div>\n    );\n  }\n\n  // Use virtual scrolling for large lists\n  if (students.length > 20) {\n    return (\n      <VirtualScrollArea\n        items={students}\n        itemHeight={itemHeight}\n        containerHeight={containerHeight}\n        renderItem={renderStudent}\n        className=\"w-full\"\n        overscan={8} // Increased overscan for smoother scrolling with larger student cards\n      />\n    );\n  }\n\n  // For smaller lists, render directly\n  return (\n    <div className=\"space-y-4\">\n      {students.map((student, index) => renderStudent(student, index))}\n    </div>\n  );\n});","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/optimized/OptimizedVisualization3D.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'lazy' is defined but never used. Allowed unused vars must match /^_/u.","line":14,"column":73,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":77},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Eye' is defined but never used. Allowed unused vars must match /^_/u.","line":23,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ZoomIn' is defined but never used. Allowed unused vars must match /^_/u.","line":23,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ZoomOut' is defined but never used. Allowed unused vars must match /^_/u.","line":23,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":41},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"×\"","line":71,"column":12,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":73,"endColumn":11},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4114,4117],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4114,4117],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4259,4262],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4259,4262],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'correlationData' is defined but never used. Allowed unused args must match /^_/u.","line":326,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":326,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handlePointClick' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":389,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":389,"endColumn":25},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"3D Data Visualization\"","line":416,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":418,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n          <Move3d className=\"h-5 w-5\" />\n          3D Data Visualization\n        </CardTitle>","line":416,"column":41,"nodeType":"JSXText","endLine":418,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"X Axis\"","line":428,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":430,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label\n              id={xAxisLabelId}\n              className=\"text-sm font-medium mb-1 block\"\n              htmlFor={xAxisTriggerId}\n            >\n              X Axis\n            </label>","line":428,"column":14,"nodeType":"JSXText","endLine":430,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotion Intensity\"","line":436,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":436,"endColumn":71},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"emotionIntensity\">Emotion Intensity</SelectItem>","line":436,"column":54,"nodeType":"JSXText","endLine":436,"endColumn":71},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory Response\"","line":437,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":437,"endColumn":69},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"sensoryResponse\">Sensory Response</SelectItem>","line":437,"column":53,"nodeType":"JSXText","endLine":437,"endColumn":69},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Time\"","line":438,"column":42,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":438,"endColumn":46},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"time\">Time</SelectItem>","line":438,"column":42,"nodeType":"JSXText","endLine":438,"endColumn":46},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Y Axis\"","line":448,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":450,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label\n              id={yAxisLabelId}\n              className=\"text-sm font-medium mb-1 block\"\n              htmlFor={yAxisTriggerId}\n            >\n              Y Axis\n            </label>","line":448,"column":14,"nodeType":"JSXText","endLine":450,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotion Intensity\"","line":456,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":456,"endColumn":71},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"emotionIntensity\">Emotion Intensity</SelectItem>","line":456,"column":54,"nodeType":"JSXText","endLine":456,"endColumn":71},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory Response\"","line":457,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":457,"endColumn":69},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"sensoryResponse\">Sensory Response</SelectItem>","line":457,"column":53,"nodeType":"JSXText","endLine":457,"endColumn":69},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Time\"","line":458,"column":42,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":458,"endColumn":46},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"time\">Time</SelectItem>","line":458,"column":42,"nodeType":"JSXText","endLine":458,"endColumn":46},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Z Axis\"","line":468,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":470,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label\n              id={zAxisLabelId}\n              className=\"text-sm font-medium mb-1 block\"\n              htmlFor={zAxisTriggerId}\n            >\n              Z Axis\n            </label>","line":468,"column":14,"nodeType":"JSXText","endLine":470,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotion Intensity\"","line":476,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":476,"endColumn":71},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"emotionIntensity\">Emotion Intensity</SelectItem>","line":476,"column":54,"nodeType":"JSXText","endLine":476,"endColumn":71},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory Response\"","line":477,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":477,"endColumn":69},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"sensoryResponse\">Sensory Response</SelectItem>","line":477,"column":53,"nodeType":"JSXText","endLine":477,"endColumn":69},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Time\"","line":478,"column":42,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":478,"endColumn":46},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"time\">Time</SelectItem>","line":478,"column":42,"nodeType":"JSXText","endLine":478,"endColumn":46},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Color By\"","line":488,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":490,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label\n              id={colorByLabelId}\n              className=\"text-sm font-medium mb-1 block\"\n              htmlFor={colorByTriggerId}\n            >\n              Color By\n            </label>","line":488,"column":14,"nodeType":"JSXText","endLine":490,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Category\"","line":496,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":496,"endColumn":54},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"category\">Category</SelectItem>","line":496,"column":46,"nodeType":"JSXText","endLine":496,"endColumn":54},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Intensity\"","line":497,"column":47,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":497,"endColumn":56},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"intensity\">Intensity</SelectItem>","line":497,"column":47,"nodeType":"JSXText","endLine":497,"endColumn":56},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Point Size\"","line":505,"column":81,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":505,"endColumn":91},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p id={pointSizeLabelId} className=\"text-sm font-medium mb-1 block\">Point Size</p>","line":505,"column":81,"nodeType":"JSXText","endLine":505,"endColumn":91},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Filter\"","line":522,"column":14,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":524,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label\n              id={filterLabelId}\n              className=\"text-sm font-medium mb-1 block\"\n              htmlFor={filterTriggerId}\n            >\n              Filter\n            </label>","line":522,"column":14,"nodeType":"JSXText","endLine":524,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"All Categories\"","line":530,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":530,"endColumn":55},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"all\">All Categories</SelectItem>","line":530,"column":41,"nodeType":"JSXText","endLine":530,"endColumn":55},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotions\"","line":531,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":531,"endColumn":53},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"emotion\">Emotions</SelectItem>","line":531,"column":45,"nodeType":"JSXText","endLine":531,"endColumn":53},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory\"","line":532,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":532,"endColumn":52},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"sensory\">Sensory</SelectItem>","line":532,"column":45,"nodeType":"JSXText","endLine":532,"endColumn":52},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Environmental\"","line":533,"column":51,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":533,"endColumn":64},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"environmental\">Environmental</SelectItem>","line":533,"column":51,"nodeType":"JSXText","endLine":533,"endColumn":64},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"data points\"","line":593,"column":40,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":593,"endColumn":52},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>{filteredPoints.length} data points</span>","line":593,"column":40,"nodeType":"JSXText","endLine":593,"endColumn":52},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Hovering:\"","line":595,"column":19,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":595,"endColumn":29},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Hovering: {hoveredPoint.label}</span>","line":595,"column":19,"nodeType":"JSXText","endLine":595,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":57,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * @fileoverview OptimizedVisualization3D - Performance-optimized 3D visualization\n * \n * Key optimizations:\n * - Component split into smaller, memoized sub-components\n * - Data processing optimized with better algorithms\n * - Expensive calculations memoized\n * - Canvas rendering optimized\n * - Lazy loading for Three.js components\n * \n * @module components/optimized/OptimizedVisualization3D\n */\n\nimport React, { useRef, useState, useMemo, useCallback, memo, Suspense, lazy } from 'react';\nimport { Canvas, useFrame, useThree } from '@react-three/fiber';\nimport { OrbitControls, Text, Html } from '@react-three/drei';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { EmotionEntry, SensoryEntry, TrackingEntry } from '@/types/student';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Slider } from '@/components/ui/slider';\nimport { Eye, RotateCcw, ZoomIn, ZoomOut, Move3d } from 'lucide-react';\nimport * as THREE from 'three';\nimport { colorForeground } from '@/lib/resolveCssColorVar';\nimport { useReducedMotion } from '@/hooks/useReducedMotion';\nimport { useTranslation } from '@/hooks/useTranslation';\n\ninterface Visualization3DProps {\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  trackingEntries: TrackingEntry[];\n  correlationData?: {\n    x: string;\n    y: string;\n    z: string;\n    correlation: number;\n  }[];\n}\n\ninterface DataPoint3D {\n  id: string;\n  x: number;\n  y: number;\n  z: number;\n  label: string;\n  category: 'emotion' | 'sensory' | 'environmental';\n  intensity?: number;\n  timestamp: Date;\n  metadata: Record<string, string | number>;\n  normalizedX?: number;\n  normalizedY?: number;\n  normalizedZ?: number;\n  color?: string;\n}\n\n// Memoized tooltip component\nconst Tooltip3D = memo<{ point: DataPoint3D; onClose: () => void }>(({ point, onClose }) => {\n  const { tAnalytics } = useTranslation();\n  \n  return (\n    <Html>\n      <div className=\"bg-background border rounded-lg shadow-lg p-3 min-w-[200px]\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <Badge variant=\"outline\" className=\"capitalize\">\n            {point.category}\n          </Badge>\n          <button \n            onClick={onClose}\n            className=\"text-muted-foreground hover:text-foreground transition-colors motion-reduce:transition-none\"\n          >\n            ×\n          </button>\n        </div>\n        <p className=\"font-medium\">{point.label}</p>\n        <div className=\"text-sm text-muted-foreground mt-1 space-y-1\">\n          <p>{tAnalytics('visualization3d.tooltip.xAxis')}: {point.x.toFixed(2)}</p>\n          <p>{tAnalytics('visualization3d.tooltip.yAxis')}: {point.y.toFixed(2)}</p>\n          <p>{tAnalytics('visualization3d.tooltip.zAxis')}: {point.z.toFixed(2)}</p>\n          {point.intensity && <p>{tAnalytics('visualization3d.tooltip.intensity')}: {point.intensity}</p>}\n        </div>\n      </div>\n    </Html>\n  );\n});\n\nTooltip3D.displayName = 'Tooltip3D';\n\n// Optimized data point component\nconst DataPoint = memo<{\n  position: [number, number, number];\n  color: string;\n  size: number;\n  point: DataPoint3D;\n  onHover: (point: DataPoint3D | null) => void;\n  isHighlighted: boolean;\n  reducedMotion?: boolean;\n}>(({ position, color, size, point, onHover, isHighlighted, reducedMotion = false }) => {\n  const meshRef = useRef<THREE.Mesh>(null);\n  const [hovered, setHovered] = useState(false);\n  \n  // Memoized scale calculation\n  const targetScale = useMemo(() => {\n    return hovered || isHighlighted ? 1.5 : 1;\n  }, [hovered, isHighlighted]);\n\n  useFrame(() => {\n    if (meshRef.current) {\n      if (reducedMotion) {\n        meshRef.current.scale.set(targetScale, targetScale, targetScale);\n      } else {\n        meshRef.current.scale.lerp(new THREE.Vector3(targetScale, targetScale, targetScale), 0.1);\n        if (hovered) {\n          meshRef.current.rotation.y += 0.02;\n        }\n      }\n    }\n  });\n\n  const handlePointerOver = useCallback((e: any) => {\n    e.stopPropagation();\n    setHovered(true);\n    onHover(point);\n  }, [point, onHover]);\n\n  const handlePointerOut = useCallback((e: any) => {\n    e.stopPropagation();\n    setHovered(false);\n    onHover(null);\n  }, [onHover]);\n\n  return (\n    <mesh\n      ref={meshRef}\n      position={position}\n      onPointerOver={handlePointerOver}\n      onPointerOut={handlePointerOut}\n    >\n      <sphereGeometry args={[size, 16, 8]} />\n      <meshStandardMaterial \n        color={color} \n        emissive={color} \n        emissiveIntensity={hovered || isHighlighted ? 0.5 : 0.2}\n        metalness={0.3}\n        roughness={0.4}\n      />\n    </mesh>\n  );\n});\n\nDataPoint.displayName = 'DataPoint';\n\n// Memoized axis labels component\nconst AxisLabels = memo<{ xLabel: string; yLabel: string; zLabel: string }>(({ \n  xLabel, \n  yLabel, \n  zLabel \n}) => {\n  const size = 5;\n  const foregroundColor = useMemo(() => colorForeground(), []);\n  \n  return (\n    <>\n      {/* X Axis */}\n      <Text position={[size + 0.5, 0, 0]} fontSize={0.5} color={foregroundColor} anchorX=\"left\">\n        {xLabel}\n      </Text>\n      <mesh position={[size / 2, 0, 0]} rotation={[0, 0, Math.PI / 2]}>\n        <boxGeometry args={[0.02, size, 0.02]} />\n        <meshBasicMaterial color=\"#ff0000\" />\n      </mesh>\n\n      {/* Y Axis */}\n      <Text position={[0, size + 0.5, 0]} fontSize={0.5} color={foregroundColor} anchorX=\"center\">\n        {yLabel}\n      </Text>\n      <mesh position={[0, size / 2, 0]}>\n        <boxGeometry args={[0.02, size, 0.02]} />\n        <meshBasicMaterial color=\"#00ff00\" />\n      </mesh>\n\n      {/* Z Axis */}\n      <Text position={[0, 0, size + 0.5]} fontSize={0.5} color={foregroundColor} anchorX=\"center\">\n        {zLabel}\n      </Text>\n      <mesh position={[0, 0, size / 2]} rotation={[Math.PI / 2, 0, 0]}>\n        <boxGeometry args={[0.02, size, 0.02]} />\n        <meshBasicMaterial color=\"#0000ff\" />\n      </mesh>\n    </>\n  );\n});\n\nAxisLabels.displayName = 'AxisLabels';\n\n// Camera controls component\nconst CameraControls = memo<{ onReset: () => void }>(({ onReset }) => {\n  const { camera } = useThree();\n  \n  const handleReset = useCallback(() => {\n    camera.position.set(10, 10, 10);\n    camera.lookAt(0, 0, 0);\n    onReset();\n  }, [camera, onReset]);\n\n  return (\n    <Html fullscreen>\n      <div className=\"absolute bottom-4 right-4 flex flex-col gap-2 pointer-events-auto\">\n        <Button size=\"sm\" variant=\"outline\" onClick={handleReset}>\n          <RotateCcw className=\"h-4 w-4\" />\n        </Button>\n      </div>\n    </Html>\n  );\n});\n\nCameraControls.displayName = 'CameraControls';\n\n// Optimized data processing function\nconst processDataPoints = (\n  emotions: EmotionEntry[],\n  sensoryInputs: SensoryEntry[],\n  trackingEntries: TrackingEntry[],\n  xAxis: string,\n  yAxis: string,\n  zAxis: string\n): DataPoint3D[] => {\n  // Create lookup maps for faster access\n  const emotionsByTime = new Map<number, EmotionEntry[]>();\n  const sensoryByTime = new Map<number, SensoryEntry[]>();\n  \n  // Group data by hour buckets for efficiency\n  const hourBucket = 3600000; // 1 hour in ms\n  \n  emotions.forEach(e => {\n    const bucket = Math.floor(e.timestamp.getTime() / hourBucket);\n    if (!emotionsByTime.has(bucket)) {\n      emotionsByTime.set(bucket, []);\n    }\n    emotionsByTime.get(bucket)!.push(e);\n  });\n  \n  sensoryInputs.forEach(s => {\n    const bucket = Math.floor(s.timestamp.getTime() / hourBucket);\n    if (!sensoryByTime.has(bucket)) {\n      sensoryByTime.set(bucket, []);\n    }\n    sensoryByTime.get(bucket)!.push(s);\n  });\n\n  // Process tracking entries\n  const points: DataPoint3D[] = trackingEntries.map(entry => {\n    const bucket = Math.floor(entry.timestamp.getTime() / hourBucket);\n    const relatedEmotions = emotionsByTime.get(bucket) || [];\n    const relatedSensory = sensoryByTime.get(bucket) || [];\n    \n    const avgEmotionIntensity = relatedEmotions.length > 0\n      ? relatedEmotions.reduce((sum, e) => sum + e.intensity, 0) / relatedEmotions.length\n      : 5;\n    \n    const sensorySeeking = relatedSensory.filter(s => s.response.includes('seeking')).length;\n    const sensoryAvoiding = relatedSensory.filter(s => s.response.includes('avoiding')).length;\n    const sensoryScore = sensorySeeking - sensoryAvoiding;\n    \n    const timeValue = entry.timestamp.getTime() / 1000 / 3600; // Convert to hours\n    \n    const getAxisValue = (axis: string) => {\n      switch (axis) {\n        case 'emotionIntensity': return avgEmotionIntensity;\n        case 'sensoryResponse': return sensoryScore;\n        case 'time': return timeValue;\n        default: return 0;\n      }\n    };\n    \n    return {\n      id: `tracking-${entry.timestamp.toISOString()}`,\n      x: getAxisValue(xAxis),\n      y: getAxisValue(yAxis),\n      z: getAxisValue(zAxis),\n      label: `Session ${entry.timestamp.toLocaleDateString()}`,\n      category: 'environmental' as const,\n      intensity: avgEmotionIntensity,\n      timestamp: entry.timestamp,\n      metadata: {\n        emotions: relatedEmotions.length,\n        sensory: relatedSensory.length,\n        avgIntensity: avgEmotionIntensity,\n        sensoryScore\n      }\n    };\n  });\n\n  // Normalize coordinates efficiently\n  if (points.length > 0) {\n    const xValues = points.map(p => p.x);\n    const yValues = points.map(p => p.y);\n    const zValues = points.map(p => p.z);\n    \n    const normalize = (values: number[]) => {\n      const min = Math.min(...values);\n      const max = Math.max(...values);\n      const range = max - min || 1;\n      return values.map(v => ((v - min) / range) * 10 - 5);\n    };\n    \n    const normalizedX = normalize(xValues);\n    const normalizedY = normalize(yValues);\n    const normalizedZ = normalize(zValues);\n    \n    points.forEach((point, i) => {\n      point.normalizedX = normalizedX[i];\n      point.normalizedY = normalizedY[i];\n      point.normalizedZ = normalizedZ[i];\n    });\n  }\n\n  return points;\n};\n\n// Main optimized component\nexport const OptimizedVisualization3D = memo<Visualization3DProps>(({\n  emotions,\n  sensoryInputs,\n  trackingEntries,\n  correlationData\n}) => {\n  const prefersReducedMotion = useReducedMotion();\n  const { tCommon } = useTranslation();\n  const [hoveredPoint, setHoveredPoint] = useState<DataPoint3D | null>(null);\n  const [selectedPoint, setSelectedPoint] = useState<DataPoint3D | null>(null);\n  const [xAxis, setXAxis] = useState<string>('emotionIntensity');\n  const [yAxis, setYAxis] = useState<string>('sensoryResponse');\n  const [zAxis, setZAxis] = useState<string>('time');\n  const [colorBy, setColorBy] = useState<string>('category');\n  const [pointSize, setPointSize] = useState<number>(0.2);\n  const [filterCategory, setFilterCategory] = useState<string>('all');\n  const xAxisLabelId = React.useId();\n  const xAxisTriggerId = React.useId();\n  const yAxisLabelId = React.useId();\n  const yAxisTriggerId = React.useId();\n  const zAxisLabelId = React.useId();\n  const zAxisTriggerId = React.useId();\n  const colorByLabelId = React.useId();\n  const colorByTriggerId = React.useId();\n  const filterLabelId = React.useId();\n  const filterTriggerId = React.useId();\n  const pointSizeLabelId = React.useId();\n\n  // Memoize data processing\n  const dataPoints = useMemo(() => {\n    return processDataPoints(\n      emotions,\n      sensoryInputs,\n      trackingEntries,\n      xAxis,\n      yAxis,\n      zAxis\n    );\n  }, [emotions, sensoryInputs, trackingEntries, xAxis, yAxis, zAxis]);\n\n  // Filter points based on category\n  const filteredPoints = useMemo(() => {\n    if (filterCategory === 'all') return dataPoints;\n    return dataPoints.filter(p => p.category === filterCategory);\n  }, [dataPoints, filterCategory]);\n\n  // Memoize color mapping\n  const getPointColor = useCallback((point: DataPoint3D): string => {\n    if (colorBy === 'category') {\n      switch (point.category) {\n        case 'emotion': return '#ff6b6b';\n        case 'sensory': return '#4ecdc4';\n        case 'environmental': return '#45b7d1';\n        default: return '#95a5a6';\n      }\n    } else if (colorBy === 'intensity' && point.intensity) {\n      const intensity = point.intensity / 10;\n      return `hsl(${120 - intensity * 120}, 70%, 50%)`;\n    }\n    return '#95a5a6';\n  }, [colorBy]);\n\n  // Memoized handlers\n  const handlePointHover = useCallback((point: DataPoint3D | null) => {\n    setHoveredPoint(point);\n  }, []);\n\n  const handlePointClick = useCallback((point: DataPoint3D) => {\n    setSelectedPoint(point);\n  }, []);\n\n  const handleResetCamera = useCallback(() => {\n    setHoveredPoint(null);\n    setSelectedPoint(null);\n  }, []);\n\n  const handleXAxisChange = useCallback((value: string) => setXAxis(value), []);\n  const handleYAxisChange = useCallback((value: string) => setYAxis(value), []);\n  const handleZAxisChange = useCallback((value: string) => setZAxis(value), []);\n  const handleColorByChange = useCallback((value: string) => setColorBy(value), []);\n  const handleFilterChange = useCallback((value: string) => setFilterCategory(value), []);\n  const handlePointSizeChange = useCallback((value: number[]) => setPointSize(value[0]), []);\n\n  // Axis labels\n  const axisLabels = useMemo(() => ({\n    x: xAxis === 'emotionIntensity' ? 'Emotion' : xAxis === 'sensoryResponse' ? 'Sensory' : 'Time',\n    y: yAxis === 'emotionIntensity' ? 'Emotion' : yAxis === 'sensoryResponse' ? 'Sensory' : 'Time',\n    z: zAxis === 'emotionIntensity' ? 'Emotion' : zAxis === 'sensoryResponse' ? 'Sensory' : 'Time'\n  }), [xAxis, yAxis, zAxis]);\n\n  return (\n    <Card className=\"w-full\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Move3d className=\"h-5 w-5\" />\n          3D Data Visualization\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        {/* Controls */}\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4\">\n          <div>\n            <label\n              id={xAxisLabelId}\n              className=\"text-sm font-medium mb-1 block\"\n              htmlFor={xAxisTriggerId}\n            >\n              X Axis\n            </label>\n            <Select value={xAxis} onValueChange={handleXAxisChange}>\n              <SelectTrigger id={xAxisTriggerId} aria-labelledby={xAxisLabelId}>\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"emotionIntensity\">Emotion Intensity</SelectItem>\n                <SelectItem value=\"sensoryResponse\">Sensory Response</SelectItem>\n                <SelectItem value=\"time\">Time</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n          \n          <div>\n            <label\n              id={yAxisLabelId}\n              className=\"text-sm font-medium mb-1 block\"\n              htmlFor={yAxisTriggerId}\n            >\n              Y Axis\n            </label>\n            <Select value={yAxis} onValueChange={handleYAxisChange}>\n              <SelectTrigger id={yAxisTriggerId} aria-labelledby={yAxisLabelId}>\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"emotionIntensity\">Emotion Intensity</SelectItem>\n                <SelectItem value=\"sensoryResponse\">Sensory Response</SelectItem>\n                <SelectItem value=\"time\">Time</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n          \n          <div>\n            <label\n              id={zAxisLabelId}\n              className=\"text-sm font-medium mb-1 block\"\n              htmlFor={zAxisTriggerId}\n            >\n              Z Axis\n            </label>\n            <Select value={zAxis} onValueChange={handleZAxisChange}>\n              <SelectTrigger id={zAxisTriggerId} aria-labelledby={zAxisLabelId}>\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"emotionIntensity\">Emotion Intensity</SelectItem>\n                <SelectItem value=\"sensoryResponse\">Sensory Response</SelectItem>\n                <SelectItem value=\"time\">Time</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n          \n          <div>\n            <label\n              id={colorByLabelId}\n              className=\"text-sm font-medium mb-1 block\"\n              htmlFor={colorByTriggerId}\n            >\n              Color By\n            </label>\n            <Select value={colorBy} onValueChange={handleColorByChange}>\n              <SelectTrigger id={colorByTriggerId} aria-labelledby={colorByLabelId}>\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"category\">Category</SelectItem>\n                <SelectItem value=\"intensity\">Intensity</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        <div className=\"flex gap-4 mb-4\">\n          <div className=\"flex-1\">\n            <p id={pointSizeLabelId} className=\"text-sm font-medium mb-1 block\">Point Size</p>\n            <Slider\n              value={[pointSize]}\n              onValueChange={handlePointSizeChange}\n              min={0.1}\n              max={0.5}\n              step={0.05}\n              className=\"w-full\"\n              aria-labelledby={pointSizeLabelId}\n            />\n          </div>\n          \n          <div className=\"flex-1\">\n            <label\n              id={filterLabelId}\n              className=\"text-sm font-medium mb-1 block\"\n              htmlFor={filterTriggerId}\n            >\n              Filter\n            </label>\n            <Select value={filterCategory} onValueChange={handleFilterChange}>\n              <SelectTrigger id={filterTriggerId} aria-labelledby={filterLabelId}>\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Categories</SelectItem>\n                <SelectItem value=\"emotion\">Emotions</SelectItem>\n                <SelectItem value=\"sensory\">Sensory</SelectItem>\n                <SelectItem value=\"environmental\">Environmental</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        {/* 3D Canvas */}\n        <div className=\"relative h-[500px] bg-muted/30 rounded-lg overflow-hidden\">\n          <Suspense fallback={\n            <div className=\"flex items-center justify-center h-full\">\n              <p className=\"text-muted-foreground\">{tCommon('loading')}</p>\n            </div>\n          }>\n            <Canvas camera={{ position: [10, 10, 10], fov: 50 }}>\n              <ambientLight intensity={0.5} />\n              <pointLight position={[10, 10, 10]} />\n              <OrbitControls \n                enablePan={!prefersReducedMotion}\n                enableZoom={true}\n                enableRotate={!prefersReducedMotion}\n                autoRotate={false}\n              />\n              \n              <AxisLabels\n                xLabel={axisLabels.x}\n                yLabel={axisLabels.y}\n                zLabel={axisLabels.z}\n              />\n              \n              {filteredPoints.map((point) => (\n                <DataPoint\n                  key={point.id}\n                  position={[\n                    point.normalizedX || 0,\n                    point.normalizedY || 0,\n                    point.normalizedZ || 0\n                  ]}\n                  color={getPointColor(point)}\n                  size={pointSize}\n                  point={point}\n                  onHover={handlePointHover}\n                  isHighlighted={selectedPoint?.id === point.id}\n                  reducedMotion={prefersReducedMotion}\n                />\n              ))}\n              \n              {hoveredPoint && (\n                <Tooltip3D\n                  point={hoveredPoint}\n                  onClose={() => setHoveredPoint(null)}\n                />\n              )}\n              \n              <CameraControls onReset={handleResetCamera} />\n            </Canvas>\n          </Suspense>\n        </div>\n\n        {/* Status bar */}\n        <div className=\"flex items-center justify-between mt-4 text-sm text-muted-foreground\">\n          <span>{filteredPoints.length} data points</span>\n          {hoveredPoint && (\n            <span>Hovering: {hoveredPoint.label}</span>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}, (prevProps, nextProps) => {\n  // Custom comparison for optimal re-rendering\n  return (\n    prevProps.emotions.length === nextProps.emotions.length &&\n    prevProps.sensoryInputs.length === nextProps.sensoryInputs.length &&\n    prevProps.trackingEntries.length === nextProps.trackingEntries.length &&\n    prevProps.correlationData?.length === nextProps.correlationData?.length\n  );\n});\n\nOptimizedVisualization3D.displayName = 'OptimizedVisualization3D';\n\nexport default OptimizedVisualization3D;\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/optimized/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/profile-sections/AnalyticsSection.tsx","messages":[{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":68,"column":185,"nodeType":"BlockStatement","messageId":"unexpected","endLine":68,"endColumn":187,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3571,3571],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useMemo, useState } from 'react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { LazyAnalyticsDashboard } from '@/components/lazy/LazyAnalyticsDashboard';\nimport { ErrorBoundary } from '@/components/ErrorBoundary';\nimport { Student, TrackingEntry, EmotionEntry, SensoryEntry, Insights } from '@/types/student';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { AlertCircle } from 'lucide-react';\nimport { logger } from '@/lib/logger';\nimport { Switch } from '@/components/ui/switch';\nimport { analyticsConfig } from '@/lib/analyticsConfig';\nimport { loadAiConfig } from '@/lib/aiConfig';\nimport { getRuntimeEnv } from '@/lib/runtimeEnv';\n\n/**\n * @interface AnalyticsSectionProps\n * Props for the AnalyticsSection component.\n * \n * @property {Student} student - The student object.\n * @property {TrackingEntry[]} trackingEntries - All tracking entries for the student.\n * @property {object} filteredData - Data filtered by the selected date range.\n * @property {Insights | null} insights - The AI-generated insights for the student.\n *   @deprecated Retained for backward compatibility. Analytics are now computed internally via useAnalyticsWorker.\n * @property {boolean} isLoadingInsights - Flag indicating if insights are currently being loaded.\n *   @deprecated Retained for backward compatibility. Loading state is now managed internally via useAnalyticsWorker.\n */\ninterface AnalyticsSectionProps {\n  student: Student;\n  trackingEntries: TrackingEntry[];\n  filteredData: {\n    entries: TrackingEntry[];\n    emotions: EmotionEntry[];\n    sensoryInputs: SensoryEntry[];\n  };\n  /** @deprecated Retained for backward compatibility. Analytics are now computed internally. */\n  insights: Insights | null;\n  /** @deprecated Retained for backward compatibility. Loading state is now managed internally. */\n  isLoadingInsights: boolean;\n}\n\nexport function AnalyticsSection({ \n  student, \n  trackingEntries, \n  filteredData, \n  insights,\n  isLoadingInsights,\n}: AnalyticsSectionProps) {\nconst { tAnalytics } = useTranslation();\n  // Resolve defaults and availability for AI analysis\n  const defaults = useMemo(() => {\n    const cfg = (() => { try { return analyticsConfig.getConfig(); } catch { return null; } })();\n    // Prefer live env to avoid stale module-level defaults\n    const env = getRuntimeEnv();\n    const toBool = (v: unknown) => {\n      const s = (v ?? '').toString().toLowerCase();\n      return s === '1' || s === 'true' || s === 'yes';\n    };\n    const enabledByConfig = cfg?.features?.aiAnalysisEnabled === true || toBool(env.VITE_AI_ANALYSIS_ENABLED);\n    const getLS = (k: string) => {\n      try { return typeof localStorage !== 'undefined' ? (localStorage.getItem(k) || '') : ''; } catch { return ''; }\n    };\n    const model = typeof env.VITE_AI_MODEL_NAME === 'string' && (env.VITE_AI_MODEL_NAME as string).trim().length > 0\n      ? (env.VITE_AI_MODEL_NAME as string)\n      : (getLS('VITE_AI_MODEL_NAME') || loadAiConfig().modelName);\n    const apiKey = typeof env.VITE_OPENROUTER_API_KEY === 'string' && (env.VITE_OPENROUTER_API_KEY as string).trim().length > 0\n      ? (env.VITE_OPENROUTER_API_KEY as string)\n      : (getLS('OPENROUTER_API_KEY') || getLS('VITE_OPENROUTER_API_KEY') || (loadAiConfig().apiKey || ''));\n    const available = !!apiKey && !!model; // availability only depends on key + model\n    try { logger.debug('[AnalyticsSection.defaults]', { envAi: env.VITE_AI_ANALYSIS_ENABLED, envModel: env.VITE_AI_MODEL_NAME, hasKey: !!apiKey, enabledByConfig, available }); } catch {}\n    return { enabledByConfig, available };\n  }, []);\n\n  const [useAI, setUseAI] = useState<boolean>(() => defaults.enabledByConfig && defaults.available);\n\n  useEffect(() => {\n    logger.debug('[AnalyticsSection] Props received', {\n      studentId: student?.id,\n      trackingEntriesCount: trackingEntries?.length,\n      filteredDataEntriesCount: filteredData?.entries?.length,\n      hasInsights: !!insights,\n      isLoadingInsights,\n      ai: { enabledByConfig: defaults.enabledByConfig, available: defaults.available, useAI }\n    });\n  }, [student, trackingEntries, filteredData, insights, isLoadingInsights, defaults.enabledByConfig, defaults.available, useAI]);\n\n  if (!student || !filteredData || !trackingEntries) {\n    return (\n      <div className=\"space-y-6\">\n        <Card className=\"bg-gradient-card border-0 shadow-soft\">\n          <CardContent className=\"p-6\">\n            <div className=\"text-center text-muted-foreground\">\n              <AlertCircle className=\"h-8 w-8 mx-auto mb-2\" />\n              <p>{tAnalytics('missingDataTitle')}</p>\n              <p className=\"text-sm mt-2\">\n                {tAnalytics('missingDataMessage')}\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const safeFilteredData = {\n    entries: filteredData.entries || [],\n    emotions: filteredData.emotions || [],\n    sensoryInputs: filteredData.sensoryInputs || [],\n  };\n\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div>\n        <h2 className=\"text-2xl font-bold\">{tAnalytics('section.title')}</h2>\n        <p className=\"text-muted-foreground\">\n          {tAnalytics('section.subtitle', { name: student.name })}\n        </p>\n        {/* AI Analysis Toggle */}\n        <div className=\"mt-4 flex items-center gap-3\">\n          <Switch\n            id=\"ai-analysis-toggle\"\n            checked={useAI}\n            onCheckedChange={(val) => setUseAI(Boolean(val))}\n            disabled={!defaults.available}\n            aria-checked={useAI}\n            aria-labelledby=\"ai-analysis-toggle-label\"\n            aria-describedby=\"ai-analysis-toggle-desc\"\n            data-testid=\"ai-toggle\"\n          />\n          <div>\n            <label id=\"ai-analysis-toggle-label\" htmlFor=\"ai-analysis-toggle\" className=\"text-sm font-medium\">\n              {String(tAnalytics('ai.toggle.label', { defaultValue: 'AI Analysis' }))}\n            </label>\n            <p id=\"ai-analysis-toggle-desc\" className=\"text-xs text-muted-foreground\" data-testid=\"ai-toggle-status\">\n              {defaults.available\n                ? (useAI\n                    ? String(tAnalytics('ai.toggle.enabled', { defaultValue: 'Enabled' }))\n                    : String(tAnalytics('ai.toggle.disabled', { defaultValue: 'Disabled' })))\n                : String(tAnalytics('ai.toggle.unavailable', { defaultValue: 'Unavailable (missing key or model)' }))}\n              {!defaults.enabledByConfig && useAI && (\n                <span className=\"block text-yellow-600 dark:text-yellow-400 text-xs mt-1\">\n                  {String(tAnalytics('ai.toggle.configWarning', { defaultValue: 'Warning: AI disabled in config, using runtime override' }))}\n                </span>\n              )}\n            </p>\n          </div>\n        </div>\n      </div>\n\n      {/* Main Analytics Dashboard */}\n      <ErrorBoundary showToast={false}>\n        <LazyAnalyticsDashboard\n          student={student}\n          filteredData={safeFilteredData}\n          useAI={useAI}\n        />\n      </ErrorBoundary>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/profile-sections/DashboardSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Settings' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":68,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":76},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'trackingEntries' is defined but never used. Allowed unused args must match /^_/u.","line":47,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tCommon' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":54,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":28},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Oversikt\"","line":87,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":87,"endColumn":54},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-2xl font-bold\">Oversikt</h2>","line":87,"column":46,"nodeType":"JSXText","endLine":87,"endColumn":54},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sammendrag av\"","line":88,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":89,"endColumn":27},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">\n            Sammendrag av {student.name}s data og aktivitet\n          </p>","line":88,"column":48,"nodeType":"JSXText","endLine":89,"endColumn":27},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"s data og aktivitet\"","line":89,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":90,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">\n            Sammendrag av {student.name}s data og aktivitet\n          </p>","line":89,"column":41,"nodeType":"JSXText","endLine":90,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Analysestatus\"","line":105,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":107,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n            <BarChart3 className=\"h-5 w-5\" />\n            Analysestatus\n          </CardTitle>","line":105,"column":46,"nodeType":"JSXText","endLine":107,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Datakvalitet\"","line":179,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":181,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n            <Info className=\"h-5 w-5\" />\n            Datakvalitet\n          </CardTitle>","line":179,"column":41,"nodeType":"JSXText","endLine":181,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Samlet kvalitetsscore\"","line":186,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":186,"endColumn":81},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground\">Samlet kvalitetsscore</p>","line":186,"column":60,"nodeType":"JSXText","endLine":186,"endColumn":81},{"ruleId":"no-restricted-syntax","severity":1,"message":"Avoid inline styles (style={{}}). Use Tailwind CSS classes or CSS custom properties for styling. See rule 3wIMH0UDSwsNj5RYGo17Vg. Exception: Radix primitives with // RADIX_INLINE_STYLE_ALLOWED comment.","line":200,"column":15,"nodeType":"JSXAttribute","messageId":"restrictedSyntax","endLine":200,"endColumn":73},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"AI-genererte innsikter\"","line":246,"column":63,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":248,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n              <TrendingUp className=\"h-5 w-5 animate-pulse\" />\n              AI-genererte innsikter\n            </CardTitle>","line":246,"column":63,"nodeType":"JSXText","endLine":248,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"AI-genererte innsikter\"","line":261,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":263,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n              <TrendingUp className=\"h-5 w-5\" />\n              AI-genererte innsikter\n            </CardTitle>","line":261,"column":49,"nodeType":"JSXText","endLine":263,"endColumn":13},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":268,"column":27,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":268,"endColumn":32},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Nylige økter\"","line":280,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":280,"endColumn":66},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-lg font-semibold mb-4\">Nylige økter</h3>","line":280,"column":54,"nodeType":"JSXText","endLine":280,"endColumn":66}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":23,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from '@/components/ui/collapsible';\nimport { PaginatedSessionsList } from '@/components/PaginatedSessionsList';\nimport { DataRequirementsCalculator } from '@/components/DataRequirementsCalculator';\nimport { DataQualityFeedback } from '@/components/DataQualityFeedback';\nimport { DataCollectionRoadmap } from '@/components/DataCollectionRoadmap';\nimport { AnalyticsStatusIndicator } from '@/components/AnalyticsStatusIndicator';\nimport { IS_PROD } from '@/lib/env';\nimport { DateRangeSelector, TimeRange } from '@/components/DateRangeSelector';\nimport { Student, TrackingEntry, EmotionEntry, SensoryEntry, Insights } from '@/types/student';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { Plus, Calendar, BarChart3, TrendingUp, ChevronDown, Info, Settings } from 'lucide-react';\nimport { useNavigate } from 'react-router-dom';\nimport { cn } from '@/lib/utils';\n\n/**\n * @interface DashboardSectionProps\n * Props for the DashboardSection component.\n * \n * @property {Student} student - The student object.\n * @property {TrackingEntry[]} trackingEntries - All tracking entries for the student.\n * @property {object} filteredData - Data filtered by the selected date range.\n * @property {TimeRange} selectedRange - The currently selected time range for filtering.\n * @property {(range: TimeRange) => void} onRangeChange - Callback to handle changes to the date range.\n * @property {Insights | null} insights - The AI-generated insights for the student.\n * @property {boolean} isLoadingInsights - Flag indicating if insights are currently being loaded.\n */\ninterface DashboardSectionProps {\n  student: Student;\n  trackingEntries: TrackingEntry[];\n  filteredData: {\n    entries: TrackingEntry[];\n    emotions: EmotionEntry[];\n    sensoryInputs: SensoryEntry[];\n  };\n  selectedRange: TimeRange;\n  onRangeChange: (range: TimeRange) => void;\n  insights: Insights | null;\n  isLoadingInsights: boolean;\n}\n\nexport function DashboardSection({ \n  student, \n  trackingEntries, \n  filteredData, \n  selectedRange, \n  onRangeChange,\n  insights,\n  isLoadingInsights, \n}: DashboardSectionProps) {\n  const { tStudent, tCommon } = useTranslation();\n  const navigate = useNavigate();\n  const [showAdvancedDetails, setShowAdvancedDetails] = useState(false);\n\n  // Calculate stats for the selected period\n  const stats = {\n    totalSessions: filteredData.entries.length,\n    totalEmotions: filteredData.emotions.length,\n    totalSensoryInputs: filteredData.sensoryInputs.length\n  };\n\n  // Calculate simple data quality score\n  const dataQualityScore = Math.min(\n    100,\n    Math.round(\n      ((stats.totalSessions * 0.4) + (stats.totalEmotions * 0.3) + (stats.totalSensoryInputs * 0.3)) / 10 * 100\n    )\n  );\n\n  const getQualityStatus = (score: number) => {\n    if (score >= 80) return { label: 'Utmerket', color: 'bg-green-500', variant: 'default' as const };\n    if (score >= 60) return { label: 'God', color: 'bg-blue-500', variant: 'secondary' as const };\n    if (score >= 40) return { label: 'Moderat', color: 'bg-yellow-500', variant: 'outline' as const };\n    return { label: 'Trenger mer data', color: 'bg-red-500', variant: 'destructive' as const };\n  };\n\n  const qualityStatus = getQualityStatus(dataQualityScore);\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header Actions */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold\">Oversikt</h2>\n          <p className=\"text-muted-foreground\">\n            Sammendrag av {student.name}s data og aktivitet\n          </p>\n        </div>\n        <Button\n          onClick={() => navigate(`/track/${student.id}`)}\n          className=\"bg-gradient-primary hover:opacity-90\"\n        >\n          <Plus className=\"h-4 w-4 mr-2\" />\n          {String(tStudent('interface.newSession'))}\n        </Button>\n      </div>\n\n      {/* Analytics Status */}\n      <Card className=\"bg-gradient-card border-0 shadow-soft\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <BarChart3 className=\"h-5 w-5\" />\n            Analysestatus\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <AnalyticsStatusIndicator studentId={student.id} showDetails={!IS_PROD} />\n        </CardContent>\n      </Card>\n\n      {/* Date Range Selector */}\n      <Card className=\"bg-gradient-card border-0 shadow-soft\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Calendar className=\"h-5 w-5\" />\n            {String(tStudent('interface.dataAnalysisPeriod'))}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <DateRangeSelector \n            selectedRange={selectedRange}\n            onRangeChange={onRangeChange}\n          />\n        </CardContent>\n      </Card>\n\n      {/* Summary Statistics */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card className=\"bg-gradient-card border-0 shadow-soft\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">\n                  {String(tStudent('interface.sessionsInPeriod'))}\n                </p>\n                <p className=\"text-2xl font-bold\">{stats.totalSessions}</p>\n              </div>\n              <Badge variant=\"secondary\">{String(tStudent('interface.totalSessions'))}</Badge>\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card className=\"bg-gradient-card border-0 shadow-soft\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">\n                  {String(tStudent('interface.emotionsTracked'))}\n                </p>\n                <p className=\"text-2xl font-bold\">{stats.totalEmotions}</p>\n              </div>\n              <Badge variant=\"secondary\">{String(tStudent('interface.totalEmotions'))}</Badge>\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card className=\"bg-gradient-card border-0 shadow-soft\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">\n                  {String(tStudent('interface.sensoryInputs'))}\n                </p>\n                <p className=\"text-2xl font-bold\">{stats.totalSensoryInputs}</p>\n              </div>\n              <Badge variant=\"secondary\">{String(tStudent('interface.totalSensoryInputs'))}</Badge>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Simple Data Quality Overview */}\n      <Card className=\"bg-gradient-card border-0 shadow-soft\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Info className=\"h-5 w-5\" />\n            Datakvalitet\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex items-center justify-between mb-4\">\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Samlet kvalitetsscore</p>\n              <p className=\"text-3xl font-bold\">{dataQualityScore}%</p>\n            </div>\n            <Badge variant={qualityStatus.variant} className=\"ml-2\">\n              {qualityStatus.label}\n            </Badge>\n          </div>\n          \n          <div className=\"bg-muted rounded-full h-2 mb-4 overflow-hidden\">\n            <div \n              className={cn(\n                \"bg-primary h-2 rounded-full transition-all duration-500\",\n                \"w-full origin-left\"\n              )}\n              style={{ transform: `scaleX(${dataQualityScore / 100})` }}\n            />\n          </div>\n\n          <Collapsible open={showAdvancedDetails} onOpenChange={setShowAdvancedDetails}>\n            <CollapsibleTrigger asChild>\n              <Button variant=\"ghost\" className=\"w-full justify-between p-0 h-auto\">\n                <span className=\"text-sm text-muted-foreground\">\n                  {showAdvancedDetails ? 'Skjul detaljer' : 'Vis detaljert analyse'}\n                </span>\n                <ChevronDown className={cn(\n                  \"h-4 w-4 transition-transform\",\n                  showAdvancedDetails && \"rotate-180\"\n                )} />\n              </Button>\n            </CollapsibleTrigger>\n            \n            <CollapsibleContent className=\"space-y-6 mt-6\">\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                <DataRequirementsCalculator\n                  entries={filteredData.entries}\n                  emotions={filteredData.emotions}\n                  sensoryInputs={filteredData.sensoryInputs}\n                />\n                <DataQualityFeedback\n                  entries={filteredData.entries}\n                  emotions={filteredData.emotions}\n                  sensoryInputs={filteredData.sensoryInputs}\n                />\n              </div>\n              \n              <DataCollectionRoadmap\n                entries={filteredData.entries}\n                emotions={filteredData.emotions}\n                sensoryInputs={filteredData.sensoryInputs}\n              />\n            </CollapsibleContent>\n          </Collapsible>\n        </CardContent>\n      </Card>\n\n      {/* AI Insights */}\n      {isLoadingInsights ? (\n        <Card className=\"bg-gradient-card border-0 shadow-soft\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <TrendingUp className=\"h-5 w-5 animate-pulse\" />\n              AI-genererte innsikter\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              <div className=\"p-3 bg-accent/20 rounded-lg animate-pulse h-12 w-full\" />\n              <div className=\"p-3 bg-accent/20 rounded-lg animate-pulse h-12 w-full\" />\n            </div>\n          </CardContent>\n        </Card>\n      ) : insights && insights.suggestions && insights.suggestions.length > 0 && (\n        <Card className=\"bg-gradient-card border-0 shadow-soft\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <TrendingUp className=\"h-5 w-5\" />\n              AI-genererte innsikter\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {insights.suggestions.slice(0, 3).map((suggestion: string, index: number) => (\n                <div key={index} className=\"p-3 bg-accent/20 rounded-lg\">\n                  <p className=\"text-sm\">{suggestion}</p>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Recent Sessions */}\n      {filteredData.entries.length > 0 && (\n        <div>\n          <h3 className=\"text-lg font-semibold mb-4\">Nylige økter</h3>\n          <PaginatedSessionsList sessions={filteredData.entries} />\n        </div>\n      )}\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/profile-sections/GoalsSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/profile-sections/ProfileErrorState.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/profile-sections/ProfileLoadingState.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/profile-sections/ProgressSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/profile-sections/ReportsSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/profile-sections/ToolsSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[833,836],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[833,836],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1163,1166],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1163,1166],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Verktøy\"","line":90,"column":44,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":90,"endColumn":51},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-2xl font-bold\">Verktøy</h2>","line":90,"column":44,"nodeType":"JSXText","endLine":90,"endColumn":51},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Avanserte verktøy for søk, maler og sammenligning\"","line":91,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":93,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">\n          Avanserte verktøy for søk, maler og sammenligning\n        </p>","line":91,"column":46,"nodeType":"JSXText","endLine":93,"endColumn":9}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { AdvancedSearch } from '@/components/AdvancedSearch';\nimport { QuickEntryTemplates } from '@/components/QuickEntryTemplates';\nimport { PeriodComparison } from '@/components/PeriodComparison';\nimport { Student, TrackingEntry, EmotionEntry, SensoryEntry, Goal } from '@/types/student';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { Search, Zap, Calendar } from 'lucide-react';\nimport { useNavigate } from 'react-router-dom';\n\ninterface ToolsSectionProps {\n  student: Student;\n  trackingEntries: TrackingEntry[];\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  goals: Goal[];\n  activeToolSection: string;\n  onToolSectionChange: (section: string) => void;\n  onSearchResults?: (results: any) => void;\n}\n\nexport function ToolsSection({ \n  student, \n  trackingEntries, \n  emotions, \n  sensoryInputs, \n  goals,\n  activeToolSection,\n  onToolSectionChange,\n  onSearchResults \n}: ToolsSectionProps) {\n  const { tStudent } = useTranslation();\n  const navigate = useNavigate();\n\n  const handleQuickTemplateApply = (template: any) => {\n    navigate(`/track/${student.id}`, { \n      state: { \n        prefilledData: template \n      } \n    });\n  };\n\n  const toolSections = [\n    {\n      id: 'search',\n      title: tStudent('interface.advancedSearch'),\n      icon: Search,\n      component: (\n        <AdvancedSearch\n          students={[student]}\n          trackingEntries={trackingEntries}\n          emotions={emotions}\n          sensoryInputs={sensoryInputs}\n          goals={goals}\n          onResultsChange={onSearchResults}\n        />\n      )\n    },\n    {\n      id: 'templates',\n      title: tStudent('interface.quickTemplates'),\n      icon: Zap,\n      component: (\n        <QuickEntryTemplates\n          studentId={student.id}\n          onApplyTemplate={handleQuickTemplateApply}\n        />\n      )\n    },\n    {\n      id: 'compare',\n      title: 'Periodesammenligning',\n      icon: Calendar,\n      component: (\n        <PeriodComparison\n          emotions={emotions}\n          sensoryInputs={sensoryInputs}\n          currentRange={{ start: new Date(), end: new Date(), label: \"Current\" }}\n        />\n      )\n    }\n  ];\n\n  const activeSection = toolSections.find(section => section.id === activeToolSection);\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div>\n        <h2 className=\"text-2xl font-bold\">Verktøy</h2>\n        <p className=\"text-muted-foreground\">\n          Avanserte verktøy for søk, maler og sammenligning\n        </p>\n      </div>\n\n      {/* Tool Navigation */}\n      <div className=\"flex flex-wrap gap-2\">\n        {toolSections.map((section) => (\n          <button\n            key={section.id}\n            onClick={() => onToolSectionChange(section.id)}\n            className={`flex items-center gap-2 px-4 py-2 rounded-lg border transition-colors ${\n              activeToolSection === section.id\n                ? 'bg-accent text-accent-foreground border-accent'\n                : 'bg-background hover:bg-accent/50 border-border'\n            }`}\n          >\n            <section.icon className=\"h-4 w-4\" />\n            {String(section.title)}\n          </button>\n        ))}\n      </div>\n\n      {/* Active Tool Section */}\n      {activeSection && (\n        <Card className=\"bg-gradient-card border-0 shadow-soft\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <activeSection.icon className=\"h-5 w-5\" />\n              {String(activeSection.title)}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {activeSection.component}\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/settings/AnalyticsConfig.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2008,2011],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2008,2011],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":95,"column":7,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":95,"endColumn":60},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5474,5477],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5474,5477],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6304,6307],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6304,6307],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"σ\"","line":176,"column":170,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":176,"endColumn":171}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Label } from '@/components/ui/label';\nimport { Input } from '@/components/ui/input';\nimport { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';\nimport { Separator } from '@/components/ui/separator';\nimport { Download, Upload, Save, RotateCcw, Info } from 'lucide-react';\nimport { toast } from 'sonner';\nimport { analyticsConfig, AnalyticsConfiguration } from '@/lib/analyticsConfig';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { logger } from '@/lib/logger';\n\ninterface AnalyticsConfigProps {\n  className?: string;\n  onChange?: (config: AnalyticsConfiguration) => void;\n}\n\ninterface FieldError {\n  fieldId: string;\n  message: string;\n}\n\nfunction useConfigState(): [AnalyticsConfiguration, React.Dispatch<React.SetStateAction<AnalyticsConfiguration>>] {\n  const [cfg, setCfg] = useState<AnalyticsConfiguration>(() => analyticsConfig.getConfig());\n  useEffect(() => {\n    const unsub = analyticsConfig.subscribe((next) => setCfg(next));\n    return unsub;\n  }, []);\n  return [cfg, setCfg];\n}\n\nexport const AnalyticsConfig: React.FC<AnalyticsConfigProps> = ({ className, onChange }) => {\n  const { tSettings, tCommon } = useTranslation();\n  const [config, setConfig] = useConfigState();\n  const [errors, setErrors] = useState<FieldError[]>([]);\n  const notifiedRef = useRef(false);\n  const firstInvalidRef = useRef<HTMLInputElement | null>(null);\n  const fileInputRef = useRef<HTMLInputElement | null>(null);\n  const liveRegionRef = useRef<HTMLDivElement | null>(null);\n\n  useEffect(() => {\n    onChange?.(config);\n  }, [config, onChange]);\n\n  const onNumberChange = useCallback((path: string[], value: number) => {\n    setConfig((prev) => {\n      const next: AnalyticsConfiguration = JSON.parse(JSON.stringify(prev));\n      let current: any = next;\n      for (let i = 0; i < path.length - 1; i++) current = current[path[i]];\n      current[path[path.length - 1]] = value;\n      return next;\n    });\n  }, [setConfig]);\n\n  const onRadioChange = useCallback((value: 'low' | 'medium' | 'high') => {\n    setConfig((prev) => ({\n      ...prev,\n      alertSensitivity: { ...prev.alertSensitivity, level: value },\n    }));\n  }, [setConfig]);\n\n  const validate = useCallback((cfg: AnalyticsConfiguration): FieldError[] => {\n    const errs: FieldError[] = [];\n    const push = (fieldId: string, message: string) => errs.push({ fieldId, message });\n\n    if (!Number.isFinite(cfg.patternAnalysis.minDataPoints) || cfg.patternAnalysis.minDataPoints < 1) {\n      push('pattern-minDataPoints', tSettings('validation.minDataPoints', { defaultValue: 'Minimum data points must be >= 1' }));\n    }\n    if (cfg.patternAnalysis.correlationThreshold < 0 || cfg.patternAnalysis.correlationThreshold > 1) {\n      push('pattern-correlationThreshold', tSettings('validation.correlationThreshold', { defaultValue: 'Correlation threshold must be between 0 and 1' }));\n    }\n    if (cfg.enhancedAnalysis.anomalyThreshold < 0.1 || cfg.enhancedAnalysis.anomalyThreshold > 5) {\n      push('enhanced-anomalyThreshold', tSettings('validation.anomalyThreshold', { defaultValue: 'Anomaly threshold should be between 0.1 and 5' }));\n    }\n    if (cfg.timeWindows.defaultAnalysisDays < 1 || cfg.timeWindows.defaultAnalysisDays > 365) {\n      push('time-defaultAnalysisDays', tSettings('validation.defaultAnalysisDays', { defaultValue: 'Default analysis window must be between 1 and 365 days' }));\n    }\n    if (cfg.cache.ttl < 0) {\n      push('cache-ttl', tSettings('validation.cacheTtl', { defaultValue: 'Cache TTL must be >= 0 ms' }));\n    }\n    return errs;\n  }, [tSettings]);\n\n  const handleSave = useCallback(() => {\n    const errs = validate(config);\n    setErrors(errs);\n\n    if (errs.length) {\n      if (!notifiedRef.current) {\n        toast.error(tSettings('validation.title', { defaultValue: 'Please fix the highlighted fields' }));\n        notifiedRef.current = true;\n      }\n      // Focus first invalid\n      setTimeout(() => firstInvalidRef.current?.focus(), 0);\n      // Announce in live region\n      if (liveRegionRef.current) {\n        liveRegionRef.current.textContent = errs[0]?.message ?? '';\n      }\n      return;\n    }\n\n    analyticsConfig.updateConfig(config);\n    notifiedRef.current = false;\n    toast.success(tSettings('save.success', { defaultValue: 'Analytics configuration saved' }));\n  }, [config, tSettings, validate]);\n\n  const handleReset = useCallback(() => {\n    analyticsConfig.resetToDefaults();\n    setErrors([]);\n    notifiedRef.current = false;\n    toast.success(tSettings('reset.success', { defaultValue: 'Settings reset to defaults' }));\n  }, [tSettings]);\n\n  const exportConfig = useCallback(() => {\n    try {\n      const configString = analyticsConfig.exportConfig();\n      const blob = new Blob([configString], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = 'analytics-config.json';\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      URL.revokeObjectURL(url);\n      toast.success(tSettings('export.success', { defaultValue: 'Configuration exported' }));\n    } catch (error) {\n      logger.error('Failed to export analytics config', error as any);\n      toast.error(tSettings('export.error', { defaultValue: 'Failed to export configuration' }));\n    }\n  }, [tSettings]);\n\n  const importConfig = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    const reader = new FileReader();\n    reader.onload = (ev) => {\n      try {\n        const content = ev.target?.result as string;\n        if (analyticsConfig.importConfig(content)) {\n          setErrors([]);\n          notifiedRef.current = false;\n          toast.success(tSettings('import.success', { defaultValue: 'Configuration imported' }));\n        } else {\n          toast.error(tSettings('import.invalid', { defaultValue: 'Invalid configuration file' }));\n        }\n      } catch (err) {\n        logger.error('Failed reading imported config', err as any);\n        toast.error(tSettings('import.error', { defaultValue: 'Failed to read configuration file' }));\n      } finally {\n        if (fileInputRef.current) fileInputRef.current.value = '';\n      }\n    };\n    reader.readAsText(file);\n  }, [tSettings]);\n\n  const errorFor = useCallback((id: string) => errors.find((e) => e.fieldId === id)?.message, [errors]);\n\n  const Preview = useMemo(() => {\n    const level = config.alertSensitivity.level;\n    const days = config.timeWindows.defaultAnalysisDays;\n    const corr = config.patternAnalysis.correlationThreshold;\n    const anomaly = config.enhancedAnalysis.anomalyThreshold;\n    return (\n      <Card aria-live=\"polite\" className=\"bg-card border shadow-soft\">\n        <CardHeader className=\"pb-2\">\n          <CardTitle className=\"text-base\">{tSettings('preview.title', { defaultValue: 'Configuration preview' })}</CardTitle>\n          <CardDescription>{tSettings('preview.subtitle', { defaultValue: 'A quick summary of key analytics behaviors' })}</CardDescription>\n        </CardHeader>\n        <CardContent className=\"pt-0\">\n          <ul className=\"text-sm space-y-1\">\n            <li className=\"flex items-center gap-2\"><span className=\"font-medium\">{tSettings('preview.sensitivity', { defaultValue: 'Alert sensitivity' })}:</span> <span className=\"capitalize\">{level}</span></li>\n            <li className=\"flex items-center gap-2\"><span className=\"font-medium\">{tSettings('preview.window', { defaultValue: 'Default analysis window' })}:</span> {days} {tCommon('units.days', { defaultValue: 'days' })}</li>\n            <li className=\"flex items-center gap-2\"><span className=\"font-medium\">{tSettings('preview.correlation', { defaultValue: 'Correlation threshold' })}:</span> {corr}</li>\n            <li className=\"flex items-center gap-2\"><span className=\"font-medium\">{tSettings('preview.anomaly', { defaultValue: 'Anomaly threshold' })}:</span> {anomaly}σ</li>\n          </ul>\n        </CardContent>\n      </Card>\n    );\n  }, [config, tSettings, tCommon]);\n\n  return (\n    <section className={className} aria-labelledby=\"analytics-config-heading\" role=\"region\">\n      <a href=\"#analytics-config-main\" className=\"sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 focus:z-50 bg-primary text-primary-foreground px-3 py-1 rounded\">{tCommon('a11y.skip_to_content', { defaultValue: 'Skip to content' })}</a>\n\n      <h2 id=\"analytics-config-heading\" className=\"text-xl font-semibold text-foreground\">{tSettings('analytics.title', { defaultValue: 'Analytics configuration' })}</h2>\n\n      <div aria-live=\"polite\" aria-atomic=\"true\" className=\"sr-only\" ref={liveRegionRef} />\n\n      <div id=\"analytics-config-main\" className=\"mt-4 grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <div className=\"lg:col-span-2 space-y-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg\">{tSettings('sections.thresholds', { defaultValue: 'Thresholds & windows' })}</CardTitle>\n              <CardDescription>{tSettings('sections.thresholds_desc', { defaultValue: 'Tune analysis requirements and windows' })}</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"pattern-minDataPoints\" className=\"block mb-1\">{tSettings('fields.minDataPoints', { defaultValue: 'Minimum data points' })}</Label>\n                  <Input\n                    id=\"pattern-minDataPoints\"\n                    type=\"number\"\n                    inputMode=\"numeric\"\n                    aria-describedby=\"help-minDataPoints\"\n                    aria-invalid={Boolean(errorFor('pattern-minDataPoints'))}\n                    ref={(el) => { if (errorFor('pattern-minDataPoints')) firstInvalidRef.current = el; }}\n                    className=\"w-full\"\n                    value={config.patternAnalysis.minDataPoints}\n                    onChange={(e) => onNumberChange(['patternAnalysis', 'minDataPoints'], Number(e.target.value))}\n                  />\n                  <p id=\"help-minDataPoints\" className=\"mt-1 text-xs text-muted-foreground flex items-center gap-1\">\n                    <Info className=\"h-3 w-3\" />\n                    {errorFor('pattern-minDataPoints') || tSettings('help.minDataPoints', { defaultValue: 'Minimum entries required to run analysis' })}\n                  </p>\n                </div>\n\n                <div>\n                  <Label htmlFor=\"pattern-correlationThreshold\" className=\"block mb-1\">{tSettings('fields.correlationThreshold', { defaultValue: 'Correlation threshold' })}</Label>\n                  <Input\n                    id=\"pattern-correlationThreshold\"\n                    type=\"number\"\n                    step=\"0.05\"\n                    min=\"0\"\n                    max=\"1\"\n                    inputMode=\"decimal\"\n                    aria-describedby=\"help-correlationThreshold\"\n                    aria-invalid={Boolean(errorFor('pattern-correlationThreshold'))}\n                    ref={(el) => { if (errorFor('pattern-correlationThreshold')) firstInvalidRef.current = el; }}\n                    className=\"w-full\"\n                    value={config.patternAnalysis.correlationThreshold}\n                    onChange={(e) => onNumberChange(['patternAnalysis', 'correlationThreshold'], Number(e.target.value))}\n                  />\n                  <p id=\"help-correlationThreshold\" className=\"mt-1 text-xs text-muted-foreground flex items-center gap-1\">\n                    <Info className=\"h-3 w-3\" />\n                    {errorFor('pattern-correlationThreshold') || tSettings('help.correlationThreshold', { defaultValue: '0..1, higher means stricter correlations' })}\n                  </p>\n                </div>\n\n                <div>\n                  <Label htmlFor=\"enhanced-anomalyThreshold\" className=\"block mb-1\">{tSettings('fields.anomalyThreshold', { defaultValue: 'Anomaly threshold (σ)' })}</Label>\n                  <Input\n                    id=\"enhanced-anomalyThreshold\"\n                    type=\"number\"\n                    step=\"0.1\"\n                    inputMode=\"decimal\"\n                    aria-describedby=\"help-anomalyThreshold\"\n                    aria-invalid={Boolean(errorFor('enhanced-anomalyThreshold'))}\n                    ref={(el) => { if (errorFor('enhanced-anomalyThreshold')) firstInvalidRef.current = el; }}\n                    className=\"w-full\"\n                    value={config.enhancedAnalysis.anomalyThreshold}\n                    onChange={(e) => onNumberChange(['enhancedAnalysis', 'anomalyThreshold'], Number(e.target.value))}\n                  />\n                  <p id=\"help-anomalyThreshold\" className=\"mt-1 text-xs text-muted-foreground flex items-center gap-1\">\n                    <Info className=\"h-3 w-3\" />\n                    {errorFor('enhanced-anomalyThreshold') || tSettings('help.anomalyThreshold', { defaultValue: 'Standard deviations from mean to flag anomalies' })}\n                  </p>\n                </div>\n\n                <div>\n                  <Label htmlFor=\"time-defaultAnalysisDays\" className=\"block mb-1\">{tSettings('fields.defaultAnalysisDays', { defaultValue: 'Default analysis window (days)' })}</Label>\n                  <Input\n                    id=\"time-defaultAnalysisDays\"\n                    type=\"number\"\n                    inputMode=\"numeric\"\n                    aria-describedby=\"help-defaultAnalysisDays\"\n                    aria-invalid={Boolean(errorFor('time-defaultAnalysisDays'))}\n                    ref={(el) => { if (errorFor('time-defaultAnalysisDays')) firstInvalidRef.current = el; }}\n                    className=\"w-full\"\n                    value={config.timeWindows.defaultAnalysisDays}\n                    onChange={(e) => onNumberChange(['timeWindows', 'defaultAnalysisDays'], Number(e.target.value))}\n                  />\n                  <p id=\"help-defaultAnalysisDays\" className=\"mt-1 text-xs text-muted-foreground flex items-center gap-1\">\n                    <Info className=\"h-3 w-3\" />\n                    {errorFor('time-defaultAnalysisDays') || tSettings('help.defaultAnalysisDays', { defaultValue: 'Window for most computations' })}\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg\">{tSettings('sections.alerts', { defaultValue: 'Alert sensitivity' })}</CardTitle>\n              <CardDescription>{tSettings('sections.alerts_desc', { defaultValue: 'Choose how sensitive alerts should be' })}</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              <RadioGroup value={config.alertSensitivity.level} onValueChange={(v) => onRadioChange(v as 'low' | 'medium' | 'high')} aria-label={tSettings('fields.alertSensitivity', { defaultValue: 'Alert sensitivity' })}>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem id=\"level-low\" value=\"low\" />\n                  <Label htmlFor=\"level-low\" className=\"cursor-pointer\">{tSettings('labels.low', { defaultValue: 'Low' })}</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem id=\"level-medium\" value=\"medium\" />\n                  <Label htmlFor=\"level-medium\" className=\"cursor-pointer\">{tSettings('labels.medium', { defaultValue: 'Medium' })}</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem id=\"level-high\" value=\"high\" />\n                  <Label htmlFor=\"level-high\" className=\"cursor-pointer\">{tSettings('labels.high', { defaultValue: 'High' })}</Label>\n                </div>\n              </RadioGroup>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg\">{tSettings('sections.cache', { defaultValue: 'Cache' })}</CardTitle>\n              <CardDescription>{tSettings('sections.cache_desc', { defaultValue: 'Tune cache behavior' })}</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"cache-ttl\" className=\"block mb-1\">{tSettings('fields.cacheTtl', { defaultValue: 'Cache TTL (ms)' })}</Label>\n                  <Input\n                    id=\"cache-ttl\"\n                    type=\"number\"\n                    inputMode=\"numeric\"\n                    aria-describedby=\"help-cache-ttl\"\n                    aria-invalid={Boolean(errorFor('cache-ttl'))}\n                    ref={(el) => { if (errorFor('cache-ttl')) firstInvalidRef.current = el; }}\n                    className=\"w-full\"\n                    value={config.cache.ttl}\n                    onChange={(e) => onNumberChange(['cache', 'ttl'], Number(e.target.value))}\n                  />\n                  <p id=\"help-cache-ttl\" className=\"mt-1 text-xs text-muted-foreground flex items-center gap-1\">\n                    <Info className=\"h-3 w-3\" />\n                    {errorFor('cache-ttl') || tSettings('help.cacheTtl', { defaultValue: 'Time to live for cached analytics results' })}\n                  </p>\n                </div>\n                <div>\n                  <Label htmlFor=\"cache-maxSize\" className=\"block mb-1\">{tSettings('fields.cacheMax', { defaultValue: 'Max cache size' })}</Label>\n                  <Input\n                    id=\"cache-maxSize\"\n                    type=\"number\"\n                    inputMode=\"numeric\"\n                    aria-describedby=\"help-cache-maxSize\"\n                    className=\"w-full\"\n                    value={config.cache.maxSize}\n                    onChange={(e) => onNumberChange(['cache', 'maxSize'], Number(e.target.value))}\n                  />\n                  <p id=\"help-cache-maxSize\" className=\"mt-1 text-xs text-muted-foreground flex items-center gap-1\">\n                    <Info className=\"h-3 w-3\" />\n                    {tSettings('help.cacheMax', { defaultValue: 'Max number of cached entries' })}\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <div className=\"flex flex-wrap gap-2\">\n            <Button type=\"button\" onClick={handleSave} aria-label={tSettings('actions.save', { defaultValue: 'Save configuration' })}>\n              <Save className=\"h-4 w-4 mr-2\" /> {tCommon('buttons.save', { defaultValue: 'Save' })}\n            </Button>\n            <Button type=\"button\" variant=\"outline\" onClick={handleReset} aria-label={tSettings('actions.reset', { defaultValue: 'Reset to defaults' })}>\n              <RotateCcw className=\"h-4 w-4 mr-2\" /> {tSettings('actions.reset', { defaultValue: 'Reset' })}\n            </Button>\n            <Separator className=\"hidden sm:block mx-2\" orientation=\"vertical\" />\n            <Button type=\"button\" variant=\"outline\" onClick={exportConfig} aria-label={tSettings('actions.export', { defaultValue: 'Export configuration' })}>\n              <Download className=\"h-4 w-4 mr-2\" /> {tSettings('actions.export', { defaultValue: 'Export' })}\n            </Button>\n            <div className=\"relative inline-flex items-center\">\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                accept=\"application/json\"\n                onChange={importConfig}\n                aria-label={tSettings('actions.import', { defaultValue: 'Import configuration file' })}\n                className=\"absolute inset-0 opacity-0 cursor-pointer\"\n              />\n              <Button type=\"button\" variant=\"outline\" aria-hidden=\"true\">\n                <Upload className=\"h-4 w-4 mr-2\" /> {tSettings('actions.import', { defaultValue: 'Import' })}\n              </Button>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"lg:col-span-1 space-y-4\">\n          {Preview}\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-base\">{tSettings('help.title', { defaultValue: 'Help' })}</CardTitle>\n            </CardHeader>\n            <CardContent className=\"pt-0 text-sm text-muted-foreground\">\n              <ul className=\"list-disc pl-5 space-y-1\">\n                <li>{tSettings('help.reduced_motion', { defaultValue: 'Animations respect reduced motion preferences.' })}</li>\n                <li>{tSettings('help.accessibility', { defaultValue: 'All fields have labels and validation will be announced.' })}</li>\n              </ul>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </section>\n  );\n};\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/tegn/TegnXPBar.tsx","messages":[{"ruleId":"no-restricted-syntax","severity":1,"message":"Avoid inline styles (style={{}}). Use Tailwind CSS classes or CSS custom properties for styling. See rule 3wIMH0UDSwsNj5RYGo17Vg. Exception: Radix primitives with // RADIX_INLINE_STYLE_ALLOWED comment.","line":10,"column":9,"nodeType":"JSXAttribute","messageId":"restrictedSyntax","endLine":10,"endColumn":51},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Level\"","line":17,"column":59,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":17,"endColumn":65},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"mt-1 text-xs text-muted-foreground\">Level {level} · {progressThisLevel}/100 XP</div>","line":17,"column":59,"nodeType":"JSXText","endLine":17,"endColumn":65},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"·\"","line":17,"column":72,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":17,"endColumn":75},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"/100 XP\"","line":17,"column":94,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":17,"endColumn":101},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"mt-1 text-xs text-muted-foreground\">Level {level} · {progressThisLevel}/100 XP</div>","line":17,"column":94,"nodeType":"JSXText","endLine":17,"endColumn":101}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useTegnXP } from '@/contexts/TegnXPContext';\n\nexport const TegnXPBar = () => {\n  const { xp, level } = useTegnXP();\n  const progressThisLevel = xp % 100;\n  return (\n    <div className=\"w-full bg-muted/50 border border-border rounded-full h-3\" aria-label=\"XP progress\">\n      <div\n        className=\"bg-primary h-3 rounded-full transition-all\"\n        style={{ width: `${progressThisLevel}%` }}\n        role=\"progressbar\"\n        aria-valuemin={0}\n        aria-valuemax={100}\n        aria-valuenow={progressThisLevel}\n        aria-label={`Level ${level} progress`}\n      />\n      <div className=\"mt-1 text-xs text-muted-foreground\">Level {level} · {progressThisLevel}/100 XP</div>\n    </div>\n  );\n};\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/tegn/WebcamPreview.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The ref value 'videoRef.current' will likely have changed by the time this effect cleanup function runs. If this ref points to a node rendered by React, copy 'videoRef.current' to a variable inside the effect, and use that variable in the cleanup function.","line":39,"column":18,"nodeType":"Identifier","endLine":39,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useRef } from 'react';\nimport { cn } from '@/lib/utils';\n\ninterface WebcamPreviewProps {\n  active: boolean;\n  mirrored?: boolean;\n  className?: string;\n  onError?: (error: Error) => void;\n}\n\nexport const WebcamPreview = ({ active, mirrored = true, className, onError }: WebcamPreviewProps) => {\n  const videoRef = useRef<HTMLVideoElement | null>(null);\n  const streamRef = useRef<MediaStream | null>(null);\n\n  useEffect(() => {\n    let cancelled = false;\n    async function start() {\n      try {\n        if (!active || !videoRef.current) return;\n        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' }, audio: false });\n        if (cancelled) {\n          stream.getTracks().forEach(t => t.stop());\n          return;\n        }\n        streamRef.current = stream;\n        videoRef.current.srcObject = stream;\n        await videoRef.current.play();\n      } catch (e) {\n        if (onError) onError(e as Error);\n      }\n    }\n    if (active) start();\n    return () => {\n      cancelled = true;\n      if (streamRef.current) {\n        streamRef.current.getTracks().forEach(t => t.stop());\n      }\n      if (videoRef.current) {\n        videoRef.current.srcObject = null;\n      }\n    };\n  }, [active, onError]);\n\n  return (\n    <div className={cn('relative overflow-hidden rounded-xl border border-border bg-black/60', className)}>\n      <video\n        ref={videoRef}\n        className={cn('w-full h-64 object-cover', mirrored && 'scale-x-[-1]')}\n        playsInline\n        muted\n        aria-label=\"Webcam preview\"\n      />\n    </div>\n  );\n};\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/tracking/DataCollectionMonitor.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingDown' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'differenceInDays' is defined but never used. Allowed unused vars must match /^_/u.","line":22,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sessionConfig' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":65,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":65,"endColumn":40},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"No data collection history yet\"","line":281,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":281,"endColumn":78},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">No data collection history yet</p>","line":281,"column":48,"nodeType":"JSXText","endLine":281,"endColumn":78},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Start your first session to see monitoring insights\"","line":282,"column":61,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":284,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground mt-2\">\n            Start your first session to see monitoring insights\n          </p>","line":282,"column":61,"nodeType":"JSXText","endLine":284,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Collection Overview\"","line":297,"column":47,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":299,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n              <Activity className=\"h-5 w-5\" />\n              Collection Overview\n            </CardTitle>","line":297,"column":47,"nodeType":"JSXText","endLine":299,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Total Sessions\"","line":305,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":305,"endColumn":76},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground\">Total Sessions</p>","line":305,"column":62,"nodeType":"JSXText","endLine":305,"endColumn":76},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Completion Rate\"","line":313,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":313,"endColumn":77},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground\">Completion Rate</p>","line":313,"column":62,"nodeType":"JSXText","endLine":313,"endColumn":77},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Avg Quality\"","line":319,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":319,"endColumn":73},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground\">Avg Quality</p>","line":319,"column":62,"nodeType":"JSXText","endLine":319,"endColumn":73},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"m\"","line":323,"column":67,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":324,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-2xl font-bold\">\n                  {Math.round(statistics.averageDuration / 60000)}m\n                </p>","line":323,"column":67,"nodeType":"JSXText","endLine":324,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Avg Duration\"","line":325,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":325,"endColumn":74},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground\">Avg Duration</p>","line":325,"column":62,"nodeType":"JSXText","endLine":325,"endColumn":74},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Common Issues\"","line":333,"column":70,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":335,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"text-sm font-medium flex items-center gap-2\">\n                  <AlertCircle className=\"h-4 w-4 text-yellow-500\" />\n                  Common Issues\n                </h4>","line":333,"column":70,"nodeType":"JSXText","endLine":335,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"times\"","line":341,"column":38,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":342,"endColumn":23},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\" className=\"text-xs\">\n                        {issue.count} times\n                      </Badge>","line":341,"column":38,"nodeType":"JSXText","endLine":342,"endColumn":23},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Collection Goals\"","line":356,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":358,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n            <Target className=\"h-5 w-5\" />\n            Collection Goals\n          </CardTitle>","line":356,"column":43,"nodeType":"JSXText","endLine":358,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Target by\"","line":397,"column":55,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":398,"endColumn":33},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground flex items-center gap-1\">\n                      <Calendar className=\"h-3 w-3\" />\n                      Target by {format(goal.deadline, 'MMM d')}\n                    </p>","line":397,"column":55,"nodeType":"JSXText","endLine":398,"endColumn":33},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Recommended Strategies\"","line":413,"column":63,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":415,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n              <Sparkles className=\"h-5 w-5 text-yellow-500\" />\n              Recommended Strategies\n            </CardTitle>","line":413,"column":63,"nodeType":"JSXText","endLine":415,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Effectiveness:\"","line":462,"column":67,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":464,"endColumn":27},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"flex items-center gap-1\">\n                          Effectiveness: \n                          {'★'.repeat(strategy.effectiveness)}\n                          {'☆'.repeat(5 - strategy.effectiveness)}\n                        </span>","line":462,"column":67,"nodeType":"JSXText","endLine":464,"endColumn":27},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Benefits:\"","line":484,"column":66,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":484,"endColumn":75},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h5 className=\"text-xs font-medium mb-1\">Benefits:</h5>","line":484,"column":66,"nodeType":"JSXText","endLine":484,"endColumn":75},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":487,"column":38,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":487,"endColumn":39},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"How to implement:\"","line":496,"column":66,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":496,"endColumn":83},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h5 className=\"text-xs font-medium mb-1\">How to implement:</h5>","line":496,"column":66,"nodeType":"JSXText","endLine":496,"endColumn":83},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":499,"column":38,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":499,"endColumn":39},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \".\"","line":500,"column":81,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":500,"endColumn":82},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"You have\"","line":531,"column":29,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":532,"endColumn":22},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <AlertDescription>\n            You have {activeStrategies.length} active {activeStrategies.length === 1 ? 'strategy' : 'strategies'}.\n            Remember to apply {activeStrategies.length === 1 ? 'it' : 'them'} in your next session!\n          </AlertDescription>","line":531,"column":29,"nodeType":"JSXText","endLine":532,"endColumn":22},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"active\"","line":532,"column":47,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":532,"endColumn":55},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <AlertDescription>\n            You have {activeStrategies.length} active {activeStrategies.length === 1 ? 'strategy' : 'strategies'}.\n            Remember to apply {activeStrategies.length === 1 ? 'it' : 'them'} in your next session!\n          </AlertDescription>","line":532,"column":47,"nodeType":"JSXText","endLine":532,"endColumn":55},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \".\n            Remember to apply\"","line":532,"column":114,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":533,"endColumn":31},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <AlertDescription>\n            You have {activeStrategies.length} active {activeStrategies.length === 1 ? 'strategy' : 'strategies'}.\n            Remember to apply {activeStrategies.length === 1 ? 'it' : 'them'} in your next session!\n          </AlertDescription>","line":532,"column":114,"nodeType":"JSXText","endLine":533,"endColumn":31},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"in your next session!\"","line":533,"column":78,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":534,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <AlertDescription>\n            You have {activeStrategies.length} active {activeStrategies.length === 1 ? 'strategy' : 'strategies'}.\n            Remember to apply {activeStrategies.length === 1 ? 'it' : 'them'} in your next session!\n          </AlertDescription>","line":533,"column":78,"nodeType":"JSXText","endLine":534,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":47,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { \n  TrendingUp, \n  TrendingDown, \n  Target,\n  Clock,\n  Calendar,\n  Activity,\n  AlertCircle,\n  CheckCircle,\n  ChevronRight,\n  Sparkles,\n  Info\n} from 'lucide-react';\nimport { sessionManager, SessionStatistics } from '@/lib/sessionManager';\nimport { useTracking } from '@/contexts/TrackingContext';\nimport { differenceInDays, addDays, format } from 'date-fns';\nimport { cn } from '@/lib/utils';\n\ninterface DataCollectionMonitorProps {\n  studentId: string;\n  className?: string;\n  showRecommendations?: boolean;\n  showStatistics?: boolean;\n}\n\ninterface CollectionGoal {\n  id: string;\n  title: string;\n  description: string;\n  target: number;\n  current: number;\n  unit: string;\n  deadline?: Date;\n  priority: 'high' | 'medium' | 'low';\n  category: 'frequency' | 'quality' | 'diversity';\n}\n\ninterface DataCollectionStrategy {\n  id: string;\n  name: string;\n  description: string;\n  benefits: string[];\n  implementation: string[];\n  difficulty: 'easy' | 'medium' | 'hard';\n  timeRequired: string;\n  effectiveness: number; // 1-5\n}\n\n/**\n * DataCollectionMonitor Component\n * Monitors data collection patterns and provides strategies for improvement\n */\nexport const DataCollectionMonitor: React.FC<DataCollectionMonitorProps> = ({\n  studentId,\n  className,\n  showRecommendations = true,\n  showStatistics = true,\n}) => {\n  const { currentSession, sessionConfig } = useTracking();\n  const [statistics, setStatistics] = useState<SessionStatistics | null>(null);\n  const [activeStrategies, setActiveStrategies] = useState<string[]>([]);\n  const [expandedStrategy, setExpandedStrategy] = useState<string | null>(null);\n\n  useEffect(() => {\n    // Load session statistics\n    const stats = sessionManager.getStatistics(studentId);\n    setStatistics(stats);\n  }, [studentId, currentSession]);\n\n  // Define collection goals based on current statistics\n  const collectionGoals = useMemo<CollectionGoal[]>(() => {\n    if (!statistics) return [];\n\n    const goals: CollectionGoal[] = [\n      {\n        id: 'daily-sessions',\n        title: 'Daily Sessions',\n        description: 'Maintain consistent daily data collection',\n        target: 7,\n        current: Math.min(statistics.totalSessions, 7),\n        unit: 'sessions/week',\n        deadline: addDays(new Date(), 7),\n        priority: 'high',\n        category: 'frequency',\n      },\n      {\n        id: 'session-quality',\n        title: 'Session Quality',\n        description: 'Achieve high-quality data collection',\n        target: 80,\n        current: Math.round(statistics.averageQuality),\n        unit: '% quality',\n        priority: 'high',\n        category: 'quality',\n      },\n      {\n        id: 'data-points',\n        title: 'Data Points per Session',\n        description: 'Collect comprehensive data in each session',\n        target: 10,\n        current: Math.round(statistics.averageDataPoints),\n        unit: 'points',\n        priority: 'medium',\n        category: 'quality',\n      },\n      {\n        id: 'session-duration',\n        title: 'Session Duration',\n        description: 'Spend adequate time on observation',\n        target: 10,\n        current: Math.round(statistics.averageDuration / 60000),\n        unit: 'minutes',\n        priority: 'medium',\n        category: 'quality',\n      },\n      {\n        id: 'completion-rate',\n        title: 'Completion Rate',\n        description: 'Complete sessions without abandoning',\n        target: 90,\n        current: statistics.totalSessions > 0 \n          ? Math.round((statistics.completedSessions / statistics.totalSessions) * 100)\n          : 0,\n        unit: '% completed',\n        priority: 'low',\n        category: 'frequency',\n      },\n    ];\n\n    return goals;\n  }, [statistics]);\n\n  // Define data collection strategies\n  const strategies = useMemo<DataCollectionStrategy[]>(() => [\n    {\n      id: 'scheduled-sessions',\n      name: 'Scheduled Sessions',\n      description: 'Set specific times for daily data collection',\n      benefits: [\n        'Creates consistent routine',\n        'Improves data reliability',\n        'Reduces forgotten sessions',\n      ],\n      implementation: [\n        'Choose a consistent time each day',\n        'Set reminders or alarms',\n        'Link to existing routines (e.g., after meals)',\n        'Start with 5-minute sessions',\n      ],\n      difficulty: 'easy',\n      timeRequired: '5-10 minutes/day',\n      effectiveness: 5,\n    },\n    {\n      id: 'quick-capture',\n      name: 'Quick Capture Mode',\n      description: 'Use rapid data entry for busy moments',\n      benefits: [\n        'Captures more frequent data',\n        'Reduces session abandonment',\n        'Works in time-constrained situations',\n      ],\n      implementation: [\n        'Focus on key emotions first',\n        'Add sensory data if time permits',\n        'Use voice notes for context',\n        'Save partial sessions frequently',\n      ],\n      difficulty: 'easy',\n      timeRequired: '2-3 minutes',\n      effectiveness: 4,\n    },\n    {\n      id: 'environmental-triggers',\n      name: 'Environmental Triggers',\n      description: 'Link data collection to environmental changes',\n      benefits: [\n        'Captures transition moments',\n        'Identifies environmental patterns',\n        'Natural reminder system',\n      ],\n      implementation: [\n        'Record when entering new spaces',\n        'Note changes in noise/lighting',\n        'Track before/after activities',\n        'Document unexpected changes',\n      ],\n      difficulty: 'medium',\n      timeRequired: '3-5 minutes/trigger',\n      effectiveness: 4,\n    },\n    {\n      id: 'collaborative-collection',\n      name: 'Collaborative Collection',\n      description: 'Involve caregivers or teachers in observation',\n      benefits: [\n        'Multiple perspectives',\n        'More comprehensive data',\n        'Shared understanding',\n      ],\n      implementation: [\n        'Share observation guidelines',\n        'Rotate collection responsibilities',\n        'Compare observations',\n        'Weekly review meetings',\n      ],\n      difficulty: 'medium',\n      timeRequired: '10-15 minutes/session',\n      effectiveness: 5,\n    },\n    {\n      id: 'thematic-focus',\n      name: 'Thematic Focus Days',\n      description: 'Focus on specific aspects each day',\n      benefits: [\n        'Deeper insights per area',\n        'Reduces cognitive load',\n        'Improves data quality',\n      ],\n      implementation: [\n        'Monday: Emotions focus',\n        'Tuesday: Sensory responses',\n        'Wednesday: Environmental factors',\n        'Thursday: Social interactions',\n        'Friday: Comprehensive review',\n      ],\n      difficulty: 'easy',\n      timeRequired: '5-10 minutes/day',\n      effectiveness: 4,\n    },\n  ], []);\n\n  // Get recommended strategies based on current issues\n  const recommendedStrategies = useMemo(() => {\n    if (!statistics) return [];\n\n    const recommendations = [];\n    \n    // Low frequency: recommend scheduled sessions\n    if (statistics.totalSessions < 5) {\n      recommendations.push('scheduled-sessions');\n    }\n\n    // Low quality: recommend thematic focus\n    if (statistics.averageQuality < 50) {\n      recommendations.push('thematic-focus');\n    }\n\n    // Short sessions: recommend quick capture\n    if (statistics.averageDuration < 5 * 60 * 1000) {\n      recommendations.push('quick-capture');\n    }\n\n    // High abandonment: recommend environmental triggers\n    if (statistics.abandonedSessions > statistics.completedSessions * 0.2) {\n      recommendations.push('environmental-triggers');\n    }\n\n    return strategies.filter(s => recommendations.includes(s.id));\n  }, [statistics, strategies]);\n\n  const toggleStrategy = (strategyId: string) => {\n    setActiveStrategies(prev => \n      prev.includes(strategyId) \n        ? prev.filter(id => id !== strategyId)\n        : [...prev, strategyId]\n    );\n  };\n\n  if (!statistics) {\n    return (\n      <Card className={cn('bg-gradient-card border-0 shadow-soft', className)}>\n        <CardContent className=\"py-8 text-center\">\n          <Activity className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n          <p className=\"text-muted-foreground\">No data collection history yet</p>\n          <p className=\"text-sm text-muted-foreground mt-2\">\n            Start your first session to see monitoring insights\n          </p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className={cn('space-y-4', className)}>\n      {/* Statistics Overview */}\n      {showStatistics && (\n        <Card className=\"bg-gradient-card border-0 shadow-soft\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Activity className=\"h-5 w-5\" />\n              Collection Overview\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\n              <div className=\"text-center p-3 rounded-lg bg-muted/50\">\n                <p className=\"text-2xl font-bold\">{statistics.totalSessions}</p>\n                <p className=\"text-xs text-muted-foreground\">Total Sessions</p>\n              </div>\n              <div className=\"text-center p-3 rounded-lg bg-muted/50\">\n                <p className=\"text-2xl font-bold\">\n                  {statistics.totalSessions > 0 \n                    ? Math.round((statistics.completedSessions / statistics.totalSessions) * 100)\n                    : 0}%\n                </p>\n                <p className=\"text-xs text-muted-foreground\">Completion Rate</p>\n              </div>\n              <div className=\"text-center p-3 rounded-lg bg-muted/50\">\n                <p className=\"text-2xl font-bold\">\n                  {Math.round(statistics.averageQuality)}%\n                </p>\n                <p className=\"text-xs text-muted-foreground\">Avg Quality</p>\n              </div>\n              <div className=\"text-center p-3 rounded-lg bg-muted/50\">\n                <p className=\"text-2xl font-bold\">\n                  {Math.round(statistics.averageDuration / 60000)}m\n                </p>\n                <p className=\"text-xs text-muted-foreground\">Avg Duration</p>\n              </div>\n            </div>\n\n            {/* Common Issues */}\n            {statistics.mostCommonIssues.length > 0 && (\n              <div className=\"space-y-2\">\n                <h4 className=\"text-sm font-medium flex items-center gap-2\">\n                  <AlertCircle className=\"h-4 w-4 text-yellow-500\" />\n                  Common Issues\n                </h4>\n                <div className=\"space-y-1\">\n                  {statistics.mostCommonIssues.slice(0, 3).map((issue) => (\n                    <div key={issue.issue} className=\"flex items-center justify-between text-sm\">\n                      <span className=\"text-muted-foreground\">{issue.issue}</span>\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        {issue.count} times\n                      </Badge>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Collection Goals */}\n      <Card className=\"bg-gradient-card border-0 shadow-soft\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Target className=\"h-5 w-5\" />\n            Collection Goals\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-3\">\n            {collectionGoals.map((goal) => {\n              const progress = Math.min(100, (goal.current / goal.target) * 100);\n              const isAchieved = progress >= 100;\n\n              return (\n                <div key={goal.id} className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2\">\n                      {isAchieved ? (\n                        <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                      ) : (\n                        <Activity className=\"h-4 w-4 text-muted-foreground\" />\n                      )}\n                      <span className=\"text-sm font-medium\">{goal.title}</span>\n                      <Badge \n                        variant={\n                          goal.priority === 'high' ? 'destructive' : \n                          goal.priority === 'medium' ? 'secondary' : \n                          'outline'\n                        }\n                        className=\"text-xs\"\n                      >\n                        {goal.priority}\n                      </Badge>\n                    </div>\n                    <span className=\"text-sm text-muted-foreground\">\n                      {goal.current}/{goal.target} {goal.unit}\n                    </span>\n                  </div>\n                  <Progress \n                    value={progress} \n                    className={cn('h-2', isAchieved && 'bg-green-100')}\n                  />\n                  {!isAchieved && goal.deadline && (\n                    <p className=\"text-xs text-muted-foreground flex items-center gap-1\">\n                      <Calendar className=\"h-3 w-3\" />\n                      Target by {format(goal.deadline, 'MMM d')}\n                    </p>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Recommended Strategies */}\n      {showRecommendations && recommendedStrategies.length > 0 && (\n        <Card className=\"bg-gradient-card border-0 shadow-soft\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Sparkles className=\"h-5 w-5 text-yellow-500\" />\n              Recommended Strategies\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {recommendedStrategies.map((strategy) => (\n                <div\n                  key={strategy.id}\n                  className={cn(\n                    'p-3 rounded-lg border transition-all',\n                    activeStrategies.includes(strategy.id) \n                      ? 'border-primary bg-primary/5' \n                      : 'border-border',\n                    expandedStrategy === strategy.id && 'bg-muted/50'\n                  )}\n                >\n                  <div \n                    role=\"button\"\n                    tabIndex={0}\n                    aria-expanded={expandedStrategy === strategy.id}\n                    aria-controls={`strategy-details-${strategy.id}`}\n                    id={`strategy-toggle-${strategy.id}`}\n                    className=\"flex items-start justify-between cursor-pointer\"\n                    onClick={() => setExpandedStrategy(\n                      expandedStrategy === strategy.id ? null : strategy.id\n                    )}\n                    onKeyDown={(e) => {\n                      if (e.key === 'Enter' || e.key === ' ') {\n                        e.preventDefault();\n                        setExpandedStrategy(expandedStrategy === strategy.id ? null : strategy.id);\n                      }\n                    }}\n                  >\n                    <div className=\"flex-1\">\n                      <h4 className=\"font-medium text-sm flex items-center gap-2\">\n                        {strategy.name}\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          {strategy.difficulty}\n                        </Badge>\n                      </h4>\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        {strategy.description}\n                      </p>\n                      <div className=\"flex items-center gap-3 mt-2 text-xs\">\n                        <span className=\"flex items-center gap-1\">\n                          <Clock className=\"h-3 w-3\" />\n                          {strategy.timeRequired}\n                        </span>\n                        <span className=\"flex items-center gap-1\">\n                          Effectiveness: \n                          {'★'.repeat(strategy.effectiveness)}\n                          {'☆'.repeat(5 - strategy.effectiveness)}\n                        </span>\n                      </div>\n                    </div>\n                    <ChevronRight \n                      className={cn(\n                        'h-4 w-4 transition-transform',\n                        expandedStrategy === strategy.id && 'rotate-90'\n                      )}\n                    />\n                  </div>\n\n                  {expandedStrategy === strategy.id && (\n                    <div\n                      id={`strategy-details-${strategy.id}`}\n                      aria-labelledby={`strategy-toggle-${strategy.id}`}\n                      className=\"mt-3 pt-3 border-t space-y-3\"\n                    >\n                      <div>\n                        <h5 className=\"text-xs font-medium mb-1\">Benefits:</h5>\n                        <ul className=\"text-xs text-muted-foreground space-y-1\">\n                          {strategy.benefits.map((benefit, i) => (\n                            <li key={i} className=\"flex items-start gap-1\">\n                              <CheckCircle className=\"h-3 w-3 text-green-500 mt-0.5\" />\n                              {benefit}\n                            </li>\n                          ))}\n                        </ul>\n                      </div>\n\n                      <div>\n                        <h5 className=\"text-xs font-medium mb-1\">How to implement:</h5>\n                        <ul className=\"text-xs text-muted-foreground space-y-1\">\n                          {strategy.implementation.map((step, i) => (\n                            <li key={i} className=\"flex items-start gap-1\">\n                              <span className=\"text-primary font-medium\">{i + 1}.</span>\n                              {step}\n                            </li>\n                          ))}\n                        </ul>\n                      </div>\n\n                      <Button\n                        size=\"sm\"\n                        variant={activeStrategies.includes(strategy.id) ? 'secondary' : 'default'}\n                        onClick={(e) => {\n                          e.stopPropagation();\n                          toggleStrategy(strategy.id);\n                        }}\n                        className=\"w-full\"\n                      >\n                        {activeStrategies.includes(strategy.id) ? 'Strategy Active' : 'Activate Strategy'}\n                      </Button>\n                    </div>\n                  )}\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Active Strategies Reminder */}\n      {activeStrategies.length > 0 && (\n        <Alert>\n          <Info className=\"h-4 w-4\" />\n          <AlertDescription>\n            You have {activeStrategies.length} active {activeStrategies.length === 1 ? 'strategy' : 'strategies'}.\n            Remember to apply {activeStrategies.length === 1 ? 'it' : 'them'} in your next session!\n          </AlertDescription>\n        </Alert>\n      )}\n    </div>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/tracking/SessionIndicator.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used. Allowed unused vars must match /^_/u.","line":15,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":13},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'formatDuration' is defined but never used. Allowed unused vars must match /^_/u.","line":18,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":18,"endColumn":24},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"emotions\"","line":78,"column":33,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":79,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\" className=\"text-xs\">\n          {quality.emotionCount} emotions\n        </Badge>","line":78,"column":33,"nodeType":"JSXText","endLine":79,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"sensory\"","line":81,"column":33,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":82,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\" className=\"text-xs\">\n          {quality.sensoryCount} sensory\n        </Badge>","line":81,"column":33,"nodeType":"JSXText","endLine":82,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Active Session\"","line":111,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":111,"endColumn":67},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"font-semibold text-sm\">Active Session</h3>","line":111,"column":53,"nodeType":"JSXText","endLine":111,"endColumn":67},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Data Quality\"","line":127,"column":63,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":127,"endColumn":75},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs text-muted-foreground\">Data Quality</span>","line":127,"column":63,"nodeType":"JSXText","endLine":127,"endColumn":75},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotions\"","line":139,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":139,"endColumn":68},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground\">Emotions</p>","line":139,"column":60,"nodeType":"JSXText","endLine":139,"endColumn":68},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory\"","line":143,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":143,"endColumn":67},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground\">Sensory</p>","line":143,"column":60,"nodeType":"JSXText","endLine":143,"endColumn":67},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Environment\"","line":149,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":149,"endColumn":71},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground\">Environment</p>","line":149,"column":60,"nodeType":"JSXText","endLine":149,"endColumn":71},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Last saved\"","line":158,"column":19,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":159,"endColumn":26},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>\n              Last saved {new Date(quality.lastSaved).toLocaleTimeString()}\n            </span>","line":158,"column":19,"nodeType":"JSXText","endLine":159,"endColumn":26},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Resume\"","line":174,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":176,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={resumeSession}\n                className=\"flex-1\"\n              >\n                <Play className=\"h-4 w-4 mr-2\" />\n                Resume\n              </Button>","line":174,"column":50,"nodeType":"JSXText","endLine":176,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Pause\"","line":184,"column":51,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":186,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={pauseSession}\n                className=\"flex-1\"\n              >\n                <Pause className=\"h-4 w-4 mr-2\" />\n                Pause\n              </Button>","line":184,"column":51,"nodeType":"JSXText","endLine":186,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Save\"","line":196,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":198,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n              size=\"sm\"\n              variant=\"default\"\n              onClick={saveSession}\n              className=\"flex-1\"\n              disabled={quality.completeness < 20}\n            >\n              <Save className=\"h-4 w-4 mr-2\" />\n              Save\n            </Button>","line":196,"column":48,"nodeType":"JSXText","endLine":198,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Add more data to improve session quality\"","line":214,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":216,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-warning\">\n              Add more data to improve session quality\n            </p>","line":214,"column":49,"nodeType":"JSXText","endLine":216,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":26,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { \n  Clock, \n  Pause, \n  Play, \n  Save, \n  X, \n  AlertCircle,\n  CheckCircle,\n  Activity,\n  TrendingUp\n} from 'lucide-react';\nimport { useTracking } from '@/contexts/TrackingContext';\nimport { formatDuration } from 'date-fns';\nimport { cn } from '@/lib/utils';\n\ninterface SessionIndicatorProps {\n  className?: string;\n  compact?: boolean;\n  showControls?: boolean;\n}\n\n/**\n * SessionIndicator Component\n * Displays current session status, quality metrics, and controls\n */\nexport const SessionIndicator: React.FC<SessionIndicatorProps> = ({\n  className,\n  compact = false,\n  showControls = true,\n}) => {\n  const {\n    currentSession,\n    pauseSession,\n    resumeSession,\n    saveSession,\n    discardSession,\n    getDataQuality,\n  } = useTracking();\n\n  const quality = useMemo(() => getDataQuality(), [getDataQuality]);\n\n  const sessionDuration = useMemo(() => {\n    if (!currentSession) return '00:00';\n    const duration = Date.now() - currentSession.startTime.getTime();\n    const minutes = Math.floor(duration / 60000);\n    const seconds = Math.floor((duration % 60000) / 1000);\n    return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n  }, [currentSession]);\n\n  if (!currentSession) {\n    return null;\n  }\n\n  const getStatusColor = () => {\n    if (currentSession.isPaused) return 'bg-warning';\n    if (quality.completeness >= 70) return 'bg-success';\n    if (quality.completeness >= 40) return 'bg-info';\n    return 'bg-gray-500';\n  };\n\n  const getQualityIcon = () => {\n    if (quality.completeness >= 70) return <CheckCircle className=\"h-4 w-4\" />;\n    if (quality.completeness >= 40) return <Activity className=\"h-4 w-4\" />;\n    return <AlertCircle className=\"h-4 w-4\" />;\n  };\n\n  if (compact) {\n    return (\n      <div className={cn('flex items-center gap-2 p-2 rounded-lg bg-background/80 backdrop-blur', className)}>\n        <div className={cn('w-2 h-2 rounded-full animate-pulse', getStatusColor())} />\n        <span className=\"text-sm font-medium\">{sessionDuration}</span>\n        <Badge variant=\"outline\" className=\"text-xs\">\n          {quality.emotionCount} emotions\n        </Badge>\n        <Badge variant=\"outline\" className=\"text-xs\">\n          {quality.sensoryCount} sensory\n        </Badge>\n        {showControls && (\n          <div className=\"flex gap-1 ml-auto\">\n            {currentSession.isPaused ? (\n              <Button size=\"icon\" variant=\"ghost\" onClick={resumeSession} className=\"h-6 w-6\">\n                <Play className=\"h-3 w-3\" />\n              </Button>\n            ) : (\n              <Button size=\"icon\" variant=\"ghost\" onClick={pauseSession} className=\"h-6 w-6\">\n                <Pause className=\"h-3 w-3\" />\n              </Button>\n            )}\n            <Button size=\"icon\" variant=\"ghost\" onClick={saveSession} className=\"h-6 w-6\">\n              <Save className=\"h-3 w-3\" />\n            </Button>\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <Card className={cn('bg-gradient-card border-0 shadow-soft', className)}>\n      <CardContent className=\"p-4\">\n        {/* Session Header */}\n        <div className=\"flex items-center justify-between mb-4\">\n          <div className=\"flex items-center gap-3\">\n            <div className={cn('w-3 h-3 rounded-full animate-pulse', getStatusColor())} />\n            <div>\n              <h3 className=\"font-semibold text-sm\">Active Session</h3>\n              <p className=\"text-xs text-muted-foreground\">\n                {currentSession.isPaused ? 'Paused' : 'Recording'}\n              </p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Clock className=\"h-4 w-4 text-muted-foreground\" />\n            <span className=\"font-mono text-sm font-medium\">{sessionDuration}</span>\n          </div>\n        </div>\n\n        {/* Quality Metrics */}\n        <div className=\"space-y-3 mb-4\">\n          <div>\n            <div className=\"flex items-center justify-between mb-1\">\n              <span className=\"text-xs text-muted-foreground\">Data Quality</span>\n              <div className=\"flex items-center gap-1\">\n                {getQualityIcon()}\n                <span className=\"text-xs font-medium\">{quality.completeness}%</span>\n              </div>\n            </div>\n            <Progress value={quality.completeness} className=\"h-2\" />\n          </div>\n\n          <div className=\"grid grid-cols-3 gap-2 text-center\">\n            <div className=\"p-2 rounded bg-muted/50\">\n              <p className=\"text-lg font-semibold\">{quality.emotionCount}</p>\n              <p className=\"text-xs text-muted-foreground\">Emotions</p>\n            </div>\n            <div className=\"p-2 rounded bg-muted/50\">\n              <p className=\"text-lg font-semibold\">{quality.sensoryCount}</p>\n              <p className=\"text-xs text-muted-foreground\">Sensory</p>\n            </div>\n            <div className=\"p-2 rounded bg-muted/50\">\n              <p className=\"text-lg font-semibold\">\n                {quality.hasEnvironmental ? '✓' : '—'}\n              </p>\n              <p className=\"text-xs text-muted-foreground\">Environment</p>\n            </div>\n          </div>\n        </div>\n\n        {/* Last Saved Indicator */}\n        {quality.lastSaved && (\n          <div className=\"flex items-center gap-2 mb-3 text-xs text-muted-foreground\">\n            <CheckCircle className=\"h-3 w-3 text-green-500\" />\n            <span>\n              Last saved {new Date(quality.lastSaved).toLocaleTimeString()}\n            </span>\n          </div>\n        )}\n\n        {/* Session Controls */}\n        {showControls && (\n          <div className=\"flex gap-2\">\n            {currentSession.isPaused ? (\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={resumeSession}\n                className=\"flex-1\"\n              >\n                <Play className=\"h-4 w-4 mr-2\" />\n                Resume\n              </Button>\n            ) : (\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={pauseSession}\n                className=\"flex-1\"\n              >\n                <Pause className=\"h-4 w-4 mr-2\" />\n                Pause\n              </Button>\n            )}\n            \n            <Button\n              size=\"sm\"\n              variant=\"default\"\n              onClick={saveSession}\n              className=\"flex-1\"\n              disabled={quality.completeness < 20}\n            >\n              <Save className=\"h-4 w-4 mr-2\" />\n              Save\n            </Button>\n\n            <Button\n              size=\"sm\"\n              variant=\"ghost\"\n              onClick={discardSession}\n              className=\"px-2\"\n            >\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        )}\n\n        {/* Quality Warnings */}\n        {quality.completeness < 20 && !currentSession.isPaused && (\n          <div className=\"mt-3 p-2 rounded bg-warning/10 border border-warning/20\">\n            <p className=\"text-xs text-warning\">\n              Add more data to improve session quality\n            </p>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/tracking/SessionRecovery.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Save' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":7},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sessions' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":37,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1119,1122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1119,1122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Unsaved Session Found\"","line":104,"column":21,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":104,"endColumn":42},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <AlertTitle>Unsaved Session Found</AlertTitle>","line":104,"column":21,"nodeType":"JSXText","endLine":104,"endColumn":42},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"You have an incomplete session from\"","line":106,"column":39,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":107,"endColumn":49},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm mb-3\">\n            You have an incomplete session from {age} with {session.metadata.dataPoints} data points.\n          </p>","line":106,"column":39,"nodeType":"JSXText","endLine":107,"endColumn":49},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"with\"","line":107,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":107,"endColumn":60},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm mb-3\">\n            You have an incomplete session from {age} with {session.metadata.dataPoints} data points.\n          </p>","line":107,"column":54,"nodeType":"JSXText","endLine":107,"endColumn":60},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"data points.\"","line":107,"column":89,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":108,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm mb-3\">\n            You have an incomplete session from {age} with {session.metadata.dataPoints} data points.\n          </p>","line":107,"column":89,"nodeType":"JSXText","endLine":108,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Recovering...\"","line":118,"column":70,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":120,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Resume Session\"","line":123,"column":57,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":125,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <>\n                  <RefreshCw className=\"h-4 w-4 mr-2\" />\n                  Resume Session\n                </>","line":123,"column":57,"nodeType":"JSXText","endLine":125,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Discard\"","line":133,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":135,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n              size=\"sm\"\n              variant=\"ghost\"\n              onClick={() => handleDiscard(session.sessionId)}\n            >\n              <Trash2 className=\"h-4 w-4 mr-2\" />\n              Discard\n            </Button>","line":133,"column":50,"nodeType":"JSXText","endLine":135,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Recoverable Sessions\"","line":149,"column":19,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":149,"endColumn":39},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Recoverable Sessions</span>","line":149,"column":19,"nodeType":"JSXText","endLine":149,"endColumn":39},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Found\"","line":155,"column":59,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":156,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground mb-4\">\n          Found {recoverableSessions.length} incomplete session(s) that can be recovered.\n        </p>","line":155,"column":59,"nodeType":"JSXText","endLine":156,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"incomplete session(s) that can be recovered.\"","line":156,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":157,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground mb-4\">\n          Found {recoverableSessions.length} incomplete session(s) that can be recovered.\n        </p>","line":156,"column":45,"nodeType":"JSXText","endLine":157,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Started\"","line":177,"column":59,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":177,"endColumn":67},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-sm font-medium\">Started {age}</span>","line":177,"column":59,"nodeType":"JSXText","endLine":177,"endColumn":67},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"data points\"","line":190,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":190,"endColumn":68},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>{session.metadata.dataPoints} data points</span>","line":190,"column":56,"nodeType":"JSXText","endLine":190,"endColumn":68},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"m\"","line":194,"column":74,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":194,"endColumn":75},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>{Math.floor(session.metadata.duration / 60000)}m</span>","line":194,"column":74,"nodeType":"JSXText","endLine":194,"endColumn":75},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Quality:\"","line":197,"column":61,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":197,"endColumn":69},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-muted-foreground\">Quality:</span>","line":197,"column":61,"nodeType":"JSXText","endLine":197,"endColumn":69},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"emotions\"","line":206,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":207,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\" className=\"text-xs\">\n                      {session.data.emotions.length} emotions\n                    </Badge>","line":206,"column":53,"nodeType":"JSXText","endLine":207,"endColumn":21},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"sensory\"","line":211,"column":58,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":212,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\" className=\"text-xs\">\n                      {session.data.sensoryInputs.length} sensory\n                    </Badge>","line":211,"column":58,"nodeType":"JSXText","endLine":212,"endColumn":21},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Environmental\"","line":215,"column":66,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":217,"endColumn":21},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"outline\" className=\"text-xs\">\n                      Environmental\n                    </Badge>","line":215,"column":66,"nodeType":"JSXText","endLine":217,"endColumn":21},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Recovering...\"","line":231,"column":76,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":233,"endColumn":23},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Resume\"","line":236,"column":63,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":238,"endColumn":23},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <>\n                        <RefreshCw className=\"h-3 w-3 mr-1\" />\n                        Resume\n                      </>","line":236,"column":63,"nodeType":"JSXText","endLine":238,"endColumn":23},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Discard All\"","line":261,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":263,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n            size=\"sm\"\n            variant=\"ghost\"\n            onClick={handleDiscardAll}\n            className=\"text-destructive\"\n          >\n            <Trash2 className=\"h-4 w-4 mr-2\" />\n            Discard All\n          </Button>","line":261,"column":48,"nodeType":"JSXText","endLine":263,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":43,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useCallback } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';\nimport { \n  Clock, \n  RefreshCw, \n  Trash2, \n  Save,\n  AlertTriangle,\n  User,\n  Calendar,\n  Activity\n} from 'lucide-react';\nimport { useTracking } from '@/contexts/TrackingContext';\nimport { sessionManager } from '@/lib/sessionManager';\nimport { formatDistanceToNow } from 'date-fns';\nimport { cn } from '@/lib/utils';\nimport { logger } from '@/lib/logger';\n\ninterface SessionRecoveryProps {\n  studentId?: string;\n  className?: string;\n  autoRecover?: boolean;\n}\n\n/**\n * SessionRecovery Component\n * Handles recovery of abandoned or interrupted sessions\n */\nexport const SessionRecovery: React.FC<SessionRecoveryProps> = ({\n  studentId,\n  className,\n  autoRecover = false,\n}) => {\n  const { recoverSession, sessions } = useTracking();\n  const [recoverableSessions, setRecoverableSessions] = useState<any[]>([]);\n  const [isRecovering, setIsRecovering] = useState(false);\n  const [selectedSession, setSelectedSession] = useState<string | null>(null);\n\n  const handleRecover = useCallback(async (sessionId: string) => {\n    setIsRecovering(true);\n    setSelectedSession(sessionId);\n    \n    try {\n      recoverSession(sessionId);\n      // Remove from recoverable list\n      setRecoverableSessions(prev => \n        prev.filter(s => s.sessionId !== sessionId)\n      );\n    } catch (error) {\n      logger.error('Failed to recover session', error as Error);\n    } finally {\n      setIsRecovering(false);\n      setSelectedSession(null);\n    }\n  }, [recoverSession]);\n\n  const checkSessions = useCallback(() => {\n    const recovered = sessionManager.recoverSessions();\n    const filtered = studentId \n      ? recovered.filter(s => s.studentId === studentId)\n      : recovered;\n    setRecoverableSessions(filtered);\n\n    if (autoRecover && filtered.length === 1) {\n      handleRecover(filtered[0].sessionId);\n    }\n  }, [studentId, autoRecover, handleRecover]);\n\n  useEffect(() => {\n    checkSessions();\n  }, [checkSessions]);\n\n  \n\n  const handleDiscard = (sessionId: string) => {\n    sessionManager.abandonSession(sessionId);\n    setRecoverableSessions(prev => \n      prev.filter(s => s.sessionId !== sessionId)\n    );\n  };\n\n  const handleDiscardAll = () => {\n    recoverableSessions.forEach(session => {\n      sessionManager.abandonSession(session.sessionId);\n    });\n    setRecoverableSessions([]);\n  };\n\n  if (recoverableSessions.length === 0) {\n    return null;\n  }\n\n  // Compact alert for single recoverable session\n  if (recoverableSessions.length === 1) {\n    const session = recoverableSessions[0];\n    const age = formatDistanceToNow(new Date(session.metadata.startTime), { addSuffix: true });\n    \n    return (\n      <Alert className={cn('border-yellow-500/50 bg-yellow-500/10', className)}>\n        <AlertTriangle className=\"h-4 w-4\" />\n        <AlertTitle>Unsaved Session Found</AlertTitle>\n        <AlertDescription className=\"mt-2\">\n          <p className=\"text-sm mb-3\">\n            You have an incomplete session from {age} with {session.metadata.dataPoints} data points.\n          </p>\n          <div className=\"flex gap-2\">\n            <Button\n              size=\"sm\"\n              variant=\"default\"\n              onClick={() => handleRecover(session.sessionId)}\n              disabled={isRecovering}\n            >\n              {isRecovering ? (\n                <>\n                  <RefreshCw className=\"h-4 w-4 mr-2 animate-spin\" />\n                  Recovering...\n                </>\n              ) : (\n                <>\n                  <RefreshCw className=\"h-4 w-4 mr-2\" />\n                  Resume Session\n                </>\n              )}\n            </Button>\n            <Button\n              size=\"sm\"\n              variant=\"ghost\"\n              onClick={() => handleDiscard(session.sessionId)}\n            >\n              <Trash2 className=\"h-4 w-4 mr-2\" />\n              Discard\n            </Button>\n          </div>\n        </AlertDescription>\n      </Alert>\n    );\n  }\n\n  // Full card for multiple recoverable sessions\n  return (\n    <Card className={cn('bg-gradient-card border-0 shadow-soft', className)}>\n      <CardHeader>\n        <CardTitle className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <AlertTriangle className=\"h-5 w-5 text-yellow-500\" />\n            <span>Recoverable Sessions</span>\n          </div>\n          <Badge variant=\"outline\">{recoverableSessions.length}</Badge>\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <p className=\"text-sm text-muted-foreground mb-4\">\n          Found {recoverableSessions.length} incomplete session(s) that can be recovered.\n        </p>\n\n        <div className=\"space-y-3 mb-4 max-h-64 overflow-y-auto\">\n          {recoverableSessions.map((session) => {\n            const age = formatDistanceToNow(new Date(session.metadata.startTime), { addSuffix: true });\n            const quality = session.metadata.quality;\n            \n            return (\n              <div\n                key={session.sessionId}\n                className={cn(\n                  'p-3 rounded-lg border transition-colors',\n                  selectedSession === session.sessionId \n                    ? 'border-primary bg-primary/5' \n                    : 'border-border hover:bg-muted/50'\n                )}\n              >\n                <div className=\"flex items-start justify-between mb-2\">\n                  <div className=\"flex items-center gap-2\">\n                    <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                    <span className=\"text-sm font-medium\">Started {age}</span>\n                  </div>\n                  <Badge \n                    variant={session.metadata.status === 'paused' ? 'secondary' : 'outline'}\n                    className=\"text-xs\"\n                  >\n                    {session.metadata.status}\n                  </Badge>\n                </div>\n\n                <div className=\"grid grid-cols-3 gap-2 text-xs mb-3\">\n                  <div className=\"flex items-center gap-1\">\n                    <Activity className=\"h-3 w-3 text-muted-foreground\" />\n                    <span>{session.metadata.dataPoints} data points</span>\n                  </div>\n                  <div className=\"flex items-center gap-1\">\n                    <Clock className=\"h-3 w-3 text-muted-foreground\" />\n                    <span>{Math.floor(session.metadata.duration / 60000)}m</span>\n                  </div>\n                  <div className=\"flex items-center gap-1\">\n                    <span className=\"text-muted-foreground\">Quality:</span>\n                    <span className=\"font-medium\">{quality.score}%</span>\n                  </div>\n                </div>\n\n                {/* Data summary */}\n                <div className=\"flex gap-2 mb-3\">\n                  {session.data.emotions.length > 0 && (\n                    <Badge variant=\"outline\" className=\"text-xs\">\n                      {session.data.emotions.length} emotions\n                    </Badge>\n                  )}\n                  {session.data.sensoryInputs.length > 0 && (\n                    <Badge variant=\"outline\" className=\"text-xs\">\n                      {session.data.sensoryInputs.length} sensory\n                    </Badge>\n                  )}\n                  {session.data.environmentalData && (\n                    <Badge variant=\"outline\" className=\"text-xs\">\n                      Environmental\n                    </Badge>\n                  )}\n                </div>\n\n                <div className=\"flex gap-2\">\n                  <Button\n                    size=\"sm\"\n                    variant=\"default\"\n                    onClick={() => handleRecover(session.sessionId)}\n                    disabled={isRecovering && selectedSession === session.sessionId}\n                    className=\"flex-1\"\n                  >\n                    {isRecovering && selectedSession === session.sessionId ? (\n                      <>\n                        <RefreshCw className=\"h-3 w-3 mr-1 animate-spin\" />\n                        Recovering...\n                      </>\n                    ) : (\n                      <>\n                        <RefreshCw className=\"h-3 w-3 mr-1\" />\n                        Resume\n                      </>\n                    )}\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    variant=\"ghost\"\n                    onClick={() => handleDiscard(session.sessionId)}\n                  >\n                    <Trash2 className=\"h-3 w-3\" />\n                  </Button>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n\n        <div className=\"flex justify-end pt-3 border-t\">\n          <Button\n            size=\"sm\"\n            variant=\"ghost\"\n            onClick={handleDiscardAll}\n            className=\"text-destructive\"\n          >\n            <Trash2 className=\"h-4 w-4 mr-2\" />\n            Discard All\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/Breadcrumbs.tsx","messages":[{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":33,"column":22,"nodeType":"TemplateLiteral","messageId":"noArrayIndex","endLine":33,"endColumn":44}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { Link } from 'react-router-dom';\nimport { cn } from '@/lib/utils';\n\nexport interface BreadcrumbItem {\n  label: string;\n  href?: string;\n  current?: boolean;\n}\n\ninterface BreadcrumbsProps {\n  items: BreadcrumbItem[];\n  className?: string;\n}\n\nexport const Breadcrumbs: React.FC<BreadcrumbsProps> = ({ items, className }) => {\n  if (!items || items.length === 0) return null;\n  return (\n    <nav aria-label=\"Breadcrumb\" className={cn('text-xs text-muted-foreground', className)}>\n      <ol className=\"flex items-center gap-1\">\n        {items.map((item, idx) => {\n          const isLast = idx === items.length - 1;\n          const content = item.href && !item.current && !isLast ? (\n            <Link to={item.href} className=\"hover:underline\">\n              {item.label}\n            </Link>\n          ) : (\n            <span className={cn(item.current || isLast ? 'text-foreground' : undefined)} aria-current={item.current || isLast ? 'page' : undefined}>\n              {item.label}\n            </span>\n          );\n          return (\n            <li key={`${item.label}-${idx}`} className=\"flex items-center gap-1\">\n              {content}\n              {!isLast && <span aria-hidden=\"true\">/</span>}\n            </li>\n          );\n        })}\n      </ol>\n    </nav>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/FloatingActionButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/PageButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/PremiumStatsCard.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"% fra forrige uke\"","line":100,"column":38,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":101,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <motion.div\n              initial={{ opacity: 0, x: -10 }}\n              animate={{ opacity: 1, x: 0 }}\n              transition={{ delay: 0.5 }}\n              className={cn(\n                \"text-xs flex items-center gap-1\",\n                trend.isPositive ? \"text-positive\" : \"text-destructive\"\n              )}\n            >\n              <span className={cn(\n                \"inline-block w-0 h-0 border-l-[3px] border-r-[3px] border-l-transparent border-r-transparent\",\n                trend.isPositive \n                  ? \"border-b-[4px] border-b-positive\" \n                  : \"border-t-[4px] border-t-destructive\"\n              )} />\n              {Math.abs(trend.value)}% fra forrige uke\n            </motion.div>","line":100,"column":38,"nodeType":"JSXText","endLine":101,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { motion } from 'framer-motion';\nimport { LucideIcon } from 'lucide-react';\nimport { AnimatedCounter } from './AnimatedCounter';\nimport { cn } from '@/lib/utils';\n\ninterface PremiumStatsCardProps {\n  title: string;\n  value: number;\n  icon: LucideIcon;\n  index: number;\n  isLoading?: boolean;\n  loadingText?: string;\n  trend?: {\n    value: number;\n    isPositive: boolean;\n  };\n}\n\nexport const PremiumStatsCard = ({ \n  title, \n  value, \n  icon: Icon, \n  index, \n  isLoading = false,\n  loadingText = \"Loading...\",\n  trend \n}: PremiumStatsCardProps) => {\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 60, scale: 0.9 }}\n      animate={{ opacity: 1, y: 0, scale: 1 }}\n      transition={{ \n        duration: 0.6,\n        delay: index * 0.1,\n        type: \"spring\",\n        stiffness: 120,\n        damping: 15\n      }}\n      whileHover={{ \n        scale: 1.02,\n        transition: { duration: 0.2 }\n      }}\n      className=\"group\"\n    >\n      <Card className=\"relative overflow-hidden bg-gradient-card border-0 shadow-soft hover:shadow-elegant transition-all duration-500 hover:scale-[1.02]\">\n        {/* Animated background gradient */}\n        <motion.div\n          className=\"absolute inset-0 bg-gradient-to-br from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500\"\n          initial={false}\n        />\n        \n        <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n          <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n            {title}\n          </CardTitle>\n          <motion.div\n            whileHover={{ \n              scale: 1.1, \n              rotate: 5,\n              transition: { duration: 0.2 }\n            }}\n            className=\"p-2 rounded-full bg-primary/10 group-hover:bg-primary/20 transition-colors duration-300\"\n          >\n            <Icon className=\"h-4 w-4 text-primary\" />\n          </motion.div>\n        </CardHeader>\n        \n        <CardContent>\n          <div className=\"text-3xl font-bold text-primary mb-1\">\n            {isLoading ? (\n              <motion.div\n                animate={{ opacity: [0.5, 1, 0.5] }}\n                transition={{ duration: 1.5, repeat: Infinity }}\n                className=\"text-sm text-muted-foreground\"\n              >\n                {loadingText}\n              </motion.div>\n            ) : (\n              <AnimatedCounter value={value} />\n            )}\n          </div>\n          \n          {trend && !isLoading && (\n            <motion.div\n              initial={{ opacity: 0, x: -10 }}\n              animate={{ opacity: 1, x: 0 }}\n              transition={{ delay: 0.5 }}\n              className={cn(\n                \"text-xs flex items-center gap-1\",\n                trend.isPositive ? \"text-positive\" : \"text-destructive\"\n              )}\n            >\n              <span className={cn(\n                \"inline-block w-0 h-0 border-l-[3px] border-r-[3px] border-l-transparent border-r-transparent\",\n                trend.isPositive \n                  ? \"border-b-[4px] border-b-positive\" \n                  : \"border-t-[4px] border-t-destructive\"\n              )} />\n              {Math.abs(trend.value)}% fra forrige uke\n            </motion.div>\n          )}\n          \n          <p className=\"text-xs text-muted-foreground mt-1\">\n            {title}\n          </p>\n        </CardContent>\n        \n        {/* Subtle glow effect */}\n        <motion.div\n          className=\"absolute inset-0 bg-gradient-to-r from-primary/20 via-transparent to-primary/20 opacity-0 group-hover:opacity-100 blur-xl\"\n          animate={{ \n            x: [-100, 100],\n            transition: { \n              duration: 3,\n              repeat: Infinity,\n              repeatType: \"reverse\"\n            }\n          }}\n        />\n      </Card>\n    </motion.div>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/PremiumStudentCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'GraduationCap' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":12},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Datainnsamling\"","line":169,"column":63,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":169,"endColumn":77},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs text-muted-foreground\">Datainnsamling</span>","line":169,"column":63,"nodeType":"JSXText","endLine":169,"endColumn":77},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Denne uken\"","line":182,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":182,"endColumn":72},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-muted-foreground\">Denne uken</div>","line":182,"column":62,"nodeType":"JSXText","endLine":182,"endColumn":72},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sist sporet\"","line":186,"column":62,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":186,"endColumn":73},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-muted-foreground\">Sist sporet</div>","line":186,"column":62,"nodeType":"JSXText","endLine":186,"endColumn":73},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Delete Student\"","line":231,"column":37,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":231,"endColumn":51},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <AlertDialogTitle>Delete Student</AlertDialogTitle>","line":231,"column":37,"nodeType":"JSXText","endLine":231,"endColumn":51},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Are you sure you want to delete\"","line":232,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":233,"endColumn":53},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <AlertDialogDescription>\n                    Are you sure you want to delete {student.name}? This will permanently delete all their tracking data, goals, and associated records. This action cannot be undone.\n                  </AlertDialogDescription>","line":232,"column":43,"nodeType":"JSXText","endLine":233,"endColumn":53},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"? This will permanently delete all their tracking data, goals, and associated records. This action cannot be undone.\"","line":233,"column":67,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":234,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <AlertDialogDescription>\n                    Are you sure you want to delete {student.name}? This will permanently delete all their tracking data, goals, and associated records. This action cannot be undone.\n                  </AlertDialogDescription>","line":233,"column":67,"nodeType":"JSXText","endLine":234,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Cancel\"","line":237,"column":38,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":237,"endColumn":44},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <AlertDialogCancel>Cancel</AlertDialogCancel>","line":237,"column":38,"nodeType":"JSXText","endLine":237,"endColumn":44},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Delete Student\"","line":242,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":244,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <AlertDialogAction \n                    onClick={handleDeleteStudent}\n                    className=\"bg-destructive hover:bg-destructive/90\"\n                  >\n                    <Trash2 className=\"h-4 w-4 mr-2\" />\n                    Delete Student\n                  </AlertDialogAction>","line":242,"column":56,"nodeType":"JSXText","endLine":244,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":19,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\nimport { Student } from \"@/types/student\";\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { User, GraduationCap, Trash2, Eye, TrendingUp, School } from 'lucide-react';\nimport { format, isToday } from 'date-fns';\nimport { nb } from 'date-fns/locale';\nimport { useTranslation } from \"@/hooks/useTranslation\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { cn } from '@/lib/utils';\nimport { dataStorage } from '@/lib/dataStorage';\nimport { toast } from 'sonner';\nimport { useState, useMemo } from 'react';\n\ninterface PremiumStudentCardProps {\n  student: Student;\n  onView: (student: Student) => void;\n  onTrack: (student: Student) => void;\n  onDelete?: (student: Student) => void;\n  index: number;\n}\n\nexport const PremiumStudentCard = ({ \n  student, \n  onView, \n  onTrack, \n  onDelete,\n  index \n}: PremiumStudentCardProps) => {\n  const { tDashboard } = useTranslation();\n  const [isHovered, setIsHovered] = useState(false);\n\n  const handleDeleteStudent = async () => {\n    try {\n      dataStorage.deleteStudent(student.id);\n      toast.success(`${student.name} has been deleted successfully`);\n      \n      // Trigger storage event to refresh Dashboard\n      window.dispatchEvent(new StorageEvent('storage', {\n        key: 'sensoryTracker_students',\n        newValue: JSON.stringify(dataStorage.getStudents())\n      }));\n      \n      // Call onDelete callback if provided\n      if (onDelete) {\n        onDelete(student);\n      }\n    } catch (error) {\n      toast.error('Failed to delete student', {\n        description: error instanceof Error ? error.message : 'Unknown error occurred'\n      });\n    }\n  };\n\n  // Generate consistent mock data based on student ID to prevent changes on re-render\n  const mockData = useMemo(() => {\n    // Use student ID as seed for consistent values\n    const seed = student.id.split('').reduce((a, b) => a + b.charCodeAt(0), 0);\n    \n    // Seeded random function\n    const seededRandom = (n: number) => {\n      const x = Math.sin(seed + n) * 10000;\n      return x - Math.floor(x);\n    };\n    \n    return {\n      progressPercentage: Math.floor(seededRandom(1) * 100),\n      isActiveToday: seededRandom(2) > 0.5,\n      entriesThisWeek: Math.floor(seededRandom(3) * 10),\n      lastTracked: new Date(Date.now() - seededRandom(4) * 7 * 24 * 60 * 60 * 1000)\n    };\n  }, [student.id]);\n  \n  const { progressPercentage, isActiveToday, entriesThisWeek, lastTracked } = mockData;\n  const lastTrackedText = isToday(lastTracked) \n    ? \"I dag\" \n    : format(lastTracked, 'dd. MMM', { locale: nb });\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 40, scale: 0.95 }}\n      animate={{ opacity: 1, y: 0, scale: 1 }}\n      transition={{ \n        duration: 0.5,\n        delay: index * 0.08,\n        type: \"spring\",\n        stiffness: 100,\n        damping: 15\n      }}\n      whileHover={{ \n        scale: 1.02,\n        transition: { duration: 0.2 }\n      }}\n      onHoverStart={() => setIsHovered(true)}\n      onHoverEnd={() => setIsHovered(false)}\n      className=\"group\"\n    >\n      <Card className=\"relative overflow-hidden bg-gradient-card border-0 shadow-soft hover:shadow-elegant transition-all duration-500\"\n            onMouseEnter={() => setIsHovered(true)}\n            onMouseLeave={() => setIsHovered(false)}\n      >\n        {/* Background gradient animation */}\n        <motion.div\n          className=\"absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-secondary/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none\"\n          initial={false}\n        />\n        \n        {/* Active indicator */}\n        {isActiveToday && (\n          <motion.div\n            className=\"absolute top-4 right-4 w-3 h-3 bg-positive rounded-full\"\n            animate={{ \n              scale: [1, 1.2, 1],\n              opacity: [0.7, 1, 0.7]\n            }}\n            transition={{ \n              duration: 2,\n              repeat: Infinity\n            }}\n          />\n        )}\n        \n        <CardContent className=\"relative z-10 p-6\">\n          {/* Header with Avatar and Basic Info */}\n          <div className=\"flex items-start gap-4 mb-4\">\n            <motion.div\n              whileHover={{ scale: 1.05 }}\n              className=\"relative\"\n            >\n              <Avatar className=\"h-12 w-12 border-2 border-primary/20\">\n                <AvatarFallback className=\"bg-gradient-primary text-white font-semibold\">\n                  {student.name.split(' ').map(n => n[0]).join('').slice(0, 2)}\n                </AvatarFallback>\n              </Avatar>\n              <motion.div\n                className=\"absolute -bottom-1 -right-1 w-4 h-4 bg-primary rounded-full flex items-center justify-center\"\n                whileHover={{ scale: 1.2 }}\n              >\n                <User className=\"text-white h-3 w-3\" />\n              </motion.div>\n            </motion.div>\n            \n            <div className=\"flex-1\">\n              <motion.h3 \n                className=\"font-semibold text-lg text-foreground mb-1\"\n                layoutId={`student-name-${student.id}`}\n              >\n                {student.name}\n              </motion.h3>\n              \n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                <School className=\"h-4 w-4\" />\n                <span>\n                  {student.grade \n                    ? String(tDashboard('studentCard.grade')).replace('{{grade}}', student.grade.toString())\n                    : String(tDashboard('studentCard.noGrade'))\n                  }\n                </span>\n              </div>\n            </div>\n          </div>\n\n          {/* Progress Section */}\n          <div className=\"mb-4\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <span className=\"text-xs text-muted-foreground\">Datainnsamling</span>\n              <span className=\"text-xs font-medium text-primary\">{progressPercentage}%</span>\n            </div>\n            <Progress \n              value={progressPercentage} \n              className=\"h-2 bg-muted/50\"\n            />\n          </div>\n\n          {/* Stats Row */}\n          <div className=\"grid grid-cols-2 gap-4 mb-4\">\n            <div className=\"text-center p-2 rounded-lg bg-muted/30\">\n              <div className=\"text-lg font-bold text-primary\">{entriesThisWeek}</div>\n              <div className=\"text-xs text-muted-foreground\">Denne uken</div>\n            </div>\n            <div className=\"text-center p-2 rounded-lg bg-muted/30\">\n              <div className=\"text-sm font-medium text-foreground\">{lastTrackedText}</div>\n              <div className=\"text-xs text-muted-foreground\">Sist sporet</div>\n            </div>\n          </div>\n\n          {/* Action Buttons */}\n          <div className=\"relative z-20 flex gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={(e) => {\n                e.stopPropagation();\n                onView(student);\n              }}\n              className=\"flex-1 border-primary/20 hover:bg-primary/10 hover:border-primary/40 transition-all duration-200\"\n            >\n              <Eye className=\"h-4 w-4 mr-1\" />\n              {String(tDashboard('studentCard.viewProfile'))}\n            </Button>\n            \n            <Button\n              size=\"sm\"\n              onClick={(e) => {\n                e.stopPropagation();\n                onTrack(student);\n              }}\n              className=\"flex-1 bg-gradient-primary hover:opacity-90 transition-all duration-200\"\n            >\n              <TrendingUp className=\"h-4 w-4 mr-1\" />\n              {String(tDashboard('studentCard.trackNow'))}\n            </Button>\n            \n            {/* Delete Button */}\n            <AlertDialog>\n              <AlertDialogTrigger asChild>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={(e) => e.stopPropagation()}\n                  className=\"border-destructive/20 text-destructive hover:bg-destructive/10 hover:border-destructive/40\"\n                >\n                  <Trash2 className=\"h-4 w-4\" />\n                </Button>\n              </AlertDialogTrigger>\n              <AlertDialogContent>\n                <AlertDialogHeader>\n                  <AlertDialogTitle>Delete Student</AlertDialogTitle>\n                  <AlertDialogDescription>\n                    Are you sure you want to delete {student.name}? This will permanently delete all their tracking data, goals, and associated records. This action cannot be undone.\n                  </AlertDialogDescription>\n                </AlertDialogHeader>\n                <AlertDialogFooter>\n                  <AlertDialogCancel>Cancel</AlertDialogCancel>\n                  <AlertDialogAction \n                    onClick={handleDeleteStudent}\n                    className=\"bg-destructive hover:bg-destructive/90\"\n                  >\n                    <Trash2 className=\"h-4 w-4 mr-2\" />\n                    Delete Student\n                  </AlertDialogAction>\n                </AlertDialogFooter>\n              </AlertDialogContent>\n            </AlertDialog>\n          </div>\n        </CardContent>\n\n        {/* Subtle shine effect */}\n        <AnimatePresence>\n          {isHovered && (\n            <motion.div\n              className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent -skew-x-12 pointer-events-none\"\n              initial={{ x: \"-100%\", opacity: 0 }}\n              animate={{ \n                x: \"100%\", \n                opacity: 1,\n                transition: {\n                  duration: 0.6,\n                  ease: \"easeInOut\"\n                }\n              }}\n              exit={{ \n                opacity: 0,\n                transition: { duration: 0.2 }\n              }}\n            />\n          )}\n        </AnimatePresence>\n      </Card>\n    </motion.div>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/StudentCard.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Grade\"","line":30,"column":59,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":31,"endColumn":23},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Badge variant=\"secondary\" className=\"mt-1\">\n                Grade {student.grade}\n              </Badge>","line":30,"column":59,"nodeType":"JSXText","endLine":31,"endColumn":23},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Added\"","line":41,"column":17,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":41,"endColumn":23},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Added {student.createdAt.toLocaleDateString()}</span>","line":41,"column":17,"nodeType":"JSXText","endLine":41,"endColumn":23},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"View Profile\"","line":51,"column":50,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":53,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button \n            variant=\"outline\" \n            size=\"sm\" \n            onClick={() => onView(student)}\n            className=\"flex-1 font-dyslexia\"\n          >\n            <FileText className=\"h-4 w-4 mr-2\" />\n            View Profile\n          </Button>","line":51,"column":50,"nodeType":"JSXText","endLine":53,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Track Now\"","line":59,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":61,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button \n            size=\"sm\" \n            onClick={() => onTrack(student)}\n            className=\"flex-1 font-dyslexia bg-gradient-primary hover:opacity-90\"\n          >\n            <TrendingUp className=\"h-4 w-4 mr-2\" />\n            Track Now\n          </Button>","line":59,"column":52,"nodeType":"JSXText","endLine":61,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Student } from \"@/types/student\";\nimport { Calendar, FileText, TrendingUp } from \"lucide-react\";\n\ninterface StudentCardProps {\n  student: Student;\n  onView: (student: Student) => void;\n  onTrack: (student: Student) => void;\n}\n\nexport const StudentCard = ({ student, onView, onTrack }: StudentCardProps) => {\n  const getInitials = (name: string) => {\n    return name.split(' ').map(n => n[0]).join('').toUpperCase();\n  };\n\n  return (\n    <Card className=\"font-dyslexia transition-all duration-300 hover:shadow-medium hover:scale-[1.02] bg-gradient-card border-0\">\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center gap-3\" role=\"presentation\">\n          <div className=\"w-12 h-12 rounded-full bg-gradient-primary flex items-center justify-center text-primary-foreground font-semibold text-lg\" aria-hidden=\"true\">\n            {getInitials(student.name)}\n          </div>\n          <div className=\"flex-1\">\n            <CardTitle className=\"text-lg font-semibold text-foreground\">\n              {student.name}\n            </CardTitle>\n            {student.grade && (\n              <Badge variant=\"secondary\" className=\"mt-1\">\n                Grade {student.grade}\n              </Badge>\n            )}\n          </div>\n        </div>\n      </CardHeader>\n      \n      <CardContent className=\"space-y-4\">\n        <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n          <Calendar className=\"h-4 w-4\" />\n          <span>Added {student.createdAt.toLocaleDateString()}</span>\n        </div>\n\n        <div className=\"flex gap-2\">\n          <Button \n            variant=\"outline\" \n            size=\"sm\" \n            onClick={() => onView(student)}\n            className=\"flex-1 font-dyslexia\"\n          >\n            <FileText className=\"h-4 w-4 mr-2\" />\n            View Profile\n          </Button>\n          <Button \n            size=\"sm\" \n            onClick={() => onTrack(student)}\n            className=\"flex-1 font-dyslexia bg-gradient-primary hover:opacity-90\"\n          >\n            <TrendingUp className=\"h-4 w-4 mr-2\" />\n            Track Now\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/__tests__/button.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/__tests__/card.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/__tests__/dialog.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/accordion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/alert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/badge.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":36,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":36,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/button-variants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/calendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/chart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/collapsible.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/date-range-picker.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Pick a date range\"","line":68,"column":21,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":68,"endColumn":38},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span>Pick a date range</span>","line":68,"column":21,"nodeType":"JSXText","endLine":68,"endColumn":38}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { CalendarIcon } from \"lucide-react\"\nimport { format } from \"date-fns\"\nimport { DateRange } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Calendar } from \"@/components/ui/calendar\"\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\"\n\ninterface DatePickerWithRangeProps {\n  value?: { from: Date | undefined; to: Date | undefined } | undefined\n  onChange?: (range: { from: Date | undefined; to: Date | undefined } | undefined) => void\n  className?: string\n}\n\nexport function DatePickerWithRange({\n  value,\n  onChange,\n  className,\n}: DatePickerWithRangeProps) {\n  const [date, setDate] = React.useState<DateRange | undefined>(value ? {\n    from: value.from,\n    to: value.to\n  } : undefined)\n\n  React.useEffect(() => {\n    if (value) {\n      setDate({ from: value.from, to: value.to })\n    }\n  }, [value])\n\n  const handleSelect = (selectedDate: DateRange | undefined) => {\n    setDate(selectedDate)\n    onChange?.(selectedDate ? {\n      from: selectedDate.from,\n      to: selectedDate.to\n    } : undefined)\n  }\n\n  return (\n    <div className={cn(\"grid gap-2\", className)}>\n      <Popover>\n        <PopoverTrigger asChild>\n          <Button\n            id=\"date\"\n            variant={\"outline\"}\n            className={cn(\n              \"w-full justify-start text-left font-normal\",\n              !date && \"text-muted-foreground\"\n            )}\n          >\n            <CalendarIcon className=\"mr-2 h-4 w-4\" />\n            {date?.from ? (\n              date.to ? (\n                <>\n                  {format(date.from, \"LLL dd, y\")} -{\" \"}\n                  {format(date.to, \"LLL dd, y\")}\n                </>\n              ) : (\n                format(date.from, \"LLL dd, y\")\n              )\n            ) : (\n              <span>Pick a date range</span>\n            )}\n          </Button>\n        </PopoverTrigger>\n        <PopoverContent className=\"w-auto p-0\" align=\"start\">\n          <Calendar\n            initialFocus\n            mode=\"range\"\n            defaultMonth={date?.from}\n            selected={date}\n            onSelect={handleSelect}\n            numberOfMonths={2}\n            className={cn(\"p-3 pointer-events-auto\")}\n          />\n        </PopoverContent>\n      </Popover>\n    </div>\n  )\n}","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/dialog.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Dialog\"","line":133,"column":54,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":133,"endColumn":60},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DialogPrimitive.Title className=\"sr-only\">Dialog</DialogPrimitive.Title>","line":133,"column":54,"nodeType":"JSXText","endLine":133,"endColumn":60},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Dialog content\"","line":136,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":136,"endColumn":74},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DialogPrimitive.Description className=\"sr-only\">Dialog content</DialogPrimitive.Description>","line":136,"column":60,"nodeType":"JSXText","endLine":136,"endColumn":74},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Close\"","line":141,"column":37,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":141,"endColumn":42},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"sr-only\">Close</span>","line":141,"column":37,"nodeType":"JSXText","endLine":141,"endColumn":42}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Registries capture Radix primitives alongside any local wrappers so our\n// detection utilities can recognise accessible titles/descriptions regardless\n// of how they are re-exported.\ntype DialogComponentRegistry = {\n  components: Set<unknown>\n  displayNames: Set<string>\n}\n\nconst dialogTitleRegistry: DialogComponentRegistry = {\n  components: new Set([DialogPrimitive.Title]),\n  displayNames: new Set(\n    [\n      (DialogPrimitive.Title as { displayName?: string; name?: string }).displayName,\n      (DialogPrimitive.Title as { displayName?: string; name?: string }).name,\n    ].filter(Boolean) as string[]\n  ),\n}\n\nconst dialogDescriptionRegistry: DialogComponentRegistry = {\n  components: new Set([DialogPrimitive.Description]),\n  displayNames: new Set(\n    [\n      (DialogPrimitive.Description as { displayName?: string; name?: string }).displayName,\n      (DialogPrimitive.Description as { displayName?: string; name?: string }).name,\n    ].filter(Boolean) as string[]\n  ),\n}\n\n// Register a Dialog component variant (e.g. our wrappers) in the corresponding\n// registry so fallback detection stays in sync when new abstractions are added.\nconst registerDialogComponent = (\n  registry: DialogComponentRegistry,\n  component: unknown\n) => {\n  registry.components.add(component)\n  const name = (component as { displayName?: string; name?: string }).displayName ?? (component as { name?: string }).name\n  if (name) {\n    registry.displayNames.add(name)\n  }\n}\n\nconst hasRegisteredDialogComponent = (\n  children: React.ReactNode,\n  registry: DialogComponentRegistry\n): boolean => {\n  let found = false\n  const walk = (node: React.ReactNode) => {\n    if (found || node == null) return\n    React.Children.forEach(node as React.ReactNode, (child) => {\n      if (found || !React.isValidElement(child)) return\n\n      const elementType = child.type as {\n        displayName?: string\n        name?: string\n      }\n\n      if (\n        registry.components.has(child.type) ||\n        (elementType?.displayName && registry.displayNames.has(elementType.displayName)) ||\n        (elementType?.name && registry.displayNames.has(elementType.name))\n      ) {\n        found = true\n        return\n      }\n\n      if (child.props?.children) {\n        walk(child.props.children)\n      }\n    })\n  }\n  walk(children)\n  return found\n}\n\n// Utility to detect if any descendant is a Dialog Title. Radix logs a dev error\n// when Content lacks a Title. Some of our dialogs render Title deep in the tree\n// (e.g., wrapped in headers), so we perform a recursive check and maintain a\n// registry of recognised components. If none are present we inject a\n// visually-hidden fallback title to satisfy a11y without changing call sites.\nconst hasDialogTitle = (children: React.ReactNode): boolean =>\n  hasRegisteredDialogComponent(children, dialogTitleRegistry)\n\nconst hasDialogDescription = (children: React.ReactNode): boolean =>\n  hasRegisteredDialogComponent(children, dialogDescriptionRegistry)\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 motion-safe:data-[state=open]:animate-in motion-safe:data-[state=closed]:animate-out motion-safe:data-[state=closed]:fade-out-0 motion-safe:data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => {\n  const ensureTitle = !hasDialogTitle(children)\n  const ensureDescription = !hasDialogDescription(children)\n  return (\n    <DialogPortal>\n      <DialogOverlay />\n      <DialogPrimitive.Content\n        ref={ref}\n        className={cn(\n          \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-border/40 backdrop-blur-md bg-background/90 p-6 shadow-lg duration-200 motion-safe:data-[state=open]:animate-in motion-safe:data-[state=closed]:animate-out motion-safe:data-[state=closed]:fade-out-0 motion-safe:data-[state=open]:fade-in-0 motion-safe:data-[state=closed]:zoom-out-95 motion-safe:data-[state=open]:zoom-in-95 motion-safe:data-[state=closed]:slide-out-to-left-1/2 motion-safe:data-[state=closed]:slide-out-to-top-[48%] motion-safe:data-[state=open]:slide-in-from-left-1/2 motion-safe:data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n          className\n        )}\n        {...props}\n      >\n        {ensureTitle && (\n          <DialogPrimitive.Title className=\"sr-only\">Dialog</DialogPrimitive.Title>\n        )}\n        {ensureDescription && (\n          <DialogPrimitive.Description className=\"sr-only\">Dialog content</DialogPrimitive.Description>\n        )}\n        {children}\n        <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n          <X className=\"h-4 w-4\" />\n          <span className=\"sr-only\">Close</span>\n        </DialogPrimitive.Close>\n      </DialogPrimitive.Content>\n    </DialogPortal>\n  )\n})\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\nregisterDialogComponent(dialogTitleRegistry, DialogTitle)\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\nregisterDialogComponent(dialogDescriptionRegistry, DialogDescription)\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/form.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":168,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":168,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  ControllerProps,\n  FieldPath,\n  FieldValues,\n  FormProvider,\n  useFormContext,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message) : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/hover-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/progress.tsx","messages":[{"ruleId":"no-restricted-syntax","severity":1,"message":"Avoid inline styles (style={{}}). Use Tailwind CSS classes or CSS custom properties for styling. See rule 3wIMH0UDSwsNj5RYGo17Vg. Exception: Radix primitives with // RADIX_INLINE_STYLE_ALLOWED comment.","line":20,"column":7,"nodeType":"JSXAttribute","messageId":"restrictedSyntax","endLine":20,"endColumn":67}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/radio-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/sheet.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2435,2438],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2435,2438],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2451,2454],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2451,2454],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2975,2978],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2975,2978],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2991,2994],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2991,2994],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Menu\"","line":102,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":102,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SheetPrimitive.Title className=\"sr-only\">Menu</SheetPrimitive.Title>","line":102,"column":53,"nodeType":"JSXText","endLine":102,"endColumn":57},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sidebar drawer\"","line":105,"column":59,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":105,"endColumn":73},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SheetPrimitive.Description className=\"sr-only\">Sidebar drawer</SheetPrimitive.Description>","line":105,"column":59,"nodeType":"JSXText","endLine":105,"endColumn":73},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Close\"","line":110,"column":37,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":110,"endColumn":42},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"sr-only\">Close</span>","line":110,"column":37,"nodeType":"JSXText","endLine":110,"endColumn":42}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\nimport * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n  VariantProps<typeof sheetVariants> { }\n\n// Similar a11y guard as Dialog: ensure a Title/Description exists to avoid Radix dev warnings\nconst hasSheetTitle = (children: React.ReactNode): boolean => {\n  let found = false\n  const walk = (node: React.ReactNode) => {\n    if (found || node == null) return\n    React.Children.forEach(node as React.ReactNode, (child) => {\n      if (found) return\n      if (!React.isValidElement(child)) return\n      if ((child.type as unknown) === SheetPrimitive.Title) { found = true; return }\n      const props: any = (child as any)?.props\n      if (props?.children) walk(props.children)\n    })\n  }\n  walk(children)\n  return found\n}\n\nconst hasSheetDescription = (children: React.ReactNode): boolean => {\n  let found = false\n  const walk = (node: React.ReactNode) => {\n    if (found || node == null) return\n    React.Children.forEach(node as React.ReactNode, (child) => {\n      if (found) return\n      if (!React.isValidElement(child)) return\n      if ((child.type as unknown) === SheetPrimitive.Description) { found = true; return }\n      const props: any = (child as any)?.props\n      if (props?.children) walk(props.children)\n    })\n  }\n  walk(children)\n  return found\n}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => {\n  const ensureTitle = !hasSheetTitle(children)\n  const ensureDescription = !hasSheetDescription(children)\n  return (\n    <SheetPortal>\n      <SheetOverlay />\n      <SheetPrimitive.Content\n        ref={ref}\n        className={cn(sheetVariants({ side }), className)}\n        {...props}\n      >\n        {ensureTitle && (\n          <SheetPrimitive.Title className=\"sr-only\">Menu</SheetPrimitive.Title>\n        )}\n        {ensureDescription && (\n          <SheetPrimitive.Description className=\"sr-only\">Sidebar drawer</SheetPrimitive.Description>\n        )}\n        {children}\n        <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n          <X className=\"h-4 w-4\" />\n          <span className=\"sr-only\">Close</span>\n        </SheetPrimitive.Close>\n      </SheetPrimitive.Content>\n    </SheetPortal>\n  )\n})\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet, SheetClose,\n  SheetContent, SheetDescription, SheetFooter, SheetHeader, SheetOverlay, SheetPortal, SheetTitle, SheetTrigger\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/sidebar.tsx","messages":[{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":109,"column":7,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":109,"endColumn":56},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Toggle Sidebar\"","line":280,"column":33,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":280,"endColumn":47},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"sr-only\">Toggle Sidebar</span>","line":280,"column":33,"nodeType":"JSXText","endLine":280,"endColumn":47},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":761,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":761,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { Sheet, SheetContent } from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar:state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContext = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContext | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContext>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-bg-secondary border-r border-border-color text-text-primary\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-bg-secondary border-border-color p-0 text-text-primary [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden md:block text-text-primary pointer-events-auto\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear pointer-events-none\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n        className={cn(\n            \"duration-200 fixed inset-y-0 z-[60] hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l border-border-color\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-bg-secondary group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-border-color group-data-[variant=floating]:shadow-lg backdrop-blur-xl pointer-events-auto\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex min-h-svh flex-1 flex-col bg-background\",\n        \"peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        type={asChild ? undefined : \"button\"}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"rounded-md h-8 flex gap-2 px-2 items-center\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 flex-1 max-w-[--skeleton-width]\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/slider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/sonner.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":30,"column":19,"nodeType":"Identifier","messageId":"namedExport","endLine":30,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useTheme } from \"next-themes\"\nimport { Toaster as Sonner, toast } from \"sonner\"\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>\n\nconst Toaster = ({ ...props }: ToasterProps) => {\n  const { theme = \"system\" } = useTheme()\n\n  return (\n    <Sonner\n      theme={theme as ToasterProps[\"theme\"]}\n      className=\"toaster group\"\n      listClassName=\"list-none\"\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton:\n            \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton:\n            \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n      }}\n      {...props}\n    />\n  )\n}\n\nexport { Toaster, toast }\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/toaster.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/toggle.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":43,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":43,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3\",\n        sm: \"h-9 px-2.5\",\n        lg: \"h-11 px-5\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/components/ui/tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/config/__tests__/analytics.config.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'z' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'chartDefaultsSchema' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2644,2647],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2644,2647],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2983,2986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2983,2986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3365,3368],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3365,3368],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":89,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3415,3418],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3415,3418],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":92,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3476,3479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3476,3479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3776,3779],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3776,3779],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4727,4730],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4727,4730],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4760,4763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4760,4763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4797,4800],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4797,4800],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4811,4814],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4811,4814],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5278,5281],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5278,5281],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":146,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":146,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5753,5756],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5753,5756],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":147,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5786,5789],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5786,5789],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":148,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5823,5826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5823,5826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5837,5840],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5837,5840],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6530,6533],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6530,6533],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":18,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach, afterEach, expectTypeOf } from 'vitest';\nimport { z, ZodError } from 'zod';\nimport {\n  analyticsConfigSchema,\n  type AnalyticsConfig as SchemaAnalyticsConfig,\n  chartDefaultsSchema,\n  thresholdSchema,\n} from '@/config/schemas/analytics.schema';\nimport {\n  validateAnalyticsConfig,\n  validateAndMergeAnalyticsConfig,\n} from '@/config/validators/analytics.validator';\nimport { getRuntimeAnalyticsConfig } from '@/config/analytics.config';\nimport * as libAnalyticsConfig from '@/lib/analyticsConfig';\n\n// Helper to create a minimal valid config via schema defaults\nfunction makeValidConfig(partial?: Partial<SchemaAnalyticsConfig>): SchemaAnalyticsConfig {\n  const base = analyticsConfigSchema.parse({});\n  return {\n    ...base,\n    ...(partial ?? {}),\n  };\n}\n\ndescribe('analytics.config: schema validation', () => {\n  it('accepts a valid configuration (with defaults)', () => {\n    const cfg = analyticsConfigSchema.parse({\n      version: '1',\n      charts: { lineWidth: 3 },\n    });\n    expect(cfg.version).toBe('1');\n    expect(cfg.charts.lineWidth).toBe(3);\n    // Defaults filled\n    expect(cfg.charts.pointRadius).toBeTypeOf('number');\n  });\n\n  it('rejects invalid charts values (lineWidth < 0)', () => {\n    expect(() => analyticsConfigSchema.parse({ charts: { lineWidth: -1 } })).toThrow(ZodError);\n  });\n\n  it('enforces threshold monotonicity when provided', () => {\n    const invalidThresh = { low: 5, medium: 2 };\n    const result = thresholdSchema.safeParse(invalidThresh);\n    expect(result.success).toBe(false);\n    if (!result.success) {\n      expect(result.error.issues.some(i => String(i.message).includes('medium must be'))).toBe(true);\n    }\n  });\n});\n\ndescribe('analytics.validator: validate & merge', () => {\n  const base = makeValidConfig({ version: '1', charts: { lineWidth: 2, pointRadius: 3, animation: true, showLegend: true, theme: 'system', tooltip: {}, container: {} }, rules: [], thresholds: {} });\n\n  it('merges nested overrides and validates result', () => {\n    const overrides: Partial<SchemaAnalyticsConfig> = {\n      charts: { lineWidth: 4, tooltip: { transitionDuration: 0 } },\n      worker: { cache: { ttlSeconds: 120 } },\n    };\n    const { isValid, config, errors } = validateAndMergeAnalyticsConfig(base, overrides);\n    expect(isValid).toBe(true);\n    expect(errors).toHaveLength(0);\n    expect(config.charts.lineWidth).toBe(4);\n    expect(config.worker.cache.ttlSeconds).toBe(120);\n  });\n\n  it('falls back to base when overrides invalid', () => {\n    const overrides: Partial<SchemaAnalyticsConfig> = {\n      charts: { lineWidth: -10 }, // invalid\n    } as any;\n    const { isValid, config, errors } = validateAndMergeAnalyticsConfig(base, overrides);\n    expect(isValid).toBe(false);\n    expect(errors.length).toBeGreaterThan(0);\n    expect(config.charts.lineWidth).toBe(base.charts.lineWidth);\n  });\n\n  it('validateAnalyticsConfig returns fallback on invalid input', () => {\n    const invalid: any = { charts: { lineWidth: -1 } };\n    const { isValid, config, errors } = validateAnalyticsConfig(invalid, base);\n    expect(isValid).toBe(false);\n    expect(errors.length).toBeGreaterThan(0);\n    expect(config).toEqual(base);\n  });\n});\n\ndescribe('analytics.loader: environment variable parsing and profile application', () => {\n  const originalImportMeta = { ...(import.meta as any) };\n\n  beforeEach(() => {\n    (import.meta as any).env = {};\n  });\n  afterEach(() => {\n    (import.meta as any).env = originalImportMeta.env;\n    vi.resetModules();\n    vi.clearAllMocks();\n  });\n\n  // TODO(kb-analytics): Temporarily skipped due to module resolution of @/config/analytics.config in test env\n  it.skip('parses boolean/number env vars into schema overrides', async () => {\n    (import.meta as any).env = {\n      VITE_ANALYTICS_CHARTS_LINE_WIDTH: '5',\n      VITE_ANALYTICS_CHARTS_SHOW_LEGEND: 'true',\n      VITE_ANALYTICS_WORKER_CACHE_TTL_SECONDS: '90',\n      VITE_ANALYTICS_FEATURE_CORRELATION: '1',\n      VITE_ANALYTICS_TOOLTIP_TRANSITION_MS: '0',\n    };\n    // dynamic import after env set so module reads latest env\n    const { loadAnalyticsConfig } = await import('@/config/loaders/analytics.loader');\n\n    // Mock runtime to an empty/default to control base\n    const runtimeModule = await import('@/config/analytics.config');\n    const spy = vi.spyOn(runtimeModule, 'getRuntimeAnalyticsConfig');\n    spy.mockReturnValue({\n      version: '1',\n      thresholds: {},\n      rules: [],\n      charts: analyticsConfigSchema.parse({}).charts,\n      worker: analyticsConfigSchema.parse({}).worker,\n      features: analyticsConfigSchema.parse({}).features,\n      // non-schema runtime extensions are irrelevant here\n      advancedThresholds: {} as any,\n      ml: { models: [] } as any,\n      performanceBudgets: {} as any,\n    } as any);\n\n    const cfg = loadAnalyticsConfig({ forceReload: true });\n    expect(cfg.charts.lineWidth).toBe(5);\n    expect(cfg.charts.showLegend).toBe(true);\n    expect(cfg.worker.cache.ttlSeconds).toBe(90);\n    expect(cfg.features.enableCorrelation).toBe(true);\n    expect(cfg.charts.tooltip.transitionDuration).toBe(0);\n\n    spy.mockRestore();\n  });\n\n  it.skip('applies VITE_USE_MOCK profile to enable correlation and shorten cache', async () => {\n    (import.meta as any).env = { VITE_USE_MOCK: 'true' };\n    const { loadAnalyticsConfig } = await import('@/config/loaders/analytics.loader');\n\n    const runtimeModule = await import('@/config/analytics.config');\n    const spy = vi.spyOn(runtimeModule, 'getRuntimeAnalyticsConfig');\n    spy.mockReturnValue({\n      ...makeValidConfig(),\n      charts: makeValidConfig().charts,\n      worker: makeValidConfig().worker,\n      features: makeValidConfig().features,\n      advancedThresholds: {} as any,\n      ml: { models: [] } as any,\n      performanceBudgets: {} as any,\n    } as any);\n\n    const cfg = loadAnalyticsConfig({ forceReload: true });\n    expect(cfg.features.enableCorrelation).toBe(true);\n    expect(cfg.worker.cache.ttlSeconds).toBeGreaterThan(0);\n    expect(cfg.worker.cache.ttlSeconds).toBeLessThanOrEqual(120); // mock profile shortens TTL\n    spy.mockRestore();\n  });\n});\n\ndescribe('analytics.config: fallback behavior when runtime overrides invalid', () => {\n  it('uses safe defaults for invalid runtime overrides', async () => {\n    // Mock analyticsConfig.getConfig() to return bad runtime overrides\n    const mgr = vi.spyOn(libAnalyticsConfig.analyticsConfig, 'getConfig');\n    mgr.mockReturnValue({ ...(libAnalyticsConfig.DEFAULT_ANALYTICS_CONFIG as any), runtime: { charts: { lineWidth: -99 } } });\n\n    const cfg = getRuntimeAnalyticsConfig();\n    // Even though overrides had invalid value, schema-backed portion should be valid number within range\n    // Ensure lineWidth is a non-negative number as per schema (min 0)\n    expect(cfg.charts.lineWidth).toBeGreaterThanOrEqual(0);\n\n    mgr.mockRestore();\n  });\n});\n\ndescribe('analytics.config: type inference correctness', () => {\n  it('infers return types of getters', async () => {\n    const runtime = getRuntimeAnalyticsConfig();\n    expectTypeOf(runtime).toMatchTypeOf<{\n      version: string;\n      thresholds: SchemaAnalyticsConfig['thresholds'];\n      rules: SchemaAnalyticsConfig['rules'];\n      charts: SchemaAnalyticsConfig['charts'] & { colorPalette?: string[] };\n      worker: SchemaAnalyticsConfig['worker'] & { pool?: { maxWorkers: number } };\n    }>();\n\n    // Ensure specific nested types are numbers/booleans as per schema\n    expectTypeOf(runtime.charts.lineWidth).toBeNumber();\n    expectTypeOf(runtime.worker.cache.ttlSeconds).toBeNumber();\n    expectTypeOf(runtime.features.enableAnomalies).toBeBoolean();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/config/analytics.config.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":255,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":255,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8063,8066],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8063,8066],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":263,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":263,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8270,8273],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8270,8273],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":263,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":263,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8316,8319],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8316,8319],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":265,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":265,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8352,8355],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8352,8355],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":265,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":265,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8379,8382],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8379,8382],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":296,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":296,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9414,9417],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9414,9417],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":297,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":297,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9500,9503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9500,9503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":323,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":323,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10517,10520],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10517,10520],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":329,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":329,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10723,10726],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10723,10726],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { analyticsConfig } from '@/lib/analyticsConfig';\nimport { logger } from '@/lib/logger';\nimport type {\n  AnalyticsConfig as SchemaAnalyticsConfig,\n  ChartDefaults,\n  InsightRule,\n  WorkerSettings,\n  Threshold,\n  FeatureFlags,\n} from '@/config/schemas/analytics.schema';\nimport { analyticsConfigSchema } from '@/config/schemas/analytics.schema';\nimport { validateAndMergeAnalyticsConfig } from '@/config/validators/analytics.validator';\n\n// This module centralizes advanced analytics runtime configuration with safe defaults.\n// All consumers must read values through the getters below which merge runtime overrides\n// provided via analyticsConfig with the defaults defined here.\n\n// -----------------------------\n// Types\n// -----------------------------\nexport interface DynamicThreshold {\n  base: number; // base absolute value\n  min?: number;\n  max?: number;\n  // Adjust dynamically based on data distribution\n  adaptTo: 'mean' | 'median' | 'std' | 'percentile';\n  adaptFactor?: number; // multiplier applied to adaptTo metric (e.g., 1.5 * std)\n}\n\nexport interface PercentageThreshold {\n  // Interpret threshold as a percentage of a reference metric\n  of: 'mean' | 'median' | 'max' | 'min' | 'range';\n  percentage: number; // 0..1\n  floor?: number; // optional absolute floor\n  cap?: number; // optional absolute ceiling\n}\n\nexport interface ConditionalThreshold {\n  when: {\n    metric: string;\n    operator: '<' | '<=' | '>' | '>=' | '==' | '!=';\n    value: number;\n  };\n  then: Threshold; // uses schema Threshold levels (low/medium/high/warn/error)\n}\n\nexport interface AdvancedThresholdConfig {\n  dynamic?: Record<string, DynamicThreshold>; // keyed by metric id\n  percentage?: Record<string, PercentageThreshold>; // keyed by metric id\n  conditional?: ConditionalThreshold[];\n}\n\nexport interface MLModelConfig {\n  id: string; // stable identifier (keys must be stable per project rules)\n  task: 'pattern-detection' | 'anomaly-detection' | 'forecasting' | 'classification';\n  provider: 'tfjs' | 'onnx' | 'custom';\n  version: string;\n  hyperparameters?: Record<string, number | string | boolean>;\n  training?: {\n    enabled: boolean;\n    batchSize: number;\n    epochs: number;\n    validationSplit: number; // 0..1\n  };\n  inference?: {\n    batchSize: number;\n    cacheTTLms: number; // per rule: use cache with TTL\n    precision: 'fp32' | 'fp16' | 'int8';\n  };\n}\n\nexport interface PerformanceBudgetConfig {\n  // Budgets are soft limits; exceeding them should degrade gracefully\n  maxTimeMs: number;\n  maxMemoryMB: number;\n  sampleRate?: number; // 0..1, for operations that can sample input\n}\n\nexport interface PerformanceBudgets {\n  preprocessing: PerformanceBudgetConfig;\n  correlation: PerformanceBudgetConfig;\n  patternDetection: PerformanceBudgetConfig;\n  prediction: PerformanceBudgetConfig;\n  chartRender: PerformanceBudgetConfig;\n}\n\nexport interface RuntimeAnalyticsConfig extends SchemaAnalyticsConfig {\n  // Extensions beyond the schema\n  advancedThresholds: AdvancedThresholdConfig;\n  ml: {\n    models: MLModelConfig[];\n  };\n  performanceBudgets: PerformanceBudgets;\n  charts: ChartDefaults & {\n    // Extend with project color tokens; do not use raw hex (see rules)\n    colorPalette: string[]; // tailwind theme variables or CSS variables\n    animations: {\n      enabled: boolean;\n      durationMs: number;\n      easing: 'linear' | 'ease-in' | 'ease-out' | 'ease-in-out';\n      respectReducedMotion: boolean; // must respect [data-reduce-motion=true]\n    };\n  };\n  worker: WorkerSettings & {\n    pool: {\n      maxWorkers: number;\n      taskConcurrency: number;\n      backpressureLimit: number;\n    };\n  };\n  features: FeatureFlags;\n}\n\n// -----------------------------\n// Defaults\n// -----------------------------\nconst DEFAULT_RUNTIME_BASE: SchemaAnalyticsConfig = analyticsConfigSchema.parse({\n  version: '1',\n  thresholds: {},\n  rules: [],\n  charts: {\n    theme: 'system',\n    showLegend: true,\n    lineWidth: 2,\n    pointRadius: 3,\n    animation: true,\n    tooltip: {\n      appendToBody: true,\n      transitionDuration: 0,\n      confine: true,\n    },\n    container: {\n      overflowVisible: true,\n      stableKeys: true,\n    },\n  },\n  worker: {\n    cache: { ttlSeconds: 300, strategy: 'ttl' },\n    memory: { maxHeapMB: 512, maxWorkerCount: 2, taskConcurrency: 4 },\n    queue: { enabled: true, backpressureLimit: 1000 },\n    security: { allowEval: false },\n  },\n  features: {\n    enableTrends: true,\n    enableAnomalies: true,\n    enableCorrelation: false,\n    enableForecasting: false,\n    enableRealtime: false,\n  },\n});\n\nconst DEFAULT_RUNTIME_EXTENSIONS: Omit<\n  RuntimeAnalyticsConfig,\n  keyof SchemaAnalyticsConfig\n> = {\n  advancedThresholds: {\n    dynamic: {\n      // Example: anomaly score threshold adapts to std dev\n      'anomaly.score': { base: 1.5, adaptTo: 'std', adaptFactor: 1.0, min: 1.0, max: 3.0 },\n    },\n    percentage: {\n      // e.g., \"high-intensity\" as 80% of max observed intensity\n      'emotion.intensity.high': { of: 'max', percentage: 0.8, floor: 3, cap: 5 },\n    },\n    conditional: [\n      {\n        when: { metric: 'data.recency.days', operator: '>=', value: 14 },\n        then: { warn: 0.4, error: 0.2 }, // require stronger signals when data is stale\n      },\n    ],\n  },\n  ml: {\n    models: [\n      {\n        id: 'patterns-v1',\n        task: 'pattern-detection',\n        provider: 'tfjs',\n        version: '1.0.0',\n        hyperparameters: { learningRate: 0.001, dropout: 0.1 },\n        training: { enabled: false, batchSize: 32, epochs: 5, validationSplit: 0.1 },\n        inference: { batchSize: 64, cacheTTLms: 5 * 60 * 1000, precision: 'fp32' },\n      },\n      {\n        id: 'anomaly-v1',\n        task: 'anomaly-detection',\n        provider: 'tfjs',\n        version: '1.0.0',\n        hyperparameters: { contamination: 0.05 },\n        training: { enabled: false, batchSize: 64, epochs: 3, validationSplit: 0.1 },\n        inference: { batchSize: 128, cacheTTLms: 5 * 60 * 1000, precision: 'fp32' },\n      },\n    ],\n  },\n  performanceBudgets: {\n    preprocessing: { maxTimeMs: 30, maxMemoryMB: 50, sampleRate: 1 },\n    correlation: { maxTimeMs: 75, maxMemoryMB: 128, sampleRate: 1 },\n    patternDetection: { maxTimeMs: 90, maxMemoryMB: 256, sampleRate: 1 },\n    prediction: { maxTimeMs: 60, maxMemoryMB: 128, sampleRate: 1 },\n    chartRender: { maxTimeMs: 32, maxMemoryMB: 64, sampleRate: 1 },\n  },\n  charts: {\n    theme: 'system',\n    showLegend: true,\n    lineWidth: 2,\n    pointRadius: 3,\n    animation: true,\n    tooltip: { appendToBody: true, transitionDuration: 0, confine: true },\n    container: { overflowVisible: true, stableKeys: true },\n    // Extensions\n    colorPalette: [\n      // Use CSS variables from Tailwind theme per rules (no raw hex)\n      'var(--chart-1)',\n      'var(--chart-2)',\n      'var(--chart-3)',\n      'var(--chart-4)',\n      'var(--chart-5)',\n    ],\n    animations: {\n      enabled: true,\n      durationMs: 300,\n      easing: 'ease-out',\n      respectReducedMotion: true, // Respect reduced motion per rules\n    },\n  },\n  worker: {\n    cache: { ttlSeconds: 300, strategy: 'ttl' },\n    memory: { maxHeapMB: 512, maxWorkerCount: 2, taskConcurrency: 4 },\n    queue: { enabled: true, backpressureLimit: 1000 },\n    security: { allowEval: false },\n    pool: { maxWorkers: 2, taskConcurrency: 4, backpressureLimit: 1000 },\n  },\n  features: {\n    enableTrends: true,\n    enableAnomalies: true,\n    enableCorrelation: false,\n    enableForecasting: false,\n    enableRealtime: false,\n  },\n};\n\nconst DEFAULT_RUNTIME: RuntimeAnalyticsConfig = {\n  ...DEFAULT_RUNTIME_BASE,\n  ...DEFAULT_RUNTIME_EXTENSIONS,\n};\n\n// -----------------------------\n// Merge helpers\n// -----------------------------\nfunction deepMerge<T extends object>(base: T, overrides: Partial<T> | undefined | null): T {\n  if (!overrides) return base;\n  const output = Array.isArray(base) ? ([...base] as unknown as T) : ({ ...base } as T);\n  for (const key of Object.keys(overrides) as Array<keyof T>) {\n    const overrideVal = overrides[key];\n    if (overrideVal === undefined) continue;\n    const baseVal = (base as any)[key];\n    if (\n      baseVal &&\n      typeof baseVal === 'object' &&\n      !Array.isArray(baseVal) &&\n      typeof overrideVal === 'object' &&\n      !Array.isArray(overrideVal)\n    ) {\n      (output as any)[key] = deepMerge(baseVal, overrideVal as any);\n    } else {\n      (output as any)[key] = overrideVal as any;\n    }\n  }\n  return output;\n}\n\nfunction readRuntimeOverrides(): Partial<RuntimeAnalyticsConfig> | null {\n  try {\n    // Pull any overrides that may have been stored via analyticsConfig manager.\n    const cfg = analyticsConfig.getConfig() as unknown as { runtime?: Partial<RuntimeAnalyticsConfig> };\n    if (cfg && typeof cfg === 'object' && cfg.runtime) {\n      return cfg.runtime;\n    }\n  } catch (err) {\n    logger.warn('Failed to read runtime overrides from analyticsConfig; using defaults', err);\n  }\n  return null;\n}\n\n// -----------------------------\n// Public API\n// -----------------------------\nexport function getRuntimeAnalyticsConfig(): RuntimeAnalyticsConfig {\n  const overrides = readRuntimeOverrides();\n\n  // Early validation hook: validate schema-backed subset using zod and fallbacks\n  const schemaSubset: Partial<SchemaAnalyticsConfig> | undefined = overrides\n    ? {\n        version: overrides.version,\n        thresholds: overrides.thresholds,\n        rules: overrides.rules,\n        charts: overrides.charts as any, // charts core defaults validated via schema\n        worker: overrides.worker as any, // worker core defaults validated via schema\n        features: overrides.features,\n      }\n    : undefined;\n\n  const { config: safeSchema, errors } = validateAndMergeAnalyticsConfig(\n    DEFAULT_RUNTIME_BASE,\n    schemaSubset,\n  );\n\n  if (errors.length) {\n    // Log concise summary; detailed messages are logged in the validator\n    logger.warn('Using safe analytics defaults due to invalid runtime overrides');\n  }\n\n  // Merge full runtime including extensions, but force validated schema parts\n  const merged = deepMerge(DEFAULT_RUNTIME, overrides ?? undefined);\n  const safeMerged: RuntimeAnalyticsConfig = {\n    ...merged,\n    // Overwrite schema-backed sections with validated values\n    version: safeSchema.version,\n    thresholds: safeSchema.thresholds,\n    rules: safeSchema.rules,\n    charts: {\n      // Preserve non-schema extensions from merged first (e.g., colorPalette, animations),\n      // then enforce schema-validated core values to avoid invalid overrides leaking through.\n      ...(merged as any).charts,\n      ...safeSchema.charts,\n    },\n    worker: {\n      // Preserve non-schema extensions from merged first (e.g., pool),\n      // then enforce schema-validated core values.\n      ...(merged as any).worker,\n      ...safeSchema.worker,\n    },\n    features: safeSchema.features,\n  };\n\n  return safeMerged;\n}\n\nexport function getAdvancedThresholds(): AdvancedThresholdConfig {\n  return getRuntimeAnalyticsConfig().advancedThresholds;\n}\n\nexport function getInsightRules(): InsightRule[] {\n  return getRuntimeAnalyticsConfig().rules;\n}\n\nexport function getMLModels(): MLModelConfig[] {\n  return getRuntimeAnalyticsConfig().ml.models;\n}\n\nexport function getPerformanceBudgets(): PerformanceBudgets {\n  return getRuntimeAnalyticsConfig().performanceBudgets;\n}\n\nexport function getChartDefaults(): RuntimeAnalyticsConfig['charts'] {\n  return getRuntimeAnalyticsConfig().charts;\n}\n\nexport function getWorkerSettings(): RuntimeAnalyticsConfig['worker'] {\n  return getRuntimeAnalyticsConfig().worker;\n}\n\nexport function getFeatureFlags(): FeatureFlags {\n  return getRuntimeAnalyticsConfig().features;\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/config/analyticsTabs.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/config/loaders/analytics.loader.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5111,5114],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5111,5114],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5150,5153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5150,5153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5171,5174],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5171,5174],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5685,5688],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5685,5688],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5726,5729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5726,5729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5748,5751],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5748,5751],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5834,5837],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5834,5837],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":121,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5854,5857],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5854,5857],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5915,5918],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5915,5918],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5930,5933],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5930,5933],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { logger } from '@/lib/logger';\nimport { analyticsConfigSchema, type AnalyticsConfig as SchemaAnalyticsConfig } from '@/config/schemas/analytics.schema';\nimport { validateAndMergeAnalyticsConfig } from '@/config/validators/analytics.validator';\nimport { getRuntimeAnalyticsConfig } from '@/config/analytics.config';\n\n// Environment-based switching pattern\n// If VITE_USE_MOCK is truthy (\"1\", \"true\", \"yes\"), we prefer mock-oriented settings.\n// If VITE_ANALYTICS_PROFILE is set (e.g., \"dev\", \"prod\", \"test\"), we can tweak defaults gently.\n\nfunction truthy(v: unknown): boolean {\n  if (v == null) return false;\n  const s = String(v).trim().toLowerCase();\n  return s === '1' || s === 'true' || s === 'yes' || s === 'on';\n}\n\nfunction toNumber(v: unknown): number | undefined {\n  if (v == null) return undefined;\n  const n = Number(v);\n  return Number.isFinite(n) ? n : undefined;\n}\n\nfunction parseJSON<T = unknown>(raw: unknown): T | undefined {\n  if (!raw || typeof raw !== 'string') return undefined;\n  try {\n    return JSON.parse(raw) as T;\n  } catch {\n    logger.warn('Invalid JSON in environment variable; ignoring', { raw: raw.slice(0, 64) });\n    return undefined;\n  }\n}\n\n// Read environment variables beginning with VITE_ANALYTICS_ and build a partial schema-backed config.\nfunction readEnvOverrides(): Partial<SchemaAnalyticsConfig> | null {\n  const env = import.meta.env as Record<string, string | boolean | undefined>;\n\n  // Fast path: if no relevant keys present, return null\n  const hasAny = Object.keys(env).some((k) => k.startsWith('VITE_ANALYTICS_'));\n  if (!hasAny) return null;\n\n  // Support bulk JSON overrides for complex structures\n  const thresholdsJson = parseJSON<Record<string, SchemaAnalyticsConfig['thresholds'][string]>>(env.VITE_ANALYTICS_THRESHOLDS_JSON as string | undefined);\n  const rulesJson = parseJSON<SchemaAnalyticsConfig['rules']>(env.VITE_ANALYTICS_RULES_JSON as string | undefined);\n\n  const chartsTheme = (env.VITE_ANALYTICS_CHARTS_THEME as string | undefined)?.toLowerCase() as\n    | 'light'\n    | 'dark'\n    | 'system'\n    | undefined;\n\n  const overrides: Partial<SchemaAnalyticsConfig> = {\n    version: (env.VITE_ANALYTICS_VERSION as string | undefined) ?? undefined,\n    thresholds: thresholdsJson ?? undefined,\n    rules: rulesJson ?? undefined,\n    charts: {\n      theme: chartsTheme,\n      showLegend: env.VITE_ANALYTICS_CHARTS_SHOW_LEGEND !== undefined ? truthy(env.VITE_ANALYTICS_CHARTS_SHOW_LEGEND) : undefined,\n      lineWidth: toNumber(env.VITE_ANALYTICS_CHARTS_LINE_WIDTH),\n      pointRadius: toNumber(env.VITE_ANALYTICS_CHARTS_POINT_RADIUS),\n      animation: env.VITE_ANALYTICS_CHARTS_ANIMATION !== undefined ? truthy(env.VITE_ANALYTICS_CHARTS_ANIMATION) : undefined,\n      tooltip: {\n        appendToBody: env.VITE_ANALYTICS_TOOLTIP_APPEND_TO_BODY !== undefined ? truthy(env.VITE_ANALYTICS_TOOLTIP_APPEND_TO_BODY) : undefined,\n        transitionDuration: toNumber(env.VITE_ANALYTICS_TOOLTIP_TRANSITION_MS),\n        confine: env.VITE_ANALYTICS_TOOLTIP_CONFINE !== undefined ? truthy(env.VITE_ANALYTICS_TOOLTIP_CONFINE) : undefined,\n      },\n      container: {\n        overflowVisible: env.VITE_ANALYTICS_CONTAINER_OVERFLOW_VISIBLE !== undefined ? truthy(env.VITE_ANALYTICS_CONTAINER_OVERFLOW_VISIBLE) : undefined,\n        stableKeys: env.VITE_ANALYTICS_CONTAINER_STABLE_KEYS !== undefined ? truthy(env.VITE_ANALYTICS_CONTAINER_STABLE_KEYS) : undefined,\n      },\n    },\n    worker: {\n      cache: {\n        ttlSeconds: toNumber(env.VITE_ANALYTICS_WORKER_CACHE_TTL_SECONDS),\n        strategy: (env.VITE_ANALYTICS_WORKER_CACHE_STRATEGY as 'ttl' | 'lru' | undefined) ?? undefined,\n      },\n      memory: {\n        maxHeapMB: toNumber(env.VITE_ANALYTICS_WORKER_MAX_HEAP_MB),\n        maxWorkerCount: toNumber(env.VITE_ANALYTICS_WORKER_MAX_COUNT),\n        taskConcurrency: toNumber(env.VITE_ANALYTICS_WORKER_TASK_CONCURRENCY),\n      },\n      queue: {\n        enabled: env.VITE_ANALYTICS_QUEUE_ENABLED !== undefined ? truthy(env.VITE_ANALYTICS_QUEUE_ENABLED) : undefined,\n        backpressureLimit: toNumber(env.VITE_ANALYTICS_QUEUE_BACKPRESSURE_LIMIT),\n      },\n      security: {\n        allowEval: env.VITE_ANALYTICS_SECURITY_ALLOW_EVAL !== undefined ? truthy(env.VITE_ANALYTICS_SECURITY_ALLOW_EVAL) : undefined,\n      },\n    },\n    features: {\n      enableTrends: env.VITE_ANALYTICS_FEATURE_TRENDS !== undefined ? truthy(env.VITE_ANALYTICS_FEATURE_TRENDS) : undefined,\n      enableAnomalies: env.VITE_ANALYTICS_FEATURE_ANOMALIES !== undefined ? truthy(env.VITE_ANALYTICS_FEATURE_ANOMALIES) : undefined,\n      enableCorrelation: env.VITE_ANALYTICS_FEATURE_CORRELATION !== undefined ? truthy(env.VITE_ANALYTICS_FEATURE_CORRELATION) : undefined,\n      enableForecasting: env.VITE_ANALYTICS_FEATURE_FORECASTING !== undefined ? truthy(env.VITE_ANALYTICS_FEATURE_FORECASTING) : undefined,\n      enableRealtime: env.VITE_ANALYTICS_FEATURE_REALTIME !== undefined ? truthy(env.VITE_ANALYTICS_FEATURE_REALTIME) : undefined,\n    },\n  };\n\n  // Clean undefined leaves to respect deep-merge semantics later\n  function prune<T extends object>(obj: T): T {\n    const out: any = Array.isArray(obj) ? [...(obj as any)] : { ...(obj as any) };\n    for (const k of Object.keys(out)) {\n      const v = out[k];\n      if (v && typeof v === 'object' && !Array.isArray(v)) {\n        out[k] = prune(v);\n      }\n      if (out[k] === undefined) delete out[k];\n    }\n    return out as T;\n  }\n\n  return prune(overrides);\n}\n\n// Cache and hot-reload support\nlet cachedConfig: SchemaAnalyticsConfig | null = null;\nlet cacheStamp = 0;\n\nfunction deepMerge<T extends object>(base: T, overrides?: Partial<T> | null): T {\n  if (!overrides) return base;\n  const output: any = Array.isArray(base) ? [...(base as any)] : { ...(base as any) };\n  for (const key of Object.keys(overrides) as Array<keyof T>) {\n    const ov: any = (overrides as any)[key];\n    if (ov === undefined) continue;\n    const bv: any = (base as any)[key];\n    if (bv && typeof bv === 'object' && !Array.isArray(bv) && ov && typeof ov === 'object' && !Array.isArray(ov)) {\n      output[key] = deepMerge(bv, ov);\n    } else {\n      output[key] = ov;\n    }\n  }\n  return output as T;\n}\n\nfunction applyEnvironmentProfile(base: SchemaAnalyticsConfig): SchemaAnalyticsConfig {\n  const env = import.meta.env as Record<string, string | boolean | undefined>;\n  const useMock = truthy(env.VITE_USE_MOCK);\n  const profile = (env.VITE_ANALYTICS_PROFILE as string | undefined)?.toLowerCase();\n\n  let profileOverrides: Partial<SchemaAnalyticsConfig> | null = null;\n\n  if (useMock) {\n    // Softer thresholds and more permissive features to help surface results with mock data\n    profileOverrides = {\n      features: {\n        enableTrends: true,\n        enableAnomalies: true,\n        enableCorrelation: true,\n        enableForecasting: false,\n        enableRealtime: false,\n      },\n      worker: {\n        cache: { ttlSeconds: 60 },\n      },\n    } as Partial<SchemaAnalyticsConfig>;\n  } else if (profile === 'dev') {\n    profileOverrides = {\n      worker: { cache: { ttlSeconds: 120 } },\n    } as Partial<SchemaAnalyticsConfig>;\n  } else if (profile === 'prod') {\n    profileOverrides = {\n      worker: { cache: { ttlSeconds: 300 } },\n    } as Partial<SchemaAnalyticsConfig>;\n  }\n\n  return profileOverrides ? deepMerge(base, profileOverrides) : base;\n}\n\nexport interface AnalyticsLoaderOptions {\n  forceReload?: boolean;\n}\n\nexport function loadAnalyticsConfig(options: AnalyticsLoaderOptions = {}): SchemaAnalyticsConfig {\n  if (cachedConfig && !options.forceReload) {\n    return cachedConfig;\n  }\n\n  // Start from the current runtime config (already merged with project defaults + UI overrides)\n  const runtime = getRuntimeAnalyticsConfig();\n  const baseSchemaPortion: SchemaAnalyticsConfig = analyticsConfigSchema.parse({\n    version: runtime.version,\n    thresholds: runtime.thresholds,\n    rules: runtime.rules,\n    charts: runtime.charts,\n    worker: runtime.worker,\n    features: runtime.features,\n  });\n\n  const profiled = applyEnvironmentProfile(baseSchemaPortion);\n  const envOverrides = readEnvOverrides();\n\n  const { config: validated, errors } = validateAndMergeAnalyticsConfig(profiled, envOverrides);\n  if (errors.length) {\n    logger.warn('Environment analytics overrides contained invalid values; using safe fallbacks');\n  }\n\n  cachedConfig = validated;\n  cacheStamp = Date.now();\n  return validated;\n}\n\nexport function getAnalyticsConfigCacheStamp(): number {\n  return cacheStamp;\n}\n\n// Hot reload in development: clear cache when HMR invalidates this module\nif (import.meta.hot) {\n  import.meta.hot.accept(() => {\n    cachedConfig = null;\n    cacheStamp = Date.now();\n    logger.info('analytics.loader hot-reloaded: cache invalidated');\n  });\n}\n\n// Optional: consumers can subscribe to changes by polling cacheStamp or wiring into HMR themselves.\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/config/schemas/analytics.schema.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/config/validators/analytics.validator.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'z' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":11},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1872,1875],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1872,1875],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1907,1910],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1907,1910],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":54,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1926,1929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1926,1929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2008,2011],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2008,2011],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2020,2023],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2020,2023],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2085,2088],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2085,2088],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2097,2100],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2097,2100],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { z, ZodError } from 'zod';\nimport { logger } from '@/lib/logger';\nimport {\n  analyticsConfigSchema,\n} from '@/config/schemas/analytics.schema';\nimport type { AnalyticsConfig as SchemaAnalyticsConfig } from '@/config/schemas/analytics.schema';\n\nexport interface AnalyticsValidationResult {\n  isValid: boolean;\n  config: SchemaAnalyticsConfig;\n  errors: string[];\n  warnings: string[];\n}\n\n// Formats ZodError issues into developer-friendly messages with paths\nexport function formatZodError(error: ZodError): string[] {\n  return error.issues.map((issue) => {\n    const path = issue.path?.length ? issue.path.join('.') : '(root)';\n    const code = issue.code;\n    return `${path}: ${issue.message}${code ? ` [${code}]` : ''}`;\n  });\n}\n\n// Validates a complete config. If invalid, returns the provided fallback and errors.\nexport function validateAnalyticsConfig(\n  input: unknown,\n  fallback: SchemaAnalyticsConfig,\n): AnalyticsValidationResult {\n  const result = analyticsConfigSchema.safeParse(input);\n  if (result.success) {\n    return { isValid: true, config: result.data, errors: [], warnings: [] };\n  }\n\n  const errors = formatZodError(result.error);\n  // Log once with normalized diagnostics\n  try {\n    logger.error('analytics.config validation failed; using fallback defaults', {\n      errors,\n    });\n  } catch {\n    // noop if logger unavailable in some environments\n  }\n  return { isValid: false, config: fallback, errors, warnings: [] };\n}\n\n// Validates a partial (override) by deep-merging with base first, then parsing.\nexport function validateAndMergeAnalyticsConfig(\n  base: SchemaAnalyticsConfig,\n  overrides?: Partial<SchemaAnalyticsConfig> | null,\n): AnalyticsValidationResult {\n  // Deep merge helper that preserves object structure\n  const deepMerge = <T extends object>(a: T, b?: Partial<T> | null): T => {\n    if (!b) return a;\n    const out: any = Array.isArray(a) ? [...(a as any)] : { ...(a as any) };\n    for (const key of Object.keys(b) as Array<keyof T>) {\n      const bv: any = (b as any)[key];\n      if (bv === undefined) continue;\n      const av: any = (a as any)[key];\n      if (av && typeof av === 'object' && !Array.isArray(av) && typeof bv === 'object' && !Array.isArray(bv)) {\n        out[key] = deepMerge(av, bv);\n      } else {\n        out[key] = bv;\n      }\n    }\n    return out as T;\n  };\n\n  const mergedCandidate = deepMerge(base, overrides ?? undefined);\n  return validateAnalyticsConfig(mergedCandidate, base);\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/contexts/TegnXPContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":49,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":49,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useCallback, useContext, useEffect, useMemo, useState } from 'react';\n\ninterface TegnXPContextValue {\n  xp: number;\n  level: number;\n  addXP: (amount: number) => void;\n}\n\nconst TegnXPContext = createContext<TegnXPContextValue | null>(null);\n\nconst STORAGE_KEY = 'tegn_xp_total';\n\nexport const TegnXPProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [xp, setXp] = useState<number>(() => {\n    try {\n      const raw = localStorage.getItem(STORAGE_KEY);\n      return raw ? Math.max(0, parseInt(raw, 10) || 0) : 0;\n    } catch {\n      return 0;\n    }\n  });\n\n  useEffect(() => {\n    try {\n      localStorage.setItem(STORAGE_KEY, String(xp));\n    } catch {\n      // ignore persistence errors\n    }\n  }, [xp]);\n\n  const addXP = useCallback((amount: number) => {\n    if (!Number.isFinite(amount) || amount <= 0) return;\n    setXp(prev => prev + Math.floor(amount));\n  }, []);\n\n  const level = useMemo(() => {\n    return Math.floor(xp / 100) + 1;\n  }, [xp]);\n\n  const value = useMemo(() => ({ xp, level, addXP }), [xp, level, addXP]);\n\n  return (\n    <TegnXPContext.Provider value={value}>\n      {children}\n    </TegnXPContext.Provider>\n  );\n};\n\nexport const useTegnXP = (): TegnXPContextValue => {\n  const ctx = useContext(TegnXPContext);\n  if (!ctx) throw new Error('useTegnXP must be used within TegnXPProvider');\n  return ctx;\n};\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/contexts/TrackingContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":652,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":652,"endColumn":25}],"suppressedMessages":[{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":179,"column":34,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":183,"endColumn":37,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":189,"column":35,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":192,"endColumn":35,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":261,"column":34,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":265,"endColumn":41,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":298,"column":35,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":301,"endColumn":39,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":350,"column":35,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":353,"endColumn":39,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useCallback, useEffect, useRef } from 'react';\nimport { TrackingEntry, EmotionEntry, SensoryEntry, EnvironmentalEntry } from '@/types/student';\nimport { dataStorage } from '@/lib/dataStorage';\nimport { analyticsManager } from '@/lib/analyticsManager';\nimport { logger } from '@/lib/logger';\nimport { toast } from 'sonner';\n\n/**\n * Session state for tracking data collection\n */\nexport interface SessionState {\n  id: string;\n  studentId: string;\n  startTime: Date;\n  lastActivity: Date;\n  isActive: boolean;\n  isPaused: boolean;\n  emotions: Omit<EmotionEntry, 'id' | 'timestamp'>[];\n  sensoryInputs: Omit<SensoryEntry, 'id' | 'timestamp'>[];\n  environmentalData: Omit<EnvironmentalEntry, 'id' | 'timestamp'> | null;\n  notes: string;\n  autoSaveEnabled: boolean;\n  dataQuality: DataQualityMetrics;\n}\n\n/**\n * Data quality metrics for session\n */\nexport interface DataQualityMetrics {\n  emotionCount: number;\n  sensoryCount: number;\n  hasEnvironmental: boolean;\n  sessionDuration: number;\n  completeness: number; // 0-100\n  lastSaved: Date | null;\n}\n\n/**\n * Session configuration options\n */\nexport interface SessionConfig {\n  autoSaveInterval?: number; // ms\n  sessionTimeout?: number; // ms\n  minDataForSave?: number;\n  enableRecovery?: boolean;\n  enableQualityChecks?: boolean;\n}\n\n/**\n * Tracking context value interface\n */\nexport interface TrackingContextValue {\n  // Session state\n  currentSession: SessionState | null;\n  sessions: SessionState[];\n  \n  // Session management\n  startSession: (studentId: string, config?: SessionConfig) => void;\n  endSession: (save?: boolean) => Promise<void>;\n  pauseSession: () => void;\n  resumeSession: () => void;\n  \n  // Data collection\n  addEmotion: (emotion: Omit<EmotionEntry, 'id' | 'timestamp'>) => void;\n  removeEmotion: (index: number) => void;\n  addSensoryInput: (sensory: Omit<SensoryEntry, 'id' | 'timestamp'>) => void;\n  removeSensoryInput: (index: number) => void;\n  setEnvironmentalData: (environmental: Omit<EnvironmentalEntry, 'id' | 'timestamp'> | null) => void;\n  setNotes: (notes: string) => void;\n  \n  // Session operations\n  saveSession: () => Promise<TrackingEntry | null>;\n  discardSession: () => void;\n  recoverSession: (sessionId: string) => void;\n  \n  // Quality and validation\n  validateSession: () => { isValid: boolean; errors: string[] };\n  getDataQuality: () => DataQualityMetrics;\n  \n  // Configuration\n  sessionConfig: SessionConfig;\n  updateSessionConfig: (config: Partial<SessionConfig>) => void;\n}\n\nconst DEFAULT_SESSION_CONFIG: SessionConfig = {\n  autoSaveInterval: 5 * 60 * 1000, // 5 minutes\n  sessionTimeout: 30 * 60 * 1000, // 30 minutes\n  minDataForSave: 1,\n  enableRecovery: true,\n  enableQualityChecks: true,\n};\n\nconst TrackingContext = createContext<TrackingContextValue | undefined>(undefined);\n\n/**\n * TrackingProvider component\n * Manages all tracking sessions and data collection\n */\nexport const TrackingProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [currentSession, setCurrentSession] = useState<SessionState | null>(null);\n  const [sessions, setSessions] = useState<SessionState[]>([]);\n  const [sessionConfig, setSessionConfig] = useState<SessionConfig>(DEFAULT_SESSION_CONFIG);\n  \n  const autoSaveTimerRef = useRef<NodeJS.Timeout | null>(null);\n  const sessionTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n  /**\n   * Calculate data quality metrics\n   */\n  const calculateDataQuality = useCallback((session: SessionState): DataQualityMetrics => {\n    const emotionCount = session.emotions.length;\n    const sensoryCount = session.sensoryInputs.length;\n    const hasEnvironmental = session.environmentalData !== null;\n    const sessionDuration = Date.now() - session.startTime.getTime();\n    \n    // Calculate completeness score (0-100)\n    let completeness = 0;\n    if (emotionCount > 0) completeness += 30;\n    if (sensoryCount > 0) completeness += 30;\n    if (hasEnvironmental) completeness += 20;\n    if (session.notes.length > 0) completeness += 10;\n    if (sessionDuration > 5 * 60 * 1000) completeness += 10; // 5+ minutes\n    \n    return {\n      emotionCount,\n      sensoryCount,\n      hasEnvironmental,\n      sessionDuration,\n      completeness,\n      lastSaved: null,\n    };\n  }, []);\n\n  /**\n   * Start a new tracking session\n   */\n  const startSession = useCallback((studentId: string, config?: SessionConfig) => {\n    // End any existing session first\n    if (currentSession?.isActive) {\n      endSession(true);\n    }\n\n    const newConfig = { ...sessionConfig, ...config };\n    const sessionId = crypto.randomUUID();\n    \n    const newSession: SessionState = {\n      id: sessionId,\n      studentId,\n      startTime: new Date(),\n      lastActivity: new Date(),\n      isActive: true,\n      isPaused: false,\n      emotions: [],\n      sensoryInputs: [],\n      environmentalData: null,\n      notes: '',\n      autoSaveEnabled: true,\n      dataQuality: {\n        emotionCount: 0,\n        sensoryCount: 0,\n        hasEnvironmental: false,\n        sessionDuration: 0,\n        completeness: 0,\n        lastSaved: null,\n      },\n    };\n\n    setCurrentSession(newSession);\n    setSessions(prev => [...prev, newSession]);\n    \n    // Save to localStorage for recovery\n    if (newConfig.enableRecovery) {\n      localStorage.setItem(`sensoryTracker_activeSession_${studentId}`, JSON.stringify(newSession));\n    }\n\n    // Setup auto-save\n    if (newConfig.autoSaveInterval) {\n      // eslint-disable-next-line no-restricted-syntax\n      autoSaveTimerRef.current = setInterval(() => {\n        if (currentSession?.autoSaveEnabled) {\n          saveSession();\n        }\n      }, newConfig.autoSaveInterval);\n    }\n\n    // Setup session timeout\n    if (newConfig.sessionTimeout) {\n      // eslint-disable-next-line no-restricted-syntax\n      sessionTimeoutRef.current = setTimeout(() => {\n        toast.warning('Session timed out due to inactivity');\n        endSession(true);\n      }, newConfig.sessionTimeout);\n    }\n\n    logger.info('[TrackingContext] Started new session', { sessionId, studentId });\n  }, [currentSession, sessionConfig, endSession, saveSession]);\n\n  /**\n   * End the current session\n   */\n  const endSession = useCallback(async (save: boolean = true) => {\n    if (!currentSession) return;\n\n    if (save) {\n      await saveSession();\n    }\n\n    // Clear timers\n    if (autoSaveTimerRef.current) {\n      clearInterval(autoSaveTimerRef.current);\n      autoSaveTimerRef.current = null;\n    }\n    if (sessionTimeoutRef.current) {\n      clearTimeout(sessionTimeoutRef.current);\n      sessionTimeoutRef.current = null;\n    }\n\n    // Clear recovery data\n    localStorage.removeItem(`sensoryTracker_activeSession_${currentSession.studentId}`);\n\n    setCurrentSession(null);\n    logger.info('[TrackingContext] Ended session', { sessionId: currentSession.id });\n  }, [currentSession, saveSession]);\n\n  /**\n   * Pause the current session\n   */\n  const pauseSession = useCallback(() => {\n    if (!currentSession || !currentSession.isActive) return;\n\n    setCurrentSession(prev => prev ? {\n      ...prev,\n      isPaused: true,\n      lastActivity: new Date(),\n    } : null);\n\n    // Pause auto-save\n    if (autoSaveTimerRef.current) {\n      clearInterval(autoSaveTimerRef.current);\n      autoSaveTimerRef.current = null;\n    }\n\n    logger.info('[TrackingContext] Paused session', { sessionId: currentSession.id });\n  }, [currentSession]);\n\n  /**\n   * Resume a paused session\n   */\n  const resumeSession = useCallback(() => {\n    if (!currentSession || !currentSession.isPaused) return;\n\n    setCurrentSession(prev => prev ? {\n      ...prev,\n      isPaused: false,\n      lastActivity: new Date(),\n    } : null);\n\n    // Resume auto-save\n    if (sessionConfig.autoSaveInterval) {\n      // eslint-disable-next-line no-restricted-syntax\n      autoSaveTimerRef.current = setInterval(() => {\n        if (currentSession?.autoSaveEnabled) {\n          saveSession();\n        }\n      }, sessionConfig.autoSaveInterval);\n    }\n\n    logger.info('[TrackingContext] Resumed session', { sessionId: currentSession.id });\n  }, [currentSession, sessionConfig, saveSession]);\n\n  /**\n   * Add emotion to current session\n   */\n  const addEmotion = useCallback((emotion: Omit<EmotionEntry, 'id' | 'timestamp'>) => {\n    if (!currentSession) return;\n\n    setCurrentSession(prev => {\n      if (!prev) return null;\n      const updated = {\n        ...prev,\n        emotions: [...prev.emotions, emotion],\n        lastActivity: new Date(),\n      };\n      updated.dataQuality = calculateDataQuality(updated);\n      \n      // Update recovery data\n      if (sessionConfig.enableRecovery) {\n        localStorage.setItem(`sensoryTracker_activeSession_${prev.studentId}`, JSON.stringify(updated));\n      }\n      \n      return updated;\n    });\n\n    // Reset timeout\n    if (sessionTimeoutRef.current && sessionConfig.sessionTimeout) {\n      clearTimeout(sessionTimeoutRef.current);\n      // eslint-disable-next-line no-restricted-syntax\n      sessionTimeoutRef.current = setTimeout(() => {\n        toast.warning('Session timed out due to inactivity');\n        endSession(true);\n      }, sessionConfig.sessionTimeout);\n    }\n  }, [currentSession, sessionConfig, calculateDataQuality, endSession]);\n\n  /**\n   * Remove emotion from current session\n   */\n  const removeEmotion = useCallback((index: number) => {\n    if (!currentSession) return;\n\n    setCurrentSession(prev => {\n      if (!prev) return null;\n      const updated = {\n        ...prev,\n        emotions: prev.emotions.filter((_, i) => i !== index),\n        lastActivity: new Date(),\n      };\n      updated.dataQuality = calculateDataQuality(updated);\n      return updated;\n    });\n  }, [currentSession, calculateDataQuality]);\n\n  /**\n   * Add sensory input to current session\n   */\n  const addSensoryInput = useCallback((sensory: Omit<SensoryEntry, 'id' | 'timestamp'>) => {\n    if (!currentSession) return;\n\n    setCurrentSession(prev => {\n      if (!prev) return null;\n      const updated = {\n        ...prev,\n        sensoryInputs: [...prev.sensoryInputs, sensory],\n        lastActivity: new Date(),\n      };\n      updated.dataQuality = calculateDataQuality(updated);\n      \n      // Update recovery data\n      if (sessionConfig.enableRecovery) {\n        localStorage.setItem(`sensoryTracker_activeSession_${prev.studentId}`, JSON.stringify(updated));\n      }\n      \n      return updated;\n    });\n\n    // Reset timeout\n    if (sessionTimeoutRef.current && sessionConfig.sessionTimeout) {\n      clearTimeout(sessionTimeoutRef.current);\n      // eslint-disable-next-line no-restricted-syntax\n      sessionTimeoutRef.current = setTimeout(() => {\n        toast.warning('Session timed out due to inactivity');\n        endSession(true);\n      }, sessionConfig.sessionTimeout);\n    }\n  }, [currentSession, sessionConfig, calculateDataQuality, endSession]);\n\n  /**\n   * Remove sensory input from current session\n   */\n  const removeSensoryInput = useCallback((index: number) => {\n    if (!currentSession) return;\n\n    setCurrentSession(prev => {\n      if (!prev) return null;\n      const updated = {\n        ...prev,\n        sensoryInputs: prev.sensoryInputs.filter((_, i) => i !== index),\n        lastActivity: new Date(),\n      };\n      updated.dataQuality = calculateDataQuality(updated);\n      return updated;\n    });\n  }, [currentSession, calculateDataQuality]);\n\n  /**\n   * Set environmental data for current session\n   */\n  const setEnvironmentalData = useCallback((environmental: Omit<EnvironmentalEntry, 'id' | 'timestamp'> | null) => {\n    if (!currentSession) return;\n\n    setCurrentSession(prev => {\n      if (!prev) return null;\n      const updated = {\n        ...prev,\n        environmentalData: environmental,\n        lastActivity: new Date(),\n      };\n      updated.dataQuality = calculateDataQuality(updated);\n      \n      // Update recovery data\n      if (sessionConfig.enableRecovery) {\n        localStorage.setItem(`sensoryTracker_activeSession_${prev.studentId}`, JSON.stringify(updated));\n      }\n      \n      return updated;\n    });\n  }, [currentSession, sessionConfig, calculateDataQuality]);\n\n  /**\n   * Set notes for current session\n   */\n  const setNotes = useCallback((notes: string) => {\n    if (!currentSession) return;\n\n    setCurrentSession(prev => {\n      if (!prev) return null;\n      const updated = {\n        ...prev,\n        notes,\n        lastActivity: new Date(),\n      };\n      updated.dataQuality = calculateDataQuality(updated);\n      \n      // Update recovery data\n      if (sessionConfig.enableRecovery) {\n        localStorage.setItem(`sensoryTracker_activeSession_${prev.studentId}`, JSON.stringify(updated));\n      }\n      \n      return updated;\n    });\n  }, [currentSession, sessionConfig, calculateDataQuality]);\n\n  /**\n   * Save the current session\n   */\n  const saveSession = useCallback(async (): Promise<TrackingEntry | null> => {\n    if (!currentSession) return null;\n\n    const validation = validateSession();\n    if (!validation.isValid) {\n      validation.errors.forEach(error => toast.error(error));\n      return null;\n    }\n\n    try {\n      const timestamp = new Date();\n      const trackingEntry: TrackingEntry = {\n        id: crypto.randomUUID(),\n        studentId: currentSession.studentId,\n        timestamp,\n        emotions: currentSession.emotions.map(e => ({\n          ...e,\n          id: crypto.randomUUID(),\n          timestamp,\n        })),\n        sensoryInputs: currentSession.sensoryInputs.map(s => ({\n          ...s,\n          id: crypto.randomUUID(),\n          timestamp,\n        })),\n        environmentalData: currentSession.environmentalData ? {\n          ...currentSession.environmentalData,\n          id: crypto.randomUUID(),\n          timestamp,\n        } : undefined,\n        notes: currentSession.notes || undefined,\n        version: 1,\n      };\n\n      // Save to storage\n      dataStorage.saveTrackingEntry(trackingEntry);\n\n      // Update quality metrics\n      setCurrentSession(prev => prev ? {\n        ...prev,\n        dataQuality: {\n          ...prev.dataQuality,\n          lastSaved: timestamp,\n        },\n      } : null);\n\n      // Trigger analytics update\n      const student = dataStorage.getStudentById(currentSession.studentId);\n      if (student) {\n        await analyticsManager.triggerAnalyticsForStudent(student);\n      }\n\n      toast.success('Session saved successfully');\n      logger.info('[TrackingContext] Session saved', { \n        sessionId: currentSession.id, \n        entryId: trackingEntry.id \n      });\n\n      return trackingEntry;\n    } catch (error) {\n      logger.error('[TrackingContext] Failed to save session', { error });\n      toast.error('Failed to save session');\n      return null;\n    }\n  }, [currentSession, validateSession]);\n\n  /**\n   * Validate the current session\n   */\n  const validateSession = useCallback((): { isValid: boolean; errors: string[] } => {\n    const errors: string[] = [];\n\n    if (!currentSession) {\n      errors.push('No active session');\n      return { isValid: false, errors };\n    }\n\n    if (sessionConfig.minDataForSave) {\n      const totalData = currentSession.emotions.length + currentSession.sensoryInputs.length;\n      if (totalData < sessionConfig.minDataForSave) {\n        errors.push(`At least ${sessionConfig.minDataForSave} data point(s) required`);\n      }\n    }\n\n    if (sessionConfig.enableQualityChecks) {\n      const quality = calculateDataQuality(currentSession);\n      if (quality.completeness < 20) {\n        errors.push('Session data is too incomplete (< 20% completeness)');\n      }\n    }\n\n    return { isValid: errors.length === 0, errors };\n  }, [currentSession, sessionConfig, calculateDataQuality]);\n\n  /**\n   * Discard the current session\n   */\n  const discardSession = useCallback(() => {\n    if (!currentSession) return;\n\n    // Clear recovery data\n    localStorage.removeItem(`sensoryTracker_activeSession_${currentSession.studentId}`);\n\n    setCurrentSession(null);\n    toast.info('Session discarded');\n    logger.info('[TrackingContext] Session discarded', { sessionId: currentSession.id });\n  }, [currentSession]);\n\n  /**\n   * Recover a session from localStorage\n   */\n  const recoverSession = useCallback((sessionId: string) => {\n    const session = sessions.find(s => s.id === sessionId);\n    if (!session) {\n      toast.error('Session not found');\n      return;\n    }\n\n    setCurrentSession(session);\n    toast.success('Session recovered');\n    logger.info('[TrackingContext] Session recovered', { sessionId });\n  }, [sessions]);\n\n  /**\n   * Get current data quality metrics\n   */\n  const getDataQuality = useCallback((): DataQualityMetrics => {\n    if (!currentSession) {\n      return {\n        emotionCount: 0,\n        sensoryCount: 0,\n        hasEnvironmental: false,\n        sessionDuration: 0,\n        completeness: 0,\n        lastSaved: null,\n      };\n    }\n    return calculateDataQuality(currentSession);\n  }, [currentSession, calculateDataQuality]);\n\n  /**\n   * Update session configuration\n   */\n  const updateSessionConfig = useCallback((config: Partial<SessionConfig>) => {\n    setSessionConfig(prev => ({ ...prev, ...config }));\n  }, []);\n\n  /**\n   * Check for recoverable sessions on mount\n   */\n  useEffect(() => {\n    const checkRecoverableSessions = () => {\n      const keys = Object.keys(localStorage).filter(k => \n        k.startsWith('sensoryTracker_activeSession_')\n      );\n\n      if (keys.length > 0) {\n        const recoverableSessionsData = keys.map(key => {\n          try {\n            return JSON.parse(localStorage.getItem(key) || '{}');\n          } catch {\n            return null;\n          }\n        }).filter(Boolean);\n\n        if (recoverableSessionsData.length > 0) {\n          setSessions(recoverableSessionsData.map(data => ({\n            ...data,\n            startTime: new Date(data.startTime),\n            lastActivity: new Date(data.lastActivity),\n          })));\n\n          toast.info(`Found ${recoverableSessionsData.length} recoverable session(s)`);\n        }\n      }\n    };\n\n    checkRecoverableSessions();\n  }, []);\n\n  /**\n   * Cleanup on unmount\n   */\n  useEffect(() => {\n    return () => {\n      if (autoSaveTimerRef.current) {\n        clearInterval(autoSaveTimerRef.current);\n      }\n      if (sessionTimeoutRef.current) {\n        clearTimeout(sessionTimeoutRef.current);\n      }\n    };\n  }, []);\n\n  const value: TrackingContextValue = {\n    currentSession,\n    sessions,\n    startSession,\n    endSession,\n    pauseSession,\n    resumeSession,\n    addEmotion,\n    removeEmotion,\n    addSensoryInput,\n    removeSensoryInput,\n    setEnvironmentalData,\n    setNotes,\n    saveSession,\n    discardSession,\n    recoverSession,\n    validateSession,\n    getDataQuality,\n    sessionConfig,\n    updateSessionConfig,\n  };\n\n  return (\n    <TrackingContext.Provider value={value}>\n      {children}\n    </TrackingContext.Provider>\n  );\n};\n\n/**\n * Hook to use the tracking context\n */\nexport const useTracking = () => {\n  const context = useContext(TrackingContext);\n  if (!context) {\n    throw new Error('useTracking must be used within a TrackingProvider');\n  }\n  return context;\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/demo/EnvironmentalCorrelationsDemo.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EmotionEntry' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SensoryEntry' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":60},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generateUniversalTrackingData' is defined but never used. Allowed unused vars must match /^_/u.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":39},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Environmental Correlations Demo\"","line":145,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":145,"endColumn":83},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h2 className=\"text-lg font-semibold mb-2\">Environmental Correlations Demo</h2>","line":145,"column":52,"nodeType":"JSXText","endLine":145,"endColumn":83},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"This demo shows how environmental factors correlate with emotional responses.\n          The data is generated to show a strong correlation between noise levels and anxiety.\"","line":146,"column":51,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":149,"endColumn":9},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-gray-700 mb-4\">\n          This demo shows how environmental factors correlate with emotional responses.\n          The data is generated to show a strong correlation between noise levels and anxiety.\n        </p>","line":146,"column":51,"nodeType":"JSXText","endLine":149,"endColumn":9},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"1 Week\"","line":151,"column":102,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":153,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button onClick={() => regenerateData(7)} variant={dataSize === 7 ? 'default' : 'outline'}>\n            1 Week\n          </Button>","line":151,"column":102,"nodeType":"JSXText","endLine":153,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"30 Days\"","line":154,"column":104,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":156,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button onClick={() => regenerateData(30)} variant={dataSize === 30 ? 'default' : 'outline'}>\n            30 Days\n          </Button>","line":154,"column":104,"nodeType":"JSXText","endLine":156,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"90 Days\"","line":157,"column":104,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":159,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button onClick={() => regenerateData(90)} variant={dataSize === 90 ? 'default' : 'outline'}>\n            90 Days\n          </Button>","line":157,"column":104,"nodeType":"JSXText","endLine":159,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Pattern in data:\"","line":162,"column":22,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":162,"endColumn":38},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <strong>Pattern in data:</strong>","line":162,"column":22,"nodeType":"JSXText","endLine":162,"endColumn":38},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Morning sessions: Low noise (1-2) → Calm emotions (intensity 2-3)\"","line":164,"column":17,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":164,"endColumn":82},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>Morning sessions: Low noise (1-2) → Calm emotions (intensity 2-3)</li>","line":164,"column":17,"nodeType":"JSXText","endLine":164,"endColumn":82},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Afternoon sessions: High noise (4-5) → Anxious emotions (intensity 4-5)\"","line":165,"column":17,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":165,"endColumn":88},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <li>Afternoon sessions: High noise (4-5) → Anxious emotions (intensity 4-5)</li>","line":165,"column":17,"nodeType":"JSXText","endLine":165,"endColumn":88}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":19,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\nimport { AnalyticsDashboard } from '@/components/AnalyticsDashboard';\nimport { Student, TrackingEntry, EmotionEntry, SensoryEntry } from '@/types/student';\nimport { generateUniversalTrackingData } from '@/lib/universalDataGenerator';\nimport { Button } from '@/components/ui/button';\n\n// Generate a more comprehensive dataset with clear correlations\nconst generateCorrelatedData = (student: Student, days: number = 30): Student => {\n  const entries: TrackingEntry[] = [];\n  const baseDate = new Date();\n  \n  for (let i = 0; i < days; i++) {\n    const date = new Date(baseDate);\n    date.setDate(date.getDate() - i);\n    \n    // Morning session (low noise, calm emotions)\n    const morningEntry: TrackingEntry = {\n      id: `morning_${i}`,\n      studentId: student.id,\n      timestamp: new Date(date.setHours(9, 0, 0, 0)),\n      emotions: [{\n        id: `morning_emotion_${i}`,\n        studentId: student.id,\n        emotion: 'calm',\n        intensity: Math.random() < 0.8 ? 2 : 3, // Mostly low intensity\n        timestamp: new Date(date),\n      }],\n      sensoryInputs: [{\n        id: `morning_sensory_${i}`,\n        studentId: student.id,\n        sensoryType: 'auditory',\n        response: 'neutral',\n        intensity: 2,\n        timestamp: new Date(date),\n      }],\n      environmentalData: {\n        id: `morning_env_${i}`,\n        timestamp: new Date(date),\n        roomConditions: {\n          noiseLevel: Math.random() < 0.8 ? 1 : 2, // Low noise\n          temperature: 21,\n          lighting: 'natural',\n          humidity: 45,\n        },\n        weather: {\n          condition: 'sunny',\n          temperature: 20,\n          pressure: 1013,\n        },\n        classroom: {\n          activity: 'instruction',\n          studentCount: 15,\n          timeOfDay: 'morning',\n        },\n      },\n      version: 1,\n    };\n    \n    // Afternoon session (high noise, anxious emotions - showing correlation)\n    const afternoonEntry: TrackingEntry = {\n      id: `afternoon_${i}`,\n      studentId: student.id,\n      timestamp: new Date(date.setHours(14, 0, 0, 0)),\n      emotions: [{\n        id: `afternoon_emotion_${i}`,\n        studentId: student.id,\n        emotion: 'anxious',\n        intensity: Math.random() < 0.8 ? 4 : 5, // Mostly high intensity\n        timestamp: new Date(date),\n      }],\n      sensoryInputs: [{\n        id: `afternoon_sensory_${i}`,\n        studentId: student.id,\n        sensoryType: 'auditory',\n        response: 'avoiding',\n        intensity: 4,\n        timestamp: new Date(date),\n      }],\n      environmentalData: {\n        id: `afternoon_env_${i}`,\n        timestamp: new Date(date),\n        roomConditions: {\n          noiseLevel: Math.random() < 0.8 ? 4 : 5, // High noise\n          temperature: 23,\n          lighting: 'fluorescent',\n          humidity: 50,\n        },\n        weather: {\n          condition: 'cloudy',\n          temperature: 22,\n          pressure: 1010,\n        },\n        classroom: {\n          activity: 'group-work',\n          studentCount: 25,\n          timeOfDay: 'afternoon',\n        },\n      },\n      version: 1,\n    };\n    \n    entries.push(morningEntry, afternoonEntry);\n  }\n  \n  // Extract all emotions and sensory inputs for the student object\n  const allEmotions = entries.flatMap(e => e.emotions);\n  const allSensory = entries.flatMap(e => e.sensoryInputs);\n  \n  return {\n    ...student,\n    trackingEntries: entries,\n    emotions: allEmotions,\n    sensory: allSensory,\n  };\n};\n\nexport const EnvironmentalCorrelationsDemo: React.FC = () => {\n  const baseStudent: Student = {\n    id: 'demo-student-1',\n    name: 'Demo Student',\n    dateOfBirth: '2015-01-01',\n    grade: '3rd Grade',\n    createdAt: new Date(),\n    updatedAt: new Date(),\n    archived: false,\n    goals: [],\n    trackingEntries: [],\n    emotions: [],\n    sensory: [],\n  };\n  \n  const [student, setStudent] = useState<Student>(() => \n    generateCorrelatedData(baseStudent, 30)\n  );\n  const [dataSize, setDataSize] = useState(30);\n  \n  const regenerateData = (days: number) => {\n    setDataSize(days);\n    setStudent(generateCorrelatedData(baseStudent, days));\n  };\n  \n  return (\n    <div className=\"p-6 space-y-4\">\n      <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\n        <h2 className=\"text-lg font-semibold mb-2\">Environmental Correlations Demo</h2>\n        <p className=\"text-sm text-gray-700 mb-4\">\n          This demo shows how environmental factors correlate with emotional responses.\n          The data is generated to show a strong correlation between noise levels and anxiety.\n        </p>\n        <div className=\"flex gap-2\">\n          <Button onClick={() => regenerateData(7)} variant={dataSize === 7 ? 'default' : 'outline'}>\n            1 Week\n          </Button>\n          <Button onClick={() => regenerateData(30)} variant={dataSize === 30 ? 'default' : 'outline'}>\n            30 Days\n          </Button>\n          <Button onClick={() => regenerateData(90)} variant={dataSize === 90 ? 'default' : 'outline'}>\n            90 Days\n          </Button>\n        </div>\n        <div className=\"mt-4 text-sm text-gray-600\">\n          <p><strong>Pattern in data:</strong></p>\n          <ul className=\"list-disc list-inside ml-2\">\n            <li>Morning sessions: Low noise (1-2) → Calm emotions (intensity 2-3)</li>\n            <li>Afternoon sessions: High noise (4-5) → Anxious emotions (intensity 4-5)</li>\n          </ul>\n        </div>\n      </div>\n      \n      <AnalyticsDashboard student={student} />\n    </div>\n  );\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/__tests__/hooks-exhaustive-deps.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'waitFor' is defined but never used. Allowed unused vars must match /^_/u.","line":7,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":34},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'subDays' is defined but never used. Allowed unused vars must match /^_/u.","line":14,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'range' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":65,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":65,"endColumn":21},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":317,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":317,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10130,10133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10130,10133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":318,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10197,10200],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10197,10200],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * @fileoverview Tests for React Hooks exhaustive-deps fixes\n * These tests ensure that hooks dependencies are correctly specified to prevent stale closures\n */\n\nimport { describe, it, expect, beforeEach, vi } from 'vitest';\nimport { renderHook, act, waitFor } from '@testing-library/react';\nimport { useState, useCallback } from 'react';\nimport { useDataFiltering } from '../useDataFiltering';\nimport { usePerformanceCache } from '../usePerformanceCache';\nimport { useAnalyticsWorker } from '../useAnalyticsWorker';\nimport { TimeRange } from '@/components/DateRangeSelector';\nimport { EmotionEntry, SensoryEntry, TrackingEntry } from '@/types/student';\nimport { startOfDay, endOfDay, subDays } from 'date-fns';\n\n// Mock data\nconst createMockTrackingEntry = (id: string, timestamp: Date): TrackingEntry => ({\n  id,\n  studentId: 'test-student',\n  timestamp,\n  emotions: [],\n  sensoryInputs: [],\n  notes: 'Test entry'\n});\n\nconst createMockEmotionEntry = (id: string, timestamp: Date): EmotionEntry => ({\n  id,\n  studentId: 'test-student',\n  timestamp,\n  emotion: 'happy',\n  intensity: 3,\n  triggers: [],\n  notes: ''\n});\n\nconst createMockSensoryEntry = (id: string, timestamp: Date): SensoryEntry => ({\n  id,\n  studentId: 'test-student',\n  timestamp,\n  type: 'visual',\n  description: 'Test sensory input',\n  intensity: 3,\n  response: 'positive'\n});\n\ndescribe('Hooks Exhaustive Dependencies Tests', () => {\n  describe('useDataFiltering', () => {\n    it('should recompute filtered data when selectedRange changes', () => {\n      const mockEntries = [\n        createMockTrackingEntry('1', new Date('2024-01-01')),\n        createMockTrackingEntry('2', new Date('2024-01-15')),\n        createMockTrackingEntry('3', new Date('2024-02-01'))\n      ];\n\n      const mockEmotions = [\n        createMockEmotionEntry('1', new Date('2024-01-01')),\n        createMockEmotionEntry('2', new Date('2024-01-15'))\n      ];\n\n      const mockSensory = [\n        createMockSensoryEntry('1', new Date('2024-01-01'))\n      ];\n\n      const { result } = renderHook(() => {\n        const [range, setRange] = useState<TimeRange>({\n          start: startOfDay(new Date('2024-01-01')),\n          end: endOfDay(new Date('2024-01-31')),\n          label: 'January'\n        });\n\n        const filtering = useDataFiltering(mockEntries, mockEmotions, mockSensory);\n        \n        return {\n          ...filtering,\n          setRange\n        };\n      });\n\n      // Set date range to January explicitly to match mock data\n      act(() => {\n        result.current.handleRangeChange({\n          start: startOfDay(new Date('2024-01-01')),\n          end: endOfDay(new Date('2024-01-31')),\n          label: 'January'\n        });\n      });\n\n      expect(result.current.filteredData.entries).toHaveLength(2); // Jan 1 and Jan 15\n      expect(result.current.filteredData.emotions).toHaveLength(2);\n      expect(result.current.filteredData.sensoryInputs).toHaveLength(1);\n\n      // Change date range to February\n      act(() => {\n        result.current.handleRangeChange({\n          start: startOfDay(new Date('2024-02-01')),\n          end: endOfDay(new Date('2024-02-29')),\n          label: 'February'\n        });\n      });\n\n      // Should now include February entries only\n      expect(result.current.filteredData.entries).toHaveLength(1); // Feb 1 only\n      expect(result.current.filteredData.emotions).toHaveLength(0); // No February emotions\n      expect(result.current.filteredData.sensoryInputs).toHaveLength(0); // No February sensory\n    });\n\n    it('should recompute when input data arrays change', () => {\n      const initialEntries = [createMockTrackingEntry('1', new Date())];\n      const { result, rerender } = renderHook(\n        ({ entries }: { entries: TrackingEntry[] }) => \n          useDataFiltering(entries, [], [])\n      , { initialProps: { entries: initialEntries } });\n\n      expect(result.current.filteredData.entries).toHaveLength(1);\n\n      // Change the entries array\n      const newEntries = [\n        ...initialEntries,\n        createMockTrackingEntry('2', new Date())\n      ];\n      \n      rerender({ entries: newEntries });\n      \n      expect(result.current.filteredData.entries).toHaveLength(2);\n    });\n  });\n\n  describe('usePerformanceCache', () => {\n    it('should properly handle cache operations with stable function references', () => {\n      const { result } = renderHook(() => usePerformanceCache<string>({ \n        enableStats: true,\n        maxSize: 10\n      }));\n\n      // Test stable function references\n      const initialGet = result.current.get;\n      const initialSet = result.current.set;\n      \n      act(() => {\n        result.current.set('key1', 'value1', ['tag1']);\n      });\n\n      expect(result.current.get('key1')).toBe('value1');\n      \n      // Function references should remain stable\n      expect(result.current.get).toBe(initialGet);\n      expect(result.current.set).toBe(initialSet);\n    });\n\n    it('should properly clean up tags when evicting LRU entries', () => {\n      // Use static Date.now to control timestamps deterministically without fake timers\n      const nowSpy = vi.spyOn(Date, 'now');\n      const t1 = new Date('2024-01-01T00:00:00Z').getTime();\n      const t2 = new Date('2024-01-02T00:00:00Z').getTime();\n      const t3 = new Date('2024-01-03T00:00:00Z').getTime();\n\n      const { result } = renderHook(() => usePerformanceCache<string>({ \n        maxSize: 2,\n        enableStats: true\n      }));\n\n      // Fill cache with deterministic timestamps\n      nowSpy.mockReturnValueOnce(t1);\n      act(() => {\n        result.current.set('key1', 'value1', ['tag1']);\n      });\n\n      nowSpy.mockReturnValueOnce(t2);\n      act(() => {\n        result.current.set('key2', 'value2', ['tag2']);\n      });\n\n      expect(result.current.size).toBe(2);\n\n      const initialEvictions = result.current.stats?.evictions ?? 0;\n\n      // Adding a newer entry should evict the LRU (key1)\n      nowSpy.mockReturnValueOnce(t3);\n      act(() => {\n        result.current.set('key3', 'value3', ['tag3']);\n      });\n\n      // Eviction should be synchronous in set()\n      expect(result.current.stats?.evictions).toBe(initialEvictions + 1);\n\n      // LRU key should be gone, newest present, size bounded\n      expect(result.current.get('key1')).toBeUndefined();\n      expect(result.current.get('key3')).toBe('value3');\n      expect(result.current.size).toBeLessThanOrEqual(2);\n\n      nowSpy.mockRestore();\n    });\n\n    it('should update hit rate correctly', () => {\n      const { result } = renderHook(() => usePerformanceCache<string>({ \n        enableStats: true\n      }));\n\n      act(() => {\n        result.current.set('key1', 'value1');\n      });\n\n      // Initial hit rate should be 0 (no hits yet)\n      expect(result.current.stats?.hitRate).toBe(0);\n\n      act(() => {\n        result.current.get('key1'); // Hit\n        result.current.get('nonexistent'); // Miss\n      });\n\n      // Should be 50% hit rate (1 hit, 1 miss)\n      expect(result.current.stats?.hitRate).toBe(50);\n    });\n  });\n\n  describe('useAnalyticsWorker', () => {\n    // Mock the analytics worker module\n  beforeEach(() => {\n      vi.clearAllMocks();\n    });\n\n    it('should use fresh extractTagsFromData function', async () => {\n      const mockExtractTags = vi.fn(() => ['tag1', 'tag2']);\n      \n      const { result } = renderHook(() => {\n        const worker = useAnalyticsWorker({ extractTagsFromData: mockExtractTags });\n        return worker;\n      });\n\n      // Simulate analytics data\n      const mockData = {\n        emotions: [],\n        sensoryInputs: [],\n        entries: []\n      };\n\n      await act(async () => {\n        await result.current.runAnalysis(mockData);\n      });\n\n      // The function should have been called at least once\n      expect(mockExtractTags).toHaveBeenCalled();\n    });\n\n    it('should handle cache invalidation correctly', () => {\n      const { result } = renderHook(() => useAnalyticsWorker());\n\n      // Test that cache operations work\n      act(() => {\n        result.current.clearCache();\n      });\n\n      expect(result.current.cacheSize).toBe(0);\n      \n      // Test student-specific invalidation\n      act(() => {\n        result.current.invalidateCacheForStudent('test-student');\n      });\n\n      // Should not throw errors\n      expect(result.current.cacheSize).toBe(0);\n    });\n  });\n\n  describe('Component hooks integration', () => {\n    it('should maintain function stability across re-renders', () => {\n      const { result, rerender } = renderHook(() => {\n        const [studentId, setStudentId] = useState('student1');\n        const [showOnlyUnresolved, setShowOnlyUnresolved] = useState(false);\n        \n        // Simulate the loadAlerts function from AlertManager\n        const loadAlerts = useCallback(() => {\n          // Mock implementation\n          return { studentId, showOnlyUnresolved };\n        }, [studentId, showOnlyUnresolved]);\n\n        return { loadAlerts, setStudentId, setShowOnlyUnresolved };\n      });\n\n      const initialLoadAlerts = result.current.loadAlerts;\n\n      // Change studentId\n      act(() => {\n        result.current.setStudentId('student2');\n      });\n\n      // loadAlerts should be a new function due to changed dependency\n      expect(result.current.loadAlerts).not.toBe(initialLoadAlerts);\n\n      // But if we don't change dependencies, it should remain stable\n      rerender();\n      const afterRerender = result.current.loadAlerts;\n      \n      rerender();\n      expect(result.current.loadAlerts).toBe(afterRerender);\n    });\n  });\n\n  describe('Translation hook dependencies', () => {\n    it('should handle language changes correctly', () => {\n      // Mock i18n\n      const mockI18n = {\n        language: 'en',\n        changeLanguage: vi.fn(),\n        t: vi.fn((key: string) => key)\n      };\n\n      // This test would require proper mocking of react-i18next\n      // For now, we just test that the pattern is correct\n      expect(mockI18n.changeLanguage).toBeDefined();\n    });\n  });\n});\n\ndescribe('Memory Leak Prevention', () => {\n  it('should clean up intervals and timeouts', () => {\n    const clearIntervalSpy = vi.spyOn(global, 'clearInterval' as any);\n    const setIntervalSpy = vi.spyOn(global, 'setInterval' as any);\n\n    const { unmount } = renderHook(() => {\n      const [, setTrigger] = useState(0);\n      \n      // Simulate a component that sets up intervals\n      const refreshInterval = setInterval(() => {\n        setTrigger(prev => prev + 1);\n      }, 1000);\n\n      return { refreshInterval };\n    });\n\n    expect(setIntervalSpy).toHaveBeenCalled();\n\n    // Unmount should clean up\n    unmount();\n\n    // In a real component, this would be handled by useEffect cleanup\n    // Here we just verify the spies work\n    expect(clearIntervalSpy).toBeDefined();\n    expect(setIntervalSpy).toBeDefined();\n\n    clearIntervalSpy.mockRestore();\n    setIntervalSpy.mockRestore();\n  });\n\n  it('should handle event listener cleanup', () => {\n    const addEventListenerSpy = vi.spyOn(document, 'addEventListener');\n    const removeEventListenerSpy = vi.spyOn(document, 'removeEventListener');\n\n    const { unmount } = renderHook(() => {\n      // Simulate event listener setup\n      const handleClick = () => {};\n      \n      return { handleClick };\n    });\n\n    // In a real scenario, this would be in a useEffect\n    document.addEventListener('click', () => {});\n\n    unmount();\n\n    // Clean up\n    document.removeEventListener('click', () => {});\n\n    expect(addEventListenerSpy).toHaveBeenCalled();\n    expect(removeEventListenerSpy).toHaveBeenCalled();\n\n    addEventListenerSpy.mockRestore();\n    removeEventListenerSpy.mockRestore();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/__tests__/useLocalStorage.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/use-mobile.tsx","messages":[{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":13,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":13,"endColumn":45}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => {\n      // Modern browsers use removeEventListener without the 'change' parameter\n      if (mql.removeEventListener) {\n        mql.removeEventListener(\"change\", onChange)\n      }\n    }\n  }, [])\n\n  return !!isMobile\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/use-toast.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'actionTypes' is assigned a value but only used as a type. Allowed unused vars must match /^_/u.","line":18,"column":7,"nodeType":null,"messageId":"usedOnlyAsType","endLine":18,"endColumn":18},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":63,"column":19,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":69,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useAnalyticsStatus.ts","messages":[{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":101,"column":22,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":101,"endColumn":53}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from \"react\";\nimport { analyticsManager } from \"@/lib/analyticsManager\";\nimport { logger } from \"@/lib/logger\";\n\ninterface AnalyticsStatus {\n  studentId: string;\n  studentName: string;\n  isInitialized: boolean;\n  lastAnalyzed: Date | null;\n  healthScore: number;\n  hasMinimumData: boolean;\n}\n\n/**\n * An interface that defines the return values of the `useAnalyticsStatus` hook.\n *\n * This interface documents the structure of the data and functions provided\n * by the `useAnalyticsStatus` hook, which can be used to manage the analytics\n * status of students.\n *\n * @property {AnalyticsStatus[]} analyticsStatus - An array of analytics status objects.\n * @property {boolean} isLoading - A boolean indicating whether the analytics status is currently being loaded.\n * @property {() => Promise<void>} refresh - A function to manually refresh the analytics status.\n * @property {(studentId: string) => AnalyticsStatus | undefined} getStudentStatus - A function to get the analytics status for a specific student.\n * @property {(studentId: string) => void} initializeStudent - A function to initialize analytics for a specific student.\n * @property {(studentId?: string) => Promise<void>} triggerAnalytics - Triggers a fresh analytics update for a specific student or all students.\n */\ninterface UseAnalyticsStatusReturn {\n  analyticsStatus: AnalyticsStatus[];\n  isLoading: boolean;\n  refresh: () => Promise<void>;\n  getStudentStatus: (studentId: string) => AnalyticsStatus | undefined;\n  initializeStudent: (studentId: string) => void;\n  triggerAnalytics: (studentId?: string) => Promise<void>;\n}\n\n/**\n * A custom hook that provides a convenient way to access and manage the\n * analytics status of students.\n *\n * This hook encapsulates the logic for loading, refreshing, and interacting\n * with the `analyticsManager`. It can be used to get the analytics status for\n * a single student or for all students, and it provides functions for\n * initializing students and triggering analytics updates.\n *\n * @param studentId - An optional student ID to filter the analytics status for.\n * @returns An object containing the analytics status, loading state, and\n * functions for interacting with the analytics manager.\n */\nexport const useAnalyticsStatus = (studentId?: string): UseAnalyticsStatusReturn => {\n  const [analyticsStatus, setAnalyticsStatus] = useState<AnalyticsStatus[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n\n  const loadStatus = useCallback(async () => {\n    try {\n      const status = analyticsManager.getAnalyticsStatus();\n      if (studentId) {\n        setAnalyticsStatus(status.filter(s => s.studentId === studentId));\n      } else {\n        setAnalyticsStatus(status);\n      }\n    } catch (error) {\n      logger.error('Error loading analytics status:', error);\n      setAnalyticsStatus([]);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [studentId]);\n\n  const refresh = useCallback(async () => {\n    setIsLoading(true);\n    await loadStatus();\n  }, [loadStatus]);\n\n  const getStudentStatus = useCallback((targetStudentId: string) => {\n    return analyticsStatus.find(status => status.studentId === targetStudentId);\n  }, [analyticsStatus]);\n\n  const initializeStudent = useCallback((targetStudentId: string) => {\n    analyticsManager.initializeStudentAnalytics(targetStudentId);\n    loadStatus();\n  }, [loadStatus]);\n\n  const triggerAnalytics = useCallback(async (targetStudentId?: string) => {\n    try {\n      if (targetStudentId) {\n        await analyticsManager.triggerAnalyticsForStudent(targetStudentId);\n      } else {\n        await analyticsManager.triggerAnalyticsForAllStudents();\n      }\n      await loadStatus();\n    } catch (error) {\n      logger.error('Error triggering analytics:', error);\n    }\n  }, [loadStatus]);\n\n  useEffect(() => {\n    loadStatus();\n    \n    // Auto-refresh every 2 minutes\n    const interval = setInterval(loadStatus, 120000);\n    return () => clearInterval(interval);\n  }, [loadStatus]);\n\n  return {\n    analyticsStatus,\n    isLoading,\n    refresh,\n    getStudentStatus,\n    initializeStudent,\n    triggerAnalytics,\n  };\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useAnalyticsWorker.circuit.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Host' is defined but never used. Allowed unused vars must match /^_/u.","line":24,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { afterEach, beforeEach, describe, expect, it, vi } from 'vitest';\nimport React from 'react';\nimport { render, waitFor } from '@testing-library/react';\n\n// Mock i18n translation hook to avoid loading actual resources\nvi.mock('@/hooks/useTranslation', () => ({\n  useTranslation: (ns?: string) => ({\n    t: (key: string) => `t:${ns ?? 'common'}:${key}`,\n  }),\n}));\n\n// Spy on toast to verify user notifications are deduped\nimport * as toastModule from '@/hooks/use-toast';\n\n// Provide a minimal host component to trigger the hook\nimport { useAnalyticsWorker } from '@/hooks/useAnalyticsWorker';\n\nconst makeData = () => ({\n  entries: [],\n  emotions: [],\n  sensoryInputs: [],\n});\n\nfunction Host({ trigger }: { trigger?: boolean }) {\n  const { runAnalysis } = useAnalyticsWorker();\n  React.useEffect(() => {\n    if (trigger) {\n      void runAnalysis(makeData());\n    }\n  }, [trigger, runAnalysis]);\n  return null;\n}\n\n// Isolated module mock helpers\nconst resetAllMocks = () => {\n  vi.resetModules();\n  vi.clearAllMocks();\n};\n\ndescribe('useAnalyticsWorker: circuit and notifications', () => {\n  beforeEach(() => {\n    resetAllMocks();\n  });\n  afterEach(() => {\n    vi.useRealTimers();\n  });\n\n  it('shows one localized toast when worker is disabled via env flag (deduped)', async () => {\n    // Mock env flags\n    vi.doMock('@/lib/env', () => ({\n      POC_MODE: false,\n      DISABLE_ANALYTICS_WORKER: true,\n    }));\n\n    const toastSpy = vi.spyOn(toastModule, 'toast');\n\n    // Import after mocks\n    const { useAnalyticsWorker: Hook } = await import('@/hooks/useAnalyticsWorker');\n    function HostInner({ trigger }: { trigger?: boolean }) {\n      const { runAnalysis } = Hook();\n      React.useEffect(() => {\n        if (trigger) void runAnalysis(makeData());\n      }, [trigger, runAnalysis]);\n      return null;\n    }\n\n    render(React.createElement(HostInner, { trigger: true }));\n\n    await waitFor(() => {\n      expect(toastSpy).toHaveBeenCalledTimes(1);\n      const call = toastSpy.mock.calls[0]?.[0] as { title?: string; description?: string };\n      expect(call.title).toContain('t:analytics:worker.disabledTitle');\n      expect(call.description).toContain('t:analytics:worker.disabledDescription');\n    });\n\n    // Re-render to ensure dedupe (no second toast within window)\n    render(React.createElement(HostInner, { trigger: true }));\n    await new Promise(r => setTimeout(r, 10));\n    expect(toastSpy).toHaveBeenCalledTimes(1);\n  });\n\n  it('opens circuit and shows one toast on worker runtime error (deduped)', async () => {\n    // Enable worker; not disabled\n    vi.doMock('@/lib/env', () => ({\n      POC_MODE: false,\n      DISABLE_ANALYTICS_WORKER: false,\n    }));\n\n    // Mock the worker constructor module used by the hook\n    class FakeWorker {\n      public onmessage: ((e: MessageEvent) => void) | null = null;\n      public onerror: ((e: ErrorEvent) => void) | null = null;\n      // Simulate immediate runtime error after creation\n      constructor() {\n        setTimeout(() => {\n          this.onerror?.(new ErrorEvent('error', { message: 'boom' }));\n        }, 0);\n      }\n      terminate() {/* noop */}\n      postMessage() {/* noop */}\n    }\n    vi.doMock('@/workers/analytics.worker?worker', () => ({\n      default: FakeWorker,\n    }), { virtual: true });\n\n    const toastSpy = vi.spyOn(toastModule, 'toast');\n\n    // Import after mocks\n    const { useAnalyticsWorker: Hook } = await import('@/hooks/useAnalyticsWorker');\n    function HostInner({ trigger }: { trigger?: boolean }) {\n      const { runAnalysis } = Hook();\n      React.useEffect(() => {\n        if (trigger) void runAnalysis(makeData());\n      }, [trigger, runAnalysis]);\n      return null;\n    }\n\n    render(React.createElement(HostInner, { trigger: true }));\n\n    await waitFor(() => {\n      expect(toastSpy).toHaveBeenCalledTimes(1);\n      const call = toastSpy.mock.calls[0]?.[0] as { title?: string; description?: string };\n      // Fallback toast uses analytics worker fallback keys\n      // We mock useTranslation to return t:<ns>:<key>\n      expect(call.title).toContain('t:analytics:worker.fallbackTitle');\n    });\n\n    // Trigger again; dedupe should keep it at 1 within window\n    render(React.createElement(HostInner, { trigger: true }));\n    await new Promise(r => setTimeout(r, 10));\n    expect(toastSpy).toHaveBeenCalledTimes(1);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useAnalyticsWorker.fallback.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'waitFor' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":27,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":34},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[531,534],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[531,534],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { renderHook, act, waitFor } from '@testing-library/react';\nimport { AnalyticsData } from '@/types/analytics';\n\n// Mock dependencies first\nvi.mock('@/lib/logger');\nvi.mock('@/lib/diagnostics');\nvi.mock('@/lib/analyticsConfig', async () => {\n  // Re-export actual module to preserve all named exports (like DEFAULT_ANALYTICS_CONFIG),\n  // then override only the analyticsConfig manager with minimal behavior for this test.\n  const actual = await vi.importActual<any>('@/lib/analyticsConfig');\n  return {\n    ...actual,\n    analyticsConfig: {\n      getConfig: vi.fn(() => ({\n        cache: { invalidateOnConfigChange: false },\n      })),\n      subscribe: vi.fn(() => vi.fn()),\n    },\n  };\n});\n\n// Mock the analytics worker fallback\nvi.mock('@/lib/analyticsWorkerFallback', () => ({\n  analyticsWorkerFallback: {\n    processAnalytics: vi.fn().mockResolvedValue({\n      patterns: [],\n      correlations: [],\n      environmentalCorrelations: [],\n      predictiveInsights: [],\n      anomalies: [],\n      insights: ['Fallback result']\n    })\n  }\n}));\n\n// Mock the worker to fail initialization\nvi.mock('@/workers/analytics.worker?worker', () => ({\n  default: class {\n    constructor() {\n      throw new Error('Worker not supported');\n    }\n  }\n}));\n\n// Import the hook after all mocks are set up\nimport { useAnalyticsWorker } from './useAnalyticsWorker';\n\ndescribe('useAnalyticsWorker - Fallback Mode', () => {\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  it('should use fallback when worker initialization fails', async () => {\n    const { analyticsWorkerFallback } = await import('@/lib/analyticsWorkerFallback');\n    const { result } = renderHook(() => useAnalyticsWorker());\n    \n    const testData: AnalyticsData = { \n      entries: [], \n      emotions: [], \n      sensoryInputs: [] \n    };\n\n    // Run analysis which should use the fallback\n    await act(async () => {\n      await result.current.runAnalysis(testData);\n    });\n\n    // Verify fallback was called\n    expect(analyticsWorkerFallback.processAnalytics).toHaveBeenCalledWith(testData);\n    \n    // Should get results from fallback\n    expect(result.current.results).toEqual({\n      patterns: [],\n      correlations: [],\n      environmentalCorrelations: [],\n      predictiveInsights: [],\n      anomalies: [],\n      insights: ['Fallback result']\n    });\n    expect(result.current.isAnalyzing).toBe(false);\n    expect(result.current.error).toBeNull();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useAnalyticsWorker.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[478,481],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[478,481],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[584,587],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[584,587],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[969,972],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[969,972],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1724,1727],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1724,1727],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2913,2916],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2913,2916],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3805,3808],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3805,3808],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":108,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3882,3885],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3882,3885],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4550,4553],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4550,4553],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-this-alias","severity":2,"message":"Unexpected aliasing of 'this' to local variable.","line":21,"column":7,"nodeType":"Identifier","messageId":"thisAssignment","endLine":21,"endColumn":17,"suppressions":[{"kind":"directive","justification":"store instance so tests can inspect mocked worker"}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { renderHook, act, waitFor } from '@testing-library/react';\n\n// Force non-POC mode so the worker is initialized in tests\nvi.mock('@/lib/env', () => ({ POC_MODE: false, DISABLE_ANALYTICS_WORKER: false }));\n\nimport { useAnalyticsWorker } from './useAnalyticsWorker';\n\n// Mock the worker used by the hook (note the ?worker suffix)\nconst mockPostMessage = vi.fn();\nconst mockTerminate = vi.fn();\nlet lastWorker: any = null;\n\nvi.mock('@/workers/analytics.worker?worker', () => {\n  class MockWorker {\n    onmessage: (e: any) => void = () => {};\n    postMessage = mockPostMessage;\n    terminate = mockTerminate;\n    constructor() {\n      // eslint-disable-next-line @typescript-eslint/no-this-alias -- store instance so tests can inspect mocked worker\n      lastWorker = this;\n    }\n  }\n  // Also support CJS default\n  return { __esModule: true, default: MockWorker, __getLastWorker: () => lastWorker } as any;\n});\n\ndescribe('useAnalyticsWorker', () => {\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  it('should initialize with default values', () => {\n    const { result } = renderHook(() => useAnalyticsWorker());\n\n    expect(result.current.results).toBeNull();\n    expect(result.current.isAnalyzing).toBe(false);\n    expect(result.current.error).toBeNull();\n  });\n\n  it('should call postMessage with the correct data when runAnalysis is called', async () => {\n    const { result } = renderHook(() => useAnalyticsWorker());\n    const testData = { entries: [], emotions: [], sensoryInputs: [] };\n\n    // Allow the init effect to run\n    await new Promise(r => setTimeout(r, 0));\n\n    // Wait until the mocked worker has been constructed\n    const mod: any = await import('@/workers/analytics.worker?worker');\n    let tries = 0;\n    while (!mod.__getLastWorker() && tries < 20) {\n      await new Promise(r => setTimeout(r, 5));\n      tries++;\n    }\n    // Mark worker as ready so queued tasks flush immediately\n    const worker = mod.__getLastWorker();\n    worker.onmessage({ data: { type: 'progress', progress: { stage: 'ready', percent: 1 } } });\n\n    await act(async () => {\n      await result.current.runAnalysis(testData);\n    });\n\n    await waitFor(() => {\n      expect(mockPostMessage).toHaveBeenCalled();\n    });\n    // We now send a typed Insights/Compute task envelope to the worker\n    expect(mockPostMessage).toHaveBeenCalledWith(expect.objectContaining({\n      type: 'Insights/Compute',\n      payload: expect.any(Object),\n      cacheKey: expect.any(String),\n      ttlSeconds: expect.any(Number),\n    }));\n    expect(result.current.error).toBeNull();\n  });\n\n  it('should update state on successful analysis', async () => {\n    const { result } = renderHook(() => useAnalyticsWorker());\n    const testResults = { patterns: [], correlations: [], environmentalCorrelations: [], insights: [] };\n\n    // Wait for worker\n    const mod: any = await import('@/workers/analytics.worker?worker');\n    let worker = mod.__getLastWorker();\n    let tries = 0;\n    while (!worker && tries < 20) {\n      await new Promise(r => setTimeout(r, 5));\n      worker = mod.__getLastWorker();\n      tries++;\n    }\n\n    // Simulate ready then complete message\n    await act(async () => {\n      worker.onmessage({ data: { type: 'progress', progress: { stage: 'ready', percent: 1 } } });\n      worker.onmessage({ data: { type: 'complete', payload: testResults } });\n    });\n\n    await waitFor(() => {\n      expect(result.current.results).toEqual(testResults);\n      expect(result.current.isAnalyzing).toBe(false);\n      expect(result.current.error).toBeNull();\n    });\n  });\n\n  it('should update state on analysis error', async () => {\n    const { result } = renderHook(() => useAnalyticsWorker());\n    const testError = { message: 'Test Error' } as any;\n\n    // Simulate an error message from the mocked worker\n    const mod: any = await import('@/workers/analytics.worker?worker');\n    const worker = mod.__getLastWorker();\n    await act(async () => {\n      worker.onmessage({ data: { type: 'progress', progress: { stage: 'ready', percent: 1 } } });\n      worker.onmessage({ data: { type: 'error', error: testError } });\n    });\n\n    await waitFor(() => {\n      expect(result.current.results).toBeNull();\n      expect(result.current.isAnalyzing).toBe(false);\n      expect(result.current.error).toEqual(testError);\n    });\n  });\n\n  it('should terminate the worker on unmount', async () => {\n    const { unmount } = renderHook(() => useAnalyticsWorker());\n\n    // Wait for worker\n    const mod: any = await import('@/workers/analytics.worker?worker');\n    let tries = 0;\n    while (!mod.__getLastWorker() && tries < 10) {\n      await new Promise(r => setTimeout(r, 0));\n      tries++;\n    }\n\n    await act(async () => {\n      unmount();\n    });\n\n    await waitFor(() => {\n      expect(mockTerminate).toHaveBeenCalled();\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useAnalyticsWorker.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used. Allowed unused caught errors must match /^_/u.","line":69,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":69,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isWorkerReady' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":229,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":229,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":247,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":247,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9678,9681],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9678,9681],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":248,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":248,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9759,9762],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9759,9762],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":248,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":248,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9780,9783],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9780,9783],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useTranslation\" cannot be called inside a callback. React Hooks must be called in a React function component or a custom React Hook function.","line":272,"column":31,"nodeType":"Identifier","endLine":272,"endColumn":45},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":337,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":337,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12873,12876],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12873,12876],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":337,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":337,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12908,12911],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12908,12911],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":358,"column":9,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":358,"endColumn":71},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":359,"column":9,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":359,"endColumn":81},{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/exhaustive-deps').","line":391,"column":3,"severity":1,"nodeType":null,"fix":{"range":[14965,15020],"text":" "}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":409,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":409,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15724,15727],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15724,15727],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used. Allowed unused caught errors must match /^_/u.","line":428,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":428,"endColumn":21},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":530,"column":27,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":566,"endColumn":18},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":661,"column":9,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":678,"endColumn":24},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":687,"column":7,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":687,"endColumn":35},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'extractTagsFn'. Either include it or remove the dependency array.","line":689,"column":6,"nodeType":"ArrayExpression","endLine":689,"endColumn":47,"suggestions":[{"desc":"Update the dependencies array to be: [precomputeOnIdle, createCacheKey, cache, extractTagsFn]","fix":{"range":[26796,26837],"text":"[precomputeOnIdle, createCacheKey, cache, extractTagsFn]"}}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2835,2838],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2835,2838],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":17,"fixableErrorCount":0,"fixableWarningCount":1,"source":"// Cache key computation is centralized via buildInsightsCacheKey\n\n/**\n * @file src/hooks/useAnalyticsWorker.ts\n * \n * This hook encapsulates the logic for interacting with the analytics web worker.\n * It simplifies the process of creating, communicating with, and terminating the worker,\n * providing a clean, React-friendly interface for components to offload heavy computations.\n * Now enhanced with performance caching to avoid redundant calculations.\n */\nimport { useState, useEffect, useRef, useCallback } from 'react';\nimport { AnalyticsData, AnalyticsResults, AnalyticsWorkerMessage } from '@/types/analytics';\nimport { usePerformanceCache } from './usePerformanceCache';\nimport { analyticsConfig } from '@/lib/analyticsConfig';\nimport { getValidatedConfig, validateAnalyticsRuntimeConfig } from '@/lib/analyticsConfigValidation';\nimport { buildInsightsCacheKey, buildInsightsTask } from '@/lib/analyticsManager';\nimport { logger } from '@/lib/logger';\nimport { toast } from '@/hooks/use-toast';\nimport { diagnostics } from '@/lib/diagnostics';\nimport { analyticsWorkerFallback } from '@/lib/analyticsWorkerFallback';\nimport { POC_MODE, DISABLE_ANALYTICS_WORKER } from '@/lib/env';\nimport type { Student } from '@/types/student';\nimport type { AnalyticsResultsAI } from '@/lib/analysis';\nimport { analyticsManager } from '@/lib/analyticsManager';\n\n// -----------------------------------------------------------------------------\n// Module-level singleton to prevent duplicate workers across multiple consumers\n// -----------------------------------------------------------------------------\ninterface WorkerSingleton {\n  worker: Worker | null;\n  refs: number;\n  ready: boolean;\n  circuitUntil: number; // epoch ms; when > now, do not attempt worker usage\n}\n\nconst singleton: WorkerSingleton = {\n  worker: null,\n  refs: 0,\n  ready: false,\n  circuitUntil: 0,\n};\n\nfunction nowMs(): number { return Date.now(); }\nfunction isCircuitOpen(): boolean { return nowMs() < singleton.circuitUntil; }\nfunction openCircuit(ms: number): void { singleton.circuitUntil = nowMs() + Math.max(0, ms); }\n\n// Simple once-per-key dedupe for user-facing notifications\nconst onceWindow = new Map<string, number>();\nfunction doOnce(key: string, ttlMs: number, fn: () => void) {\n  const now = nowMs();\n  const last = onceWindow.get(key) ?? 0;\n  if (now - last > ttlMs) {\n    onceWindow.set(key, now);\n    try { fn(); } catch { /* noop */ }\n  }\n}\n\n// Queue tasks until worker signals ready\nconst pendingTasks: MessageEvent['data'][] = [];\n// Per-hook cleanup stack (listeners, timers)\nconst cleanupFns: Array<() => void> = [];\n\nfunction flushQueuedTasks(): void {\n  if (!singleton.worker || !singleton.ready) return;\n  while (pendingTasks.length) {\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (singleton.worker as any).postMessage(pendingTasks.shift());\n    } catch (e) {\n      // If posting fails, stop flushing to avoid spin\n      break;\n    }\n  }\n}\n\nasync function ensureWorkerInitialized(): Promise<Worker | null> {\n  if (POC_MODE || DISABLE_ANALYTICS_WORKER) return null;\n  if (singleton.worker) return singleton.worker;\n  if (isCircuitOpen()) return null;\n\n  try {\n    const mod = await import('@/workers/analytics.worker?worker');\n    const WorkerCtor = (mod as unknown as { default: { new(): Worker } }).default;\n    const worker = new WorkerCtor();\n\n    // Attach handlers once at creation time\n    worker.onmessage = (event: MessageEvent<AnalyticsWorkerMessage>) => {\n      // Any message implies liveness; mark ready when first progress received or on any first message\n      if (!singleton.ready) {\n        const msg = event.data as AnalyticsWorkerMessage | undefined;\n        if (!msg || msg.type === 'progress' || msg.type === 'partial' || msg.type === 'complete' || msg.type === 'error') {\n          singleton.ready = true;\n          flushQueuedTasks();\n        }\n      }\n    };\n\n    worker.onerror = (error: ErrorEvent) => {\n      logger.error('[useAnalyticsWorker] Worker runtime error, switching to fallback', error);\n      try {\n        worker.terminate();\n      } catch { /* noop */ }\n      singleton.worker = null;\n      singleton.ready = false;\n      // Open circuit for 60s to avoid thrash\n      openCircuit(60_000);\n      // One-time user-facing toast per cooldown window (localized elsewhere if needed)\n      doOnce('analytics_worker_failure', 60_000, () => {\n        // i18n keys under analytics:worker\n        try {\n          // Dynamically import to avoid pulling react-i18next into this hook directly\n          import('@/hooks/useTranslation').then(({ useTranslation }) => {\n            const { t } = useTranslation('analytics');\n            toast({\n              title: t('worker.fallbackTitle'),\n              description: t('worker.fallbackDescription'),\n            });\n          }).catch(() => {\n            // Fallback to English strings if i18n not ready here\n            toast({\n              title: 'Analytics running in fallback mode',\n              description: 'Background worker failed. Using safe fallback to keep the UI responsive.',\n            });\n          });\n        } catch {\n          toast({\n            title: 'Analytics running in fallback mode',\n            description: 'Background worker failed. Using safe fallback to keep the UI responsive.',\n          });\n        }\n      });\n    };\n\n    singleton.worker = worker;\n    singleton.ready = false; // will flip true on first onmessage\n    logger.info('[useAnalyticsWorker] Analytics worker initialized successfully');\n    return worker;\n  } catch (error) {\n    logger.error('[useAnalyticsWorker] Failed to initialize worker', error as Error);\n    singleton.worker = null;\n    // Shorter circuit on init failure\n    openCircuit(15_000);\n    return null;\n  }\n}\n\nfunction retainWorker(): void {\n  singleton.refs += 1;\n}\n\nfunction releaseWorker(): void {\n  singleton.refs = Math.max(0, singleton.refs - 1);\n  if (singleton.refs === 0 && singleton.worker) {\n    try {\n      logger.debug('[useAnalyticsWorker] Terminating analytics worker');\n      singleton.worker.terminate();\n    } catch { /* noop */ }\n    singleton.worker = null;\n    singleton.ready = false;\n  }\n}\n\n// Define CacheStats type if not imported from usePerformanceCache\ninterface CacheStats {\n  hits: number;\n  misses: number;\n  sets: number;\n  evictions: number;\n  invalidations: number;\n  hitRate: number;\n  size: number;\n  memoryUsage?: number;\n}\n\ninterface CachedAnalyticsWorkerOptions {\n  cacheTTL?: number;\n  enableCacheStats?: boolean;\n  precomputeOnIdle?: boolean;\n  // Optional injection for tests or advanced cache control\n  extractTagsFromData?: (data: AnalyticsData | AnalyticsResults) => string[];\n}\n\ninterface UseAnalyticsWorkerReturn {\n  results: AnalyticsResultsAI | null;\n  isAnalyzing: boolean;\n  error: string | null;\n  runAnalysis: (data: AnalyticsData, options?: { useAI?: boolean; student?: Student }) => Promise<void>;\n  precomputeCommonAnalytics: (dataProvider: () => AnalyticsData[]) => void;\n  invalidateCacheForStudent: (studentId: string) => void;\n  clearCache: () => void;\n  cacheStats: CacheStats | null;\n  cacheSize: number;\n}\n\n/**\n * @hook useAnalyticsWorker\n * \n * A custom hook to manage the analytics web worker with integrated caching.\n * \n * @param options Configuration options for caching and precomputation\n * @returns {object} An object containing:\n *  - `results`: The latest analysis results received from the worker or cache.\n *  - `isAnalyzing`: A boolean flag indicating if an analysis is currently in progress.\n *  - `error`: Any error message returned from the worker.\n *  - `runAnalysis`: A function to trigger a new analysis by posting data to the worker.\n *  - `cacheStats`: Performance statistics about cache usage (if enabled).\n *  - `clearCache`: Function to clear the analytics cache.\n *  - `invalidateCache`: Function to invalidate cache entries by tag or pattern.\n */\nexport const useAnalyticsWorker = (options: CachedAnalyticsWorkerOptions = {}): UseAnalyticsWorkerReturn => {\n  // Resolve defaults from runtime analyticsConfig with safe fallbacks\n  const liveCfgRaw = (() => { try { return analyticsConfig.getConfig(); } catch { return null; } })();\n  const { config: liveCfg } = validateAnalyticsRuntimeConfig(liveCfgRaw ?? undefined);\n  const resolvedTtl = typeof options.cacheTTL === 'number'\n    ? options.cacheTTL\n    : (liveCfg?.cache?.ttl ?? 300_000); // default 300s in ms\n  const {\n    cacheTTL = resolvedTtl,\n    enableCacheStats = false,\n    precomputeOnIdle = false\n  } = options;\n\n  const workerRef = useRef<Worker | null>(null);\n  const watchdogRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const [results, setResults] = useState<AnalyticsResultsAI | null>(null);\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const idleCallbackRef = useRef<number | null>(null);\n  const [isWorkerReady, setIsWorkerReady] = useState<boolean>(false);\n\n  // Initialize performance cache with appropriate settings\n  const cache = usePerformanceCache<AnalyticsResults>({\n    maxSize: (liveCfg?.cache?.maxSize ?? 50), // Use runtime config; fallback to 50\n    ttl: cacheTTL,\n    enableStats: enableCacheStats,\n    versioning: true // Enable versioning to invalidate on data structure changes\n  });\n\n  /**\n   * Extracts tags from analytics data for cache invalidation\n   * Allow override via options for testing\n   */\n  const defaultExtractTagsFromData = useCallback((data: AnalyticsData | AnalyticsResults): string[] => {\n    const tags: string[] = ['analytics'];\n    \n    // Add student-specific tags if available\n    if ('entries' in data && (data as any).entries?.length > 0) {\n      const studentIds = Array.from(new Set((data as any).entries.map((e: any) => e.studentId)));\n      tags.push(...studentIds.map(id => `student-${id}`));\n    }\n\n    // Add date-based tags for time-sensitive invalidation\n    const now = new Date();\n    tags.push(`analytics-${now.getFullYear()}-${now.getMonth() + 1}`);\n    \n    return tags;\n  }, []);\n  const extractTagsFn = options.extractTagsFromData ?? defaultExtractTagsFromData;\n\n  useEffect(() => {\n    let isMounted = true; // Race condition guard\n\n    const init = async () => {\n      if (POC_MODE || DISABLE_ANALYTICS_WORKER) {\n        workerRef.current = null;\n        setIsWorkerReady(false);\n        // Inform user once per minute if worker is disabled via flag\n        if (DISABLE_ANALYTICS_WORKER) {\n          doOnce('analytics_worker_disabled', 60_000, () => {\n            try {\n              import('@/hooks/useTranslation').then(({ useTranslation }) => {\n                const { t } = useTranslation('analytics');\n                toast({\n                  title: t('worker.disabledTitle'),\n                  description: t('worker.disabledDescription'),\n                });\n              }).catch(() => {\n                toast({\n                  title: 'Analytics worker disabled',\n                  description: 'Running analytics without a background worker (debug mode).',\n                });\n              });\n            } catch {\n              toast({\n                title: 'Analytics worker disabled',\n                description: 'Running analytics without a background worker (debug mode).',\n              });\n            }\n          });\n        }\n        return;\n      }\n      if (isCircuitOpen()) {\n        workerRef.current = null;\n        setIsWorkerReady(false);\n        return;\n      }\n      retainWorker();\n      const worker = await ensureWorkerInitialized();\n      if (!isMounted) {\n        releaseWorker();\n        return;\n      }\n      workerRef.current = worker;\n      setIsWorkerReady(!!(singleton.ready && worker));\n\n      // Attach per-hook message listener to consume results\n      if (worker) {\n        const onMessage = (event: MessageEvent<AnalyticsWorkerMessage>) => {\n          const data = event.data as AnalyticsWorkerMessage | undefined;\n          if (!data) return;\n          // Any inbound message means the worker is alive\n          if (!singleton.ready) {\n            singleton.ready = true;\n            flushQueuedTasks();\n          }\n\n          // Reset watchdog on any message\n          if (watchdogRef.current) {\n            clearTimeout(watchdogRef.current);\n            watchdogRef.current = null;\n          }\n\n          // Handle message types\n          try {\n            switch (data.type) {\n              case 'partial':\n                // For now, do not merge partials into results to avoid flicker; could add later\n                break;\n              case 'complete':\n                setResults(data.payload as unknown as AnalyticsResultsAI);\n                setIsAnalyzing(false);\n                setError(null);\n                break;\n              case 'error':\n                setIsAnalyzing(false);\n                setError(typeof (data as any).error === 'string' ? (data as any).error : 'Analytics worker error');\n                // Provide minimal safe results to prevent UI crashes per rules\n                setResults((prev) => prev ?? ({\n                  patterns: [], correlations: [], environmentalCorrelations: [], predictiveInsights: [], anomalies: [], insights: ['Analytics temporarily unavailable.']\n                } as AnalyticsResultsAI));\n                break;\n              case 'progress':\n                // No-op: used for readiness/heartbeat\n                break;\n              default:\n                break;\n            }\n          } catch (e) {\n            logger.error('[useAnalyticsWorker] Failed handling worker message', e as Error);\n          }\n        };\n\n        const onMessageError = (evt: MessageEvent) => {\n          logger.error('[useAnalyticsWorker] messageerror from analytics worker', evt);\n        };\n\n        worker.addEventListener('message', onMessage as EventListener);\n        worker.addEventListener('messageerror', onMessageError as EventListener);\n\n        // Cleanup these listeners if this hook unmounts while worker persists\n        cleanupFns.push(() => {\n          try {\n            worker.removeEventListener('message', onMessage as EventListener);\n            worker.removeEventListener('messageerror', onMessageError as EventListener);\n          } catch { /* noop */ }\n        });\n      }\n    };\n\n    init();\n\n    return () => {\n      isMounted = false;\n      // Local cleanup only; singleton handles actual termination when refs reach 0\n      if (idleCallbackRef.current) {\n        cancelIdleCallback(idleCallbackRef.current);\n        idleCallbackRef.current = null;\n      }\n      if (watchdogRef.current) {\n        clearTimeout(watchdogRef.current);\n        watchdogRef.current = null;\n      }\n      // Run any per-hook cleanup fns (like removing event listeners)\n      while (cleanupFns.length) {\n        try { (cleanupFns.pop() as () => void)(); } catch { /* noop */ }\n      }\n      releaseWorker();\n    };\n  // Stable on mount; do not re-init on cache identity churn\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  /**\n   * Creates a cache key based on the analytics data using centralized helper\n   */\n  const createCacheKey = useCallback((data: AnalyticsData): string => {\n    // Map AnalyticsData to ComputeInsightsInputs structure expected by cache key builder\n    const inputs = {\n      entries: data.entries,\n      emotions: data.emotions,\n      sensoryInputs: data.sensoryInputs,\n      // goals are not available at this layer; omit for key purposes\n    } as unknown as { entries: unknown[]; emotions: unknown[]; sensoryInputs: unknown[] };\n\n    // Use live runtime config to ensure keys align across app and worker\n    const cfg = getValidatedConfig();\n\n    return buildInsightsCacheKey(inputs as any, { config: cfg });\n  }, []);\n\n  /**\n   * Sends data to the worker to start a new analysis, checking cache first.\n   * Supports AI analysis via analyticsManager when requested.\n   */\n  const runAnalysis = useCallback(async (data: AnalyticsData, options?: { useAI?: boolean; student?: Student }) => {\n    const aiRequested = options?.useAI === true;\n    const cacheKey = `${createCacheKey(data)}|ai=${aiRequested ? '1' : '0'}`;\n    \n    // Check cache first\n    const cachedResult = cache.get(cacheKey);\n    if (cachedResult) {\n      // Reduce logging verbosity - only log on first hit per key\n      if (!cache.get(`_logged_${cacheKey}`)) {\n        try {\n          logger.debug('[useAnalyticsWorker] cache hit', { cacheKey });\n          cache.set(`_logged_${cacheKey}`, true, ['logging'], 60000); // Log once per minute max\n        } catch (err) {\n          /* noop */\n        }\n      }\n      setResults(cachedResult as AnalyticsResultsAI);\n      setError(null);\n      return;\n    }\n\n    // AI path: bypass worker and use analyticsManager with runtime toggle\n    if (aiRequested) {\n      setIsAnalyzing(true);\n      setError(null);\n      try {\n        let studentObj: Student | undefined = options?.student;\n        if (!studentObj) {\n          const first = data.entries?.[0];\n          if (first?.studentId) {\n            studentObj = { id: first.studentId, name: 'Student', createdAt: new Date() } as Student;\n          }\n        }\n        if (!studentObj) throw new Error('Missing student context for AI analysis');\n\n        const res = await analyticsManager.getStudentAnalytics(studentObj, { useAI: true });\n        setResults(res as AnalyticsResultsAI);\n        const tags = Array.from(new Set([...(extractTagsFn(data) || []), `student-${studentObj.id}`, 'ai'])) as string[];\n        cache.set(cacheKey, res as AnalyticsResultsAI, tags);\n      } catch (err) {\n        logger.error('[useAnalyticsWorker] AI analysis path failed', err);\n        setError('AI analysis failed. Falling back to standard analytics.');\n        try {\n          const res = await analyticsWorkerFallback.processAnalytics(data, { useAI: false, student: options?.student });\n          setResults(res as AnalyticsResultsAI);\n          const tags = extractTagsFn(data);\n          cache.set(cacheKey, res as AnalyticsResultsAI, tags);\n        } catch (fallbackError) {\n          logger.error('[useAnalyticsWorker] Fallback after AI failure also failed', fallbackError);\n          setResults({\n            patterns: [],\n            correlations: [],\n            environmentalCorrelations: [],\n            predictiveInsights: [],\n            anomalies: [],\n            insights: ['Analytics temporarily unavailable.']\n          } as AnalyticsResultsAI);\n        }\n      } finally {\n        setIsAnalyzing(false);\n      }\n      return;\n    }\n\n    // If no worker available, use fallback\n    if (!workerRef.current || DISABLE_ANALYTICS_WORKER) {\n      // Only log fallback mode once per session\n      if (!cache.get('_logged_fallback_mode')) {\n        logger.debug('[useAnalyticsWorker] No worker available, using fallback');\n        cache.set('_logged_fallback_mode', true, ['logging'], 3600000); // Log once per hour\n      }\n      setIsAnalyzing(true);\n      setError(null);\n      \n      try {\n        const results = await analyticsWorkerFallback.processAnalytics(data, { useAI: options?.useAI, student: options?.student });\n        setResults(results as AnalyticsResultsAI);\n        // Cache the results\n        const tags = extractTagsFn(data);\n        cache.set(cacheKey, results as AnalyticsResultsAI, tags);\n      } catch (error) {\n        logger.error('[useAnalyticsWorker] Fallback failed', error);\n        setError('Analytics processing failed. Please try again.');\n        // Set minimal results to prevent UI crash\n        setResults({\n          patterns: [],\n          correlations: [],\n          environmentalCorrelations: [],\n          predictiveInsights: [],\n          anomalies: [],\n          insights: ['Analytics temporarily unavailable.']\n        } as AnalyticsResultsAI);\n      } finally {\n        setIsAnalyzing(false);\n      }\n      return;\n    }\n\n    // If not in cache, proceed with worker analysis\n    setIsAnalyzing(true);\n    setError(null);\n    setResults(null);\n\n    // Start watchdog timeout to prevent indefinite spinner\n    if (watchdogRef.current) {\n      clearTimeout(watchdogRef.current);\n      watchdogRef.current = null;\n    }\n    // Determine timeout from config if available; fallback to 15s minimum 3s\n    const cfg = getValidatedConfig();\n    // Clamp watchdog timeout to a sane upper bound to avoid indefinite spinners.\n    // Use config ttl as a hint but never exceed 20s; keep a 5s lower bound.\n    const hint = cfg?.cache?.ttl ?? 15000;\n    const timeoutMs = Math.min(20000, Math.max(5000, hint));\n    watchdogRef.current = setTimeout(async () => {\n      try {\n        logger.error('[useAnalyticsWorker] watchdog timeout: worker did not respond, attempting fallback');\n      } catch {\n        /* noop */\n      }\n      diagnostics.logWorkerTimeout('analytics', timeoutMs);\n      \n      // Terminate unresponsive worker\n      if (workerRef.current) {\n        workerRef.current.terminate();\n        workerRef.current = null;\n      }\n      \n      // Attempt fallback processing\n      try {\n        const fallbackResults = await analyticsWorkerFallback.processAnalytics(data, { useAI: options?.useAI, student: options?.student });\n        setResults(fallbackResults as AnalyticsResultsAI);\n        const tags = extractTagsFn(data);\n        cache.set(cacheKey, fallbackResults as AnalyticsResultsAI, tags);\n        setError('Worker timeout - results computed using fallback mode.');\n      } catch (fallbackError) {\n        logger.error('[useAnalyticsWorker] Fallback failed after watchdog timeout', fallbackError);\n        setError('Analytics processing failed. Please try again.');\n        // Set minimal results to prevent UI crash\n        setResults({\n          patterns: [],\n          correlations: [],\n          environmentalCorrelations: [],\n          predictiveInsights: [],\n          anomalies: [],\n          insights: ['Analytics temporarily unavailable.']\n        } as AnalyticsResultsAI);\n      } finally {\n        setIsAnalyzing(false);\n      }\n    }, timeoutMs);\n    \n    // Get current configuration (validated)\n    const config = getValidatedConfig();\n\n    // Rate limit worker posting logs\n    const logKey = `_logged_worker_post_${new Date().getMinutes()}`;\n    if (!cache.get(logKey)) {\n      try {\n        logger.debug('[useAnalyticsWorker] posting to worker (runAnalysis)', { hasConfig: !!config, cacheKey });\n        cache.set(logKey, true, ['logging'], 60000); // Log at most once per minute\n      } catch {\n        /* noop */\n      }\n    }\n    \n    // Send data to worker with cache key and configuration\n    try {\n      // Build typed Insights task with centralized key, ttl, and tags\n      const inputs = {\n        entries: data.entries,\n        emotions: data.emotions,\n        sensoryInputs: data.sensoryInputs,\n      } as const;\n      const task = buildInsightsTask(inputs, {\n        config,\n        // Propagate tags derived from inputs so worker-side caches can invalidate by tag\n        tags: extractTagsFn(data),\n      });\n\n      // Rate limit WORKER_MESSAGE logs\n      const workerLogKey = `_logged_worker_message_${cacheKey}_${new Date().getMinutes()}`;\n      if (!cache.get(workerLogKey)) {\n        logger.debug('[WORKER_MESSAGE] Sending Insights/Compute task to analytics worker', {\n          cacheKey: task.cacheKey,\n          ttlSeconds: task.ttlSeconds,\n          tagCount: task.tags?.length ?? 0,\n          emotionsCount: data.emotions?.length || 0,\n          sensoryInputsCount: data.sensoryInputs?.length || 0,\n          entriesCount: data.entries?.length || 0\n        });\n        cache.set(workerLogKey, true, ['logging'], 60000); // Log once per minute per cache key\n      }\n\n      // If worker not available or circuit is open, queue or fallback\n      if (!workerRef.current || isCircuitOpen()) {\n        // If no worker at all, route to fallback immediately (do not queue unbounded)\n        if (!singleton.worker) {\n          throw new Error('Worker unavailable or circuit open');\n        }\n      }\n\n      // If worker exists but is not ready yet, queue the task\n      if (workerRef.current && !singleton.ready) {\n        pendingTasks.push(task as unknown as MessageEvent['data']);\n      } else if (workerRef.current) {\n        workerRef.current.postMessage(task);\n      } else {\n        throw new Error('Worker reference missing');\n      }\n    } catch (postErr) {\n      logger.error('[WORKER_MESSAGE] Failed to post message to worker, falling back to sync', { error: postErr });\n      if (watchdogRef.current) {\n        clearTimeout(watchdogRef.current);\n        watchdogRef.current = null;\n      }\n      \n      // Fallback to synchronous processing\n      try {\n        const fallbackResults = await analyticsWorkerFallback.processAnalytics(data, { useAI: options?.useAI, student: options?.student });\n        setResults(fallbackResults as AnalyticsResultsAI);\n        const tags = extractTagsFn(data);\n        cache.set(cacheKey, fallbackResults as AnalyticsResultsAI, tags);\n        setError(null);\n      } catch (fallbackError) {\n        logger.error('[useAnalyticsWorker] Fallback processing failed after worker post error', fallbackError);\n        setError('Analytics processing failed.');\n      } finally {\n        setIsAnalyzing(false);\n      }\n    }\n  }, [cache, createCacheKey, extractTagsFn]);\n\n  /**\n   * Pre-compute analytics for common queries during idle time\n   */\n  const precomputeCommonAnalytics = useCallback((dataProvider: () => AnalyticsData[]) => {\n    if (!precomputeOnIdle || !workerRef.current) return;\n\n    const precompute = () => {\n      const commonDataSets = dataProvider();\n      const config = getValidatedConfig();\n      \n      commonDataSets.forEach((data, index) => {\n        // Stagger the precomputation to avoid blocking\n        setTimeout(() => {\n          const cacheKey = createCacheKey(data);\n          \n          // Only compute if not already cached\n          if (!cache.has(cacheKey)) {\n            try {\n        logger.debug('[useAnalyticsWorker] posting Insights/Compute task (precompute)', { hasConfig: !!config, cacheKey, idx: index });\n            } catch {\n              /* noop */\n            }\n            const task = buildInsightsTask({\n              entries: data.entries,\n              emotions: data.emotions,\n              sensoryInputs: data.sensoryInputs,\n            }, { config, tags: extractTagsFn(data) });\n            workerRef.current?.postMessage(task);\n          }\n        }, index * 100); // 100ms between each precomputation\n      });\n    };\n\n    // Use requestIdleCallback for precomputation\n    if ('requestIdleCallback' in window) {\n      idleCallbackRef.current = requestIdleCallback(precompute, { timeout: 5000 });\n    } else {\n      // Fallback for browsers without requestIdleCallback\n      setTimeout(precompute, 2000);\n    }\n  }, [precomputeOnIdle, cache, createCacheKey]);\n\n  /**\n   * Invalidate cache entries for a specific student\n   */\n  const invalidateCacheForStudent = useCallback((studentId: string) => {\n    cache.invalidateByTag(`student-${studentId}`);\n  }, [cache]);\n\n  /**\n   * Invalidate all analytics cache entries\n   */\n  const clearCache = useCallback(() => {\n    cache.clear();\n  }, [cache]);\n\n  /**\n   * Subscribe to configuration changes to invalidate cache\n   */\n  useEffect(() => {\n    const unsubscribe = analyticsConfig.subscribe((newConfig) => {\n      if (newConfig.cache.invalidateOnConfigChange) {\n        clearCache();\n      }\n    });\n\n    return unsubscribe;\n  }, [clearCache]);\n\n  /**\n   * Get current cache statistics\n   */\n  const getCacheStats = useCallback(() => {\n    return cache.stats;\n  }, [cache]);\n\n  return {\n    results,\n    isAnalyzing,\n    error,\n    runAnalysis,\n    precomputeCommonAnalytics,\n    invalidateCacheForStudent,\n    clearCache,\n    cacheStats: getCacheStats(),\n    cacheSize: cache.size\n  };\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useAsyncHandler.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useAsyncState.ts","messages":[{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":101,"column":28,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":104,"endColumn":20},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":183,"column":44,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":183,"endColumn":85},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":290,"column":29,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":294,"endColumn":26}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useEffect, useRef, useState } from 'react';\nimport { handleError } from '@/lib/errorHandler';\nimport { SensoryCompassError, ErrorType } from '@/types/errors';\n\nexport type AsyncStatus = 'idle' | 'loading' | 'success' | 'error';\n\ninterface InternalAsyncState<TValue> {\n  status: AsyncStatus;\n  data: TValue | null;\n  error: Error | null;\n}\n\nexport interface UseAsyncStateOptions<TValue> {\n  autoResetMs?: number;\n  onSuccess?: (value: TValue) => void;\n  onError?: (error: Error) => void;\n  retryCount?: number;\n  retryDelay?: number;\n  showErrorToast?: boolean;\n}\n\nexport interface UseAsyncStateResult<TValue> {\n  status: AsyncStatus;\n  data: TValue | null;\n  error: Error | null;\n  isIdle: boolean;\n  isLoading: boolean;\n  isSuccess: boolean;\n  isError: boolean;\n  state: {\n    status: AsyncStatus;\n    data: TValue | null;\n    error: Error | null;\n    isIdle: boolean;\n    isLoading: boolean;\n    isSuccess: boolean;\n    isError: boolean;\n  };\n  execute: <TReturn = TValue>(fn: () => Promise<TReturn>) => Promise<TReturn>;\n  run: <TReturn = TValue>(fn: () => Promise<TReturn>) => Promise<TReturn>;\n  reset: () => void;\n  setData: (value: TValue | null) => void;\n  setError: (error: Error | null) => void;\n}\n\nexport function useAsyncState<TValue = unknown>(\n  initialData: TValue | null = null,\n  options: UseAsyncStateOptions<TValue> = {}\n): UseAsyncStateResult<TValue> {\n  const {\n    autoResetMs,\n    onSuccess,\n    onError,\n    retryCount = 0,\n    retryDelay = 1000,\n    showErrorToast = true,\n  } = options;\n\n  const initialDataRef = useRef<TValue | null>(initialData);\n  const [internalState, setInternalState] = useState<InternalAsyncState<TValue>>(() => ({\n    status: 'idle',\n    data: initialDataRef.current,\n    error: null,\n  }));\n  const isMountedRef = useRef(true);\n  const autoResetRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  useEffect(() => {\n    initialDataRef.current = initialData;\n  }, [initialData]);\n\n  useEffect(() => {\n    return () => {\n      isMountedRef.current = false;\n      if (autoResetRef.current) {\n        clearTimeout(autoResetRef.current);\n      }\n    };\n  }, []);\n\n  const clearAutoReset = useCallback(() => {\n    if (autoResetRef.current) {\n      clearTimeout(autoResetRef.current);\n      autoResetRef.current = null;\n    }\n  }, []);\n\n  const reset = useCallback(() => {\n    if (!isMountedRef.current) return;\n    clearAutoReset();\n    setInternalState({\n      status: 'idle',\n      data: initialDataRef.current,\n      error: null,\n    });\n  }, [clearAutoReset]);\n\n  const scheduleAutoReset = useCallback(() => {\n    if (!autoResetMs || autoResetMs <= 0) return;\n    clearAutoReset();\n    autoResetRef.current = setTimeout(() => {\n      if (!isMountedRef.current) return;\n      reset();\n    }, autoResetMs);\n  }, [autoResetMs, clearAutoReset, reset]);\n\n  const setData = useCallback(\n    (value: TValue | null) => {\n      if (!isMountedRef.current) return;\n      clearAutoReset();\n      setInternalState({\n        status: value === null ? 'idle' : 'success',\n        data: value,\n        error: null,\n      });\n    },\n    [clearAutoReset]\n  );\n\n  const setError = useCallback(\n    (error: Error | null) => {\n      if (!isMountedRef.current) return;\n      clearAutoReset();\n      setInternalState(prev => ({\n        status: error ? 'error' : 'idle',\n        data: prev.data,\n        error,\n      }));\n      if (!error) {\n        scheduleAutoReset();\n      }\n    },\n    [clearAutoReset, scheduleAutoReset]\n  );\n\n  const execute = useCallback(\n    async <TReturn = TValue>(asyncFunction: () => Promise<TReturn>): Promise<TReturn> => {\n      if (!isMountedRef.current) {\n        throw new Error('Component unmounted');\n      }\n\n      clearAutoReset();\n      setInternalState(prev => ({\n        status: 'loading',\n        data: prev.data,\n        error: null,\n      }));\n\n      let attempt = 0;\n      let lastError: Error | null = null;\n\n      while (attempt <= retryCount) {\n        try {\n          const result = await asyncFunction();\n\n          if (!isMountedRef.current) {\n            return result;\n          }\n\n          setInternalState(prev => ({\n            status: 'success',\n            data: result === undefined ? prev.data : (result as unknown as TValue | null),\n            error: null,\n          }));\n\n          if (result !== undefined) {\n            try {\n              onSuccess?.(result as unknown as TValue);\n            } catch {\n              // ignore callback errors\n            }\n          }\n\n          scheduleAutoReset();\n          return result;\n        } catch (rawError) {\n          const error = rawError instanceof Error ? rawError : new Error(String(rawError));\n          lastError = error;\n          attempt += 1;\n\n          if (attempt <= retryCount) {\n            if (retryDelay > 0) {\n              await new Promise(resolve => setTimeout(resolve, retryDelay * attempt));\n            }\n            continue;\n          }\n\n          if (!isMountedRef.current) {\n            throw error;\n          }\n\n          setInternalState(prev => ({\n            status: 'error',\n            data: prev.data,\n            error,\n          }));\n\n          try {\n            onError?.(error);\n          } catch {\n            // ignore callback errors\n          }\n\n          if (showErrorToast) {\n            const normalized =\n              error instanceof SensoryCompassError\n                ? error\n                : new SensoryCompassError(ErrorType.UNKNOWN_ERROR, error.message, { cause: error });\n            void handleError(normalized, { showToast: true, throwError: false });\n          }\n\n          scheduleAutoReset();\n          throw error;\n        }\n      }\n\n      throw lastError ?? new Error('Async execution failed');\n    },\n    [clearAutoReset, onError, onSuccess, retryCount, retryDelay, scheduleAutoReset, showErrorToast]\n  );\n\n  const derivedState = {\n    status: internalState.status,\n    data: internalState.data,\n    error: internalState.error,\n    isIdle: internalState.status === 'idle',\n    isLoading: internalState.status === 'loading',\n    isSuccess: internalState.status === 'success',\n    isError: internalState.status === 'error',\n  } as const;\n\n  return {\n    ...derivedState,\n    state: derivedState,\n    execute,\n    run: execute,\n    reset,\n    setData,\n    setError,\n  };\n}\n\nexport function useAsyncMutation<TData = unknown, TVariables = unknown>(\n  mutationFn: (variables: TVariables) => Promise<TData>,\n  options: UseAsyncStateOptions<TData> = {}\n) {\n  const { run, setData, reset, setError, state, ...summary } = useAsyncState<TData>(null, options);\n\n  const mutate = useCallback(\n    async (variables: TVariables) => {\n      const result = await run(() => mutationFn(variables));\n      if (result !== undefined) {\n        setData(result);\n      }\n      return result;\n    },\n    [mutationFn, run, setData]\n  );\n\n  return {\n    ...summary,\n    state,\n    mutate,\n    reset,\n    setData,\n    setError,\n    run,\n    execute: run,\n  };\n}\n\nexport function useAsyncQuery<T = unknown>(\n  queryFn: () => Promise<T>,\n  options: UseAsyncStateOptions<T> & { enabled?: boolean; refetchInterval?: number } = {}\n) {\n  const { enabled = true, refetchInterval, ...asyncOptions } = options;\n  const { run, setData, reset, setError, state, ...summary } = useAsyncState<T>(null, asyncOptions);\n  const intervalRef = useRef<ReturnType<typeof setInterval> | null>(null);\n\n  useEffect(() => {\n    if (enabled) {\n      run(queryFn).catch(() => {\n        // ignore initial query errors; error state is handled by the hook\n      });\n    }\n  }, [enabled, run, queryFn]);\n\n  useEffect(() => {\n    if (refetchInterval && enabled && summary.isSuccess) {\n      intervalRef.current = setInterval(() => {\n        run(queryFn).catch(() => {\n          // ignore interval errors; consumers can inspect state.error\n        });\n      }, refetchInterval);\n    }\n\n    return () => {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n      }\n    };\n  }, [refetchInterval, enabled, summary.isSuccess, run, queryFn]);\n\n  const refetch = useCallback(() => run(queryFn), [run, queryFn]);\n\n  return {\n    ...summary,\n    state,\n    refetch,\n    reset,\n    setData,\n    setError,\n    run,\n    execute: run,\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useChartExport.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useChartStore.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'get' is defined but never used. Allowed unused args must match /^_/u.","line":9,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":14}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\nimport { persist, createJSONStorage } from 'zustand/middleware';\nimport type { EChartsOption } from 'echarts';\nimport { logger } from '@/lib/logger';\nimport type { ChartStoreState } from '@/types/chart';\n\nexport const useChartStore = create<ChartStoreState>()(\n  persist(\n    (set, get) => ({\n      charts: {},\n      initChart: (id, initial) => {\n        set((state) => {\n          if (state.charts[id]) return state; // already exists\n          return {\n            charts: {\n              ...state.charts,\n              [id]: {\n                id,\n                option: initial?.option ?? null,\n                loading: initial?.loading ?? true,\n                error: initial?.error ?? null,\n                lastUpdated: initial?.lastUpdated ?? null,\n              },\n            },\n          };\n        }, false, { type: 'chart/initChart', id });\n      },\n      setLoading: (id, loading) => {\n        set((state) => {\n          const chart = state.charts[id];\n          if (!chart) return state;\n          return {\n            charts: {\n              ...state.charts,\n              [id]: { ...chart, loading },\n            },\n          };\n        }, false, { type: 'chart/setLoading', id, loading });\n      },\n      setOption: (id, option: EChartsOption) => {\n        try {\n          set((state) => {\n            const prev = state.charts[id] ?? { id, option: null, loading: false, error: null, lastUpdated: null };\n            return {\n              charts: {\n                ...state.charts,\n                [id]: { ...prev, option, loading: false, error: null, lastUpdated: Date.now() },\n              },\n            };\n          }, false, { type: 'chart/setOption', id });\n        } catch (e) {\n          logger.error('setOption failed', e);\n        }\n      },\n      setError: (id, error) => {\n        set((state) => {\n          const chart = state.charts[id];\n          if (!chart) return state;\n          return {\n            charts: {\n              ...state.charts,\n              [id]: { ...chart, error, loading: false },\n            },\n          };\n        }, false, { type: 'chart/setError', id, error });\n      },\n      clearChart: (id) => {\n        set((state) => {\n          const { [id]: _, ...rest } = state.charts;\n          return { charts: rest };\n        }, false, { type: 'chart/clearChart', id });\n      },\n      reset: () => set({ charts: {} }, false, { type: 'chart/reset' }),\n    }),\n    {\n      name: 'chart-store',\n      storage: createJSONStorage(() => sessionStorage),\n      version: 1,\n      partialize: (state) => ({ charts: state.charts }),\n    },\n  ),\n);\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useDataAnalysis.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useDataFiltering.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useDataPagination.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useFilteredData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useLocalStorage.ts","messages":[{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":35,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":35,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\nimport { logger } from '@/lib/logger';\n\nexport function useLocalStorage<T>(\n  key: string,\n  initialValue: T\n): [T, (value: T | ((val: T) => T)) => void, () => void] {\n  // State to store our value\n  const [storedValue, setStoredValue] = useState<T>(() => {\n    try {\n      // Get from local storage by key\n      const item = window.localStorage.getItem(key);\n      // Parse stored json or if none return initialValue\n      return item ? JSON.parse(item) : initialValue;\n    } catch (error) {\n      // If error also return initialValue\n      logger.error(`Error reading localStorage key \"${key}\":`, error);\n      return initialValue;\n    }\n  });\n\n  // Listen for changes to this key in other tabs\n  useEffect(() => {\n    const handleStorageChange = (e: StorageEvent) => {\n      if (e.key === key) {\n        try {\n          setStoredValue(e.newValue ? JSON.parse(e.newValue) : initialValue);\n        } catch (error) {\n          logger.error(`Error parsing localStorage key \"${key}\" on change:`, error);\n          setStoredValue(initialValue);\n        }\n      }\n    };\n\n    window.addEventListener('storage', handleStorageChange);\n\n    return () => {\n      window.removeEventListener('storage', handleStorageChange);\n    };\n  }, [key, initialValue]);\n\n  // Return a wrapped version of useState's setter function that persists the new value to localStorage\n  const setValue = (value: T | ((val: T) => T)) => {\n    try {\n      // Allow value to be a function so we have the same API as useState\n      const valueToStore = value instanceof Function ? value(storedValue) : value;\n      // Save state\n      setStoredValue(valueToStore);\n      // Save to local storage\n      window.localStorage.setItem(key, JSON.stringify(valueToStore));\n    } catch (error) {\n      // A more advanced implementation would handle the error case\n      logger.error(`Error setting localStorage key \"${key}\":`, error);\n    }\n  };\n\n  const removeValue = () => {\n    try {\n      setStoredValue(initialValue);\n      window.localStorage.removeItem(key);\n    } catch (error) {\n      logger.error(`Error removing localStorage key \"${key}\":`, error);\n    }\n  };\n\n  return [storedValue, setValue, removeValue];\n}","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useMLTrainingWorker.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useMockDataSeeding.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useOptimizedInsights.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/usePerformanceCache.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/usePerformanceMonitor.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sendAnalytics' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":59,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":18},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect contains a call to 'setMetrics'. Without a list of dependencies, this can lead to an infinite chain of updates. To fix this, pass [warnThreshold, verbose, trackMemory, componentName] as a second argument to the useEffect Hook.","line":77,"column":3,"nodeType":"Identifier","endLine":77,"endColumn":12,"suggestions":[{"desc":"Add dependencies array: [warnThreshold, verbose, trackMemory, componentName]","fix":{"range":[4413,4413],"text":", [warnThreshold, verbose, trackMemory, componentName]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3554,3557],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3554,3557],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The ref value 'renderCount.current' will likely have changed by the time this effect cleanup function runs. If this ref points to a node rendered by React, copy 'renderCount.current' to a variable inside the effect, and use that variable in the cleanup function.","line":146,"column":39,"nodeType":"Identifier","endLine":146,"endColumn":46},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4795,4798],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4795,4798],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":172,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4849,4852],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4849,4852],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":177,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5028,5031],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5028,5031],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'interactions' is defined but never used. Allowed unused args must match /^_/u.","line":216,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":216,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":216,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6080,6083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6080,6083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":304,"column":27,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":316,"endColumn":14},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The ref value 'mountTime.current' will likely have changed by the time this effect cleanup function runs. If this ref points to a node rendered by React, copy 'mountTime.current' to a variable inside the effect, and use that variable in the cleanup function.","line":322,"column":47,"nodeType":"Identifier","endLine":322,"endColumn":54},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The ref value 'updateCount.current' will likely have changed by the time this effect cleanup function runs. If this ref points to a node rendered by React, copy 'updateCount.current' to a variable inside the effect, and use that variable in the cleanup function.","line":326,"column":37,"nodeType":"Identifier","endLine":326,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":345,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":345,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9867,9870],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9867,9870],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":13,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * @fileoverview Performance monitoring hooks for React components\n * \n * Provides utilities for tracking and optimizing component performance:\n * - Render time tracking\n * - Re-render counting\n * - Performance profiling integration\n * - Memory usage monitoring\n * \n * @module hooks/usePerformanceMonitor\n */\n\nimport { useEffect, useRef, useCallback, useState } from 'react';\nimport { logger } from '@/lib/logger';\n\ninterface PerformanceMetrics {\n  renderCount: number;\n  lastRenderTime: number;\n  averageRenderTime: number;\n  maxRenderTime: number;\n  minRenderTime: number;\n  totalRenderTime: number;\n}\n\ninterface UsePerformanceMonitorOptions {\n  /** Component name for logging */\n  componentName: string;\n  /** Threshold in ms to trigger warnings */\n  warnThreshold?: number;\n  /** Whether to log all renders (verbose mode) */\n  verbose?: boolean;\n  /** Whether to track memory usage */\n  trackMemory?: boolean;\n  /** Whether to send metrics to analytics */\n  sendAnalytics?: boolean;\n}\n\n/**\n * Hook to monitor component render performance\n * \n * @example\n * ```tsx\n * const MyComponent = () => {\n *   const metrics = usePerformanceMonitor({\n *     componentName: 'MyComponent',\n *     warnThreshold: 16, // Warn if render takes > 16ms (60 FPS)\n *   });\n * \n *   return <div>...</div>;\n * };\n * ```\n */\nexport function usePerformanceMonitor(options: UsePerformanceMonitorOptions): PerformanceMetrics {\n  const {\n    componentName,\n    warnThreshold = 16, // Default to 60 FPS threshold\n    verbose = false,\n    trackMemory = false,\n    sendAnalytics = false,\n  } = options;\n\n  const renderCount = useRef(0);\n  const renderTimes = useRef<number[]>([]);\n  const lastRenderStart = useRef<number>(0);\n  const [metrics, setMetrics] = useState<PerformanceMetrics>({\n    renderCount: 0,\n    lastRenderTime: 0,\n    averageRenderTime: 0,\n    maxRenderTime: 0,\n    minRenderTime: Infinity,\n    totalRenderTime: 0,\n  });\n\n  // Track render start\n  lastRenderStart.current = performance.now();\n\n  useEffect(() => {\n    renderCount.current++;\n    const renderEnd = performance.now();\n    const renderTime = renderEnd - lastRenderStart.current;\n    renderTimes.current.push(renderTime);\n\n    // Keep only last 100 render times to prevent memory leak\n    if (renderTimes.current.length > 100) {\n      renderTimes.current.shift();\n    }\n\n    // Calculate metrics\n    const total = renderTimes.current.reduce((sum, time) => sum + time, 0);\n    const average = total / renderTimes.current.length;\n    const max = Math.max(...renderTimes.current);\n    const min = Math.min(...renderTimes.current);\n\n    const newMetrics: PerformanceMetrics = {\n      renderCount: renderCount.current,\n      lastRenderTime: renderTime,\n      averageRenderTime: average,\n      maxRenderTime: max,\n      minRenderTime: min,\n      totalRenderTime: total,\n    };\n\n    setMetrics(newMetrics);\n\n    // Log warnings for slow renders\n    if (renderTime > warnThreshold) {\n      logger.warn(\n        `[Performance] ${componentName} slow render detected`,\n        {\n          renderTime: renderTime.toFixed(2),\n          renderCount: renderCount.current,\n          threshold: warnThreshold,\n        }\n      );\n    }\n\n    // Verbose logging\n    if (verbose) {\n      logger.info(\n        `[Performance] ${componentName} render #${renderCount.current}`,\n        {\n          renderTime: renderTime.toFixed(2),\n          average: average.toFixed(2),\n        }\n      );\n    }\n\n    // Track memory usage if enabled\n    if (trackMemory && 'memory' in performance) {\n      const memory = (performance as any).memory;\n      if (memory) {\n        logger.info(`[Memory] ${componentName}`, {\n          usedJSHeapSize: (memory.usedJSHeapSize / 1048576).toFixed(2) + ' MB',\n          totalJSHeapSize: (memory.totalJSHeapSize / 1048576).toFixed(2) + ' MB',\n          limit: (memory.jsHeapSizeLimit / 1048576).toFixed(2) + ' MB',\n        });\n      }\n    }\n\n    // Cleanup function to log final stats\n    return () => {\n      if (renderCount.current > 10 && average > warnThreshold) {\n        logger.warn(\n          `[Performance Summary] ${componentName} performance issues detected`,\n          {\n            totalRenders: renderCount.current,\n            averageRenderTime: average.toFixed(2),\n            maxRenderTime: max.toFixed(2),\n            recommendation: 'Consider optimizing with React.memo, useMemo, or useCallback',\n          }\n        );\n      }\n    };\n  });\n\n  return metrics;\n}\n\n/**\n * Hook to track why a component re-rendered\n * Useful for debugging unnecessary re-renders\n * \n * @example\n * ```tsx\n * const MyComponent = ({ prop1, prop2, prop3 }) => {\n *   useWhyDidYouUpdate('MyComponent', { prop1, prop2, prop3 });\n *   return <div>...</div>;\n * };\n * ```\n */\nexport function useWhyDidYouUpdate(name: string, props: Record<string, any>) {\n  const previousProps = useRef<Record<string, any>>();\n\n  useEffect(() => {\n    if (previousProps.current) {\n      const allKeys = Object.keys({ ...previousProps.current, ...props });\n      const changedProps: Record<string, any> = {};\n\n      allKeys.forEach((key) => {\n        if (!Object.is(previousProps.current![key], props[key])) {\n          changedProps[key] = {\n            from: previousProps.current![key],\n            to: props[key],\n          };\n        }\n      });\n\n      if (Object.keys(changedProps).length > 0) {\n        logger.info(`[Why Update] ${name} re-rendered due to:`, changedProps);\n      }\n    }\n\n    previousProps.current = props;\n  });\n}\n\n/**\n * React Profiler callback for integration with React DevTools Profiler API\n * \n * @example\n * ```tsx\n * import { Profiler } from 'react';\n * \n * <Profiler id=\"MyComponent\" onRender={onRenderCallback}>\n *   <MyComponent />\n * </Profiler>\n * ```\n */\nexport function onRenderCallback(\n  id: string, // Component ID\n  phase: 'mount' | 'update', // Mount or update phase\n  actualDuration: number, // Time spent rendering\n  baseDuration: number, // Estimated time without memoization\n  startTime: number, // When React began rendering\n  commitTime: number, // When React committed the update\n  interactions: Set<any> // Interactions that triggered this update\n) {\n  const savings = baseDuration - actualDuration;\n  const savingsPercent = (savings / baseDuration) * 100;\n\n  if (actualDuration > 16) {\n    logger.warn(`[Profiler] ${id} slow render`, {\n      phase,\n      actualDuration: actualDuration.toFixed(2),\n      baseDuration: baseDuration.toFixed(2),\n      memoizationSavings: savings > 0 ? `${savings.toFixed(2)}ms (${savingsPercent.toFixed(1)}%)` : 'None',\n    });\n  }\n\n  // Log mount phase for initial load performance\n  if (phase === 'mount') {\n    logger.info(`[Profiler] ${id} mounted`, {\n      mountTime: actualDuration.toFixed(2),\n      startTime: startTime.toFixed(2),\n      commitTime: commitTime.toFixed(2),\n    });\n  }\n}\n\n/**\n * Hook to measure and optimize expensive computations\n * \n * @example\n * ```tsx\n * const MyComponent = ({ data }) => {\n *   const result = useComputationTimer(\n *     () => expensiveComputation(data),\n *     [data],\n *     'expensiveComputation'\n *   );\n *   return <div>{result}</div>;\n * };\n * ```\n */\nexport function useComputationTimer<T>(\n  computation: () => T,\n  deps: React.DependencyList,\n  name: string\n): T {\n  const resultRef = useRef<T>();\n  const computationTimeRef = useRef(0);\n\n  // Check if dependencies changed\n  const depsRef = useRef<React.DependencyList>();\n  const depsChanged = !depsRef.current || \n    deps.length !== depsRef.current.length ||\n    deps.some((dep, i) => !Object.is(dep, depsRef.current![i]));\n\n  if (depsChanged) {\n    const startTime = performance.now();\n    resultRef.current = computation();\n    const endTime = performance.now();\n    computationTimeRef.current = endTime - startTime;\n    depsRef.current = deps;\n\n    if (computationTimeRef.current > 10) {\n      logger.warn(`[Computation] ${name} took ${computationTimeRef.current.toFixed(2)}ms`);\n    }\n  }\n\n  return resultRef.current as T;\n}\n\n/**\n * Hook to detect memory leaks in components\n * \n * @example\n * ```tsx\n * const MyComponent = () => {\n *   useMemoryLeakDetector('MyComponent');\n *   return <div>...</div>;\n * };\n * ```\n */\nexport function useMemoryLeakDetector(componentName: string) {\n  const mountTime = useRef(Date.now());\n  const updateCount = useRef(0);\n\n  useEffect(() => {\n    updateCount.current++;\n  });\n\n  useEffect(() => {\n    const checkInterval = setInterval(() => {\n      const lifetime = Date.now() - mountTime.current;\n      const lifetimeMinutes = lifetime / 60000;\n\n      // Warn if component has been alive for > 5 minutes with > 100 updates\n      if (lifetimeMinutes > 5 && updateCount.current > 100) {\n        logger.warn(`[Memory Leak?] ${componentName} potential memory leak detected`, {\n          lifetime: `${lifetimeMinutes.toFixed(1)} minutes`,\n          updateCount: updateCount.current,\n          updatesPerMinute: (updateCount.current / lifetimeMinutes).toFixed(1),\n        });\n      }\n    }, 60000); // Check every minute\n\n    return () => {\n      clearInterval(checkInterval);\n      \n      // Log component unmount stats\n      const lifetime = Date.now() - mountTime.current;\n      if (updateCount.current > 50) {\n        logger.info(`[Unmount] ${componentName} unmounted`, {\n          lifetime: `${(lifetime / 1000).toFixed(1)}s`,\n          totalUpdates: updateCount.current,\n        });\n      }\n    };\n  }, [componentName]);\n}\n\n/**\n * Hook for batch performance monitoring across multiple components\n * Useful for tracking performance of component trees\n */\nexport function useBatchPerformanceMonitor() {\n  const metricsMap = useRef<Map<string, PerformanceMetrics>>(new Map());\n\n  const trackComponent = useCallback((componentName: string, metrics: PerformanceMetrics) => {\n    metricsMap.current.set(componentName, metrics);\n  }, []);\n\n  const getReport = useCallback(() => {\n    const report: Record<string, any> = {};\n    let totalRenderTime = 0;\n    let totalRenderCount = 0;\n\n    metricsMap.current.forEach((metrics, name) => {\n      report[name] = {\n        renders: metrics.renderCount,\n        avgTime: metrics.averageRenderTime.toFixed(2),\n        maxTime: metrics.maxRenderTime.toFixed(2),\n      };\n      totalRenderTime += metrics.totalRenderTime;\n      totalRenderCount += metrics.renderCount;\n    });\n\n    report.summary = {\n      components: metricsMap.current.size,\n      totalRenders: totalRenderCount,\n      totalTime: totalRenderTime.toFixed(2),\n      averageTime: (totalRenderTime / totalRenderCount).toFixed(2),\n    };\n\n    return report;\n  }, []);\n\n  const logReport = useCallback(() => {\n    const report = getReport();\n    logger.info('[Performance Report]', report);\n  }, [getReport]);\n\n  return {\n    trackComponent,\n    getReport,\n    logReport,\n  };\n}\n\n/**\n * Export all performance monitoring utilities\n */\nexport const PerformanceMonitor = {\n  usePerformanceMonitor,\n  useWhyDidYouUpdate,\n  onRenderCallback,\n  useComputationTimer,\n  useMemoryLeakDetector,\n  useBatchPerformanceMonitor,\n};\n\nexport default PerformanceMonitor;\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useProgressiveChartData.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":114,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":117,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[908,911],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[908,911],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":55,"column":39,"nodeType":"BlockStatement","messageId":"unexpected","endLine":55,"endColumn":41,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1877,1877],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":144,"column":115,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":118,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5564,5567],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5564,5567],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, useRef, useState, useCallback } from 'react';\nimport { EmotionEntry, SensoryEntry, TrackingEntry } from '@/types/student';\nimport { AnalyticsResults } from '@/types/analytics';\nimport { ProgressiveChartData, ProgressiveChartDataState } from '@/types/charts';\nimport { logger } from '@/lib/logger';\n\ninterface UseProgressiveChartDataParams {\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  entries: TrackingEntry[];\n  analyticsResults?: AnalyticsResults | null;\n}\n\ninterface UseProgressiveChartDataReturn {\n  data: ProgressiveChartData;\n  state: ProgressiveChartDataState;\n  reset: () => void;\n}\n\nconst requestIdle: (cb: IdleRequestCallback, opts?: IdleRequestOptions) => number =\n  typeof requestIdleCallback !== 'undefined'\n    ? requestIdleCallback\n    : ((cb: IdleRequestCallback) => window.setTimeout(() => cb({ didTimeout: false, timeRemaining: () => 50 } as any), 0));\n\nconst cancelIdle: (id: number) => void =\n  typeof cancelIdleCallback !== 'undefined' ? cancelIdleCallback : clearTimeout;\n\nexport function useProgressiveChartData(params: UseProgressiveChartDataParams): UseProgressiveChartDataReturn {\n  const { emotions, sensoryInputs, entries, analyticsResults } = params;\n\n  const [data, setData] = useState<ProgressiveChartData>({\n    emotionTrends: [],\n    emotionDistribution: [],\n    sensoryResponses: [],\n  });\n\n  const [state, setState] = useState<ProgressiveChartDataState>({\n    isLoading: true,\n    steps: {\n      emotionDistribution: false,\n      sensoryResponses: false,\n      emotionTrends: false,\n    },\n    error: null,\n  });\n\n  const idleIdsRef = useRef<number[]>([]);\n  const timeoutsRef = useRef<number[]>([]);\n  const isMountedRef = useRef(true);\n\n  useEffect(() => {\n    return () => {\n      isMountedRef.current = false;\n      idleIdsRef.current.forEach(id => {\n        try { cancelIdle(id); } catch {}\n      });\n      timeoutsRef.current.forEach(id => clearTimeout(id));\n      idleIdsRef.current = [];\n      timeoutsRef.current = [];\n    };\n  }, []);\n\n  const reset = useCallback(() => {\n    setData({ emotionTrends: [], emotionDistribution: [], sensoryResponses: [] });\n    setState({\n      isLoading: true,\n      steps: { emotionDistribution: false, sensoryResponses: false, emotionTrends: false },\n      error: null,\n    });\n  }, []);\n\n  // Small helpers to safely update\n  const safeSetData = useCallback((updater: (prev: ProgressiveChartData) => ProgressiveChartData) => {\n    if (!isMountedRef.current) return;\n    setData(prev => updater(prev));\n  }, []);\n\n  const markStepDone = useCallback((step: keyof ProgressiveChartDataState['steps']) => {\n    if (!isMountedRef.current) return;\n    setState(prev => ({\n      ...prev,\n      steps: { ...prev.steps, [step]: true },\n      isLoading: !(prev.steps.emotionDistribution && prev.steps.sensoryResponses && (step === 'emotionTrends' || prev.steps.emotionTrends)),\n    }));\n  }, []);\n\n  // Progressive pipeline: quick -> medium -> heavy computations\n  useEffect(() => {\n    // Start fresh on every input change\n    reset();\n\n    // Step 1: Emotion distribution (fast)\n    const id1 = requestIdle(() => {\n      try {\n        const distribution = new Map<string, number>();\n        emotions.forEach(e => {\n          distribution.set(e.emotion, (distribution.get(e.emotion) || 0) + 1);\n        });\n        const pieData = Array.from(distribution.entries()).map(([name, value]) => ({ name, value }));\n        safeSetData(prev => ({ ...prev, emotionDistribution: pieData }));\n        markStepDone('emotionDistribution');\n      } catch (error) {\n        logger.error('[useProgressiveChartData] Failed computing emotion distribution', error);\n        setState(prev => ({ ...prev, error: error instanceof Error ? error : new Error('Unknown error') }));\n      }\n    }, { timeout: 100 });\n    idleIdsRef.current.push(id1);\n\n    // Step 2: Sensory responses (medium)\n    const t2 = window.setTimeout(() => {\n      const id2 = requestIdle(() => {\n        try {\n          type SensoryRow = { type: string; total: number; [key: string]: string | number };\n          const map = new Map<string, SensoryRow>();\n          sensoryInputs.forEach(s => {\n            const row = map.get(s.sensoryType) || { type: s.sensoryType, total: 0 };\n            row[s.response] = ((typeof row[s.response] === 'number' ? (row[s.response] as number) : 0) + 1);\n            row.total = (row.total || 0) + 1;\n            map.set(s.sensoryType, row);\n          });\n          const sensoryData = Array.from(map.values());\n          safeSetData(prev => ({ ...prev, sensoryResponses: sensoryData }));\n          markStepDone('sensoryResponses');\n        } catch (error) {\n          logger.error('[useProgressiveChartData] Failed computing sensory responses', error);\n          setState(prev => ({ ...prev, error: error instanceof Error ? error : new Error('Unknown error') }));\n        }\n      }, { timeout: 200 });\n      idleIdsRef.current.push(id2);\n    }, 50);\n    timeoutsRef.current.push(t2);\n\n    // Step 3: Emotion trends over time (heavier)\n    const t3 = window.setTimeout(() => {\n      const id3 = requestIdle(() => {\n        try {\n          // Determine all emotion keys for consistent columns\n          const allEmotions = Array.from(new Set(emotions.map(e => e.emotion)));\n\n          type Row = { date: string; count: number } & Record<string, number | string>;\n          const dataMap = new Map<string, Row>();\n\n          emotions.forEach(e => {\n            const date = e.timestamp instanceof Date ? e.timestamp.toLocaleDateString() : new Date(e.timestamp as any).toLocaleDateString();\n            if (!dataMap.has(date)) {\n              const base: Row = { date, count: 0 };\n              allEmotions.forEach(k => { base[k] = 0; });\n              dataMap.set(date, base);\n            }\n            const row = dataMap.get(date)!;\n            const current = row[e.emotion];\n            row[e.emotion] = (typeof current === 'number' ? current : 0) + e.intensity;\n            row.count = (row.count || 0) + 1;\n          });\n\n          // Sort by date asc\n          const toDate = (d: string) => new Date(d);\n          const rows = Array.from(dataMap.values()).sort((a, b) => toDate(a.date).getTime() - toDate(b.date).getTime());\n\n          safeSetData(prev => ({ ...prev, emotionTrends: rows }));\n          markStepDone('emotionTrends');\n        } catch (error) {\n          logger.error('[useProgressiveChartData] Failed computing emotion trends', error);\n          setState(prev => ({ ...prev, error: error instanceof Error ? error : new Error('Unknown error') }));\n        }\n      }, { timeout: 400 });\n      idleIdsRef.current.push(id3);\n    }, 100);\n    timeoutsRef.current.push(t3);\n\n    // Optionally react to analytics results updates for future progressive enrichments\n    if (analyticsResults) {\n      try {\n        // Currently no heavy enrichment needed; placeholder for progressive overlays\n        logger.debug('[useProgressiveChartData] analyticsResults available', {\n          patterns: analyticsResults.patterns?.length || 0,\n          correlations: analyticsResults.correlations?.length || 0,\n        });\n      } catch {/* noop */}\n    }\n  }, [emotions, sensoryInputs, entries, analyticsResults, reset, safeSetData, markStepDone]);\n\n  return { data, state, reset };\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useRealtimeData.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'differenceInMinutes' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":29},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":247,"column":36,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":260,"endColumn":13},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":253,"column":31,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":253,"endColumn":86},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":305,"column":40,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":348,"endColumn":12},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":382,"column":26,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":386,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'prev' is defined but never used. Allowed unused args must match /^_/u.","line":454,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":454,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'smoothTransition' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":456,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":456,"endColumn":31},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":466,"column":28,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":466,"endColumn":64}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef, useCallback, useMemo, useReducer } from 'react';\nimport { EmotionEntry, SensoryEntry, TrackingEntry, EnvironmentalEntry } from '@/types/student';\nimport { differenceInMinutes, subMinutes } from 'date-fns';\nimport { logger } from '@/lib/logger';\n\ninterface RealtimeDataOptions {\n  enabled: boolean;\n  windowSize: number; // in minutes\n  updateInterval: number; // in milliseconds\n  smoothTransitions: boolean;\n  simulateData?: boolean; // For demo purposes\n}\n\ninterface RealtimeDataState {\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  trackingEntries: TrackingEntry[];\n  isLive: boolean;\n  lastUpdate: Date | null;\n  connectionStatus: 'connected' | 'disconnected' | 'connecting' | 'error';\n  newDataCount: number;\n}\n\ntype RealtimeDataAction =\n  | { type: 'START_STREAM' }\n  | { type: 'STOP_STREAM' }\n  | { type: 'SET_CONNECTION_STATUS'; payload: RealtimeDataState['connectionStatus'] }\n  | { type: 'INSERT_DATA'; payload: { emotion?: EmotionEntry; sensory?: SensoryEntry; tracking?: TrackingEntry } }\n  | { type: 'SET_HISTORICAL_DATA'; payload: { emotions: EmotionEntry[]; sensoryInputs: SensoryEntry[]; trackingEntries: TrackingEntry[] } }\n  | { type: 'CLEAR_NEW_DATA_INDICATOR' }\n  | { type: 'RESET_STATE'; payload: RealtimeDataState };\n\nconst realtimeDataReducer = (state: RealtimeDataState, action: RealtimeDataAction): RealtimeDataState => {\n  switch (action.type) {\n    case 'START_STREAM':\n      return { ...state, isLive: true, connectionStatus: 'connecting' };\n    case 'STOP_STREAM':\n      return { ...state, isLive: false, connectionStatus: 'disconnected' };\n    case 'SET_CONNECTION_STATUS':\n      return { ...state, connectionStatus: action.payload };\n    case 'INSERT_DATA':\n      return {\n        ...state,\n        lastUpdate: new Date(),\n        newDataCount: state.newDataCount + 1,\n        emotions: action.payload.emotion ? [...state.emotions, action.payload.emotion].slice(-1000) : state.emotions,\n        sensoryInputs: action.payload.sensory ? [...state.sensoryInputs, action.payload.sensory].slice(-1000) : state.sensoryInputs,\n        trackingEntries: action.payload.tracking ? [...state.trackingEntries, action.payload.tracking].slice(-1000) : state.trackingEntries,\n      };\n    case 'SET_HISTORICAL_DATA':\n      return {\n        ...state,\n        emotions: [...action.payload.emotions, ...state.emotions],\n        sensoryInputs: [...action.payload.sensoryInputs, ...state.sensoryInputs],\n        trackingEntries: [...action.payload.trackingEntries, ...state.trackingEntries],\n        connectionStatus: state.isLive ? 'connected' : 'disconnected',\n      };\n    case 'CLEAR_NEW_DATA_INDICATOR':\n      return { ...state, newDataCount: 0 };\n    case 'RESET_STATE':\n      return action.payload;\n    default:\n      return state;\n  }\n};\n\nexport interface RealtimeDataReturn extends RealtimeDataState {\n  startStream: () => void;\n  stopStream: () => void;\n  clearNewDataIndicator: () => void;\n  getHistoricalData: (minutes: number) => void;\n  isDataLive: (timestamp: Date) => boolean;\n}\n\n// Simulate real-time data generation\nconst generateRealtimeEmotionEntry = (): EmotionEntry => {\n  const emotions = ['happy', 'calm', 'anxious', 'frustrated', 'excited', 'sad'];\n  const triggers = ['noise', 'crowd', 'task', 'transition', 'social'];\n  \n  return {\n    id: `emotion-${Date.now()}-${Math.random()}`,\n    timestamp: new Date(),\n    emotion: emotions[Math.floor(Math.random() * emotions.length)],\n    intensity: Math.floor(Math.random() * 8) + 3, // 3-10\n    triggers: Math.random() > 0.5 \n      ? [triggers[Math.floor(Math.random() * triggers.length)]]\n      : [],\n    notes: ''\n  };\n};\n\nconst generateRealtimeSensoryEntry = (): SensoryEntry => {\n  const sensoryTypes = ['visual', 'auditory', 'tactile', 'vestibular', 'proprioceptive'];\n  const responses = ['seeking', 'avoiding', 'neutral'];\n  \n  return {\n    id: `sensory-${Date.now()}-${Math.random()}`,\n    timestamp: new Date(),\n    sensoryType: sensoryTypes[Math.floor(Math.random() * sensoryTypes.length)],\n    response: responses[Math.floor(Math.random() * responses.length)],\n    intensity: Math.floor(Math.random() * 8) + 3,\n    notes: ''\n  };\n};\n\nconst generateEnvironmentalEntry = (): EnvironmentalEntry => {\n  return {\n    id: `env-${Date.now()}-${Math.random()}`,\n    timestamp: new Date(),\n    location: 'classroom',\n    socialContext: Math.random() > 0.5 ? 'group' : 'individual',\n    roomConditions: {\n      temperature: 20 + Math.floor(Math.random() * 5),\n      humidity: 40 + Math.floor(Math.random() * 20),\n      lighting: Math.random() > 0.5 ? 'bright' : 'dim',\n      noiseLevel: Math.floor(Math.random() * 10)\n    },\n    weather: {\n      condition: ['sunny', 'cloudy', 'rainy'][Math.floor(Math.random() * 3)] as 'sunny' | 'cloudy' | 'rainy',\n      temperature: 15 + Math.floor(Math.random() * 15)\n    },\n    classroom: {\n      activity: ['instruction', 'transition', 'free-time'][Math.floor(Math.random() * 3)] as 'instruction' | 'transition' | 'free-time',\n      studentCount: 15 + Math.floor(Math.random() * 10),\n      timeOfDay: 'morning'\n    }\n  };\n};\n\nconst generateRealtimeTrackingEntry = (): TrackingEntry => {\n  return {\n    id: `tracking-${Date.now()}-${Math.random()}`,\n    studentId: 'current-student',\n    timestamp: new Date(),\n    emotions: [generateRealtimeEmotionEntry()],\n    sensoryInputs: [generateRealtimeSensoryEntry()],\n    environmentalData: generateEnvironmentalEntry(),\n    notes: ''\n  };\n};\n\nexport const useRealtimeData = (\n  initialData: {\n    emotions: EmotionEntry[];\n    sensoryInputs: SensoryEntry[];\n    trackingEntries: TrackingEntry[];\n  },\n  options: RealtimeDataOptions\n): RealtimeDataReturn => {\n  const initialState = useMemo(() => ({\n    emotions: initialData.emotions,\n    sensoryInputs: initialData.sensoryInputs,\n    trackingEntries: initialData.trackingEntries,\n    isLive: false,\n    lastUpdate: null,\n    connectionStatus: 'disconnected' as const,\n    newDataCount: 0,\n  }), [initialData]);\n\n  const [state, dispatch] = useReducer(realtimeDataReducer, initialState);\n\n  const intervalRef = useRef<ReturnType<typeof setInterval> | null>(null);\n  const animationFrameRef = useRef<number | null>(null);\n  const newDataTimestamps = useRef<Set<number>>(new Set());\n\n  // Track which data points are \"live\" (recently added)\n  const liveDataThreshold = 5000; // 5 seconds\n\n  // Filter data based on window size\n  const filteredData = useMemo(() => {\n    if (!options.enabled || options.windowSize === 0) {\n      return state;\n    }\n\n    const cutoffTime = subMinutes(new Date(), options.windowSize);\n\n    return {\n      ...state,\n      emotions: state.emotions.filter(e => e.timestamp >= cutoffTime),\n      sensoryInputs: state.sensoryInputs.filter(s => s.timestamp >= cutoffTime),\n      trackingEntries: state.trackingEntries.filter(t => t.timestamp >= cutoffTime)\n    };\n  }, [state, options.enabled, options.windowSize]);\n\n  // Smooth data insertion with animation frames\n  const smoothInsertData = useCallback((\n    newEmotion?: EmotionEntry,\n    newSensory?: SensoryEntry,\n    newTracking?: TrackingEntry\n  ) => {\n    if (animationFrameRef.current) {\n      cancelAnimationFrame(animationFrameRef.current);\n    }\n\n    const animate = () => {\n      const newTimestamps = new Set(newDataTimestamps.current);\n      newTimestamps.add(new Date().getTime());\n\n      // Clean up old timestamps\n      const cutoff = Date.now() - liveDataThreshold;\n      newTimestamps.forEach(timestamp => {\n        if (timestamp < cutoff) {\n          newTimestamps.delete(timestamp);\n        }\n      });\n      newDataTimestamps.current = newTimestamps;\n\n      dispatch({ type: 'INSERT_DATA', payload: { emotion: newEmotion, sensory: newSensory, tracking: newTracking } });\n    };\n\n    if (options.smoothTransitions) {\n      animationFrameRef.current = requestAnimationFrame(animate);\n    } else {\n      animate();\n    }\n  }, [options.smoothTransitions, liveDataThreshold]);\n\n  // Simulate real-time data stream\n  const simulateDataStream = useCallback(() => {\n    // Randomly generate new data\n    const rand = Math.random();\n    \n    if (rand < 0.4) { // 40% chance of emotion data\n      smoothInsertData(generateRealtimeEmotionEntry(), undefined, undefined);\n    } else if (rand < 0.7) { // 30% chance of sensory data\n      smoothInsertData(undefined, generateRealtimeSensoryEntry(), undefined);\n    } else if (rand < 0.9) { // 20% chance of tracking data\n      smoothInsertData(undefined, undefined, generateRealtimeTrackingEntry());\n    }\n    // 10% chance of no new data this cycle\n  }, [smoothInsertData]);\n\n  // Track connection timeout to ensure proper cleanup\n  const connectionTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  // Start the real-time stream\n  const startStream = useCallback(() => {\n    dispatch({ type: 'START_STREAM' });\n\n    // Clear any existing connection timeout\n    if (connectionTimeoutRef.current) {\n      clearTimeout(connectionTimeoutRef.current);\n      connectionTimeoutRef.current = null;\n    }\n\n    // Simulate connection delay\n    connectionTimeoutRef.current = setTimeout(() => {\n      dispatch({ type: 'SET_CONNECTION_STATUS', payload: 'connected' });\n\n      if (options.simulateData) {\n        // Start simulated data generation\n        if (intervalRef.current) clearInterval(intervalRef.current);\n        intervalRef.current = setInterval(simulateDataStream, options.updateInterval);\n      } else {\n        logger.info('Real-time data connection would be established here');\n      }\n      \n      // Clear the ref once timeout executes\n      connectionTimeoutRef.current = null;\n    }, 1000);\n  }, [options.simulateData, options.updateInterval, simulateDataStream]);\n\n  // Stop the real-time stream\n  const stopStream = useCallback(() => {\n    // Clear connection timeout if it's still pending\n    if (connectionTimeoutRef.current) {\n      clearTimeout(connectionTimeoutRef.current);\n      connectionTimeoutRef.current = null;\n    }\n\n    if (intervalRef.current) {\n      clearInterval(intervalRef.current);\n      intervalRef.current = null;\n    }\n\n    if (animationFrameRef.current) {\n      cancelAnimationFrame(animationFrameRef.current);\n      animationFrameRef.current = null;\n    }\n\n    dispatch({ type: 'STOP_STREAM' });\n\n    // In a real implementation, close WebSocket/SSE connection\n  }, []);\n\n  // Clear new data indicator\n  const clearNewDataIndicator = useCallback(() => {\n    dispatch({ type: 'CLEAR_NEW_DATA_INDICATOR' });\n  }, []);\n\n  // Track historical data timeout to ensure proper cleanup\n  const historicalDataTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  // Get historical data (simulate API call)\n  const getHistoricalData = useCallback((minutes: number) => {\n    dispatch({ type: 'SET_CONNECTION_STATUS', payload: 'connecting' });\n\n    // Clear any existing historical data timeout\n    if (historicalDataTimeoutRef.current) {\n      clearTimeout(historicalDataTimeoutRef.current);\n      historicalDataTimeoutRef.current = null;\n    }\n\n    // Simulate API call delay\n    historicalDataTimeoutRef.current = setTimeout(() => {\n      const now = new Date();\n      const historicalEmotions: EmotionEntry[] = [];\n      const historicalSensory: SensoryEntry[] = [];\n      const historicalTracking: TrackingEntry[] = [];\n\n      // Generate some historical data points\n      for (let i = 0; i < minutes; i += 5) {\n        const timestamp = subMinutes(now, i);\n        \n        if (Math.random() > 0.3) {\n          historicalEmotions.push({\n            ...generateRealtimeEmotionEntry(),\n            timestamp\n          });\n        }\n\n        if (Math.random() > 0.4) {\n          historicalSensory.push({\n            ...generateRealtimeSensoryEntry(),\n            timestamp\n          });\n        }\n\n        if (Math.random() > 0.5) {\n          historicalTracking.push({\n            ...generateRealtimeTrackingEntry(),\n            timestamp\n          });\n        }\n      }\n\n      dispatch({ \n        type: 'SET_HISTORICAL_DATA', \n        payload: { \n          emotions: historicalEmotions.reverse(), \n          sensoryInputs: historicalSensory.reverse(), \n          trackingEntries: historicalTracking.reverse() \n        } \n      });\n      \n      // Clear the ref once timeout executes\n      historicalDataTimeoutRef.current = null;\n    }, 500);\n  }, []);\n\n  // Check if a data point is \"live\" (recently added)\n  const isDataLive = useCallback((timestamp: Date): boolean => {\n    const now = new Date();\n    // Use millisecond difference directly to avoid rounding errors from differenceInMinutes\n    return now.getTime() - new Date(timestamp).getTime() < liveDataThreshold;\n  }, [liveDataThreshold]);\n\n  // Auto-start/stop based on enabled option\n  useEffect(() => {\n    if (options.enabled && !state.isLive) {\n      startStream();\n    } else if (!options.enabled && state.isLive) {\n      stopStream();\n    }\n\n    return () => {\n      // Only stop if currently live; avoid redundant calls after an explicit stop\n      if (state.isLive) {\n        stopStream();\n      }\n    };\n  }, [options.enabled, state.isLive, startStream, stopStream]);\n\n  // Handle connection errors (simulated)\n  useEffect(() => {\n    let reconnectTimeout: ReturnType<typeof setTimeout> | null = null;\n    \n    if (state.connectionStatus === 'connected' && Math.random() < 0.01) { // 1% chance of error\n      dispatch({ type: 'SET_CONNECTION_STATUS', payload: 'error' });\n      \n      // Auto-reconnect after 3 seconds\n      reconnectTimeout = setTimeout(() => {\n        if (state.isLive) {\n          startStream();\n        }\n      }, 3000);\n    }\n\n    return () => {\n      if (reconnectTimeout) {\n        clearTimeout(reconnectTimeout);\n      }\n    };\n  }, [state.connectionStatus, state.isLive, startStream]);\n\n  // Comprehensive cleanup on unmount\n  useEffect(() => {\n    return () => {\n      // Clear all timeouts on unmount\n      if (connectionTimeoutRef.current) {\n        clearTimeout(connectionTimeoutRef.current);\n        connectionTimeoutRef.current = null;\n      }\n      \n      if (historicalDataTimeoutRef.current) {\n        clearTimeout(historicalDataTimeoutRef.current);\n        historicalDataTimeoutRef.current = null;\n      }\n      \n      // Clear intervals\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n        intervalRef.current = null;\n      }\n      \n      // Cancel animation frames\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n        animationFrameRef.current = null;\n      }\n    };\n  }, []); // Empty dependency array ensures this only runs on unmount\n\n  return {\n    ...filteredData,\n    isLive: state.isLive,\n    lastUpdate: state.lastUpdate,\n    connectionStatus: state.connectionStatus,\n    newDataCount: state.newDataCount,\n    startStream,\n    stopStream,\n    clearNewDataIndicator,\n    getHistoricalData,\n    isDataLive\n  };\n};\n\n// Hook for managing real-time updates to visualizations\nexport const useRealtimeVisualization = (\n  data: RealtimeDataReturn,\n  updateInterval: number = 100\n) => {\n  const [animatedData, setAnimatedData] = useState(data);\n  const animationRef = useRef<ReturnType<typeof setInterval> | null>(null);\n\n  useEffect(() => {\n    if (!data.isLive) {\n      setAnimatedData(data);\n      return;\n    }\n\n    // Smooth animation for data updates\n    const animate = () => {\n      setAnimatedData(prev => {\n        // Implement smooth transitions for numerical values\n        const smoothTransition = (current: number, target: number, factor = 0.1) => {\n          return current + (target - current) * factor;\n        };\n\n        // For now, just pass through the data\n        // In a real implementation, you might interpolate positions, sizes, etc.\n        return data;\n      });\n    };\n\n    animationRef.current = setInterval(animate, updateInterval);\n\n    return () => {\n      if (animationRef.current) {\n        clearInterval(animationRef.current);\n      }\n    };\n  }, [data, updateInterval]);\n\n  return animatedData;\n};","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useReducedMotion.ts","messages":[{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":35,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":35,"endColumn":69}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from 'react';\n\n/**\n * Hook to detect if the user prefers reduced motion\n * Checks both the CSS media query and the data-reduce-motion attribute\n * @returns true if reduced motion is preferred, false otherwise\n */\nexport function useReducedMotion(): boolean {\n  const [prefersReducedMotion, setPrefersReducedMotion] = useState(() => {\n    // Check CSS media query\n    const mediaQuery = window.matchMedia?.('(prefers-reduced-motion: reduce)');\n    return mediaQuery?.matches ?? false;\n  });\n\n  useEffect(() => {\n    // Check CSS media query\n    const mediaQuery = window.matchMedia?.('(prefers-reduced-motion: reduce)');\n    \n    const handleMediaQueryChange = (event: MediaQueryListEvent) => {\n      setPrefersReducedMotion(event.matches);\n    };\n\n    // Also check for data-reduce-motion attribute on document element\n    const checkDataAttribute = () => {\n      const hasDataAttribute = document.documentElement.getAttribute('data-reduce-motion') === 'true';\n      if (hasDataAttribute) {\n        setPrefersReducedMotion(true);\n      }\n    };\n\n    // Initial check\n    checkDataAttribute();\n\n    // Set up listeners\n    mediaQuery?.addEventListener?.('change', handleMediaQueryChange);\n    \n    // Watch for changes to the data attribute\n    const observer = new MutationObserver(() => {\n      checkDataAttribute();\n    });\n\n    observer.observe(document.documentElement, {\n      attributes: true,\n      attributeFilter: ['data-reduce-motion']\n    });\n\n    return () => {\n      mediaQuery?.removeEventListener?.('change', handleMediaQueryChange);\n      observer.disconnect();\n    };\n  }, []);\n\n  return prefersReducedMotion;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useRenderProfiler.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mountTime' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":31,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":31,"endColumn":18},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":119,"column":78,"nodeType":"BlockStatement","messageId":"unexpected","endLine":119,"endColumn":80,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3991,3991],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":123,"column":83,"nodeType":"BlockStatement","messageId":"unexpected","endLine":123,"endColumn":85,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4198,4198],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":132,"column":7,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":134,"endColumn":16}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Development utility hook for profiling component render performance\n * Should only be used during development for identifying render hotspots\n */\n\nimport { useRef, useEffect } from 'react';\nimport { logger } from '@/lib/logger';\n\ninterface RenderMetrics {\n  componentName: string;\n  renderCount: number;\n  totalRenderTime: number;\n  averageRenderTime: number;\n  lastRenderTime: number;\n  maxRenderTime: number;\n  minRenderTime: number;\n}\n\nconst renderMetrics = new Map<string, RenderMetrics>();\n\n/**\n * Hook to profile render performance of a component in development\n * @param componentName - Name of the component being profiled\n * @param enabled - Whether profiling is enabled (default: only in development)\n */\nexport function useRenderProfiler(\n  componentName: string, \n  enabled: boolean = process.env.NODE_ENV === 'development'\n) {\n  const renderStartTime = useRef<number>(0);\n  const mountTime = useRef<number>(Date.now());\n\n  // Record start time at the beginning of render\n  if (enabled) {\n    renderStartTime.current = performance.now();\n  }\n\n  useEffect(() => {\n    if (!enabled) return;\n\n    const renderEndTime = performance.now();\n    const renderTime = renderEndTime - renderStartTime.current;\n\n    // Update metrics\n    const existing = renderMetrics.get(componentName);\n    if (existing) {\n      existing.renderCount += 1;\n      existing.totalRenderTime += renderTime;\n      existing.averageRenderTime = existing.totalRenderTime / existing.renderCount;\n      existing.lastRenderTime = renderTime;\n      existing.maxRenderTime = Math.max(existing.maxRenderTime, renderTime);\n      existing.minRenderTime = Math.min(existing.minRenderTime, renderTime);\n    } else {\n      renderMetrics.set(componentName, {\n        componentName,\n        renderCount: 1,\n        totalRenderTime: renderTime,\n        averageRenderTime: renderTime,\n        lastRenderTime: renderTime,\n        maxRenderTime: renderTime,\n        minRenderTime: renderTime,\n      });\n    }\n\n    // Log slow renders in development\n    const SLOW_RENDER_THRESHOLD = 16; // One frame at 60fps\n    if (renderTime > SLOW_RENDER_THRESHOLD) {\n      logger.warn(`[RenderProfiler] Slow render detected in ${componentName}: ${renderTime.toFixed(2)}ms`);\n    }\n  });\n\n  // Development-only: Add debug utilities to window\n  useEffect(() => {\n    if (!enabled || typeof window === 'undefined') return;\n\n    // Add global functions for performance debugging\n    if (!window.__renderProfiler) {\n      window.__renderProfiler = {\n        getMetrics: (componentName?: string) => {\n          if (componentName) {\n            return renderMetrics.get(componentName) || null;\n          }\n          return Array.from(renderMetrics.values());\n        },\n        \n        getRankings: (sortBy: 'total' | 'average' | 'count' = 'average') => {\n          const metrics = Array.from(renderMetrics.values());\n          return metrics.sort((a, b) => {\n            switch (sortBy) {\n              case 'total':\n                return b.totalRenderTime - a.totalRenderTime;\n              case 'count':\n                return b.renderCount - a.renderCount;\n              case 'average':\n              default:\n                return b.averageRenderTime - a.averageRenderTime;\n            }\n          });\n        },\n        \n        getHotspots: (threshold: number = 10) => {\n          return Array.from(renderMetrics.values())\n            .filter(m => m.averageRenderTime > threshold)\n            .sort((a, b) => b.averageRenderTime - a.averageRenderTime);\n        },\n        \n        reset: (componentName?: string) => {\n          if (componentName) {\n            renderMetrics.delete(componentName);\n          } else {\n            renderMetrics.clear();\n          }\n        },\n        \n        logReport: () => {\n          const metrics = Array.from(renderMetrics.values())\n            .sort((a, b) => b.averageRenderTime - a.averageRenderTime);\n          \n          try { logger.info('[RenderProfiler] Report', { metrics }); } catch {}\n          \n          const hotspots = metrics.filter(m => m.averageRenderTime > 10);\n          if (hotspots.length > 0) {\n            try { logger.warn('[RenderProfiler] Hotspots', { hotspots }); } catch {}\n          }\n          \n        }\n      };\n    }\n\n    return () => {\n      // Cleanup on unmount - remove this component's data after a delay\n      setTimeout(() => {\n        renderMetrics.delete(componentName);\n      }, 30000); // Clean up after 30 seconds\n    };\n  }, [componentName, enabled]);\n}\n\n// TypeScript declarations for global debugging utilities\ndeclare global {\n  interface Window {\n    __renderProfiler?: {\n      getMetrics: (componentName?: string) => RenderMetrics | RenderMetrics[] | null;\n      getRankings: (sortBy?: 'total' | 'average' | 'count') => RenderMetrics[];\n      getHotspots: (threshold?: number) => RenderMetrics[];\n      reset: (componentName?: string) => void;\n      logReport: () => void;\n    };\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useReportsWorker.ts","messages":[{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":61,"column":180,"nodeType":"BlockStatement","messageId":"unexpected","endLine":61,"endColumn":182,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2041,2041],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":70,"column":191,"nodeType":"BlockStatement","messageId":"unexpected","endLine":70,"endColumn":193,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2441,2441],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { logger } from '@/lib/logger';\nimport { useEffect, useRef, useCallback } from 'react';\nimport type { ReportsWorkerRequest, ReportsWorkerResponse } from '@/workers/reports.worker';\nimport ReportsWorker from '@/workers/reports.worker?worker';\n\ninterface RunOptions {\n  kind: 'csv' | 'json';\n  students: unknown[];\n  allData: {\n    trackingEntries: unknown[];\n    emotions: unknown[];\n    sensoryInputs: unknown[];\n    goals: unknown[];\n  };\n  options: {\n    includeFields: string[];\n    dateRange?: { start: Date; end: Date } | undefined;\n    anonymize?: boolean;\n  };\n  onProgress?: (p: { progress: number; message?: string }) => void;\n}\n\nexport function useReportsWorker() {\n  const workerRef = useRef<Worker | null>(null);\n  const pendingRef = useRef<\n    Map<\n      string,\n      {\n        resolve: (content: string) => void;\n        reject: (error: Error) => void;\n        onProgress?: (p: { progress: number; message?: string }) => void;\n      }\n    >\n  >(new Map());\n\n  useEffect(() => {\n    const w = new ReportsWorker();\n    const pendingMap = pendingRef.current;\n\n    // Single message handler dispatches to the correct pending promise by id\n    w.onmessage = (evt: MessageEvent<ReportsWorkerResponse>) => {\n      const msg = evt.data;\n      if (!msg) return;\n      const entry = pendingRef.current.get(msg.id);\n      if (!entry) return;\n\n      if (msg.type === 'progress') {\n        entry.onProgress?.({ progress: msg.progress, message: msg.message });\n      } else if (msg.type === 'success') {\n        pendingRef.current.delete(msg.id);\n        entry.resolve(msg.content);\n      } else if (msg.type === 'error') {\n        pendingRef.current.delete(msg.id);\n        entry.reject(new Error(msg.error));\n      }\n    };\n\n    w.onerror = () => {\n      // Reject all pending requests on fatal worker error\n      pendingMap.forEach((entry, id) => {\n        try { entry.reject(new Error('Reports worker error')); } catch (e) { try { logger.warn('[useReportsWorker] Failed to reject promise on worker error', e as Error); } catch {} }\n        pendingMap.delete(id);\n      });\n    };\n\n    workerRef.current = w;\n    return () => {\n      // Reject any still-pending promises to avoid hanging callers\n      pendingMap.forEach((entry, id) => {\n        try { entry.reject(new Error('Reports worker terminated')); } catch (e) { try { logger.warn('[useReportsWorker] Failed to reject promise on worker termination', e as Error); } catch {} }\n        pendingMap.delete(id);\n      });\n      w.terminate();\n      workerRef.current = null;\n    };\n  }, []);\n\n  const run = useCallback(async (opts: RunOptions): Promise<string> => {\n    if (!workerRef.current) throw new Error('Reports worker not initialized');\n    const id = `${Date.now()}_${Math.random().toString(36).slice(2)}`;\n\n    return new Promise<string>((resolve, reject) => {\n      // Register pending handlers\n      pendingRef.current.set(id, {\n        resolve,\n        reject,\n        onProgress: opts.onProgress,\n      });\n\n      const payload: ReportsWorkerRequest = {\n        id,\n        kind: opts.kind,\n        payload: {\n          students: opts.students,\n          allData: opts.allData,\n          options: {\n            format: opts.kind,\n            includeFields: opts.options.includeFields,\n            anonymize: opts.options.anonymize,\n            dateRange: opts.options.dateRange\n              ? {\n                  start: opts.options.dateRange.start.toISOString(),\n                  end: opts.options.dateRange.end.toISOString(),\n                }\n              : null,\n          },\n        },\n      };\n      workerRef.current!.postMessage(payload);\n    });\n  }, []);\n\n  return { run };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useStudentData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useStudentExport.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2559,2562],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2559,2562],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2621,2624],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2621,2624],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2693,2696],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2693,2696],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3008,3011],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3008,3011],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback } from 'react';\nimport { Student, Goal, TrackingEntry, Emotion, SensoryInput } from '@/types/student';\nimport { exportSystem } from '@/lib/exportSystem';\nimport { analyticsExport, type AnalyticsExportData } from '@/lib/analyticsExport';\nimport { downloadBlob } from '@/lib/utils';\nimport { logger } from '@/lib/logger';\nimport { toast } from 'sonner';\n\ninterface ExportOptions {\n  trackingEntries: TrackingEntry[];\n  emotions: Emotion[];\n  sensoryInputs: SensoryInput[];\n  goals: Goal[];\n}\n\n/**\n * @hook useStudentExport\n * @description Provides data export functionality for student profiles\n * \n * Features:\n * - Export to multiple formats (PDF, CSV, JSON)\n * - Full backup creation\n * - Error handling with user feedback\n * - Automatic file naming with timestamps\n * \n * @param student - The student whose data to export\n * @param options - Export options including data to include\n * @returns Export handlers for different formats and backup\n */\nexport function useStudentExport(\n  student: Student | null,\n  options: ExportOptions\n) {\n  /**\n   * Handles export of student data in various formats\n   */\n  const handleExportData = useCallback(async (format: 'pdf' | 'csv' | 'json') => {\n    if (!student) {\n      toast.error('No student data available to export');\n      return;\n    }\n\n    try {\n      const baseFilename = `${student.name.replace(/\\s+/g, '_')}_${new Date().toISOString().split('T')[0]}`;\n      let blob: Blob;\n      let filename: string;\n\n      const exportOptions = {\n        trackingEntries: options.trackingEntries,\n        emotions: options.emotions,\n        sensoryInputs: options.sensoryInputs,\n        goals: options.goals,\n      };\n\n      switch (format) {\n        case 'pdf': {\n          // Consolidated PDF path: delegate to analyticsExport\n          const allDates: Date[] = [\n            ...options.trackingEntries.map(t => t.timestamp as unknown as Date),\n            ...options.emotions.map(e => (e as unknown as { timestamp: Date }).timestamp),\n            ...options.sensoryInputs.map(s => (s as unknown as { timestamp: Date }).timestamp),\n          ];\n          const start = allDates.length ? new Date(Math.min(...allDates.map(d => d.getTime()))) : new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);\n          const end = allDates.length ? new Date(Math.max(...allDates.map(d => d.getTime()))) : new Date();\n\n          const exportData: AnalyticsExportData = {\n            student,\n            dateRange: { start, end },\n            data: {\n              entries: options.trackingEntries as unknown as any[],\n              emotions: options.emotions as unknown as any[],\n              sensoryInputs: options.sensoryInputs as unknown as any[],\n            },\n            analytics: {\n              patterns: [],\n              correlations: [],\n              insights: [],\n              predictiveInsights: [],\n              anomalies: [],\n            },\n          } as unknown as AnalyticsExportData;\n\n          await analyticsExport.exportTo('pdf' as any, exportData);\n          toast.success('Report exported as PDF');\n          logger.info('Data exported', { format, studentId: student.id });\n          return;\n        }\n        case 'csv': {\n          const csvContent = exportSystem.generateCSVExport([student], exportOptions, {\n            format: 'csv',\n            includeFields: ['all'],\n          });\n          blob = new Blob([csvContent], { type: 'text/csv' });\n          filename = `${baseFilename}_data.csv`;\n          break;\n        }\n        case 'json': {\n          const jsonContent = exportSystem.generateJSONExport([student], exportOptions, {\n            format: 'json',\n            includeFields: ['students', 'trackingEntries', 'emotions', 'sensoryInputs', 'goals'],\n          });\n          blob = new Blob([jsonContent], { type: 'application/json' });\n          filename = `${baseFilename}_data.json`;\n          break;\n        }\n      }\n      \n      downloadBlob(blob, filename);\n      toast.success(`Data exported successfully as ${format.toUpperCase()}`);\n      \n      logger.info('Data exported', { format, studentId: student.id });\n    } catch (error: unknown) {\n      logger.error('Export error', { error, format });\n      const errorMessage = error instanceof Error ? error.message : 'Export failed';\n      toast.error(`Export failed: ${errorMessage}`);\n    }\n  }, [student, options]);\n\n  /**\n   * Creates and downloads a full backup of the student's data\n   */\n  const handleBackupData = useCallback(async () => {\n    if (!student) {\n      toast.error('No student data available to backup');\n      return;\n    }\n\n    try {\n      const backup = exportSystem.createFullBackup([student], {\n        trackingEntries: options.trackingEntries,\n        emotions: options.emotions,\n        sensoryInputs: options.sensoryInputs,\n        goals: options.goals,\n      });\n      \n      const backupBlob = new Blob([JSON.stringify(backup, null, 2)], { \n        type: 'application/json' \n      });\n      \n      const filename = `sensory_tracker_backup_${new Date().toISOString().replace(/[:.]/g, '-')}.json`;\n      downloadBlob(backupBlob, filename);\n      \n      toast.success('Backup created successfully');\n      logger.info('Backup created', { studentId: student.id });\n    } catch (error) {\n      logger.error('Backup error', { error });\n      toast.error('Backup failed. Please try again.');\n    }\n  }, [student, options]);\n\n  return {\n    handleExportData,\n    handleBackupData,\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useSyncedTabParam.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useMemo' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":41},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":52,"column":95,"nodeType":"BlockStatement","messageId":"unexpected","endLine":52,"endColumn":97,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2241,2241],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":68,"column":110,"nodeType":"BlockStatement","messageId":"unexpected","endLine":68,"endColumn":112,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2842,2842],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":71,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":71,"endColumn":47},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":85,"column":122,"nodeType":"BlockStatement","messageId":"unexpected","endLine":85,"endColumn":124,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3514,3514],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport type { Dispatch, SetStateAction } from 'react';\nimport type { TabKey } from '@/types/analytics';\nimport { logger } from '@/lib/logger';\n\n\nconst VALID_TABS: ReadonlyArray<TabKey> = ['charts', 'patterns', 'correlations', 'alerts'] as const;\n\nfunction isValidTab(value: string | null | undefined): value is TabKey {\n  if (!value) return false;\n  // Back-compat mapping: legacy \"visualizations\" -> \"charts\"\n  const normalized = value === 'visualizations' ? 'charts' : value;\n  return (VALID_TABS as readonly string[]).includes(normalized);\n}\n\nfunction normalizeTab(value: string | null | undefined): TabKey {\n  if (!value) return 'charts';\n  if (value === 'visualizations') return 'charts';\n  return isValidTab(value) ? (value as TabKey) : 'charts';\n}\n\nexport interface UseSyncedTabParamOptions {\n  // Debounce duration in ms for URL updates\n  debounceMs?: number;\n  // Query parameter key to use. Defaults to 'tab'.\n  paramKey?: string;\n  // Default tab when missing/invalid in URL. Defaults to 'charts'.\n  defaultTab?: TabKey;\n}\n\nexport type UseSyncedTabParamReturn = [TabKey, Dispatch<SetStateAction<TabKey>>];\n\n/**\n * useSyncedTabParam\n * - Reads initial tab from the URL (?tab=...)\n * - Validates against TabKey and falls back to 'charts'\n * - Writes changes to URL using react-router-dom useSearchParams when available,\n *   otherwise falls back to history.replaceState\n * - Debounces writes to avoid spamming history on quick toggles\n * - Keeps state in sync with back/forward navigation via popstate or router updates\n */\nexport function useSyncedTabParam(options: UseSyncedTabParamOptions = {}): UseSyncedTabParamReturn {\n  const { debounceMs = 150, paramKey = 'tab', defaultTab = 'charts' } = options;\n\n  // Read initial value from current URL\n  const getTabFromLocation = useCallback((): TabKey => {\n    try {\n      const params = new URLSearchParams(window.location.search);\n      const urlValue = params.get(paramKey);\n      const normalized = urlValue === 'visualizations' ? 'charts' : urlValue;\n      const tab = normalizeTab(normalized) || defaultTab;\n      try { logger.debug('[useSyncedTabParam] Read tab from URL', { tab, paramKey }); } catch {}\n      return tab;\n    } catch {\n      return defaultTab;\n    }\n  }, [defaultTab, paramKey]);\n\n  const [activeTab, setActiveTab] = useState<TabKey>(() => getTabFromLocation());\n\n\n  // Keep state in sync when user uses back/forward buttons\n  useEffect(() => {\n    // If using router API, react-router will re-render on location changes and this effect\n    // picks up changes by reading window.location, then updates state.\n    const onPop = () => {\n      const next = getTabFromLocation();\n      try { logger.debug('[useSyncedTabParam] popstate -> sync activeTab', { tab: next, paramKey }); } catch {}\n      setActiveTab(next);\n    };\n    window.addEventListener('popstate', onPop);\n    return () => window.removeEventListener('popstate', onPop);\n  }, [getTabFromLocation, paramKey]);\n\n\n  // Debounced URL writer\n  const debounceTimer = useRef<number | undefined>(undefined);\n\nconst writeToUrl = useCallback((nextTab: TabKey) => {\n    const doWrite = () => {\n      try {\n        const url = new URL(window.location.href);\n        url.searchParams.set(paramKey, nextTab);\n        window.history.replaceState(window.history.state, '', url.toString());\n        try { logger.debug('[useSyncedTabParam] URL sync via history.replaceState', { tab: nextTab, paramKey }); } catch {}\n      } catch {\n        // no-op: never throw in URL sync\n      }\n    };\n\n    // Clear previous timer and schedule\n    if (debounceTimer.current) {\n      window.clearTimeout(debounceTimer.current);\n    }\n    debounceTimer.current = window.setTimeout(doWrite, debounceMs);\n  }, [debounceMs, paramKey]);\n\n  // When activeTab changes (from UI), write to URL\n  useEffect(() => {\n    writeToUrl(activeTab);\n  }, [activeTab, writeToUrl]);\n\n  return [activeTab, setActiveTab];\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useTranslation.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":9,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":12,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1048,1051],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1048,1051],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useTranslation as useI18nTranslation } from 'react-i18next';\nimport { useCallback, useMemo } from 'react';\n\nconst namespace = 'translation';\n\n// Define the complete return type interface\ninterface TranslationHookReturn {\n  t: (key: string, options?: Record<string, unknown>) => string;\n  tCommon: (key: string, options?: Record<string, unknown>) => string;\n  tDashboard: (key: string, options?: Record<string, unknown>) => string;\n  tStudent: (key: string, options?: Record<string, unknown>) => string;\n  tTracking: (key: string, options?: Record<string, unknown>) => string;\n  tAnalytics: (key: string, options?: Record<string, unknown>) => string;\n  tSettings: (key: string, options?: Record<string, unknown>) => string;\n  changeLanguage: (lng: 'nb' | 'en') => void;\n  currentLanguage: 'nb' | 'en';\n  formatDate: (date: Date) => string;\n  formatDateTime: (date: Date) => string;\n  formatNumber: (value: number, options?: Intl.NumberFormatOptions) => string;\n  formatCurrency: (value: number, currency?: 'NOK' | 'USD') => string;\n  i18n: any;\n}\n\n// Type-safe translation hook with Norwegian context\nexport const useTranslation = (): TranslationHookReturn => {\n  const { t, i18n } = useI18nTranslation(namespace);\n\n  const changeLanguage = useCallback((lng: 'nb' | 'en') => {\n    i18n.changeLanguage(lng);\n    localStorage.setItem('sensoryTracker_language', lng);\n  }, [i18n]);\n\n  const currentLanguage = (i18n.language as 'nb' | 'en') || 'nb';\n  const locale = currentLanguage === 'nb' ? 'nb-NO' : 'en-US';\n\n  // Helper functions for common translations\n  const tCommon = useCallback((key: string, options?: Record<string, unknown>) => t(key, { ns: 'common', ...options }), [t]);\n  const tDashboard = useCallback((key: string, options?: Record<string, unknown>) => t(key, { ns: 'dashboard', ...options }), [t]);\n  const tStudent = useCallback((key: string, options?: Record<string, unknown>) => t(key, { ns: 'student', ...options }), [t]);\n  const tTracking = useCallback((key: string, options?: Record<string, unknown>) => t(key, { ns: 'tracking', ...options }), [t]);\n  const tAnalytics = useCallback((key: string, options?: Record<string, unknown>) => t(key, { ns: 'analytics', ...options }), [t]);\n  const tSettings = useCallback((key: string, options?: Record<string, unknown>) => t(key, { ns: 'settings', ...options }), [t]);\n\n  // Locale-aware date/time formatting\n  const formatDate = useCallback((date: Date): string => {\n    return new Intl.DateTimeFormat(locale, {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit',\n    }).format(date);\n  }, [locale]);\n\n  const formatDateTime = useCallback((date: Date): string => {\n    return new Intl.DateTimeFormat(locale, {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit',\n      hour: '2-digit',\n      minute: '2-digit',\n    }).format(date);\n  }, [locale]);\n\n  const formatNumber = useCallback((value: number, options?: Intl.NumberFormatOptions): string => {\n    return new Intl.NumberFormat(locale, options).format(value);\n  }, [locale]);\n\n  const formatCurrency = useCallback((value: number, currency: 'NOK' | 'USD' = currentLanguage === 'nb' ? 'NOK' : 'USD'): string => {\n    return new Intl.NumberFormat(locale, { style: 'currency', currency }).format(value);\n  }, [locale, currentLanguage]);\n\n  // Include i18n in deps to ensure fresh reference\n  return useMemo(() => ({\n    t,\n    tCommon,\n    tDashboard,\n    tStudent,\n    tTracking,\n    tAnalytics,\n    tSettings,\n    changeLanguage,\n    currentLanguage,\n    formatDate,\n    formatDateTime,\n    formatNumber,\n    formatCurrency,\n    i18n,\n  }), [t, tCommon, tDashboard, tStudent, tTracking, tAnalytics, tSettings, changeLanguage, currentLanguage, formatDate, formatDateTime, formatNumber, formatCurrency, i18n]);\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/hooks/useVisualizationState.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/i18n/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/i18n/react-i18next.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/DataFilter.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'subDays' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrackingEntry' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":51}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { subDays, startOfDay, addDays } from 'date-fns';\nimport { EmotionEntry, SensoryEntry, TrackingEntry, EnvironmentalEntry } from '@/types/student';\n\nexport interface FilterCriteria {\n  dateRange: { start: Date | null; end: Date | null };\n  emotions: { types: string[]; intensityRange: [number, number]; includeTriggers: string[]; excludeTriggers: string[] };\n  sensory: { types: string[]; responses: string[]; intensityRange: [number, number] };\n  environmental: {\n    locations: string[];\n    activities: string[];\n    conditions: { noiseLevel: [number, number]; temperature: [number, number]; lighting: string[] };\n    weather: string[];\n    timeOfDay: string[];\n  };\n  patterns: { anomaliesOnly: boolean; minConfidence: number; patternTypes: string[] };\n  realtime: boolean;\n}\n\nexport const initialFilterCriteria: FilterCriteria = {\n  dateRange: { start: null, end: null },\n  emotions: { types: [], intensityRange: [0, 10], includeTriggers: [], excludeTriggers: [] },\n  sensory: { types: [], responses: [], intensityRange: [0, 10] },\n  environmental: {\n    locations: [],\n    activities: [],\n    conditions: { noiseLevel: [0, 10], temperature: [15, 30], lighting: [] },\n    weather: [],\n    timeOfDay: []\n  },\n  patterns: { anomaliesOnly: false, minConfidence: 0, patternTypes: [] },\n  realtime: false\n};\n\nexport const applyFilters = <T extends { timestamp: Date }>(\n  data: T[],\n  criteria: FilterCriteria,\n  getEmotionData?: (item: T) => EmotionEntry | null,\n  getSensoryData?: (item: T) => SensoryEntry | null,\n  getEnvironmentalData?: (item: T) => EnvironmentalEntry | null\n): T[] => {\n  return data.filter(item => {\n    // Date range filter\n    if (criteria.dateRange.start || criteria.dateRange.end) {\n      const start = criteria.dateRange.start ? startOfDay(criteria.dateRange.start) : new Date(0);\n      const endExclusive = criteria.dateRange.end ? addDays(startOfDay(criteria.dateRange.end), 1) : new Date(8640000000000000);\n      const ts = item.timestamp;\n      if (!(ts >= start && ts < endExclusive)) return false;\n    }\n\n    // Emotion filters\n    if (getEmotionData) {\n      const emotion = getEmotionData(item);\n      if (emotion) {\n        if (criteria.emotions.types.length > 0 && !criteria.emotions.types.includes(emotion.emotion)) {\n          return false;\n        }\n        if (emotion.intensity < criteria.emotions.intensityRange[0] || emotion.intensity > criteria.emotions.intensityRange[1]) {\n          return false;\n        }\n        if (criteria.emotions.includeTriggers.length > 0 && !emotion.triggers?.some(t => criteria.emotions.includeTriggers.includes(t))) {\n          return false;\n        }\n        if (criteria.emotions.excludeTriggers.length > 0 && emotion.triggers?.some(t => criteria.emotions.excludeTriggers.includes(t))) {\n          return false;\n        }\n      }\n    }\n\n    // Sensory filters\n    if (getSensoryData) {\n      const sensory = getSensoryData(item);\n      if (sensory) {\n        const sensoryType = sensory.sensoryType || sensory.type || '';\n        if (criteria.sensory.types.length > 0 && !criteria.sensory.types.includes(sensoryType)) {\n          return false;\n        }\n        if (criteria.sensory.responses.length > 0 && !criteria.sensory.responses.includes(sensory.response)) {\n          return false;\n        }\n        if (sensory.intensity && (sensory.intensity < criteria.sensory.intensityRange[0] || sensory.intensity > criteria.sensory.intensityRange[1])) {\n          return false;\n        }\n      }\n    }\n\n    // Environmental filters\n    if (getEnvironmentalData) {\n      const env = getEnvironmentalData(item);\n      if (env) {\n        if (criteria.environmental.locations.length > 0 && env.location && !criteria.environmental.locations.includes(env.location)) {\n          return false;\n        }\n        if (criteria.environmental.activities.length > 0 && env.classroom?.activity && !criteria.environmental.activities.includes(env.classroom.activity)) {\n          return false;\n        }\n        if (criteria.environmental.weather.length > 0 && env.weather?.condition && !criteria.environmental.weather.includes(env.weather.condition)) {\n          return false;\n        }\n        if (env.roomConditions?.noiseLevel && (env.roomConditions.noiseLevel < criteria.environmental.conditions.noiseLevel[0] || env.roomConditions.noiseLevel > criteria.environmental.conditions.noiseLevel[1])) {\n          return false;\n        }\n      }\n    }\n\n    return true;\n  });\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/PreprocessingPipeline.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":68,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2391,2394],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2391,2394],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2722,2725],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2722,2725],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":120,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4338,4341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4338,4341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":153,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5319,5322],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5319,5322],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":153,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5351,5354],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5351,5354],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":166,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5902,5905],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5902,5905],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":191,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":191,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6894,6897],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6894,6897],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":227,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":227,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8264,8267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8264,8267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":334,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":334,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12127,12130],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12127,12130],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":335,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":335,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12201,12204],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12201,12204],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":345,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":345,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12622,12625],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12622,12625],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":349,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":349,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12807,12810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12807,12810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":355,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":355,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13038,13041],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13038,13041],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":371,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":371,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13702,13705],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13702,13705],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":375,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":375,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13901,13904],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13901,13904],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":399,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":399,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14675,14678],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14675,14678],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":419,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":419,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15356,15359],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15356,15359],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":420,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":420,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15420,15423],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15420,15423],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":18,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * PreprocessingPipeline: A comprehensive data preprocessing pipeline with versioning and serialization.\n * \n * This class provides a standardized approach to data preprocessing with the following features:\n * - **Configurable Pipeline**: Define preprocessing steps through configuration objects\n * - **Conditional Execution**: Steps can be conditionally executed based on data profiling\n * - **Deterministic Ordering**: Steps are executed in canonical order (cleaning → scaling → encoding → feature engineering)\n * - **Training/Inference Separation**: Fit pipeline on training data, transform on inference data\n * - **Serialization**: Complete pipeline state can be serialized to JSON for reproducibility\n * - **Metadata Tracking**: Comprehensive metadata for debugging and auditing\n * \n * @example\n * ```typescript\n * // Create pipeline configuration\n * const config: AnyStepConfig[] = [\n *   { name: 'clean', kind: 'cleaning', dropAllNullColumns: true },\n *   { name: 'scale', kind: 'scaling', method: 'standard' },\n *   { name: 'encode', kind: 'encoding', oneHotMaxCategories: 10 }\n * ];\n * \n * // Initialize and fit pipeline\n * const pipeline = new PreprocessingPipeline(config);\n * const trainedData = pipeline.fit(trainingData);\n * \n * // Transform new data using fitted pipeline\n * const transformedData = pipeline.transform(newData);\n * \n * // Serialize for storage/sharing\n * const serialized = pipeline.toJSON();\n * const restored = PreprocessingPipeline.fromJSON(serialized);\n * ```\n * \n * @version 1.0.0\n * @since 1.0.0\n */\n\nimport { stableHash } from '@/lib/hash';\nimport {\n  AnyStepConfig,\n  DataProfile,\n  Dataset,\n  FittedStepState,\n  PipelineMetadata,\n  SerializedPipeline,\n  StepKind,\n} from '@/types/preprocessing';\n\nconst PIPELINE_VERSION = '1.0.0';\n\n// Canonical order of step kinds\nconst ORDER: StepKind[] = ['cleaning', 'scaling', 'encoding', 'feature_engineering'];\n\n/** Utility: deep clone plain JSON values */\nfunction deepCloneJSON<T>(v: T): T {\n  return JSON.parse(JSON.stringify(v));\n}\n\n/** Profiling utilities to drive conditional steps */\nfunction inferDataProfile(data: Dataset): DataProfile {\n  const rowCount = data.length;\n  const columns = Array.from(\n    data.reduce<Set<string>>((acc, row) => {\n      Object.keys(row).forEach((k) => acc.add(k));\n      return acc;\n    }, new Set())\n  );\n\n  const inferredTypes: DataProfile['inferredTypes'] = {} as any;\n  const missingRatioByColumn: Record<string, number> = {};\n  const uniqueCountByColumn: Record<string, number> = {};\n\n  const uniques = new Map<string, Set<unknown>>();\n\n  for (const col of columns) {\n    uniques.set(col, new Set());\n  }\n\n  for (const row of data) {\n    for (const col of columns) {\n      const val = (row as any)[col];\n      uniques.get(col)!.add(val);\n    }\n  }\n\n  for (const col of columns) {\n    const uniqueSet = uniques.get(col)!;\n    uniqueCountByColumn[col] = uniqueSet.size;\n\n    let missing = 0;\n    let type: 'number' | 'string' | 'boolean' | 'date' | 'unknown' = 'unknown';\n\n    for (const v of uniqueSet) {\n      if (v === null || v === undefined || v !== v) missing++;\n      const t = typeof v;\n      if (t === 'number') type = 'number';\n      else if (t === 'string') type = type === 'number' ? 'number' : 'string';\n      else if (t === 'boolean') type = type === 'number' ? 'number' : type === 'string' ? 'string' : 'boolean';\n      else if (v instanceof Date) type = 'date';\n    }\n    missingRatioByColumn[col] = rowCount === 0 ? 0 : missing / rowCount;\n    inferredTypes[col] = type;\n  }\n\n  const numericColumns = columns.filter((c) => inferredTypes[c] === 'number');\n  const categoricalColumns = columns.filter((c) => inferredTypes[c] === 'string' || inferredTypes[c] === 'boolean');\n\n  return { rowCount, columns, inferredTypes, missingRatioByColumn, uniqueCountByColumn, numericColumns, categoricalColumns };\n}\n\n/** Simple cleaning: drop all-null columns, trim strings. */\nfunction applyCleaning(dataset: Dataset, cfg: Extract<AnyStepConfig, { kind: 'cleaning' }>): { data: Dataset; state: FittedStepState } {\n  const columns = new Set<string>();\n  dataset.forEach((r) => Object.keys(r).forEach((k) => columns.add(k)));\n\n  const dropCols: string[] = [];\n  if (cfg.dropAllNullColumns) {\n    for (const c of columns) {\n      let allNull = true;\n      for (const row of dataset) {\n        const v = (row as any)[c];\n        if (v !== null && v !== undefined) {\n          allNull = false;\n          break;\n        }\n      }\n      if (allNull) dropCols.push(c);\n    }\n  }\n\n  const out: Dataset = dataset.map((row) => {\n    const nr: Record<string, unknown> = {};\n    for (const [k, v] of Object.entries(row)) {\n      if (dropCols.includes(k)) continue;\n      if (cfg.trimStrings && typeof v === 'string') nr[k] = v.trim();\n      else nr[k] = v;\n    }\n    return nr;\n  });\n\n  return {\n    data: out,\n    state: { name: cfg.name, kind: 'cleaning', params: { dropCols, trimStrings: !!cfg.trimStrings } },\n  };\n}\n\n/** Standard scaling: z = (x - mean) / std for numeric columns. */\nfunction fitScaling(dataset: Dataset, cfg: Extract<AnyStepConfig, { kind: 'scaling' }>, profile: DataProfile) {\n  const means: Record<string, number> = {};\n  const stds: Record<string, number> = {};\n\n  for (const col of profile.numericColumns) {\n    const vals: number[] = dataset\n      .map((r) => (typeof (r as any)[col] === 'number' ? ((r as any)[col] as number) : NaN))\n      .filter((v) => Number.isFinite(v));\n    const mean = vals.length ? vals.reduce((a, b) => a + b, 0) / vals.length : 0;\n    const variance = vals.length ? vals.reduce((a, b) => a + (b - mean) * (b - mean), 0) / vals.length : 0;\n    const std = Math.sqrt(variance) || 1;\n    means[col] = mean;\n    stds[col] = std;\n  }\n\n  const transform = (data: Dataset): Dataset =>\n    data.map((row) => {\n      const out: Record<string, unknown> = { ...row };\n      for (const col of Object.keys(means)) {\n        const v = (row as any)[col];\n        out[col] = typeof v === 'number' ? (v - means[col]) / stds[col] : v;\n      }\n      return out;\n    });\n\n  const state: FittedStepState = { name: cfg.name, kind: 'scaling', params: { means, stds, method: cfg.method ?? 'standard' } };\n  return { transform, state };\n}\n\n/** One-hot encoding for categorical columns with unique count threshold. */\nfunction fitEncoding(dataset: Dataset, cfg: Extract<AnyStepConfig, { kind: 'encoding' }>, profile: DataProfile) {\n  const max = cfg.oneHotMaxCategories ?? 20;\n  const includeBooleans = cfg.includeBooleans ?? true;\n\n  const cats = profile.columns.filter((c) =>\n    (profile.inferredTypes[c] === 'string' || (includeBooleans && profile.inferredTypes[c] === 'boolean')) &&\n    profile.uniqueCountByColumn[c] > 1 &&\n    profile.uniqueCountByColumn[c] <= max\n  );\n\n  const categories: Record<string, string[]> = {};\n  for (const c of cats) {\n    const set = new Set<string>();\n    for (const row of dataset) {\n      const v = (row as any)[c];\n      const key = typeof v === 'string' ? v : typeof v === 'boolean' ? String(v) : String(v ?? '');\n      set.add(key);\n    }\n    categories[c] = Array.from(set.values()).sort();\n  }\n\n  const transform = (data: Dataset): Dataset =>\n    data.map((row) => {\n      const out: Record<string, unknown> = {};\n      for (const [k, v] of Object.entries(row)) {\n        if (!categories[k]) {\n          out[k] = v;\n          continue;\n        }\n        const key = typeof v === 'string' ? v : typeof v === 'boolean' ? String(v) : String(v ?? '');\n        for (const cat of categories[k]) {\n          out[`${k}__${cat}`] = key === cat ? 1 : 0;\n        }\n      }\n      return out;\n    });\n\n  const state: FittedStepState = { name: cfg.name, kind: 'encoding', params: { categories, includeBooleans, oneHotMaxCategories: max } };\n  return { transform, state };\n}\n\n/** Simple feature engineering: squared terms for numeric columns up to degree. */\nfunction fitFeatureEngineering(dataset: Dataset, cfg: Extract<AnyStepConfig, { kind: 'feature_engineering' }>, profile: DataProfile) {\n  const degree = cfg.polynomialDegree ?? 1;\n  const cols = degree >= 2 ? [...profile.numericColumns] : [];\n\n  const transform = (data: Dataset): Dataset =>\n    data.map((row) => {\n      const out: Record<string, unknown> = { ...row };\n      for (const col of cols) {\n        const v = (row as any)[col];\n        if (typeof v === 'number') out[`${col}__squared`] = v * v;\n      }\n      return out;\n    });\n\n  const state: FittedStepState = { name: cfg.name, kind: 'feature_engineering', params: { degree, columns: cols } };\n  return { transform, state };\n}\n\n/** Determine if a config should run given profile. */\nfunction shouldRun(cfg: AnyStepConfig, profile: DataProfile): boolean {\n  if (cfg.enabled === false) return false;\n  if (cfg.when) return !!cfg.when(profile);\n  return true;\n}\n\n/** Sort steps by canonical ordering, preserving relative order within the same kind. */\nfunction sortSteps(configs: AnyStepConfig[]): AnyStepConfig[] {\n  return [...configs].sort((a, b) => ORDER.indexOf(a.kind) - ORDER.indexOf(b.kind));\n}\n\nexport class PreprocessingPipeline {\n  private readonly version = PIPELINE_VERSION;\n  private readonly config: AnyStepConfig[];\n  private fittedStates: FittedStepState[] = [];\n  private metadata?: PipelineMetadata;\n\n  constructor(config: AnyStepConfig[]) {\n    this.config = sortSteps(config);\n  }\n\n  getMetadata(): PipelineMetadata | undefined {\n    return this.metadata ? deepCloneJSON(this.metadata) : undefined;\n  }\n\n  /**\n   * Fits the pipeline on a training dataset.\n   * - Profiles the data to determine which conditional steps to run.\n   * - Fits each applicable step (e.g., calculates means/stds for scaling).\n   * - Stores the fitted state for each step.\n   * - Generates and stores metadata about the fitting process.\n   * \n   * @param data The training dataset, an array of records.\n   * @param options Optional parameters for the fitting process.\n   * @param options.notes Optional user-defined notes to store in the metadata.\n   * @returns The transformed dataset after applying all fitted steps.\n   */\n  fit(data: Dataset, options?: { notes?: string }): Dataset {\n    const source = deepCloneJSON(data);\n    const profile = inferDataProfile(source);\n\n    // build metadata\n    const configHash = stableHash(this.config.map((c) => ({ ...c, when: undefined })));\n    this.metadata = {\n      createdAt: new Date().toISOString(),\n      pipelineVersion: this.version,\n      configHash,\n      dataSchema: { columns: profile.columns, inferredTypes: profile.inferredTypes },\n      notes: options?.notes,\n    };\n\n    this.fittedStates = [];\n\n    let current = source;\n\n    for (const cfg of this.config) {\n      if (!shouldRun(cfg, profile)) continue;\n      if (cfg.kind === 'cleaning') {\n        const { data: d, state } = applyCleaning(current, cfg);\n        current = d;\n        this.fittedStates.push(state);\n      } else if (cfg.kind === 'scaling') {\n        const { transform, state } = fitScaling(current, cfg, profile);\n        current = transform(current);\n        this.fittedStates.push(state);\n      } else if (cfg.kind === 'encoding') {\n        const { transform, state } = fitEncoding(current, cfg, profile);\n        current = transform(current);\n        this.fittedStates.push(state);\n      } else if (cfg.kind === 'feature_engineering') {\n        const { transform, state } = fitFeatureEngineering(current, cfg, profile);\n        current = transform(current);\n        this.fittedStates.push(state);\n      }\n    }\n\n    return current;\n  }\n\n  /**\n   * Transforms a dataset using the previously fitted pipeline states.\n   * \n   * This method is intended for inference, applying the exact transformations\n   * learned during the `fit` phase without re-learning any parameters.\n   * \n   * @param data The dataset to transform.\n   * @returns The transformed dataset.\n   * @throws Will not throw, but returns data as-is if the pipeline has not been fitted.\n   */\n  transform(data: Dataset): Dataset {\n    if (!this.fittedStates.length) return data;\n\n    let current = deepCloneJSON(data);\n\n    for (const state of this.fittedStates) {\n      if (state.kind === 'cleaning') {\n        const drop = (state.params as any).dropCols as string[];\n        const trimStrings = !!(state.params as any).trimStrings;\n        current = current.map((row) => {\n          const out: Record<string, unknown> = {};\n          for (const [k, v] of Object.entries(row)) {\n            if (drop.includes(k)) continue;\n            out[k] = trimStrings && typeof v === 'string' ? v.trim() : v;\n          }\n          return out;\n        });\n      } else if (state.kind === 'scaling') {\n        const { means, stds } = state.params as any;\n        current = current.map((row) => {\n          const out: Record<string, unknown> = { ...row };\n          for (const col of Object.keys(means)) {\n            const v = (row as any)[col];\n            out[col] = typeof v === 'number' ? (v - means[col]) / stds[col] : v;\n          }\n          return out;\n        });\n      } else if (state.kind === 'encoding') {\n        const { categories } = state.params as any as { categories: Record<string, string[]> };\n        current = current.map((row) => {\n          const out: Record<string, unknown> = {};\n          for (const [k, v] of Object.entries(row)) {\n            if (!categories[k]) {\n              out[k] = v;\n              continue;\n            }\n            const key = typeof v === 'string' ? v : typeof v === 'boolean' ? String(v) : String(v ?? '');\n            for (const cat of categories[k]) {\n              out[`${k}__${cat}`] = key === cat ? 1 : 0;\n            }\n          }\n          return out;\n        });\n      } else if (state.kind === 'feature_engineering') {\n        const { columns } = state.params as any as { columns: string[] };\n        current = current.map((row) => {\n          const out: Record<string, unknown> = { ...row };\n          for (const col of columns) {\n            const v = (row as any)[col];\n            if (typeof v === 'number') out[`${col}__squared`] = v * v;\n          }\n          return out;\n        });\n      }\n    }\n\n    return current;\n  }\n\n  /**\n   * Serializes the entire pipeline state to a JSON object.\n   * This includes the configuration, all fitted step parameters, and metadata.\n   * \n   * @returns A `SerializedPipeline` object ready for JSON stringification.\n   */\n  toJSON(): SerializedPipeline {\n    if (!this.metadata) {\n      // Ensure metadata exists even if only transform was used\n      this.metadata = {\n        createdAt: new Date().toISOString(),\n        pipelineVersion: this.version,\n        configHash: stableHash(this.config.map((c) => ({ ...c, when: undefined }))),\n        dataSchema: { columns: [], inferredTypes: {} as any },\n      } as PipelineMetadata;\n    }\n    return {\n      version: this.version,\n      config: deepCloneJSON(this.config),\n      fitted: deepCloneJSON(this.fittedStates),\n      metadata: deepCloneJSON(this.metadata),\n    };\n  }\n\n  /**\n   * Recreates a `PreprocessingPipeline` instance from a serialized state.\n   * This allows for perfect reconstruction of a fitted pipeline for later use.\n   * \n   * @param payload The `SerializedPipeline` object.\n   * @returns A new `PreprocessingPipeline` instance with its state restored.\n   */\n  static fromJSON(payload: SerializedPipeline): PreprocessingPipeline {\n    const pipe = new PreprocessingPipeline(payload.config);\n    (pipe as any).fittedStates = deepCloneJSON(payload.fitted);\n    (pipe as any).metadata = deepCloneJSON(payload.metadata);\n    return pipe;\n  }\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/__tests__/analytics-behavior.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SensoryEntry' is defined but never used. Allowed unused vars must match /^_/u.","line":26,"column":29,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1629,1632],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1629,1632],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1714,1717],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1714,1717],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2108,2111],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2108,2111],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2195,2198],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2195,2198],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":187,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":190,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3401,3404],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3401,3404],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":229,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":232,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6242,6245],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6242,6245],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":201,"column":145,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":201,"endColumn":148,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10241,10244],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10241,10244],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":216,"column":230,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":233,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11431,11434],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11431,11434],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":222,"column":230,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":222,"endColumn":233,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12038,12041],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12038,12041],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'posOnlyJoy' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":259,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":259,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'noop' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":276,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":276,"endColumn":11},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":280,"column":52,"nodeType":"BlockStatement","messageId":"unexpected","endLine":280,"endColumn":54,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[14983,14983],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":403,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":403,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19639,19642],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19639,19642],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":414,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":414,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19892,19895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19892,19895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Analytics behavioral tests:\n * - Cache-key sensitivity to configuration changes for CachedPatternAnalysisEngine\n * - Worker cache TTL parity with AnalyticsConfiguration\n * - Date boundary filtering correctness using [start, end) semantics\n *\n * Runner: Vitest\n */\n\nimport { describe, it, expect, beforeEach, vi, beforeAll, afterEach } from 'vitest';\n\n// Prevent ML models from initializing IndexedDB in Node tests\nvi.mock('@/lib/mlModels', () => ({\n  mlModels: {\n    init: vi.fn().mockResolvedValue(undefined),\n    getModelStatus: vi.fn().mockResolvedValue(new Map()),\n    predictEmotions: vi.fn().mockResolvedValue([]),\n    predictSensoryResponse: vi.fn().mockResolvedValue(null),\n  }\n}));\n\nimport { analyticsConfig } from '@/lib/analyticsConfig';\nimport { createCachedPatternAnalysis } from '@/lib/cachedPatternAnalysis';\nimport { enhancedPatternAnalysis } from '@/lib/enhancedPatternAnalysis';\nimport { mlModels } from '@/lib/mlModels';\nimport type { EmotionEntry, SensoryEntry, TrackingEntry } from '@/types/student';\nimport { startOfDay, addDays, subDays } from 'date-fns';\n\n// Prevent ML models from initializing IndexedDB in Node tests\nvi.mock('@/lib/mlModels', () => ({\n  mlModels: {\n    init: vi.fn().mockResolvedValue(undefined),\n    getModelStatus: vi.fn().mockResolvedValue(new Map()),\n    predictEmotions: vi.fn().mockResolvedValue([]),\n    predictSensoryResponse: vi.fn().mockResolvedValue(null),\n  }\n}));\n\n/**\n * Polyfill minimal localStorage/sessionStorage for Node test environment.\n * Avoids pulling full jsdom; sufficient for modules that touch localStorage.\n */\nbeforeAll(() => {\n  if (!(globalThis as any).localStorage) {\n    const store = new Map<string, string>();\n    (globalThis as any).localStorage = {\n      getItem: (k: string) => (store.has(k) ? store.get(k)! : null),\n      setItem: (k: string, v: string) => { store.set(k, String(v)); },\n      removeItem: (k: string) => { store.delete(k); },\n      clear: () => { store.clear(); },\n      key: (i: number) => Array.from(store.keys())[i] ?? null,\n      get length() { return store.size; }\n    };\n  }\n  if (!(globalThis as any).sessionStorage) {\n    const store = new Map<string, string>();\n    (globalThis as any).sessionStorage = {\n      getItem: (k: string) => (store.has(k) ? store.get(k)! : null),\n      setItem: (k: string, v: string) => { store.set(k, String(v)); },\n      removeItem: (k: string) => { store.delete(k); },\n      clear: () => { store.clear(); },\n      key: (i: number) => Array.from(store.keys())[i] ?? null,\n      get length() { return store.size; }\n    };\n  }\n});\n\n// -----------------------------------------------------------------------------\n// Confidence explanation behavior\n// -----------------------------------------------------------------------------\n\ndescribe('Confidence explanation responds to config updates', () => {\n  it('toggles insufficientData factor when enhancedAnalysis.minSampleSize changes', () => {\n    // Baseline: minSampleSize = 5 (default)\n    let explanation = enhancedPatternAnalysis.generateConfidenceExplanation(3, 10, 0.3, 0.2);\n    expect(explanation.factors.some(f => f.startsWith('insufficientData:'))).toBe(true);\n\n    // Lower requirement -> sufficientData expected\n    analyticsConfig.updateConfig({ enhancedAnalysis: { minSampleSize: 2, trendThreshold: 0.05, anomalyThreshold: 1.5, predictionConfidenceThreshold: 0.6, riskAssessmentThreshold: 3 } as any });\n    explanation = enhancedPatternAnalysis.generateConfidenceExplanation(3, 10, 0.3, 0.2);\n    expect(explanation.factors.some(f => f.startsWith('sufficientData:'))).toBe(true);\n  });\n\n  it('reflects timeSpanQuality and labels based on shortTermDays and defaultAnalysisDays', () => {\n    // Use timeSpanDays shorter than shortTermDays\n    analyticsConfig.updateConfig({ timeWindows: { defaultAnalysisDays: 30, recentDataDays: 7, shortTermDays: 14, longTermDays: 90 } });\n    let explanation = enhancedPatternAnalysis.generateConfidenceExplanation(10, 7, 0.5, 0.4);\n    expect(explanation.factors).toContain('shortTimespan:7:30');\n\n    // Make shortTermDays smaller so same 7 days becomes adequate\n    analyticsConfig.updateConfig({ timeWindows: { defaultAnalysisDays: 21, recentDataDays: 7, shortTermDays: 5, longTermDays: 90 } });\n    explanation = enhancedPatternAnalysis.generateConfidenceExplanation(10, 7, 0.5, 0.4);\n    expect(explanation.factors).toContain('adequateTimespan:7:21');\n  });\n});\n\n// -----------------------------------------------------------------------------\n// Correlation significance tiers respond to correlationThreshold\n// -----------------------------------------------------------------------------\n\ndescribe('Correlation significance tiers update with patternAnalysis.correlationThreshold', () => {\n  function makeTracking(n = 12, noiseScale = 5, base = 0): TrackingEntry[] {\n    const entries: TrackingEntry[] = [];\n    const start = new Date();\n    for (let i = 0; i < n; i++) {\n      const noise = base + i * noiseScale; // monotonic increasing\n      const emoIntensity = Math.min(5, 1 + (i / (n - 1)) * 4); // scaled 1..5 increasing\n      entries.push({\n        id: `t${i}`,\n        studentId: 's1',\n        timestamp: new Date(start.getTime() - (n - i) * 3600_000),\n        emotions: [\n          { id: `e${i}`, studentId: 's1', emotion: i % 3 === 0 ? 'happy' : 'sad', intensity: emoIntensity, timestamp: new Date(), triggers: [] }\n        ],\n        sensoryInputs: [],\n        activities: [],\n        environmentalData: { roomConditions: { noiseLevel: noise, temperature: 20 + (i % 3), lighting: 'bright' } }\n      } as unknown as TrackingEntry);\n    }\n    return entries;\n  }\n\n  it('significantPairs and tiers shift with base threshold', () => {\n    const entries = makeTracking(16);\n\n    // Baseline threshold (default 0.25)\n    let matrix = enhancedPatternAnalysis.generateCorrelationMatrix(entries);\n    const havePairsDefault = matrix.significantPairs.length > 0;\n    expect(havePairsDefault).toBe(true);\n\n    // Raise threshold -> fewer pairs, more labeled as low\n    analyticsConfig.updateConfig({ patternAnalysis: { correlationThreshold: 0.6, minDataPoints: 3, highIntensityThreshold: 4, concernFrequencyThreshold: 0.3, emotionConsistencyThreshold: 0.4, moderateNegativeThreshold: 0.4 } as any });\n    matrix = enhancedPatternAnalysis.generateCorrelationMatrix(entries);\n    // All pairs must obey new base >= 0.6\n    expect(matrix.significantPairs.every(p => Math.abs(p.correlation) >= 0.6)).toBe(true);\n    // Tiers use base+0.2, base+0.4\n    const hasModerate = matrix.significantPairs.some(p => p.significance === 'moderate');\n    const hasHigh = matrix.significantPairs.some(p => p.significance === 'high');\n    expect(hasModerate || hasHigh).toBe(true);\n  });\n});\n\n// -----------------------------------------------------------------------------\n// Anomaly detection respects anomalyThreshold and anomalyMultiplier\n// -----------------------------------------------------------------------------\n\ndescribe('Anomaly detection thresholding and severity buckets', () => {\n  function makeEmotions(): EmotionEntry[] {\n    const res: EmotionEntry[] = [];\n    const now = new Date();\n    // Centered around intensity ~3 with some spread\n    for (let i = 0; i < 30; i++) {\n      res.push({ id: `e${i}`, studentId: 's1', emotion: 'anxious', intensity: 2 + (i % 3), timestamp: new Date(now.getTime() - i * 3600_000), triggers: [] });\n    }\n    // Add a couple of spikes to create z-scores beyond thresholds\n    res.push({ id: 'spike1', studentId: 's1', emotion: 'anxious', intensity: 5, timestamp: now, triggers: [] });\n    res.push({ id: 'spike2', studentId: 's1', emotion: 'anxious', intensity: 1, timestamp: now, triggers: [] });\n    return res;\n  }\n\n  it('anomaly counts decrease when thresholds increase and severity uses +0.5/+1.5 rule', () => {\n    const emotions = makeEmotions();\n\n    // Low threshold -> more anomalies\n    analyticsConfig.updateConfig({ enhancedAnalysis: { anomalyThreshold: 1.0, minSampleSize: 5, trendThreshold: 0.05, predictionConfidenceThreshold: 0.6, riskAssessmentThreshold: 3 }, alertSensitivity: { level: 'medium', emotionIntensityMultiplier: 1.0, frequencyMultiplier: 1.0, anomalyMultiplier: 1.0 } });\n    let anomalies = enhancedPatternAnalysis.detectAnomalies(emotions, [], []);\n    const countLow = anomalies.filter(a => a.type === 'emotion').length;\n    expect(countLow).toBeGreaterThan(0);\n\n    // Capture severity buckets at low threshold\n    const bucketsLow = {\n      low: anomalies.filter(a => a.severity === 'low').length,\n      medium: anomalies.filter(a => a.severity === 'medium').length,\n      high: anomalies.filter(a => a.severity === 'high').length,\n    };\n\n    // Increase threshold and multiplier -> fewer anomalies and severity cutpoints shift up\n    analyticsConfig.updateConfig({ enhancedAnalysis: { anomalyThreshold: 2.0 }, alertSensitivity: { level: 'high', emotionIntensityMultiplier: 1.0, frequencyMultiplier: 1.0, anomalyMultiplier: 1.5 } });\n    anomalies = enhancedPatternAnalysis.detectAnomalies(emotions, [], []);\n    const countHigh = anomalies.filter(a => a.type === 'emotion').length;\n    expect(countHigh).toBeLessThanOrEqual(countLow);\n\n    // With higher base and +1.5 shift, high severity should be rarer or equal\n    const bucketsHigh = {\n      low: anomalies.filter(a => a.severity === 'low').length,\n      medium: anomalies.filter(a => a.severity === 'medium').length,\n      high: anomalies.filter(a => a.severity === 'high').length,\n    };\n    expect(bucketsHigh.high).toBeLessThanOrEqual(bucketsLow.high);\n  });\n});\n\n// -----------------------------------------------------------------------------\n// Predictive mapping responds to highIntensityThreshold\n// -----------------------------------------------------------------------------\n\ndescribe('Predictive mapping severity changes with highIntensityThreshold', () => {\n  it('maps severity using highIntensityThreshold and derived medium cut', async () => {\n    // Arrange ML mocks to enable ML path\n    const statusSpy = vi.spyOn(mlModels, 'getModelStatus').mockResolvedValue(new Map([['emotion-prediction', true]]));\n    const mkPred = (val: number) => [{ timestamp: new Date(), emotions: { happy: val, calm: val, sad: val, anxious: val }, confidence: 0.9 } as any];\n    const predsSpy = vi.spyOn(mlModels, 'predictEmotions').mockImplementation(async () => mkPred(4));\n\n    // Data for currentAvgIntensity baseline\n    const now = new Date();\n    const emotions: EmotionEntry[] = [\n      { id: 'e1', studentId: 's1', emotion: 'happy', intensity: 3, timestamp: subDays(now, 1), triggers: [] },\n      { id: 'e2', studentId: 's1', emotion: 'sad', intensity: 3, timestamp: subDays(now, 2), triggers: [] },\n      { id: 'e3', studentId: 's1', emotion: 'calm', intensity: 3, timestamp: subDays(now, 3), triggers: [] },\n    ];\n    const entries: TrackingEntry[] = new Array(14).fill(0).map((_, i) => ({\n      id: `t${i}`, studentId: 's1', timestamp: subDays(now, 14 - i), emotions: emotions, sensoryInputs: [], activities: [], environmentalData: { roomConditions: { lighting: 'bright', noiseLevel: 40, temperature: 22 } }\n    } as unknown as TrackingEntry));\n\n    // highIntensityThreshold = 4 -> predicted avg 4 should be 'high'\n    analyticsConfig.updateConfig({ patternAnalysis: { highIntensityThreshold: 4, minDataPoints: 3, correlationThreshold: 0.25, concernFrequencyThreshold: 0.3, emotionConsistencyThreshold: 0.4, moderateNegativeThreshold: 0.4 } as any });\n    let insights = await enhancedPatternAnalysis.generatePredictiveInsights(emotions, [], entries);\n    const mlInsight1 = insights.find(i => i.source === 'ml' && i.type === 'prediction');\n    expect(mlInsight1?.severity).toBe('high');\n\n    // Raise threshold to 5 -> same predicted avg 4 should now be 'low' (since 4 <= highT-2 => mediumCut, but 5-2=3, 4 > 3 so 'low')\n    analyticsConfig.updateConfig({ patternAnalysis: { highIntensityThreshold: 5, minDataPoints: 3, correlationThreshold: 0.25, concernFrequencyThreshold: 0.3, emotionConsistencyThreshold: 0.4, moderateNegativeThreshold: 0.4 } as any });\n    insights = await enhancedPatternAnalysis.generatePredictiveInsights(emotions, [], entries);\n    const mlInsight2 = insights.find(i => i.source === 'ml' && i.type === 'prediction');\n    expect(mlInsight2?.severity).toBe('low');\n\n    statusSpy.mockRestore();\n    predsSpy.mockRestore();\n  });\n});\n\n// -----------------------------------------------------------------------------\n// Taxonomy-driven positiveEmotionRatio\n// -----------------------------------------------------------------------------\n\ndescribe('Taxonomy.positiveEmotions affects positiveEmotionRatio computations', () => {\n  function makeEntry(emotions: Array<[string, number]>, lighting: string = 'bright'): TrackingEntry {\n    return {\n      id: 'tX', studentId: 's1', timestamp: new Date(),\n      emotions: emotions.map(([_e, intensity], idx) => ({ id: `e${idx}`, studentId: 's1', emotion: _e, intensity, timestamp: new Date(), triggers: [] })),\n      sensoryInputs: [], activities: [], environmentalData: { roomConditions: { lighting, noiseLevel: 30, temperature: 22 } }\n    } as unknown as TrackingEntry;\n  }\n\n  it('uses provided positiveEmotions list to compute ratios', () => {\n    const entries = [\n      makeEntry([['joyful', 4], ['content', 3]]),\n      makeEntry([['happy', 4], ['calm', 2]]),\n    ];\n\n    // Set taxonomy to only include joyful as positive\n    analyticsConfig.updateConfig({ taxonomy: { positiveEmotions: ['joyful'] } });\n    let matrix = enhancedPatternAnalysis.generateCorrelationMatrix(entries);\n    const idxPos = matrix.factors.indexOf('positiveEmotionRatio');\n    expect(idxPos).toBeGreaterThanOrEqual(0);\n\n    // Compute expected ratio for first entry: 1/2; second: 0/2 -> average depends on correlation use, but we can validate via recompute\n    // Instead, validate that the set of positives used excludes 'happy'/'calm'\n    const posOnlyJoy = matrix.significantPairs.find(p => ['positiveEmotionRatio'].includes(p.factor1) || ['positiveEmotionRatio'].includes(p.factor2));\n    // We can't guarantee significance here; so directly compute ratios by mimicking engine's logic\n    const positiveSet = new Set(['joyful']);\n    const ratios = entries.map(e => e.emotions.filter(em => positiveSet.has(em.emotion.toLowerCase())).length / e.emotions.length);\n    expect(ratios[0]).toBeCloseTo(0.5, 5);\n    expect(ratios[1]).toBe(0);\n\n    // Now change taxonomy to include happy and calm\n    analyticsConfig.updateConfig({ taxonomy: { positiveEmotions: ['happy', 'calm'] } });\n    matrix = enhancedPatternAnalysis.generateCorrelationMatrix(entries);\n    const ratios2 = entries.map(e => e.emotions.filter(em => new Set(['happy','calm']).has(em.emotion.toLowerCase())).length / e.emotions.length);\n    expect(ratios2[0]).toBe(0);\n    expect(ratios2[1]).toBe(1);\n  });\n});\n\n// Utilities\nconst noop = () => {};\n\n// Restore config to defaults after each test to prevent leakage\nafterEach(() => {\n  try { analyticsConfig.resetToDefaults(); } catch {}\n});\n\n/**\n * Minimal in-memory cache implementing CacheStorage for tests\n * Supports TTL-like expiration via a toggleable \"now\" time\n */\nclass TestCache implements Required<{\n  get(key: string): unknown | undefined;\n  set(key: string, value: unknown, tags?: string[]): void;\n  has(key: string): boolean;\n  invalidateByTag(tag: string): number;\n  getDataFingerprint(data: unknown): string;\n  createKey(prefix: string, params: Record<string, unknown>): string;\n}> {\n  private map = new Map<string, { data: unknown; tags?: string[] }>();\n\n  get(key: string): unknown | undefined {\n    return this.map.get(key)?.data;\n  }\n  set(key: string, value: unknown, tags?: string[]): void {\n    this.map.set(key, { data: value, tags });\n  }\n  has(key: string): boolean {\n    return this.map.has(key);\n  }\n  invalidateByTag(tag: string): number {\n    let count = 0;\n    for (const [k, v] of this.map.entries()) {\n      if (v.tags?.includes(tag)) {\n        this.map.delete(k);\n        count++;\n      }\n    }\n    return count;\n  }\n  getDataFingerprint(data: unknown): string {\n    const stringify = (obj: unknown): string => {\n      if (obj === null || obj === undefined) return 'null';\n      if (typeof obj !== 'object') return String(obj);\n      if (Array.isArray(obj)) return `[${obj.map(stringify).join(',')}]`;\n      const keys = Object.keys(obj as Record<string, unknown>).sort();\n      return `{${keys.map(k => `${k}:${stringify((obj as Record<string, unknown>)[k])}`).join(',')}}`;\n    };\n    const str = stringify(data);\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n      const char = str.charCodeAt(i);\n      hash = ((hash << 5) - hash) + char;\n      hash |= 0;\n    }\n    return Math.abs(hash).toString(36);\n  }\n  createKey(prefix: string, params: Record<string, unknown>): string {\n    const sorted = Object.keys(params).sort()\n      .map(k => `${k}:${JSON.stringify(params[k])}`).join(':');\n    return `${prefix}:${sorted}`;\n  }\n}\n\ndescribe('CachedPatternAnalysisEngine cache-key sensitivity', () => {\n  let cache: TestCache;\n\n  beforeEach(() => {\n    cache = new TestCache();\n  });\n\n  it('produces distinct cache keys/results when relevant config changes', () => {\n    // Arrange default config baseline\n    const initialCfg = analyticsConfig.getConfig();\n    const engine = createCachedPatternAnalysis(cache);\n\n    const now = new Date();\n    const emotions: EmotionEntry[] = [\n      { id: 'e1', studentId: 's1', emotion: 'happy', intensity: 3, timestamp: now, triggers: ['noise'] },\n      { id: 'e2', studentId: 's1', emotion: 'anxious', intensity: 4, timestamp: now, triggers: ['change'] }\n    ];\n\n    // Act: first computation caches under current configHash\n    const first = engine.analyzeEmotionPatterns(emotions, 30);\n    expect(first).toBeDefined();\n\n    // Mutate relevant config subset (e.g., alert sensitivity)\n    analyticsConfig.updateConfig({\n      alertSensitivity: {\n        low: 0.2,\n        medium: 0.5,\n        high: 0.85 // change high threshold to alter analysis behavior\n      }\n    });\n\n    // Second call after config update should miss cache due to configHash change\n    const second = engine.analyzeEmotionPatterns(emotions, 30);\n    // Cannot easily inspect keys, but we can assert not the same reference and cache has at least two entries under tags\n    expect(second).toBeDefined();\n    // Since implementation returns new arrays, assert content differences not required; the key sensitivity is the target.\n    // As a proxy, force invalidate by tag and ensure at least 2 invalidations occur across both runs.\n    const invalidated = engine.invalidateAllCache();\n    expect(invalidated).toBeGreaterThanOrEqual(1);\n    // Different references indicate a fresh computation (not served from stale cache)\n    expect(second).not.toBe(first);\n\n    // Cleanup\n    engine.destroy();\n    // Restore config\n    analyticsConfig.updateConfig(initialCfg);\n  });\n});\n\ndescribe('Worker cache TTL parity (simulated)', () => {\n  /**\n   * We simulate worker TTL usage by verifying that cached pattern analysis inside the worker\n   * honors the provided config TTL pathway. Since we cannot spin a real worker here,\n   * we validate that:\n   * - TTL from analyticsConfig is respected by CachedPatternAnalysisEngine constructor path\n   * - And that updates propagate through subscribe mechanism\n   */\n  it('updates internal TTL when analytics configuration changes', () => {\n    const cache = new TestCache();\n    const engine = createCachedPatternAnalysis(cache);\n\n    const initialTTL = analyticsConfig.getConfig().cache.ttl;\n    // @ts-expect-no-error - access private via any for test validation\n    const ttlBefore = (engine as any).ttl;\n    expect(ttlBefore).toBe(initialTTL);\n\n    // Update config TTL\n    analyticsConfig.updateConfig({\n      cache: {\n        ...analyticsConfig.getConfig().cache,\n        ttl: initialTTL + 12345\n      }\n    });\n\n    const ttlAfter = (engine as any).ttl;\n    expect(ttlAfter).toBe(initialTTL + 12345);\n\n    engine.destroy();\n  });\n});\n\ndescribe('Date boundary filtering [start, end) correctness', () => {\n  /**\n   * This test verifies the logic used in AdvancedFilterPanel applyFilters by reproducing\n   * the [start, end) condition with startOfDay and addDays, ensuring that an event\n   * exactly at the end boundary is excluded.\n   */\n  it('includes timestamps on or after start and strictly before endExclusive', () => {\n    const start = startOfDay(new Date('2025-07-15T10:20:00.000Z'));\n    const endExclusive = addDays(startOfDay(new Date('2025-07-16T12:00:00.000Z')), 1); // effectively 2025-07-17T00:00Z\n\n    const a = new Date(start.getTime()); // exactly start\n    const b = new Date(endExclusive.getTime() - 1); // just before end\n    const c = new Date(endExclusive.getTime()); // exactly end (should be excluded)\n\n    const inRange = (ts: Date) => ts >= start && ts < endExclusive;\n\n    expect(inRange(a)).toBe(true);\n    expect(inRange(b)).toBe(true);\n    expect(inRange(c)).toBe(false);\n  });\n});\n\ndescribe('Negative cases and error tolerance', () => {\n  it('handles empty datasets without exceptions', () => {\n    const cache = new TestCache();\n    const engine = createCachedPatternAnalysis(cache);\n\n    const res1 = engine.analyzeEmotionPatterns([], 30);\n    const res2 = engine.analyzeSensoryPatterns([], 30);\n    const res3 = engine.analyzeEnvironmentalCorrelations([]);\n\n    expect(Array.isArray(res1)).toBe(true);\n    expect(Array.isArray(res2)).toBe(true);\n    expect(Array.isArray(res3)).toBe(true);\n\n    engine.destroy();\n  });\n\n  it('can invalidate per-student tags without throwing', () => {\n    const cache = new TestCache();\n    const engine = createCachedPatternAnalysis(cache);\n\n    const count = engine.invalidateStudentCache('unknown-student');\n    expect(typeof count).toBe('number');\n\n    engine.destroy();\n  });\n});","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/__tests__/analyticsExport.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[193,196],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[193,196],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[697,700],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[697,700],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[827,830],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[827,830],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1036,1039],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1036,1039],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1053,1056],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1053,1056],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { analyticsExport } from '@/lib/analyticsExport';\n\nconst baseData = {\n  student: { id: 's1', name: 'Test', grade: '1' } as any,\n  dateRange: { start: new Date('2024-01-01'), end: new Date('2024-01-10') },\n  data: { entries: [], emotions: [], sensoryInputs: [] },\n  analytics: { patterns: [], correlations: [], insights: [] },\n};\n\ndescribe('analyticsExport', () => {\n  beforeEach(() => {\n    // Mock pdf save path by spying on dynamic import users if needed\n    // For json/csv we only verify that no error is thrown\n  });\n\n  it('exports JSON without throwing', () => {\n    expect(() => analyticsExport.exportToJSON(baseData as any)).not.toThrow();\n  });\n\n  it('exports CSV without throwing', () => {\n    expect(() => analyticsExport.exportToCSV(baseData as any)).not.toThrow();\n  });\n\n  it('dispatches by format via exportTo', async () => {\n    const spyPdf = vi.spyOn(analyticsExport, 'exportToPDF').mockResolvedValue();\n    await analyticsExport.exportTo('pdf' as any, baseData as any);\n    expect(spyPdf).toHaveBeenCalled();\n    spyPdf.mockRestore();\n  });\n});\n\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/__tests__/analyticsManager.orchestrator.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[224,227],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[224,227],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[696,699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[696,699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":8,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":11,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1285,1288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1285,1288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1718,1721],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1718,1721],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { buildInsightsCacheKey, buildInsightsTask, getInsights } from '@/lib/analyticsManager';\n\nvi.mock('@/lib/analyticsConfig', async (orig) => {\n  const mod: any = await orig();\n  const DEFAULT = mod.DEFAULT_ANALYTICS_CONFIG;\n  const cfg = { ...DEFAULT, cache: { ...DEFAULT.cache, ttl: 600_000 } }; // 10 min\n  return {\n    ...mod,\n    analyticsConfig: {\n      getConfig: vi.fn(() => ({ ...cfg })),\n      subscribe: vi.fn(() => {\n        // return unsubscribe\n        return () => {};\n      }),\n    },\n    DEFAULT_ANALYTICS_CONFIG: cfg,\n  };\n});\n\nvi.mock('@/lib/insights/unified', () => ({\n  computeInsights: vi.fn(async (inputs: any) => ({\n    patterns: new Array(inputs.entries?.length || 0).fill({}),\n    correlations: [],\n    environmentalCorrelations: [],\n    predictiveInsights: [],\n    anomalies: [],\n    insights: [],\n    confidence: 0.9,\n    hasMinimumData: true,\n  }))\n}));\n\ndescribe('orchestrator exports from analyticsManager', () => {\n  const inputs = {\n    entries: [{ id: 'e1', timestamp: new Date().toISOString() }],\n    emotions: [{ id: 'em1', timestamp: new Date().toISOString(), emotion: 'happy' }],\n    sensoryInputs: [{ id: 's1', timestamp: new Date().toISOString(), response: 'seeking' }],\n  } as any;\n\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  it('buildInsightsCacheKey is deterministic and order-insensitive', () => {\n    const k1 = buildInsightsCacheKey(inputs, {});\n    const shuffled = {\n      ...inputs,\n      entries: [...inputs.entries].reverse(),\n      emotions: [...inputs.emotions].reverse(),\n      sensoryInputs: [...inputs.sensoryInputs].reverse(),\n    };\n    const k2 = buildInsightsCacheKey(shuffled as any, {});\n    expect(k1).toBe(k2);\n  });\n\n  it('buildInsightsTask constructs a typed task with ttl and tags', () => {\n    const task = buildInsightsTask(inputs, { tags: ['foo', 'insights'] });\n    expect(task.type).toBe('Insights/Compute');\n    expect(task.cacheKey).toBeTruthy();\n    expect(task.ttlSeconds).toBeGreaterThan(0);\n    expect(task.tags?.includes('insights')).toBe(true);\n    expect(task.tags?.includes('v2')).toBe(true);\n    expect(task.tags?.includes('foo')).toBe(true);\n  });\n\n  it('getInsights returns stable summary and diagnostics, logs safely on error', async () => {\n    const result = await getInsights(inputs);\n    expect(result.cacheKey).toBeTruthy();\n    expect(result.summary).toMatchObject({\n      patternsCount: 1,\n      correlationsCount: 0,\n      insightsCount: 0,\n      hasMinimumData: true,\n    });\n    expect(result.diagnostics).toMatchObject({ entries: 1, emotions: 1, sensoryInputs: 1 });\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/__tests__/analyticsManager.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[622,625],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[622,625],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[673,676],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[673,676],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[701,704],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[701,704],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1043,1046],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1043,1046],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1239,1242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1239,1242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1361,1364],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1361,1364],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":8,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":11,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2635,2638],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2635,2638],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3077,3080],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3077,3080],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3169,3172],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3169,3172],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":126,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4333,4336],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4333,4336],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'spy' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":127,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":127,"endColumn":14},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4363,4366],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4363,4366],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4368,4371],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4368,4371],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4392,4395],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4392,4395],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":133,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4664,4667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4664,4667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4855,4858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4855,4858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":143,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5046,5049],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5046,5049],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":148,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5284,5287],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5284,5287],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":150,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5383,5386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5383,5386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5980,5983],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5980,5983],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":165,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6106,6109],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6106,6109],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":170,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6365,6368],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6365,6368],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":175,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6604,6607],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6604,6607],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":23,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\n\n// Mocks\nvi.mock('@/lib/insights/unified', () => ({\n  computeInsights: vi.fn(async () => ({\n    patterns: [],\n    correlations: [],\n    environmentalCorrelations: [],\n    predictiveInsights: [],\n    anomalies: [],\n    insights: ['ok'],\n    confidence: 1,\n    hasMinimumData: true,\n  }))\n}));\n\nvi.mock('@/lib/alertSystem', () => ({\n  alertSystem: { generateAlertsForStudent: vi.fn().mockResolvedValue(undefined) }\n}));\n\n// Provide a simple in-memory dataStorage mock\nvi.mock('@/lib/dataStorage', () => {\n  const trackingByStudent = new Map<string, any[]>();\n  const goalsByStudent = new Map<string, any[]>();\n  const students: any[] = [\n    { id: 's1', name: 'Alice' },\n    { id: 's2', name: 'Bob' },\n  ];\n  return {\n    dataStorage: {\n      getStudents: () => students.slice(),\n      getTrackingEntriesForStudent: (id: string) => trackingByStudent.get(id) ?? [],\n      getGoalsForStudent: (id: string) => goalsByStudent.get(id) ?? [],\n      saveTrackingEntry: (entry: any) => {\n        const list = trackingByStudent.get(entry.studentId) ?? [];\n        list.push(entry);\n        trackingByStudent.set(entry.studentId, list);\n      }\n    },\n    IDataStorage: {} as any,\n  };\n});\n\n// Control analytics configuration and TTL\nvi.mock('@/lib/analyticsConfig', async (orig) => {\n  const mod: any = await orig();\n  const DEFAULT = mod.DEFAULT_ANALYTICS_CONFIG;\n  const cfg = { ...DEFAULT, cache: { ...DEFAULT.cache, ttl: 10_000 } }; // 10s TTL default\n  return {\n    ...mod,\n    analyticsConfig: {\n      getConfig: vi.fn(() => ({ ...cfg })),\n    },\n    DEFAULT_ANALYTICS_CONFIG: cfg,\n  };\n});\n\nvi.mock('@/lib/logger', () => ({\n  logger: {\n    debug: vi.fn(), info: vi.fn(), warn: vi.fn(), error: vi.fn(), configure: vi.fn(),\n  }\n}));\n\nimport { analyticsManager } from '@/lib/analyticsManager';\nimport { analyticsConfig, DEFAULT_ANALYTICS_CONFIG } from '@/lib/analyticsConfig';\nimport { computeInsights } from '@/lib/insights/unified';\nimport { logger } from '@/lib/logger';\n\n// Minimal localStorage polyfill for profile persistence in tests\nfunction setupLocalStorage() {\n  const store = new Map<string, string>();\n  // @ts-expect-error Test installs minimal localStorage polyfill for browser-like behavior\n  global.localStorage = {\n    getItem: (k: string) => (store.has(k) ? store.get(k)! : null),\n    setItem: (k: string, v: string) => { store.set(k, String(v)); },\n    removeItem: (k: string) => { store.delete(k); },\n    clear: () => { store.clear(); },\n    key: (i: number) => Array.from(store.keys())[i] ?? null,\n    get length() { return store.size; }\n  } as any;\n}\n\ndescribe('analyticsManager.getStudentAnalytics', () => {\n  beforeEach(() => {\n    vi.useFakeTimers();\n    vi.setSystemTime(new Date('2025-01-01T00:00:00.000Z'));\n    setupLocalStorage();\n    vi.clearAllMocks();\n  });\n  afterEach(() => {\n    vi.useRealTimers();\n  });\n\n  it('delegates to unified computeInsights with correct inputs and options; returns expected shape', async () => {\n    const student = { id: 's1', name: 'Alice' } as any;\n\n    // Seed some simple tracking data via dataStorage mock\n    const { dataStorage }: any = await import('@/lib/dataStorage');\n    const entry = { id: 't1', studentId: 's1', timestamp: new Date(), emotions: [], sensoryInputs: [] };\n    dataStorage.saveTrackingEntry(entry);\n\n    const result = await analyticsManager.getStudentAnalytics(student);\n    expect(result).toMatchObject({\n      patterns: expect.any(Array),\n      correlations: expect.any(Array),\n      environmentalCorrelations: expect.any(Array),\n      predictiveInsights: expect.any(Array),\n      anomalies: expect.any(Array),\n      insights: expect.any(Array),\n    });\n\n    // Verify delegate call with inputs and config option\n    expect(computeInsights).toHaveBeenCalledWith(\n      expect.objectContaining({\n        entries: expect.any(Array),\n        emotions: expect.any(Array),\n        sensoryInputs: expect.any(Array),\n        goals: expect.any(Array),\n      }),\n      expect.objectContaining({ config: expect.any(Object) })\n    );\n  });\n\n  // TODO(kb-analytics): Temporarily skipped while TTL caching behavior is refactored\n  it.skip('uses TTL from analyticsConfig by default and serves cached results within TTL', async () => {\n    const student = { id: 's1', name: 'Alice' } as any;\n    const spy = vi.spyOn<any, any>(computeInsights as any, 'call'); // no-op but forces stable reference\n\n    await analyticsManager.getStudentAnalytics(student);\n    await analyticsManager.getStudentAnalytics(student);\n\n    // computeInsights should have been called only once because of cache\n    expect((computeInsights as any).mock.calls.length).toBe(1);\n\n    // Advance time just under TTL\n    vi.advanceTimersByTime(9999);\n    await analyticsManager.getStudentAnalytics(student);\n    expect((computeInsights as any).mock.calls.length).toBe(1);\n\n    // After TTL, it should recompute\n    vi.advanceTimersByTime(2);\n    await analyticsManager.getStudentAnalytics(student);\n    expect((computeInsights as any).mock.calls.length).toBe(2);\n  });\n\n  // TODO(kb-analytics): Temporarily skipped while error handling is adjusted\n  it.skip('returns minimal safe result and logs once on compute error; no throw', async () => {\n    (computeInsights as any).mockRejectedValueOnce(new Error('boom'));\n\n    const student = { id: 's1', name: 'Alice' } as any;\n    const res = await analyticsManager.getStudentAnalytics(student);\n\n    expect(logger.error).toHaveBeenCalledTimes(1);\n    expect(res).toMatchObject({\n      patterns: [], correlations: [], environmentalCorrelations: [], predictiveInsights: [], anomalies: [], insights: [],\n      error: 'ANALYTICS_GENERATION_FAILED'\n    });\n  });\n\n  // TODO(kb-analytics): Temporarily skipped while default TTL path is stabilized\n  it.skip('uses DEFAULT_ANALYTICS_CONFIG TTL when analyticsConfig.getConfig throws', async () => {\n    // Make analyticsConfig.getConfig throw\n    (analyticsConfig.getConfig as any).mockImplementationOnce(() => { throw new Error('config failed'); });\n\n    const student = { id: 's1', name: 'Alice' } as any;\n    await analyticsManager.getStudentAnalytics(student);\n\n    // Within default TTL window (from DEFAULT_ANALYTICS_CONFIG mocked value), second call should be cached\n    await analyticsManager.getStudentAnalytics(student);\n    expect((computeInsights as any).mock.calls.length).toBe(1);\n\n    // After default TTL elapses, recompute once\n    vi.advanceTimersByTime(DEFAULT_ANALYTICS_CONFIG.cache.ttl + 1);\n    await analyticsManager.getStudentAnalytics(student);\n    expect((computeInsights as any).mock.calls.length).toBe(2);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/__tests__/analyticsSummary.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1846,1849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1846,1849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2068,2071],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2068,2071],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2394,2397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2394,2397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":154,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":157,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2554,2557],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2554,2557],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { generateAnalyticsSummary } from '@/lib/analyticsSummary';\nimport type { EmotionEntry, TrackingEntry } from '@/types/student';\n\nfunction makeTs(offsetDays: number): Date {\n  const now = Date.now();\n  return new Date(now - offsetDays * 24 * 60 * 60 * 1000);\n}\n\ndescribe('generateAnalyticsSummary', () => {\n  it('returns minimal summary with empty data', async () => {\n    const res = await generateAnalyticsSummary({ entries: [], emotions: [] });\n    expect(Array.isArray(res.insights)).toBe(true);\n    expect(typeof res.confidence).toBe('number');\n    expect(typeof res.computedAt).toBe('string');\n  });\n\n  it('uses provided results when available', async () => {\n    const emotions: EmotionEntry[] = [\n      { emotion: 'happy', intensity: 3, timestamp: makeTs(0) },\n      { emotion: 'calm', intensity: 2, timestamp: makeTs(0) },\n    ];\n    const entries: TrackingEntry[] = [\n      { id: 'a', studentId: 's1', timestamp: makeTs(0), emotions, sensoryInputs: [] },\n      { id: 'b', studentId: 's1', timestamp: makeTs(1), emotions: [], sensoryInputs: [] },\n      { id: 'c', studentId: 's1', timestamp: makeTs(2), emotions: [], sensoryInputs: [] },\n      { id: 'd', studentId: 's1', timestamp: makeTs(3), emotions: [], sensoryInputs: [] },\n      { id: 'e', studentId: 's1', timestamp: makeTs(4), emotions: [], sensoryInputs: [] },\n    ];\n\n    const summary = await generateAnalyticsSummary({\n      entries,\n      emotions,\n      results: { patterns: [], correlations: [] },\n    });\n\n    expect(summary.insights.length).toBeGreaterThanOrEqual(1);\n    expect(summary.hasMinimumData).toBeTypeOf('boolean');\n  });\n});\n\ndescribe('generateAnalyticsSummary thresholds and trends', () => {\n  it('adds limited data message below MIN_SESSIONS_FOR_FULL_ANALYTICS', async () => {\n    const emotions = [] as any[];\n    const entries = [\n      { id: 'a', studentId: 's1', timestamp: new Date(), emotions: [], sensoryInputs: [] },\n      { id: 'b', studentId: 's1', timestamp: new Date(), emotions: [], sensoryInputs: [] },\n    ] as any[];\n    const res = await generateAnalyticsSummary({ entries, emotions, results: { patterns: [], correlations: [] } });\n    const hasLimited = res.insights.some((s) => /Limited data available/.test(s));\n    expect(hasLimited).toBe(true);\n  });\n\n  it('caps items per MAX_*_TO_SHOW', async () => {\n    const emotions = [] as any[];\n    const entries = new Array(10).fill(0).map((_, i) => ({ id: String(i), studentId: 's1', timestamp: new Date(), emotions: [], sensoryInputs: [] })) as any[];\n    const patterns = new Array(10).fill(0).map((_, i) => ({ description: `p${i}`, confidence: 0.99 }));\n    const correlations = new Array(10).fill(0).map((_, i) => ({ description: `c${i}`, significance: 'high' }));\n    const res = await generateAnalyticsSummary({ entries, emotions, results: { patterns, correlations } });\n    // Expect at most 2 patterns and 2 correlations in defaults\n    const patternMsgs = res.insights.filter((s) => /Pattern detected:/.test(s));\n    const corrMsgs = res.insights.filter((s) => /Strong correlation found:/.test(s));\n    expect(patternMsgs.length).toBeLessThanOrEqual(2);\n    expect(corrMsgs.length).toBeLessThanOrEqual(2);\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/__tests__/chartRegistry.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/__tests__/chartkit.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1069,1072],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1069,1072],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":42,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1692,1695],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1692,1695],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1993,1996],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1993,1996],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2338,2341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2338,2341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { buildEmotionTrendsOption, buildAreaOption, buildScatterOption, buildComposedOption, TrendRow } from '@/components/charts/ChartKit';\n\nconst rowsFixture: TrendRow[] = [\n  { date: '2025-07-15', avgEmotionIntensity: 4, positiveEmotions: 1, negativeEmotions: 0.5, totalSensoryInputs: 2 },\n  { date: '2025-07-16', avgEmotionIntensity: 5, positiveEmotions: 0.8, negativeEmotions: 1.2, totalSensoryInputs: 3 },\n  { date: '2025-07-17', avgEmotionIntensity: 6, positiveEmotions: 1.5, negativeEmotions: 0.7, totalSensoryInputs: 1 },\n];\n\ndescribe('ChartKit option builders', () => {\n  it('buildEmotionTrendsOption returns consistent series shapes', () => {\n    const option = buildEmotionTrendsOption(rowsFixture, {\n      title: 'Test',\n      showMovingAverage: true,\n      movingAverageWindow: 2,\n      useDualYAxis: true,\n      thresholds: { emotion: 7, sensory: 5 },\n    });\n\n    // Basic shape assertions (snapshot-like but stable)\n    expect(Array.isArray(option.series)).toBe(true);\n    const series = option.series as any[];\n    // Expect 5 series when MA is enabled\n    expect(series.length).toBe(5);\n    // Check names\n    expect(series.map(s => s.name)).toEqual([\n      'Avg Emotion Intensity',\n      'Avg Intensity (2d MA)',\n      'Positive Emotions',\n      'Negative Emotions',\n      'Sensory Inputs',\n    ]);\n    // Check data lengths\n    series.forEach(s => {\n      expect(Array.isArray(s.data)).toBe(true);\n      expect(s.data.length).toBe(rowsFixture.length);\n    });\n  });\n\n  it('buildAreaOption produces two line series with areaStyle', () => {\n    const option = buildAreaOption(rowsFixture);\n    const series = option.series as any[];\n    expect(series.length).toBe(2);\n    expect(series[0].type).toBe('line');\n    expect(series[0].areaStyle).toBeDefined();\n  });\n\n  it('buildScatterOption produces 1 scatter series with xy tuples', () => {\n    const option = buildScatterOption(rowsFixture);\n    const series = option.series as any[];\n    expect(series.length).toBe(1);\n    expect(series[0].type).toBe('scatter');\n    expect(Array.isArray(series[0].data[0])).toBe(true);\n    expect(series[0].data[0].length).toBe(2);\n  });\n\n  it('buildComposedOption produces bar+line combo', () => {\n    const option = buildComposedOption(rowsFixture);\n    const series = option.series as any[];\n    expect(series.length).toBe(3);\n    expect(series[0].type).toBe('bar');\n    expect(series[1].type).toBe('bar');\n    expect(series[2].type).toBe('line');\n  });\n});\n\n\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/__tests__/dataPreprocessing.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[606,609],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[606,609],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":142,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5630,5633],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5630,5633],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":148,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5827,5830],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5827,5830],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":259,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":259,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9252,9255],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9252,9255],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":264,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":264,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9400,9403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9400,9403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, afterEach, beforeEach } from 'vitest';\nimport * as tf from '@tensorflow/tfjs';\nimport {\n  normalizeNumericArray,\n  encodeTimeFeatures,\n  toMLSessions,\n  prepareEmotionDataset,\n  prepareSensoryDataset,\n  PREPROCESSING_SCHEMA_VERSION,\n} from '@/lib/dataPreprocessing';\nimport { TrackingEntry } from '@/types/student';\nimport { analyticsConfig } from '@/lib/analyticsConfig';\n\n// Snapshot config once to avoid recursive spies and ensure stability\nconst CONFIG_SNAPSHOT = analyticsConfig.getConfig();\nvi.spyOn(analyticsConfig, 'getConfig').mockReturnValue(CONFIG_SNAPSHOT as any);\n\ndescribe('normalizeNumericArray', () => {\n  it('handles identical values (zero variance) without NaN and returns 0.5s', () => {\n    const arr = [5, 5, 5, 5];\n    const result = normalizeNumericArray(arr, { clampToUnit: true });\n    expect(result.length).toBe(arr.length);\n    expect(result.every((v) => v === 0.5)).toBe(true);\n    expect(result.every((v) => Number.isFinite(v))).toBe(true);\n  });\n\n  it('respects provided min/max and minVariance; predictable outputs', () => {\n    const arr = [0, 5, 10];\n    const result = normalizeNumericArray(arr, { min: 0, max: 10, clampToUnit: true, minVariance: 1e-12 });\n    expect(result).toEqual([0, 0.5, 1]);\n\n    // If range less than minVariance, returns 0.5 array\n    const resultZeroVar = normalizeNumericArray([3, 3, 3], { minVariance: 1 });\n    expect(resultZeroVar).toEqual([0.5, 0.5, 0.5]);\n  });\n});\n\ndescribe('encodeTimeFeatures', () => {\n  it('produces deterministic 6-length vector within [-1,1] for known timestamp', () => {\n    const date = new Date('2024-06-15T14:30:00Z');\n    const features = encodeTimeFeatures(date);\n    expect(features.length).toBe(6);\n    features.forEach((v) => {\n      expect(v).toBeGreaterThanOrEqual(-1);\n      expect(v).toBeLessThanOrEqual(1);\n    });\n\n    // Deterministic: same input -> same output\n    const features2 = encodeTimeFeatures(date);\n    expect(features2).toEqual(features);\n  });\n});\n\ndescribe('toMLSessions', () => {\n  it('maps emotions, sensory categorization, and environment correctly; handles missing fields', () => {\n    const studentId = 's1';\n    const entries: TrackingEntry[] = [\n      {\n        id: 'e1',\n        studentId,\n        timestamp: new Date('2024-01-01T09:00:00Z'),\n        emotions: [\n          { id: 'em1', emotion: 'Happy', intensity: 6, timestamp: new Date('2024-01-01T09:00:00Z') },\n          { id: 'em2', emotion: 'Anxious', intensity: 4, timestamp: new Date('2024-01-01T09:15:00Z') },\n        ],\n        sensoryInputs: [\n          { id: 's1', response: 'seeking', sensoryType: 'visual', timestamp: new Date('2024-01-01T09:05:00Z') },\n          { id: 's2', response: 'avoiding', sensoryType: 'auditory', timestamp: new Date('2024-01-01T09:10:00Z') },\n          { id: 's3', response: 'neutral', sensoryType: 'tactile', timestamp: new Date('2024-01-01T09:20:00Z') },\n        ],\n        environmentalData: {\n          roomConditions: {\n            lighting: 'bright',\n            noiseLevel: 75,\n            temperature: 72,\n          },\n          classroom: { activity: 'instruction' },\n        },\n        generalNotes: 'General note',\n        notes: 'Note 1',\n      },\n      // Same day additional entry, missing some fields to ensure graceful handling\n      {\n        id: 'e2',\n        studentId,\n        timestamp: new Date('2024-01-01T13:00:00Z'),\n        emotions: [\n          { id: 'em3', emotion: 'Joy', intensity: 7, timestamp: new Date('2024-01-01T13:00:00Z') },\n          { id: 'em4', emotion: 'Calm', intensity: 5, timestamp: new Date('2024-01-01T13:30:00Z') },\n        ],\n        sensoryInputs: [\n          { id: 's4', response: 'seeking', sensoryType: 'visual', timestamp: new Date('2024-01-01T13:05:00Z') },\n          { id: 's5', response: 'dislike', sensoryType: 'auditory', timestamp: new Date('2024-01-01T13:10:00Z') },\n        ],\n        // no environmentalData, no notes\n      },\n      // Next day minimal entry to ensure grouping and no throws\n      {\n        id: 'e3',\n        studentId,\n        timestamp: new Date('2024-01-02T10:00:00Z'),\n        emotions: [],\n        sensoryInputs: [],\n      },\n    ];\n\n    const sessions = toMLSessions(entries);\n    expect(sessions.length).toBe(2); // grouped by date\n\n    const day1 = sessions[0];\n    expect(day1.studentId).toBe(studentId);\n    expect(day1.date).toBe('2024-01-01T00:00:00.000Z');\n\n    // Emotion mapping: happy/joy -> happy max avg, anxious -> anxious, calm -> calm\n    expect(typeof day1.emotion.happy).toBe('number');\n    expect(typeof day1.emotion.anxious).toBe('number');\n    expect(typeof day1.emotion.calm).toBe('number');\n\n    // Sensory predominant: visual seeking (2 seeking), auditory avoiding (2 avoiding), tactile neutral\n    expect(day1.sensory.visual).toBe('seeking');\n    expect(day1.sensory.auditory).toBe('avoiding');\n    expect(day1.sensory.tactile).toBe('neutral');\n\n    // Environment mapping from latest entry of the day\n    expect(day1.environment.lighting).toBe('bright');\n    expect(day1.environment.noise).toBe('loud');\n    expect(day1.environment.temperature).toBe('comfortable');\n\n    const day2 = sessions[1];\n    expect(day2.date).toBe('2024-01-02T00:00:00.000Z');\n    // Should handle missing everything gracefully\n    expect(day2.environment).toBeDefined();\n    // Should not throw even with empty arrays\n    expect(() => toMLSessions([entries[2]])).not.toThrow();\n  });\n});\n\ndescribe('prepareEmotionDataset', () => {\n  beforeEach(() => {\n    // Open a TF scope for allocations in each test\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (tf.engine() as any).startScope?.();\n  });\n  afterEach(() => {\n    // Make sure no stray tensors left allocated\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (tf.engine() as any).endScope?.();\n    } catch {\n      // ignore if scope was not started\n    }\n  });\n\n  it('produces tensors with correct shapes, normalized within [0,1], and includes schemaVersion; disposes safely', () => {\n    const sessions = [\n      {\n        id: 's-2024-01-01',\n        studentId: 's1',\n        date: '2024-01-01T00:00:00.000Z',\n        emotion: { happy: 6, anxious: 4, calm: 5, sad: 1, angry: 2, energetic: 3, frustrated: 2 },\n        sensory: {},\n        environment: {},\n        activities: [],\n        notes: '',\n      },\n      {\n        id: 's-2024-01-02',\n        studentId: 's1',\n        date: '2024-01-02T00:00:00.000Z',\n        emotion: { happy: 7, anxious: 3, calm: 6, sad: 2, angry: 1, energetic: 4, frustrated: 3 },\n        sensory: {},\n        environment: {},\n        activities: [],\n        notes: '',\n      },\n      {\n        id: 's-2024-01-03',\n        studentId: 's1',\n        date: '2024-01-03T00:00:00.000Z',\n        emotion: { happy: 5, anxious: 5, calm: 5, sad: 2, angry: 2, energetic: 2, frustrated: 2 },\n        sensory: {},\n        environment: {},\n        activities: [],\n        notes: '',\n      },\n      {\n        id: 's-2024-01-04',\n        studentId: 's1',\n        date: '2024-01-04T00:00:00.000Z',\n        emotion: { happy: 8, anxious: 2, calm: 7, sad: 1, angry: 2, energetic: 5, frustrated: 1 },\n        sensory: {},\n        environment: {},\n        activities: [],\n        notes: '',\n      },\n      {\n        id: 's-2024-01-05',\n        studentId: 's1',\n        date: '2024-01-05T00:00:00.000Z',\n        emotion: { happy: 6, anxious: 4, calm: 5, sad: 3, angry: 2, energetic: 4, frustrated: 3 },\n        sensory: {},\n        environment: {},\n        activities: [],\n        notes: '',\n      },\n      {\n        id: 's-2024-01-06',\n        studentId: 's1',\n        date: '2024-01-06T00:00:00.000Z',\n        emotion: { happy: 7, anxious: 3, calm: 6, sad: 2, angry: 3, energetic: 4, frustrated: 2 },\n        sensory: {},\n        environment: {},\n        activities: [],\n        notes: '',\n      },\n      {\n        id: 's-2024-01-07',\n        studentId: 's1',\n        date: '2024-01-07T00:00:00.000Z',\n        emotion: { happy: 6, anxious: 4, calm: 5, sad: 2, angry: 2, energetic: 3, frustrated: 2 },\n        sensory: {},\n        environment: {},\n        activities: [],\n        notes: '',\n      },\n    ];\n\n    const { inputs, outputs, meta } = prepareEmotionDataset(sessions, 3);\n\n    expect(inputs.shape).toEqual([5, 3, 13]); // (N-seq+1), seqLen, 7 emotions + 6 time features\n    expect(outputs.shape).toEqual([5, 7]);\n\n    // Check normalization stability: values should be within [0,1] due to clamp\n    const inputVals = inputs.dataSync();\n    const outputVals = outputs.dataSync();\n    for (const v of inputVals) {\n      expect(v).toBeGreaterThanOrEqual(0);\n      expect(v).toBeLessThanOrEqual(1);\n    }\n    for (const v of outputVals) {\n      expect(v).toBeGreaterThanOrEqual(0);\n      expect(v).toBeLessThanOrEqual(1);\n    }\n\n    // Metadata schema version present\n    expect(meta.schemaVersion).toBe(PREPROCESSING_SCHEMA_VERSION);\n    expect(typeof meta.normalizers.min).toBe('number');\n    expect(typeof meta.normalizers.max).toBe('number');\n\n    // Dispose after assertions\n    inputs.dispose();\n    outputs.dispose();\n  });\n});\n\ndescribe('prepareSensoryDataset', () => {\n  beforeEach(() => {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (tf.engine() as any).startScope?.();\n  });\n  afterEach(() => {\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (tf.engine() as any).endScope?.();\n    } catch {\n      // ignore if scope was not started\n    }\n  });\n\n  it('produces correct tensor shapes, includes schemaVersion, and is GC safe', () => {\n    const sessions = [\n      {\n        id: 's-2024-01-01',\n        studentId: 's1',\n        date: '2024-01-01T00:00:00.000Z',\n        emotion: {},\n        sensory: { visual: 'seeking', auditory: 'avoiding', tactile: 'neutral' },\n        environment: { lighting: 'bright', noise: 'loud', temperature: 'comfortable', crowded: 'very', smells: true, textures: false },\n        activities: [],\n        notes: '',\n      },\n      {\n        id: 's-2024-01-02',\n        studentId: 's1',\n        date: '2024-01-02T00:00:00.000Z',\n        emotion: {},\n        sensory: { visual: 'neutral', auditory: 'seeking', tactile: 'avoiding', vestibular: 'neutral', proprioceptive: 'seeking' },\n        environment: { lighting: 'dim', noise: 'moderate', temperature: 'hot', crowded: 'moderate', smells: false, textures: true },\n        activities: [],\n        notes: '',\n      },\n    ];\n\n    const { inputs, outputs, meta } = prepareSensoryDataset(sessions);\n\n    expect(inputs.shape).toEqual([2, 12]); // 6 env + 6 time\n    expect(outputs.shape).toEqual([2, 15]); // 5 senses * 3 responses\n\n    // Validate one-hot structure per sense (sum of each triplet should be 1)\n    const outValues = outputs.arraySync();\n    outValues.forEach((row) => {\n      for (let i = 0; i < 5; i++) {\n        const base = i * 3;\n        const sum = row[base] + row[base + 1] + row[base + 2];\n        expect(sum).toBe(1);\n      }\n    });\n\n    expect(meta.schemaVersion).toBe(PREPROCESSING_SCHEMA_VERSION);\n\n    // Dispose after assertions\n    inputs.dispose();\n    outputs.dispose();\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/__tests__/enhancedPatternAnalysis.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[989,992],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[989,992],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1074,1077],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1074,1077],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":40,"column":52,"nodeType":"BlockStatement","messageId":"unexpected","endLine":40,"endColumn":54,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1521,1521],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2231,2234],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2231,2234],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2640,2643],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2640,2643],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3314,3317],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3314,3317],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":82,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3367,3370],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3367,3370],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3705,3708],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3705,3708],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":125,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":128,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3834,3837],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3834,3837],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":175,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":178,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4281,4284],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4281,4284],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":124,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":127,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4448,4451],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4448,4451],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":151,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":154,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4603,4606],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4603,4606],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":118,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5261,5264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5261,5264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":139,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":142,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5822,5825],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5822,5825],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5997,6000],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5997,6000],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":142,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6301,6304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6301,6304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":143,"column":201,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":204,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6506,6509],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6506,6509],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":17,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Smoke tests for enhancedPatternAnalysis core behaviors\n * - analyzeTrendsWithStatistics returns finite values and respects thresholds\n * - detectAnomalies triggers expected anomalies on synthetic spikes\n * - generateCorrelationMatrix uses config bands for significance\n */\n\nimport { describe, it, expect, beforeAll, afterEach, vi } from 'vitest';\n\n// Mock ML models early to avoid IndexedDB and async init in Node\nvi.mock('@/lib/mlModels', () => ({\n  mlModels: {\n    init: vi.fn().mockResolvedValue(undefined),\n    getModelStatus: vi.fn().mockResolvedValue(new Map()),\n    predictEmotions: vi.fn().mockResolvedValue([]),\n    predictSensoryResponse: vi.fn().mockResolvedValue(null),\n  }\n}));\n\nimport { enhancedPatternAnalysis } from '@/lib/enhancedPatternAnalysis';\nimport { analyticsConfig } from '@/lib/analyticsConfig';\nimport type { TrackingEntry, EmotionEntry } from '@/types/student';\n\n// Minimal storage polyfills (avoid pulling jsdom)\nbeforeAll(() => {\n  if (!(globalThis as any).localStorage) {\n    const store = new Map<string, string>();\n    (globalThis as any).localStorage = {\n      getItem: (k: string) => (store.has(k) ? store.get(k)! : null),\n      setItem: (k: string, v: string) => { store.set(k, String(v)); },\n      removeItem: (k: string) => { store.delete(k); },\n      clear: () => { store.clear(); },\n      key: (i: number) => Array.from(store.keys())[i] ?? null,\n      get length() { return store.size; }\n    };\n  }\n});\n\nafterEach(() => {\n  try { analyticsConfig.resetToDefaults(); } catch {}\n});\n\nfunction isFiniteNumber(n: unknown): n is number {\n  return typeof n === 'number' && Number.isFinite(n);\n}\n\ndescribe('analyzeTrendsWithStatistics (finite outputs and threshold respect)', () => {\n  it('returns finite values and direction respects configured trendThreshold', () => {\n    // Configure thresholds and quality targets minimally\n    analyticsConfig.updateConfig({\n      enhancedAnalysis: {\n        minSampleSize: 5,\n        trendThreshold: 0.05, // small threshold so mild slope counts as increasing\n        predictionConfidenceThreshold: 0.4,\n        anomalyThreshold: 1.5,\n        riskAssessmentThreshold: 3,\n        qualityTargets: { pointsTarget: 20, timeSpanDaysTarget: 30 },\n      } as any,\n      timeWindows: { defaultAnalysisDays: 30, recentDataDays: 7, shortTermDays: 14, longTermDays: 90 }\n    });\n\n    // Create monotonically increasing data across 10 days\n    const now = new Date();\n    const data = Array.from({ length: 10 }, (_, i) => ({\n      value: 1 + i * 0.1,\n      timestamp: new Date(now.getTime() - (9 - i) * 24 * 3600_000),\n    }));\n\n    const res = (enhancedPatternAnalysis as any).analyzeTrendsWithStatistics(data);\n    expect(res).toBeTruthy();\n    // Finite fields\n    expect(isFiniteNumber(res.rate)).toBe(true);\n    expect(isFiniteNumber(res.significance)).toBe(true);\n    expect(isFiniteNumber(res.confidence)).toBe(true);\n    expect(isFiniteNumber(res.forecast.next7Days)).toBe(true);\n    expect(isFiniteNumber(res.forecast.next30Days)).toBe(true);\n    // Direction should be increasing with small threshold\n    expect(res.direction === 'increasing' || res.direction === 'stable').toBe(true);\n\n    // Raise threshold high enough to force stable\n    analyticsConfig.updateConfig({ enhancedAnalysis: { trendThreshold: Math.abs(res.rate) + 1 } as any });\n    const res2 = (enhancedPatternAnalysis as any).analyzeTrendsWithStatistics(data);\n    expect(res2?.direction).toBe('stable');\n  });\n});\n\ndescribe('detectAnomalies (spike triggers)', () => {\n  it('flags anomalies for synthetic intensity spikes and buckets severity', () => {\n    analyticsConfig.updateConfig({\n      enhancedAnalysis: { anomalyThreshold: 1.2, minSampleSize: 5 } as any,\n      alertSensitivity: { level: 'medium', emotionIntensityMultiplier: 1, frequencyMultiplier: 1, anomalyMultiplier: 1 } as any,\n    });\n\n    const now = new Date();\n    const emotions: EmotionEntry[] = [];\n    // Baseline with slight variation (2.8 to 3.2) to ensure non-zero MAD\n    for (let i = 0; i < 30; i++) {\n      const baseIntensity = 3 + (Math.sin(i) * 0.2); // Small variation around 3\n      emotions.push({ id: `e${i}`, studentId: 's1', emotion: 'anxious', intensity: baseIntensity, timestamp: new Date(now.getTime() - (30 - i) * 3600_000), triggers: [] } as any);\n    }\n    // Add clear outlier spikes\n    const spikeHi = { id: 'spike-hi', studentId: 's1', emotion: 'anxious', intensity: 5, timestamp: now, triggers: [] } as any;\n    const spikeLo = { id: 'spike-lo', studentId: 's1', emotion: 'anxious', intensity: 1, timestamp: new Date(now.getTime() - 5000), triggers: [] } as any;\n    emotions.push(spikeHi, spikeLo);\n\n    const anomalies = enhancedPatternAnalysis.detectAnomalies(emotions, [], []);\n    const emotionAnoms = anomalies.filter(a => a.type === 'emotion');\n    expect(emotionAnoms.length).toBeGreaterThan(0);\n    // Ensure at least one high or medium severity exists due to spikes\n    const hasElevated = emotionAnoms.some(a => a.severity === 'high' || a.severity === 'medium');\n    expect(hasElevated).toBe(true);\n  });\n});\n\ndescribe('generateCorrelationMatrix (config significance bands)', () => {\n  function makeEntries(n = 14): TrackingEntry[] {\n    const now = new Date();\n    const entries: TrackingEntry[] = [] as any;\n    for (let i = 0; i < n; i++) {\n      // Create strong correlations among some factors\n      const noise = 20 + i * 2; // increasing\n      const temp = 15 + i * 1;  // increasing, correlated with noise\n      const emoIntensity = Math.min(5, 1 + (i / (n - 1)) * 4); // 1..5 increasing\n      entries.push({\n        id: `t${i}`,\n        studentId: 's1',\n        timestamp: new Date(now.getTime() - (n - i) * 3600_000),\n        emotions: [ { id: `e${i}`, studentId: 's1', emotion: 'happy', intensity: emoIntensity, timestamp: new Date(), triggers: [] } ] as any,\n        sensoryInputs: [],\n        activities: [],\n        environmentalData: { roomConditions: { noiseLevel: noise, temperature: temp, lighting: 'bright' } }\n      } as any);\n    }\n    return entries;\n  }\n\n  it('labels significance tiers using enhancedAnalysis.correlationSignificance bands', () => {\n    analyticsConfig.updateConfig({\n      enhancedAnalysis: {\n        minSampleSize: 10,\n        correlationSignificance: { low: 0.2, moderate: 0.5, high: 0.8 },\n      } as any,\n      patternAnalysis: { correlationThreshold: 0.25, minDataPoints: 3, highIntensityThreshold: 4, concernFrequencyThreshold: 0.3, emotionConsistencyThreshold: 0.4, moderateNegativeThreshold: 0.4 } as any,\n      taxonomy: { positiveEmotions: ['happy', 'calm', 'joyful'] }\n    });\n\n    const entries = makeEntries(18);\n    const matrix = enhancedPatternAnalysis.generateCorrelationMatrix(entries);\n\n    expect(matrix.significantPairs.length).toBeGreaterThan(0);\n    // All pairs must pass base threshold (low band)\n    expect(matrix.significantPairs.every(p => Math.abs(p.correlation) >= 0.2)).toBe(true);\n    // Expect at least one high or moderate based on strong constructed correlations\n    const hasHighOrModerate = matrix.significantPairs.some(p => p.significance === 'high' || p.significance === 'moderate');\n    expect(hasHighOrModerate).toBe(true);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/__tests__/evidence.index.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/__tests__/evidence.keywords.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/__tests__/format.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/__tests__/insights.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'analyticsConfig' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":43},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1525,1528],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1525,1528],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'emotions' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":63,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":63,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sensory' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":64,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":65,"column":129,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":132,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3384,3387],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3384,3387],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5503,5506],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5503,5506],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":106,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5576,5579],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5576,5579],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":169,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":172,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6491,6494],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6491,6494],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":149,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7327,7330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7327,7330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":151,"column":165,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":168,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7497,7500],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7497,7500],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":174,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8480,8483],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8480,8483],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":176,"column":165,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":168,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8650,8653],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8650,8653],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":186,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8935,8938],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8935,8938],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":186,"column":128,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":131,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9017,9020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9017,9020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":196,"column":165,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":168,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9550,9553],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9550,9553],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":211,"column":165,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":211,"endColumn":168,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10276,10279],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10276,10279],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":241,"column":165,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":241,"endColumn":168,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12592,12595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12592,12595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":17,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, beforeEach, vi } from 'vitest';\nimport { calculateConfidence, generateInsights } from '@/lib/insights';\nimport { ANALYTICS_CONFIG, analyticsConfig } from '@/lib/analyticsConfig';\nimport type { EmotionEntry, SensoryEntry, TrackingEntry } from '@/types/student';\n\n// Helper to build timestamps relative to a mocked now\nconst daysAgo = (n: number, now: Date) => new Date(now.getTime() - n * 24 * 60 * 60 * 1000);\n\ndescribe('calculateConfidence', () => {\n  const baseCfg = ANALYTICS_CONFIG.confidence;\n\n  beforeEach(() => {\n    vi.useFakeTimers();\n    // Ensure consistent default config (analyticsConfig may be mutable across tests)\n    // Not strictly necessary when passing cfgParam, but keep parity with code paths.\n  });\n\n  it('applies component contributions up to thresholds and clamps beyond with 2-decimal rounding', () => {\n    const cfg = baseCfg;\n\n    // Exactly reach thresholds\n    const emotions: EmotionEntry[] = Array.from({ length: cfg.THRESHOLDS.EMOTION_ENTRIES }).map((_, i) => ({\n      id: `e${i}`, studentId: 's1', emotion: 'happy', intensity: 3, timestamp: new Date()\n    }));\n    const sensory: SensoryEntry[] = Array.from({ length: cfg.THRESHOLDS.SENSORY_ENTRIES }).map((_, i) => ({\n      id: `s${i}`, studentId: 's1', sense: 'visual', response: 'seeking', intensity: 3, timestamp: new Date()\n    }));\n    const tracking: TrackingEntry[] = Array.from({ length: cfg.THRESHOLDS.TRACKING_ENTRIES }).map((_, i) => ({\n      id: `t${i}`, timestamp: new Date(), value: i\n    } as any));\n\n    // No recency boost by setting last entry just outside window\n    const now = new Date('2025-01-15T12:00:00.000Z');\n    vi.setSystemTime(now);\n    tracking[tracking.length - 1].timestamp = daysAgo(cfg.THRESHOLDS.DAYS_SINCE_LAST_ENTRY + 1, now);\n\n    const scoreAtThresholds = calculateConfidence(emotions, sensory, tracking, cfg);\n    const expectedSum = cfg.WEIGHTS.EMOTION + cfg.WEIGHTS.SENSORY + cfg.WEIGHTS.TRACKING; // each capped at 1 * weight\n    expect(scoreAtThresholds).toBeCloseTo(expectedSum, 10);\n\n    // Exceed thresholds -> still clamp to 1 * weight each\n    const emotions2 = emotions.concat(emotions); // double count intentionally\n    const sensory2 = sensory.concat(sensory, sensory); // exceed further\n    const tracking2 = tracking.concat(tracking);\n    const scoreClamped = calculateConfidence(emotions2, sensory2, tracking2, cfg);\n    expect(scoreClamped).toBeCloseTo(expectedSum, 10);\n\n    // Partial contributions\n    const halfEmotions: EmotionEntry[] = Array.from({ length: Math.floor(cfg.THRESHOLDS.EMOTION_ENTRIES / 2) }).map((_, i) => ({\n      id: `eh${i}`, studentId: 's1', emotion: 'calm', intensity: 2, timestamp: now\n    }));\n    const partialScore = calculateConfidence(halfEmotions, [], [], cfg);\n    const expectedPartial = (halfEmotions.length / cfg.THRESHOLDS.EMOTION_ENTRIES) * cfg.WEIGHTS.EMOTION;\n    // 2-decimal rounding\n    expect(partialScore).toBe(Math.round(expectedPartial * 100) / 100);\n  });\n\n  it('toggles recency boost at the exact boundary (exclusive as implemented)', () => {\n    const cfg = baseCfg;\n    const now = new Date('2025-02-01T00:00:00.000Z');\n    vi.setSystemTime(now);\n\n    const emotions: EmotionEntry[] = [];\n    const sensory: SensoryEntry[] = [];\n    const tracking: TrackingEntry[] = [{ id: 't1', timestamp: daysAgo(cfg.THRESHOLDS.DAYS_SINCE_LAST_ENTRY, now), value: 1 } as any];\n\n    // Base (no contributions from counts)\n    const baseScore = calculateConfidence([], [], tracking, cfg);\n\n    // Because implementation uses exclusive window (<= days - eps), exactly N days ago should NOT get boost\n    // Reconstruct expected without recency boost: only tracking count contribution (1/cfg.THRESHOLDS.TRACKING_ENTRIES)\n    const trackingOnly = Math.min(tracking.length / cfg.THRESHOLDS.TRACKING_ENTRIES, 1) * cfg.WEIGHTS.TRACKING;\n    expect(baseScore).toBe(Math.round(trackingOnly * 100) / 100);\n\n    // Within window (just under threshold) should include boost\n    tracking[0].timestamp = daysAgo(cfg.THRESHOLDS.DAYS_SINCE_LAST_ENTRY - 0.0001, now);\n    const boosted = calculateConfidence([], [], tracking, cfg);\n    const expectedBoosted = Math.min(trackingOnly + cfg.WEIGHTS.RECENCY_BOOST, 1);\n    expect(boosted).toBe(Math.round(expectedBoosted * 100) / 100);\n  });\n});\n\ndescribe('calculateConfidence edge cases', () => {\n  // Use fake timers to align Date.now() inside calculateConfidence with our test timestamps\n  vi.useFakeTimers();\n  const fixedNow = new Date('2025-02-01T00:00:00.000Z');\n  vi.setSystemTime(fixedNow);\n  const now = fixedNow.getTime();\n  const mkTs = (daysAgo: number) => new Date(now - daysAgo * 24 * 60 * 60 * 1000);\n\n  it('no data returns 0 and rounds/clamps', () => {\n    const score = calculateConfidence([], [], [], {\n      THRESHOLDS: { EMOTION_ENTRIES: 10, SENSORY_ENTRIES: 10, TRACKING_ENTRIES: 5, DAYS_SINCE_LAST_ENTRY: 7 },\n      WEIGHTS: { EMOTION: 0.3, SENSORY: 0.3, TRACKING: 0.4, RECENCY_BOOST: 0.1 }\n    });\n    expect(score).toBe(0);\n  });\n\n  it('recency boost triggers for strictly less than N days and not at exactly N days', () => {\n    const trackingLt = [{ id: 't1', studentId: 's1', timestamp: mkTs(6.9) }];\n    const trackingEq = [{ id: 't2', studentId: 's1', timestamp: mkTs(7) }];\n\n    const cfg = { THRESHOLDS: { EMOTION_ENTRIES: 1, SENSORY_ENTRIES: 1, TRACKING_ENTRIES: 1, DAYS_SINCE_LAST_ENTRY: 7 }, WEIGHTS: { EMOTION: 0, SENSORY: 0, TRACKING: 0, RECENCY_BOOST: 0.5 } };\n\n    const scoreLt = calculateConfidence([], [], trackingLt as any, cfg);\n    const scoreEq = calculateConfidence([], [], trackingEq as any, cfg);\n\n    expect(scoreLt).toBe(0.5);\n    expect(scoreEq).toBe(0);\n  });\n});\n\ndescribe('generateInsights (canonical signature)', () => {\n  const cfg = ANALYTICS_CONFIG.insights;\n\n  beforeEach(() => {\n    vi.useFakeTimers();\n    vi.setSystemTime(new Date('2025-03-01T00:00:00.000Z'));\n  });\n\n  it('returns exact no-data message when there are no tracking entries', () => {\n    const insights = generateInsights(\n      { patterns: [], correlations: [], predictiveInsights: [] },\n      [],\n      [],\n      cfg\n    );\n    expect(insights).toEqual([\n      'No tracking data available yet. Start by creating your first tracking session to begin pattern analysis.'\n    ]);\n  });\n\n  it('includes limited sessions message with dynamic count', () => {\n    const entries: TrackingEntry[] = Array.from({ length: cfg.MIN_SESSIONS_FOR_FULL_ANALYTICS - 1 }).map((_, i) => ({ id: `t${i}`, timestamp: new Date(), value: i } as any));\n    const insights = generateInsights(\n      { patterns: [], correlations: [], predictiveInsights: [] },\n      [],\n      entries,\n      cfg\n    );\n    expect(insights[0]).toBe(`Limited data available (${entries.length} sessions). Analytics will improve as more data is collected.`);\n  });\n\n  it('filters patterns by threshold and caps max count', () => {\n    const patterns = [\n      { id: 'p1', pattern: 'A', description: 'High A', type: 'emotion', confidence: cfg.HIGH_CONFIDENCE_PATTERN_THRESHOLD + 0.01, dataPoints: 10 },\n      { id: 'p2', pattern: 'B', description: 'Low B', type: 'emotion', confidence: cfg.HIGH_CONFIDENCE_PATTERN_THRESHOLD - 0.01, dataPoints: 10 },\n      { id: 'p3', pattern: 'C', description: 'High C', type: 'sensory', confidence: cfg.HIGH_CONFIDENCE_PATTERN_THRESHOLD + 0.2, dataPoints: 10 },\n    ] as any;\n\n    const entries: TrackingEntry[] = Array.from({ length: cfg.MIN_SESSIONS_FOR_FULL_ANALYTICS }).map((_, i) => ({ id: `t${i}`, timestamp: new Date(), value: i } as any));\n\n    const insights = generateInsights(\n      { patterns, correlations: [], predictiveInsights: [] },\n      [],\n      entries,\n      cfg\n    );\n\n    const highOnly = patterns.filter(p => p.confidence > cfg.HIGH_CONFIDENCE_PATTERN_THRESHOLD);\n    const expectedMsgs = highOnly.slice(0, cfg.MAX_PATTERNS_TO_SHOW).map(p => `Pattern detected: ${p.description} (${Math.round(p.confidence * 100)}% confidence)`);\n\n    // Extract only pattern lines from insights (skip limited-data message when present)\n    const patternLines = insights.filter(line => line.startsWith('Pattern detected:'));\n    expect(patternLines).toEqual(expectedMsgs);\n  });\n\n  it('includes only high-significance correlations and caps max count', () => {\n    const correlations = [\n      { description: 'Low sig', significance: 'low' },\n      { description: 'High 1', significance: 'high' },\n      { description: 'High 2', significance: 'high' },\n      { description: 'High 3', significance: 'high' },\n    ] as any;\n\n    const entries: TrackingEntry[] = Array.from({ length: cfg.MIN_SESSIONS_FOR_FULL_ANALYTICS }).map((_, i) => ({ id: `t${i}`, timestamp: new Date(), value: i } as any));\n\n    const insights = generateInsights(\n      { patterns: [], correlations, predictiveInsights: [] },\n      [],\n      entries,\n      cfg\n    );\n\n    const corrLines = insights.filter(l => l.startsWith('Strong correlation found: '));\n    const expected = correlations.filter((c: any) => c.significance === 'high').slice(0, cfg.MAX_CORRELATIONS_TO_SHOW).map((c: any) => `Strong correlation found: ${c.description}`);\n    expect(corrLines).toEqual(expected);\n  });\n\n  it('caps predictive insights and formats confidence as percent', () => {\n    const predictiveInsights = [\n      { description: 'Pred 1', confidence: 0.61 },\n      { description: 'Pred 2', confidence: 0.8 },\n      { description: 'Pred 3', confidence: 0.9 },\n    ];\n    const entries: TrackingEntry[] = Array.from({ length: cfg.MIN_SESSIONS_FOR_FULL_ANALYTICS }).map((_, i) => ({ id: `t${i}`, timestamp: new Date(), value: i } as any));\n\n    const insights = generateInsights(\n      { patterns: [], correlations: [], predictiveInsights },\n      [],\n      entries,\n      cfg\n    );\n\n    const predLines = insights.filter(l => l.startsWith('Prediction: '));\n    const expected = predictiveInsights.slice(0, cfg.MAX_PREDICTIONS_TO_SHOW).map(pi => `Prediction: ${pi.description} (${Math.round(pi.confidence * 100)}% confidence)`);\n    expect(predLines).toEqual(expected);\n  });\n\n  it('emits emotion trend: positive, negative, and neutral paths based on POSITIVE_EMOTIONS and thresholds', () => {\n    const entries: TrackingEntry[] = Array.from({ length: cfg.MIN_SESSIONS_FOR_FULL_ANALYTICS }).map((_, i) => ({ id: `t${i}`, timestamp: new Date(), value: i } as any));\n\n    const makeEmotions = (positives: number, total: number): EmotionEntry[] => {\n      const posArray = Array.from({ length: positives }).map((_, i) => ({ id: `ep${i}`, studentId: 's1', emotion: 'happy', intensity: 3, timestamp: new Date() }));\n      const negArray = Array.from({ length: total - positives }).map((_, i) => ({ id: `en${i}`, studentId: 's1', emotion: 'sad', intensity: 3, timestamp: new Date() }));\n      return [...posArray, ...negArray];\n    };\n\n    // Positive trend (> POSITIVE_EMOTION_TREND_THRESHOLD)\n    const posCount = cfg.RECENT_EMOTION_COUNT;\n    const positiveNeeded = Math.floor(cfg.RECENT_EMOTION_COUNT * cfg.POSITIVE_EMOTION_TREND_THRESHOLD) + 1;\n    const emotionsPositive = makeEmotions(positiveNeeded, posCount);\n    const insightsPos = generateInsights({ patterns: [], correlations: [], predictiveInsights: [] }, emotionsPositive, entries, cfg);\n    expect(insightsPos.some(l => l.startsWith('Positive trend: '))).toBe(true);\n\n    // Negative trend (< NEGATIVE_EMOTION_TREND_THRESHOLD)\n    const negativeCap = Math.ceil(cfg.RECENT_EMOTION_COUNT * cfg.NEGATIVE_EMOTION_TREND_THRESHOLD) - 1;\n    const emotionsNegative = makeEmotions(Math.max(0, negativeCap), cfg.RECENT_EMOTION_COUNT);\n    const insightsNeg = generateInsights({ patterns: [], correlations: [], predictiveInsights: [] }, emotionsNegative, entries, cfg);\n    expect(insightsNeg.some(l => l.startsWith('Consider reviewing strategies'))).toBe(true);\n\n    // Neutral (between thresholds) -> neither positive nor negative message\n    const mid = Math.round((cfg.POSITIVE_EMOTION_TREND_THRESHOLD + cfg.NEGATIVE_EMOTION_TREND_THRESHOLD) / 2 * cfg.RECENT_EMOTION_COUNT);\n    const emotionsNeutral = makeEmotions(mid, cfg.RECENT_EMOTION_COUNT);\n    const insightsNeutral = generateInsights({ patterns: [], correlations: [], predictiveInsights: [] }, emotionsNeutral, entries, cfg);\n    const hasTrend = insightsNeutral.some(l => l.startsWith('Positive trend:')) || insightsNeutral.some(l => l.startsWith('Consider reviewing strategies'));\n    expect(hasTrend).toBe(false);\n  });\n\n  it('falls back to monitoring message when nothing else emits', () => {\n    const entries: TrackingEntry[] = Array.from({ length: cfg.MIN_SESSIONS_FOR_FULL_ANALYTICS }).map((_, i) => ({ id: `t${i}`, timestamp: new Date(), value: i } as any));\n    const insights = generateInsights({ patterns: [], correlations: [], predictiveInsights: [] }, [], entries, cfg);\n\n    // With no patterns, correlations, predictions, and not enough emotions for trend, ensure fallback exists\n    expect(insights).toContain('Analytics are active and monitoring patterns. Continue collecting data for more detailed insights.');\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/__tests__/statistics.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'HuberRegressionResult' is defined but never used. Allowed unused vars must match /^_/u.","line":39,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Statistics Module Tests\n * \n * Test data sources and expected values:\n * - tCDF reference values come from standard statistical software (R/scipy) for the\n *   Student's t-distribution lower tail CDF. Since the external values in comments are\n *   rounded to 3–4 decimals, tests use a tolerance of 1e-3 (toBeCloseTo(..., 3)).\n * - pValueForCorrelation expected magnitudes are validated against the t-distribution\n *   with df = n - 2 via the transformation t = r * sqrt(df) / sqrt(1 - r^2). We check\n *   approximate values with loose tolerance (2 decimals) due to rounding of reference\n *   values and algorithmic differences in incomplete beta implementations.\n * - Robust z-scores (zScoresMedian) are assessed qualitatively: the extreme outlier\n *   should receive a large magnitude score, and inliers should have smaller magnitudes\n *   than classic mean/std z-scores in the presence of an outlier.\n * \n * Literature references:\n * - MAD scale factor for normal consistency: c ≈ 1.4826. See\n *   Rousseeuw, P. J., & Croux, C. (1993). Alternatives to the Median Absolute Deviation.\n *   Also referenced by (a) Wikipedia \"Median absolute deviation\" and\n *   (b) robust statistics texts (e.g., Hampel et al., 1986).\n * \n * Tolerance thresholds and justification:\n * - tCDF: 1e-3 relative to rounded external references (toBeCloseTo(..., 3)). The underlying\n *   algorithm uses a Lanczos-based log-gamma and Lentz continued fractions for the\n *   regularized incomplete beta; small numerical differences are expected.\n * - pValueForCorrelation: 2 decimal places to accommodate rounding in examples and cumulative\n *   numeric error. These are sanity/consistency checks rather than exact equality tests.\n * - Other computations use exact equality or strict comparisons where appropriate.\n */\nimport { describe, it, expect } from 'vitest'\nimport {\n  median,\n  mad,\n  zScoresMedian,\n  pearsonCorrelation,\n  tCDF,\n  pValueForCorrelation,\n  huberRegression,\n  type HuberRegressionResult,\n} from '@/lib/statistics'\n\n// Helper: mean and sample std for comparisons inside tests\nfunction mean(arr: number[]): number {\n  const v = arr.filter((x) => Number.isFinite(x))\n  return v.length ? v.reduce((a, b) => a + b, 0) / v.length : 0\n}\nfunction sampleVariance(arr: number[]): number {\n  const v = arr.filter((x) => Number.isFinite(x))\n  if (v.length < 2) return 0\n  const m = mean(v)\n  return v.reduce((s, x) => s + (x - m) * (x - m), 0) / (v.length - 1)\n}\nfunction sampleStd(arr: number[]): number { return Math.sqrt(sampleVariance(arr)) }\n\n// Helper: OLS fit to compare against robust\nfunction olsFit(x: number[], y: number[]): { slope: number; intercept: number } {\n  const n = Math.min(x.length, y.length)\n  const xs: number[] = []\n  const ys: number[] = []\n  for (let i = 0; i < n; i++) {\n    const xi = x[i]\n    const yi = y[i]\n    if (Number.isFinite(xi) && Number.isFinite(yi)) { xs.push(xi); ys.push(yi) }\n  }\n  const m = xs.length\n  if (m < 2) return { slope: 0, intercept: ys.length ? mean(ys) : 0 }\n  const mx = mean(xs)\n  const my = mean(ys)\n  let num = 0, den = 0\n  for (let i = 0; i < m; i++) { const dx = xs[i] - mx; num += dx * (ys[i] - my); den += dx * dx }\n  const slope = den > 0 ? num / den : 0\n  const intercept = my - slope * mx\n  return { slope, intercept }\n}\n\n// Helper: R^2 given fit\nfunction rSquared(x: number[], y: number[], fit: { slope: number; intercept: number }): number {\n  const n = Math.min(x.length, y.length)\n  const xs: number[] = []\n  const ys: number[] = []\n  for (let i = 0; i < n; i++) {\n    const xi = x[i]\n    const yi = y[i]\n    if (Number.isFinite(xi) && Number.isFinite(yi)) { xs.push(xi); ys.push(yi) }\n  }\n  const m = ys.length\n  if (m === 0) return 0\n  const yBar = mean(ys)\n  let ssTot = 0, ssRes = 0\n  for (let i = 0; i < m; i++) {\n    const yi = ys[i]\n    const yhat = fit.intercept + fit.slope * xs[i]\n    ssTot += (yi - yBar) * (yi - yBar)\n    ssRes += (yi - yhat) * (yi - yhat)\n  }\n  if (ssTot <= 0) return 0\n  const r2 = 1 - ssRes / ssTot\n  return Math.max(0, Math.min(1, r2))\n}\n\ndescribe('Basic statistical functions', () => {\n  describe('median', () => {\n    it('handles odd and even counts, single element, empty array, and NaN filtering', () => {\n      expect(median([3, 1, 2])).toBe(2)\n      expect(median([3, 1, 4, 2])).toBe((2 + 3) / 2)\n      expect(median([42])).toBe(42)\n      // Implementation returns 0 for empty inputs\n      expect(median([])).toBe(0)\n      // NaN and non-finite values ignored\n      expect(median([NaN, 2, Infinity, -Infinity, 5])).toBe((2 + 5) / 2)\n    })\n  })\n\n  describe('mad', () => {\n    it('computes raw and normal-consistent MAD', () => {\n      const data = [1, 2, 3, 4, 5] // median=3, abs devs [2,1,0,1,2], mad_raw=1\n      expect(mad(data, 'raw')).toBe(1)\n      expect(mad(data, 'normal')).toBeCloseTo(1.4826, 4)\n    })\n\n    it('returns 0 for empty input or zero spread', () => {\n      expect(mad([])).toBe(0)\n      expect(mad([5, 5, 5], 'raw')).toBe(0)\n      expect(mad([5, 5, 5], 'normal')).toBe(0)\n    })\n  })\n\n  describe('zScoresMedian', () => {\n    it('flags outliers and is more stable on inliers than mean-based z-scores', () => {\n      const data = [9, 10, 10, 11, 100] // median=10, MAD (raw)=1 -> scale ~1.4826\n      const zsRobust = zScoresMedian(data)\n\n      // Compute classical (mean, sample std) z-scores for comparison\n      const mu = mean(data)\n      const sd = sampleStd(data)\n      const zsClassic = data.map((x) => sd > 0 ? (x - mu) / sd : 0)\n\n      // Outlier should be very large in robust scoring\n      expect(zsRobust[4]).toBeGreaterThan(5)\n\n      // Inliers should on average have smaller magnitude robust z than classic z due to outlier influence on mean/std\n      const inliersRobust = zsRobust.slice(0, 4).map(Math.abs)\n      const inliersClassic = zsClassic.slice(0, 4).map(Math.abs)\n      const avg = (arr: number[]) => arr.reduce((a, b) => a + b, 0) / arr.length\n      expect(avg(inliersRobust)).toBeLessThanOrEqual(avg(inliersClassic))\n\n      // Non-finite values produce 0s and length is preserved\n      const withNaN = [1, 2, NaN, 3]\n      const zs2 = zScoresMedian(withNaN)\n      expect(zs2.length).toBe(4)\n      expect(zs2[2]).toBe(0)\n    })\n  })\n})\n\ndescribe('Correlation and significance tests', () => {\n  describe('pearsonCorrelation', () => {\n    it('returns +1 for perfect positive correlation and -1 for perfect negative', () => {\n      const x = [1, 2, 3, 4]\n      const yPlus = [2, 4, 6, 8]\n      const yMinus = [-2, -4, -6, -8]\n      expect(pearsonCorrelation(x, yPlus)).toBeCloseTo(1, 12)\n      expect(pearsonCorrelation(x, yMinus)).toBeCloseTo(-1, 12)\n    })\n\n    it('is ~0 for orthogonal vectors and 0 for constant arrays, and symmetric', () => {\n      const x = [1, -1, 1, -1]\n      const y = [1, 1, -1, -1]\n      expect(pearsonCorrelation(x, y)).toBeCloseTo(0, 12)\n\n      const constArr = [5, 5, 5, 5]\n      expect(pearsonCorrelation(constArr, [1, 2, 3, 4])).toBe(0)\n      expect(pearsonCorrelation([1, 2, 3, 4], constArr)).toBe(0)\n\n      const a = [3, 5, 2, 7]\n      const b = [9, 1, 6, -2]\n      expect(pearsonCorrelation(a, b)).toBeCloseTo(pearsonCorrelation(b, a), 12)\n    })\n  })\n\n  describe('tCDF (Student t CDF)', () => {\n    // Precomputed values from R/scipy (lower tail CDF). Tolerance 1e-4.\n    // Format: [df, t, expected]\n    const cases: Array<[number, number, number]> = [\n      // df=3\n      [3, -3, 1 - 0.9730],\n      [3, -1, 1 - 0.8040],\n      [3, 0, 0.5],\n      [3, 1, 0.8040],\n      [3, 3, 0.9730],\n      // df=5\n      [5, -3, 1 - 0.9865],\n      [5, -1, 1 - 0.8270],\n      [5, 0, 0.5],\n      [5, 1, 0.8270],\n      [5, 3, 0.9865],\n      // df=10\n      [10, -3, 1 - 0.9940],\n      [10, -1, 1 - 0.8400],\n      [10, 0, 0.5],\n      [10, 1, 0.8400],\n      [10, 3, 0.9940],\n      // df=20\n      [20, -3, 1 - 0.9970],\n      [20, -1, 1 - 0.8400],\n      [20, 0, 0.5],\n      [20, 1, 0.8400],\n      [20, 3, 0.9970],\n    ]\n\n    // TODO(kb-analytics): Re-enable once tCDF implementation is tuned to match reference values across df ranges\n    it.skip('matches reference values within reasonable absolute tolerance (pure JS numeric)', () => {\n      for (const [df, t, expected] of cases) {\n        const got = tCDF(t, df)\n        expect(Math.abs(got - expected)).toBeLessThanOrEqual(0.025)\n      }\n    })\n\n    it('handles invalid input gracefully', () => {\n      expect(Number.isNaN(tCDF(NaN, 5))).toBe(true)\n      expect(tCDF(0, -1)).toBeCloseTo(0.5, 12)\n    })\n  })\n\n  describe('pValueForCorrelation', () => {\n    // TODO(kb-analytics): Re-enable once pValueForCorrelation numerical precision is aligned with reference\n    it.skip('agrees with known correlation/sample-size pairs (two-tailed p-values)', () => {\n      // r=0 -> p=1, perfect correlation -> p=0\n      expect(pValueForCorrelation(0, 10)).toBe(1)\n      expect(pValueForCorrelation(1, 10)).toBe(0)\n      expect(pValueForCorrelation(-1, 10)).toBe(0)\n\n      // r=0.8, n=10 -> df=8, t≈3.7707 -> p≈0.005 (two-tailed)\n      // Reference (rounded): ~0.0053\n      const p1 = pValueForCorrelation(0.8, 10)\n      expect(p1).toBeGreaterThanOrEqual(0)\n      expect(p1).toBeLessThan(0.02)\n      expect(Math.abs(p1 - 0.0053)).toBeLessThanOrEqual(0.006)\n\n      // r=0.5, n=30 -> df=28, t≈3.056 -> p≈0.0047\n      const p2 = pValueForCorrelation(0.5, 30)\n      expect(p2).toBeGreaterThanOrEqual(0)\n      expect(p2).toBeLessThan(0.02)\n      expect(Math.abs(p2 - 0.0047)).toBeLessThanOrEqual(0.006)\n    })\n\n    it('returns 1 for insufficient data', () => {\n      expect(pValueForCorrelation(0.5, 2)).toBe(1)\n    })\n  })\n})\n\ndescribe('Robust regression - huberRegression', () => {\n  // TODO(kb-analytics): Re-enable once huberRegression convergence is tuned or test thresholds are revisited\n  it.skip('is robust to outliers: slope closer to ground truth than OLS, outlier weights < 1, converges, R^2 in [0,1]', () => {\n    // Ground truth: y = 2x + 1\n    const x = [0, 1, 2, 3, 4, 5, 6]\n    const y = x.map((xi) => 1 + 2 * xi)\n    // Inject clear outliers\n    y[1] = 50\n    y[5] = -40\n\n    const robust = huberRegression(x, y, { maxIter: 200, tol: 1e-8, delta: 1.0 })\n    const ols = olsFit(x, y)\n\n    // Compare slopes to ground truth (2)\n    const errRobust = Math.abs(robust.slope - 2)\n    const errOLS = Math.abs(ols.slope - 2)\n    expect(errRobust).toBeLessThanOrEqual(errOLS)\n\n    // Outlier weights should be < 1\n    expect(robust.weights.length).toBeGreaterThanOrEqual(Math.min(x.length, y.length) - 0) // sanity\n    // Identify indices of outliers used above and assert down-weighting\n    // After filtering non-finite, positions correspond to valid indices\n    // Our injected outliers were at indices 1 and 5\n    // At least one of the injected outliers should be down-weighted\n    expect(Math.max(robust.weights[1], robust.weights[5])).toBeLessThan(1)\n\n    // Convergence and iteration bound\n    // Either it converges or it reaches a stable fit within the iteration cap\n    expect(robust.iterations).toBeLessThanOrEqual(200)\n\n    // R^2 within [0,1]\n    const r2 = rSquared(x, y, { slope: robust.slope, intercept: robust.intercept })\n    expect(r2).toBeGreaterThanOrEqual(0)\n    expect(r2).toBeLessThanOrEqual(1)\n  })\n\n  it('perfect linear fit recovers exact slope/intercept and converges quickly', () => {\n    const x = [0, 1, 2, 3, 4]\n    const y = x.map((xi) => 3 + 0.5 * xi)\n    const res = huberRegression(x, y, { maxIter: 50, tol: 1e-10 })\n    expect(res.slope).toBeCloseTo(0.5, 12)\n    expect(res.intercept).toBeCloseTo(3, 12)\n    expect(res.converged).toBe(true)\n    expect(res.iterations).toBeLessThanOrEqual(5)\n  })\n\n  it('single point and insufficient data cases', () => {\n    // Single point\n    const r1 = huberRegression([2], [7])\n    expect(r1.slope).toBe(0)\n    expect(r1.intercept).toBe(7)\n    expect(r1.converged).toBe(false)\n    expect(Array.isArray(r1.weights)).toBe(true)\n\n    // Empty arrays -> intercept 0 (median empty->0), no convergence\n    const r2 = huberRegression([], [])\n    expect(r2.slope).toBe(0)\n    expect(r2.intercept).toBe(0)\n    expect(r2.converged).toBe(false)\n  })\n})\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/ai/exportAiReport.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'linewrap' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":86,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2547,2550],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2547,2550],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2626,2629],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2626,2629],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2724,2727],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2724,2727],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3145,3148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3145,3148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":195,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":195,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7116,7119],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7116,7119],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":195,"column":100,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":195,"endColumn":103,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7187,7190],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7187,7190],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":196,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7240,7243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7240,7243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":196,"column":102,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":105,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7313,7316],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7313,7316],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { AnalyticsResultsAI } from '@/lib/analysis/analysisEngine';\nimport type { InterventionResult } from '@/types/analytics';\nimport { resolveSources } from '@/lib/evidence';\nimport type { EvidenceSource } from '@/lib/evidence';\n\nfunction linewrap(text: string, width = 100): string[] {\n  const words = text.split(/\\s+/);\n  const lines: string[] = [];\n  let current = '';\n  for (const w of words) {\n    if ((current + ' ' + w).trim().length > width) {\n      lines.push(current.trim());\n      current = w;\n    } else {\n      current += (current ? ' ' : '') + w;\n    }\n  }\n  if (current.trim()) lines.push(current.trim());\n  return lines;\n}\n\ntype LocaleKey = 'nb' | 'sv';\nconst LABELS: Record<LocaleKey, Record<string, string>> = {\n  nb: {\n    summary: 'Sammendrag',\n    keyFindings: 'Nøkkelfunn',\n    patterns: 'Mønstre',\n    interventions: 'Tiltak',\n    udl: 'UDL-kontrollpunkter',\n    hlp: 'Høyeffektpraksis (HLP)',\n    tiers: 'Intervensjonsnivåer',\n    scope: 'Implementeringsområde',\n    sources: 'Kilder',\n    goals: 'Mål',\n    model: 'Modell',\n    latency: 'Latens',\n    tokens: 'Tokens',\n    cacheRead: 'Cache: les',\n    cacheWrite: 'Cache: skriv',\n    caveats: 'Forbehold',\n    tags: 'Tagger',\n  },\n  sv: {\n    summary: 'Sammanfattning',\n    keyFindings: 'Nyckelfynd',\n    patterns: 'Mönster',\n    interventions: 'Åtgärder',\n    udl: 'UDL-kontrollpunkter',\n    hlp: 'Höghävstångspraxis (HLP)',\n    tiers: 'Interventionsnivåer',\n    scope: 'Implementeringsområde',\n    sources: 'Källor',\n    goals: 'Mål',\n    model: 'Modell',\n    latency: 'Latens',\n    tokens: 'Tokens',\n    cacheRead: 'Cache: läs',\n    cacheWrite: 'Cache: skriv',\n    caveats: 'Förbehåll',\n    tags: 'Taggar',\n  },\n};\n\nconst TAG_DISPLAY: Record<string, { nb: string; sv: string }> = {\n  reading: { nb: 'Lesing', sv: 'Läsning' },\n  writing: { nb: 'Skriving', sv: 'Skrivning' },\n  math: { nb: 'Matematikk', sv: 'Matematik' },\n  behavior: { nb: 'Atferd', sv: 'Beteende' },\n  pbis: { nb: 'PBIS', sv: 'PBIS' },\n  fba: { nb: 'FBA', sv: 'FBA' },\n  udl: { nb: 'UDL', sv: 'UDL' },\n  hlp: { nb: 'HLP', sv: 'HLP' },\n  aac: { nb: 'AAC', sv: 'AAC' },\n  autism: { nb: 'Autisme', sv: 'Autism' },\n  sensory: { nb: 'Sensorisk', sv: 'Sensorisk' },\n  pm: { nb: 'Måluppföljing', sv: 'Måluppföljning' },\n};\n\nexport async function formatAiReportText(\n  result: AnalyticsResultsAI,\n  opts?: { includeMetadata?: boolean; locale?: LocaleKey }\n): Promise<string> {\n  const locale: LocaleKey = (opts?.locale ?? 'nb');\n  const L = LABELS[locale];\n  const out: string[] = [];\n  if ((result as any).summary) {\n    out.push(`# ${L.summary}`);\n    out.push(String((result as any).summary));\n    out.push('');\n  }\n\n  out.push(`# ${L.keyFindings}`);\n  const kf = ((result as any).keyFindings || []) as string[];\n  out.push(...(kf.length ? kf.map(x => `• ${x}`) : ['(Ingen)']));\n  out.push('');\n\n  out.push(`# ${L.patterns}`);\n  out.push(...((result.patterns || []).map(p => `• ${p.name || 'Mønster'}${p.description ? ` — ${p.description}` : ''}`)));\n  out.push('');\n\n  // Collect unique source IDs across all interventions for resolution\n  const interventions: InterventionResult[] = ((result as any).suggestedInterventions || []) as InterventionResult[];\n  const uniqueSourceIds = new Set<string>();\n  for (const i of interventions) {\n    if (Array.isArray(i.sources)) {\n      for (const id of i.sources) {\n        if (typeof id === 'string' && id.trim()) uniqueSourceIds.add(id.trim());\n      }\n    }\n  }\n\n  // Resolve sources with graceful fallback\n  let resolved: EvidenceSource[] = [];\n  try {\n    if (uniqueSourceIds.size > 0) {\n      resolved = await resolveSources(Array.from(uniqueSourceIds));\n    }\n  } catch (_e) {\n    resolved = [];\n  }\n  const idToSource = new Map<string, EvidenceSource>(resolved.map(s => [s.id, s]));\n\n  // Enhanced interventions with inline sources, tier/scope, and metrics\n  out.push(`# ${L.interventions}`);\n  if (interventions.length === 0) {\n    out.push('(Ingen)');\n  } else {\n    for (const i of interventions) {\n      const names: string[] = [];\n      for (const id of i.sources || []) {\n        const s = id && idToSource.get(id);\n        if (s) names.push(s.title);\n      }\n      const sourcesText = names.length ? ` [${L.sources}: ${names.join(', ')}]` : '';\n      const tierScope = (i.tier || i.scope) ? ` [${i.tier || ''}${i.scope ? `${i.tier ? ', ' : ''}${i.scope}` : ''}]` : '';\n      const metricsText = (Array.isArray(i.metrics) && i.metrics.length) ? ` [${L.goals}: ${i.metrics.join(', ')}]` : '';\n      out.push(`• ${i.title}${i.description ? ` — ${i.description}` : ''}${sourcesText}${tierScope}${metricsText}`);\n    }\n  }\n  out.push('');\n\n  // UDL and HLP sections (if present)\n  const allUdl = Array.from(new Set(interventions.flatMap(i => i.udlCheckpoints || []).filter(Boolean)));\n  const allHlps = Array.from(new Set(interventions.flatMap(i => i.hlps || []).filter(Boolean)));\n  if (allUdl.length) {\n    out.push(`# ${L.udl}`);\n    for (const u of allUdl) out.push(`• ${u}`);\n    out.push('');\n  }\n  if (allHlps.length) {\n    out.push(`# ${L.hlp}`);\n    for (const h of allHlps) out.push(`• ${h}`);\n    out.push('');\n  }\n\n  // Tier summary and scope summary\n  const tiers = interventions.map(i => i.tier).filter(Boolean) as string[];\n  const scopes = interventions.map(i => i.scope).filter(Boolean) as string[];\n  if (tiers.length) {\n    const counts = tiers.reduce((acc, t) => (acc[t] = (acc[t] || 0) + 1, acc), {} as Record<string, number>);\n    out.push(`# ${L.tiers}`);\n    Object.keys(counts).sort().forEach(k => out.push(`• ${k}: ${counts[k]}`));\n    out.push('');\n  }\n  if (scopes.length) {\n    const counts = scopes.reduce((acc, s) => (acc[s] = (acc[s] || 0) + 1, acc), {} as Record<string, number>);\n    out.push(`# ${L.scope}`);\n    Object.keys(counts).sort().forEach(k => out.push(`• ${k}: ${counts[k]}`));\n    out.push('');\n  }\n\n  // Dedicated sources section without duplicates; append tags inline\n  if (resolved.length) {\n    out.push(`# ${L.sources}`);\n    const seenIds = new Set<string>();\n    for (const s of resolved) {\n      if (seenIds.has(s.id)) continue;\n      seenIds.add(s.id);\n      const lvl = s.evidenceLevel ? ` [${s.evidenceLevel} evidens]` : '';\n      const year = (s.year != null) ? String(s.year) : 'N/A';\n      const excerptText = s.shortExcerpt ? ` — ${s.shortExcerpt}` : '';\n      const urlText = s.url ? ` [${s.url}]` : '';\n      const tags = (Array.isArray(s.tags) ? s.tags : []).map(t => TAG_DISPLAY[String(t)]?.[locale] || String(t)).join(', ');\n      const tagsText = tags ? ` [${L.tags}: ${tags}]` : '';\n      out.push(`• ${s.title} (${year})${excerptText}${urlText}${lvl}${tagsText}`);\n    }\n    out.push('');\n  }\n\n  if (opts?.includeMetadata && result.ai) {\n    out.push(`# AI‑metadata`);\n    out.push(`${L.model}: ${result.ai.model || ''}`);\n    if (result.ai.latencyMs != null) out.push(`${L.latency}: ${Math.round(result.ai.latencyMs)} ms`);\n    if (result.ai.usage) out.push(`${L.tokens}: prompt ${result.ai.usage.promptTokens ?? 0} • completion ${result.ai.usage.completionTokens ?? 0} • total ${result.ai.usage.totalTokens ?? 0}`);\n    if ((result.ai.usage as any)?.cacheReadTokens) out.push(`${L.cacheRead}: ${(result.ai.usage as any).cacheReadTokens}`);\n    if ((result.ai.usage as any)?.cacheWriteTokens) out.push(`${L.cacheWrite}: ${(result.ai.usage as any).cacheWriteTokens}`);\n    if (Array.isArray(result.ai.caveats) && result.ai.caveats.length) out.push(`${L.caveats}: ${result.ai.caveats.join('; ')}`);\n  }\n  return out.join('\\n');\n}\n\nexport async function downloadPdfFromText(text: string, filename: string = 'kreativium_ai_rapport.pdf'): Promise<void> {\n  const { jsPDF } = await import('jspdf');\n  const doc = new jsPDF({ unit: 'pt', format: 'a4' });\n  const margin = 40;\n  const pageWidth = doc.internal.pageSize.getWidth();\n  const usable = pageWidth - margin * 2;\n  let y = margin;\n  doc.setFont('helvetica', 'normal');\n  doc.setFontSize(11);\n  const paragraphs = text.split('\\n');\n  for (const para of paragraphs) {\n    if (para.trim().length === 0) { y += 12; continue; }\n    const wrapped = doc.splitTextToSize(para, usable);\n    for (const line of wrapped) {\n      if (y > doc.internal.pageSize.getHeight() - margin) {\n        doc.addPage();\n        y = margin;\n      }\n      doc.text(line, margin, y);\n      y += 14;\n    }\n  }\n  doc.save(filename);\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/ai/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/ai/metrics.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'clamp' is defined but never used. Allowed unused vars must match /^_/u.","line":25,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":15},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":34,"column":112,"nodeType":"BlockStatement","messageId":"unexpected","endLine":34,"endColumn":114,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1054,1054],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":46,"column":110,"nodeType":"BlockStatement","messageId":"unexpected","endLine":46,"endColumn":112,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1525,1525],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":51,"column":114,"nodeType":"BlockStatement","messageId":"unexpected","endLine":51,"endColumn":116,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1721,1721],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { logger } from '@/lib/logger';\n/**\n * Lightweight AI telemetry stored in localStorage for dev/exploration.\n * Tracks JSON validity rate, request outcomes, retries, and latency.\n */\n\nexport interface AiMetricsData {\n  version: number;\n  counts: {\n    requests: number;\n    successes: number;\n    failures: number;\n    retries: number;\n    jsonValid: number;\n    jsonParseErrors: number;\n    jsonValidateErrors: number;\n  };\n  latenciesMs: number[]; // ring buffer (max 50)\n  lastUpdated: string;\n}\n\nconst KEY = 'kreativium_ai_metrics_v1';\nconst MAX_LAT = 50;\n\nfunction clamp(n: number, min: number, max: number) { return Math.max(min, Math.min(max, n)); }\n\nfunction load(): AiMetricsData {\n  try {\n    const raw = (typeof localStorage !== 'undefined') ? localStorage.getItem(KEY) : null;\n    if (raw) {\n      const parsed = JSON.parse(raw) as AiMetricsData;\n      if (parsed && typeof parsed.version === 'number') return parsed;\n    }\n  } catch (e) { try { logger.warn('[aiMetrics] Failed to load metrics from localStorage', e as Error); } catch {} }\n  return {\n    version: 1,\n    counts: { requests: 0, successes: 0, failures: 0, retries: 0, jsonValid: 0, jsonParseErrors: 0, jsonValidateErrors: 0 },\n    latenciesMs: [],\n    lastUpdated: new Date().toISOString(),\n  };\n}\n\nfunction save(d: AiMetricsData) {\n  try {\n    if (typeof localStorage !== 'undefined') localStorage.setItem(KEY, JSON.stringify(d));\n  } catch (e) { try { logger.warn('[aiMetrics] Failed to save metrics to localStorage', e as Error); } catch {} }\n}\n\nfunction update(mutator: (d: AiMetricsData) => void) {\n  const d = load();\n  try { mutator(d); } catch (e) { try { logger.warn('[aiMetrics] Failed to update metrics', e as Error); } catch {} }\n  d.lastUpdated = new Date().toISOString();\n  save(d);\n}\n\nexport const aiMetrics = {\n  reset() { save({ version: 1, counts: { requests: 0, successes: 0, failures: 0, retries: 0, jsonValid: 0, jsonParseErrors: 0, jsonValidateErrors: 0 }, latenciesMs: [], lastUpdated: new Date().toISOString() }); },\n  get(): AiMetricsData { return load(); },\n  recordRequestStart() { update(d => { d.counts.requests += 1; }); },\n  recordSuccess(durationMs: number) { update(d => { d.counts.successes += 1; if (Number.isFinite(durationMs)) { d.latenciesMs.push(Math.max(0, Math.round(durationMs))); if (d.latenciesMs.length > MAX_LAT) d.latenciesMs.splice(0, d.latenciesMs.length - MAX_LAT); } }); },\n  recordFailure() { update(d => { d.counts.failures += 1; }); },\n  recordRetries(attempts: number) { if (Number.isFinite(attempts) && attempts > 1) update(d => { d.counts.retries += (attempts - 1); }); },\n  recordJsonValid() { update(d => { d.counts.jsonValid += 1; }); },\n  recordJsonParseError() { update(d => { d.counts.jsonParseErrors += 1; }); },\n  recordJsonValidateError() { update(d => { d.counts.jsonValidateErrors += 1; }); },\n  summary() {\n    const d = load();\n    const totalJson = d.counts.jsonValid + d.counts.jsonParseErrors + d.counts.jsonValidateErrors;\n    const jsonValidity = totalJson > 0 ? (d.counts.jsonValid / totalJson) : 0;\n    const avgLatency = d.latenciesMs.length ? Math.round(d.latenciesMs.reduce((a,b) => a+b, 0) / d.latenciesMs.length) : 0;\n    return { ...d.counts, avgLatency, jsonValidity, lastUpdated: d.lastUpdated };\n  }\n};\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/ai/openrouterClient.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1303,1306],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1303,1306],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":50,"column":198,"nodeType":"BlockStatement","messageId":"unexpected","endLine":50,"endColumn":200,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1553,1553],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2443,2446],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2443,2446],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":87,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2839,2842],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2839,2842],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":90,"column":231,"nodeType":"BlockStatement","messageId":"unexpected","endLine":90,"endColumn":233,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3140,3140],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":122,"column":185,"nodeType":"BlockStatement","messageId":"unexpected","endLine":122,"endColumn":187,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4529,4529],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":192,"column":224,"nodeType":"BlockStatement","messageId":"unexpected","endLine":192,"endColumn":226,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[7457,7457],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":226,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":226,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8764,8767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8764,8767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":264,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":264,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9925,9928],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9925,9928],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":264,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":264,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9966,9969],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9966,9969],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":274,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":274,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10384,10387],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10384,10387],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":275,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10438,10441],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10438,10441],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":277,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":277,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10501,10504],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10501,10504],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":332,"column":183,"nodeType":"BlockStatement","messageId":"unexpected","endLine":332,"endColumn":185,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[12706,12706],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":335,"column":138,"nodeType":"BlockStatement","messageId":"unexpected","endLine":335,"endColumn":140,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[12905,12905],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":393,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":393,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15111,15114],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15111,15114],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":399,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":399,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15468,15471],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15468,15471],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":403,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":403,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15646,15649],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15646,15649],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":405,"column":19,"nodeType":"BlockStatement","messageId":"unexpected","endLine":405,"endColumn":21,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[15684,15684],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":413,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":413,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16039,16042],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16039,16042],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":415,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":415,"endColumn":23,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[16081,16081],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":419,"column":158,"nodeType":"BlockStatement","messageId":"unexpected","endLine":419,"endColumn":160,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[16289,16289],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":437,"column":149,"nodeType":"BlockStatement","messageId":"unexpected","endLine":437,"endColumn":151,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[17142,17142],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":439,"column":166,"nodeType":"BlockStatement","messageId":"unexpected","endLine":439,"endColumn":168,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[17338,17338],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":448,"column":147,"nodeType":"BlockStatement","messageId":"unexpected","endLine":448,"endColumn":149,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[17800,17800],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":468,"column":183,"nodeType":"BlockStatement","messageId":"unexpected","endLine":468,"endColumn":185,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[18527,18527],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":471,"column":138,"nodeType":"BlockStatement","messageId":"unexpected","endLine":471,"endColumn":140,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[18737,18737],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":487,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":487,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19278,19281],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19278,19281],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":493,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":493,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19598,19601],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19598,19601],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":498,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":498,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19950,19953],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19950,19953],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":30,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { logger } from '@/lib/logger';\nimport { errorHandler } from '@/lib/errorHandler';\nimport { loadAiConfig, type AiConfig } from '@/lib/aiConfig';\nimport {\n  SensoryCompassError,\n  ErrorType,\n} from '@/types/errors';\n\nimport type {\n  ChatMessage,\n  ChatResponse,\n  JsonModeOptions,\n  OpenRouterChatRequest,\n  OpenRouterChatResponse,\n  OpenRouterClientConfig,\n  OpenRouterErrorPayload,\n  RequestOptions,\n  RetryOptions,\n} from './types';\n\nimport {\n  buildAbortController,\n  calculateCostEstimate,\n  isRetriableStatus,\n  retryWithExponentialBackoff,\n  sanitizeRequestForLog,\n  safeJSONParse,\n} from './utils';\nimport { aiMetrics } from '@/lib/ai/metrics';\n\nconst DEFAULT_BASE_URL = 'https://openrouter.ai/api/v1';\n\nexport class OpenRouterClient {\n  private config: Required<OpenRouterClientConfig>;\n\n  constructor(overrides?: Partial<OpenRouterClientConfig>) {\n    // Base AI config from env with overrides\n    const ai: AiConfig = loadAiConfig({\n      modelName: overrides?.modelName,\n      temperature: overrides?.temperature,\n      maxTokens: overrides?.maxTokens,\n      topP: overrides?.topP,\n      timeoutMs: overrides?.timeoutMs,\n      apiKey: overrides?.apiKey,\n    });\n\n    // Resolve model/key from env with safe browser fallbacks\n    const envAny: Record<string, unknown> = (import.meta as any)?.env ?? {};\n    const getLS = (k: string) => {\n      try { return typeof localStorage !== 'undefined' ? (localStorage.getItem(k) || '') : ''; } catch (e) { try { logger.warn('[OpenRouterClient] localStorage access failed', e as Error); } catch {} return ''; }\n    };\n    const pickFirstNonEmpty = (...values: Array<unknown>): string => {\n      for (const value of values) {\n        if (typeof value === 'string') {\n          const trimmed = value.trim();\n          if (trimmed.length > 0) return trimmed;\n        }\n      }\n      return '';\n    };\n\n    // Precedence: explicit overrides > validated ai.modelName > env/localStorage > default\n    let liveModel = overrides?.modelName ?? ai.modelName;\n    if (!liveModel || liveModel.trim().length === 0) {\n      liveModel = pickFirstNonEmpty(envAny.VITE_AI_MODEL_NAME, getLS('VITE_AI_MODEL_NAME')) || ai.modelName;\n    }\n\n    const liveKey = pickFirstNonEmpty(\n      overrides?.apiKey,\n      ai.apiKey,\n      envAny.VITE_OPENROUTER_API_KEY,\n      getLS('OPENROUTER_API_KEY'),\n      getLS('VITE_OPENROUTER_API_KEY'),\n    );\n\n    this.config = {\n      baseUrl: overrides?.baseUrl || (ai as any).baseUrl || DEFAULT_BASE_URL,\n      modelName: liveModel,\n      temperature: ai.temperature,\n      maxTokens: ai.maxTokens,\n      topP: ai.topP,\n      timeoutMs: ai.timeoutMs,\n      apiKey: liveKey,\n      maxRetries: overrides?.maxRetries ?? 3,\n      baseDelayMs: overrides?.baseDelayMs ?? 500,\n      maxDelayMs: overrides?.maxDelayMs ?? 4000,\n      localOnly: overrides?.localOnly ?? (ai as any)?.localOnly ?? false,\n    } as Required<OpenRouterClientConfig>;\n\n    try { logger.debug('[OpenRouterClient] init config', { hasKey: !!this.config.apiKey, model: this.config.modelName }); } catch (e) { try { logger.warn('[OpenRouterClient] Constructor debug logging failed', e as Error); } catch {} }\n  }\n\n  private requiresApiKey(): boolean {\n    // Require a key when targeting OpenRouter; allow keyless for local/other dev servers\n    const url = (this.config.baseUrl || '').toLowerCase();\n    return url.includes('openrouter.ai');\n  }\n\n  private isLocalBaseUrl(): boolean {\n    const url = (this.config.baseUrl || '').toLowerCase();\n    return url.includes('localhost') || url.includes('127.0.0.1');\n  }\n\n  private buildHeaders(): Headers {\n    const apiKey = this.config.apiKey;\n    if (this.config.localOnly && !this.isLocalBaseUrl()) {\n      const err = new SensoryCompassError(\n        ErrorType.AI_CONFIGURATION_ERROR,\n        'Local-only mode enabled but base URL is not local',\n        { code: 'AI_LOCAL_ONLY', userMessage: 'Appen er satt til kun lokal AI. Sett VITE_AI_BASE_URL til http://localhost:1234/v1.', recoverable: false }\n      );\n      throw err;\n    }\n    if (this.requiresApiKey() && !apiKey) {\n      const err = new SensoryCompassError(\n        ErrorType.AI_CONFIGURATION_ERROR,\n        'Missing API key for OpenRouter',\n        { code: 'AI_API_KEY_MISSING', userMessage: 'AI configuration error. Please contact support.', recoverable: false }\n      );\n      throw err;\n    }\n    try { logger.debug('[OpenRouterClient] buildHeaders hasKey', { hasKey: !!apiKey }); } catch (e) { try { logger.warn('[OpenRouterClient] Debug logging failed', e as Error); } catch {} }\n    const headers = new Headers();\n    headers.set('Content-Type', 'application/json');\n    headers.set('Accept', 'application/json');\n    if (!this.config.localOnly && apiKey) headers.set('Authorization', `Bearer ${apiKey}`);\n    // As recommended by OpenRouter\n    if (typeof window !== 'undefined' && this.requiresApiKey()) {\n      headers.set('HTTP-Referer', window.location.origin);\n    }\n    headers.set('X-Title', 'Sensory Compass');\n    return headers;\n  }\n\n  private buildRequestBody(messages: ChatMessage[], jsonMode: boolean): OpenRouterChatRequest {\n    const body: OpenRouterChatRequest = {\n      model: this.config.modelName,\n      messages,\n      temperature: this.config.temperature,\n      max_tokens: this.config.maxTokens,\n      top_p: this.config.topP,\n    };\n    if (jsonMode) {\n      body.response_format = { type: 'json_object' };\n    }\n    return body;\n  }\n\n  private async postChatCompletions(body: OpenRouterChatRequest, retry: RetryOptions): Promise<{ response: OpenRouterChatResponse; attempts: number; durationMs: number }>\n  {\n    const endpoint = `${this.config.baseUrl}/chat/completions`;\n    try { aiMetrics.recordRequestStart(); } catch {\n      // Swallow metrics init errors to avoid noisy logs in production\n    }\n    const started = performance.now();\n    let attempts = 0;\n\n    const exec = async (attempt: number): Promise<OpenRouterChatResponse> => {\n      attempts = attempt + 1;\n      const { controller, timeoutId } = buildAbortController(this.config.timeoutMs);\n      const headers = this.buildHeaders();\n      const req: RequestInit = {\n        method: 'POST',\n        headers,\n        body: JSON.stringify(body),\n        signal: controller.signal,\n      };\n\n      // Pre-request logging (sanitized)\n      if (attempt === 0) {\n        logger.info('[OpenRouter] Request start', sanitizeRequestForLog({ url: endpoint, method: 'POST', headers, body }));\n      } else {\n        logger.warn('[OpenRouter] Retrying request', { attempt, ...sanitizeRequestForLog({ url: endpoint, method: 'POST', headers }) });\n      }\n\n      try {\n        const res = await fetch(endpoint, req);\n        clearTimeout(timeoutId);\n\n        if (!res.ok) {\n          const text = await res.text().catch(() => '');\n\n          // Extract retry-after header if present\n          const retryAfterHeader = res.headers.get('retry-after');\n          const retryAfterMs = retryAfterHeader ? parseInt(retryAfterHeader, 10) * 1000 : undefined;\n\n          // Try parse OpenRouter error payload for message\n          let message = text;\n          try {\n            const parsed = JSON.parse(text) as OpenRouterErrorPayload;\n            if (parsed?.error?.message) message = parsed.error.message;\n          } catch (e) { try { logger.debug('[OpenRouterClient] Failed to parse error payload as JSON', { error: e instanceof Error ? { name: e.name, message: e.message } : String(e), snippet: text.slice(0, 160) }); } catch {} }\n\n          if (res.status === 429) {\n            // Rate limited – signal retryable\n            const retryable = new SensoryCompassError(\n              ErrorType.AI_QUOTA_EXCEEDED,\n              message || 'Rate limited by AI provider',\n              { code: 'AI_RATE_LIMITED', recoverable: true, details: { status: res.status, retryAfterMs } }\n            );\n            throw retryable;\n          }\n\n          if (isRetriableStatus(res.status)) {\n            const retryable = new SensoryCompassError(\n              ErrorType.AI_API_FAILURE,\n              message || 'Transient AI API error',\n              { code: `HTTP_${res.status}`, recoverable: true, details: { status: res.status, retryAfterMs } }\n            );\n            throw retryable;\n          }\n\n          const err = new SensoryCompassError(\n            ErrorType.AI_API_FAILURE,\n            message || `AI API request failed with status ${res.status}`,\n            { code: `HTTP_${res.status}`, recoverable: false, details: { status: res.status } }\n          );\n          throw err;\n        }\n\n        const json = (await res.json()) as OpenRouterChatResponse;\n        return json;\n      } catch (error) {\n        clearTimeout(timeoutId);\n        // Network or Abort errors should be typed and possibly retried\n        if ((error as any)?.name === 'AbortError') {\n          const err = new SensoryCompassError(\n            ErrorType.TIMEOUT_ERROR,\n            'AI request timed out',\n            { code: 'AI_TIMEOUT', recoverable: true }\n          );\n          throw err;\n        }\n        throw error;\n      }\n    };\n\n    const res = await retryWithExponentialBackoff<OpenRouterChatResponse>(\n      exec,\n      retry,\n      (attempt, error, delayMs) => {\n        logger.warn('[OpenRouter] Retry scheduled', {\n          attempt,\n          delayMs,\n          error: error instanceof Error ? { name: error.name, message: error.message } : String(error),\n        });\n      },\n    );\n\n    const durationMs = performance.now() - started;\n    return { response: res, attempts, durationMs };\n  }\n\n  private pickFirstMessageContent(data: OpenRouterChatResponse): string {\n    const message = data.choices?.[0]?.message;\n    if (!message) {\n      throw new SensoryCompassError(\n        ErrorType.AI_INVALID_RESPONSE,\n        'AI returned an unexpected response format',\n        { code: 'AI_INVALID_RESPONSE', recoverable: true, details: { data } }\n      );\n    }\n\n    const refusal = typeof (message as any).refusal === 'string' ? ((message as any).refusal as string).trim() : '';\n    if (refusal.length > 0) {\n      throw new SensoryCompassError(\n        ErrorType.AI_REFUSAL,\n        'AI refused to provide a response',\n        { code: 'AI_REFUSAL', userMessage: refusal, recoverable: false, details: { refusal, data } },\n      );\n    }\n\n    // Some providers place JSON only in tool_calls.function.arguments with empty/null content\n    if (typeof (message as any).content === 'string') {\n      return (message as any).content as string;\n    }\n    const toolArgs = (message as any)?.tool_calls?.[0]?.function?.arguments;\n    if (toolArgs) {\n      // Defer actual parsing of tool args to JSON handlers; return empty string to signal fallback path\n      return '';\n    }\n    throw new SensoryCompassError(\n      ErrorType.AI_INVALID_RESPONSE,\n      'AI returned an unexpected response format',\n      { code: 'AI_INVALID_RESPONSE', recoverable: true, details: { data } }\n    );\n  }\n\n  // Public: generic chat call returning raw text\n  async chat(messages: ChatMessage[] | string, overrides?: Partial<OpenRouterClientConfig>, options?: RequestOptions): Promise<ChatResponse> {\n    try {\n      const merged = overrides ? new OpenRouterClient({ ...this.config, ...overrides }) : this;\n      const msgs: ChatMessage[] = Array.isArray(messages)\n        ? messages\n        : [{ role: 'user', content: String(messages) }];\n      const body = merged.buildRequestBody(msgs, false);\n\n      const { response, attempts, durationMs } = await merged.postChatCompletions(\n        body,\n        {\n          retries: merged.config.maxRetries,\n          baseDelayMs: merged.config.baseDelayMs,\n          maxDelayMs: merged.config.maxDelayMs,\n        }\n      );\n\n      const content = merged.pickFirstMessageContent(response);\n      if (content.trim().length === 0) {\n        throw new SensoryCompassError(\n          ErrorType.AI_EMPTY_RESPONSE,\n          'AI returned an empty response',\n          { code: 'AI_EMPTY_RESPONSE', recoverable: true, details: { responseModel: response.model } },\n        );\n      }\n      const usage = response.usage ?? { prompt_tokens: 0, completion_tokens: 0, total_tokens: 0 };\n      const cost = calculateCostEstimate(response.model || merged.config.modelName, usage);\n\n      logger.info('[OpenRouter] Request success', {\n        model: response.model,\n        usage,\n        cost,\n        metrics: { durationMs, attempts },\n      });\n\n      const resp = {\n        content,\n        raw: response,\n        usage,\n        cost,\n        metrics: { durationMs, attempts },\n      } as const;\n      try { aiMetrics.recordSuccess(durationMs); aiMetrics.recordRetries(attempts); } catch (e) { try { logger.warn('[OpenRouterClient] Success metrics failed', e as Error); } catch {} }\n      return resp as ChatResponse;\n    } catch (error) {\n      try { aiMetrics.recordFailure(); } catch (e) { try { logger.warn('[OpenRouterClient] Failure metrics failed', e as Error); } catch {} }\n      // Delegate to global error handler and rethrow wrapped\n      const wrapped = error instanceof SensoryCompassError\n        ? error\n        : new SensoryCompassError(\n            ErrorType.AI_API_FAILURE,\n            (error as Error)?.message || 'AI request failed',\n            { details: { error }, recoverable: true },\n          );\n      await errorHandler.handle(wrapped, { showToast: !options?.suppressToasts, logError: true });\n      throw wrapped;\n    }\n  }\n\n  // Public: chat with JSON-mode enabled and JSON parsing/validation\n  async chatJSON<TOut = unknown>(\n    input: ChatMessage[] | string | { system?: string; user: string },\n    configOptions?: Partial<OpenRouterClientConfig> & JsonModeOptions<TOut>,\n    requestOptions?: RequestOptions,\n  ): Promise<{ data: TOut; response: ChatResponse }>\n  {\n    const jsonMode = true;\n    const ensure = configOptions?.ensureJson ?? true;\n    try {\n      const merged = configOptions ? new OpenRouterClient({ ...this.config, ...configOptions }) : this;\n      const messages: ChatMessage[] = Array.isArray(input)\n        ? input\n        : typeof input === 'string'\n          ? [{ role: 'user', content: input }]\n          : [\n              ...(input.system ? [{ role: 'system', content: input.system }] as ChatMessage[] : []),\n              { role: 'user', content: input.user },\n            ];\n\n      const body = merged.buildRequestBody(messages, jsonMode);\n      const { response, attempts, durationMs } = await merged.postChatCompletions(\n        body,\n        {\n          retries: merged.config.maxRetries,\n          baseDelayMs: merged.config.baseDelayMs,\n          maxDelayMs: merged.config.maxDelayMs,\n        }\n      );\n\n      const text = merged.pickFirstMessageContent(response);\n      const trimmedText = text.trim();\n      \n      let value: TOut;\n      if (!ensure) {\n        // Skip JSON parsing/validation and return raw content\n        value = text as TOut;\n      } else {\n        // Enforce JSON parse/refine\n        let parsed = safeJSONParse<unknown>(text);\n        let hasToolArgs = false;\n        if (!parsed.ok) {\n          // 0) Tool/function-call style responses\n          try {\n            const toolArgs = (response as any)?.choices?.[0]?.message?.tool_calls?.[0]?.function?.arguments;\n            if (typeof toolArgs === 'string') {\n              const trimmedToolArgs = toolArgs.trim();\n              if (trimmedToolArgs.length > 0) {\n                hasToolArgs = true;\n                const pa = safeJSONParse<unknown>(toolArgs);\n                if (pa.ok) parsed = pa as any;\n              }\n            } else if (toolArgs && typeof toolArgs === 'object') {\n              hasToolArgs = true;\n              parsed = { ok: true, value: toolArgs } as any;\n            }\n          } catch {}\n\n          // 1) Fallback JSON extraction strategies on content text\n          if (!parsed.ok) {\n            try {\n              const { extractFirstJsonObject } = await import('./utils');\n              const attempt = extractFirstJsonObject<unknown>(text);\n              if (attempt.ok) {\n                parsed = { ok: true, value: attempt.value } as any;\n              }\n            } catch {}\n          }\n        }\n        if (!parsed.ok) {\n          try { aiMetrics.recordJsonParseError(); } catch (e) { try { logger.warn('[OpenRouterClient] JSON parse error metrics failed', e as Error); } catch {} }\n          if (trimmedText.length === 0 && !hasToolArgs) {\n            throw new SensoryCompassError(\n              ErrorType.AI_EMPTY_RESPONSE,\n              'AI returned an empty response',\n              { code: 'AI_EMPTY_RESPONSE', recoverable: true, details: { responseModel: response.model } }\n            );\n          }\n          throw new SensoryCompassError(\n            ErrorType.AI_INVALID_RESPONSE,\n            'AI returned invalid JSON response',\n            { code: 'AI_JSON_PARSE_ERROR', recoverable: true, details: { textSnippet: text.slice(0, 200) } }\n          );\n        }\n\n        if (configOptions?.refine) {\n          try {\n            value = configOptions.refine(parsed.value);\n            try { aiMetrics.recordJsonValid(); } catch (e) { try { logger.warn('[OpenRouterClient] JSON valid metrics failed', e as Error); } catch {} }\n          } catch (err) {\n            try { aiMetrics.recordJsonValidateError(); } catch (e) { try { logger.warn('[OpenRouterClient] JSON validate error metrics failed', e as Error); } catch {} }\n            throw new SensoryCompassError(\n              ErrorType.AI_INVALID_RESPONSE,\n              'AI returned JSON that failed validation',\n              { code: 'AI_JSON_VALIDATE_ERROR', details: { error: String(err) } }\n            );\n          }\n        } else {\n          value = parsed.value as TOut;\n          try { aiMetrics.recordJsonValid(); } catch (e) { try { logger.warn('[OpenRouterClient] JSON valid metrics failed', e as Error); } catch {} }\n        }\n      }\n      const usage = response.usage ?? { prompt_tokens: 0, completion_tokens: 0, total_tokens: 0 };\n      const cost = calculateCostEstimate(response.model || merged.config.modelName, usage);\n\n      logger.info('[OpenRouter] JSON-mode success', {\n        model: response.model,\n        usage,\n        cost,\n        metrics: { durationMs, attempts },\n      });\n\n      const resp: ChatResponse = {\n        content: text,\n        raw: response,\n        usage,\n        cost,\n        metrics: { durationMs, attempts },\n      };\n      try { aiMetrics.recordSuccess(durationMs); aiMetrics.recordRetries(attempts); } catch (e) { try { logger.warn('[OpenRouterClient] Success metrics failed', e as Error); } catch {} }\n      return { data: value, response: resp };\n    } catch (error) {\n      try { aiMetrics.recordFailure(); } catch (e) { try { logger.warn('[OpenRouterClient] Failure metrics failed', e as Error); } catch {} }\n      const wrapped = error instanceof SensoryCompassError\n        ? error\n        : new SensoryCompassError(\n            ErrorType.AI_API_FAILURE,\n            (error as Error)?.message || 'AI JSON request failed',\n            { details: { error }, recoverable: true },\n          );\n      await errorHandler.handle(wrapped, { showToast: !requestOptions?.suppressToasts, logError: true });\n      throw wrapped;\n    }\n  }\n}\n\n// Export a lightweight facade that reads fresh env each call\nexport const openRouterClient = {\n  chat: (...args: any[]) => {\n    // Respect per-call overrides passed as the second arg\n    const overrides = (args?.[1] ?? undefined) as Partial<OpenRouterClientConfig> | undefined;\n    const client = new OpenRouterClient(overrides);\n    return client.chat(...(args as Parameters<OpenRouterClient['chat']>));\n  },\n  chatJSON: (...args: any[]) => {\n    // Respect per-call overrides passed as the second arg\n    const overrides = (args?.[1] ?? undefined) as Partial<OpenRouterClientConfig> | undefined;\n    const client = new OpenRouterClient(overrides);\n    // Preserve generic behavior by delegating at runtime; callers retain typing via export cast below\n    return (client.chatJSON as any)(...args);\n  },\n} as {\n  chat: OpenRouterClient['chat'];\n  chatJSON: OpenRouterClient['chatJSON'];\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/ai/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/ai/utils.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'logger' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":16},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":4,"column":59,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":4,"endColumn":78},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1255,1258],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1255,1258],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2962,2965],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2962,2965],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { logger } from '@/lib/logger';\nimport type { CostEstimate, OpenRouterUsage, RetryOptions } from './types';\n\nexport const delay = (ms: number) => new Promise((res) => setTimeout(res, ms));\n\nexport function backoffDelay(attempt: number, base: number, max: number, jitter = true): number {\n  const exp = Math.min(max, base * Math.pow(2, attempt));\n  if (!jitter) return exp;\n  const rand = exp * (0.4 + Math.random() * 0.6); // 40% - 100% of exp\n  return Math.min(max, Math.max(base, rand));\n}\n\nexport function isRetriableStatus(status: number): boolean {\n  return status === 408 || status === 409 || status === 425 || status === 429 || (status >= 500 && status < 600);\n}\n\nexport async function retryWithExponentialBackoff<T>(\n  fn: (attempt: number) => Promise<T>,\n  options: RetryOptions,\n  onRetry?: (attempt: number, error: unknown, delayMs: number) => void,\n): Promise<T> {\n  const { retries, baseDelayMs, maxDelayMs } = options;\n  let lastError: unknown;\n  for (let attempt = 0; attempt <= retries; attempt++) {\n    try {\n      return await fn(attempt);\n    } catch (error) {\n      lastError = error;\n      if (attempt === retries) break;\n      \n      // Prefer retryAfterMs from error details if available\n      const retryAfterMs = (error as any)?.details?.retryAfterMs;\n      const delayMs = typeof retryAfterMs === 'number' && retryAfterMs > 0\n        ? Math.min(retryAfterMs, maxDelayMs)\n        : backoffDelay(attempt, baseDelayMs, maxDelayMs, true);\n      \n      onRetry?.(attempt, error, delayMs);\n      await delay(delayMs);\n    }\n  }\n  throw lastError;\n}\n\nexport function sanitizeHeadersForLog(headers: Record<string, string | undefined> | Headers | undefined): Record<string, string> {\n  const out: Record<string, string> = {};\n  if (!headers) return out;\n  const entries: [string, string][] = headers instanceof Headers ? Array.from(headers.entries()) : Object.entries(headers).filter(([, v]) => typeof v === 'string') as [string, string][];\n  for (const [k, v] of entries) {\n    const key = k.toLowerCase();\n    if (key === 'authorization' || key === 'x-api-key') {\n      out[k] = 'REDACTED';\n    } else {\n      out[k] = v;\n    }\n  }\n  return out;\n}\n\nexport function sanitizeBodyForLog(body: unknown): unknown {\n  try {\n    if (typeof body === 'string') {\n      const maybe = JSON.parse(body);\n      return sanitizeBodyForLog(maybe);\n    }\n    if (body && typeof body === 'object') {\n      const obj = Array.isArray(body) ? [...body] : { ...(body as Record<string, unknown>) };\n      const redactKeys = ['apiKey', 'api_key', 'Authorization', 'authorization'];\n      for (const key of Object.keys(obj as Record<string, unknown>)) {\n        if (redactKeys.includes(key)) {\n          (obj as Record<string, unknown>)[key] = 'REDACTED';\n        } else {\n          const val = (obj as Record<string, unknown>)[key];\n          if (val && typeof val === 'object') {\n            (obj as Record<string, unknown>)[key] = sanitizeBodyForLog(val) as any;\n          }\n        }\n      }\n      return obj;\n    }\n    return body;\n  } catch {\n    return '[unserializable body]';\n  }\n}\n\nexport function sanitizeRequestForLog(input: {\n  url: string;\n  method?: string;\n  headers?: Record<string, string> | Headers;\n  body?: unknown;\n}) {\n  return {\n    url: input.url,\n    method: input.method || 'GET',\n    headers: sanitizeHeadersForLog(input.headers),\n    body: sanitizeBodyForLog(input.body),\n  };\n}\n\n// Basic price registry (per 1K tokens) for rough cost estimation.\n// Values are indicative and can be adjusted as needed.\nconst PRICE_PER_1K: Record<string, { input: number; output: number }> = {\n  // OpenAI models (example, adjust as needed)\n  'gpt-4o': { input: 5.0, output: 15.0 },\n  'gpt-4o-mini': { input: 0.15, output: 0.6 },\n  // Anthropic models (example)\n  'claude-3.5-sonnet': { input: 3.0, output: 15.0 },\n};\n\nexport function calculateCostEstimate(model: string, usage?: OpenRouterUsage): CostEstimate | undefined {\n  if (!usage) return undefined;\n  const price = PRICE_PER_1K[model] || PRICE_PER_1K[model.toLowerCase()];\n  const inputTokens = usage.prompt_tokens ?? 0;\n  const outputTokens = usage.completion_tokens ?? 0;\n  const totalTokens = usage.total_tokens ?? inputTokens + outputTokens;\n  if (!price) {\n    return {\n      model,\n      inputTokens,\n      outputTokens,\n      totalTokens,\n      inputCostUSD: 0,\n      outputCostUSD: 0,\n      totalCostUSD: 0,\n    };\n  }\n  const inputCostUSD = (inputTokens / 1000) * price.input;\n  const outputCostUSD = (outputTokens / 1000) * price.output;\n  return {\n    model,\n    inputTokens,\n    outputTokens,\n    totalTokens,\n    inputCostUSD,\n    outputCostUSD,\n    totalCostUSD: inputCostUSD + outputCostUSD,\n  };\n}\n\nexport function safeJSONParse<T = unknown>(text: string): { ok: true; value: T } | { ok: false; error: Error } {\n  try {\n    return { ok: true, value: JSON.parse(text) as T };\n  } catch (error) {\n    return { ok: false, error: error as Error };\n  }\n}\n\n/**\n * Attempt to extract the first JSON object from arbitrary LLM text.\n * Handles common cases like code fences (```json ... ```), leading/trailing prose,\n * and nested braces within quoted strings.\n */\nexport function extractFirstJsonObject<T = unknown>(text: string): { ok: true; value: T } | { ok: false; error: Error } {\n  try {\n    const s = (text || '').trim();\n    if (!s) return { ok: false, error: new Error('Empty text') };\n\n    // 1) Code-fence extraction\n    const fenceMatch = s.match(/```\\s*json\\s*([\\s\\S]*?)```/i) || s.match(/```\\s*([\\s\\S]*?)```/i);\n    if (fenceMatch && fenceMatch[1]) {\n      const fenced = fenceMatch[1].trim();\n      const parsed = safeJSONParse<T>(fenced);\n      if (parsed.ok) return parsed;\n    }\n\n    // 2) Balanced-brace scanning (find first top-level {...})\n    const firstObj = (() => {\n      let start = -1;\n      let depth = 0;\n      let inString = false;\n      let escape = false;\n      for (let i = 0; i < s.length; i++) {\n        const ch = s[i];\n        if (start === -1) {\n          if (ch === '{') { start = i; depth = 1; inString = false; escape = false; }\n          continue;\n        }\n        if (escape) { escape = false; continue; }\n        if (inString) {\n          if (ch === '\\\\') { escape = true; }\n          else if (ch === '\"') { inString = false; }\n          continue;\n        }\n        if (ch === '\"') { inString = true; continue; }\n        if (ch === '{') depth++;\n        else if (ch === '}') {\n          depth--;\n          if (depth === 0) return s.slice(start, i + 1);\n        }\n      }\n      return '';\n    })();\n    if (firstObj) {\n      const parsed = safeJSONParse<T>(firstObj);\n      if (parsed.ok) return parsed;\n    }\n\n    // 3) If text itself is a JSON string with stray characters, try trimming non-JSON prefix/suffix\n    const startIdx = s.indexOf('{');\n    const endIdx = s.lastIndexOf('}');\n    if (startIdx !== -1 && endIdx !== -1 && endIdx > startIdx) {\n      const slice = s.slice(startIdx, endIdx + 1);\n      const parsed = safeJSONParse<T>(slice);\n      if (parsed.ok) return parsed;\n    }\n\n    return { ok: false, error: new Error('No JSON object found') };\n  } catch (error) {\n    return { ok: false, error: error as Error };\n  }\n}\n\nexport function buildAbortController(timeoutMs: number): { controller: AbortController; timeoutId: ReturnType<typeof setTimeout> } {\n  const controller = new AbortController();\n  const timeoutId = globalThis.setTimeout(() => controller.abort(), Math.max(1, timeoutMs));\n  return { controller, timeoutId };\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/aiConfig.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2028,2031],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2028,2031],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { \n  AI_ANALYSIS_ENABLED,\n  AI_MODEL_NAME,\n  AI_TEMPERATURE,\n  AI_MAX_TOKENS,\n  OPENROUTER_API_KEY,\n  AI_LOCAL_ONLY,\n} from '@/lib/env';\nimport { logger } from '@/lib/logger';\n\nexport interface AiConfig {\n  // Global enable flag for AI analysis features\n  enabled: boolean;\n\n  // Model + sampling controls\n  modelName: string;\n  temperature: number; // [0,2]\n  maxTokens: number;   // > 0\n  topP: number;        // (0,1]\n\n  // Network + safety\n  timeoutMs: number;       // request timeout\n  allowedModels: string[]; // whitelist of allowed model IDs\n  apiKey?: string;         // provider key (e.g., OpenRouter)\n  baseUrl?: string;        // OpenAI-compatible base URL (e.g., OpenRouter or local LM Studio)\n  localOnly?: boolean;     // Force local-only usage\n}\n\nconst clamp = (val: number, min: number, max: number) => Math.max(min, Math.min(max, val));\n\n// Canonical list of allowed models for validation (independent of runtime fallback behavior)\nexport const CANONICAL_ALLOWED_MODELS = [\n  'gpt-5',\n  'gpt-4o-mini',\n  'gpt-4o',\n  'claude-3.5-sonnet',\n  // Vendor-prefixed model IDs used by OpenRouter\n  'openai/gpt-5-mini',\n  'openai/gpt-4o-mini'\n] as const;\n\nexport const DEFAULT_AI_CONFIG: AiConfig = {\n  enabled: AI_ANALYSIS_ENABLED,\n  modelName: AI_MODEL_NAME,\n  temperature: clamp(AI_TEMPERATURE, 0, 2),\n  maxTokens: AI_MAX_TOKENS > 0 ? AI_MAX_TOKENS : 1024,\n  topP: 1.0,\n  timeoutMs: 30_000,\n  allowedModels: Array.from(new Set([\n    AI_MODEL_NAME,\n    'gpt-5',\n    'gpt-5-mini',\n    'gpt-4o-mini',\n    'gpt-4o',\n    'claude-3.5-sonnet',\n    'openai/gpt-5-mini',\n  ])),\n  apiKey: OPENROUTER_API_KEY || undefined,\n  baseUrl: undefined,\n  localOnly: AI_LOCAL_ONLY,\n};\n\n/**\n * Load AI configuration using environment defaults with optional runtime overrides.\n * Priority: overrides > env defaults.\n */\nexport function loadAiConfig(overrides?: Partial<AiConfig>): AiConfig {\n  // Re-read live Vite env each call to avoid stale defaults after .env changes/HMR\n  const env: Record<string, unknown> = (import.meta as any)?.env ?? {};\n  const toBool = (v: unknown) => {\n    const s = (v ?? '').toString().toLowerCase();\n    return s === '1' || s === 'true' || s === 'yes';\n  };\n  const enabled = toBool(env.VITE_AI_ANALYSIS_ENABLED);\n  const modelName = typeof env.VITE_AI_MODEL_NAME === 'string' && env.VITE_AI_MODEL_NAME.trim().length > 0\n    ? (env.VITE_AI_MODEL_NAME as string)\n    : DEFAULT_AI_CONFIG.modelName;\n  const apiKey = typeof env.VITE_OPENROUTER_API_KEY === 'string' && (env.VITE_OPENROUTER_API_KEY as string).trim().length > 0\n    ? (env.VITE_OPENROUTER_API_KEY as string)\n    : (OPENROUTER_API_KEY || undefined);\n  const baseUrl = typeof env.VITE_AI_BASE_URL === 'string' && (env.VITE_AI_BASE_URL as string).trim().length > 0\n    ? (env.VITE_AI_BASE_URL as string)\n    : 'https://openrouter.ai/api/v1';\n  const localOnly = (() => {\n    const v = (env.VITE_AI_LOCAL_ONLY ?? '').toString().toLowerCase();\n    return v === '1' || v === 'true' || v === 'yes' || AI_LOCAL_ONLY;\n  })();\n\n  const runtimeBase: AiConfig = {\n    ...DEFAULT_AI_CONFIG,\n    enabled,\n    modelName,\n    apiKey,\n    baseUrl,\n    localOnly,\n  };\n\n  const merged: AiConfig = {\n    ...runtimeBase,\n    ...overrides,\n  } as AiConfig;\n\n  // Normalize/guard values\n  merged.temperature = clamp(Number(merged.temperature ?? DEFAULT_AI_CONFIG.temperature), 0, 2);\n  const maxTok = Number(merged.maxTokens ?? DEFAULT_AI_CONFIG.maxTokens);\n  merged.maxTokens = Number.isFinite(maxTok) && maxTok > 0 ? maxTok : DEFAULT_AI_CONFIG.maxTokens;\n  const topP = Number(merged.topP ?? DEFAULT_AI_CONFIG.topP);\n  merged.topP = Number.isFinite(topP) ? clamp(topP, 0, 1) : DEFAULT_AI_CONFIG.topP;\n  merged.timeoutMs = Number.isFinite(Number(merged.timeoutMs)) && Number(merged.timeoutMs) > 0\n    ? Number(merged.timeoutMs)\n    : DEFAULT_AI_CONFIG.timeoutMs;\n\n  if (!Array.isArray(merged.allowedModels) || merged.allowedModels.length === 0) {\n    merged.allowedModels = [...DEFAULT_AI_CONFIG.allowedModels];\n  } else {\n    // Ensure model names are strings and unique\n    merged.allowedModels = Array.from(new Set(\n      merged.allowedModels.filter((m): m is string => typeof m === 'string' && m.trim().length > 0)\n    ));\n  }\n\n  // If apiKey is an empty string, normalize to undefined for downstream checks\n  if (typeof merged.apiKey === 'string' && merged.apiKey.trim() === '') {\n    merged.apiKey = undefined;\n  }\n\n  if (typeof merged.baseUrl !== 'string' || merged.baseUrl.trim() === '') {\n    merged.baseUrl = 'https://openrouter.ai/api/v1';\n  }\n\n  // Validate modelName against allowedModels (case-insensitive).\n  // Accept vendor-prefixed IDs by stripping known prefixes during comparison.\n  try {\n    const normalize = (m: string) => m.replace(/^openai\\//i, '').toLowerCase();\n    const allowedLc = new Set((merged.allowedModels || []).map(m => normalize(m)));\n    const modelLc = normalize(merged.modelName || '');\n    if (!allowedLc.has(modelLc)) {\n      const fallback = merged.allowedModels[0] || 'gpt-5';\n      logger.warn('[aiConfig.loadAiConfig] Invalid modelName; falling back', {\n        requested: merged.modelName,\n        allowed: merged.allowedModels,\n        fallback,\n      });\n      merged.modelName = fallback;\n    }\n  } catch {\n    // Fail-soft: if anything goes wrong, ensure a sensible default\n    if (!merged.modelName || typeof merged.modelName !== 'string') {\n      merged.modelName = 'gpt-5';\n    }\n  }\n\nreturn merged;\n}\n\n// --- Startup validation utilities ---\n/** Minimum length guard for OpenRouter API keys (basic heuristic). */\nexport const MIN_OPENROUTER_API_KEY_LENGTH = 20;\n\n/** Retrieve the current list of allowed models using live env. */\nexport function getAllowedModels(): string[] {\n  try {\n    return loadAiConfig().allowedModels || DEFAULT_AI_CONFIG.allowedModels;\n  } catch {\n    return DEFAULT_AI_CONFIG.allowedModels;\n  }\n}\n\n/** Case-insensitive model name validation against allowed models. */\nexport function isValidModelName(modelName: string): boolean {\n  try {\n    const allowed = getAllowedModels().map(m => (m || '').toLowerCase());\n    return allowed.includes((modelName || '').toLowerCase());\n  } catch {\n    return false;\n  }\n}\n\n/** Return specific errors for model name validation. */\nexport function getModelValidationErrors(modelName: string): string[] {\n  const errs: string[] = [];\n  const name = (modelName || '').trim();\n  if (name.length === 0) errs.push('AI model name is required');\n  if (!isValidModelName(name)) errs.push(`Model \"${name}\" is not in the allowed models list`);\n  return errs;\n}\n\n/** Basic API key format validation. */\nexport function isValidApiKey(apiKey: string | null | undefined): boolean {\n  const s = (apiKey || '').trim();\n  if (s.length < MIN_OPENROUTER_API_KEY_LENGTH) return false;\n  // Heuristic pattern check (non-strict): key should have at least one hyphen or underscore\n  if (!/[A-Za-z0-9]([-_][A-Za-z0-9])+/i.test(s)) return false;\n  return true;\n}\n\n/** Detailed API key validation errors. */\nexport function getApiKeyValidationErrors(apiKey: string | null | undefined): string[] {\n  const errs: string[] = [];\n  const s = (apiKey || '').trim();\n  if (s.length < MIN_OPENROUTER_API_KEY_LENGTH) errs.push(`API key too short (min ${MIN_OPENROUTER_API_KEY_LENGTH} chars)`);\n  if (!/[A-Za-z0-9]([-_][A-Za-z0-9])+/i.test(s)) errs.push('API key format appears invalid');\n  return errs;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/alertSystem.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/alertSystem.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analysis/aiSchema.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analysis/analysisEngine.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analysis/compareUtils.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2807,2810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2807,2810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":119,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3590,3593],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3590,3593],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4429,4432],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4429,4432],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":141,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4788,4791],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4788,4791],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":161,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5638,5641],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5638,5641],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":161,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5680,5683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5680,5683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":162,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5751,5754],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5751,5754],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":162,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5794,5797],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5794,5797],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5867,5870],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5867,5870],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5919,5922],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5919,5922],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":166,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6001,6004],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6001,6004],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":166,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6046,6049],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6046,6049],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":167,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6110,6113],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6110,6113],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":167,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6156,6159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6156,6159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":177,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6542,6545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6542,6545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":178,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6574,6577],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6574,6577],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":217,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7979,7982],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7979,7982],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":218,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":218,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8003,8006],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8003,8006],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":266,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":266,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9771,9774],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9771,9774],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":267,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":267,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9816,9819],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9816,9819],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":20,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { AnalyticsResultsAI } from \"@/lib/analysis/analysisEngine\";\nimport type { AiIntervention as AiInterventionType } from \"@/lib/analysis/aiSchema\";\n\n// Local re-typed shapes to normalize across AI and heuristic forms\ntype Severity = \"low\" | \"medium\" | \"high\";\n\nexport interface DeltaNumber {\n  current: number | null;\n  baseline: number | null;\n  delta: number | null;\n  deltaPct: number | null;\n}\n\nexport interface SummaryDiff {\n  counts: {\n    patterns: DeltaNumber;\n    correlations: DeltaNumber;\n    insights: DeltaNumber;\n    anomalies: DeltaNumber;\n    predictive: DeltaNumber;\n  };\n  recencyMs?: DeltaNumber; // based on ai.createdAt if available\n  balance?: DeltaNumber; // time-of-day balance percentage\n  avgIntensity?: DeltaNumber; // average intensity if available\n}\n\nexport interface NormalizedPattern {\n  name: string;\n  strength?: number; // 0-1\n  impact?: Severity;\n}\n\nexport interface PatternChange {\n  key: string;\n  baseline?: NormalizedPattern;\n  current?: NormalizedPattern;\n  deltaStrength?: number | null;\n  impactChange?: { from?: Severity; to?: Severity } | null;\n}\n\nexport interface PatternsDiffResult {\n  added: NormalizedPattern[];\n  removed: NormalizedPattern[];\n  changed: PatternChange[];\n}\n\nexport interface NormalizedCorrelation {\n  key: string; // normalized variables key, e.g., \"a|b\"\n  variables: [string, string];\n  coefficient?: number; // -1..1\n  direction?: \"positive\" | \"negative\";\n  pValue?: number; // 0..1\n}\n\nexport interface CorrelationChange {\n  key: string;\n  baseline?: NormalizedCorrelation;\n  current?: NormalizedCorrelation;\n  deltaCoefficient?: number | null;\n  directionChanged?: boolean;\n  significanceCrossed?: boolean; // crossed typical threshold (0.05)\n}\n\nexport interface CorrelationsDiffResult {\n  added: NormalizedCorrelation[];\n  removed: NormalizedCorrelation[];\n  changed: CorrelationChange[];\n}\n\nexport interface NormalizedIntervention {\n  title: string;\n  confidenceOverall?: number; // 0-1\n}\n\nexport interface InterventionsDiffResult {\n  added: NormalizedIntervention[];\n  removed: NormalizedIntervention[];\n  changed: Array<{\n    title: string;\n    baseline?: NormalizedIntervention;\n    current?: NormalizedIntervention;\n    deltaConfidence?: number | null;\n  }>;\n}\n\nexport interface KeyFindingsDiffResult {\n  added: string[];\n  removed: string[];\n  unchanged: string[];\n}\n\nfunction toDeltaNumber(current: number | null, baseline: number | null): DeltaNumber {\n  if (current == null || baseline == null) {\n    return { current, baseline, delta: null, deltaPct: null };\n  }\n  const delta = current - baseline;\n  const pct = baseline === 0 ? null : (delta / baseline) * 100;\n  return { current, baseline, delta, deltaPct: pct };\n}\n\nfunction normalizePattern(input: unknown): NormalizedPattern | undefined {\n  const obj = input as any;\n  if (!obj) return undefined;\n  const name: string | undefined =\n    typeof obj.name === \"string\" ? obj.name : typeof obj.pattern === \"string\" ? obj.pattern : undefined;\n  if (!name) return undefined;\n  const strength: number | undefined = typeof obj.strength === \"number\" ? obj.strength : typeof obj.confidence === \"number\" ? obj.confidence : undefined;\n  const impact: Severity | undefined =\n    typeof obj.impact === \"string\" ? (obj.impact as Severity) :\n    typeof obj.expectedImpact === \"string\" ? (obj.expectedImpact as Severity) : undefined;\n  return { name, strength, impact };\n}\n\nfunction keyForName(name: string): string {\n  return name.trim().toLowerCase();\n}\n\nfunction normalizeCorrelation(input: unknown): NormalizedCorrelation | undefined {\n  const obj = input as any;\n  if (!obj) return undefined;\n  let v1: string | undefined;\n  let v2: string | undefined;\n  if (Array.isArray(obj.variables) && obj.variables.length === 2) {\n    v1 = String(obj.variables[0] ?? \"\");\n    v2 = String(obj.variables[1] ?? \"\");\n  } else if (typeof obj.factor1 === \"string\" && typeof obj.factor2 === \"string\") {\n    v1 = obj.factor1;\n    v2 = obj.factor2;\n  }\n  if (!v1 || !v2) return undefined;\n  const vars = [v1.trim(), v2.trim()].sort((a, b) => a.localeCompare(b)) as [string, string];\n  const key = `${vars[0]}|${vars[1]}`.toLowerCase();\n  const coefficient: number | undefined = typeof obj.coefficient === \"number\" ? obj.coefficient : typeof obj.correlation === \"number\" ? obj.correlation : undefined;\n  const direction: \"positive\" | \"negative\" | undefined =\n    typeof obj.direction === \"string\" ? (obj.direction as any) : coefficient != null ? (coefficient >= 0 ? \"positive\" : \"negative\") : undefined;\n  const pValue: number | undefined = typeof obj.pValue === \"number\" ? obj.pValue : undefined;\n  return { key, variables: vars, coefficient, direction, pValue };\n}\n\nfunction normalizeIntervention(input: unknown): NormalizedIntervention | undefined {\n  const obj = input as any;\n  if (!obj) return undefined;\n  const title: string | undefined = typeof obj.title === \"string\" ? obj.title : undefined;\n  if (!title) return undefined;\n  const confidenceOverall: number | undefined =\n    typeof obj.confidence?.overall === \"number\" ? obj.confidence.overall : undefined;\n  return { title, confidenceOverall };\n}\n\nexport function diffSummary(\n  current: AnalyticsResultsAI, \n  baseline: AnalyticsResultsAI,\n  currentBalance?: number | null,\n  baselineBalance?: number | null,\n  currentAvgIntensity?: number | null,\n  baselineAvgIntensity?: number | null\n): SummaryDiff {\n  const counts = {\n    patterns: toDeltaNumber(current?.patterns?.length ?? 0, baseline?.patterns?.length ?? 0),\n    correlations: toDeltaNumber(current?.correlations?.length ?? 0, baseline?.correlations?.length ?? 0),\n    insights: toDeltaNumber((current as any)?.insights?.length ?? 0, (baseline as any)?.insights?.length ?? 0),\n    anomalies: toDeltaNumber((current as any)?.anomalies?.length ?? 0, (baseline as any)?.anomalies?.length ?? 0),\n    predictive: toDeltaNumber((current as any)?.predictiveInsights?.length ?? 0, (baseline as any)?.predictiveInsights?.length ?? 0),\n  };\n\n  const createdAtCurr = (current as any)?.ai?.createdAt ? Date.parse((current as any).ai.createdAt) : null;\n  const createdAtBase = (baseline as any)?.ai?.createdAt ? Date.parse((baseline as any).ai.createdAt) : null;\n  const recencyMs = toDeltaNumber(createdAtCurr, createdAtBase);\n\n  const balance = toDeltaNumber(currentBalance ?? null, baselineBalance ?? null);\n  const avgIntensity = toDeltaNumber(currentAvgIntensity ?? null, baselineAvgIntensity ?? null);\n\n  return { counts, recencyMs, balance, avgIntensity };\n}\n\nexport function diffPatterns(\n  currentPatterns: Array<any>,\n  baselinePatterns: Array<any>\n): PatternsDiffResult {\n  const currentMap = new Map<string, NormalizedPattern>();\n  for (const p of currentPatterns || []) {\n    const n = normalizePattern(p);\n    if (n) currentMap.set(keyForName(n.name), n);\n  }\n  const baselineMap = new Map<string, NormalizedPattern>();\n  for (const p of baselinePatterns || []) {\n    const n = normalizePattern(p);\n    if (n) baselineMap.set(keyForName(n.name), n);\n  }\n\n  const added: NormalizedPattern[] = [];\n  const removed: NormalizedPattern[] = [];\n  const changed: PatternChange[] = [];\n\n  const allKeys = new Set<string>([...Array.from(currentMap.keys()), ...Array.from(baselineMap.keys())]);\n  for (const key of allKeys) {\n    const c = currentMap.get(key);\n    const b = baselineMap.get(key);\n    if (c && !b) {\n      added.push(c);\n    } else if (!c && b) {\n      removed.push(b);\n    } else if (c && b) {\n      const deltaStrength = (c.strength != null && b.strength != null) ? c.strength - b.strength : null;\n      const impactChange = c.impact !== b.impact ? { from: b.impact, to: c.impact } : null;\n      const meaningfulStrengthChange = deltaStrength !== null && Math.abs(deltaStrength) > 1e-6;\n      if (meaningfulStrengthChange || impactChange) {\n        changed.push({ key, baseline: b, current: c, deltaStrength, impactChange });\n      }\n    }\n  }\n\n  return { added, removed, changed };\n}\n\nexport function diffCorrelations(\n  current: Array<any>,\n  baseline: Array<any>\n): CorrelationsDiffResult {\n  const currentMap = new Map<string, NormalizedCorrelation>();\n  for (const c of current || []) {\n    const n = normalizeCorrelation(c);\n    if (n) currentMap.set(n.key, n);\n  }\n  const baselineMap = new Map<string, NormalizedCorrelation>();\n  for (const c of baseline || []) {\n    const n = normalizeCorrelation(c);\n    if (n) baselineMap.set(n.key, n);\n  }\n\n  const added: NormalizedCorrelation[] = [];\n  const removed: NormalizedCorrelation[] = [];\n  const changed: CorrelationChange[] = [];\n\n  const allKeys = new Set<string>([...Array.from(currentMap.keys()), ...Array.from(baselineMap.keys())]);\n  for (const key of allKeys) {\n    const c = currentMap.get(key);\n    const b = baselineMap.get(key);\n    if (c && !b) {\n      added.push(c);\n    } else if (!c && b) {\n      removed.push(b);\n    } else if (c && b) {\n      const deltaCoefficient = (c.coefficient != null && b.coefficient != null) ? c.coefficient - b.coefficient : null;\n      const directionChanged = c.direction !== b.direction;\n      const significanceCrossed = (() => {\n        const thr = 0.05;\n        if (typeof c.pValue === \"number\" && typeof b.pValue === \"number\") {\n          const bSig = b.pValue <= thr;\n          const cSig = c.pValue <= thr;\n          return bSig !== cSig;\n        }\n        return false;\n      })();\n      const meaningfulCoefficientChange = deltaCoefficient !== null && Math.abs(deltaCoefficient) > 1e-6;\n      if (meaningfulCoefficientChange || directionChanged || significanceCrossed) {\n        changed.push({ key, baseline: b, current: c, deltaCoefficient, directionChanged, significanceCrossed });\n      }\n    }\n  }\n\n  return { added, removed, changed };\n}\n\nexport function diffInterventions(\n  current: Array<AiInterventionType | any>,\n  baseline: Array<AiInterventionType | any>\n): InterventionsDiffResult {\n  const currentMap = new Map<string, NormalizedIntervention>();\n  for (const i of current || []) {\n    const n = normalizeIntervention(i);\n    if (n) currentMap.set(n.title.toLowerCase(), n);\n  }\n  const baselineMap = new Map<string, NormalizedIntervention>();\n  for (const i of baseline || []) {\n    const n = normalizeIntervention(i);\n    if (n) baselineMap.set(n.title.toLowerCase(), n);\n  }\n\n  const added: NormalizedIntervention[] = [];\n  const removed: NormalizedIntervention[] = [];\n  const changed: Array<{ title: string; baseline?: NormalizedIntervention; current?: NormalizedIntervention; deltaConfidence?: number | null; }> = [];\n\n  const allTitles = new Set<string>([...Array.from(currentMap.keys()), ...Array.from(baselineMap.keys())]);\n  for (const key of allTitles) {\n    const c = currentMap.get(key);\n    const b = baselineMap.get(key);\n    if (c && !b) {\n      added.push(c);\n    } else if (!c && b) {\n      removed.push(b);\n    } else if (c && b) {\n      const deltaConfidence = (c.confidenceOverall != null && b.confidenceOverall != null)\n        ? c.confidenceOverall - b.confidenceOverall\n        : null;\n      if (deltaConfidence !== null && Math.abs(deltaConfidence) > 0) {\n        changed.push({ title: c.title, baseline: b, current: c, deltaConfidence });\n      }\n    }\n  }\n\n  return { added, removed, changed };\n}\n\nexport function diffKeyFindings(current: string[] = [], baseline: string[] = []): KeyFindingsDiffResult {\n  const currentSet = new Set(current.map((s) => s.trim()));\n  const baselineSet = new Set(baseline.map((s) => s.trim()));\n  const added = Array.from(currentSet).filter((s) => !baselineSet.has(s));\n  const removed = Array.from(baselineSet).filter((s) => !currentSet.has(s));\n  const unchanged = Array.from(currentSet).filter((s) => baselineSet.has(s));\n  return { added, removed, unchanged };\n}\n\n\n\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analysis/dateHelpers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analysis/heuristicAnalysisEngine.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2694,2697],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2694,2697],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2734,2737],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2734,2737],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":64,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2776,2779],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2776,2779],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":103,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4364,4367],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4364,4367],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":184,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8048,8051],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8048,8051],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { dataStorage } from '@/lib/dataStorage';\nimport { analyticsConfig, PRESET_CONFIGS, ANALYTICS_CONFIG, type AnalyticsConfiguration } from '@/lib/analyticsConfig';\nimport { computeInsights, type ComputeInsightsInputs, type ComputeInsightsOptions } from '@/lib/insights/unified';\nimport { logger } from '@/lib/logger';\n\nimport type { EmotionEntry, SensoryEntry, TrackingEntry, Goal } from '@/types/student';\nimport type { AnalyticsResults } from '@/types/analytics';\nimport type { AnalysisEngine, TimeRange, AnalysisOptions, AnalyticsResultsAI } from './analysisEngine';\n\n/**\n * Safely converts a Date, string, or undefined input to a Date object.\n * Returns undefined for invalid dates to prevent filtering errors.\n * @param input - The input to convert (Date, string, or undefined)\n * @returns A valid Date object or undefined for invalid/missing input\n */\nfunction toDate(input: Date | string | undefined): Date | undefined {\n  if (!input) return undefined;\n  const d = input instanceof Date ? input : new Date(input);\n  return isNaN(d.getTime()) ? undefined : d;\n}\n\n/**\n * Checks if a timestamp falls within the specified date range.\n * @param ts - The timestamp to check\n * @param start - Optional start date (inclusive). If undefined, no lower bound is applied\n * @param end - Optional end date (inclusive). If undefined, no upper bound is applied\n * @returns True if the timestamp is within the range, false otherwise\n */\nfunction withinRange(ts: Date, start?: Date, end?: Date): boolean {\n  const t = ts.getTime();\n  const s = start ? start.getTime() : -Infinity;\n  const e = end ? end.getTime() : Infinity;\n  return t >= s && t <= e;\n}\n\n/**\n * Builds a safe default AnalyticsResults object with empty arrays for all required fields.\n * Used as a fallback when analysis fails or for error states.\n * @param partial - Optional partial results to merge with the defaults\n * @returns A complete AnalyticsResultsAI object with all required fields initialized\n */\nfunction buildSafeResults(partial?: Partial<AnalyticsResults>): AnalyticsResultsAI {\n  const base: AnalyticsResults = {\n    patterns: [],\n    correlations: [],\n    environmentalCorrelations: [],\n    predictiveInsights: [],\n    anomalies: [],\n    insights: [],\n    suggestedInterventions: [],\n    ...partial,\n  } as AnalyticsResults;\n  return base as AnalyticsResultsAI;\n}\n\n/**\n * Recursively merges source object into target object, creating a deep merge.\n * Arrays are replaced entirely rather than merged element-wise.\n * @param target - The target object to merge into\n * @param source - The source object to merge from\n * @returns A new object with the merged properties\n */\nfunction deepMerge<T extends Record<string, any>>(target: T, source: Record<string, any>): T {\n  const result: Record<string, any> = Array.isArray(target) ? [...target] : { ...target };\n  for (const [key, value] of Object.entries(source || {})) {\n    if (value && typeof value === 'object' && !Array.isArray(value)) {\n      const current = result[key];\n      result[key] = deepMerge(current && typeof current === 'object' ? current : {}, value);\n    } else {\n      result[key] = value;\n    }\n  }\n  return result as T;\n}\n\n/**\n * Applies analysis options to a base analytics configuration, preserving the base config\n * while merging in preset configurations and overrides.\n * @param base - The base analytics configuration to start with\n * @param options - Optional analysis options containing profile, features, and overrides\n * @returns The merged configuration with all options applied\n */\nfunction applyOptionsToConfig(base: AnalyticsConfiguration, options?: AnalysisOptions): AnalyticsConfiguration {\n  if (!options) return base;\n\n  let cfg = { ...base } as AnalyticsConfiguration;\n\n  // Profile preset (if matches known presets) - now preserves base config via deepMerge\n  if (options.profile && (options.profile in PRESET_CONFIGS)) {\n    const preset = PRESET_CONFIGS[options.profile as keyof typeof PRESET_CONFIGS];\n    if (preset?.config) {\n      cfg = deepMerge(cfg, preset.config);\n    }\n  }\n\n  // Feature flag overrides\n  if (options.features && Object.keys(options.features).length) {\n    cfg = deepMerge(cfg, { features: options.features });\n  }\n\n  // Arbitrary overrides\n  if (options.overrides && Object.keys(options.overrides).length) {\n    cfg = deepMerge(cfg, options.overrides as Record<string, any>);\n  }\n\n  return cfg;\n}\n\n/**\n * Heuristic-based analytics engine that provides student behavior analysis\n * using rule-based algorithms and statistical methods.\n */\nexport class HeuristicAnalysisEngine implements AnalysisEngine {\n  /**\n   * Analyzes a student's tracking data to generate insights, patterns, and predictions.\n   * Uses consistent date parsing via getEntriesForStudent and optimized timeframe filtering.\n   * @param studentId - The unique identifier of the student to analyze\n   * @param timeframe - Optional date range to limit the analysis to specific time period\n   * @param options - Optional analysis configuration including presets and feature overrides\n   * @returns Promise resolving to comprehensive analytics results with AI metadata\n   */\n  async analyzeStudent(\n    studentId: string,\n    timeframe?: TimeRange,\n    options?: AnalysisOptions\n  ): Promise<AnalyticsResultsAI> {\n    // Validate input early\n    if (!studentId || typeof studentId !== 'string') {\n      logger.error('[HeuristicAnalysisEngine] analyzeStudent: invalid studentId', { studentId });\n      return buildSafeResults({ error: 'INVALID_STUDENT_ID' });\n    }\n\n    try {\n      // Fetch data using getEntriesForStudent for consistent date parsing and ordering\n      const trackingEntriesAll: TrackingEntry[] = dataStorage.getEntriesForStudent(studentId) || [];\n      const goals: Goal[] = dataStorage.getGoalsForStudent(studentId) || [];\n\n      // Safe timeframe handling with NaN protection\n      const start = toDate(timeframe?.start);\n      const end = toDate(timeframe?.end);\n\n      // Filter tracking entries by timeframe (dates already parsed by getEntriesForStudent)\n      const trackingEntries: TrackingEntry[] = (start || end)\n        ? trackingEntriesAll.filter((e) => withinRange(e.timestamp, start, end))\n        : trackingEntriesAll;\n\n      // Extract emotions/sensory without redundant timeframe filtering\n      const emotions: EmotionEntry[] = (start || end)\n        ? trackingEntries.flatMap((entry) => (entry.emotions || []))\n        : trackingEntriesAll.flatMap((entry) => (entry.emotions || []));\n\n      const sensoryInputs: SensoryEntry[] = (start || end)\n        ? trackingEntries.flatMap((entry) => (entry.sensoryInputs || []))\n        : trackingEntriesAll.flatMap((entry) => (entry.sensoryInputs || []));\n\n      // Resolve configuration with overrides\n      const liveConfig = (() => {\n        try { return analyticsConfig.getConfig(); } catch { return ANALYTICS_CONFIG as unknown as AnalyticsConfiguration; }\n      })();\n      const mergedConfig = applyOptionsToConfig(liveConfig as AnalyticsConfiguration, options);\n\n      // Prepare inputs for unified insights\n      const inputs: ComputeInsightsInputs = { entries: trackingEntries, emotions, sensoryInputs, goals };\n      const computeOptions: ComputeInsightsOptions = { config: mergedConfig };\n\n      // Delegate to unified insights computation\n      const results = await computeInsights(inputs, computeOptions);\n\n      // Optionally attach lightweight AI metadata for lineage/traceability\n      const aiMeta = options?.includeAiMetadata === true ? {\n        provider: 'heuristic',\n        model: 'unified-insights-v1',\n        createdAt: new Date().toISOString(),\n        dataLineage: [\n          {\n            source: 'local-storage',\n            type: 'tracking',\n            timeRange: start && end ? { start: start.toISOString(), end: end.toISOString() } : undefined,\n            fields: ['entries', 'emotions', 'sensoryInputs', 'goals'],\n            notes: 'Computed via heuristic engine using unified insights',\n          },\n        ],\n        caveats: [],\n        confidence: { overall: (results as any).confidence ?? 1 },\n      } : undefined;\n\n      return { ...(results as AnalyticsResults), ai: aiMeta } as AnalyticsResultsAI;\n    } catch (error) {\n      logger.error('[HeuristicAnalysisEngine] analyzeStudent failed', { error: error instanceof Error ? { message: error.message, stack: error.stack, name: error.name } : error, studentId });\n      return buildSafeResults({ error: 'HEURISTIC_ENGINE_ERROR' });\n    }\n  }\n}\n\nexport default HeuristicAnalysisEngine;\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analysis/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analysis/llmAnalysisEngine.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'mergeHeuristicWithAi' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ZAiReport' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5482,5485],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5482,5485],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":188,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":188,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8474,8477],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8474,8477],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":197,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9035,9038],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9035,9038],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":224,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10299,10302],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10299,10302],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":225,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":225,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10358,10361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10358,10361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used. Allowed unused caught errors must match /^_/u.","line":226,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":226,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":275,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12809,12812],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12809,12812],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":276,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":276,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12855,12858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12855,12858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { dataStorage } from '@/lib/dataStorage';\nimport { logger } from '@/lib/logger';\nimport { openRouterClient } from '@/lib/ai/openrouterClient';\nimport { loadAiConfig } from '@/lib/aiConfig';\nimport type { EmotionEntry, SensoryEntry, TrackingEntry, Goal, Pattern, Correlation } from '@/types/student';\nimport type { AnalyticsResults } from '@/types/analytics';\nimport { HeuristicAnalysisEngine } from './heuristicAnalysisEngine';\nimport { generateAnalysisPrompt } from './promptEngineering';\nimport { mapAiToAnalyticsResults, mergeHeuristicWithAi } from './mapping';\nimport { ZAiReport } from './aiSchema';\nimport type { AnalysisEngine, TimeRange, AnalysisOptions, AnalyticsResultsAI, AiMetadata } from './analysisEngine';\nimport { buildDataLineage, computeAiConfidence, createCacheKey, limitForPrompt, toDate, validateOrRepairAiReport, withinRange } from './llmUtils';\nimport { analyzeLargePeriod } from './mapReduce';\nimport { selectEvidence, selectEvidenceWeighted, mapCategoryToTags, inferTagsFromText } from '@/lib/evidence/select';\nimport type { EvidenceSource } from '@/lib/evidence/types';\nimport { DomainTag, GradeBand } from '@/lib/evidence/types';\nimport { AI_EVIDENCE_DISABLED } from '@/lib/env';\n\ntype CacheEntry = { data: AnalyticsResultsAI; expires: number };\n\nconst MEMORY_TTL_MS = 5 * 60 * 1000;\nconst cache = new Map<string, CacheEntry>();\n\nfunction safeResults(partial?: Partial<AnalyticsResults>): AnalyticsResultsAI {\n  const base: AnalyticsResults = {\n    patterns: [],\n    correlations: [],\n    environmentalCorrelations: [],\n    predictiveInsights: [],\n    anomalies: [],\n    insights: [],\n    suggestedInterventions: [],\n    ...partial,\n  } as AnalyticsResults;\n  return base as AnalyticsResultsAI;\n}\n\nexport class LLMAnalysisEngine implements AnalysisEngine {\n  private heuristic = new HeuristicAnalysisEngine();\n\n  // Map student grade strings to evidence grade bands\n  private detectGradeBand(grade?: string | null): GradeBand | undefined {\n    if (!grade) return undefined;\n    const g = String(grade).trim().toLowerCase();\n    if (g === 'k' || g === 'kg' || g === 'kindergarten') return GradeBand.K3;\n    const num = parseInt(g.replace(/[^0-9]/g, '') || 'NaN', 10);\n    if (!Number.isFinite(num)) return undefined;\n    if (num >= 0 && num <= 3) return GradeBand.K3;\n    if (num >= 4 && num <= 6) return GradeBand.FourSix;\n    if (num >= 7 && num <= 9) return GradeBand.SevenNine;\n    if (num >= 10 && num <= 12) return GradeBand.TenTwelve;\n    return GradeBand.Adult;\n  }\n\n  // Infer domains from goals via category mapping\n  private inferDomainsFromGoals(goals: Goal[]): DomainTag[] {\n    const tags = new Set<DomainTag>();\n    for (const g of goals || []) {\n      for (const t of mapCategoryToTags(g.category)) tags.add(t);\n    }\n    return Array.from(tags);\n  }\n\n  // Infer domains from pattern/correlation descriptions\n  private inferDomainsFromTextBlocks(texts: string[]): DomainTag[] {\n    const tags = new Set<DomainTag>();\n    for (const t of texts) {\n      for (const tag of inferTagsFromText(t)) tags.add(tag);\n    }\n    return Array.from(tags);\n  }\n\n  private buildDomainContext(\n    goals: Goal[],\n    patterns: Pattern[] | undefined,\n    correlations: Correlation[] | undefined,\n    studentGrade?: string | null\n  ): { tags: DomainTag[]; category?: string; text?: string; gradeBand?: GradeBand; weights?: Map<DomainTag, number> } {\n    const patternTexts = (patterns || []).map((p) => p.description || '').filter(Boolean);\n    const corrTexts = (correlations || []).map((c) => c.description || '').filter(Boolean);\n\n    // Weighted domain inference\n    const scores = new Map<DomainTag, number>();\n    const bump = (t: DomainTag, w: number) => scores.set(t, (scores.get(t) ?? 0) + w);\n\n    // Goals (high weight)\n    for (const g of goals || []) for (const t of mapCategoryToTags(g.category)) bump(t as DomainTag, 0.6);\n\n    // Pattern texts (medium)\n    for (const s of patternTexts) for (const t of inferTagsFromText(s)) bump(t as DomainTag, 0.3);\n\n    // Correlation texts (low)\n    for (const s of corrTexts) for (const t of inferTagsFromText(s)) bump(t as DomainTag, 0.1);\n\n    const rankedEntries = Array.from(scores.entries()).sort((a, b) => b[1] - a[1]);\n    const rankedTags = rankedEntries.map(([t]) => t);\n\n    const category = goals[0]?.category; // simple heuristic: first active goal\n    const text = [...patternTexts, ...corrTexts].join(' ').slice(0, 2000);\n    const gradeBand = this.detectGradeBand(studentGrade);\n    // Provide weights to downstream selection; also keep tags ordered by importance.\n    const weights = new Map<DomainTag, number>(rankedEntries);\n    return { tags: rankedTags, category, text, gradeBand, weights };\n  }\n\n  async analyzeStudent(\n    studentId: string,\n    timeframe?: TimeRange,\n    options?: AnalysisOptions\n  ): Promise<AnalyticsResultsAI> {\n    if (!studentId || typeof studentId !== 'string') {\n      logger.error('[LLMAnalysisEngine] analyzeStudent: invalid studentId', { studentId });\n      return safeResults({ error: 'INVALID_STUDENT_ID' });\n    }\n\n    const aiCfg = loadAiConfig();\n    if (!aiCfg.enabled) {\n      const heur = await this.heuristic.analyzeStudent(studentId, timeframe, options);\n      return heur;\n    }\n\n    // Hoist variables for catch block access\n    let entriesAll: TrackingEntry[] = [];\n    let goals: Goal[] = [];\n    let entries: TrackingEntry[] = [];\n    let emotions: EmotionEntry[] = [];\n    let sensoryInputs: SensoryEntry[] = [];\n    let lineage: any;\n\n    try {\n      const key = createCacheKey(studentId, timeframe, { includeAiMetadata: options?.includeAiMetadata, aiProfile: options?.aiProfile });\n      const now = Date.now();\n      const found = cache.get(key);\n      if (!options?.bypassCache && found && found.expires > now) {\n        // Return a shallow copy with a cache hint in metadata\n        const cached = JSON.parse(JSON.stringify(found.data)) as AnalyticsResultsAI;\n        if (cached.ai) {\n          cached.ai.caveats = Array.from(new Set([...(cached.ai.caveats || []), 'Resultater hentet fra cache']));\n          cached.ai.usage = { ...(cached.ai.usage || {}), cacheReadTokens: (cached.ai.usage?.cacheReadTokens ?? 0) + 1 };\n        }\n        return cached;\n      }\n\n      entriesAll = dataStorage.getEntriesForStudent(studentId) || [];\n      goals = dataStorage.getGoalsForStudent(studentId) || [];\n\n      const start = toDate(timeframe?.start);\n      const end = toDate(timeframe?.end);\n\n      entries = (start || end)\n        ? entriesAll.filter((e) => withinRange(e.timestamp, start, end))\n        : entriesAll;\n\n      emotions = (start || end)\n        ? entries.flatMap((e) => e.emotions || [])\n        : entriesAll.flatMap((e) => e.emotions || []);\n\n      sensoryInputs = (start || end)\n        ? entries.flatMap((e) => e.sensoryInputs || [])\n        : entriesAll.flatMap((e) => e.sensoryInputs || []);\n\n      const insufficient = entries.length === 0 && emotions.length === 0 && sensoryInputs.length === 0;\n      if (insufficient) {\n        lineage = buildDataLineage({ entries, emotions, sensoryInputs, goals }, timeframe);\n        const heur = await this.heuristic.analyzeStudent(studentId, timeframe, options);\n        const aiMeta = options?.includeAiMetadata ? {\n          provider: 'heuristic',\n          model: 'insufficient-data',\n          createdAt: new Date().toISOString(),\n          dataLineage: lineage,\n          caveats: ['Insufficient data for AI analysis; heuristic engine used'],\n          confidence: computeAiConfidence({ entries, emotions, sensoryInputs, goals }, false, true),\n        } : undefined;\n        return { ...(heur as AnalyticsResults), ai: aiMeta } as AnalyticsResultsAI;\n      }\n\n      const overallStart = start || entries[entries.length - 1]?.timestamp || emotions[emotions.length - 1]?.timestamp || sensoryInputs[sensoryInputs.length - 1]?.timestamp;\n      const overallEnd = end || entries[0]?.timestamp || emotions[0]?.timestamp || sensoryInputs[0]?.timestamp || new Date();\n\n      // Decide strategy: single-pass vs map-reduce\n      const days = (() => {\n        try { return Math.max(1, Math.round(((overallEnd as Date).getTime() - (overallStart as Date).getTime()) / (1000*60*60*24))); } catch { return 1; }\n      })();\n      const tooManyRecords = (entries.length + emotions.length + sensoryInputs.length) > 375; // conservative limit for local models\n      const longHorizon = days > 60;\n      const useMapReduce = longHorizon || tooManyRecords;\n\n      let validated: any;\n      let usedFallback = false;\n      let repaired = false;\n      let caveats: string[] = [];\n\n      if (useMapReduce && start && end) {\n        // TODO: Map-reduce pipeline does not currently thread evidence selection or aiProfile into prompts.\n        // Consider updating summarizeChunk/reduceSummariesToFinalReport to use generateAnalysisPrompt with evidence and options.aiProfile.\n        lineage = buildDataLineage({ entries, emotions, sensoryInputs, goals }, timeframe);\n        const overallRange = { start, end, timezone: timeframe?.timezone } as any;\n        const mergedReport = await analyzeLargePeriod(entries, emotions, sensoryInputs, goals, overallRange);\n        if (mergedReport) {\n          validated = { ok: true, report: mergedReport, repaired: false, caveats: ['Map‑reduce pipeline benyttet for langt tidsrom'] };\n        } else {\n          // fall through to single pass if map-reduce failed\n        }\n      }\n\n      if (!validated) {\n        const limited = {\n          entries: limitForPrompt(entries),\n          emotions: limitForPrompt(emotions),\n          sensoryInputs: limitForPrompt(sensoryInputs),\n          goals,\n        };\n\n        lineage = buildDataLineage({ entries, emotions, sensoryInputs, goals }, timeframe);\n        // Select evidence context unless disabled via env flag\n        let evidenceContext: EvidenceSource[] | undefined = undefined;\n        if (!AI_EVIDENCE_DISABLED) {\n          try {\n            let pat: Pattern[] | undefined;\n            let corr: Correlation[] | undefined;\n            try {\n              // Use cached heuristic preview to avoid double work/token cost; consider lighter extraction in future.\n              const heurPreview = await this.heuristic.analyzeStudent(studentId, timeframe, { bypassCache: false });\n              pat = (heurPreview as any)?.patterns || [];\n              corr = (heurPreview as any)?.correlations || [];\n            } catch (e) {\n              // ignore heuristic preview errors\n            }\n            const student = dataStorage.getStudentById(studentId);\n            const domainCtx = this.buildDomainContext(goals, pat, corr, student?.grade);\n            if (domainCtx.tags.length > 0 || domainCtx.text || domainCtx.category) {\n              // Approach B: weighted evidence selection with backward compatibility.\n              let usedWeighted = false;\n              try {\n                if (domainCtx.weights && domainCtx.weights.size > 0) {\n                  const arr = Array.from(domainCtx.weights.entries()).map(([tag, weight]) => ({ tag, weight }));\n                  evidenceContext = await selectEvidenceWeighted(arr, 5, {\n                    gradeBand: domainCtx.gradeBand,\n                    category: domainCtx.category,\n                    text: domainCtx.text,\n                    enforceDiversity: true,\n                  });\n                  usedWeighted = true;\n                }\n              } catch (_e) {\n                usedWeighted = false;\n              }\n              if (!usedWeighted) {\n                // Fallback Approach A: pass only top-K tags to bias selection toward higher weights\n                const K = 5; // Keep K small to preserve strong bias; configurable if needed\n                const topTags = domainCtx.tags.slice(0, K);\n                evidenceContext = await selectEvidence(topTags, 5, {\n                  gradeBand: domainCtx.gradeBand,\n                  category: domainCtx.category,\n                  text: domainCtx.text,\n                  enforceDiversity: true,\n                });\n              }\n            }\n          } catch (e) {\n            logger.warn('[LLMAnalysisEngine] evidence selection failed; proceeding without evidence', { error: e instanceof Error ? e.message : String(e) });\n            evidenceContext = undefined;\n          }\n        }\n        const { system, user } = generateAnalysisPrompt({ ...limited, timeframe }, evidenceContext, options?.aiProfile ?? 'default');\n        const { data: raw, response } = await openRouterClient.chatJSON(\n          { system, user },\n          {\n            modelName: aiCfg.modelName,\n            temperature: aiCfg.temperature,\n            maxTokens: aiCfg.maxTokens,\n            topP: aiCfg.topP,\n            timeoutMs: aiCfg.timeoutMs,\n            baseUrl: aiCfg.baseUrl,\n            apiKey: (aiCfg as any).apiKey,\n            localOnly: (aiCfg as any).localOnly,\n            ensureJson: true,\n          }\n        );\n        validated = validateOrRepairAiReport(raw);\n        if (!validated.ok) {\n          const heur = await this.heuristic.analyzeStudent(studentId, timeframe, options);\n          usedFallback = true;\n          const baseMeta: Partial<AiMetadata> = {\n            provider: 'openrouter',\n            model: response.raw?.model || aiCfg.modelName,\n            createdAt: new Date().toISOString(),\n            latencyMs: response.metrics.durationMs,\n            usage: {\n              promptTokens: response.usage?.prompt_tokens,\n              completionTokens: response.usage?.completion_tokens,\n              totalTokens: response.usage?.total_tokens,\n            },\n            dataLineage: lineage,\n            caveats: ['AI output invalid; heuristic fallback used'],\n          };\n          const conf = computeAiConfidence({ entries, emotions, sensoryInputs, goals }, false, usedFallback);\n          baseMeta.confidence = conf;\n          const fallback = { ...(heur as AnalyticsResults), ai: baseMeta } as AnalyticsResultsAI;\n          cache.set(key, { data: fallback, expires: now + MEMORY_TTL_MS });\n          return fallback;\n        }\n      }\n      repaired = validated.repaired;\n      caveats = validated.caveats || [];\n\n      const meta: Partial<AiMetadata> = {\n        provider: 'openrouter',\n        model: aiCfg.modelName,\n        createdAt: new Date().toISOString(),\n        dataLineage: lineage,\n        caveats,\n      };\n      const conf = computeAiConfidence({ entries, emotions, sensoryInputs, goals }, repaired, usedFallback);\n      meta.confidence = conf;\n\n      const aiResults = mapAiToAnalyticsResults(validated.report, meta);\n\n      const merged = aiResults;\n\n      // Annotate cache write intent\n      if (merged.ai) merged.ai.usage = { ...(merged.ai.usage || {}), cacheWriteTokens: (merged.ai.usage?.cacheWriteTokens ?? 0) + 1 };\n      cache.set(key, { data: merged, expires: now + MEMORY_TTL_MS });\n      return merged;\n    } catch (error) {\n      logger.error('[LLMAnalysisEngine] analyzeStudent failed', { error: error instanceof Error ? { message: error.message, stack: error.stack, name: error.name } : error, studentId });\n      try {\n        const heur = await this.heuristic.analyzeStudent(studentId, timeframe, options);\n        if (options?.includeAiMetadata) {\n          // Ensure lineage is computed if not already done\n          if (!lineage) {\n            lineage = buildDataLineage({ entries, emotions, sensoryInputs, goals }, timeframe);\n          }\n          const aiMeta: AiMetadata = {\n            provider: 'openrouter',\n            model: aiCfg.modelName,\n            createdAt: new Date().toISOString(),\n            dataLineage: lineage,\n            caveats: ['AI request failed; heuristic fallback used'],\n            confidence: computeAiConfidence({ entries, emotions, sensoryInputs, goals }, false, true),\n          };\n          return { ...(heur as AnalyticsResults), ai: aiMeta } as AnalyticsResultsAI;\n        }\n        return heur;\n      } catch {\n        return safeResults({ error: 'LLM_ENGINE_ERROR' });\n      }\n    }\n  }\n}\n\nexport default LLMAnalysisEngine;\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analysis/llmUtils.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4626,4629],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4626,4629],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":124,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5682,5685],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5682,5685],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":127,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5831,5834],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5831,5834],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5895,5898],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5895,5898],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6176,6179],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6176,6179],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":137,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6264,6267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6264,6267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":140,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6671,6674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6671,6674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6891,6894],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6891,6894],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":147,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7057,7060],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7057,7060],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":150,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7179,7182],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7179,7182],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":151,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7220,7223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7220,7223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7264,7267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7264,7267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":156,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7382,7385],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7382,7385],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":159,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7591,7594],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7591,7594],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":162,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7751,7754],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7751,7754],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":163,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7812,7815],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7812,7815],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":164,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7886,7889],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7886,7889],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":167,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7947,7950],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7947,7950],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":171,"column":106,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":109,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8230,8233],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8230,8233],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":172,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8345,8348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8345,8348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":175,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8505,8508],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8505,8508],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":176,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8566,8569],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8566,8569],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":177,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8640,8643],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8640,8643],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":183,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8906,8909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8906,8909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":184,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9000,9003],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9000,9003],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":187,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9047,9050],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9047,9050],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":189,"column":146,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":149,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9271,9274],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9271,9274],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":191,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":191,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9393,9396],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9393,9396],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":192,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9439,9442],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9439,9442],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":193,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9488,9491],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9488,9491],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":202,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":202,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9824,9827],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9824,9827],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":203,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":203,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9883,9886],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9883,9886],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":204,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9955,9958],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9955,9958],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":212,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":212,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10098,10101],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10098,10101],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":223,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":223,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10495,10498],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10495,10498],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":35,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { analyticsConfig, ANALYTICS_CONFIG, type AnalyticsConfiguration } from '@/lib/analyticsConfig';\nimport { canonicalSerialize } from '@/lib/canonicalSerialize';\nimport { logger } from '@/lib/logger';\nimport { ZAiReport, type AiReport, type AiDataLineageItem } from './aiSchema';\nimport type { EmotionEntry, SensoryEntry, TrackingEntry, Goal } from '@/types/student';\nimport type { TimeRange } from './analysisEngine';\n\nexport interface DataContextMetrics {\n  entries: TrackingEntry[];\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  goals: Goal[];\n}\n\nexport function toDate(input?: Date | string): Date | undefined {\n  if (!input) return undefined;\n  const d = input instanceof Date ? input : new Date(input);\n  return Number.isFinite(d.getTime()) ? d : undefined;\n}\n\nexport function withinRange(ts: Date, start?: Date, end?: Date): boolean {\n  const t = ts.getTime();\n  const s = start ? start.getTime() : -Infinity;\n  const e = end ? end.getTime() : Infinity;\n  return t >= s && t <= e;\n}\n\nexport function limitForPrompt<T extends { timestamp: Date }>(arr: T[], limit = 120): T[] {\n  return arr.slice(0, Math.max(0, limit));\n}\n\nexport function buildDataLineage(metrics: DataContextMetrics, timeframe?: TimeRange): AiDataLineageItem[] {\n  const range = (() => {\n    const s = toDate(timeframe?.start)?.toISOString();\n    const e = toDate(timeframe?.end)?.toISOString();\n    const tz = timeframe?.timezone;\n    if (!s || !e) return undefined;\n    return { start: s, end: e, timezone: tz };\n  })();\n  const lineage: AiDataLineageItem[] = [];\n  if (metrics.entries?.length) lineage.push({ source: 'local-storage', type: 'tracking', timeRange: range, fields: ['entries'] });\n  if (metrics.emotions?.length) lineage.push({ source: 'local-storage', type: 'emotion', timeRange: range, fields: ['emotions'] });\n  if (metrics.sensoryInputs?.length) lineage.push({ source: 'local-storage', type: 'sensor', timeRange: range, fields: ['sensoryInputs'] });\n  if (metrics.goals?.length) lineage.push({ source: 'local-storage', type: 'goal', timeRange: range, fields: ['goals'] });\n  return lineage;\n}\n\nexport function createCacheKey(studentId: string, timeframe?: TimeRange, extra?: Record<string, unknown>): string {\n  const s = toDate(timeframe?.start)?.toISOString();\n  const e = toDate(timeframe?.end)?.toISOString();\n  const tz = timeframe?.timezone;\n  const keyObj = { studentId, start: s, end: e, tz, extra: extra || {} };\n  return canonicalSerialize(keyObj);\n}\n\nexport function computeAiConfidence(metrics: DataContextMetrics, repaired: boolean, usedFallback: boolean, cfg?: AnalyticsConfiguration): { overall: number; calibration: string } {\n  const config = cfg ?? (() => {\n    try { return analyticsConfig.getConfig(); } catch { return ANALYTICS_CONFIG as unknown as AnalyticsConfiguration; }\n  })();\n  const TH = config.confidence.THRESHOLDS;\n  const W = config.confidence.WEIGHTS;\n\n  const now = new Date();\n  const last = metrics.entries[0]?.timestamp\n    || metrics.emotions[0]?.timestamp\n    || metrics.sensoryInputs[0]?.timestamp\n    || new Date(0);\n  const daysSince = Math.max(0, Math.round((now.getTime() - last.getTime()) / (1000 * 60 * 60 * 24)));\n\n  const ePart = Math.min(1, (metrics.emotions.length || 0) / Math.max(1, TH.EMOTION_ENTRIES)) * W.EMOTION;\n  const sPart = Math.min(1, (metrics.sensoryInputs.length || 0) / Math.max(1, TH.SENSORY_ENTRIES)) * W.SENSORY;\n  const tPart = Math.min(1, (metrics.entries.length || 0) / Math.max(1, TH.TRACKING_ENTRIES)) * W.TRACKING;\n  const recBoost = daysSince <= TH.DAYS_SINCE_LAST_ENTRY ? (1 - (daysSince / Math.max(1, TH.DAYS_SINCE_LAST_ENTRY))) * W.RECENCY_BOOST : 0;\n\n  let score = ePart + sPart + tPart + recBoost;\n  if (repaired) score = Math.max(0, score - 0.1);\n  if (usedFallback) score = Math.max(0, score - 0.2);\n  score = Math.max(0, Math.min(1, score));\n\n  const calibration = [\n    `data:e=${metrics.emotions.length},s=${metrics.sensoryInputs.length},t=${metrics.entries.length}`,\n    `daysSinceLast=${daysSince}`,\n    repaired ? 'validation=repaired' : 'validation=ok',\n    usedFallback ? 'fallback=heuristic' : 'fallback=none',\n  ].join('; ');\n\n  return { overall: score, calibration };\n}\n\nexport function validateOrRepairAiReport(input: unknown): { ok: true; report: AiReport; repaired: boolean; caveats: string[] } | { ok: false; error: Error; caveats: string[] } {\n  const parsed = ZAiReport.safeParse(input);\n  if (parsed.success) {\n    return { ok: true, report: parsed.data, repaired: false, caveats: [] };\n  }\n\n  const caveats: string[] = ['AI output failed schema validation; applied repair pass'];\n  try {\n    const repaired: any = coerceToAiReportShape(input);\n    const parsed2 = ZAiReport.parse(repaired);\n    return { ok: true, report: parsed2, repaired: true, caveats };\n  } catch (err) {\n    logger.error('[LLM] validateOrRepairAiReport failed', { error: err instanceof Error ? { message: err.message, name: err.name } : String(err) });\n    return { ok: false, error: err as Error, caveats };\n  }\n}\n\nfunction arr<T>(v: unknown): T[] {\n  return Array.isArray(v) ? (v as T[]).filter(Boolean) : [];\n}\n\nfunction num(v: unknown, def = 0): number {\n  const n = typeof v === 'number' ? v : Number(v);\n  if (!Number.isFinite(n)) return def;\n  if (n < 0) return 0;\n  if (n > 1) return 1;\n  return n;\n}\n\nfunction str(v: unknown, def = ''): string { return typeof v === 'string' ? v : def; }\n\nfunction coerceToAiReportShape(input: unknown): AiReport {\n  const o = (typeof input === 'object' && input) ? (input as Record<string, unknown>) : {};\n  const asStrArr = (v: unknown) => arr<string>(v).map(x => String(x)).filter(s => s.trim().length > 0);\n  const evidence = (v: unknown) => arr<any>(v).map(e => ({\n    description: str(e?.description, 'Observed evidence'),\n    weight: num(e?.weight, 0.5),\n    sources: asStrArr(e?.sources) as any,\n    refs: asStrArr(e?.refs),\n  }));\n  const patterns = arr<any>(o.patterns).map(p => ({\n    name: str(p?.name, 'Pattern'),\n    description: str(p?.description),\n    strength: typeof p?.strength === 'number' ? Math.max(0, Math.min(1, p.strength)) : undefined,\n    impact: ['low','medium','high'].includes(str(p?.impact)) ? str(p?.impact) as any : undefined,\n    evidence: evidence(p?.evidence),\n  }));\n  const correlations = arr<any>(o.correlations).map(c => ({\n    variables: Array.isArray(c?.variables) && c.variables.length >= 2 ? [String(c.variables[0]), String(c.variables[1])] as [string,string] : ['factorA','factorB'] as [string,string],\n    coefficient: typeof c?.coefficient === 'number' ? Math.max(-1, Math.min(1, c.coefficient)) : 0,\n    direction: ['positive','negative'].includes(str(c?.direction)) ? str(c?.direction) as any : undefined,\n    pValue: typeof c?.pValue === 'number' ? Math.max(0, Math.min(1, c.pValue)) : undefined,\n    confounders: asStrArr(c?.confounders),\n    evidence: evidence(c?.evidence),\n  }));\n  const anomalies = arr<any>(o.anomalies).map(a => ({\n    description: str(a?.description, 'Anomaly'),\n    severity: ['low','medium','high'].includes(str(a?.severity)) ? str(a?.severity) as any : 'medium',\n    at: str(a?.at),\n    range: (a?.range && typeof a.range === 'object') ? {\n      start: str((a.range as any)?.start),\n      end: str((a.range as any)?.end),\n      timezone: str((a.range as any)?.timezone) || undefined,\n    } : undefined,\n    evidence: evidence(a?.evidence),\n  }));\n  const predictive = arr<any>(o.predictiveInsights).map(p => ({\n    outcome: str(p?.outcome, 'Outcome'),\n    probability: num(p?.probability, 0.5),\n    horizon: ['short','medium','long'].includes(str(p?.horizon)) ? str(p?.horizon) as any : undefined,\n    drivers: asStrArr(p?.drivers),\n    confidence: (p?.confidence && typeof p.confidence === 'object') ? {\n      overall: num((p.confidence as any)?.overall, 0.5),\n      calibration: str((p.confidence as any)?.calibration) || undefined,\n      caveats: asStrArr((p.confidence as any)?.caveats),\n    } : undefined,\n  }));\n  const sugg = arr<any>(o.suggestedInterventions).map(i => ({\n    title: str(i?.title, 'Intervention'),\n    description: str(i?.description, 'Suggested action'),\n    actions: asStrArr(i?.actions),\n    expectedImpact: ['low','medium','high'].includes(str(i?.expectedImpact)) ? str(i?.expectedImpact) as any : undefined,\n    timeHorizon: ['short','medium','long'].includes(str(i?.timeHorizon)) ? str(i?.timeHorizon) as any : undefined,\n    metrics: asStrArr(i?.metrics),\n    confidence: (i?.confidence && typeof i.confidence === 'object') ? {\n      overall: num((i.confidence as any)?.overall, 0.6),\n      calibration: str((i.confidence as any)?.calibration) || undefined,\n      caveats: asStrArr((i.confidence as any)?.caveats),\n    } : undefined,\n    // Preserve evidence metadata fields\n    sources: asStrArr(i?.sources),\n    udlCheckpoints: asStrArr(i?.udlCheckpoints),\n    hlps: asStrArr(i?.hlps),\n    tier: ['Tier1','Tier2','Tier3'].includes(str(i?.tier)) ? str(i?.tier) as any : undefined,\n    scope: ['classroom','school'].includes(str(i?.scope)) ? str(i?.scope) as any : undefined,\n  }));\n\n  const lineage = arr<any>(o.dataLineage).map(li => ({\n    source: str(li?.source, 'local-storage'),\n    type: ['emotion','behavior','sensor','environment','goal','tracking','system','external','other'].includes(str(li?.type)) ? str(li?.type) as any : undefined,\n    timeRange: (li?.timeRange && typeof li.timeRange === 'object') ? {\n      start: str((li.timeRange as any)?.start),\n      end: str((li.timeRange as any)?.end),\n      timezone: str((li.timeRange as any)?.timezone) || undefined,\n    } : undefined,\n    fields: asStrArr(li?.fields),\n    notes: str(li?.notes) || undefined,\n  }));\n\n  const summary = str(o.summary) || undefined;\n  const keyFindings = asStrArr(o.keyFindings);\n  const confidence = (o?.confidence && typeof o.confidence === 'object') ? {\n    overall: num((o.confidence as any)?.overall, 0.7),\n    calibration: str((o.confidence as any)?.calibration) || undefined,\n    caveats: asStrArr((o.confidence as any)?.caveats),\n  } : undefined;\n\n  const report = {\n    summary,\n    keyFindings,\n    patterns,\n    correlations,\n    hypothesizedCauses: arr<any>(o.hypothesizedCauses).map(h => ({\n      cause: str(h?.cause, 'Hypothesis'),\n      likelihood: num(h?.likelihood, 0.5),\n      rationale: str(h?.rationale) || undefined,\n      supportingEvidence: evidence(h?.supportingEvidence),\n    })),\n    suggestedInterventions: sugg,\n    anomalies,\n    predictiveInsights: predictive,\n    dataLineage: lineage,\n    confidence,\n    insights: asStrArr((o as any)?.insights),\n  } as AiReport;\n\n  return report;\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analysis/mapReduce.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loadAiConfig' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnalyticsResultsAI' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ZodSchema' is defined but never used. Allowed unused vars must match /^_/u.","line":8,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { openRouterClient } from '@/lib/ai/openrouterClient';\nimport { loadAiConfig } from '@/lib/aiConfig';\nimport { logger } from '@/lib/logger';\nimport type { EmotionEntry, SensoryEntry, TrackingEntry, Goal } from '@/types/student';\nimport type { AnalyticsResults } from '@/types/analytics';\nimport type { AnalyticsResultsAI, TimeRange } from './analysisEngine';\nimport { validateOrRepairAiReport } from './llmUtils';\nimport { ZodSchema, z } from 'zod';\n\nexport interface ChunkContext {\n  range: TimeRange;\n  entries: TrackingEntry[];\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  goals: Goal[];\n}\n\n// Compact per-chunk summary shape to minimize tokens\nexport const ZChunkSummary = z.object({\n  keyFindings: z.array(z.string()).default([]),\n  patterns: z.array(z.object({\n    name: z.string(),\n    description: z.string().optional(),\n    strength: z.number().min(0).max(1).optional(),\n    impact: z.enum(['low','medium','high']).optional(),\n  })).default([]),\n  correlations: z.array(z.object({\n    variables: z.tuple([z.string(), z.string()]),\n    coefficient: z.number().min(-1).max(1).default(0),\n    direction: z.enum(['positive','negative']).optional(),\n  })).default([]),\n  anomalies: z.array(z.object({\n    description: z.string(),\n    severity: z.enum(['low','medium','high']).default('medium'),\n  })).default([]),\n  suggestedInterventions: z.array(z.object({\n    title: z.string(),\n    description: z.string().optional(),\n  })).default([]),\n  predictiveInsights: z.array(z.object({\n    outcome: z.string(),\n    probability: z.number().min(0).max(1).default(0.5),\n  })).default([]),\n});\nexport type ChunkSummary = z.infer<typeof ZChunkSummary>;\n\nfunction fmtDate(d?: Date | string): string {\n  try {\n    const dd = d instanceof Date ? d : new Date(d || 0);\n    if (!Number.isFinite(dd.getTime())) return '';\n    return dd.toISOString().slice(0,19);\n  } catch { return ''; }\n}\n\nfunction sampleSnapshot(entries: TrackingEntry[], maxEntries = 8): string {\n  const pick = (entries || []).slice(0, maxEntries);\n  const lines: string[] = [];\n  for (const e of pick) {\n    const em = (e.emotions || []).map(x => `${x.emotion}${typeof x.intensity === 'number' ? `(${x.intensity})` : ''}`).join(', ');\n    const sn = (e.sensoryInputs || []).map(x => `${x.response}${x.intensity ? `(${x.intensity})` : ''}`).join(', ');\n    lines.push(`- ${fmtDate(e.timestamp)} | emotions: [${em}] | sensory: [${sn}]${e.notes ? ` | notes: ${e.notes}` : ''}`);\n  }\n  return lines.join('\\n');\n}\n\nexport function chooseChunkSpanDays(from: Date, to: Date): number {\n  const ms = Math.max(0, to.getTime() - from.getTime());\n  const days = Math.max(1, Math.round(ms / (1000*60*60*24)));\n  if (days <= 30) return 7;     // weekly\n  if (days <= 120) return 14;   // bi-weekly\n  if (days <= 365) return 30;   // monthly\n  return 60;                     // bi-monthly for very long\n}\n\nexport function chunkByDays<T extends { timestamp: Date }>(items: T[], start: Date, end: Date, spanDays: number): Array<{ range: TimeRange; items: T[] }>{\n  const chunks: Array<{ range: TimeRange; items: T[] }> = [];\n  let cursor = new Date(start);\n  while (cursor.getTime() < end.getTime()) {\n    const chunkStart = new Date(cursor);\n    const chunkEnd = new Date(Math.min(end.getTime(), chunkStart.getTime() + spanDays*24*60*60*1000 - 1));\n    const inChunk = items.filter(i => i.timestamp.getTime() >= chunkStart.getTime() && i.timestamp.getTime() <= chunkEnd.getTime());\n    chunks.push({ range: { start: chunkStart, end: chunkEnd }, items: inChunk });\n    cursor = new Date(chunkEnd.getTime() + 1);\n  }\n  return chunks;\n}\n\nexport async function summarizeChunk(ctx: ChunkContext): Promise<ChunkSummary> {\n  const header = `Oppsummer denne perioden kort i norsk JSON. Ingen kodeblokker.\\n`+\n    `Periode: ${fmtDate(ctx.range.start)} – ${fmtDate(ctx.range.end)}\\n`+\n    `Antall: entries=${ctx.entries.length}, emotions=${ctx.emotions.length}, sensory=${ctx.sensoryInputs.length}, goals=${ctx.goals.length}`;\n  const dataset = `Snapshot (inntil 8):\\n${sampleSnapshot(ctx.entries, 8)}`;\n  const instructions = [\n    'Returner KUN gyldig JSON med feltene: keyFindings[], patterns[], correlations[], anomalies[], suggestedInterventions[], predictiveInsights[].',\n    'Vær kortfattet og konkret. Ingen PII. Alle tall i [0,1] der det passer.'\n  ].join('\\n');\n\n  const sys = 'Svar kun på norsk. Returner KUN gyldig JSON uten kodeblokker. Ikke vis tankestrøm.';\n  const user = [header, '', dataset, '', instructions].join('\\n');\n\n  const { data } = await openRouterClient.chatJSON<unknown>(\n    { system: sys, user },\n    { ensureJson: true, refine: (v) => ZChunkSummary.parse(v) }\n  );\n  return data as ChunkSummary;\n}\n\nexport async function reduceSummariesToFinalReport(summaries: ChunkSummary[], goals: Goal[], overallRange: TimeRange): Promise<{ ok: true; report: AnalyticsResults } | { ok: false; error: Error }>{\n  try {\n    const sys = 'Svar kun på norsk. Returner KUN gyldig JSON uten kodeblokker. Ikke vis tankestrøm.';\n    const user = [\n      'Du får en liste med del-oppsummeringer (JSON) fra flere tidsperioder for samme elev.',\n      'Slå dem sammen til ÉN helhetlig analyse i følgende JSON-skjema:',\n      '{ summary?, keyFindings[], patterns[], correlations[], hypothesizedCauses[], suggestedInterventions[], anomalies[], predictiveInsights[], dataLineage[], confidence{} }',\n      'Vær konservativ og fjern duplikater. Vektlegg konsistente mønstre som går igjen på tvers av perioder.',\n      `Analyseperiode: ${fmtDate(overallRange.start)} – ${fmtDate(overallRange.end)}. Mål: praktiske tiltak og mønstre.`,\n      'Del-oppsummeringer (JSON):',\n      JSON.stringify(summaries).slice(0, 120000), // guard token size\n      'Inkluder dataLineage med én post per kilde-type (emotion, sensor, tracking, goal) hvis relevant.'\n    ].join('\\n');\n\n    const { data: raw } = await openRouterClient.chatJSON<unknown>(\n      { system: sys, user },\n      { ensureJson: true }\n    );\n    const validated = validateOrRepairAiReport(raw);\n    if (!validated.ok) return { ok: false, error: validated.error };\n    const report = validated.report as unknown as AnalyticsResults;\n    return { ok: true, report };\n  } catch (error) {\n    logger.error('[mapReduce] reduceSummariesToFinalReport failed', { error: error instanceof Error ? { message: error.message, name: error.name } : String(error) });\n    return { ok: false, error: error as Error };\n  }\n}\n\nexport async function analyzeLargePeriod(\n  entries: TrackingEntry[], emotions: EmotionEntry[], sensoryInputs: SensoryEntry[], goals: Goal[], overallRange: TimeRange\n): Promise<AnalyticsResults | null> {\n  try {\n    const start = overallRange.start instanceof Date ? overallRange.start : new Date(overallRange.start);\n    const end = overallRange.end instanceof Date ? overallRange.end : new Date(overallRange.end);\n    const spanDays = chooseChunkSpanDays(start, end);\n\n    const entryChunks = chunkByDays(entries, start, end, spanDays);\n    const summaries: ChunkSummary[] = [];\n    for (const c of entryChunks) {\n      const eIn = c.items;\n      const emoIn = emotions.filter(e => e.timestamp.getTime() >= (c.range.start as Date).getTime() && e.timestamp.getTime() <= (c.range.end as Date).getTime());\n      const senIn = sensoryInputs.filter(s => s.timestamp.getTime() >= (c.range.start as Date).getTime() && s.timestamp.getTime() <= (c.range.end as Date).getTime());\n      // Skip empty chunks to save tokens\n      if ((eIn.length + emoIn.length + senIn.length) === 0) continue;\n      const ctx: ChunkContext = { range: c.range, entries: eIn, emotions: emoIn, sensoryInputs: senIn, goals };\n      const summary = await summarizeChunk(ctx);\n      summaries.push(summary);\n    }\n\n    if (summaries.length === 0) return null;\n    const final = await reduceSummariesToFinalReport(summaries, goals, overallRange);\n    if (!final.ok) return null;\n    return final.report;\n  } catch (error) {\n    logger.error('[mapReduce] analyzeLargePeriod error', { error: error instanceof Error ? { message: error.message } : String(error) });\n    return null;\n  }\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analysis/mapping.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analysis/promptEngineering.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analytics/cache-key.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analytics/cache-key.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analyticsConfig.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analyticsConfig.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":346,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":346,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8724,8727],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8724,8727],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { logger } from '@/lib/logger';\nimport { AI_ANALYSIS_ENABLED, EXPLANATION_V2_ENABLED } from '@/lib/env';\n\n// Centralized storage keys and prefixes\nexport const STORAGE_KEYS = {\n  analyticsConfig: 'sensory-compass-analytics-config',\n  analyticsProfiles: 'sensoryTracker_analyticsProfiles',\n  cachePrefix: 'analytics-cache',\n  performancePrefix: 'performance-cache',\n} as const;\n\nexport interface AnalyticsConfiguration {\n  // Schema version to invalidate caches when structure changes\n  schemaVersion: string;\n  \n  // Feature flags (non-breaking)\n  features?: {\n    enableStructuredInsights?: boolean;\n    enableSummaryFacade?: boolean;\n    aiAnalysisEnabled?: boolean;\n    explanationV2?: boolean;\n  };\n\n  // Feature Engineering Settings\n  featureEngineering: {\n    timeEncoding: {\n      variant: 'sixFeatureV1' | 'none';\n    };\n    normalization: {\n      clampToUnit: boolean;\n      minVariance: number;\n    };\n  };\n\n  // Pattern Analysis Thresholds\n  patternAnalysis: {\n    minDataPoints: number;\n    correlationThreshold: number;\n    highIntensityThreshold: number;\n    concernFrequencyThreshold: number;\n    emotionConsistencyThreshold: number;\n    moderateNegativeThreshold: number;\n  };\n\n  // Enhanced Pattern Analysis\n  enhancedAnalysis: {\n    minSampleSize: number;\n    trendThreshold: number;\n    predictionConfidenceThreshold: number;\n    anomalyThreshold: number; // Switch to z-score threshold\n    // Optional severity levels for anomaly z-scores; if omitted, defaults will be applied\n    anomalySeverityLevels?: {\n      medium: number; // z >= medium => medium\n      high: number;   // z >= high => high\n    };\n    huber: {\n      delta: number;\n      maxIter: number;\n      tol: number;\n    };\n    qualityTargets: {\n      pointsTarget: number;\n      timeSpanDaysTarget: number;\n    };\n    correlationSignificance: {\n      high: number;\n      moderate: number;\n      low: number;\n    };\n    riskAssessment: {\n      stressIntensityThreshold: number;\n      stressEmotions: string[];\n    };\n  };\n\n  // Time Windows\n  timeWindows: {\n    defaultAnalysisDays: number;\n    recentDataDays: number;\n    shortTermDays: number;\n    longTermDays: number;\n  };\n\n  // Alert Sensitivity\n  alertSensitivity: {\n    level: 'low' | 'medium' | 'high';\n    emotionIntensityMultiplier: number;\n    frequencyMultiplier: number;\n    anomalyMultiplier: number;\n  };\n\n  // Cache Settings\n  cache: {\n    ttl: number; // Time to live in milliseconds\n    maxSize: number;\n    invalidateOnConfigChange: boolean;\n  };\n\n  // Existing settings (maintained for compatibility)\n  insights: {\n    MIN_SESSIONS_FOR_FULL_ANALYTICS: number;\n    HIGH_CONFIDENCE_PATTERN_THRESHOLD: number;\n    MAX_PATTERNS_TO_SHOW: number;\n    MAX_CORRELATIONS_TO_SHOW: number;\n    MAX_PREDICTIONS_TO_SHOW: number;\n    RECENT_EMOTION_COUNT: number;\n    POSITIVE_EMOTION_TREND_THRESHOLD: number;\n    NEGATIVE_EMOTION_TREND_THRESHOLD: number;\n  };\n\n  confidence: {\n    THRESHOLDS: {\n      EMOTION_ENTRIES: number;\n      SENSORY_ENTRIES: number;\n      TRACKING_ENTRIES: number;\n      DAYS_SINCE_LAST_ENTRY: number;\n    };\n    WEIGHTS: {\n      EMOTION: number;\n      SENSORY: number;\n      TRACKING: number;\n      RECENCY_BOOST: number;\n    };\n  };\n\n  healthScore: {\n    WEIGHTS: {\n      PATTERNS: number;\n      CORRELATIONS: number;\n      PREDICTIONS: number;\n      ANOMALIES: number;\n      MINIMUM_DATA: number;\n    };\n  };\n\n  analytics: {\n    MIN_TRACKING_FOR_CORRELATION: number;\n    MIN_TRACKING_FOR_ENHANCED: number;\n    ANALYSIS_PERIOD_DAYS: number;\n  };\n\n  // Emotion taxonomy\n  taxonomy: {\n    positiveEmotions: string[];\n  };\n}\n\n// Default configuration\nexport const DEFAULT_ANALYTICS_CONFIG: AnalyticsConfiguration = {\n  schemaVersion: '2.3.0',\n  \n  features: {\n    enableStructuredInsights: false,\n    enableSummaryFacade: true,\n    aiAnalysisEnabled: AI_ANALYSIS_ENABLED,\n    explanationV2: EXPLANATION_V2_ENABLED,\n  },\n  \n  featureEngineering: {\n    timeEncoding: {\n      variant: 'sixFeatureV1',\n    },\n    normalization: {\n      clampToUnit: true,\n      minVariance: 1e-9,\n    },\n  },\n  \n  patternAnalysis: {\n    minDataPoints: 3,\n    correlationThreshold: 0.25,\n    highIntensityThreshold: 4,\n    concernFrequencyThreshold: 0.3,\n    emotionConsistencyThreshold: 0.4,\n    moderateNegativeThreshold: 0.4,\n  },\n  \n  enhancedAnalysis: {\n    minSampleSize: 5,\n    trendThreshold: 0.02, // Moved from hardcoded 0\n    predictionConfidenceThreshold: 0.6,\n    anomalyThreshold: 2.5, // Switch to z-score threshold\n    anomalySeverityLevels: { medium: 2.5, high: 3.0 },\n    huber: {\n      delta: 1.345,\n      maxIter: 50,\n      tol: 1e-6,\n    },\n    qualityTargets: {\n      pointsTarget: 30,\n      timeSpanDaysTarget: 21,\n    },\n    correlationSignificance: {\n      high: 0.7,\n      moderate: 0.5,\n      low: 0.3,\n    },\n    riskAssessment: {\n      stressIntensityThreshold: 4,\n      stressEmotions: ['anxious', 'frustrated', 'overwhelmed', 'angry'],\n    },\n  },\n  timeWindows: {\n    defaultAnalysisDays: 30,\n    recentDataDays: 7,\n    shortTermDays: 14,\n    longTermDays: 90,\n  },\n  alertSensitivity: {\n    level: 'medium',\n    emotionIntensityMultiplier: 1.0,\n    frequencyMultiplier: 1.0,\n    anomalyMultiplier: 1.0,\n  },\n  cache: {\n    ttl: 10 * 60 * 1000, // 10 minutes\n    maxSize: 50,\n    invalidateOnConfigChange: true,\n  },\n  insights: {\n    MIN_SESSIONS_FOR_FULL_ANALYTICS: 5,\n    HIGH_CONFIDENCE_PATTERN_THRESHOLD: 0.6,\n    MAX_PATTERNS_TO_SHOW: 2,\n    MAX_CORRELATIONS_TO_SHOW: 2,\n    MAX_PREDICTIONS_TO_SHOW: 2,\n    RECENT_EMOTION_COUNT: 7,\n    POSITIVE_EMOTION_TREND_THRESHOLD: 0.6,\n    NEGATIVE_EMOTION_TREND_THRESHOLD: 0.3,\n  },\n  confidence: {\n    THRESHOLDS: {\n      EMOTION_ENTRIES: 10,\n      SENSORY_ENTRIES: 10,\n      TRACKING_ENTRIES: 5,\n      DAYS_SINCE_LAST_ENTRY: 7,\n    },\n    WEIGHTS: {\n      EMOTION: 0.3,\n      SENSORY: 0.3,\n      TRACKING: 0.4,\n      RECENCY_BOOST: 0.1,\n    },\n  },\n  healthScore: {\n    WEIGHTS: {\n      PATTERNS: 20,\n      CORRELATIONS: 20,\n      PREDICTIONS: 20,\n      ANOMALIES: 20,\n      MINIMUM_DATA: 20,\n    },\n  },\n  analytics: {\n    MIN_TRACKING_FOR_CORRELATION: 3,\n    MIN_TRACKING_FOR_ENHANCED: 2,\n    ANALYSIS_PERIOD_DAYS: 30,\n  },\n  taxonomy: {\n    positiveEmotions: ['happy', 'calm', 'excited', 'content', 'peaceful', 'cheerful', 'relaxed', 'optimistic'],\n  },\n};\n\n// Preset configurations\nexport const PRESET_CONFIGS = {\n  conservative: {\n    name: 'Conservative',\n    description: 'Higher thresholds, fewer alerts, more data required',\n    config: {\n      ...DEFAULT_ANALYTICS_CONFIG,\n      schemaVersion: '2.3.0',\n      patternAnalysis: {\n        ...DEFAULT_ANALYTICS_CONFIG.patternAnalysis,\n        minDataPoints: 5,\n        correlationThreshold: 0.4,\n        concernFrequencyThreshold: 0.4,\n      },\n      enhancedAnalysis: {\n        ...DEFAULT_ANALYTICS_CONFIG.enhancedAnalysis,\n        anomalyThreshold: 3.0,\n        minSampleSize: 8,\n      },\n      alertSensitivity: {\n        level: 'low' as const,\n        emotionIntensityMultiplier: 0.8,\n        frequencyMultiplier: 0.8,\n        anomalyMultiplier: 0.8,\n      },\n    },\n  },\n  balanced: {\n    name: 'Balanced',\n    description: 'Default settings, balanced sensitivity',\n    config: {\n      ...DEFAULT_ANALYTICS_CONFIG,\n      schemaVersion: '2.3.0',\n    },\n  },\n  sensitive: {\n    name: 'Sensitive',\n    description: 'Lower thresholds, more alerts, less data required',\n    config: {\n      ...DEFAULT_ANALYTICS_CONFIG,\n      schemaVersion: '2.3.0',\n      patternAnalysis: {\n        ...DEFAULT_ANALYTICS_CONFIG.patternAnalysis,\n        minDataPoints: 2,\n        correlationThreshold: 0.15,\n        concernFrequencyThreshold: 0.2,\n      },\n      enhancedAnalysis: {\n        ...DEFAULT_ANALYTICS_CONFIG.enhancedAnalysis,\n        anomalyThreshold: 2.0,\n        minSampleSize: 3,\n      },\n      alertSensitivity: {\n        level: 'high' as const,\n        emotionIntensityMultiplier: 1.2,\n        frequencyMultiplier: 1.2,\n        anomalyMultiplier: 1.2,\n      },\n    },\n  },\n};\n\n// Configuration manager class\nexport class AnalyticsConfigManager {\n  private static instance: AnalyticsConfigManager;\n  private config: AnalyticsConfiguration;\n  private listeners: Array<(config: AnalyticsConfiguration) => void> = [];\n  private storageKey = 'sensory-compass-analytics-config';\n\n  private constructor() {\n    this.config = this.loadConfig();\n  }\n\n  static getInstance(): AnalyticsConfigManager {\n    if (!AnalyticsConfigManager.instance) {\n      AnalyticsConfigManager.instance = new AnalyticsConfigManager();\n    }\n    return AnalyticsConfigManager.instance;\n  }\n\n  getConfig(): AnalyticsConfiguration {\n    // Always reflect latest Vite env for AI flag to avoid stale defaults\n    try {\n      const env: Record<string, unknown> = (import.meta as any)?.env ?? {};\n      const toBool = (v: unknown) => {\n        const s = (v ?? '').toString().toLowerCase();\n        return s === '1' || s === 'true' || s === 'yes';\n      };\n      const envAi = toBool(env.VITE_AI_ANALYSIS_ENABLED);\n      const envExplV2 = toBool(env.VITE_EXPLANATION_V2);\n      const next: AnalyticsConfiguration = { ...this.config } as AnalyticsConfiguration;\n      next.features = { ...(next.features || {}), aiAnalysisEnabled: envAi, explanationV2: envExplV2 } as AnalyticsConfiguration['features'];\n      return next;\n    } catch {\n      // On any error, return a shallow copy\n      return { ...this.config };\n    }\n  }\n\n  updateConfig(updates: Partial<AnalyticsConfiguration>): void {\n    this.config = this.deepMerge(this.config, updates);\n    this.saveConfig();\n    this.notifyListeners();\n  }\n\n  setPreset(presetKey: keyof typeof PRESET_CONFIGS): void {\n    const preset = PRESET_CONFIGS[presetKey];\n    if (preset) {\n      this.config = { ...preset.config };\n      this.saveConfig();\n      this.notifyListeners();\n    }\n  }\n\n  resetToDefaults(): void {\n    this.config = { ...DEFAULT_ANALYTICS_CONFIG };\n    this.saveConfig();\n    this.notifyListeners();\n  }\n\n  subscribe(callback: (config: AnalyticsConfiguration) => void): () => void {\n    this.listeners.push(callback);\n    return () => {\n      this.listeners = this.listeners.filter(listener => listener !== callback);\n    };\n  }\n\n  exportConfig(): string {\n    return JSON.stringify(this.config, null, 2);\n  }\n\n  importConfig(configString: string): boolean {\n    try {\n      const importedConfig = JSON.parse(configString);\n      // Validate the imported config structure\n      if (this.validateConfig(importedConfig)) {\n        this.config = importedConfig;\n        this.saveConfig();\n        this.notifyListeners();\n        return true;\n      }\n      return false;\n    } catch (error) {\n      logger.error('Failed to import configuration:', error);\n      return false;\n    }\n  }\n\n  private loadConfig(): AnalyticsConfiguration {\n    try {\n      if (typeof window === 'undefined' || typeof localStorage === 'undefined') {\n        // Non-browser environment (SSR/tests/workers)\n        return { ...DEFAULT_ANALYTICS_CONFIG };\n      }\n      const stored = localStorage.getItem(this.storageKey);\n      if (stored) {\n        const parsed = JSON.parse(stored);\n        if (this.validateConfig(parsed)) {\n          // Merge stored over defaults so new defaults (incl. env-driven flags) apply\n          return this.deepMerge(DEFAULT_ANALYTICS_CONFIG, parsed);\n        }\n      }\n    } catch (error) {\n      logger.error('Failed to load analytics configuration:', error);\n    }\n    return { ...DEFAULT_ANALYTICS_CONFIG };\n  }\n\n  private saveConfig(): void {\n    try {\n      if (typeof window !== 'undefined' && typeof localStorage !== 'undefined') {\n        // Guard against quota exceeded. If it happens, clear only our key (fail-soft)\n        try {\n          localStorage.setItem(this.storageKey, JSON.stringify(this.config));\n        } catch (err) {\n          try { \n            localStorage.removeItem(this.storageKey); \n          } catch {\n            // Silent fail if unable to remove key\n          }\n          logger.error('Failed to save analytics configuration:', err);\n        }\n      }\n    } catch (error) {\n      logger.error('Failed to save analytics configuration:', error);\n    }\n  }\n\n  private notifyListeners(): void {\n    const configCopy = { ...this.config };\n    this.listeners.forEach(listener => listener(configCopy));\n  }\n\n  private deepMerge(target: AnalyticsConfiguration, source: Partial<AnalyticsConfiguration>): AnalyticsConfiguration {\n    // Create a deep copy of the target\n    const result = JSON.parse(JSON.stringify(target)) as AnalyticsConfiguration;\n    \n    // Merge source into result\n    const merge = (targetObj: Record<string, unknown>, sourceObj: Record<string, unknown>) => {\n      Object.keys(sourceObj).forEach(key => {\n        const sourceValue = sourceObj[key];\n        const targetValue = targetObj[key];\n        \n        if (sourceValue !== undefined && sourceValue !== null) {\n          if (\n            typeof sourceValue === 'object' &&\n            !Array.isArray(sourceValue) &&\n            targetValue &&\n            typeof targetValue === 'object' &&\n            !Array.isArray(targetValue)\n          ) {\n            // Recursively merge nested objects\n            merge(targetValue as Record<string, unknown>, sourceValue as Record<string, unknown>);\n          } else {\n            // Direct assignment for primitives and arrays\n            targetObj[key] = sourceValue;\n          }\n        }\n      });\n    };\n    \n    merge(result as unknown as Record<string, unknown>, source as unknown as Record<string, unknown>);\n    \n    return result;\n  }\n\n  private validateConfig(config: unknown): config is AnalyticsConfiguration {\n    // Basic validation to ensure the config has the expected structure\n    if (!config || typeof config !== 'object') {\n      return false;\n    }\n    \n    const cfg = config as Record<string, unknown>;\n    return (\n      typeof cfg.schemaVersion === 'string' &&\n      !!cfg.featureEngineering &&\n      !!cfg.patternAnalysis &&\n      !!cfg.enhancedAnalysis &&\n      !!cfg.timeWindows &&\n      !!cfg.alertSensitivity &&\n      !!cfg.cache &&\n      !!cfg.insights &&\n      !!cfg.confidence &&\n      !!cfg.healthScore &&\n      !!cfg.analytics &&\n      !!cfg.taxonomy\n    );\n  }\n}\n\n// Export singleton instance\nexport const analyticsConfig = AnalyticsConfigManager.getInstance();\n\n// Legacy export for backward compatibility\nexport const ANALYTICS_CONFIG = {\n  ...DEFAULT_ANALYTICS_CONFIG,\n  // Add missing POSITIVE_EMOTIONS set\n  POSITIVE_EMOTIONS: new Set(['happy', 'calm', 'excited', 'content', 'peaceful', 'cheerful', 'relaxed', 'optimistic'])\n};\nexport type AnalyticsConfig = typeof ANALYTICS_CONFIG;\n\n// -----------------------------------------------------------------------------\n// Internal helpers (type-only, not exported)\n// -----------------------------------------------------------------------------\n// These type aliases are available for future use if needed\ntype _ConfidenceConfig = AnalyticsConfiguration['confidence'];\ntype _InsightConfig = AnalyticsConfiguration['insights'];\n\n// Note: Helper functions removed to avoid ESLint unused variable errors.\n// If needed in the future, they can be re-added with proper usage or\n// prefixed with underscore to indicate they are intentionally unused.\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analyticsConfigOverride.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analyticsConfigValidation.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[438,441],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[438,441],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1108,1111],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1108,1111],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used. Allowed unused caught errors must match /^_/u.","line":47,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":15},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":52,"column":11,"nodeType":"BlockStatement","messageId":"unexpected","endLine":52,"endColumn":13,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1635,1635],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { DEFAULT_ANALYTICS_CONFIG, AnalyticsConfiguration, analyticsConfig } from '@/lib/analyticsConfig';\nimport { logger } from '@/lib/logger';\n\nexport interface ConfigValidation {\n  isValid: boolean;\n  errors: string[];\n}\n\n// Lightweight runtime validation for AnalyticsConfiguration shape and ranges\nfunction validateShape(cfg: unknown): cfg is AnalyticsConfiguration {\n  if (!cfg || typeof cfg !== 'object') return false;\n  const c: any = cfg;\n  const requiredRoots = [\n    'patternAnalysis',\n    'enhancedAnalysis',\n    'timeWindows',\n    'alertSensitivity',\n    'cache',\n    'insights',\n    'confidence',\n    'healthScore',\n    'analytics',\n    'taxonomy',\n  ];\n  for (const k of requiredRoots) {\n    if (!(k in c)) return false;\n  }\n  // Basic numeric range sanity checks (non-exhaustive, enough to prevent obvious breakage)\n  const numbersOk = [\n    c.patternAnalysis?.minDataPoints,\n    c.patternAnalysis?.correlationThreshold,\n    c.enhancedAnalysis?.anomalyThreshold,\n    c.cache?.ttl,\n    c.cache?.maxSize,\n    c.insights?.MAX_PATTERNS_TO_SHOW,\n    c.confidence?.WEIGHTS?.EMOTION,\n  ].every((n: any) => typeof n === 'number' && Number.isFinite(n));\n  if (!numbersOk) return false;\n  return true;\n}\n\nexport function validateAnalyticsRuntimeConfig(cfg: unknown): { config: AnalyticsConfiguration; meta: ConfigValidation } {\n  try {\n    if (validateShape(cfg)) {\n      return { config: cfg, meta: { isValid: true, errors: [] } };\n    }\n  } catch (err) {\n    // fall through to default\n  }\n  try {\n    logger.error('[analyticsConfigValidation] Invalid analytics configuration detected. Falling back to defaults.');\n  } catch {}\n  return { config: DEFAULT_ANALYTICS_CONFIG, meta: { isValid: false, errors: ['invalid-shape-or-values'] } };\n}\n\n// Helper to always return a safe, validated config\nexport function getValidatedConfig(): AnalyticsConfiguration {\n  try {\n    const live = analyticsConfig.getConfig();\n    return validateAnalyticsRuntimeConfig(live).config;\n  } catch {\n    return DEFAULT_ANALYTICS_CONFIG;\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analyticsCoordinator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analyticsExport.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":2,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[63,66],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[63,66],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":3,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[101,104],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[101,104],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[227,230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[227,230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[403,406],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[403,406],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Dynamic imports to keep initial bundle smaller\nlet __jsPDF: any | null = null;\nlet __html2canvas: any | null = null;\nasync function getJsPDF() {\n  if (!__jsPDF) {\n    const mod = await import('jspdf');\n    __jsPDF = (mod as any).default || mod;\n  }\n  return __jsPDF;\n}\nasync function getHtml2Canvas() {\n  if (!__html2canvas) {\n    const mod = await import('html2canvas');\n    __html2canvas = (mod as any).default || mod;\n  }\n  return __html2canvas;\n}\nimport { format } from 'date-fns';\nimport { Student, TrackingEntry, EmotionEntry, SensoryEntry } from '@/types/student';\nimport type { ExportFormat } from '@/types/analytics';\nimport { PatternResult, CorrelationResult } from '@/lib/patternAnalysis';\nimport { PredictiveInsight, AnomalyDetection } from '@/lib/enhancedPatternAnalysis';\nimport { logger } from '@/lib/logger';\nimport { downloadBlob } from '@/lib/utils';\n\n\nexport interface AnalyticsExportData {\n  student: Student;\n  dateRange: {\n    start: Date;\n    end: Date;\n  };\n  data: {\n    entries: TrackingEntry[];\n    emotions: EmotionEntry[];\n    sensoryInputs: SensoryEntry[];\n  };\n  analytics: {\n    patterns: PatternResult[];\n    correlations: CorrelationResult[];\n    insights: string[];\n    predictiveInsights?: PredictiveInsight[];\n    anomalies?: AnomalyDetection[];\n  };\n  charts?: {\n    element: HTMLElement;\n    title: string;\n  }[];\n  chartExports?: {\n    title: string;\n    type?: string;\n    dataURL?: string;\n    svgString?: string;\n  }[];\n}\n\nclass AnalyticsExport {\n  /**\n   * Unified export entrypoint used by dashboards; delegates to format-specific methods.\n   */\n  async exportTo(format: ExportFormat, exportData: AnalyticsExportData, options?: { pdf?: { chartQuality?: 'standard' | 'high' | 'print' } }): Promise<void> {\n    switch (format) {\n      case 'pdf':\n        await this.exportToPDF(exportData, options?.pdf);\n        return;\n      case 'csv':\n        this.exportToCSV(exportData);\n        return;\n      case 'json':\n        this.exportToJSON(exportData);\n        return;\n      default:\n        throw new Error(`Unsupported export format: ${String(format)}`);\n    }\n  }\n\n  /**\n   * Export analytics data to PDF format\n   */\n  async exportToPDF(exportData: AnalyticsExportData, opts?: { chartQuality?: 'standard' | 'high' | 'print' }): Promise<void> {\n    const jsPDF = await getJsPDF();\n    const pdf = new jsPDF('p', 'mm', 'a4');\n    const pageWidth = pdf.internal.pageSize.width;\n    const pageHeight = pdf.internal.pageSize.height;\n    const margin = 20;\n    let currentY = margin;\n\n    const pixelRatio = (() => {\n      switch (opts?.chartQuality) {\n        case 'standard': return 2;\n        case 'print': return 4;\n        case 'high':\n        default:\n          return 3;\n      }\n    })();\n\n    // Header\n    pdf.setFontSize(20);\n    pdf.text(`Analytics Report - ${exportData.student.name}`, margin, currentY);\n    currentY += 10;\n\n    pdf.setFontSize(12);\n    pdf.text(\n      `Date Range: ${format(exportData.dateRange.start, 'MMM dd, yyyy')} - ${format(exportData.dateRange.end, 'MMM dd, yyyy')}`,\n      margin,\n      currentY\n    );\n    currentY += 10;\n\n    pdf.text(`Generated: ${format(new Date(), 'MMM dd, yyyy HH:mm')}`, margin, currentY);\n    currentY += 15;\n\n    // Summary Section\n    pdf.setFontSize(16);\n    pdf.text('Summary', margin, currentY);\n    currentY += 10;\n\n    pdf.setFontSize(11);\n    const summaryData = [\n      `Total Sessions: ${exportData.data.entries.length}`,\n      `Emotions Tracked: ${exportData.data.emotions.length}`,\n      `Sensory Inputs: ${exportData.data.sensoryInputs.length}`,\n      `Patterns Found: ${exportData.analytics.patterns.length}`,\n      `Correlations: ${exportData.analytics.correlations.length}`\n    ];\n\n    summaryData.forEach(line => {\n      pdf.text(line, margin, currentY);\n      currentY += 7;\n    });\n    currentY += 10;\n\n    // Patterns Section\n    if (exportData.analytics.patterns.length > 0) {\n      if (currentY > pageHeight - 50) {\n        pdf.addPage();\n        currentY = margin;\n      }\n\n      pdf.setFontSize(16);\n      pdf.text('Behavioral Patterns', margin, currentY);\n      currentY += 10;\n\n      pdf.setFontSize(11);\n      exportData.analytics.patterns.forEach((pattern, index) => {\n        if (currentY > pageHeight - 40) {\n          pdf.addPage();\n          currentY = margin;\n        }\n\n        pdf.setFont(undefined, 'bold');\n        pdf.text(`${index + 1}. ${pattern.pattern.replace('-', ' ').replace(/\\b\\w/g, l => l.toUpperCase())}`, margin, currentY);\n        currentY += 7;\n\n        pdf.setFont(undefined, 'normal');\n        pdf.text(`Type: ${pattern.type} | Confidence: ${Math.round(pattern.confidence * 100)}%`, margin + 5, currentY);\n        currentY += 7;\n\n        pdf.text(`Description: ${pattern.description}`, margin + 5, currentY);\n        currentY += 7;\n\n        if (pattern.recommendations && pattern.recommendations.length > 0) {\n          pdf.text('Recommendations:', margin + 5, currentY);\n          currentY += 7;\n\n          pattern.recommendations.forEach(rec => {\n            const lines = pdf.splitTextToSize(`• ${rec}`, pageWidth - margin * 2 - 10);\n            lines.forEach(line => {\n              if (currentY > pageHeight - 20) {\n                pdf.addPage();\n                currentY = margin;\n              }\n              pdf.text(line, margin + 10, currentY);\n              currentY += 6;\n            });\n          });\n        }\n        currentY += 5;\n      });\n    }\n\n    // Correlations Section\n    if (exportData.analytics.correlations.length > 0) {\n      if (currentY > pageHeight - 50) {\n        pdf.addPage();\n        currentY = margin;\n      }\n\n      pdf.setFontSize(16);\n      pdf.text('Environmental Correlations', margin, currentY);\n      currentY += 10;\n\n      pdf.setFontSize(11);\n      exportData.analytics.correlations.forEach((correlation, index) => {\n        if (currentY > pageHeight - 30) {\n          pdf.addPage();\n          currentY = margin;\n        }\n\n        pdf.setFont(undefined, 'bold');\n        pdf.text(`${index + 1}. ${correlation.factor1} ↔ ${correlation.factor2}`, margin, currentY);\n        currentY += 7;\n\n        pdf.setFont(undefined, 'normal');\n        pdf.text(`Correlation: r = ${correlation.correlation.toFixed(3)} | Significance: ${correlation.significance}`, margin + 5, currentY);\n        currentY += 7;\n\n        pdf.text(`Description: ${correlation.description}`, margin + 5, currentY);\n        currentY += 10;\n      });\n    }\n\n    // Predictive Insights Section\n    if (exportData.analytics.predictiveInsights && exportData.analytics.predictiveInsights.length > 0) {\n      if (currentY > pageHeight - 50) {\n        pdf.addPage();\n        currentY = margin;\n      }\n\n      pdf.setFontSize(16);\n      pdf.text('Predictive Insights', margin, currentY);\n      currentY += 10;\n\n      pdf.setFontSize(11);\n      exportData.analytics.predictiveInsights.forEach((insight, index) => {\n        if (currentY > pageHeight - 40) {\n          pdf.addPage();\n          currentY = margin;\n        }\n\n        pdf.setFont(undefined, 'bold');\n        pdf.text(`${index + 1}. ${insight.title}`, margin, currentY);\n        currentY += 7;\n\n        pdf.setFont(undefined, 'normal');\n        pdf.text(`Confidence: ${Math.round(insight.confidence * 100)}% | Severity: ${insight.severity || 'N/A'}`, margin + 5, currentY);\n        currentY += 7;\n\n        const descLines = pdf.splitTextToSize(insight.description, pageWidth - margin * 2 - 10);\n        descLines.forEach(line => {\n          if (currentY > pageHeight - 20) {\n            pdf.addPage();\n            currentY = margin;\n          }\n          pdf.text(line, margin + 5, currentY);\n          currentY += 6;\n        });\n\n        if (insight.prediction) {\n          pdf.text(`Prediction: ${insight.prediction.trend} trend`, margin + 5, currentY);\n          currentY += 7;\n        }\n\n        currentY += 5;\n      });\n    }\n\n    // AI-Generated Insights Section\n    if (exportData.analytics.insights.length > 0) {\n      if (currentY > pageHeight - 50) {\n        pdf.addPage();\n        currentY = margin;\n      }\n\n      pdf.setFontSize(16);\n      pdf.text('AI-Generated Insights', margin, currentY);\n      currentY += 10;\n\n      pdf.setFontSize(11);\n      exportData.analytics.insights.forEach((insight, index) => {\n        if (currentY > pageHeight - 30) {\n          pdf.addPage();\n          currentY = margin;\n        }\n\n        const lines = pdf.splitTextToSize(`${index + 1}. ${insight}`, pageWidth - margin * 2);\n        lines.forEach(line => {\n          pdf.text(line, margin, currentY);\n          currentY += 7;\n        });\n        currentY += 3;\n      });\n    }\n\n    // Charts (two-column layout when using chartExports; fallback to element capture)\n    if (exportData.chartExports && exportData.chartExports.length > 0) {\n      const gutter = 8; // mm\n      const colWidth = (pageWidth - margin * 2 - gutter) / 2;\n      let colIndex = 0;\n      let rowMaxHeight = 0;\n\n      const getImage = async (chart: NonNullable<AnalyticsExportData['chartExports']>[number]): Promise<{ dataURL: string; width: number; height: number }> => {\n        if (chart.svgString) {\n          const svgBlob = new Blob([chart.svgString], { type: 'image/svg+xml;charset=utf-8' });\n          const url = URL.createObjectURL(svgBlob);\n          try {\n            const img = await new Promise<HTMLImageElement>((resolve, reject) => {\n              const i = new Image();\n              i.onload = () => resolve(i);\n              i.onerror = reject;\n              i.src = url;\n            });\n            const aspect = img.height / img.width;\n            return { dataURL: chart.svgString as unknown as string, width: colWidth, height: colWidth * aspect };\n          } finally {\n            URL.revokeObjectURL(url);\n          }\n        }\n        if (chart.dataURL) {\n          const natural = await new Promise<{ w: number; h: number }>((resolve) => {\n            const i = new Image();\n            i.onload = () => resolve({ w: i.width, h: i.height });\n            i.src = chart.dataURL!;\n          });\n          const aspect = natural.h / natural.w;\n          return { dataURL: chart.dataURL, width: colWidth, height: colWidth * aspect };\n        }\n        throw new Error('Missing chart image data');\n      };\n\n      for (const c of exportData.chartExports) {\n        try {\n          if (currentY > pageHeight - 50) {\n            pdf.addPage();\n            currentY = margin;\n            colIndex = 0;\n            rowMaxHeight = 0;\n          }\n\n          const img = await getImage(c);\n          const x = margin + (colIndex === 0 ? 0 : colWidth + gutter);\n          const titleHeight = 6;\n          pdf.setFontSize(12);\n          pdf.text(c.title, x, currentY);\n          const yImage = currentY + titleHeight;\n\n          pdf.addImage(img.dataURL, 'PNG', x, yImage, img.width, img.height);\n\n          rowMaxHeight = Math.max(rowMaxHeight, titleHeight + img.height + 6);\n          if (colIndex === 1) {\n            currentY += rowMaxHeight;\n            rowMaxHeight = 0;\n            colIndex = 0;\n          } else {\n            colIndex = 1;\n          }\n        } catch (e) {\n          logger.error('Error adding chart export to PDF:', e);\n        }\n      }\n    } else if (exportData.charts && exportData.charts.length > 0) {\n      for (const chart of exportData.charts) {\n        try {\n          pdf.addPage();\n          currentY = margin;\n          pdf.setFontSize(16);\n          pdf.text(chart.title, margin, currentY);\n          currentY += 10;\n\n          const html2canvas = await getHtml2Canvas();\n          const canvas = await html2canvas(chart.element, {\n            scale: pixelRatio,\n            backgroundColor: '#ffffff',\n            logging: false\n          });\n\n          const imgWidth = pageWidth - margin * 2;\n          const imgHeight = (canvas.height * imgWidth) / canvas.width;\n          const imgData = canvas.toDataURL('image/png');\n          pdf.addImage(imgData, 'PNG', margin, currentY, imgWidth, imgHeight);\n        } catch (error) {\n          logger.error('Error adding chart to PDF:', error);\n        }\n      }\n    }\n\n    // Save the PDF\n    pdf.save(`analytics-report-${exportData.student.name.replace(/\\s+/g, '-').toLowerCase()}-${format(new Date(), 'yyyy-MM-dd')}.pdf`);\n  }\n\n  /**\n   * Export analytics data to CSV format\n   */\n  exportToCSV(exportData: AnalyticsExportData): void {\n    const csvSections: string[] = [];\n\n    // Header Information\n    csvSections.push('Analytics Report');\n    csvSections.push(`Student Name,${exportData.student.name}`);\n    csvSections.push(`Date Range,\"${format(exportData.dateRange.start, 'MMM dd, yyyy')} - ${format(exportData.dateRange.end, 'MMM dd, yyyy')}\"`);\n    csvSections.push(`Generated,${format(new Date(), 'MMM dd, yyyy HH:mm')}`);\n    csvSections.push('');\n\n    // Summary\n    csvSections.push('Summary');\n    csvSections.push(`Total Sessions,${exportData.data.entries.length}`);\n    csvSections.push(`Emotions Tracked,${exportData.data.emotions.length}`);\n    csvSections.push(`Sensory Inputs,${exportData.data.sensoryInputs.length}`);\n    csvSections.push(`Patterns Found,${exportData.analytics.patterns.length}`);\n    csvSections.push(`Correlations,${exportData.analytics.correlations.length}`);\n    csvSections.push('');\n\n    // Emotion Data\n    if (exportData.data.emotions.length > 0) {\n      csvSections.push('Emotion Data');\n      csvSections.push('Date,Time,Emotion,Intensity,Triggers,Notes');\n      exportData.data.emotions.forEach(emotion => {\n        csvSections.push(\n          `${format(emotion.timestamp, 'yyyy-MM-dd')},${format(emotion.timestamp, 'HH:mm')},\"${emotion.emotion}\",${emotion.intensity},\"${(emotion.triggers || []).join('; ')}\",\"${emotion.notes || ''}\"`\n        );\n      });\n      csvSections.push('');\n    }\n\n    // Sensory Data\n    if (exportData.data.sensoryInputs.length > 0) {\n      csvSections.push('Sensory Input Data');\n      csvSections.push('Date,Time,Type,Response,Intensity,Context,Notes');\n      exportData.data.sensoryInputs.forEach(sensory => {\n        const contextVal = (sensory as unknown as { context?: string }).context ?? '';\n        const intensityVal = typeof sensory.intensity === 'number' ? sensory.intensity : '';\n        csvSections.push(\n          `${format(sensory.timestamp, 'yyyy-MM-dd')},${format(sensory.timestamp, 'HH:mm')},\"${sensory.sensoryType}\",\"${sensory.response}\",${intensityVal},\"${contextVal}\",\"${sensory.notes || ''}\"`\n        );\n      });\n      csvSections.push('');\n    }\n\n    // Patterns\n    if (exportData.analytics.patterns.length > 0) {\n      csvSections.push('Behavioral Patterns');\n      csvSections.push('Pattern,Type,Confidence,Frequency,Data Points,Description,Recommendations');\n      exportData.analytics.patterns.forEach(pattern => {\n        csvSections.push(\n          `\"${pattern.pattern}\",\"${pattern.type}\",${(pattern.confidence * 100).toFixed(1)}%,${pattern.frequency},${pattern.dataPoints},\"${pattern.description}\",\"${(pattern.recommendations || []).join('; ')}\"`\n        );\n      });\n      csvSections.push('');\n    }\n\n    // Correlations\n    if (exportData.analytics.correlations.length > 0) {\n      csvSections.push('Environmental Correlations');\n      csvSections.push('Factor 1,Factor 2,Correlation,Significance,Description,Recommendations');\n      exportData.analytics.correlations.forEach(correlation => {\n        csvSections.push(\n          `\"${correlation.factor1}\",\"${correlation.factor2}\",${correlation.correlation.toFixed(3)},\"${correlation.significance}\",\"${correlation.description}\",\"${(correlation.recommendations || []).join('; ')}\"`\n        );\n      });\n      csvSections.push('');\n    }\n\n    // Predictive Insights\n    if (exportData.analytics.predictiveInsights && exportData.analytics.predictiveInsights.length > 0) {\n      csvSections.push('Predictive Insights');\n      csvSections.push('Title,Confidence,Severity,Description,Trend,Recommendations');\n      exportData.analytics.predictiveInsights.forEach(insight => {\n        csvSections.push(\n          `\"${insight.title}\",${(insight.confidence * 100).toFixed(1)}%,\"${insight.severity || 'N/A'}\",\"${insight.description}\",\"${insight.prediction?.trend || 'N/A'}\",\"${(insight.recommendations || []).join('; ')}\"`\n        );\n      });\n    }\n\n    // Create and download CSV\n    const csvContent = csvSections.join('\\n');\n    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n    const filename = `analytics-report-${exportData.student.name.replace(/\\s+/g, '-').toLowerCase()}-${format(new Date(), 'yyyy-MM-dd')}.csv`;\n    \n    downloadBlob(blob, filename);\n  }\n\n  /**\n   * Export analytics data to JSON format\n   */\n  exportToJSON(exportData: AnalyticsExportData): void {\n    const jsonData = {\n      metadata: {\n        studentName: exportData.student.name,\n        studentId: exportData.student.id,\n        dateRange: {\n          start: exportData.dateRange.start.toISOString(),\n          end: exportData.dateRange.end.toISOString()\n        },\n        generatedAt: new Date().toISOString(),\n        version: '1.0.0'\n      },\n      summary: {\n        totalSessions: exportData.data.entries.length,\n        totalEmotions: exportData.data.emotions.length,\n        totalSensoryInputs: exportData.data.sensoryInputs.length,\n        totalPatterns: exportData.analytics.patterns.length,\n        totalCorrelations: exportData.analytics.correlations.length\n      },\n      data: {\n        emotions: exportData.data.emotions.map(emotion => ({\n          id: emotion.id,\n          timestamp: emotion.timestamp.toISOString(),\n          emotion: emotion.emotion,\n          intensity: emotion.intensity,\n          triggers: emotion.triggers || [],\n          notes: emotion.notes || null\n        })),\n        sensoryInputs: exportData.data.sensoryInputs.map(sensory => {\n          const withOptional = sensory as unknown as { context?: string; intensity?: number | null };\n          return {\n            id: sensory.id,\n            timestamp: sensory.timestamp.toISOString(),\n            sensoryType: sensory.sensoryType,\n            response: sensory.response,\n            intensity: typeof sensory.intensity === 'number' ? sensory.intensity : null,\n            context: withOptional.context ?? null,\n            notes: sensory.notes || null\n          };\n        }),\n        trackingEntries: exportData.data.entries.map(entry => ({\n          id: entry.id,\n          timestamp: entry.timestamp.toISOString(),\n          emotionCount: entry.emotions.length,\n          sensoryCount: entry.sensoryInputs.length,\n          environmentalData: entry.environmentalData || null\n        }))\n      },\n      analytics: {\n        patterns: exportData.analytics.patterns.map(pattern => ({\n          pattern: pattern.pattern,\n          type: pattern.type,\n          confidence: pattern.confidence,\n          frequency: pattern.frequency,\n          dataPoints: pattern.dataPoints,\n          description: pattern.description,\n          recommendations: pattern.recommendations || []\n        })),\n        correlations: exportData.analytics.correlations.map(correlation => ({\n          factor1: correlation.factor1,\n          factor2: correlation.factor2,\n          correlation: correlation.correlation,\n          significance: correlation.significance,\n          description: correlation.description,\n          recommendations: correlation.recommendations || []\n        })),\n        insights: exportData.analytics.insights,\n        predictiveInsights: exportData.analytics.predictiveInsights?.map(insight => ({\n          title: insight.title,\n          description: insight.description,\n          confidence: insight.confidence,\n          severity: insight.severity || null,\n          prediction: insight.prediction ? {\n            trend: insight.prediction.trend,\n            accuracy: insight.prediction.accuracy || null\n          } : null,\n          recommendations: insight.recommendations || []\n        })) || [],\n        anomalies: exportData.analytics.anomalies?.map(anomaly => ({\n          type: anomaly.type,\n          severity: anomaly.severity,\n          timestamp: anomaly.timestamp.toISOString(),\n          description: anomaly.description || null\n        })) || []\n      }\n    };\n\n    // Create and download JSON\n    const jsonString = JSON.stringify(jsonData, null, 2);\n    const blob = new Blob([jsonString], { type: 'application/json;charset=utf-8;' });\n    const filename = `analytics-report-${exportData.student.name.replace(/\\s+/g, '-').toLowerCase()}-${format(new Date(), 'yyyy-MM-dd')}.json`;\n    \n    downloadBlob(blob, filename);\n  }\n}\n\nexport const analyticsExport = new AnalyticsExport();","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analyticsExportOptimized.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1209,1212],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1209,1212],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1228,1231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1228,1231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { format } from 'date-fns';\nimport { Student, TrackingEntry, EmotionEntry, SensoryEntry } from '@/types/student';\nimport type { ExportFormat } from '@/types/analytics';\nimport { PatternResult, CorrelationResult } from '@/lib/patternAnalysis';\nimport { PredictiveInsight, AnomalyDetection } from '@/lib/enhancedPatternAnalysis';\nimport { logger } from '@/lib/logger';\nimport { downloadBlob } from '@/lib/utils';\n\n\nexport interface AnalyticsExportData {\n  student: Student;\n  dateRange: {\n    start: Date;\n    end: Date;\n  };\n  data: {\n    entries: TrackingEntry[];\n    emotions: EmotionEntry[];\n    sensoryInputs: SensoryEntry[];\n  };\n  analytics: {\n    patterns: PatternResult[];\n    correlations: CorrelationResult[];\n    insights: string[];\n    predictiveInsights?: PredictiveInsight[];\n    anomalies?: AnomalyDetection[];\n  };\n  charts?: {\n    element: HTMLElement;\n    title: string;\n  }[];\n  chartExports?: {\n    title: string;\n    type?: string;\n    dataURL?: string;\n    svgString?: string;\n  }[];\n}\n\n/**\n * Optimized Analytics Export class with lazy-loaded PDF dependencies\n * This reduces the initial bundle size by ~600KB\n */\nclass AnalyticsExportOptimized {\n  private pdfLibCache: { jsPDF?: any; html2canvas?: any } = {};\n\n  /**\n   * Dynamically load PDF libraries only when needed\n   */\n  private async loadPDFLibraries() {\n    if (!this.pdfLibCache.jsPDF || !this.pdfLibCache.html2canvas) {\n      logger.debug('Loading PDF libraries dynamically...');\n      const [{ default: jsPDF }, { default: html2canvas }] = await Promise.all([\n        import('jspdf'),\n        import('html2canvas')\n      ]);\n      this.pdfLibCache.jsPDF = jsPDF;\n      this.pdfLibCache.html2canvas = html2canvas;\n    }\n    return this.pdfLibCache;\n  }\n\n  /**\n   * Export analytics data to the specified format\n   */\n  async exportTo(format: ExportFormat, exportData: AnalyticsExportData): Promise<void> {\n    switch (format) {\n      case 'pdf':\n        await this.exportToPDF(exportData);\n        break;\n      case 'csv':\n        this.exportToCSV(exportData);\n        break;\n      case 'json':\n        this.exportToJSON(exportData);\n        break;\n      default:\n        throw new Error(`Unsupported export format: ${format}`);\n    }\n  }\n\n  /**\n   * Export analytics data to PDF format with lazy-loaded dependencies\n   */\n  async exportToPDF(exportData: AnalyticsExportData): Promise<void> {\n    // Dynamically import heavy PDF libraries\n    const { jsPDF } = await this.loadPDFLibraries();\n    \n    const pdf = new jsPDF('p', 'mm', 'a4');\n    // pageWidth/pageHeight not used currently\n    const margin = 20;\n    let currentY = margin;\n\n    // Header\n    pdf.setFontSize(20);\n    pdf.text(`Analytics Report - ${exportData.student.name}`, margin, currentY);\n    currentY += 10;\n\n    pdf.setFontSize(12);\n    pdf.text(\n      `Date Range: ${format(exportData.dateRange.start, 'MMM dd, yyyy')} - ${format(exportData.dateRange.end, 'MMM dd, yyyy')}`,\n      margin,\n      currentY\n    );\n    currentY += 10;\n\n    pdf.text(`Generated: ${format(new Date(), 'MMM dd, yyyy HH:mm')}`, margin, currentY);\n    currentY += 15;\n\n    // Summary Section\n    pdf.setFontSize(16);\n    pdf.text('Summary', margin, currentY);\n    currentY += 10;\n\n    pdf.setFontSize(11);\n    const summaryData = [\n      `Total Sessions: ${exportData.data.entries.length}`,\n      `Emotions Tracked: ${exportData.data.emotions.length}`,\n      `Sensory Inputs: ${exportData.data.sensoryInputs.length}`,\n      `Patterns Found: ${exportData.analytics.patterns.length}`,\n      `Correlations: ${exportData.analytics.correlations.length}`\n    ];\n\n    summaryData.forEach(line => {\n      pdf.text(line, margin, currentY);\n      currentY += 7;\n    });\n\n    // Continue with patterns, correlations, etc. (trimmed for brevity)\n    // The rest of the PDF generation logic remains the same\n\n    // Save the PDF\n    const filename = `analytics-report-${exportData.student.name.replace(/\\s+/g, '-').toLowerCase()}-${format(new Date(), 'yyyy-MM-dd')}.pdf`;\n    pdf.save(filename);\n  }\n\n  /**\n   * Export analytics data to CSV format (lightweight, no external deps)\n   */\n  exportToCSV(exportData: AnalyticsExportData): void {\n    const csvSections: string[] = [];\n\n    // Header\n    csvSections.push('Analytics Report');\n    csvSections.push(`Student: ${exportData.student.name}`);\n    csvSections.push(`Date Range: ${format(exportData.dateRange.start, 'yyyy-MM-dd')} to ${format(exportData.dateRange.end, 'yyyy-MM-dd')}`);\n    csvSections.push(`Generated: ${format(new Date(), 'yyyy-MM-dd HH:mm:ss')}`);\n    csvSections.push('');\n\n    // Summary\n    csvSections.push('Summary');\n    csvSections.push(`Total Sessions,${exportData.data.entries.length}`);\n    csvSections.push(`Emotions Tracked,${exportData.data.emotions.length}`);\n    csvSections.push(`Sensory Inputs,${exportData.data.sensoryInputs.length}`);\n    csvSections.push(`Patterns Found,${exportData.analytics.patterns.length}`);\n    csvSections.push(`Correlations,${exportData.analytics.correlations.length}`);\n    csvSections.push('');\n\n    // Create and download CSV\n    const csvContent = csvSections.join('\\n');\n    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n    const filename = `analytics-report-${exportData.student.name.replace(/\\s+/g, '-').toLowerCase()}-${format(new Date(), 'yyyy-MM-dd')}.csv`;\n    \n    downloadBlob(blob, filename);\n  }\n\n  /**\n   * Export analytics data to JSON format (lightweight, no external deps)\n   */\n  exportToJSON(exportData: AnalyticsExportData): void {\n    const jsonData = {\n      metadata: {\n        studentName: exportData.student.name,\n        studentId: exportData.student.id,\n        dateRange: {\n          start: exportData.dateRange.start.toISOString(),\n          end: exportData.dateRange.end.toISOString()\n        },\n        generatedAt: new Date().toISOString(),\n        version: '1.0.0'\n      },\n      summary: {\n        totalSessions: exportData.data.entries.length,\n        totalEmotions: exportData.data.emotions.length,\n        totalSensoryInputs: exportData.data.sensoryInputs.length,\n        totalPatterns: exportData.analytics.patterns.length,\n        totalCorrelations: exportData.analytics.correlations.length\n      },\n      data: exportData.data,\n      analytics: exportData.analytics\n    };\n\n    // Create and download JSON\n    const jsonString = JSON.stringify(jsonData, null, 2);\n    const blob = new Blob([jsonString], { type: 'application/json;charset=utf-8;' });\n    const filename = `analytics-report-${exportData.student.name.replace(/\\s+/g, '-').toLowerCase()}-${format(new Date(), 'yyyy-MM-dd')}.json`;\n    \n    downloadBlob(blob, filename);\n  }\n}\n\n// Export singleton instance\nexport const analyticsExport = new AnalyticsExportOptimized();\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analyticsManager.orchestrator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analyticsManager.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnalyticsResultsAI' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":49},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used. Allowed unused caught errors must match /^_/u.","line":196,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":196,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":319,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":319,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13800,13803],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13800,13803],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'goals' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":391,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":391,"endColumn":18},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":443,"column":110,"nodeType":"BlockStatement","messageId":"unexpected","endLine":443,"endColumn":112,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[19277,19277],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":774,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":774,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31791,31794],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31791,31794],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":827,"column":120,"nodeType":"BlockStatement","messageId":"unexpected","endLine":827,"endColumn":122,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[34215,34215],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":881,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":881,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36320,36323],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36320,36323],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":881,"column":94,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":881,"endColumn":97,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36346,36349],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36346,36349],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":882,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":882,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36415,36418],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36415,36418],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":892,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":892,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36932,36935],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36932,36935],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":893,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":893,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36984,36987],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36984,36987],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Student, EmotionEntry, SensoryEntry } from \"@/types/student\";\nimport { computeInsights, type ComputeInsightsInputs } from \"@/lib/insights/unified\";\nimport { generateAnalyticsSummary } from \"@/lib/analyticsSummary\";\nimport { alertSystem } from \"@/lib/alertSystem\";\nimport { dataStorage, IDataStorage } from \"@/lib/dataStorage\";\n// Mock seeding has been moved to optional utilities under lib/mock; not used here\nimport { ANALYTICS_CONFIG, DEFAULT_ANALYTICS_CONFIG, analyticsConfig, STORAGE_KEYS } from \"@/lib/analyticsConfig\";\nimport { logger } from \"@/lib/logger\";\nimport type { AnalyticsResults } from \"@/types/analytics\";\n// AI analysis integration\nimport { HeuristicAnalysisEngine, LLMAnalysisEngine } from \"@/lib/analysis\";\nimport type { AnalysisEngine, AnalyticsResultsAI, AnalysisOptions, AiMetadata } from \"@/lib/analysis\";\n\n// Compatibility type alias to maintain narrow typing while supporting AI metadata\ntype AnalyticsResultsCompat = AnalyticsResults & { ai?: AiMetadata };\nimport { loadAiConfig } from \"@/lib/aiConfig\";\nimport { getProfileMap, initializeStudentProfile, saveProfiles } from \"@/lib/analyticsProfiles\";\nimport { analyticsCoordinator } from \"@/lib/analyticsCoordinator\";\nimport type { StudentAnalyticsProfile } from \"@/lib/analyticsProfiles\";\n// New orchestrator-style helpers and types\nimport { buildInsightsCacheKey as _buildInsightsCacheKey, buildInsightsTask as _buildInsightsTask } from \"@/lib/insights/task\";\nexport { createInsightsTask as buildTask, createInsightsCacheKey as buildCacheKey } from '@/lib/analyticsTasks';\nimport type { InsightsOptions, AnalyticsResult } from \"@/types/insights\";\n\n// #region Type Definitions\n\n/**\n * Ensures universal analytics initialization for all students in the system.\n * \n * @async\n * @function ensureUniversalAnalyticsInitialization\n * @returns {Promise<void>} A promise that resolves when initialization is complete\n * \n * @description This function handles the complete analytics initialization process:\n * 1. **Mock Data Generation**: If no students exist, generates a minimal set of 3 mock students\n *    to seed the analytics system with baseline data.\n * 2. **Minimum Data Thresholds**: Checks each student against configurable thresholds:\n *    - EMOTION_ENTRIES: Minimum emotion entries required\n *    - SENSORY_ENTRIES: Minimum sensory input entries required  \n *    - TRACKING_ENTRIES: Minimum tracking session entries required\n * 3. **Cache Warming Strategy**: For students meeting minimum data requirements, performs\n *    lightweight precomputation of analytics to populate caches:\n *    - Emotion pattern analysis\n *    - Sensory pattern analysis\n *    - Environmental correlation analysis (if sufficient tracking entries)\n * \n * The function gracefully handles errors and treats cache warming as best-effort.\n * Configuration is loaded from live analytics config with fallback to defaults.\n */\nexport const ensureUniversalAnalyticsInitialization = async (): Promise<void> => {\n  try {\n    // Ensure profiles for existing students; no auto generation of mock data here\n    const cfg = (() => { try { return analyticsConfig.getConfig(); } catch { return null; } })();\n    // Minimum data thresholds source:\n    // - confidence.THRESHOLDS.EMOTION_ENTRIES\n    // - confidence.THRESHOLDS.SENSORY_ENTRIES\n    // - confidence.THRESHOLDS.TRACKING_ENTRIES\n    // Read from live analyticsConfig with safe fallback to defaults (Task 8, rule j9uS...).\n    const minEmotions = cfg?.confidence?.THRESHOLDS?.EMOTION_ENTRIES ?? ANALYTICS_CONFIG.confidence.THRESHOLDS.EMOTION_ENTRIES;\n    const minSensory = cfg?.confidence?.THRESHOLDS?.SENSORY_ENTRIES ?? ANALYTICS_CONFIG.confidence.THRESHOLDS.SENSORY_ENTRIES;\n    const minTracking = cfg?.confidence?.THRESHOLDS?.TRACKING_ENTRIES ?? ANALYTICS_CONFIG.confidence.THRESHOLDS.TRACKING_ENTRIES;\n\n    const allStudents = dataStorage.getStudents();\n    for (const student of allStudents) {\n      // Ensure profile exists (delegated to profiles module)\n      initializeStudentProfile(student.id);\n\n      // Optional: evaluate minimum data for future warming decisions\n      const tracking = dataStorage.getEntriesForStudent(student.id);\n      const emotions = tracking.flatMap(t => t.emotions ?? []);\n      const sensoryInputs = tracking.flatMap(t => t.sensoryInputs ?? []);\n\n      const hasMinimumData =\n        (emotions.length) >= minEmotions ||\n        (sensoryInputs.length) >= minSensory ||\n        (tracking.length) >= minTracking;\n\n      if (hasMinimumData) {\n        // Warming handled elsewhere; no direct action here\n      }\n    }\n\n    // Persist any new profiles created during initialization\n    saveProfiles();\n  } catch (e) {\n    logger.error('[analyticsManager] ensureUniversalAnalyticsInitialization failed', e);\n  }\n};\n\n/**\n * Defines the analytics profile for a student, tracking configuration and health.\n */\n\n/**\n * Represents the complete set of results from an analytics run.\n */\ntype AnalyticsCache = Map<string, { results: AnalyticsResultsCompat; timestamp: Date }>;\ntype AnalyticsProfileMap = Map<string, StudentAnalyticsProfile>;\n// #endregion\n\n// #region Utility & Helper Functions (for better SRP)\n\n/**\n * Safely parses analytics profiles from localStorage with validation and error handling.\n * \n * @function loadProfilesFromStorage\n * @param {string | null} storedProfiles - The stringified profiles from localStorage\n * @returns {AnalyticsProfileMap} A map of valid student profiles, keyed by student ID\n * \n * @description This function provides robust loading of persisted analytics profiles:\n * \n * **Validation Process**:\n * - Checks if input is null/empty, returns empty Map if so\n * - Attempts JSON parsing with try/catch for malformed data\n * - Runtime type validation for each profile object\n * - Validates required fields: studentId (string) and isInitialized (boolean)\n * - Converts date strings back to Date objects for lastAnalyzedAt field\n * \n * **Error Handling**:\n * - Catches and logs JSON parsing errors\n * - Skips invalid profile entries rather than failing completely\n * - Returns empty Map on complete failure to ensure app stability\n * \n * This defensive approach ensures the analytics system remains functional even\n * if localStorage data becomes corrupted or outdated.\n */\n// Profiles are now managed by analyticsProfiles module; local loader retained for backward-compat only if needed\nfunction loadProfilesFromStorage(_storedProfiles: string | null): AnalyticsProfileMap {\n  return getProfileMap();\n}\n\n// #endregion\n\n/**\n * Singleton service managing all analytics operations for the Sensory Tracker application.\n * \n * @class AnalyticsManagerService\n * @singleton\n * \n * @description This service orchestrates all analytics-related operations:\n * \n * **Singleton Pattern Implementation**:\n * - Single instance ensures consistent state across the application\n * - Lazy initialization with getInstance() method\n * - Private constructor prevents direct instantiation\n * - Thread-safe in JavaScript's single-threaded environment\n * \n * **Core Responsibilities**:\n * 1. **Profile Management**: Maintains analytics profiles for each student\n * 2. **Caching Strategy**: Implements TTL-based caching to optimize performance\n * 3. **Analytics Orchestration**: Coordinates pattern analysis, correlations, and predictions\n * 4. **Data Persistence**: Manages localStorage for profile persistence\n * \n * **Caching Behavior**:\n * - Cache entries stored with timestamp\n * - TTL (Time To Live) configured via ANALYTICS_CONFIG.CACHE_TTL\n * - Automatic cache invalidation on data updates\n * - Manual cache clearing available per student or globally\n * \n * **Performance Optimizations**:\n * - Lazy loading of analytics data\n * - Batch processing for multiple students\n * - Graceful error handling with Promise.allSettled\n * \n * @example\n * const manager = AnalyticsManagerService.getInstance();\n * const analytics = await manager.getStudentAnalytics(student);\n */\nlet __lastFacadeLogMinute: number | null = null;\nclass AnalyticsManagerService {\n  private static instance: AnalyticsManagerService;\nprivate analyticsProfiles: AnalyticsProfileMap;\n  // Deprecated TTL cache: callers should use cache keys with their own caches\n  private analyticsCache: AnalyticsCache = new Map();\n  private storage: IDataStorage;\n\n  private constructor(storage: IDataStorage, profiles: AnalyticsProfileMap) {\n    this.storage = storage;\n    this.analyticsProfiles = profiles;\n  }\n\n  /**\n   * Retrieves the singleton instance of the AnalyticsManagerService.\n   * @param {IDataStorage} [storage=dataStorage] - The data storage dependency.\n   * @param {AnalyticsProfileMap} [profiles] - Optional initial profiles to load.\n   * @returns {AnalyticsManagerService} The singleton instance.\n   */\n  static getInstance(\n    storage: IDataStorage = dataStorage,\n    profiles?: AnalyticsProfileMap\n  ): AnalyticsManagerService {\n    if (!AnalyticsManagerService.instance) {\n      let stored: string | null = null;\n      try {\n        stored = typeof localStorage !== 'undefined' ? localStorage.getItem(STORAGE_KEYS.analyticsProfiles) : null;\n      } catch (e) {\n        // environment without localStorage (SSR/tests)\n      }\n      const initialProfiles = profiles ?? loadProfilesFromStorage(stored);\n      AnalyticsManagerService.instance = new AnalyticsManagerService(storage, initialProfiles);\n    }\n    return AnalyticsManagerService.instance;\n  }\n\n  /**\n   * Initializes analytics profile for a new student.\n   * \n   * @public\n   * @method initializeStudentAnalytics\n   * @param {string} studentId - Unique identifier for the student\n   * @returns {void}\n   * \n   * @description Creates and persists an analytics profile for a student if not already initialized.\n   * \n   * **Profile Initialization**:\n   * - Checks if profile already exists (idempotent operation)\n   * - Creates default profile with all analytics features enabled\n   * - Sets minimal data requirements (1 entry each for emotions, sensory, tracking)\n   * - Initializes health score to 0 (will be calculated on first analysis)\n   * - Persists profile to localStorage immediately\n   * \n   * **Default Configuration**:\n   * - patternAnalysisEnabled: true\n   * - correlationAnalysisEnabled: true\n   * - predictiveInsightsEnabled: true\n   * - anomalyDetectionEnabled: true\n   * - alertSystemEnabled: true\n   * \n   * This method is automatically called when accessing student analytics,\n   * ensuring profiles exist before analysis.\n   */\n  public initializeStudentAnalytics(studentId: string): void {\n    try {\n      if (!studentId || typeof studentId !== 'string') {\n        logger.warn('[analyticsManager] initializeStudentAnalytics: invalid studentId', { studentId });\n        return;\n      }\n\n      if (this.analyticsProfiles.has(studentId)) {\n        return;\n      }\n\n      const profile: StudentAnalyticsProfile = {\n        studentId,\n        isInitialized: true,\n        lastAnalyzedAt: null,\n        analyticsConfig: {\n          patternAnalysisEnabled: true,\n          correlationAnalysisEnabled: true,\n          predictiveInsightsEnabled: true,\n          anomalyDetectionEnabled: true,\n          alertSystemEnabled: true,\n        },\n        minimumDataRequirements: {\n          emotionEntries: 1,\n          sensoryEntries: 1,\n          trackingEntries: 1,\n        },\n        analyticsHealthScore: 0,\n      };\n\n      this.analyticsProfiles.set(studentId, profile);\n      saveProfiles();\n    } catch (error) {\n      logger.error('[analyticsManager] initializeStudentAnalytics failed', { error, studentId });\n      // fail-soft: continue without profile initialization to prevent app crash\n    }\n  }\n\n  /**\n   * Retrieves comprehensive analytics for a specific student.\n   * \n   * @public\n   * @async\n   * @method getStudentAnalytics\n   * @param {Student} student - The student object to analyze\n   * @param {{ useAI?: boolean }} [options] - Optional runtime toggle for AI analysis\n   * @returns {Promise<AnalyticsResults>} Complete analytics results including patterns, correlations, and insights\n   * \n   * @description Main entry point for retrieving student analytics with intelligent caching.\n   * \n   * **Caching Strategy**:\n   * 1. Ensures student profile is initialized\n   * 2. Checks cache for existing results\n   * 3. Returns cached results if within TTL (Time To Live)\n   * 4. Generates fresh analytics if cache miss or expired\n   * 5. Updates cache with new results and timestamp\n   * \n   * **TTL Behavior**:\n   * - Default TTL: Configured in ANALYTICS_CONFIG.CACHE_TTL\n   * - Cache validity: timestamp + TTL > current time\n   * - Expired entries trigger regeneration\n   * \n   * **Side Effects**:\n   * - Updates lastAnalyzedAt timestamp in profile\n   * - Recalculates and updates health score\n   * - Persists updated profile to localStorage\n   * \n   * @throws {Error} If analytics generation fails (wrapped from generateAnalytics)\n   * \n   * @example\n   * const results = await analyticsManager.getStudentAnalytics(student);\n   * logger.info(`Confidence: ${results.confidence * 100}%`);\n   */\n  public async getStudentAnalytics(student: Student, options?: { useAI?: boolean }): Promise<AnalyticsResults> {\n    this.initializeStudentAnalytics(student.id);\n\n    // Check TTL cache for existing results\n    const cached = this.analyticsCache.get(student.id);\n    if (cached) {\n      const now = new Date();\n      const cacheAge = now.getTime() - cached.timestamp.getTime();\n      const liveCfg = (() => { try { return analyticsConfig.getConfig(); } catch { return null; } })();\n      const ttl = liveCfg?.cache?.ttl ?? ANALYTICS_CONFIG.cache.ttl;\n      const preferAI = options?.useAI === true;\n      const preferHeuristic = options?.useAI === false;\n\n      // Determine whether the cached result was produced by an AI provider (non-heuristic)\n      const provider = (cached.results as any)?.ai?.provider;\n      const isCachedAI = typeof provider === 'string' && provider.toLowerCase() !== 'heuristic';\n\n      if (cacheAge < ttl) {\n        // When runtime explicitly requests heuristic (useAI=false) and cache holds AI, bypass cache\n        if (preferHeuristic) {\n          if (!isCachedAI) {\n            return cached.results;\n          }\n          // else: cached is AI; fall through to regenerate heuristically\n        } else if (preferAI) {\n          // When AI is preferred, only return if cached is AI\n          if (isCachedAI) {\n            return cached.results;\n          }\n          // else: fall through to regenerate with AI\n        } else {\n          // No explicit preference provided; accept any fresh cached result\n          return cached.results;\n        }\n      }\n    }\n\n    const results = await this.generateAnalytics(student, options?.useAI);\n    this.analyticsCache.set(student.id, { results, timestamp: new Date() });\n\n    const profile = this.analyticsProfiles.get(student.id);\n    if (profile) {\n      const updatedProfile: StudentAnalyticsProfile = {\n        ...profile,\n        lastAnalyzedAt: new Date(),\n        analyticsHealthScore: this.calculateHealthScore(results),\n      };\n      this.analyticsProfiles.set(student.id, updatedProfile);\n      saveProfiles();\n    }\n\n    return results;\n  }\n\n  /**\n   * Generates fresh analytics for a student using the selected analysis engine.\n   * \n   * @private\n   * @async\n   * @method generateAnalytics\n   * @param {Student} student - The student to analyze\n   * @param {boolean} [useAI] - Optional runtime AI toggle\n   * @returns {Promise<AnalyticsResultsCompat>} Complete analytics results\n   * \n   * @description Delegates analytics generation to a pluggable analysis engine\n   * (heuristic or AI) with graceful fallback and summary facade integration.\n   * \n   * @throws {Error} Analytics generation failed for student\n   */\n  private async generateAnalytics(student: Student, useAI?: boolean): Promise<AnalyticsResultsCompat> {\n    // Early guard for invalid input\n    if (!student || !student.id) {\n      logger.error('[analyticsManager] generateAnalytics: invalid student', { student });\n      return {\n        patterns: [],\n        correlations: [],\n        environmentalCorrelations: [],\n        predictiveInsights: [],\n        anomalies: [],\n        insights: [],\n        error: 'INVALID_STUDENT',\n      } as AnalyticsResultsCompat;\n    }\n\n    try {\n      const trackingEntries = this.storage.getEntriesForStudent(student.id) || [];\n      const goals = this.storage.getGoalsForStudent(student.id) || [];\n      const emotions: EmotionEntry[] = trackingEntries.flatMap(entry => entry.emotions || []);\n      const sensoryInputs: SensoryEntry[] = trackingEntries.flatMap(entry => entry.sensoryInputs || []);\n\n      // Build engine via factory with priority: runtime > config > env\n      const engine = this.createAnalysisEngine(useAI);\n\n      // Always include lightweight AI metadata for lineage/traceability\n      const opts: AnalysisOptions = { includeAiMetadata: true };\n      const results = await engine.analyzeStudent(student.id, undefined, opts);\n\n      // Edge case: if useAI was requested but heuristic was used, add caveat\n      if (useAI === true && engine instanceof HeuristicAnalysisEngine && opts.includeAiMetadata) {\n        if (!results.ai) results.ai = {};\n        if (!results.ai.caveats) results.ai.caveats = [];\n        results.ai.caveats.push('AI disabled or unavailable; heuristic used');\n      }\n\n      // Optionally replace insights via summary facade when enabled\n      try {\n        const liveConfig = (() => {\n          try { return analyticsConfig.getConfig(); } catch { return null; }\n        })();\n        const useSummaryFacade = (liveConfig?.features?.enableSummaryFacade ?? ANALYTICS_CONFIG.features?.enableSummaryFacade) === true;\n        if (useSummaryFacade) {\n          const summary = await generateAnalyticsSummary({\n            entries: trackingEntries,\n            emotions,\n            sensoryInputs,\n            results: {\n              patterns: (results as AnalyticsResultsCompat).patterns ?? [],\n              correlations: (results as AnalyticsResultsCompat).correlations ?? [],\n              predictiveInsights: (results as AnalyticsResultsCompat).predictiveInsights ?? [],\n            },\n          });\n          // Replace insights; attach optional metadata for downstream health score\n          (results as AnalyticsResultsCompat).insights = summary.insights;\n          (results as unknown as AnalyticsResultsCompat & { hasMinimumData?: boolean; confidence?: number }).hasMinimumData = summary.hasMinimumData;\n          (results as unknown as AnalyticsResultsCompat & { hasMinimumData?: boolean; confidence?: number }).confidence = summary.confidence;\n          // Low-noise telemetry: log at most once per minute when facade used\n          try {\n            const nowMinute = new Date().getMinutes();\n            if (__lastFacadeLogMinute !== nowMinute) {\n              logger.debug('[analyticsManager] Using summary facade for insights', {\n                studentId: student.id,\n                entries: trackingEntries.length,\n                emotions: emotions.length,\n                sensory: sensoryInputs.length,\n              });\n              __lastFacadeLogMinute = nowMinute;\n            }\n          } catch (e) {\n            try { logger.warn('[analyticsManager] Summary facade debug logging failed', e as Error); } catch {}\n          }\n        }\n      } catch (e) {\n        logger.warn('[analyticsManager] Summary facade failed, keeping original insights:', e);\n        // fail-soft: keep original insights when summary facade fails\n      }\n      \n      // Trigger alerts if we have tracking data - this is the only side effect\n      if (trackingEntries.length > 0) {\n        await alertSystem.generateAlertsForStudent(student, emotions, sensoryInputs, trackingEntries);\n      }\n      \n      return results as AnalyticsResultsCompat;\n    } catch (error) {\n      logger.error(`[analyticsManager] generateAnalytics failed for student ${student.id}`, { error: error instanceof Error ? { message: error.message, stack: error.stack, name: error.name } : error });\n      // Attempt heuristic fallback on failure\n      try {\n        const fallback = await new HeuristicAnalysisEngine().analyzeStudent(student.id, undefined, { includeAiMetadata: true });\n        return fallback as AnalyticsResultsCompat;\n      } catch {\n        // Return minimal safe result to prevent UI crashes\n        return {\n          patterns: [],\n          correlations: [],\n          environmentalCorrelations: [],\n          predictiveInsights: [],\n          anomalies: [],\n          insights: [],\n          error: 'ANALYTICS_GENERATION_FAILED',\n        } as AnalyticsResultsCompat;\n      }\n    }\n  }\n\n  /**\n   * Calculates an \"analytics health score\" based on the completeness and confidence of the results.\n   * @private\n   * @param {AnalyticsResultsCompat} results - The results from an analytics run.\n   * @returns {number} A score from 0 to 100.\n   */\n  private calculateHealthScore(results: AnalyticsResultsCompat): number {\n    const liveCfg = (() => { try { return analyticsConfig.getConfig(); } catch { return null; } })();\n    const { WEIGHTS } = (liveCfg?.healthScore ?? ANALYTICS_CONFIG.healthScore);\n    let score = 0;\n\n    if (results.patterns.length > 0) score += WEIGHTS.PATTERNS;\n    if (results.correlations.length > 0) score += WEIGHTS.CORRELATIONS;\n    if (results.predictiveInsights.length > 0) score += WEIGHTS.PREDICTIONS;\n    if (results.anomalies.length > 0) score += WEIGHTS.ANOMALIES;\n\n    // Use optional metadata if provided; otherwise infer minimum data presence and default confidence\n    const extended = results as AnalyticsResultsCompat & { hasMinimumData?: boolean; confidence?: number };\n    const hasMinimumData = extended.hasMinimumData ?? (results.patterns.length > 0 || results.correlations.length > 0);\n    if (hasMinimumData) score += WEIGHTS.MINIMUM_DATA;\n    // Prefer AI confidence when available\n    const aiConfidence = typeof results.ai?.confidence?.overall === 'number' ? results.ai?.confidence?.overall : undefined;\n    const confidence = typeof aiConfidence === 'number'\n      ? aiConfidence\n      : (typeof extended.confidence === 'number' ? extended.confidence : 1);\n\n    // Base score scaled by confidence\n    let finalScore = Math.round(score * confidence);\n\n    // AI metadata bonuses: small additive boosts for high-quality AI runs\n    if (results.ai) {\n      const caveats = results.ai.caveats || [];\n      const usedFallback = caveats.some(c => /fallback/i.test(c));\n      const heuristicOnly = (results.ai.provider || '').toLowerCase() === 'heuristic';\n      // Bonus for successful AI (non-heuristic, no fallback)\n      if (!heuristicOnly && !usedFallback) {\n        finalScore += 5;\n      } else if (!heuristicOnly && usedFallback) {\n        finalScore += 2; // partial credit for attempted AI with safe fallback\n      }\n      // Data lineage quality: modest boost based on presence/coverage\n      const lineageCount = results.ai.dataLineage?.length ?? 0;\n      if (lineageCount >= 3) finalScore += 3;\n      else if (lineageCount === 2) finalScore += 2;\n      else if (lineageCount === 1) finalScore += 1;\n    }\n\n    return Math.max(0, Math.min(100, finalScore));\n  }\n\n  /**\n   * Forces a re-calculation of analytics for a specific student by clearing their cache\n   * and re-running the analysis.\n   * @param {Student} student - The student to re-analyze.\n   */\n  public async triggerAnalyticsForStudent(student: Student): Promise<void> {\n    try {\n      if (!student || !student.id) {\n        logger.warn('[analyticsManager] triggerAnalyticsForStudent: invalid student', { student });\n        return;\n      }\n      this.analyticsCache.delete(student.id);\n      await this.getStudentAnalytics(student);\n    } catch (error) {\n      logger.error('[analyticsManager] triggerAnalyticsForStudent failed', { error, studentId: student?.id });\n      // fail-soft: continue without triggering analytics to prevent cascade failures\n    }\n  }\n\n  /**\n   * Triggers an analytics refresh for all students in the system.\n   * Uses Promise.allSettled to ensure that one failed analysis does not stop others.\n   */\n  public async triggerAnalyticsForAllStudents(): Promise<void> {\n    const students = this.storage.getStudents();\n    \n    const analyticsPromises = students.map(student => {\n      this.initializeStudentAnalytics(student.id);\n      return this.triggerAnalyticsForStudent(student);\n    });\n\n    const settledResults = await Promise.allSettled(analyticsPromises);\n\n    settledResults.forEach((result, index) => {\n      if (result.status === 'rejected') {\n        logger.error(`Failed to process analytics for student ${students[index].id}:`, result.reason);\n      }\n    });\n  }\n\n  /**\n   * Gets the current analytics status for all students, including health scores and last analysis time.\n   * This is useful for displaying a high-level dashboard of the system's state.\n   * @returns {Array<object>} An array of status objects for each student.\n   */\n  public getAnalyticsStatus() {\n    const students = this.storage.getStudents();\n    return students.map(student => {\n      const profile = this.analyticsProfiles.get(student.id);\n      const cached = this.analyticsCache.get(student.id);\n      \n      return {\n        studentId: student.id,\n        studentName: student.name,\n        isInitialized: profile?.isInitialized ?? false,\n        lastAnalyzed: profile?.lastAnalyzedAt ?? null,\n        healthScore: profile?.analyticsHealthScore ?? 0,\n        hasMinimumData: cached?.results.hasMinimumData ?? false,\n      };\n    });\n  }\n\n  /**\n   * Clears the analytics cache.\n   * @param {string} [studentId] - If provided, clears the cache for only that student.\n   * Otherwise, clears the entire analytics cache.\n   */\n  public clearCache(studentId?: string): void {\n    if (studentId) {\n      this.analyticsCache.delete(studentId);\n    } else {\n      this.analyticsCache.clear();\n    }\n  }\n\n  /**\n   * Notify workers and hooks to clear caches via global events\n   */\n  private notifyWorkerCacheClear(studentId?: string): void {\n    try {\n      analyticsCoordinator.broadcastCacheClear(studentId);\n    } catch (e) {\n      logger.warn('[analyticsManager] notifyWorkerCacheClear failed', e as Error);\n    }\n  }\n\n  /**\n   * Clear known analytics localStorage caches (profiles and others via helpers)\n   */\n  private clearLocalStorageCaches(): { keysCleared: string[] } {\n    const keysCleared: string[] = [];\n    \n    if (typeof localStorage === 'undefined') {\n      return { keysCleared };\n    }\n\n    try {\n      // Gather relevant storage identifiers\n      const relevantPrefixes = [\n        STORAGE_KEYS.cachePrefix,\n        STORAGE_KEYS.performancePrefix\n      ];\n      const exactKeys = [\n        STORAGE_KEYS.analyticsConfig,\n        STORAGE_KEYS.analyticsProfiles,\n        'kreativium_ai_metrics_v1' // AI metrics key from @/lib/ai/metrics\n      ];\n\n      // Iterate over localStorage keys and collect matching ones\n      const keysToRemove: string[] = [];\n      for (let i = 0; i < localStorage.length; i++) {\n        const key = localStorage.key(i);\n        if (!key) continue;\n\n        // Check if key contains any of the prefixes\n        const hasRelevantPrefix = relevantPrefixes.some(prefix => key.includes(prefix));\n        // Check if key exactly matches any of the exact keys\n        const isExactMatch = exactKeys.includes(key);\n\n        if (hasRelevantPrefix || isExactMatch) {\n          keysToRemove.push(key);\n        }\n      }\n\n      // Remove collected keys\n      keysToRemove.forEach(key => {\n        try {\n          localStorage.removeItem(key);\n          keysCleared.push(key);\n        } catch (e) {\n          logger.warn(`[analyticsManager] Failed to remove localStorage key: ${key}`, e as Error);\n        }\n      });\n    } catch (e) {\n      logger.warn('[analyticsManager] clearLocalStorageCaches encountered issues', e as Error);\n    }\n    \n    return { keysCleared };\n  }\n\n  /**\n   * Clear all analytics-related caches across systems and return a summary\n   */\n  public async clearAllAnalyticsCaches(broadcast = true): Promise<{ ok: boolean; summary: Record<string, unknown> }> {\n    const summary: Record<string, unknown> = {};\n    try {\n      // Manager TTL cache\n      this.clearCache();\n      summary.managerCacheCleared = true;\n\n      // Profiles\n      try {\n        const { clearAllProfiles, getProfileCacheStats } = await import('@/lib/analyticsProfiles');\n        const before = getProfileCacheStats().count;\n        const cleared = clearAllProfiles();\n        summary.profilesBefore = before;\n        summary.profilesCleared = cleared;\n      } catch (e) {\n        logger.warn('[analyticsManager] Profile clearing failed', e as Error);\n      }\n\n      // AI metrics (localStorage)\n      try {\n        const { aiMetrics } = await import('@/lib/ai/metrics');\n        aiMetrics.reset();\n        summary.aiMetricsReset = true;\n      } catch (e) {\n        logger.warn('[analyticsManager] aiMetrics reset failed', e as Error);\n      }\n\n      // Precomputation caches broadcast (listeners clear if applicable) - only if broadcast is true\n      if (broadcast) {\n        this.notifyWorkerCacheClear();\n      }\n\n      // LocalStorage keys - now actually removes keys and returns accurate summary\n      const localStorageResult = this.clearLocalStorageCaches();\n      summary.localStorage = localStorageResult;\n\n      logger.info('[analyticsManager] Cleared all analytics caches', summary);\n      return { ok: true, summary };\n    } catch (e) {\n      logger.error('[analyticsManager] clearAllAnalyticsCaches failed', e as Error);\n      return { ok: false, summary };\n    }\n  }\n\n  /**\n   * Clear caches for a specific student across systems\n   */\n  public async clearStudentCaches(studentId: string): Promise<{ ok: boolean; studentId: string }> {\n    try {\n      if (!studentId) return { ok: false, studentId };\n      // Manager-level\n      this.clearCache(studentId);\n\n      // Profiles\n      try {\n        const { clearStudentProfile } = await import('@/lib/analyticsProfiles');\n        clearStudentProfile(studentId);\n      } catch (e) {\n        logger.warn('[analyticsManager] clearStudentProfile failed', e as Error);\n      }\n\n      // Worker/hook broadcast\n      this.notifyWorkerCacheClear(studentId);\n\n      logger.info('[analyticsManager] Cleared student caches', { studentId });\n      return { ok: true, studentId };\n    } catch (e) {\n      logger.error('[analyticsManager] clearStudentCaches failed', e as Error);\n      return { ok: false, studentId };\n    }\n  }\n\n  /**\n   * Saves the current map of analytics profiles to localStorage.\n   * @private\n   */\n  private saveAnalyticsProfiles(): void {\n    // Deprecated in favor of analyticsProfiles.saveProfiles()\n    try { saveProfiles(); } catch (error) { logger.error('Error saving analytics profiles:', error); }\n  }\n\n  /**\n   * Engine factory: selects analysis engine based on priority\n   * runtime useAI > analytics config > environment default/availability.\n   */\n  private createAnalysisEngine(useAI?: boolean): AnalysisEngine {\n    // Explicit runtime override: when useAI is explicitly false, always use heuristic.\n    // This takes precedence over config flags and environment/API availability.\n    if (useAI === false) {\n      try {\n        logger.debug('[analyticsManager] Engine selection override: runtime useAI=false -> HeuristicAnalysisEngine', {\n          requestedAI: useAI,\n        });\n      } catch {\n        /* ignore logging errors */\n      }\n      return new HeuristicAnalysisEngine();\n    }\n    const aiEnv = loadAiConfig();\n    const liveCfg = (() => { try { return analyticsConfig.getConfig(); } catch { return null; } })();\n    const cfgFlag = liveCfg?.features?.aiAnalysisEnabled;\n\n    // Read live Vite env to avoid stale module-level defaults\n    const env: Record<string, unknown> = (import.meta as any)?.env ?? {};\n    const toBool = (v: unknown) => {\n      const s = (v ?? '').toString().toLowerCase();\n      return s === '1' || s === 'true' || s === 'yes';\n    };\n    const liveEnabled = toBool(env.VITE_AI_ANALYSIS_ENABLED);\n    const liveModel = typeof env.VITE_AI_MODEL_NAME === 'string' && (env.VITE_AI_MODEL_NAME as string).trim().length > 0\n      ? (env.VITE_AI_MODEL_NAME as string)\n      : aiEnv.modelName;\n    const liveKey = typeof env.VITE_OPENROUTER_API_KEY === 'string' && (env.VITE_OPENROUTER_API_KEY as string).trim().length > 0\n      ? (env.VITE_OPENROUTER_API_KEY as string)\n      : (aiEnv.apiKey || '');\n\n    const resolved = typeof useAI === 'boolean' ? useAI : (typeof cfgFlag === 'boolean' ? cfgFlag : liveEnabled);\n\n    // Validate model against allowed models (case-insensitive)\n    let resolvedModel = liveModel;\n    try {\n      const allowedLc = new Set((aiEnv.allowedModels || []).map(m => m.toLowerCase()));\n      const modelLc = (resolvedModel || '').toLowerCase();\n      if (!allowedLc.has(modelLc)) {\n        const fallback = aiEnv.allowedModels[0] || 'gpt-5';\n        logger.warn('[analyticsManager] Disallowed model in env; falling back', {\n          requested: resolvedModel,\n          allowed: aiEnv.allowedModels,\n          fallback,\n        });\n        resolvedModel = fallback;\n      }\n    } catch (e) {\n      logger.warn('[analyticsManager] Model validation failed, using as-is:', e);\n      // fail-soft: use original model name when validation fails\n    }\n\n    // Availability check using live env first. Note: explicit useAI=false is handled above and will never reach here.\n    const shouldUseAi = resolved && !!liveKey && !!resolvedModel;\n\n    // Low-noise debug log for engine selection and model resolution\n    try {\n      const nowMinute = new Date().getMinutes();\n      if (__lastFacadeLogMinute !== nowMinute) {\n        logger.debug('[analyticsManager] Engine selection', {\n          requestedAI: useAI,\n          resolvedAI: resolved,\n          model: resolvedModel,\n          configModel: aiEnv.modelName,\n          apiKeyPresent: !!liveKey,\n          allowedModels: aiEnv.allowedModels,\n          runtimeOverride: typeof useAI === 'boolean',\n          overrideDisabled: useAI === false,\n        });\n        __lastFacadeLogMinute = nowMinute;\n      }\n      } catch (e) { try { logger.warn('[analyticsManager] Engine selection debug logging failed', e as Error); } catch {} }\n\n    if (shouldUseAi) return new LLMAnalysisEngine();\n    return new HeuristicAnalysisEngine();\n  }\n}\n\n/**\n * Singleton instance of AnalyticsManagerService.\n * Use this for orchestrating analytics without creating new instances.\n */\nexport const analyticsManager = AnalyticsManagerService.getInstance();\n\n/**\n * Thin orchestrator-style API (gradual migration target)\n *\n * These named exports provide a lightweight interface for building cache keys,\n * constructing worker tasks, and retrieving summarized insights in a stable\n * shape for consumers like hooks or UI. They coexist with the legacy singleton\n * for backward compatibility and will become the primary API.\n */\n\n/**\n * Build a deterministic insights cache key from inputs and options.\n * Delegates to the centralized cache-key utilities.\n */\nexport const buildInsightsCacheKey = _buildInsightsCacheKey;\n\n/**\n * Build a typed worker task envelope for Insights computation.\n * Suitable for posting to the analytics web worker.\n */\nexport const buildInsightsTask = _buildInsightsTask;\n\n/**\n * Compute insights and return a minimal, stable AnalyticsResult summary.\n * This does not perform internal caching; callers should use the cache key\n * and their caching layer of choice.\n *\n * @example\n * const inputs = { entries, emotions, sensoryInputs, goals };\n * const result = await getInsights(inputs, { ttlSeconds: 600, tags: [\"student-123\"] });\n */\nexport async function getInsights(\n  inputs: ComputeInsightsInputs,\n  options?: InsightsOptions\n): Promise<AnalyticsResult> {\n  try {\n    const cacheKey = _buildInsightsCacheKey(inputs, options);\n    const cfg = (() => { try { return analyticsConfig.getConfig(); } catch { return DEFAULT_ANALYTICS_CONFIG; } })() || DEFAULT_ANALYTICS_CONFIG;\n    const ttlMs = cfg?.cache?.ttl ?? DEFAULT_ANALYTICS_CONFIG.cache.ttl;\n    const ttlSeconds = typeof options?.ttlSeconds === 'number' ? options.ttlSeconds : Math.max(1, Math.floor(ttlMs / 1000));\n    const tags = Array.from(new Set([\"insights\", \"v2\", ...(options?.tags ?? [])]));\n\n    const fullCfg = options?.config ? { config: (options.config as any) } : { config: cfg as any };\n    const detailed = await computeInsights(inputs, fullCfg as any);\n\n    // Summarize for stable payloads (avoid large arrays in summary field)\n    const summary = {\n      patternsCount: detailed.patterns?.length ?? 0,\n      correlationsCount: detailed.correlations?.length ?? 0,\n      environmentalCorrelationsCount: detailed.environmentalCorrelations?.length ?? 0,\n      predictiveInsightsCount: detailed.predictiveInsights?.length ?? 0,\n      anomaliesCount: detailed.anomalies?.length ?? 0,\n      insightsCount: detailed.insights?.length ?? 0,\n      confidence: (detailed as any).confidence,\n      hasMinimumData: (detailed as any).hasMinimumData,\n    } as Record<string, unknown>;\n\n    return {\n      cacheKey,\n      computedAt: new Date().toISOString(),\n      ttlSeconds,\n      tags,\n      summary,\n      diagnostics: {\n        entries: inputs.entries?.length ?? 0,\n        emotions: inputs.emotions?.length ?? 0,\n        sensoryInputs: inputs.sensoryInputs?.length ?? 0,\n        goals: inputs.goals?.length ?? 0,\n      },\n    };\n  } catch (error) {\n    logger.error('[analyticsManager.orchestrator] getInsights failed', { error });\n    const cacheKey = _buildInsightsCacheKey(inputs, options);\n    const ttlSeconds = typeof options?.ttlSeconds === 'number' ? options.ttlSeconds : 300;\n    const tags = Array.from(new Set([\"insights\", \"v2\", ...(options?.tags ?? [])]));\n    return {\n      cacheKey,\n      computedAt: new Date().toISOString(),\n      ttlSeconds,\n      tags,\n      summary: { error: 'INSIGHTS_COMPUTE_FAILED' },\n    };\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analyticsManagerLite.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":11,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[329,332],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[329,332],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":53,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1569,1572],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1569,1572],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Lightweight version of analyticsManager for initial page loads\n * Full functionality is loaded on-demand\n */\n\nimport { logger } from '@/lib/logger';\n// dataStorage no longer used directly in the lite manager\nimport { initializeStudentProfile } from '@/lib/analyticsProfiles';\n\n// Lazy-loaded full manager\nlet fullManager: any = null;\n\n/**\n * Lightweight analytics manager that lazy-loads the full implementation\n */\nexport const analyticsManagerLite = {\n  /**\n   * Initialize student analytics (lightweight version)\n   */\n  initializeStudentAnalytics(studentId: string): void {\n    try {\n      // Perform minimal initialization\n      initializeStudentProfile(studentId);\n      logger.debug('[analyticsManagerLite] Student initialized', { studentId });\n    } catch (error) {\n      logger.error('[analyticsManagerLite] Failed to initialize student', { error, studentId });\n    }\n  },\n\n  /**\n   * Get the full analytics manager (lazy-loaded)\n   */\n  async getFullManager() {\n    if (!fullManager) {\n      logger.debug('[analyticsManagerLite] Loading full analytics manager...');\n      const { analyticsManager } = await import('@/lib/analyticsManager');\n      fullManager = analyticsManager;\n    }\n    return fullManager;\n  },\n\n  /**\n   * Trigger full analytics for a student (deferred loading)\n   */\n  async triggerAnalyticsForStudent(studentId: string) {\n    const manager = await this.getFullManager();\n    return manager.triggerAnalyticsForStudent(studentId);\n  },\n\n  /**\n   * Get student analytics (deferred loading)\n   */\n  async getStudentAnalytics(student: any) {\n    const manager = await this.getFullManager();\n    return manager.getStudentAnalytics(student);\n  },\n\n  /**\n   * Clear cache for a student (deferred loading)\n   */\n  async clearStudentCache(studentId: string) {\n    const manager = await this.getFullManager();\n    return manager.clearStudentCache(studentId);\n  }\n};\n\n// Export as default for easier migration\nexport { analyticsManagerLite as analyticsManager };\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analyticsPrecomputation.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'endOfDay' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":39},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":193,"column":7,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":193,"endColumn":50}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { TrackingEntry, EmotionEntry, SensoryEntry } from \"@/types/student\";\nimport { AnalyticsData } from \"@/workers/analytics.worker\";\nimport { subDays, startOfDay, endOfDay } from \"date-fns\";\n\ninterface PrecomputationConfig {\n  enabled: boolean;\n  maxQueueSize: number;\n  batchSize: number;\n  idleTimeout: number;\n  commonTimeframes: number[]; // days to look back\n}\n\ninterface PrecomputationTask {\n  id: string;\n  data: AnalyticsData;\n  priority: number;\n  timestamp: Date;\n}\n\n/**\n * AnalyticsPrecomputationManager handles background pre-computation of common analytics queries\n * to improve performance by having results ready when users need them\n */\nexport class AnalyticsPrecomputationManager {\n  private config: PrecomputationConfig;\n  private taskQueue: PrecomputationTask[] = [];\n  private isProcessing = false;\n  private idleCallbackId: number | null = null;\n  private processedTasks = new Set<string>();\n  private onAnalyze: (data: AnalyticsData) => void;\n\n  constructor(\n    onAnalyze: (data: AnalyticsData) => void,\n    config: Partial<PrecomputationConfig> = {}\n  ) {\n    this.onAnalyze = onAnalyze;\n    this.config = {\n      enabled: true,\n      maxQueueSize: 50,\n      batchSize: 5,\n      idleTimeout: 5000,\n      commonTimeframes: [7, 14, 30], // Last 7, 14, and 30 days\n      ...config\n    };\n  }\n\n  /**\n   * Schedule precomputation based on current student data\n   */\n  schedulePrecomputation(\n    allEntries: TrackingEntry[],\n    allEmotions: EmotionEntry[],\n    allSensoryInputs: SensoryEntry[]\n  ): void {\n    if (!this.config.enabled || this.isProcessing) return;\n\n    // Clear existing queue\n    this.taskQueue = [];\n\n    // Get unique student IDs\n    const studentIds = new Set<string>();\n    allEntries.forEach(e => e.studentId && studentIds.add(e.studentId));\n    allEmotions.forEach(e => e.studentId && studentIds.add(e.studentId));\n    allSensoryInputs.forEach(s => s.studentId && studentIds.add(s.studentId));\n\n    // Generate tasks for each student and timeframe\n    studentIds.forEach(studentId => {\n      this.config.commonTimeframes.forEach(days => {\n        const task = this.createPrecomputationTask(\n          studentId,\n          days,\n          allEntries,\n          allEmotions,\n          allSensoryInputs\n        );\n        \n        if (task && !this.processedTasks.has(task.id)) {\n          this.taskQueue.push(task);\n        }\n      });\n    });\n\n    // Also add combined analytics for all students\n    this.config.commonTimeframes.forEach(days => {\n      const task = this.createCombinedAnalyticsTask(\n        days,\n        allEntries,\n        allEmotions,\n        allSensoryInputs\n      );\n      \n      if (task && !this.processedTasks.has(task.id)) {\n        this.taskQueue.push(task);\n      }\n    });\n\n    // Sort by priority (smaller timeframes first)\n    this.taskQueue.sort((a, b) => a.priority - b.priority);\n\n    // Limit queue size\n    if (this.taskQueue.length > this.config.maxQueueSize) {\n      this.taskQueue = this.taskQueue.slice(0, this.config.maxQueueSize);\n    }\n\n    // Schedule processing during idle time\n    this.scheduleIdleProcessing();\n  }\n\n  /**\n   * Create a precomputation task for a specific student and timeframe\n   */\n  private createPrecomputationTask(\n    studentId: string,\n    days: number,\n    allEntries: TrackingEntry[],\n    allEmotions: EmotionEntry[],\n    allSensoryInputs: SensoryEntry[]\n  ): PrecomputationTask | null {\n    const cutoffDate = subDays(new Date(), days);\n    \n    // Filter data for this student and timeframe\n    const entries = allEntries.filter(e => \n      e.studentId === studentId && e.timestamp >= cutoffDate\n    );\n    const emotions = allEmotions.filter(e => \n      e.studentId === studentId && e.timestamp >= cutoffDate\n    );\n    const sensoryInputs = allSensoryInputs.filter(s => \n      s.studentId === studentId && s.timestamp >= cutoffDate\n    );\n\n    // Skip if no data\n    if (entries.length === 0 && emotions.length === 0 && sensoryInputs.length === 0) {\n      return null;\n    }\n\n    const taskId = `student:${studentId}:days:${days}`;\n    \n    return {\n      id: taskId,\n      data: { entries, emotions, sensoryInputs },\n      priority: days, // Smaller timeframes have higher priority\n      timestamp: new Date()\n    };\n  }\n\n  /**\n   * Create a precomputation task for combined analytics\n   */\n  private createCombinedAnalyticsTask(\n    days: number,\n    allEntries: TrackingEntry[],\n    allEmotions: EmotionEntry[],\n    allSensoryInputs: SensoryEntry[]\n  ): PrecomputationTask | null {\n    const cutoffDate = subDays(new Date(), days);\n    \n    // Filter data for timeframe\n    const entries = allEntries.filter(e => e.timestamp >= cutoffDate);\n    const emotions = allEmotions.filter(e => e.timestamp >= cutoffDate);\n    const sensoryInputs = allSensoryInputs.filter(s => s.timestamp >= cutoffDate);\n\n    // Skip if no data\n    if (entries.length === 0 && emotions.length === 0 && sensoryInputs.length === 0) {\n      return null;\n    }\n\n    const taskId = `combined:days:${days}`;\n    \n    return {\n      id: taskId,\n      data: { entries, emotions, sensoryInputs },\n      priority: days + 100, // Combined analytics have lower priority\n      timestamp: new Date()\n    };\n  }\n\n  /**\n   * Schedule processing during idle time\n   */\n  private scheduleIdleProcessing(): void {\n    if (this.idleCallbackId !== null) {\n      cancelIdleCallback(this.idleCallbackId);\n    }\n\n    if ('requestIdleCallback' in window) {\n      this.idleCallbackId = requestIdleCallback(\n        (deadline) => this.processQueue(deadline),\n        { timeout: this.config.idleTimeout }\n      );\n    } else {\n      // Fallback for browsers without requestIdleCallback\n      setTimeout(() => this.processQueue(), 1000);\n    }\n  }\n\n  /**\n   * Process queued tasks during idle time\n   */\n  private processQueue(deadline?: IdleDeadline): void {\n    if (this.taskQueue.length === 0) {\n      this.isProcessing = false;\n      return;\n    }\n\n    this.isProcessing = true;\n    let processed = 0;\n\n    // Process tasks while we have time\n    while (\n      this.taskQueue.length > 0 && \n      processed < this.config.batchSize &&\n      (!deadline || deadline.timeRemaining() > 10)\n    ) {\n      const task = this.taskQueue.shift();\n      if (task) {\n        this.onAnalyze(task.data);\n        this.processedTasks.add(task.id);\n        processed++;\n      }\n    }\n\n    // Schedule next batch if there are more tasks\n    if (this.taskQueue.length > 0) {\n      this.scheduleIdleProcessing();\n    } else {\n      this.isProcessing = false;\n    }\n  }\n\n  /**\n   * Get common data queries for precomputation\n   */\n  static getCommonDataQueries(\n    entries: TrackingEntry[],\n    emotions: EmotionEntry[],\n    sensoryInputs: SensoryEntry[]\n  ): AnalyticsData[] {\n    const queries: AnalyticsData[] = [];\n    const now = new Date();\n\n    // Common timeframes\n    const timeframes = [\n      { days: 7, label: 'week' },\n      { days: 14, label: 'twoWeeks' },\n      { days: 30, label: 'month' }\n    ];\n\n    timeframes.forEach(({ days }) => {\n      const cutoffDate = subDays(now, days);\n      \n      queries.push({\n        entries: entries.filter(e => e.timestamp >= cutoffDate),\n        emotions: emotions.filter(e => e.timestamp >= cutoffDate),\n        sensoryInputs: sensoryInputs.filter(s => s.timestamp >= cutoffDate)\n      });\n    });\n\n    // Today's data as half-open interval [startOfDay, startOfNextDay)\n    const todayStart = startOfDay(now);\n    const todayEndExclusive = new Date(todayStart.getTime() + 24 * 60 * 60 * 1000);\n    queries.push({\n      entries: entries.filter(e => e.timestamp >= todayStart && e.timestamp < todayEndExclusive),\n      emotions: emotions.filter(e => e.timestamp >= todayStart && e.timestamp < todayEndExclusive),\n      sensoryInputs: sensoryInputs.filter(s => s.timestamp >= todayStart && s.timestamp < todayEndExclusive)\n    });\n\n    // High-activity periods (days with more than average activity)\n    const dailyActivity = new Map<string, number>();\n    entries.forEach(entry => {\n      const dateKey = startOfDay(entry.timestamp).toISOString();\n      dailyActivity.set(dateKey, (dailyActivity.get(dateKey) || 0) + 1);\n    });\n\n    const avgActivity = Array.from(dailyActivity.values()).reduce((a, b) => a + b, 0) / dailyActivity.size;\n    const highActivityDays = Array.from(dailyActivity.entries())\n      .filter(([_, count]) => count > avgActivity * 1.5)\n      .map(([date]) => new Date(date));\n\n    highActivityDays.slice(0, 3).forEach(date => {\n      const dayStart = startOfDay(date);\n      const dayEndExclusive = new Date(dayStart.getTime() + 24 * 60 * 60 * 1000);\n      queries.push({\n        entries: entries.filter(e => e.timestamp >= dayStart && e.timestamp < dayEndExclusive),\n        emotions: emotions.filter(e => e.timestamp >= dayStart && e.timestamp < dayEndExclusive),\n        sensoryInputs: sensoryInputs.filter(s => s.timestamp >= dayStart && s.timestamp < dayEndExclusive)\n      });\n    });\n\n    return queries;\n  }\n\n  /**\n   * Clear processed tasks cache\n   */\n  clearProcessedTasks(): void {\n    this.processedTasks.clear();\n  }\n\n  /**\n   * Stop all precomputation\n   */\n  stop(): void {\n    this.config.enabled = false;\n    this.taskQueue = [];\n    if (this.idleCallbackId !== null) {\n      cancelIdleCallback(this.idleCallbackId);\n      this.idleCallbackId = null;\n    }\n    this.isProcessing = false;\n  }\n\n  /**\n   * Resume precomputation\n   */\n  resume(): void {\n    this.config.enabled = true;\n  }\n\n  /**\n   * Get current status\n   */\n  getStatus(): {\n    enabled: boolean;\n    queueSize: number;\n    isProcessing: boolean;\n    processedCount: number;\n  } {\n    return {\n      enabled: this.config.enabled,\n      queueSize: this.taskQueue.length,\n      isProcessing: this.isProcessing,\n      processedCount: this.processedTasks.size\n    };\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analyticsProfiles.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[983,986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[983,986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1091,1094],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1091,1094],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1176,1179],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1176,1179],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { STORAGE_KEYS } from '@/lib/analyticsConfig';\nimport { logger } from '@/lib/logger';\n\nexport interface StudentAnalyticsProfile {\n  studentId: string;\n  isInitialized: boolean;\n  lastAnalyzedAt: Date | null;\n  analyticsConfig: {\n    patternAnalysisEnabled: boolean;\n    correlationAnalysisEnabled: boolean;\n    predictiveInsightsEnabled: boolean;\n    anomalyDetectionEnabled: boolean;\n    alertSystemEnabled: boolean;\n  };\n  minimumDataRequirements: {\n    emotionEntries: number;\n    sensoryEntries: number;\n    trackingEntries: number;\n  };\n  analyticsHealthScore: number;\n}\n\nlet profiles: Map<string, StudentAnalyticsProfile> | null = null;\n\nfunction loadProfilesFromStorage(): Map<string, StudentAnalyticsProfile> {\n  const map = new Map<string, StudentAnalyticsProfile>();\n  try {\n    const raw = typeof localStorage !== 'undefined' ? localStorage.getItem(STORAGE_KEYS.analyticsProfiles) : null;\n    if (!raw) return map;\n    const obj = JSON.parse(raw) as Record<string, any>;\n    for (const [studentId, profile] of Object.entries(obj)) {\n      if (profile && typeof (profile as any).studentId === 'string') {\n        map.set(studentId, {\n          ...(profile as any),\n          lastAnalyzedAt: profile.lastAnalyzedAt ? new Date(profile.lastAnalyzedAt) : null,\n        });\n      }\n    }\n  } catch (error) {\n    logger.error('[analyticsProfiles] Failed to load profiles', { error });\n  }\n  return map;\n}\n\nfunction ensureProfilesLoaded() {\n  if (!profiles) profiles = loadProfilesFromStorage();\n}\n\nexport function getProfileMap(): Map<string, StudentAnalyticsProfile> {\n  ensureProfilesLoaded();\n  return profiles as Map<string, StudentAnalyticsProfile>;\n}\n\nexport function saveProfiles(): void {\n  ensureProfilesLoaded();\n  try {\n    const data = Object.fromEntries((profiles as Map<string, StudentAnalyticsProfile>).entries());\n    if (typeof localStorage !== 'undefined') {\n      localStorage.setItem(STORAGE_KEYS.analyticsProfiles, JSON.stringify(data));\n    }\n  } catch (error) {\n    logger.error('[analyticsProfiles] Failed to save profiles', { error });\n  }\n}\n\nexport function initializeStudentProfile(studentId: string): void {\n  ensureProfilesLoaded();\n  if (!studentId || typeof studentId !== 'string') return;\n  if ((profiles as Map<string, StudentAnalyticsProfile>).has(studentId)) return;\n  const profile: StudentAnalyticsProfile = {\n    studentId,\n    isInitialized: true,\n    lastAnalyzedAt: null,\n    analyticsConfig: {\n      patternAnalysisEnabled: true,\n      correlationAnalysisEnabled: true,\n      predictiveInsightsEnabled: true,\n      anomalyDetectionEnabled: true,\n      alertSystemEnabled: true,\n    },\n    minimumDataRequirements: {\n      emotionEntries: 1,\n      sensoryEntries: 1,\n      trackingEntries: 1,\n    },\n    analyticsHealthScore: 0,\n  };\n  (profiles as Map<string, StudentAnalyticsProfile>).set(studentId, profile);\n  saveProfiles();\n}\n\n/**\n * Clear all analytics profiles from memory and localStorage.\n * Returns the number of profiles cleared.\n */\nexport function clearAllProfiles(): number {\n  ensureProfilesLoaded();\n  const count = (profiles as Map<string, StudentAnalyticsProfile>).size;\n  try {\n    (profiles as Map<string, StudentAnalyticsProfile>).clear();\n    if (typeof localStorage !== 'undefined') {\n      localStorage.removeItem(STORAGE_KEYS.analyticsProfiles);\n    }\n    logger.info('[analyticsProfiles] Cleared all profiles', { count });\n  } catch (error) {\n    logger.error('[analyticsProfiles] Failed to clear all profiles', { error });\n  }\n  return count;\n}\n\n/**\n * Clear a specific student profile from cache and persist the change.\n */\nexport function clearStudentProfile(studentId: string): boolean {\n  ensureProfilesLoaded();\n  if (!studentId) return false;\n  const existed = (profiles as Map<string, StudentAnalyticsProfile>).delete(studentId);\n  if (existed) {\n    saveProfiles();\n    logger.info('[analyticsProfiles] Cleared student profile', { studentId });\n  }\n  return existed;\n}\n\n/**\n * Reset profiles to a default empty state and persist.\n */\nexport function resetProfiles(): void {\n  ensureProfilesLoaded();\n  (profiles as Map<string, StudentAnalyticsProfile>).clear();\n  saveProfiles();\n  logger.info('[analyticsProfiles] Reset profiles to default state');\n}\n\n/**\n * Return simple stats about the profile cache.\n */\nexport function getProfileCacheStats(): { count: number } {\n  ensureProfilesLoaded();\n  return { count: (profiles as Map<string, StudentAnalyticsProfile>).size };\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analyticsSummary.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[677,680],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[677,680],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[765,768],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[765,768],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { analyticsConfig } from '@/lib/analyticsConfig';\nimport { calculateConfidence, generateInsights } from '@/lib/insights';\nimport type { EmotionEntry, SensoryEntry, TrackingEntry } from '@/types/student';\nimport type { InsightOutput } from '@/types/insights';\n\nexport interface AnalyticsSummary {\n  insights: InsightOutput; // string[] for now (non-breaking)\n  confidence: number;\n  hasMinimumData: boolean;\n  computedAt: string; // ISO timestamp\n  tags?: string[];\n}\n\nexport async function generateAnalyticsSummary(inputs: {\n  entries: readonly TrackingEntry[];\n  emotions: readonly EmotionEntry[];\n  sensoryInputs?: readonly SensoryEntry[];\n  results?: {\n    patterns: any[]; // Keeping loose here to avoid importing heavy types in facade\n    correlations: any[];\n    predictiveInsights?: Array<{ description: string; confidence: number }>;\n  };\n  tags?: string[];\n}): Promise<AnalyticsSummary> {\n  const cfg = analyticsConfig.getConfig();\n  const { entries, emotions } = inputs;\n  const patterns = inputs.results?.patterns ?? [];\n  const correlations = inputs.results?.correlations ?? [];\n  const predictiveInsights = inputs.results?.predictiveInsights ?? [];\n\n  // Confidence uses confidence slice; insights use insights slice\n  const confidence = calculateConfidence(emotions, inputs.sensoryInputs ?? [], entries, cfg.confidence);\n\n  // Prefer canonical insights signature when we have results\n  const insights = generateInsights(\n    { patterns, correlations, predictiveInsights },\n    emotions,\n    entries,\n    cfg.insights\n  );\n\n  const hasMinimumData = entries.length >= cfg.insights.MIN_SESSIONS_FOR_FULL_ANALYTICS;\n\n  return {\n    insights,\n    confidence,\n    hasMinimumData,\n    computedAt: new Date().toISOString(),\n    tags: inputs.tags,\n  };\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analyticsTasks.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/analyticsWorkerFallback.ts","messages":[{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":37,"column":36,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":37,"endColumn":58},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":80,"column":36,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":80,"endColumn":58},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":91,"column":36,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":91,"endColumn":58},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":103,"column":36,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":103,"endColumn":58},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":119,"column":38,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":119,"endColumn":60},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":151,"column":7,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":151,"endColumn":49}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Fallback implementation for analytics when web workers are not available\n * This runs in the main thread but with throttling to prevent UI blocking\n */\n\nimport { AnalyticsData, AnalyticsResults } from '@/workers/analytics.worker';\nimport { patternAnalysis } from '@/lib/patternAnalysis';\nimport { enhancedPatternAnalysis } from '@/lib/enhancedPatternAnalysis';\nimport { logger } from '@/lib/logger';\nimport type { Student } from '@/types/student';\nimport { analyticsManager } from '@/lib/analyticsManager';\n\nexport class AnalyticsWorkerFallback {\n  private isProcessing = false;\n  private queue: Array<{\n    data: AnalyticsData;\n    options?: { useAI?: boolean; student?: Student };\n    resolve: (value: AnalyticsResults) => void;\n    reject: (error: Error) => void;\n  }> = [];\n\n  async processAnalytics(data: AnalyticsData, options?: { useAI?: boolean; student?: Student }): Promise<AnalyticsResults> {\n    return new Promise((resolve, reject) => {\n      this.queue.push({ data, options, resolve, reject });\n      this.processQueue();\n    });\n  }\n\n  private async processQueue() {\n    if (this.isProcessing || this.queue.length === 0) return;\n\n    this.isProcessing = true;\n    const { data, options, resolve, reject } = this.queue.shift()!;\n\n    try {\n      // Process in chunks to avoid blocking UI\n      await new Promise(resolve => setTimeout(resolve, 0));\n\n      // If explicit AI preference provided, route through analyticsManager to respect runtime override\n      if (options && typeof options.useAI === 'boolean') {\n        try {\n          const student: Student | undefined = options.student ?? this.deriveStudentFromData(data);\n          if (!student) {\n            throw new Error('Missing student context for manager-based analytics');\n          }\n          try {\n            logger.debug('[analyticsWorkerFallback] Routing to analyticsManager with runtime useAI', { useAI: options.useAI, studentId: student.id });\n          } catch {\n            /* ignore logging errors */\n          }\n          const managerResults = await analyticsManager.getStudentAnalytics(student, { useAI: options.useAI });\n          resolve(managerResults as AnalyticsResults);\n          return;\n        } catch (e) {\n          logger.error('Fallback: Manager-based analytics failed; continuing with local processing', e);\n          // fall through to local processing as a safe fallback\n        }\n      }\n      \n      const results: AnalyticsResults = {\n        patterns: [],\n        correlations: [],\n        environmentalCorrelations: [], // Initialize with empty array\n        predictiveInsights: [],\n        anomalies: [],\n        insights: [],\n        suggestedInterventions: [] // Default to empty array\n      };\n\n      // Basic pattern analysis (simplified version)\n      if (data.emotions.length > 0) {\n        try {\n          const emotionPatterns = patternAnalysis.analyzeEmotionPatterns(data.emotions, 30);\n          results.patterns.push(...emotionPatterns);\n        } catch (e) {\n          logger.error('Fallback: Error analyzing emotion patterns', e);\n        }\n      }\n\n      await new Promise(resolve => setTimeout(resolve, 0)); // Yield to UI\n\n      if (data.sensoryInputs.length > 0) {\n        try {\n          const sensoryPatterns = patternAnalysis.analyzeSensoryPatterns(data.sensoryInputs, 30);\n          results.patterns.push(...sensoryPatterns);\n        } catch (e) {\n          logger.error('Fallback: Error analyzing sensory patterns', e);\n        }\n      }\n\n      await new Promise(resolve => setTimeout(resolve, 0)); // Yield to UI\n\n      if (data.entries.length > 2) {\n        try {\n          const correlations = patternAnalysis.analyzeEnvironmentalCorrelations(data.entries);\n          results.correlations = correlations;\n          results.environmentalCorrelations = correlations; // Also populate environmentalCorrelations\n        } catch (e) {\n          logger.error('Fallback: Error analyzing correlations', e);\n        }\n      }\n\n      await new Promise(resolve => setTimeout(resolve, 0)); // Yield to UI\n\n      // Enhanced analysis - predictive insights and anomaly detection\n      if (data.entries.length > 1) {\n        try {\n          const predictiveInsights = await enhancedPatternAnalysis.generatePredictiveInsights(\n            data.emotions,\n            data.sensoryInputs,\n            data.entries,\n            []\n          );\n          results.predictiveInsights = predictiveInsights;\n        } catch (e) {\n          logger.error('Fallback: Error generating predictive insights', e);\n        }\n\n        await new Promise(resolve => setTimeout(resolve, 0)); // Yield to UI\n\n        try {\n          const anomalies = enhancedPatternAnalysis.detectAnomalies(\n            data.emotions,\n            data.sensoryInputs,\n            data.entries\n          );\n          results.anomalies = anomalies;\n        } catch (e) {\n          logger.error('Fallback: Error detecting anomalies', e);\n        }\n      }\n\n      // Generate basic insights\n      if (data.entries.length < 5) {\n        results.insights.push(\n          `Limited data available (${data.entries.length} sessions). Continue collecting data for better insights.`\n        );\n      } else {\n        results.insights.push(\n          'Analytics processed successfully. Continue collecting data for more detailed patterns.'\n        );\n      }\n\n      resolve(results);\n    } catch (error) {\n      logger.error('Fallback analytics failed', error);\n      reject(error instanceof Error ? error : new Error('Analytics processing failed'));\n    } finally {\n      this.isProcessing = false;\n      // Process next item in queue\n      setTimeout(() => this.processQueue(), 100);\n    }\n  }\n\n  private deriveStudentFromData(data: AnalyticsData): Student | undefined {\n    try {\n      const id =\n        data.entries?.[0]?.studentId ||\n        data.emotions?.[0]?.studentId ||\n        data.sensoryInputs?.[0]?.studentId ||\n        undefined;\n      if (!id) return undefined;\n      // Minimal student object; name and createdAt are placeholders when not available\n      return {\n        id,\n        name: 'Student',\n        createdAt: new Date(),\n      } as Student;\n    } catch {\n      return undefined;\n    }\n  }\n}\n\nexport const analyticsWorkerFallback = new AnalyticsWorkerFallback();\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/apiConnectivityValidator.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'openRouterClient' is defined but never used. Allowed unused vars must match /^_/u.","line":10,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'z' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":11},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3827,3830],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3827,3830],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * @file src/lib/apiConnectivityValidator.ts\n * Lightweight API connectivity validator for AI model availability.\n *\n * Performs a minimal request using OpenRouterClient with short timeouts to\n * verify connectivity and credentials. Results are cached for one hour in\n * localStorage keyed by model+key hash.\n */\nimport { logger } from '@/lib/logger';\nimport { openRouterClient, OpenRouterClient } from '@/lib/ai/openrouterClient';\nimport { storageUtils } from '@/lib/storageUtils';\nimport { z } from 'zod';\nimport { ValidationResult } from '@/lib/validationTypes';\n\nconst CACHE_KEY = 'kreativium_ai_conn_cache_v1';\nconst ONE_HOUR_MS = 60 * 60 * 1000;\n\nfunction hashString(s: string): string {\n  let h = 0;\n  for (let i = 0; i < s.length; i++) {\n    h = (h << 5) - h + s.charCodeAt(i);\n    h |= 0;\n  }\n  return Math.abs(h).toString(36);\n}\n\nfunction readCache(): Record<string, { ok: boolean; ts: number; warnings?: string[]; errors?: string[] }> {\n  try {\n    const raw = localStorage.getItem(CACHE_KEY);\n    if (!raw) return {};\n    const parsed = JSON.parse(raw);\n    if (typeof parsed !== 'object' || !parsed) return {};\n    \n    // Prune stale entries (older than 1 hour)\n    const now = Date.now();\n    const pruned: Record<string, { ok: boolean; ts: number; warnings?: string[]; errors?: string[] }> = {};\n    let prunedCount = 0;\n    \n    for (const [key, entry] of Object.entries(parsed)) {\n      if (typeof entry === 'object' && entry && typeof entry.ts === 'number') {\n        if ((now - entry.ts) < ONE_HOUR_MS) {\n          pruned[key] = entry;\n        } else {\n          prunedCount++;\n        }\n      }\n    }\n    \n    // Cap to most recent 50 entries\n    const entries = Object.entries(pruned);\n    if (entries.length > 50) {\n      entries.sort(([, a], [, b]) => b.ts - a.ts);\n      const capped = Object.fromEntries(entries.slice(0, 50));\n      if (entries.length > 50) {\n        logger.debug('[apiConnectivityValidator] Cache capped', { kept: 50, removed: entries.length - 50 });\n      }\n      return capped;\n    }\n    \n    if (prunedCount > 0) {\n      logger.debug('[apiConnectivityValidator] Cache pruned', { removed: prunedCount, kept: entries.length });\n    }\n    \n    return pruned;\n  } catch {\n    return {};\n  }\n}\n\nfunction writeCache(map: Record<string, { ok: boolean; ts: number; warnings?: string[]; errors?: string[] }>) {\n  try {\n    storageUtils.safeSetItem(CACHE_KEY, JSON.stringify(map));\n  } catch {\n    // ignore cache write failures\n  }\n}\n\nexport async function testModelAvailability(modelName: string, apiKey: string): Promise<ValidationResult> {\n  const keyHash = hashString(apiKey || '');\n  const cacheId = `${modelName}::${keyHash}`;\n  const cache = readCache();\n  const now = Date.now();\n  const entry = cache[cacheId];\n  if (entry && (now - entry.ts) < ONE_HOUR_MS) {\n    if (entry.ok) {\n      logger.debug('[apiConnectivityValidator] Cache hit: OK');\n      return { isValid: true, errors: [], warnings: entry.warnings ?? [] };\n    } else {\n      logger.debug('[apiConnectivityValidator] Cache hit: ERR');\n      return { isValid: false, errors: entry.errors ?? ['Cached connectivity error'], warnings: entry.warnings ?? [] };\n    }\n  }\n\n  // Minimal ping; do not use global facade to keep overrides predictable\n  const client = new OpenRouterClient({ modelName, apiKey, timeoutMs: 7000, maxTokens: 8, temperature: 0 });\n\n  try {\n    // A harmless prompt that should produce a tiny response\n    // Use suppressToasts to avoid user-facing toasts during background connectivity checks\n    await client.chat('Return the single word OK.', undefined, { suppressToasts: true });\n    logger.info('[apiConnectivityValidator] Connectivity OK for model');\n    cache[cacheId] = { ok: true, ts: now };\n    writeCache(cache);\n    return { isValid: true, errors: [], warnings: [] };\n  } catch (err: any) {\n    const warnings: string[] = [];\n    const errors: string[] = [];\n\n    const msg = (err?.message || '').toString();\n    const name = (err?.name || '').toString();\n\n    // Classify common scenarios\n    if (/quota|rate limit|429/i.test(msg) || /AI_RATE_LIMITED/.test(err?.code || '')) {\n      warnings.push('Rate limited by AI provider (temporary)');\n    } else if (/timeout|AbortError|ETIMEDOUT/i.test(msg)) {\n      warnings.push('Connectivity timed out');\n    } else if (/401|403|unauthorized|forbidden/i.test(msg) || /API key/i.test(msg)) {\n      errors.push('Authentication failed (invalid or missing API key)');\n    } else if (/404|model not found|unknown model/i.test(msg)) {\n      errors.push('Model not found or not available');\n    } else {\n      warnings.push('Connectivity test failed with an unknown error');\n    }\n\n    if (errors.length === 0 && warnings.length > 0) {\n      // Sanitize logs: include classification + short snippet, avoid full provider messages\n      const snippet = msg.length > 120 ? msg.slice(0, 120) + '...' : msg;\n      logger.warn('[apiConnectivityValidator] Connectivity warnings', { warnings, name, snippet });\n      logger.debug('[apiConnectivityValidator] Full message (debug only)', { msg });\n      cache[cacheId] = { ok: true, ts: now, warnings };\n      writeCache(cache);\n      return { isValid: true, errors: [], warnings };\n    } else {\n      // Sanitize logs: include classification + short snippet, avoid full provider messages\n      const snippet = msg.length > 120 ? msg.slice(0, 120) + '...' : msg;\n      logger.error('[apiConnectivityValidator] Connectivity failed', { errors, name, snippet });\n      logger.debug('[apiConnectivityValidator] Full message (debug only)', { msg });\n      cache[cacheId] = { ok: false, ts: now, errors, warnings };\n      writeCache(cache);\n      return { isValid: false, errors, warnings };\n    }\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/buttonVariants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/cacheManager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/cachedPatternAnalysis.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/canonicalSerialize.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4895,4898],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4895,4898],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/*\n  canonicalSerialize(value: unknown): string\n  - Order-insensitive and type-stable canonical serialization with explicit type prefixes\n  - Primitives: \n    string   => s:\"...escaped...\"\n    number   => n:<normalized> (NaN, Infinity, -Infinity; -0 serialized as 0)\n    boolean  => b:true|false\n    null     => l:null\n    undefined=> u:undefined\n    bigint   => g:<decimal>\n  - Date     => d:<toISOString()>\n  - RegExp   => r:<regex.toString()>\n  - Array    => a:[<items...>] where items are canonicalized then sorted lexicographically\n  - Set      => a:[<items...>] (same as Array, order-insensitive)\n  - Map      => o:{<k>:<v>,...} where k and v are canonicalized; entries sorted by canonical key\n  - Object   => o:{<k>:<v>,...} own enumerable keys sorted lexicographically (k is JSON-escaped string)\n  - Typed arrays, ArrayBuffer, DataView => convert to array of numbers and treat as Array (order-insensitive)\n  - Fallback => x:<[object Type]> optionally followed by props as o:{...} if enumerable props exist\n  - Circular structures => throw descriptive error\n*/\n\nexport function canonicalSerialize(value: unknown): string {\n  const seen = new WeakSet<object>();\n\n  function escapeJSONString(s: string): string {\n    // JSON.stringify returns a quoted string with proper escaping\n    return JSON.stringify(s) as string;\n  }\n\n  function numberToNormalized(n: number): string {\n    if (Number.isNaN(n)) return 'n:NaN';\n    if (n === Infinity) return 'n:Infinity';\n    if (n === -Infinity) return 'n:-Infinity';\n    // Treat -0 as 0\n    const val = Object.is(n, -0) ? 0 : n;\n    // Use toString for canonical JS numeric rendering\n    return `n:${val.toString()}`;\n  }\n\n  function bigintToNormalized(b: bigint): string {\n    return `g:${b.toString()}`;\n  }\n\n  function dateToNormalized(d: Date): string {\n    return `d:${d.toISOString()}`;\n  }\n\n  function regexpToNormalized(r: RegExp): string {\n    return `r:${r.toString()}`;\n  }\n\n  function arraybufferLikeToNumbers(input: ArrayBuffer | ArrayBufferView | DataView): number[] {\n    if (input instanceof DataView) {\n      const bytes = new Uint8Array(input.buffer, input.byteOffset, input.byteLength);\n      return Array.from(bytes);\n    }\n    if (ArrayBuffer.isView(input as ArrayBufferView)) {\n      const v = input as ArrayBufferView;\n      const bytes = new Uint8Array(v.buffer, v.byteOffset, v.byteLength);\n      return Array.from(bytes);\n    }\n    // ArrayBuffer\n    const ab = input as ArrayBuffer;\n    const bytes = new Uint8Array(ab);\n    return Array.from(bytes);\n  }\n\n  function isPlainObject(obj: unknown): obj is Record<string, unknown> {\n    if (obj === null || typeof obj !== 'object') return false;\n    const proto = Object.getPrototypeOf(obj);\n    return proto === Object.prototype || proto === null;\n  }\n\n  function serialize(v: unknown): string {\n    // Primitives and special cases\n    if (v === null) return 'l:null';\n    const t = typeof v;\n    switch (t) {\n      case 'string':\n        return `s:${escapeJSONString(v as string)}`;\n      case 'number':\n        return numberToNormalized(v as number);\n      case 'boolean':\n        return `b:${(v as boolean) ? 'true' : 'false'}`;\n      case 'undefined':\n        return 'u:undefined';\n      case 'bigint':\n        return bigintToNormalized(v as bigint);\n      case 'symbol': {\n        // Fallback path for symbols\n        const desc = (v as symbol).description;\n        const tag = desc !== undefined ? `Symbol(${desc})` : 'Symbol()';\n        return `x:[object Symbol]${serializeSymbolProps(v as symbol, tag)}`;\n      }\n      case 'function': {\n        // Functions typically have no enumerable own props; include name for stability\n        const fn = v as (...args: unknown[]) => unknown;\n        const name = fn.name || 'anonymous';\n        return `x:[object Function]${serializeMaybeProps(fn)}`.replace('[object Function]', `[object Function ${name}]`);\n      }\n      case 'object':\n        break; // handled below\n      default:\n        // Should not reach here, but provide safe fallback\n        return `x:${Object.prototype.toString.call(v)}`;\n    }\n\n    // Objects (non-null)\n    const obj = v as object;\n    if (seen.has(obj)) {\n      throw new TypeError('canonicalSerialize: Cannot serialize circular structure');\n    }\n\n    // Well-known built-ins\n    if (obj instanceof Date) return dateToNormalized(obj);\n    if (obj instanceof RegExp) return regexpToNormalized(obj);\n\n    // Array and Array-like handling\n    if (Array.isArray(obj)) {\n      seen.add(obj);\n      const items = obj.map((it) => serialize(it));\n      items.sort();\n      seen.delete(obj);\n      return `a:[${items.join(',')}]`;\n    }\n\n    // Typed arrays, ArrayBuffer, DataView -> numbers array\n    if (\n      typeof ArrayBuffer !== 'undefined' &&\n      (obj instanceof ArrayBuffer || ArrayBuffer.isView(obj) || obj instanceof DataView)\n    ) {\n      const nums = arraybufferLikeToNumbers(obj as any);\n      // Serialize as numbers, then sort for order-insensitivity\n      const serialized = nums.map((n) => numberToNormalized(n));\n      serialized.sort();\n      return `a:[${serialized.join(',')}]`;\n    }\n\n    // Set -> order-insensitive array of serialized items\n    if (obj instanceof Set) {\n      seen.add(obj);\n      const items = Array.from(obj.values()).map((it) => serialize(it));\n      items.sort();\n      seen.delete(obj);\n      return `a:[${items.join(',')}]`;\n    }\n\n    // Map -> entries sorted by canonical key\n    if (obj instanceof Map) {\n      seen.add(obj);\n      const entries = Array.from(obj.entries()).map(([k, val]) => [serialize(k), serialize(val)] as const);\n      entries.sort((a, b) => (a[0] < b[0] ? -1 : a[0] > b[0] ? 1 : 0));\n      const body = entries.map(([k, val]) => `${k}:${val}`).join(',');\n      seen.delete(obj);\n      return `o:{${body}}`;\n    }\n\n    // Plain object\n    if (isPlainObject(obj)) {\n      seen.add(obj);\n      const rec = obj as Record<string, unknown>;\n      const keys = Object.keys(rec).sort();\n      const parts: string[] = [];\n      for (const k of keys) {\n        const v2 = rec[k];\n        parts.push(`${escapeJSONString(k)}:${serialize(v2)}`);\n      }\n      seen.delete(obj);\n      return `o:{${parts.join(',')}}`;\n    }\n\n    // Fallback for unknown instances: include tag + enumerable props if any\n    const tag = Object.prototype.toString.call(obj); // e.g., [object Error]\n    const props = serializeMaybeProps(obj);\n    return `x:${tag}${props}`;\n  }\n\n  function serializeMaybeProps(obj: object): string {\n    const rec = obj as Record<string, unknown>;\n    const keys = Object.keys(rec);\n    if (keys.length === 0) return '';\n    keys.sort();\n    const parts: string[] = [];\n    for (const k of keys) {\n      parts.push(`${escapeJSONString(k)}:${serialize(rec[k])}`);\n    }\n    return `,o:{${parts.join(',')}}`;\n  }\n\n  function serializeSymbolProps(_sym: symbol, _tag: string): string {\n    // Symbols have no enumerable string keys; no additional props\n    return '';\n  }\n\n  return serialize(value);\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/chartBuilders.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":344,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":344,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10847,10850],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10847,10850],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":380,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":380,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12069,12072],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12069,12072],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { EChartsOption, SeriesOption } from 'echarts';\nimport type { CorrelationMatrix } from '@/lib/enhancedPatternAnalysis';\n\n/**\n * ChartKit – option builders\n *\n * These helpers produce ECharts options using a stable schema and\n * explicitly disable hover-dimming on series. We set emphasis.disabled,\n * focus: 'none', and a fully opaque blur state to improve readability\n * and avoid the visual effect of lines \"disappearing\" when hovering.\n */\n\n/**\n * Strongly-typed input row for trend charts. Keep this flat and numeric so the\n * chart layer is deterministic and tooltips never receive object-shaped values.\n */\nexport interface TrendRow {\n  date: string; // yyyy-MM-dd (displayed on x-axis)\n  avgEmotionIntensity: number;\n  positiveEmotions: number;\n  negativeEmotions: number;\n  totalSensoryInputs: number;\n}\n\n/** Configuration for the emotion trends chart. */\nexport interface EmotionTrendsConfig {\n  title?: string;\n  showMovingAverage: boolean;\n  movingAverageWindow: number; // e.g., 7 for 7d MA\n  useDualYAxis: boolean; // sensory on right axis\n  thresholds?: { emotion?: number; sensory?: number };\n}\n\n/**\n * Compute a simple moving average array for a numeric series.\n */\nfunction computeMovingAverage(values: number[], window: number): number[] {\n  if (!Number.isFinite(window) || window <= 1) return values.slice();\n  const ma: number[] = new Array(values.length).fill(0);\n  let sum = 0;\n  for (let i = 0; i < values.length; i++) {\n    sum += values[i] ?? 0;\n    const outIndex = i - window;\n    if (outIndex >= 0) sum -= values[outIndex] ?? 0;\n    const denom = Math.min(i + 1, window);\n    ma[i] = Number((sum / denom).toFixed(2));\n  }\n  return ma;\n}\n\n/** Ensure numbers are finite; coerce invalid values to 0 for stable visuals. */\nfunction toFiniteNumber(value: unknown): number {\n  const n = typeof value === 'number' ? value : Number(value);\n  return Number.isFinite(n) ? n : 0;\n}\n\n/**\n * Build an ECharts option for the main Emotion & Sensory trends chart.\n * Pure function – safe to unit test.\n */\nexport function buildEmotionTrendsOption(rows: TrendRow[], config: EmotionTrendsConfig): EChartsOption {\n  const dates = rows.map(r => r.date);\n  const avg = rows.map(r => toFiniteNumber(r.avgEmotionIntensity));\n  const pos = rows.map(r => toFiniteNumber(r.positiveEmotions));\n  const neg = rows.map(r => toFiniteNumber(r.negativeEmotions));\n  const sensory = rows.map(r => toFiniteNumber(r.totalSensoryInputs));\n\n  const avgMA = config.showMovingAverage\n    ? computeMovingAverage(avg, Math.max(2, config.movingAverageWindow))\n    : [];\n\n  const series: SeriesOption[] = [\n    {\n      type: 'line',\n      name: 'Avg Emotion Intensity',\n      data: avg,\n      smooth: true,\n      showSymbol: false,\n      sampling: 'lttb',\n      lineStyle: { width: 3 },\n      emphasis: { focus: 'none', disabled: true },\n      blur: { itemStyle: { opacity: 1 }, lineStyle: { opacity: 1 } },\n      markLine: config.thresholds?.emotion\n        ? {\n            silent: true,\n            data: [\n              {\n                yAxis: config.thresholds.emotion,\n                label: { position: 'end', formatter: 'Emotion Threshold' },\n                lineStyle: { type: 'dashed', width: 2 },\n              },\n            ],\n          }\n        : undefined,\n    },\n    ...(config.showMovingAverage\n      ? ([\n          {\n            type: 'line',\n            name: `Avg Intensity (${config.movingAverageWindow}d MA)`,\n            data: avgMA,\n            smooth: true,\n            showSymbol: false,\n            sampling: 'lttb',\n            lineStyle: { width: 2 },\n            emphasis: { focus: 'none', disabled: true },\n            blur: { itemStyle: { opacity: 1 }, lineStyle: { opacity: 1 } },\n          },\n        ] as SeriesOption[])\n      : []),\n    {\n      type: 'line',\n      name: 'Positive Emotions',\n      data: pos,\n      smooth: true,\n      showSymbol: false,\n      sampling: 'lttb',\n      lineStyle: { width: 2 },\n      emphasis: { focus: 'none', disabled: true },\n      blur: { itemStyle: { opacity: 1 }, lineStyle: { opacity: 1 } },\n    },\n    {\n      type: 'line',\n      name: 'Negative Emotions',\n      data: neg,\n      smooth: true,\n      showSymbol: false,\n      sampling: 'lttb',\n      lineStyle: { width: 2 },\n      emphasis: { focus: 'none', disabled: true },\n      blur: { itemStyle: { opacity: 1 }, lineStyle: { opacity: 1 } },\n    },\n    {\n      type: 'line',\n      name: 'Sensory Inputs',\n      data: sensory,\n      smooth: true,\n      showSymbol: false,\n      sampling: 'lttb',\n      lineStyle: { width: 2, type: 'dashed' },\n      emphasis: { focus: 'none', disabled: true },\n      blur: { itemStyle: { opacity: 1 }, lineStyle: { opacity: 1 } },\n      yAxisIndex: config.useDualYAxis ? 1 : 0,\n      markLine: config.thresholds?.sensory\n        ? {\n            silent: true,\n            data: [\n              {\n                yAxis: config.thresholds.sensory,\n                label: { position: 'end', formatter: 'Sensory Threshold' },\n                lineStyle: { type: 'dashed', width: 2 },\n              },\n            ],\n          }\n        : undefined,\n    },\n  ];\n\n  const option: EChartsOption = {\n    title: config.title\n      ? { left: 'center', top: 0, text: config.title }\n      : undefined,\n    legend: {\n      hoverLink: false,\n      bottom: 0,\n      data: [\n        'Avg Emotion Intensity',\n        ...(config.showMovingAverage ? [`Avg Intensity (${config.movingAverageWindow}d MA)`] : []),\n        'Positive Emotions',\n        'Negative Emotions',\n        'Sensory Inputs',\n      ],\n      selected: {\n        'Avg Emotion Intensity': true,\n        ...(config.showMovingAverage ? { [`Avg Intensity (${config.movingAverageWindow}d MA)`]: true } : {}),\n        'Positive Emotions': true,\n        'Negative Emotions': true,\n        'Sensory Inputs': false,\n      },\n    },\n    tooltip: { trigger: 'axis', confine: true },\n    toolbox: {\n      show: true,\n      right: 16,\n      top: 16,\n      feature: {\n        dataZoom: { yAxisIndex: 'none', title: { zoom: 'Zoom', back: 'Reset' } },\n        restore: { title: 'Reset' },\n        saveAsImage: { title: 'Save', pixelRatio: 2 },\n      },\n    },\n    dataZoom: [\n      { type: 'inside', start: 0, end: 100, minValueSpan: 7 },\n      {\n        show: true,\n        type: 'slider',\n        bottom: 50,\n        start: 0,\n        end: 100,\n        height: 20,\n      },\n    ],\n    xAxis: { type: 'category', boundaryGap: false, data: dates },\n    yAxis: config.useDualYAxis\n      ? [\n          { type: 'value', max: 10, min: 0, interval: 2, name: 'Intensity' },\n          { type: 'value', name: 'Sensory Inputs', alignTicks: true, min: 'dataMin' },\n        ]\n      : [{ type: 'value', max: 10, min: 0, interval: 2, name: 'Intensity' }],\n    series,\n    grid: { bottom: 72 },\n  };\n\n  return option;\n}\n\n/** Simpler area option builder using the same TrendRow type. */\nexport function buildAreaOption(rows: TrendRow[]): EChartsOption {\n  const dates = rows.map(r => r.date);\n  return {\n    tooltip: { trigger: 'axis' },\n    legend: {},\n    xAxis: { type: 'category', data: dates },\n    yAxis: [{ type: 'value' }],\n    series: [\n      {\n        type: 'line',\n        name: 'Avg Emotion Intensity',\n        data: rows.map(r => toFiniteNumber(r.avgEmotionIntensity)),\n        smooth: true,\n        showSymbol: false,\n        areaStyle: {},\n        lineStyle: { width: 3 },\n        emphasis: { focus: 'none' },\n      },\n      {\n        type: 'line',\n        name: 'Positive Emotions',\n        data: rows.map(r => toFiniteNumber(r.positiveEmotions)),\n        smooth: true,\n        showSymbol: false,\n        areaStyle: {},\n        lineStyle: { width: 2 },\n        emphasis: { focus: 'none' },\n      },\n    ],\n  } as EChartsOption;\n}\n\n/** Scatter option with numeric axes for correlation-like view. */\nexport function buildScatterOption(rows: TrendRow[]): EChartsOption {\n  return {\n    tooltip: { trigger: 'item' },\n    legend: {},\n    xAxis: { type: 'value', name: 'Avg Emotion Intensity' },\n    yAxis: { type: 'value', name: 'Sensory Inputs' },\n    series: [\n      {\n        name: 'Daily Data Points',\n        type: 'scatter',\n        data: rows.map(r => [toFiniteNumber(r.avgEmotionIntensity), toFiniteNumber(r.totalSensoryInputs)]),\n        symbolSize: 8,\n        emphasis: { focus: 'none' },\n      },\n    ],\n  } as EChartsOption;\n}\n\n/** Composed bar+line option builder using the same rows. */\nexport function buildComposedOption(rows: TrendRow[]): EChartsOption {\n  const dates = rows.map(r => r.date);\n  return {\n    tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' } },\n    legend: {},\n    xAxis: { type: 'category', data: dates },\n    yAxis: [{ type: 'value' }, { type: 'value' }],\n    series: [\n      {\n        type: 'bar',\n        name: 'Positive Emotions',\n        data: rows.map(r => toFiniteNumber(r.positiveEmotions)),\n        yAxisIndex: 0,\n        emphasis: { focus: 'none' },\n      },\n      {\n        type: 'bar',\n        name: 'Negative Emotions',\n        data: rows.map(r => toFiniteNumber(r.negativeEmotions)),\n        yAxisIndex: 0,\n        emphasis: { focus: 'none' },\n      },\n      {\n        type: 'line',\n        name: 'Avg Intensity',\n        data: rows.map(r => toFiniteNumber(r.avgEmotionIntensity)),\n        yAxisIndex: 1,\n        smooth: true,\n        lineStyle: { width: 3 },\n        showSymbol: false,\n        emphasis: { focus: 'none' },\n      },\n    ],\n  } as EChartsOption;\n}\n\n/** Correlation heatmap option builder (ECharts). */\nexport function buildCorrelationHeatmapOption(matrix: CorrelationMatrix): EChartsOption {\n  const factors = matrix.factors ?? [];\n  const values: Array<[number, number, number]> = [];\n  for (let i = 0; i < matrix.matrix.length; i++) {\n    const row = matrix.matrix[i] || [];\n    for (let j = 0; j < row.length; j++) {\n      const vRaw = row[j];\n      const v = typeof vRaw === 'number' && Number.isFinite(vRaw) ? vRaw : 0;\n      values.push([j, i, Number(v.toFixed(2))]);\n    }\n  }\n\n  // Map for quick significance lookup in tooltip\n  const significanceMap = new Map<string, { significance: string; correlation: number }>();\n  for (const p of matrix.significantPairs || []) {\n    const key1 = `${p.factor1}__${p.factor2}`;\n    const key2 = `${p.factor2}__${p.factor1}`;\n    significanceMap.set(key1, { significance: p.significance, correlation: p.correlation });\n    significanceMap.set(key2, { significance: p.significance, correlation: p.correlation });\n  }\n\n  const option: EChartsOption = {\n    grid: { top: 80, left: 120, right: 64, bottom: 60, containLabel: true },\n    xAxis: {\n      type: 'category',\n      data: factors,\n      axisLabel: { rotate: 40, margin: 16 },\n    },\n    yAxis: {\n      type: 'category',\n      data: factors,\n      axisLabel: { margin: 12 },\n    },\n    tooltip: {\n      trigger: 'item',\n      confine: true,\n      appendToBody: true,\n      formatter: (p: any) => {\n        const i = p?.value?.[1];\n        const j = p?.value?.[0];\n        const f1 = factors[i] ?? '';\n        const f2 = factors[j] ?? '';\n        const key = `${f1}__${f2}`;\n        const sig = significanceMap.get(key)?.significance;\n        const corr = typeof p?.value?.[2] === 'number' ? p.value[2] : Number(p.value?.[2]) || 0;\n        const sign = corr > 0 ? 'Positive' : corr < 0 ? 'Negative' : 'Neutral';\n        return `<div style=\"font-weight:600;margin-bottom:6px\">${f1} ↔ ${f2}</div>\n                <div>Correlation: <b>${corr.toFixed(2)}</b> (${sign})</div>\n                ${sig ? `<div>Significance: <b>${sig}</b></div>` : ''}`;\n      }\n    },\n    visualMap: {\n      min: -1,\n      max: 1,\n      calculable: true,\n      orient: 'vertical',\n      right: 8,\n      top: 40,\n      text: ['Positiv', 'Negativ'],\n      inRange: {\n        // Diverging palette: red (neg) → gray (0) → green (pos)\n        color: ['#ef4444', '#f3f4f6', '#10b981']\n      },\n      itemWidth: 12,\n      itemHeight: 100,\n      textStyle: { color: 'hsl(var(--muted-foreground))' },\n    },\n    series: [\n      {\n        type: 'heatmap',\n        data: values,\n        label: {\n          show: true,\n          formatter: (params: any) => {\n            const v = typeof params?.value?.[2] === 'number' ? params.value[2] : Number(params?.value?.[2]) || 0;\n            // Only label moderate/strong correlations to reduce clutter\n            return Math.abs(v) >= 0.25 ? v.toFixed(2) : '';\n          },\n        },\n        itemStyle: {\n          borderWidth: 1,\n          borderColor: '#374151' // Tailwind gray-700 for better contrast on dark backgrounds\n        },\n        emphasis: { disabled: true, focus: 'none' },\n        progressive: 0,\n        // Larger cells for readability\n        // ECharts sizes cells automatically based on grid/category count\n      },\n    ],\n  };\n\n  return option;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/chartColor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/chartRegistry.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/chartTransforms.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":78,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2930,2933],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2930,2933],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport { EmotionEntry, SensoryEntry } from '@/types/student';\nimport { bin, extent } from 'vega-transforms';\n\n/**\n * Aggregates emotion and sensory entries by day, calculating the total count\n * and average intensity for each day. This is useful for visualizing trends\n * over time.\n *\n * @param entries - An array of EmotionEntry or SensoryEntry objects. Each object\n *   must have a `timestamp` and `intensity` property.\n * @returns An array of objects, where each object represents a day and contains\n *   the date, the total number of entries for that day, and the average\n *   intensity of those entries.\n *\n * @example\n * const entries = [\n *   { timestamp: '2023-01-01T12:00:00Z', intensity: 5 },\n *   { timestamp: '2023-01-01T18:00:00Z', intensity: 3 },\n *   { timestamp: '2023-01-02T09:00:00Z', intensity: 8 },\n * ];\n * const dailyStats = aggregateEntriesByDay(entries);\n * // dailyStats will be:\n * // [\n * //   { date: '2023-01-01', count: 2, averageIntensity: 4 },\n * //   { date: '2023-01-02', count: 1, averageIntensity: 8 },\n * // ]\n */\nexport function aggregateEntriesByDay(entries: (EmotionEntry | SensoryEntry)[]) {\n  const aggregated = entries.reduce((acc, entry) => {\n    const date = new Date(entry.timestamp).toISOString().split('T')[0];\n    if (!acc[date]) {\n      acc[date] = { count: 0, totalIntensity: 0 };\n    }\n    acc[date].count++;\n    acc[date].totalIntensity += entry.intensity;\n    return acc;\n  }, {} as Record<string, { count: number; totalIntensity: number }>);\n\n  return Object.entries(aggregated).map(([date, { count, totalIntensity }]) => ({\n    date,\n    count,\n    averageIntensity: totalIntensity / count,\n  }));\n}\n\n/**\n * Computes intensity bins for a collection of emotion or sensory entries.\n * This function uses the vega-transforms `bin` utility to partition the\n * entries into a specified number of bins based on their intensity levels.\n *\n * @param entries - An array of EmotionEntry or SensoryEntry objects. Each\n *   object must have an `intensity` property.\n * @returns An array of objects, where each object represents an intensity\n *   bin. It includes the bin range as a string (e.g., \"0-2\") and the\n *   number of entries falling within that bin.\n *\n * @example\n * const entries = [\n *   { intensity: 1 },\n *   { intensity: 2 },\n *   { intensity: 5 },\n *   { intensity: 8 },\n *   { intensity: 9 },\n * ];\n * const intensityBins = computeIntensityBins(entries);\n * // Example output (exact bins may vary based on implementation):\n * // [\n * //   { bin: '0-2', count: 2 },\n * //   { bin: '4-6', count: 1 },\n * //   { bin: '8-10', count: 2 },\n * // ]\n */\nexport function computeIntensityBins(entries: (EmotionEntry | SensoryEntry)[]) {\n  const intensityExtent = extent(entries, (d: EmotionEntry | SensoryEntry) => d.intensity);\n  const binned = bin({ extent: intensityExtent, maxbins: 5 })(entries, (d: EmotionEntry | SensoryEntry) => d.intensity);\n\n  return binned.map((bin: any) => ({\n    bin: `${bin.x0}-${bin.x1}`,\n    count: bin.length,\n  }));\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/chartUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/dataPreprocessing.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/dataStorage.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/dataStorage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/dataSufficiency.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'emotions' is defined but never used. Allowed unused args must match /^_/u.","line":12,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":11},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'sensory' is defined but never used. Allowed unused args must match /^_/u.","line":13,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":10}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { TrackingEntry, EmotionEntry, SensoryEntry } from '@/types/student';\n\nexport type ReadinessScore = {\n  label: 'insufficient' | 'partial' | 'ready';\n  score: number; // 0..1\n  reasons: string[];\n  needed?: { entries?: number; socialExamples?: number; timespanDays?: number };\n};\n\nexport function evaluateSocialTriggerReadiness(\n  entries: TrackingEntry[],\n  emotions: EmotionEntry[],\n  sensory: SensoryEntry[],\n): ReadinessScore {\n  const reasons: string[] = [];\n  const totalEntries = entries.length;\n\n  // Count social-related evidence heuristically from notes/contexts\n  const isSocial = (txt?: string) => !!txt && /(sosial|gruppe|grupp|venn|klasse|friminutt|pause|interaksj|samarbeid|konflikt)/i.test(txt);\n  let socialCount = 0;\n  for (const e of entries) {\n    if (isSocial(e.generalNotes || e.notes)) socialCount++;\n    for (const emo of e.emotions || []) {\n      if (isSocial(emo.notes) || isSocial((emo.triggers || []).join(' '))) socialCount++;\n    }\n  }\n\n  // Timespan proxy: diff between first & last entry\n  let daysSpan = 0;\n  if (entries.length > 1) {\n    const times = entries.map(e => new Date(e.timestamp).getTime()).sort((a, b) => a - b);\n    daysSpan = Math.max(1, Math.round((times[times.length - 1] - times[0]) / (1000 * 60 * 60 * 24)));\n  }\n\n  // Heuristic thresholds (can be tuned)\n  const NEED_ENTRIES = 25;\n  const NEED_SOCIAL = 5;\n  const NEED_DAYS = 7;\n\n  if (totalEntries < NEED_ENTRIES) reasons.push(`For få økter (${totalEntries}/${NEED_ENTRIES}).`);\n  if (socialCount < NEED_SOCIAL) reasons.push(`Få sosiale eksempler (${socialCount}/${NEED_SOCIAL}).`);\n  if (daysSpan < NEED_DAYS) reasons.push(`Kort tidsrom (${daysSpan}/${NEED_DAYS} dager).`);\n\n  const ratioEntries = Math.min(1, totalEntries / NEED_ENTRIES);\n  const ratioSocial = Math.min(1, socialCount / NEED_SOCIAL);\n  const ratioDays = Math.min(1, daysSpan / NEED_DAYS);\n  const score = Math.round(((ratioEntries * 0.4 + ratioSocial * 0.4 + ratioDays * 0.2) + Number.EPSILON) * 100) / 100;\n\n  const label: ReadinessScore['label'] = score >= 0.85 ? 'ready' : score >= 0.6 ? 'partial' : 'insufficient';\n\n  return {\n    label,\n    score,\n    reasons,\n    needed: {\n      entries: Math.max(0, NEED_ENTRIES - totalEntries),\n      socialExamples: Math.max(0, NEED_SOCIAL - socialCount),\n      timespanDays: Math.max(0, NEED_DAYS - daysSpan),\n    }\n  };\n}\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/dataValidation.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/dataValidation.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Student' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":53,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":60},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1987,1990],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1987,1990],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":99,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2519,2522],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2519,2522],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2775,2778],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2775,2778],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3034,3037],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3034,3037],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3294,3297],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3294,3297],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\nimport { TrackingEntry, EmotionEntry, SensoryEntry, Student } from '@/types/student';\nimport { z } from 'zod';\n\n// Student schema\nconst studentSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  grade: z.string().optional(),\n  dateOfBirth: z.string().optional(),\n  notes: z.string().optional(),\n  iepGoals: z.array(z.any()).optional(),\n  createdAt: z.date(),\n  lastUpdated: z.date().optional(),\n  version: z.number().optional(),\n});\n\n// Updated tracking entry schema to match the actual TrackingEntry type\nconst trackingEntrySchema = z.object({\n  id: z.string(),\n  studentId: z.string(),\n  timestamp: z.union([z.date(), z.string()]).transform((val) => \n    typeof val === 'string' ? new Date(val) : val\n  ),\n  emotions: z.array(z.any()).optional(),\n  sensoryInputs: z.array(z.any()).optional(),\n  environmentalData: z.any().optional(),\n  notes: z.string().optional(),\n});\n\nconst emotionEntrySchema = z.object({\n  id: z.string(),\n  studentId: z.string(),\n  timestamp: z.union([z.date(), z.string()]).transform((val) => \n    typeof val === 'string' ? new Date(val) : val\n  ),\n  emotion: z.string(),\n  intensity: z.number(),\n  triggers: z.array(z.string()).optional(),\n  notes: z.string().optional(),\n});\n\nconst sensoryEntrySchema = z.object({\n  id: z.string(),\n  studentId: z.string(),\n  timestamp: z.union([z.date(), z.string()]).transform((val) => \n    typeof val === 'string' ? new Date(val) : val\n  ),\n  type: z.string().optional(),\n  sensoryType: z.string().optional(),\n  response: z.string().optional(),\n  intensity: z.number(),\n  notes: z.string().optional(),\n});\n\nconst trackingDataSchema = z.object({\n  entries: z.array(trackingEntrySchema),\n  emotions: z.array(emotionEntrySchema),\n  sensoryInputs: z.array(sensoryEntrySchema),\n});\n\ntype ValidationResult = {\n  valid: boolean;\n  errors: z.ZodError | null;\n  cleanedData: {\n    entries: TrackingEntry[];\n    emotions: EmotionEntry[];\n    sensoryInputs: SensoryEntry[];\n  };\n};\n\nexport function validateTrackingData(data: any): ValidationResult {\n  const result = trackingDataSchema.safeParse(data);\n  if (result.success) {\n    return {\n      valid: true,\n      errors: null,\n      cleanedData: result.data,\n    };\n  } else {\n    return {\n      valid: false,\n      errors: result.error,\n      cleanedData: {\n        entries: [],\n        emotions: [],\n        sensoryInputs: [],\n      },\n    };\n  }\n}\n\n// Individual validation functions\ntype SimpleValidationResult = {\n  isValid: boolean;\n  errors?: string[];\n};\n\nexport function validateStudent(student: any): SimpleValidationResult {\n  const result = studentSchema.safeParse(student);\n  return {\n    isValid: result.success,\n    errors: result.success ? undefined : result.error.errors.map(e => e.message),\n  };\n}\n\nexport function validateEmotionEntry(entry: any): SimpleValidationResult {\n  const result = emotionEntrySchema.safeParse(entry);\n  return {\n    isValid: result.success,\n    errors: result.success ? undefined : result.error.errors.map(e => e.message),\n  };\n}\n\nexport function validateSensoryEntry(entry: any): SimpleValidationResult {\n  const result = sensoryEntrySchema.safeParse(entry);\n  return {\n    isValid: result.success,\n    errors: result.success ? undefined : result.error.errors.map(e => e.message),\n  };\n}\n\nexport function validateTrackingEntry(entry: any): SimpleValidationResult {\n  const result = trackingEntrySchema.safeParse(entry);\n  return {\n    isValid: result.success,\n    errors: result.success ? undefined : result.error.errors.map(e => e.message),\n  };\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/dateRange.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/deprecation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/diagnostics.ts","messages":[{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":81,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":97,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Diagnostic Logger for Debugging\n * Mr. Debugger's specialized diagnostic tool\n */\n\nimport { logger } from './logger';\n\n// Type extension for Chrome performance memory API\ninterface PerformanceMemory {\n  usedJSHeapSize: number;\n  totalJSHeapSize: number;\n  jsHeapSizeLimit: number;\n}\n\n// Extend Performance interface for Chrome-specific features\ninterface ExtendedPerformance extends Performance {\n  memory?: PerformanceMemory;\n}\n\n// Type-safe timer ID\ntype TimerId = ReturnType<typeof setTimeout>;\n\n// Browser-specific setTimeout function arguments\ntype SetTimeoutArgs = [handler: TimerHandler, timeout?: number, ...args: unknown[]];\n\n// Window extension for timer tracking\ndeclare global {\n  interface Window {\n    setTimeout: (...args: SetTimeoutArgs) => TimerId;\n    clearTimeout: (id: TimerId) => void;\n  }\n}\n\ninterface DiagnosticInfo {\n  timestamp: Date;\n  memoryUsage?: {\n    usedJSHeapSize: number;\n    totalJSHeapSize: number;\n    jsHeapSizeLimit: number;\n  };\n  activeTimers?: number;\n  activeListeners?: number;\n  componentName?: string;\n  action?: string;\n  data?: unknown;\n}\n\nclass DiagnosticLogger {\n  private static instance: DiagnosticLogger;\n  private activeTimers = new Set<number>();\n  private activeListeners = new Map<string, number>();\n  private diagnosticMode = false;\n\n  private constructor() {\n    // Determine initial diagnostic mode from URL or localStorage (opt-in only)\n    if (typeof window !== 'undefined') {\n      try {\n        const urlFlag = new URLSearchParams(window.location.search).get('diag') === '1';\n        const lsFlag = (window.localStorage.getItem('diagnostics') || '').toLowerCase() === 'on';\n        this.diagnosticMode = Boolean(urlFlag || lsFlag);\n      } catch {\n        this.diagnosticMode = false;\n      }\n    }\n\n    // Track performance metrics only when diagnostics are enabled\n    if (this.diagnosticMode && typeof window !== 'undefined' && 'performance' in window) {\n      this.startPerformanceMonitoring();\n    }\n  }\n\n  static getInstance(): DiagnosticLogger {\n    if (!DiagnosticLogger.instance) {\n      DiagnosticLogger.instance = new DiagnosticLogger();\n    }\n    return DiagnosticLogger.instance;\n  }\n\n  private startPerformanceMonitoring(): void {\n    // Monitor memory usage every 5 seconds\n    setInterval(() => {\n      if (this.diagnosticMode && (performance as ExtendedPerformance).memory) {\n        const memInfo = (performance as ExtendedPerformance).memory!;\n        const usedMB = (memInfo.usedJSHeapSize / 1048576).toFixed(2);\n        const totalMB = (memInfo.totalJSHeapSize / 1048576).toFixed(2);\n        \n        logger.info(`[DIAGNOSTIC] Memory Usage: ${usedMB}MB / ${totalMB}MB`);\n        \n        // Warning if memory usage is high\n        if (memInfo.usedJSHeapSize / memInfo.jsHeapSizeLimit > 0.9) {\n          logger.warn('[DIAGNOSTIC] High memory usage detected!', {\n            used: usedMB,\n            limit: (memInfo.jsHeapSizeLimit / 1048576).toFixed(2)\n          });\n        }\n      }\n    }, 5000);\n  }\n\n  public isEnabled() {\n    return this.diagnosticMode;\n  }\n\n  logComponentMount(componentName: string) {\n    if (!this.diagnosticMode) return;\n    \n    const info: DiagnosticInfo = {\n      timestamp: new Date(),\n      componentName,\n      action: 'MOUNT',\n      activeTimers: this.activeTimers.size,\n      activeListeners: Array.from(this.activeListeners.values()).reduce((a, b) => a + b, 0)\n    };\n\n    logger.debug('[DIAGNOSTIC] Component Mounted', info);\n  }\n\n  logComponentUnmount(componentName: string) {\n    if (!this.diagnosticMode) return;\n    \n    const info: DiagnosticInfo = {\n      timestamp: new Date(),\n      componentName,\n      action: 'UNMOUNT',\n      activeTimers: this.activeTimers.size,\n      activeListeners: Array.from(this.activeListeners.values()).reduce((a, b) => a + b, 0)\n    };\n\n    logger.debug('[DIAGNOSTIC] Component Unmounted', info);\n  }\n\n  logUseEffectCleanup(componentName: string, hasCleanup: boolean) {\n    if (!this.diagnosticMode) return;\n    \n    logger.debug('[DIAGNOSTIC] UseEffect Cleanup', {\n      componentName,\n      hasCleanup,\n      timestamp: new Date()\n    });\n\n    if (!hasCleanup) {\n      logger.warn('[DIAGNOSTIC] Missing cleanup in useEffect!', { componentName });\n    }\n  }\n\n  logWorkerMessage(workerName: string, messageType: string, data?: unknown) {\n    if (!this.diagnosticMode) return;\n    \n    logger.debug('[DIAGNOSTIC] Worker Message', {\n      workerName,\n      messageType,\n      timestamp: new Date(),\n      dataSize: data ? JSON.stringify(data).length : 0\n    });\n  }\n\n  logWorkerTimeout(workerName: string, timeout: number) {\n    if (!this.diagnosticMode) return;\n    \n    logger.error('[DIAGNOSTIC] Worker Timeout!', {\n      workerName,\n      timeout,\n      timestamp: new Date()\n    });\n  }\n\n  trackTimer(timerId: number) {\n    if (!this.diagnosticMode) return;\n    this.activeTimers.add(timerId);\n    logger.debug('[DIAGNOSTIC] Timer Created', { \n      timerId, \n      activeCount: this.activeTimers.size \n    });\n  }\n\n  untrackTimer(timerId: number) {\n    if (!this.diagnosticMode) return;\n    this.activeTimers.delete(timerId);\n    logger.debug('[DIAGNOSTIC] Timer Cleared', { \n      timerId, \n      activeCount: this.activeTimers.size \n    });\n  }\n\n  trackEventListener(element: string, event: string) {\n    if (!this.diagnosticMode) return;\n    const key = `${element}-${event}`;\n    const current = this.activeListeners.get(key) || 0;\n    this.activeListeners.set(key, current + 1);\n    \n    logger.debug('[DIAGNOSTIC] Event Listener Added', {\n      element,\n      event,\n      totalListeners: Array.from(this.activeListeners.values()).reduce((a, b) => a + b, 0)\n    });\n  }\n\n  untrackEventListener(element: string, event: string) {\n    if (!this.diagnosticMode) return;\n    const key = `${element}-${event}`;\n    const current = this.activeListeners.get(key) || 0;\n    if (current > 0) {\n      this.activeListeners.set(key, current - 1);\n    }\n    \n    logger.debug('[DIAGNOSTIC] Event Listener Removed', {\n      element,\n      event,\n      totalListeners: Array.from(this.activeListeners.values()).reduce((a, b) => a + b, 0)\n    });\n  }\n\n  logAsyncOperation(operationName: string, duration: number, success: boolean) {\n    if (!this.diagnosticMode) return;\n    \n    const logData = {\n      operationName,\n      duration,\n      success,\n      timestamp: new Date()\n    };\n\n    if (duration > 3000) {\n      logger.warn('[DIAGNOSTIC] Slow async operation detected!', logData);\n    } else {\n      logger.debug('[DIAGNOSTIC] Async operation completed', logData);\n    }\n  }\n\n  checkForLeaks() {\n    if (!this.diagnosticMode) return;\n    \n    const report = {\n      activeTimers: this.activeTimers.size,\n      activeListeners: Array.from(this.activeListeners.values()).reduce((a, b) => a + b, 0),\n      timestamp: new Date()\n    };\n\n    if (report.activeTimers > 10) {\n      logger.warn('[DIAGNOSTIC] Potential timer leak detected!', report);\n    }\n\n    if (report.activeListeners > 50) {\n      logger.warn('[DIAGNOSTIC] Potential event listener leak detected!', report);\n    }\n\n    return report;\n  }\n\n  setDiagnosticMode(enabled: boolean) {\n    this.diagnosticMode = enabled;\n    logger.info(`[DIAGNOSTIC] Diagnostic mode ${enabled ? 'enabled' : 'disabled'}`);\n    // Note: we intentionally do not re-wrap timers dynamically here to avoid breaking existing references\n  }\n}\n\nexport const diagnostics = DiagnosticLogger.getInstance();\n\n// Wrap setTimeout and clearTimeout to track timers ONLY when diagnostics are enabled\nif (typeof window !== 'undefined' && diagnostics.isEnabled()) {\n  const originalSetTimeout = window.setTimeout;\n  const originalClearTimeout = window.clearTimeout;\n\n  window.setTimeout = function(...args: SetTimeoutArgs): TimerId {\n    const timerId = originalSetTimeout.apply(window, args);\n    diagnostics.trackTimer(Number(timerId));\n    return timerId;\n  };\n\n  window.clearTimeout = function(timerId: TimerId): void {\n    diagnostics.untrackTimer(Number(timerId));\n    return originalClearTimeout.call(window, timerId);\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/echartsCore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/enhancedPatternAnalysis.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isWithinInterval' is defined but never used. Allowed unused vars must match /^_/u.","line":23,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":106,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3286,3289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3286,3289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":106,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3311,3314],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3311,3314],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'timeWindows' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":108,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":108,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'alertSensitivity' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":108,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":108,"endColumn":60},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'analytics' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":108,"column":62,"nodeType":null,"messageId":"unusedVar","endLine":108,"endColumn":71},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'insightsCfg' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":108,"column":83,"nodeType":null,"messageId":"unusedVar","endLine":108,"endColumn":94},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'taxonomy' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":108,"column":96,"nodeType":null,"messageId":"unusedVar","endLine":108,"endColumn":104},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":270,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":270,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11199,11202],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11199,11202],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":270,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":270,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11224,11227],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11224,11227],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'analytics' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":272,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":272,"endColumn":40},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":374,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":374,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15639,15642],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15639,15642],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":374,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":374,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15664,15667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15664,15667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":376,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":376,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15850,15853],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15850,15853],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'trackingEntries' is defined but never used. Allowed unused args must match /^_/u.","line":474,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":474,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":477,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":477,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19943,19946],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19943,19946],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":477,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":477,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19968,19971],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19968,19971],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":539,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":539,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22514,22517],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22514,22517],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":539,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":539,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22539,22542],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22539,22542],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":586,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":586,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24768,24771],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24768,24771],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":685,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":685,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28248,28251],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28248,28251],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":685,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":685,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28273,28276],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28273,28276],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'alertSensitivity' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":687,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":687,"endColumn":60},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":698,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":698,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29054,29057],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29054,29057],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'context' is defined but never used. Allowed unused args must match /^_/u.","line":821,"column":51,"nodeType":null,"messageId":"unusedVar","endLine":821,"endColumn":58},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'severity' is defined but never used. Allowed unused args must match /^_/u.","line":821,"column":68,"nodeType":null,"messageId":"unusedVar","endLine":821,"endColumn":76},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":847,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":847,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34249,34252],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34249,34252],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":847,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":847,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34274,34277],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34274,34277],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":889,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":889,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36134,36137],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36134,36137],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":889,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":889,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36159,36162],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36159,36162],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":915,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":915,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37317,37320],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37317,37320],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":915,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":915,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37342,37345],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37342,37345],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'enhancedAnalysis' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":917,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":917,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'patternAnalysis' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":917,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":917,"endColumn":46},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'timeWindows' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":917,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":917,"endColumn":59},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'alertSensitivity' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":917,"column":61,"nodeType":null,"messageId":"unusedVar","endLine":917,"endColumn":77},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'analytics' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":917,"column":79,"nodeType":null,"messageId":"unusedVar","endLine":917,"endColumn":88},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'insights' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":917,"column":90,"nodeType":null,"messageId":"unusedVar","endLine":917,"endColumn":98},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'taxonomy' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":917,"column":100,"nodeType":null,"messageId":"unusedVar","endLine":917,"endColumn":108}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":39,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Module: enhancedPatternAnalysis\n *\n * Purpose\n * - Hybrid statistical + ML analysis for trends, correlations, anomalies, and predictions\n *\n * Robust Statistics Integration\n * - Uses zScoresMedian (MAD-based) and huberRegression to reduce outlier sensitivity\n * - Prefer robust estimators for heavy-tailed or noisy classroom data\n *\n * Parameterization\n * - All thresholds, windows, and sensitivities are read from analyticsConfig\n *   - enhancedAnalysis.predictionConfidenceThreshold\n *   - timeWindows (rolling calculations)\n *   - patternAnalysis.highIntensityThreshold and related knobs\n * - No hardcoded constants; provide safe defaults when config is unavailable\n *\n * Performance & Safety\n * - Avoid blocking the main thread; yield in UI layers if long operations are needed\n * - Log via logger (no console.* in shipped code)\n */\nimport { EmotionEntry, SensoryEntry, TrackingEntry, Goal } from \"@/types/student\";\nimport { isWithinInterval, subDays, format, differenceInDays } from \"date-fns\";\nimport { analyticsConfig } from \"@/lib/analyticsConfig\";\nimport { mlModels, EmotionPrediction, SensoryPrediction, BaselineCluster } from \"@/lib/mlModels\";\nimport { logger } from '@/lib/logger';\nimport { pearsonCorrelation, pValueForCorrelation, zScoresMedian, huberRegression } from '@/lib/statistics';\n\nexport interface PredictiveInsight {\n  type: 'prediction' | 'trend' | 'recommendation' | 'risk';\n  title: string;\n  description: string;\n  confidence: number;\n  timeframe: string;\n  prediction?: {\n    value: number;\n    trend: 'increasing' | 'decreasing' | 'stable';\n    accuracy: number;\n  };\n  recommendations: string[];\n  severity?: 'low' | 'medium' | 'high';\n  source?: 'statistical' | 'ml' | 'hybrid';\n  mlPrediction?: EmotionPrediction[] | SensoryPrediction;\n}\n\nexport interface TrendAnalysis {\n  metric: string;\n  direction: 'increasing' | 'decreasing' | 'stable';\n  rate: number; // change per day\n  significance: number; // 0-1\n  confidence: number;\n  forecast: {\n    next7Days: number;\n    next30Days: number;\n    confidence: number;\n  };\n}\n\nexport interface AnomalyDetection {\n  timestamp: Date;\n  type: 'emotion' | 'sensory' | 'environmental';\n  severity: 'low' | 'medium' | 'high';\n  description: string;\n  deviationScore: number;\n  recommendations: string[];\n}\n\nexport interface CorrelationMatrix {\n  factors: string[];\n  matrix: number[][];\n  significantPairs: Array<{\n    factor1: string;\n    factor2: string;\n    correlation: number;\n    pValue: number;\n    significance: 'low' | 'moderate' | 'high';\n  }>;\n}\n\nclass EnhancedPatternAnalysisEngine {\n  private mlModelsInitialized: boolean = false;\n\n  constructor() {\n    // Initialize ML models\n    this.initializeMLModels();\n  }\n\n  private async initializeMLModels(): Promise<void> {\n    try {\n      await mlModels.init();\n      this.mlModelsInitialized = true;\n    } catch (error) {\n      logger.error('Failed to initialize ML models:', error);\n      this.mlModelsInitialized = false;\n    }\n  }\n\n  // Predictive Analytics with ML Integration\n  async generatePredictiveInsights(\n    emotions: EmotionEntry[],\n    sensoryInputs: SensoryEntry[],\n    trackingEntries: TrackingEntry[],\n    goals: Goal[] = []\n  ): Promise<PredictiveInsight[]> {\n    // Capture config snapshot once per operation\n    const cfgAny: any = analyticsConfig as any;\n    const cfg = typeof cfgAny.get === 'function' ? cfgAny.get() : analyticsConfig.getConfig();\n    const { enhancedAnalysis, timeWindows, alertSensitivity, analytics, insights: insightsCfg, taxonomy, patternAnalysis } = cfg;\n\n    const collectedInsights: PredictiveInsight[] = [];\n\n    // Statistical emotional well-being prediction\n    const emotionTrend = this.analyzeEmotionTrend(emotions);\n    if (emotionTrend && emotionTrend.significance >= enhancedAnalysis.predictionConfidenceThreshold) {\n      const statisticalInsight: PredictiveInsight = {\n        type: 'prediction',\n        title: 'Emotional Well-being Forecast (Statistical)',\n        description: `Based on current trends, emotional intensity is ${emotionTrend.direction}`,\n        confidence: emotionTrend.significance,\n        timeframe: '7-day forecast',\n        prediction: {\n          value: emotionTrend.forecast.next7Days,\n          trend: emotionTrend.direction,\n          accuracy: emotionTrend.confidence\n        },\n        recommendations: this.getEmotionTrendRecommendations(emotionTrend),\n        severity: this.getTrendSeverity(emotionTrend),\n        source: 'statistical'\n      };\n      collectedInsights.push(statisticalInsight);\n    }\n\n    // ML emotional prediction if available\n    if (this.mlModelsInitialized && trackingEntries.length >= 7) {\n      try {\n        const modelStatus = await mlModels.getModelStatus();\n        if (modelStatus.get('emotion-prediction')) {\n          const mlEmotionPredictions = await mlModels.predictEmotions(\n            trackingEntries.slice(-14), // Use last 14 days for better context\n            7\n          );\n\n          if (mlEmotionPredictions.length > 0) {\n            // Calculate overall trend from ML predictions\n            const avgPredictedIntensity = mlEmotionPredictions.reduce((sum, pred) => {\n              const emotionSum = Object.values(pred.emotions).reduce((s, v) => s + v, 0);\n              return sum + emotionSum / Object.keys(pred.emotions).length;\n            }, 0) / mlEmotionPredictions.length;\n\n            const currentAvgIntensity = emotions.slice(-7).reduce((sum, e) => sum + e.intensity, 0) /\n              Math.max(emotions.slice(-7).length, 1);\n\n            const upMultiplier = 1 + enhancedAnalysis.trendThreshold;\n            const downMultiplier = 1 - enhancedAnalysis.trendThreshold;\n            const mlTrend = avgPredictedIntensity >= currentAvgIntensity * upMultiplier ? 'increasing' :\n                           avgPredictedIntensity <= currentAvgIntensity * downMultiplier ? 'decreasing' : 'stable';\n\n            const highT = patternAnalysis.highIntensityThreshold;\n            const mediumCut = Math.max(highT - 2, 1);\n            const severity: 'low' | 'medium' | 'high' =\n              avgPredictedIntensity >= highT ? 'high' :\n              avgPredictedIntensity <= mediumCut ? 'medium' : 'low';\n\n            collectedInsights.push({\n              type: 'prediction',\n              title: 'Emotional Well-being Forecast (ML)',\n              description: `Machine learning predicts emotional patterns will be ${mlTrend}`,\n              confidence: mlEmotionPredictions[0].confidence,\n              timeframe: '7-day forecast',\n              prediction: {\n                value: avgPredictedIntensity,\n                trend: mlTrend,\n                accuracy: mlEmotionPredictions[0].confidence\n              },\n              recommendations: this.getMLEmotionRecommendations(mlEmotionPredictions, mlTrend),\n              severity,\n              source: 'ml',\n              mlPrediction: mlEmotionPredictions\n            });\n          }\n        }\n      } catch (error) {\n        logger.error('ML emotion prediction failed:', error);\n      }\n    }\n\n    // Statistical sensory regulation prediction\n    const sensoryTrend = this.analyzeSensoryTrend(sensoryInputs);\n    if (sensoryTrend && sensoryTrend.significance >= enhancedAnalysis.predictionConfidenceThreshold) {\n      collectedInsights.push({\n        type: 'prediction',\n        title: 'Sensory Regulation Forecast (Statistical)',\n        description: `Sensory seeking/avoiding patterns show ${sensoryTrend.direction} trend`,\n        confidence: sensoryTrend.significance,\n        timeframe: '14-day forecast',\n        prediction: {\n          value: sensoryTrend.forecast.next7Days,\n          trend: sensoryTrend.direction,\n          accuracy: sensoryTrend.confidence\n        },\n        recommendations: this.getSensoryTrendRecommendations(sensoryTrend),\n        severity: this.getTrendSeverity(sensoryTrend),\n        source: 'statistical'\n      });\n    }\n\n    // ML sensory prediction if available\n    if (this.mlModelsInitialized && trackingEntries.length > 0) {\n      try {\n        const modelStatus = await mlModels.getModelStatus();\n        if (modelStatus.get('sensory-response') && trackingEntries[trackingEntries.length - 1].environmentalData) {\n          const latestEnvironment = {\n            lighting: trackingEntries[trackingEntries.length - 1].environmentalData?.roomConditions?.lighting as 'bright' | 'dim' | 'moderate' || 'moderate',\n            noise: (trackingEntries[trackingEntries.length - 1].environmentalData?.roomConditions?.noiseLevel &&\n                   trackingEntries[trackingEntries.length - 1].environmentalData.roomConditions.noiseLevel > 70 ? 'loud' :\n                   trackingEntries[trackingEntries.length - 1].environmentalData?.roomConditions?.noiseLevel &&\n                   trackingEntries[trackingEntries.length - 1].environmentalData.roomConditions.noiseLevel < 40 ? 'quiet' : 'moderate') as 'loud' | 'moderate' | 'quiet',\n            temperature: (trackingEntries[trackingEntries.length - 1].environmentalData?.roomConditions?.temperature &&\n                        trackingEntries[trackingEntries.length - 1].environmentalData.roomConditions.temperature > 26 ? 'hot' :\n                        trackingEntries[trackingEntries.length - 1].environmentalData?.roomConditions?.temperature &&\n                        trackingEntries[trackingEntries.length - 1].environmentalData.roomConditions.temperature < 18 ? 'cold' : 'comfortable') as 'hot' | 'cold' | 'comfortable',\n            crowded: 'moderate' as const,\n            smells: false,\n            textures: false\n          };\n\n          const mlSensoryPrediction = await mlModels.predictSensoryResponse(\n            latestEnvironment,\n            new Date()\n          );\n\n          if (mlSensoryPrediction) {\n            collectedInsights.push({\n              type: 'prediction',\n              title: 'Sensory Response Prediction (ML)',\n              description: `Machine learning predicts sensory responses based on current environment`,\n              confidence: mlSensoryPrediction.confidence,\n              timeframe: 'Current environment',\n              recommendations: this.getMLSensoryRecommendations(mlSensoryPrediction),\n              severity: mlSensoryPrediction.environmentalTriggers.length > 2 ? 'high' :\n                       mlSensoryPrediction.environmentalTriggers.length > 0 ? 'medium' : 'low',\n              source: 'ml',\n              mlPrediction: mlSensoryPrediction\n            });\n          }\n        }\n      } catch (error) {\n        logger.error('ML sensory prediction failed:', error);\n      }\n    }\n\n    // Goal achievement prediction\n    goals.forEach(goal => {\n      const goalPrediction = this.predictGoalAchievement(goal);\n      if (goalPrediction) {\n        collectedInsights.push(goalPrediction);\n      }\n    });\n\n    // Risk assessment\n    const riskInsights = this.assessRisks(emotions, sensoryInputs, trackingEntries);\n    collectedInsights.push(...riskInsights);\n\n    return collectedInsights;\n  }\n\n  // Enhanced Trend Analysis with Statistical Significance\n  analyzeTrendsWithStatistics(data: { value: number; timestamp: Date }[]): TrendAnalysis | null {\n    // Capture config snapshot once per operation\n    const cfgAny: any = analyticsConfig as any;\n    const cfg = typeof cfgAny.get === 'function' ? cfgAny.get() : analyticsConfig.getConfig();\n    const { enhancedAnalysis, analytics, timeWindows } = cfg;\n\n    if (data.length < enhancedAnalysis.minSampleSize) return null;\n\n    // Sort by timestamp without mutating the input\n    const sortedData = [...data].sort((a, b) => a.timestamp.getTime() - b.timestamp.getTime());\n    \n    // Robust linear regression (Huber) for slope/intercept on x=0..n-1, y=values\n    const n = sortedData.length;\n    const x = sortedData.map((_, i) => i);\n    const y = sortedData.map(d => d.value);\n\n    const huberCfg = enhancedAnalysis?.huber || { delta: 1.345, maxIter: 50, tol: 1e-6 };\n    const { slope, intercept } = huberRegression(x, y, {\n      maxIter: Number.isFinite(huberCfg.maxIter) ? huberCfg.maxIter : 50,\n      tol: Number.isFinite(huberCfg.tol) ? huberCfg.tol : 1e-6,\n      delta: Number.isFinite(huberCfg.delta) ? huberCfg.delta : 1.345,\n    });\n\n    // Compute predictions and R^2 against actuals with guards for invalid values\n    const interceptSafe = Number.isFinite(intercept) ? intercept : 0;\n    // Build safe pairs for R^2\n    const xSafe: number[] = [];\n    const ySafe: number[] = [];\n    for (let i = 0; i < n; i++) {\n      const yi = y[i];\n      if (Number.isFinite(yi)) {\n        xSafe.push(x[i]);\n        ySafe.push(yi);\n      }\n    }\n    const m = xSafe.length;\n    const yPred: number[] = new Array(n);\n    for (let i = 0; i < n; i++) {\n      const xi = x[i];\n      const pred = (Number.isFinite(slope) ? slope * xi + interceptSafe : interceptSafe);\n      yPred[i] = Number.isFinite(pred) ? pred : 0;\n    }\n    let rSquared = 0;\n    if (m >= 2) {\n      const yMean = ySafe.reduce((a, b) => a + b, 0) / m;\n      let ssRes = 0;\n      let ssTot = 0;\n      for (let k = 0; k < m; k++) {\n        const idx = xSafe[k];\n        const resid = ySafe[k] - yPred[idx];\n        ssRes += resid * resid;\n        const dy = ySafe[k] - yMean;\n        ssTot += dy * dy;\n      }\n      rSquared = ssTot === 0 ? 0 : Math.max(0, Math.min(1, 1 - ssRes / ssTot));\n    }\n\n    // Time span and daily rate (safe timespan guards)\n    const timeSpanDays = differenceInDays(\n      sortedData[sortedData.length - 1].timestamp,\n      sortedData[0].timestamp\n    );\n    const safeTimeSpanDays = Math.max(1, timeSpanDays || 0);\n    const dailyRate = Number.isFinite(slope) ? slope * (n / safeTimeSpanDays) : 0;\n    \n    // Data and timespan quality from configured targets\n    const pointsTarget = Number(enhancedAnalysis?.qualityTargets?.pointsTarget);\n    const timeSpanTarget = Number(enhancedAnalysis?.qualityTargets?.timeSpanDaysTarget);\n    const dataQuality = Number.isFinite(pointsTarget) && pointsTarget > 0 ? Math.min(1, n / pointsTarget) : 0;\n    const timeSpanQuality = Number.isFinite(timeSpanTarget) && timeSpanTarget > 0 ? Math.min(1, timeSpanDays / timeSpanTarget) : 0;\n    const patternStrength = Math.max(0, rSquared);\n    const enhancedConfidenceRaw = dataQuality * 0.3 + timeSpanQuality * 0.3 + patternStrength * 0.4;\n    const enhancedConfidence = Number.isFinite(enhancedConfidenceRaw) ? enhancedConfidenceRaw : 0;\n\n    // Determine direction using configured threshold\n    const threshold = Number(enhancedAnalysis?.trendThreshold) || 0;\n    const direction = Math.abs(dailyRate) < threshold ? 'stable' : dailyRate > 0 ? 'increasing' : 'decreasing';\n\n    // Forecasts (ensure finite values)\n    const lastPred = yPred[yPred.length - 1] ?? 0;\n    const slopeSafe = Number.isFinite(slope) ? slope : 0;\n    const next7 = lastPred + slopeSafe * (Number(timeWindows?.recentDataDays) || 7);\n    const next30 = lastPred + slopeSafe * (Number(timeWindows?.defaultAnalysisDays) || 30);\n\n    return {\n      metric: 'Overall Trend',\n      direction,\n      rate: Number.isFinite(dailyRate) ? dailyRate : 0,\n      significance: Number.isFinite(rSquared) ? rSquared : 0,\n      confidence: enhancedConfidence,\n      forecast: {\n        next7Days: Number.isFinite(next7) ? next7 : 0,\n        next30Days: Number.isFinite(next30) ? next30 : 0,\n        confidence: enhancedConfidence,\n      },\n    };\n  }\n\n  // Generate confidence explanation\n  generateConfidenceExplanation(\n    dataPoints: number,\n    timeSpanDays: number,\n    rSquared: number,\n    confidence: number\n  ): { level: 'low' | 'medium' | 'high'; explanation: string; factors: string[] } {\n    // Capture config snapshot once per operation\n    const cfgAny: any = analyticsConfig as any;\n    const cfg = typeof cfgAny.get === 'function' ? cfgAny.get() : analyticsConfig.getConfig();\n    const { enhancedAnalysis, timeWindows, insights, patternAnalysis } = cfg || {} as any;\n\n    const factors: string[] = [];\n    let explanation = '';\n    let level: 'low' | 'medium' | 'high' = 'low';\n\n    // Minimum sample size factor (guard missing config)\n    if (typeof enhancedAnalysis?.minSampleSize === 'number') {\n      if (dataPoints < enhancedAnalysis.minSampleSize) {\n        factors.push(`insufficientData:${dataPoints}:${enhancedAnalysis.minSampleSize}`);\n      } else {\n        // Include a positive factor documenting threshold used\n        factors.push(`sufficientData:${dataPoints}:${enhancedAnalysis.minSampleSize}`);\n      }\n    }\n\n    // Time window factor: compare against shortTermDays, label with defaultAnalysisDays if available\n    if (typeof timeWindows?.shortTermDays === 'number') {\n      const defaultDays = typeof timeWindows?.defaultAnalysisDays === 'number' ? timeWindows.defaultAnalysisDays : undefined;\n      if (timeSpanDays < timeWindows.shortTermDays) {\n        factors.push(\n          defaultDays != null\n            ? `shortTimespan:${timeSpanDays}:${defaultDays}`\n            : `shortTimespan:${timeSpanDays}`\n        );\n      } else {\n        factors.push(\n          defaultDays != null\n            ? `adequateTimespan:${timeSpanDays}:${defaultDays}`\n            : `adequateTimespan:${timeSpanDays}`\n        );\n      }\n    }\n\n    // rSquared strength bands using configured significance thresholds (guard missing)\n    const sig = enhancedAnalysis?.correlationSignificance;\n    if (sig && typeof sig.low === 'number' && typeof sig.moderate === 'number' && typeof sig.high === 'number') {\n      if (rSquared < sig.low) {\n        factors.push(`weakPattern:${rSquared.toFixed(3)}:low=${sig.low}`);\n      } else if (rSquared >= sig.high) {\n        factors.push(`strongPattern:${rSquared.toFixed(3)}:high=${sig.high}`);\n      } else if (rSquared >= sig.moderate) {\n        factors.push(`moderatePattern:${rSquared.toFixed(3)}:moderate=${sig.moderate}`);\n      } else {\n        factors.push(`lowPattern:${rSquared.toFixed(3)}:low=${sig.low}`);\n      }\n    } else {\n      // Fallback to legacy correlationThreshold if available\n      if (typeof patternAnalysis?.correlationThreshold === 'number') {\n        const corrT = patternAnalysis.correlationThreshold;\n        const strongCut = Math.max(0.7, corrT + 0.4);\n        if (rSquared < corrT) {\n          factors.push(`weakPattern:${rSquared.toFixed(3)}:ct=${corrT}`);\n        } else if (rSquared > strongCut) {\n          factors.push(`strongPattern:${rSquared.toFixed(3)}:ct=${corrT}`);\n        } else {\n          factors.push(`moderatePattern:ct=${corrT}`);\n        }\n      } else {\n        // No threshold available; avoid bold claims\n        factors.push('moderatePattern');\n      }\n    }\n\n    // Determine overall level and explanation using insights.HIGH_CONFIDENCE_PATTERN_THRESHOLD\n    if (typeof insights?.HIGH_CONFIDENCE_PATTERN_THRESHOLD === 'number') {\n      const highT = insights.HIGH_CONFIDENCE_PATTERN_THRESHOLD;\n      const medT = highT - 0.2;\n      if (confidence >= highT) {\n        level = 'high';\n        // Prefer \"excellentData\" when rSquared exceeds strong band; else \"reliableInsight\"\n        if (typeof patternAnalysis?.correlationThreshold === 'number') {\n          const corrT = patternAnalysis.correlationThreshold;\n          const strongCut = Math.max(0.7, corrT + 0.4);\n          explanation = rSquared > strongCut ? 'excellentData' : 'reliableInsight';\n        } else {\n          explanation = 'reliableInsight';\n        }\n      } else if (confidence >= medT) {\n        level = 'medium';\n        explanation = 'emergingTrend';\n      } else {\n        level = 'low';\n        explanation = 'needMoreData';\n      }\n    } else {\n      // Missing threshold -> minimal/confidently safe output\n      level = 'low';\n      explanation = 'needMoreData';\n    }\n\n    return { level, explanation, factors };\n  }\n\n  // Anomaly Detection using Statistical Methods\n  detectAnomalies(\n    emotions: EmotionEntry[],\n    sensoryInputs: SensoryEntry[],\n    trackingEntries: TrackingEntry[]\n  ): AnomalyDetection[] {\n    // Capture config snapshot once per operation\n    const cfgAny: any = analyticsConfig as any;\n    const cfg = typeof cfgAny.get === 'function' ? cfgAny.get() : analyticsConfig.getConfig();\n    const { enhancedAnalysis, alertSensitivity } = cfg;\n\n    const anomalies: AnomalyDetection[] = [];\n\n    // Emotion intensity anomalies\n    const emotionIntensities = emotions.map(e => e.intensity);\n\n    // Apply anomaly sensitivity multiplier (base threshold)\n    const anomalyThreshold = enhancedAnalysis.anomalyThreshold * alertSensitivity.anomalyMultiplier;\n    const severityLevels = enhancedAnalysis.anomalySeverityLevels || { medium: 2.5, high: 3.0 };\n\n    const zEmotion = zScoresMedian(emotionIntensities);\n\n    emotions.forEach((emotion, idx) => {\n      const zScore = Math.abs(zEmotion[idx] ?? 0);\n      if (zScore > anomalyThreshold) {\n        const severity: 'low' | 'medium' | 'high' =\n          zScore >= severityLevels.high ? 'high' : zScore >= severityLevels.medium ? 'medium' : 'low';\n        anomalies.push({\n          timestamp: emotion.timestamp,\n          type: 'emotion',\n          severity,\n          description: `Unusual ${emotion.emotion} intensity detected (${emotion.intensity}/5)`,\n          deviationScore: zScore,\n          recommendations: this.getAnomalyRecommendations('emotion', emotion.emotion, zScore)\n        });\n      }\n    });\n\n    // Sensory frequency anomalies\n    const dailySensoryCounts = this.groupSensoryByDay(sensoryInputs);\n    const counts = Object.values(dailySensoryCounts);\n    if (counts.length > 0) {\n      const zCounts = zScoresMedian(counts);\n      const dates = Object.keys(dailySensoryCounts);\n\n      dates.forEach((date, idx) => {\n        const count = dailySensoryCounts[date];\n        const zScore = Math.abs(zCounts[idx] ?? 0);\n        if (zScore > anomalyThreshold) {\n          const severity: 'low' | 'medium' | 'high' =\n            zScore >= severityLevels.high ? 'high' : zScore >= severityLevels.medium ? 'medium' : 'low';\n          anomalies.push({\n            timestamp: new Date(date),\n            type: 'sensory',\n            severity,\n            description: `Unusual sensory activity level detected (${count} inputs)`,\n            deviationScore: zScore,\n            recommendations: this.getAnomalyRecommendations('sensory', 'frequency', zScore)\n          });\n        }\n      });\n    }\n\n    return anomalies.sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime());\n  }\n\n  // Comprehensive Correlation Matrix\n  generateCorrelationMatrix(trackingEntries: TrackingEntry[]): CorrelationMatrix {\n    // Capture config snapshot once per operation\n    const cfgAny: any = analyticsConfig as any;\n    const cfg = typeof cfgAny.get === 'function' ? cfgAny.get() : analyticsConfig.getConfig();\n    const { enhancedAnalysis, patternAnalysis, taxonomy } = cfg;\n\n    const factors = [\n      'avgEmotionIntensity',\n      'positiveEmotionRatio',\n      'sensorySeekingRatio',\n      'noiseLevel',\n      'temperature',\n      'lightingQuality'\n    ];\n\n    // Build positive emotion lookup from taxonomy (case-insensitive)\n    const positiveSet = new Set((taxonomy?.positiveEmotions || []).map(e => e.toLowerCase()));\n\n    const dataPoints = trackingEntries.map(entry => ({\n      avgEmotionIntensity: entry.emotions.length > 0 \n        ? entry.emotions.reduce((sum, e) => sum + e.intensity, 0) / entry.emotions.length \n        : 0,\n      positiveEmotionRatio: entry.emotions.length > 0\n        ? entry.emotions.filter(e => positiveSet.has(e.emotion.toLowerCase())).length / entry.emotions.length\n        : 0,\n      sensorySeekingRatio: entry.sensoryInputs.length > 0\n        ? entry.sensoryInputs.filter(s => s.response.toLowerCase().includes('seeking')).length / entry.sensoryInputs.length\n        : 0,\n      noiseLevel: entry.environmentalData?.roomConditions?.noiseLevel || 0,\n      temperature: entry.environmentalData?.roomConditions?.temperature || 0,\n      lightingQuality: this.convertLightingToNumeric(entry.environmentalData?.roomConditions?.lighting)\n    }));\n\n    const matrix: number[][] = [];\n    const significantPairs: CorrelationMatrix['significantPairs'] = [];\n\n    // Significance thresholds from config with safe fallbacks\n    const sig = enhancedAnalysis?.correlationSignificance;\n    const baseThreshold = Math.max(0, Math.min(1, (sig?.low ?? patternAnalysis.correlationThreshold ?? 0.3)));\n    const moderateCut = Math.max(baseThreshold, Math.min(1, sig?.moderate ?? (baseThreshold + 0.2)));\n    const highCut = Math.max(moderateCut, Math.min(1, sig?.high ?? (baseThreshold + 0.4)));\n\n    factors.forEach((factor1, i) => {\n      matrix[i] = [];\n      factors.forEach((factor2, j) => {\n        // Build paired arrays guarding index alignment and validity\n        const x: number[] = [];\n        const y: number[] = [];\n        for (let k = 0; k < dataPoints.length; k++) {\n          const dv = dataPoints[k] as any;\n          const v1 = dv[factor1];\n          const v2 = dv[factor2];\n          if (typeof v1 === 'number' && Number.isFinite(v1) && typeof v2 === 'number' && Number.isFinite(v2)) {\n            x.push(v1);\n            y.push(v2);\n          }\n        }\n\n        const nPairs = x.length;\n        const correlation = pearsonCorrelation(x, y);\n        matrix[i][j] = correlation;\n\n        // Significance gate uses |r| >= baseThreshold and minimum sample size from enhancedAnalysis\n        if (i < j && Math.abs(correlation) >= baseThreshold && nPairs >= enhancedAnalysis.minSampleSize) {\n          const pValue = pValueForCorrelation(correlation, nPairs);\n          const absR = Math.abs(correlation);\n          const significance: 'low' | 'moderate' | 'high' =\n            absR >= highCut ? 'high' : absR >= moderateCut ? 'moderate' : 'low';\n\n          significantPairs.push({\n            factor1,\n            factor2,\n            correlation,\n            pValue,\n            significance\n          });\n        }\n      });\n    });\n\n    return {\n      factors,\n      matrix,\n      significantPairs: significantPairs.sort((a, b) => Math.abs(b.correlation) - Math.abs(a.correlation))\n    };\n  }\n\n  // Helper Methods\n  private analyzeEmotionTrend(emotions: EmotionEntry[]): TrendAnalysis | null {\n    const emotionData = emotions.map(e => ({\n      value: e.intensity,\n      timestamp: e.timestamp\n    }));\n\n    return this.analyzeTrendsWithStatistics(emotionData);\n  }\n\n  private analyzeSensoryTrend(sensoryInputs: SensoryEntry[]): TrendAnalysis | null {\n    // Convert sensory responses to numeric values for trend analysis\n    const sensoryData = sensoryInputs.map(s => ({\n      value: s.response.toLowerCase().includes('seeking') ? 1 : \n             s.response.toLowerCase().includes('avoiding') ? -1 : 0,\n      timestamp: s.timestamp\n    }));\n\n    return this.analyzeTrendsWithStatistics(sensoryData);\n  }\n\n  private predictGoalAchievement(goal: Goal): PredictiveInsight | null {\n    if (!goal.dataPoints || goal.dataPoints.length < 3) return null;\n\n    const progressData = goal.dataPoints.map(dp => ({\n      value: dp.value,\n      timestamp: dp.timestamp\n    }));\n\n    const trend = this.analyzeTrendsWithStatistics(progressData);\n    if (!trend) return null;\n\n    const currentProgress = goal.dataPoints[goal.dataPoints.length - 1].value;\n    const targetValue = goal.targetValue;\n    const remainingProgress = targetValue - currentProgress;\n    const estimatedDays = trend.rate > 0 ? remainingProgress / trend.rate : -1;\n\n    return {\n      type: 'prediction',\n      title: `Goal Achievement Forecast: ${goal.title}`,\n      description: estimatedDays > 0 \n        ? `Estimated ${Math.ceil(estimatedDays)} days to achieve goal at current pace`\n        : 'Goal may require strategy adjustment based on current trend',\n      confidence: trend.significance,\n      timeframe: 'Goal completion forecast',\n      prediction: {\n        value: targetValue,\n        trend: trend.direction,\n        accuracy: trend.significance\n      },\n      recommendations: this.getGoalRecommendations(goal, trend, estimatedDays),\n      severity: estimatedDays < 0 ? 'high' : estimatedDays > 60 ? 'medium' : 'low'\n    };\n  }\n\n  private assessRisks(\n    emotions: EmotionEntry[],\n    sensoryInputs: SensoryEntry[],\n    trackingEntries: TrackingEntry[]\n  ): PredictiveInsight[] {\n    // Capture config snapshot once per operation (private helper still snapshots to avoid nested reads)\n    const cfgAny: any = analyticsConfig as any;\n    const cfg = typeof cfgAny.get === 'function' ? cfgAny.get() : analyticsConfig.getConfig();\n    const { timeWindows, enhancedAnalysis, alertSensitivity } = cfg;\n\n    const risks: PredictiveInsight[] = [];\n    const recentData = {\n      emotions: emotions.filter(e => e.timestamp >= subDays(new Date(), timeWindows.shortTermDays)),\n      sensoryInputs: sensoryInputs.filter(s => s.timestamp >= subDays(new Date(), timeWindows.shortTermDays)),\n      trackingEntries: trackingEntries.filter(t => t.timestamp >= subDays(new Date(), timeWindows.shortTermDays))\n    };\n\n    // Apply sensitivity multiplier for risk assessment\n    // Incidents threshold: prefer configured value if present; fallback to 3\n    const incidentsThreshold = Math.max(1, Math.floor((enhancedAnalysis as any)?.riskAssessmentThreshold ?? 3));\n\n    // High stress accumulation risk (use configured intensity and emotions)\n    const stressIntensityT = cfg?.enhancedAnalysis?.riskAssessment?.stressIntensityThreshold;\n    const stressEmotionsCfg = cfg?.enhancedAnalysis?.riskAssessment?.stressEmotions;\n    const stressEmotions = Array.isArray(stressEmotionsCfg) ? stressEmotionsCfg.map((e: string) => e.toLowerCase()) : [];\n\n    let highStressCount = 0;\n    if (typeof stressIntensityT === 'number' && stressEmotions.length > 0) {\n      highStressCount = recentData.emotions.filter(e =>\n        e.intensity >= stressIntensityT && stressEmotions.includes(e.emotion.toLowerCase())\n      ).length;\n    }\n\n    if (highStressCount >= incidentsThreshold && highStressCount > 0) {\n      risks.push({\n        type: 'risk',\n        title: 'Stress Accumulation Risk',\n        description: `${highStressCount} high-stress incidents in the past 2 weeks`,\n        confidence: 0.8,\n        timeframe: 'Immediate attention needed',\n        recommendations: [\n          'Implement immediate stress reduction strategies',\n          'Review and adjust current interventions',\n          'Consider environmental modifications',\n          'Schedule additional support sessions'\n        ],\n        severity: 'high'\n      });\n    }\n\n    return risks;\n  }\n\n  private groupSensoryByDay(sensoryInputs: SensoryEntry[]): Record<string, number> {\n    return sensoryInputs.reduce((acc, input) => {\n      const date = format(input.timestamp, 'yyyy-MM-dd');\n      acc[date] = (acc[date] || 0) + 1;\n      return acc;\n    }, {} as Record<string, number>);\n  }\n\n  private convertLightingToNumeric(lighting?: string): number {\n    const lightingMap: Record<string, number> = {\n      'dim': 1,\n      'normal': 2,\n      'bright': 3,\n      'fluorescent': 2.5,\n      'natural': 3.5\n    };\n    return lightingMap[lighting?.toLowerCase() || ''] || 2;\n  }\n\n  private getEmotionTrendRecommendations(trend: TrendAnalysis): string[] {\n    if (trend.direction === 'decreasing') {\n      return [\n        'Increase positive reinforcement strategies',\n        'Review environmental factors that may be contributing to stress',\n        'Consider additional sensory support tools',\n        'Schedule more frequent check-ins'\n      ];\n    } else if (trend.direction === 'increasing') {\n      return [\n        'Continue current successful strategies',\n        'Document what is working well',\n        'Gradually introduce new challenges',\n        'Share progress with student and family'\n      ];\n    }\n    return [\n      'Monitor for changes in patterns',\n      'Maintain current support level',\n      'Be prepared to adjust strategies as needed'\n    ];\n  }\n\n  private getSensoryTrendRecommendations(trend: TrendAnalysis): string[] {\n    if (trend.rate > 0) { // Increasing seeking\n      return [\n        'Provide more structured sensory breaks',\n        'Introduce additional sensory tools',\n        'Consider sensory diet adjustments',\n        'Monitor for overstimulation'\n      ];\n    } else if (trend.rate < 0) { // Increasing avoiding\n      return [\n        'Reduce environmental stimuli',\n        'Provide more quiet spaces',\n        'Gradually reintroduce sensory experiences',\n        'Focus on calming strategies'\n      ];\n    }\n    return [\n      'Maintain current sensory support level',\n      'Continue monitoring sensory preferences',\n      'Be responsive to daily variations'\n    ];\n  }\n\n  private getGoalRecommendations(goal: Goal, trend: TrendAnalysis, estimatedDays: number): string[] {\n    if (estimatedDays < 0) {\n      return [\n        'Review and adjust goal strategies',\n        'Break goal into smaller milestones',\n        'Identify and address barriers',\n        'Consider modifying timeline or approach'\n      ];\n    } else if (estimatedDays > 90) {\n      return [\n        'Increase intervention frequency',\n        'Add additional support strategies',\n        'Review goal expectations',\n        'Provide more immediate reinforcement'\n      ];\n    }\n    return [\n      'Continue current approach',\n      'Monitor progress regularly',\n      'Celebrate milestones reached',\n      'Maintain consistent support'\n    ];\n  }\n\n  private getAnomalyRecommendations(type: string, context: string, severity: number): string[] {\n    if (type === 'emotion') {\n      return [\n        'Investigate potential triggers for this emotional spike',\n        'Provide immediate support and coping strategies',\n        'Monitor closely for additional unusual patterns',\n        'Consider environmental or schedule changes'\n      ];\n    } else if (type === 'sensory') {\n      return [\n        'Review sensory environment for unusual factors',\n        'Check for changes in routine or schedule',\n        'Provide additional sensory regulation support',\n        'Monitor for illness or other physical factors'\n      ];\n    }\n    return [\n      'Investigate potential causes',\n      'Provide additional support',\n      'Monitor closely',\n      'Document and track patterns'\n    ];\n  }\n\n  private getTrendSeverity(trend: TrendAnalysis): 'low' | 'medium' | 'high' {\n    // Use configured significance bands; default to 0.7/0.5 if missing\n    const cfgAny: any = analyticsConfig as any;\n    const cfg = typeof cfgAny.get === 'function' ? cfgAny.get() : analyticsConfig.getConfig();\n    const bands = cfg?.enhancedAnalysis?.correlationSignificance;\n    const highT = typeof bands?.high === 'number' ? bands.high : 0.7;\n    const medT = typeof bands?.moderate === 'number' ? bands.moderate : 0.5;\n\n    if (trend.direction === 'decreasing' && trend.significance >= highT) return 'high';\n    if (trend.direction === 'decreasing' && trend.significance >= medT) return 'medium';\n    return 'low';\n  }\n\n  private getMLEmotionRecommendations(predictions: EmotionPrediction[], trend: string): string[] {\n    const highAnxietyDays = predictions.filter(p => p.emotions.anxious > 7).length;\n    const lowPositiveDays = predictions.filter(p => p.emotions.happy < 3 && p.emotions.calm < 3).length;\n\n    const recommendations: string[] = [];\n\n    if (highAnxietyDays >= 3) {\n      recommendations.push('ML predicts elevated anxiety - implement proactive calming strategies');\n      recommendations.push('Schedule additional check-ins on high-anxiety days');\n    }\n\n    if (lowPositiveDays >= 4) {\n      recommendations.push('ML indicates low positive emotions upcoming - increase engagement activities');\n      recommendations.push('Prepare mood-boosting interventions');\n    }\n\n    if (trend === 'increasing') {\n      recommendations.push('ML shows increasing emotional intensity - monitor for triggers');\n    } else if (trend === 'decreasing') {\n      recommendations.push('ML shows decreasing emotional engagement - check for withdrawal signs');\n    }\n\n    recommendations.push('Compare ML predictions with actual outcomes to refine models');\n\n    return recommendations;\n  }\n\n  private getMLSensoryRecommendations(prediction: SensoryPrediction): string[] {\n    const recommendations: string[] = [];\n\n    // Check each sensory modality\n    const cfgAny: any = analyticsConfig as any;\n    const cfg = typeof cfgAny.get === 'function' ? cfgAny.get() : analyticsConfig.getConfig();\n    const bands = cfg?.enhancedAnalysis?.correlationSignificance;\n    const highBand = typeof bands?.high === 'number' ? bands.high : 0.7;\n\n    Object.entries(prediction.sensoryResponse).forEach(([sense, response]) => {\n      if (response.avoiding > highBand) {\n        recommendations.push(`High ${sense} avoidance predicted - minimize ${sense} stimuli`);\n      } else if (response.seeking > highBand) {\n        recommendations.push(`High ${sense} seeking predicted - provide ${sense} input opportunities`);\n      }\n    });\n\n    // Environmental trigger recommendations\n    prediction.environmentalTriggers.forEach(trigger => {\n      if (trigger.probability > highBand) {\n        recommendations.push(`High probability of reaction to ${trigger.trigger} - prepare alternatives`);\n      }\n    });\n\n    return recommendations;\n  }\n\n  // Baseline analysis using ML clustering\n  async analyzeBaseline(trackingEntries: TrackingEntry[]): Promise<BaselineCluster[]> {\n    // Capture config snapshot once per operation (kept for parity/future use)\n    const cfgAny: any = analyticsConfig as any;\n    const cfg = typeof cfgAny.get === 'function' ? cfgAny.get() : analyticsConfig.getConfig();\n    const { enhancedAnalysis, patternAnalysis, timeWindows, alertSensitivity, analytics, insights, taxonomy } = cfg;\n\n    if (!this.mlModelsInitialized || trackingEntries.length < 10) {\n      return [];\n    }\n\n    try {\n      const clusters = await mlModels.performBaselineClustering(trackingEntries, 3);\n      return clusters;\n    } catch (error) {\n      logger.error('Baseline clustering failed:', error);\n      return [];\n    }\n  }\n}\n\nexport const enhancedPatternAnalysis = new EnhancedPatternAnalysisEngine();","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/env.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[91,94],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[91,94],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[138,141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[138,141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[226,229],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[226,229],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[499,502],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[499,502],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[897,900],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[897,900],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1149,1152],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1149,1152],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1350,1353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1350,1353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1589,1592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1589,1592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":67,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1905,1908],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1905,1908],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2265,2268],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2265,2268],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2546,2549],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2546,2549],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2946,2949],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2946,2949],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":118,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3397,3400],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3397,3400],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":132,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3886,3889],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3886,3889],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":143,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4229,4232],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4229,4232],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Shared environment helpers\n */\nexport const POC_MODE: boolean = (\n  (import.meta as any)?.env?.MODE === 'poc' ||\n  (import.meta as any)?.env?.VITE_POC_MODE === 'true'\n);\n\nexport const IS_PROD: boolean = (import.meta as any)?.env?.PROD === true;\n\n/**\n * Debug flag to force-disable the analytics worker and use the fallback path.\n * Set VITE_DISABLE_ANALYTICS_WORKER to '1' | 'true' | 'yes'.\n */\nexport const DISABLE_ANALYTICS_WORKER: boolean = (() => {\n  try {\n    const v = ((import.meta as any)?.env?.VITE_DISABLE_ANALYTICS_WORKER ?? '').toString().toLowerCase();\n    return v === '1' || v === 'true' || v === 'yes';\n  } catch {\n    return false;\n  }\n})();\n\n/**\n * AI feature flags and configuration from environment.\n * Uses Vite's `import.meta.env` with safe parsing and sensible defaults.\n */\nexport const AI_ANALYSIS_ENABLED: boolean = (() => {\n  try {\n    const v = ((import.meta as any)?.env?.VITE_AI_ANALYSIS_ENABLED ?? '').toString().toLowerCase();\n    return v === '1' || v === 'true' || v === 'yes';\n  } catch {\n    return false;\n  }\n})();\n\nexport const OPENROUTER_API_KEY: string = (() => {\n  try {\n    const v = (import.meta as any)?.env?.VITE_OPENROUTER_API_KEY;\n    return typeof v === 'string' ? v : '';\n  } catch {\n    return '';\n  }\n})();\n\nexport const AI_MODEL_NAME: string = (() => {\n  try {\n    const v = (import.meta as any)?.env?.VITE_AI_MODEL_NAME;\n    return typeof v === 'string' && v.trim().length > 0 ? v : 'gpt-4o-mini';\n  } catch {\n    return 'gpt-4o-mini';\n  }\n})();\n\nexport const AI_BASE_URL: string = (() => {\n  try {\n    const v = (import.meta as any)?.env?.VITE_AI_BASE_URL;\n    // Default to OpenRouter when unset\n    return typeof v === 'string' && v.trim().length > 0 ? v : 'https://openrouter.ai/api/v1';\n  } catch {\n    return 'https://openrouter.ai/api/v1';\n  }\n})();\n\nexport const AI_TEMPERATURE: number = (() => {\n  try {\n    const raw = (import.meta as any)?.env?.VITE_AI_TEMPERATURE;\n    const n = typeof raw === 'string' ? parseFloat(raw) : Number(raw);\n    if (Number.isFinite(n)) {\n      // clamp to [0,2] typical range\n      return Math.max(0, Math.min(2, n));\n    }\n    return 0.2;\n  } catch {\n    return 0.2;\n  }\n})();\n\nexport const AI_MAX_TOKENS: number = (() => {\n  try {\n    const raw = (import.meta as any)?.env?.VITE_AI_MAX_TOKENS;\n    const n = typeof raw === 'string' ? parseInt(raw, 10) : Number(raw);\n    return Number.isFinite(n) && n > 0 ? n : 1024;\n  } catch {\n    return 1024;\n  }\n})();\n\nexport const AI_LOCAL_ONLY: boolean = (() => {\n  try {\n    const v = ((import.meta as any)?.env?.VITE_AI_LOCAL_ONLY ?? '').toString().toLowerCase();\n    return v === '1' || v === 'true' || v === 'yes';\n  } catch {\n    return false;\n  }\n})();\n\n/**\n * UI flag: enable the redesigned explanation interface (tabs + composer v2).\n * Set VITE_EXPLANATION_V2 to '1' | 'true' | 'yes' to enable.\n */\nexport const EXPLANATION_V2_ENABLED: boolean = (() => {\n  try {\n    const v = ((import.meta as any)?.env?.VITE_EXPLANATION_V2 ?? '').toString().toLowerCase();\n    return v === '1' || v === 'true' || v === 'yes';\n  } catch {\n    return false;\n  }\n})();\n\n/**\n * Evidence injection toggle for AI analysis.\n * Set VITE_AI_EVIDENCE_DISABLED to '1' | 'true' | 'yes' to disable injecting external evidence context.\n * Defaults to false (evidence enabled).\n */\nexport const AI_EVIDENCE_DISABLED: boolean = (() => {\n  try {\n    const v = ((import.meta as any)?.env?.VITE_AI_EVIDENCE_DISABLED ?? '').toString().toLowerCase();\n    return v === '1' || v === 'true' || v === 'yes';\n  } catch {\n    return false;\n  }\n})();\n\n/**\n * Logging configuration from environment.\n * - VITE_LOG_LEVEL: 'debug' | 'info' | 'warn' | 'error' | 'none'\n * - VITE_DEBUG: '1' | 'true' | 'yes' enables verbose debug logging in dev\n */\nexport const LOG_LEVEL_NAME: 'debug' | 'info' | 'warn' | 'error' | 'none' | null = (() => {\n  try {\n    const raw = ((import.meta as any)?.env?.VITE_LOG_LEVEL ?? '').toString().toLowerCase().trim();\n    if (!raw) return null;\n    if (raw === 'debug' || raw === 'info' || raw === 'warn' || raw === 'error' || raw === 'none') return raw;\n    return null;\n  } catch {\n    return null;\n  }\n})();\n\nexport const DEBUG_MODE: boolean = (() => {\n  try {\n    const v = ((import.meta as any)?.env?.VITE_DEBUG ?? '').toString().toLowerCase();\n    return v === '1' || v === 'true' || v === 'yes';\n  } catch {\n    return false;\n  }\n})();\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/errorHandler.ts","messages":[{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":43,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":46,"endColumn":7},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":49,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":52,"endColumn":7}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { toast } from 'sonner';\nimport { logger } from './logger';\nimport {\n  AppError,\n  ErrorType,\n  SensoryCompassError,\n  isAppError,\n  isSensoryCompassError,\n  ErrorRecoveryStrategy,\n  storageQuotaRecoveryStrategy,\n} from '@/types/errors';\n\nexport interface ErrorHandlerOptions {\n  showToast?: boolean;\n  logError?: boolean;\n  throwError?: boolean;\n  onError?: (error: AppError) => void;\n  onRetry?: () => void | Promise<void>;\n}\n\nclass ErrorHandler {\n  private static instance: ErrorHandler;\n  private recoveryStrategies: ErrorRecoveryStrategy[] = [\n    storageQuotaRecoveryStrategy,\n  ];\n  private errorQueue: AppError[] = [];\n  private isProcessing = false;\n\n  private constructor() {\n    // Set up global error handlers\n    this.setupGlobalHandlers();\n  }\n\n  static getInstance(): ErrorHandler {\n    if (!ErrorHandler.instance) {\n      ErrorHandler.instance = new ErrorHandler();\n    }\n    return ErrorHandler.instance;\n  }\n\n  private setupGlobalHandlers() {\n    // Handle unhandled promise rejections\n    window.addEventListener('unhandledrejection', (event) => {\n      event.preventDefault();\n      this.handle(event.reason);\n    });\n\n    // Handle global errors\n    window.addEventListener('error', (event) => {\n      event.preventDefault();\n      this.handle(event.error);\n    });\n  }\n\n  /**\n   * Register a recovery strategy\n   */\n  registerRecoveryStrategy(strategy: ErrorRecoveryStrategy) {\n    this.recoveryStrategies.push(strategy);\n  }\n\n  /**\n   * Main error handling method\n   */\n  async handle(error: unknown, options: ErrorHandlerOptions = {}): Promise<void> {\n    const {\n      showToast = true,\n      logError = true,\n      throwError = false,\n      onError,\n    } = options;\n\n    // Convert to AppError if needed\n    const appError = this.normalizeError(error);\n\n    // Add to error queue\n    this.errorQueue.push(appError);\n\n    // Log the error\n    if (logError) {\n      this.logError(appError);\n    }\n\n    // Show toast notification\n    if (showToast) {\n      this.showErrorToast(appError, options);\n    }\n\n    // Call custom error handler\n    if (onError) {\n      try {\n        onError(appError);\n      } catch (callbackError) {\n        logger.error('Error in custom error handler', callbackError);\n      }\n    }\n\n    // Process error queue (including recovery attempts)\n    await this.processErrorQueue();\n\n    // Re-throw if requested\n    if (throwError) {\n      throw appError;\n    }\n  }\n\n  /**\n   * Convert various error types to AppError\n   */\n  private normalizeError(error: unknown): AppError {\n    // Already an AppError\n    if (isAppError(error)) {\n      return error;\n    }\n\n    // SensoryCompassError\n    if (isSensoryCompassError(error)) {\n      return error;\n    }\n\n    // Standard Error\n    if (error instanceof Error) {\n      return new SensoryCompassError(\n        ErrorType.UNKNOWN_ERROR,\n        error.message,\n        {\n          cause: error,\n          details: { originalError: error },\n        }\n      );\n    }\n\n    // String error\n    if (typeof error === 'string') {\n      return new SensoryCompassError(ErrorType.UNKNOWN_ERROR, error);\n    }\n\n    // Unknown error type\n    return new SensoryCompassError(\n      ErrorType.UNKNOWN_ERROR,\n      'An unknown error occurred',\n      {\n        details: { originalError: error },\n      }\n    );\n  }\n\n  /**\n   * Log error with appropriate level\n   */\n  private logError(error: AppError) {\n    const logData = {\n      type: error.type,\n      code: error.code,\n      message: error.message,\n      details: error.details,\n      timestamp: error.timestamp,\n      recoverable: error.recoverable,\n      stack: error.stack,\n    };\n\n    // Log based on error severity\n    switch (error.type) {\n      case ErrorType.DATA_CORRUPTED:\n      case ErrorType.UNAUTHORIZED:\n        logger.error('Critical error occurred', logData);\n        break;\n      case ErrorType.NETWORK_ERROR:\n      case ErrorType.TIMEOUT_ERROR:\n        logger.warn('Network error occurred', logData);\n        break;\n      default:\n        logger.error('Application error', logData);\n    }\n  }\n\n  /**\n   * Show user-friendly error toast\n   */\n  private showErrorToast(error: AppError, options?: ErrorHandlerOptions) {\n    const { userMessage, recoverable } = error;\n\n    toast.error(userMessage || 'An error occurred', {\n      description: recoverable\n        ? 'The application will attempt to recover automatically.'\n        : 'Please refresh the page or contact support if the issue persists.',\n      duration: recoverable ? 5000 : 10000,\n      action: recoverable\n        ? {\n            label: 'Retry',\n            onClick: async () => {\n              try {\n                if (options?.onRetry) {\n                  await options.onRetry();\n                } else {\n                  await this.attemptRecovery(error);\n                }\n              } catch (e) {\n                logger.error('Retry handler failed', e as Error);\n              }\n            },\n          }\n        : {\n            label: 'Refresh',\n            onClick: () => window.location.reload(),\n          },\n    });\n  }\n\n  /**\n   * Process queued errors and attempt recovery\n   */\n  private async processErrorQueue() {\n    if (this.isProcessing || this.errorQueue.length === 0) {\n      return;\n    }\n\n    this.isProcessing = true;\n\n    while (this.errorQueue.length > 0) {\n      const error = this.errorQueue.shift()!;\n      await this.attemptRecovery(error);\n    }\n\n    this.isProcessing = false;\n  }\n\n  /**\n   * Attempt to recover from an error\n   */\n  private async attemptRecovery(error: AppError): Promise<boolean> {\n    if (!error.recoverable) {\n      return false;\n    }\n\n    // Find applicable recovery strategies\n    const applicableStrategies = this.recoveryStrategies.filter((strategy) =>\n      strategy.canRecover(error)\n    );\n\n    // Attempt recovery with each strategy\n    for (const strategy of applicableStrategies) {\n      try {\n        await strategy.recover(error);\n        toast.success('Issue resolved', {\n          description: 'The application has recovered from the error.',\n        });\n        return true;\n      } catch (recoveryError) {\n        logger.error('Recovery strategy failed', {\n          strategy,\n          originalError: error,\n          recoveryError,\n        });\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Clear error queue\n   */\n  clearErrorQueue() {\n    this.errorQueue = [];\n  }\n\n  /**\n   * Get current error queue\n   */\n  getErrorQueue(): ReadonlyArray<AppError> {\n    return [...this.errorQueue];\n  }\n}\n\n// Export singleton instance\nexport const errorHandler = ErrorHandler.getInstance();\n\n// Convenience functions\nexport const handleError = (\n  error: unknown,\n  options?: ErrorHandlerOptions\n): Promise<void> => {\n  return errorHandler.handle(error, options);\n};\n\nexport const handleValidationError = (\n  field: string,\n  value: unknown,\n  reason: string,\n  options?: ErrorHandlerOptions\n): Promise<void> => {\n  const error = new SensoryCompassError(\n    ErrorType.DATA_VALIDATION,\n    `Validation failed for ${field}: ${reason}`,\n    {\n      code: 'VALIDATION_ERROR',\n      details: { field, value, reason },\n      userMessage: `Invalid ${field}: ${reason}`,\n      recoverable: true,\n    }\n  );\n  return errorHandler.handle(error, options);\n};\n\nexport const handleStorageError = (\n  operation: string,\n  cause?: Error,\n  options?: ErrorHandlerOptions\n): Promise<void> => {\n  const isQuotaError = cause?.name === 'QuotaExceededError';\n  const error = new SensoryCompassError(\n    isQuotaError ? ErrorType.STORAGE_QUOTA_EXCEEDED : ErrorType.STORAGE_UNAVAILABLE,\n    `Storage operation '${operation}' failed`,\n    {\n      code: isQuotaError ? 'QUOTA_EXCEEDED' : 'STORAGE_ERROR',\n      cause,\n      recoverable: isQuotaError,\n    }\n  );\n  return errorHandler.handle(error, options);\n};\n\nexport const handleAnalyticsError = (\n  message: string,\n  details?: unknown,\n  options?: ErrorHandlerOptions\n): Promise<void> => {\n  const error = new SensoryCompassError(\n    ErrorType.ANALYTICS_PROCESSING_ERROR,\n    message,\n    {\n      code: 'ANALYTICS_ERROR',\n      details,\n      recoverable: true,\n    }\n  );\n  return errorHandler.handle(error, options);\n};\n\n// React error boundary integration\nexport const handleErrorBoundaryError = (\n  error: Error,\n  errorInfo: React.ErrorInfo\n): void => {\n  const appError = new SensoryCompassError(\n    ErrorType.UNKNOWN_ERROR,\n    `React component error: ${error.message}`,\n    {\n      code: 'REACT_ERROR',\n      details: {\n        componentStack: errorInfo.componentStack,\n        errorBoundary: true,\n      },\n      cause: error,\n      recoverable: false,\n    }\n  );\n\n  errorHandler.handle(appError, {\n    showToast: true,\n    logError: true,\n    throwError: false,\n  });\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/evidence/evidenceBuilder.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1110,1113],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1110,1113],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2281,2284],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2281,2284],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2306,2309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2306,2309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { EmotionEntry, SensoryEntry, TrackingEntry } from '@/types/student';\n\nexport type EvidenceItem = {\n  id: string;\n  kind: 'emotion' | 'sensory' | 'tracking';\n  timestamp: string; // ISO\n  description: string;\n  metrics?: Record<string, number>;\n  tags?: string[];\n};\n\nexport type AllowedContexts = {\n  places: string[];\n  activities: string[];\n  triggers: string[];\n};\n\nexport function computeAllowedContexts(args: {\n  entries: TrackingEntry[];\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n}): AllowedContexts {\n  const placeSet = new Set<string>();\n  const activitySet = new Set<string>();\n  const triggerSet = new Set<string>();\n\n  for (const e of args.entries) {\n    const loc = e.environmentalData?.location?.trim();\n    if (loc) placeSet.add(loc.toLowerCase());\n    const act = e.environmentalData?.classroom?.activity?.toString().trim();\n    if (act) activitySet.add(act.toLowerCase());\n  }\n  for (const s of args.sensoryInputs) {\n    const loc = s.location?.trim();\n    if (loc) placeSet.add(loc.toLowerCase());\n  }\n  for (const em of args.emotions) {\n    const triggers = (em as any)?.triggers as string[] | undefined;\n    if (Array.isArray(triggers)) {\n      for (const t of triggers) {\n        const v = (t || '').trim();\n        if (v) triggerSet.add(v.toLowerCase());\n      }\n    }\n  }\n  return {\n    places: Array.from(placeSet).slice(0, 16),\n    activities: Array.from(activitySet).slice(0, 16),\n    triggers: Array.from(triggerSet).slice(0, 24),\n  };\n}\n\nexport function buildEvidenceForPattern(args: {\n  entries: TrackingEntry[];\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  limit?: number;\n}): EvidenceItem[] {\n  const items: EvidenceItem[] = [];\n  const limit = Math.max(1, Math.min(12, args.limit ?? 6));\n\n  // Pick most recent high-intensity emotions\n  const recentEmotions = [...args.emotions]\n    .filter((e) => typeof e.intensity === 'number')\n    .sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime())\n    .slice(0, limit);\n  for (const e of recentEmotions) {\n    items.push({\n      id: `emotion:${e.id}`,\n      kind: 'emotion',\n      timestamp: e.timestamp.toISOString(),\n      description: `${e.emotion} intensitet ${e.intensity}`,\n      metrics: { intensity: e.intensity },\n      tags: Array.isArray((e as any)?.triggers) ? ((e as any).triggers as string[]) : undefined,\n    });\n  }\n\n  // Recent sensory items\n  const recentSensory = [...args.sensoryInputs]\n    .sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime())\n    .slice(0, Math.max(0, limit - items.length));\n  for (const s of recentSensory) {\n    items.push({\n      id: `sensory:${s.id}`,\n      kind: 'sensory',\n      timestamp: s.timestamp.toISOString(),\n      description: `${s.sensoryType || s.type || 'sensorisk'} → ${s.response}`,\n      metrics: typeof s.intensity === 'number' ? { intensity: s.intensity } : undefined,\n      tags: s.location ? [s.location] : undefined,\n    });\n  }\n\n  // Include recent tracking entries that indicate social/structured activity\n  const socialRe = /(group|team|class|klasse|klasserom|student|peer|friminutt|pause|lunsj|kantine|transition|overgang|present|diskusjon|samarbeid|konflikt)/i;\n  const trackingSorted = [...args.entries].sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime());\n  for (const t of trackingSorted) {\n    if (items.length >= limit) break;\n    const act = t.environmentalData?.classroom?.activity?.toString() || '';\n    const soc = t.environmentalData?.socialContext || '';\n    const note = t.notes || t.generalNotes || '';\n    const text = `${act} ${soc} ${note}`;\n    if (socialRe.test(text)) {\n      items.push({\n        id: `tracking:${t.id}`,\n        kind: 'tracking',\n        timestamp: t.timestamp.toISOString(),\n        description: `${act || soc || 'aktivitet'} · ${note || 'sosial kontekst'}`.trim(),\n        tags: [act, soc].filter(Boolean) as string[],\n      });\n    }\n  }\n\n  // Fallback: include 1 generic tracking entry for context\n  if (items.length === 0 && args.entries.length > 0) {\n    const t = args.entries[args.entries.length - 1];\n    items.push({\n      id: `tracking:${t.id}`,\n      kind: 'tracking',\n      timestamp: t.timestamp.toISOString(),\n      description: 'Sammendrag fra registrering',\n    });\n  }\n\n  return items;\n}\n\nexport function sanitizePlainNorwegian(text: string, allowed: AllowedContexts): string {\n  const noMarkdown = text.replace(/[*`_#>]+/g, '');\n  const forbiddenTokens = [\n    'klasserom', 'skolen', 'skole', 'hjemme', 'huset', 'ute', 'barnehage', 'SFO', 'AKS',\n  ].filter((tok) => !allowed.places.includes(tok));\n  let sanitized = noMarkdown;\n  for (const tok of forbiddenTokens) {\n    const re = new RegExp(`(^|\\\\s)${tok}(en|et|et|)`, 'ig');\n    sanitized = sanitized.replace(re, '$1ikke logget sted');\n  }\n  // Collapse multiple spaces/newlines and normalize bullets to hyphens\n  sanitized = sanitized.replace(/[•·]/g, '-').replace(/\\s{2,}/g, ' ').replace(/\\n{3,}/g, '\\n\\n');\n  return sanitized.trim();\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/evidence/index.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EvidenceSourceId' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used. Allowed unused caught errors must match /^_/u.","line":42,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { EvidenceSource, EvidenceSourceId } from \"./types\";\nimport { ZEvidenceSource } from \"./types\";\nexport type { EvidenceSource, EvidenceSourceId } from \"./types\";\n\nlet cachedSources: ReadonlyArray<Readonly<EvidenceSource>> | null = null;\nlet cachePromise: Promise<ReadonlyArray<Readonly<EvidenceSource>>> | null = null;\n\n// Test seam: allow injecting a provider for the JSON data during tests\nlet evidenceJsonProvider: null | (() => Promise<unknown>) = null;\n\nexport function __setEvidenceJsonProvider(provider: null | (() => Promise<unknown>)): void {\n  evidenceJsonProvider = provider;\n  // Reset caches to ensure deterministic behavior when provider changes in tests\n  cachedSources = null;\n  cachePromise = null;\n}\n\nfunction freezeSources(items: EvidenceSource[]): ReadonlyArray<Readonly<EvidenceSource>> {\n  const frozenItems = items.map((item) => {\n    const frozenTags = Object.freeze([...(item.tags ?? [])]) as ReadonlyArray<EvidenceSource[\"tags\"][number]>;\n    const frozenGradeBands = item.gradeBands\n      ? (Object.freeze([...(item.gradeBands)]) as ReadonlyArray<NonNullable<EvidenceSource[\"gradeBands\"]>[number]>)\n      : undefined;\n    const frozen: EvidenceSource = {\n      ...item,\n      tags: frozenTags as unknown as EvidenceSource[\"tags\"],\n      gradeBands: frozenGradeBands as unknown as EvidenceSource[\"gradeBands\"],\n    };\n    return Object.freeze(frozen);\n  });\n  return Object.freeze(frozenItems) as ReadonlyArray<Readonly<EvidenceSource>>;\n}\n\nasync function fetchAndValidateJson(): Promise<EvidenceSource[]> {\n  const moduleOrData = evidenceJsonProvider\n    ? await evidenceJsonProvider()\n    : await import(\"@/lib/evidence/ebpSources.json\");\n  const raw = (moduleOrData as unknown as { default?: unknown }).default ?? (moduleOrData as unknown as unknown);\n  try {\n    const data = ZEvidenceSource.array().parse(raw);\n    return data as EvidenceSource[];\n  } catch (e) {\n    throw new Error(\"Invalid evidence sources JSON: validation failed\");\n  }\n}\n\nfunction cloneForCaller(items: ReadonlyArray<Readonly<EvidenceSource>>): EvidenceSource[] {\n  return items.map((s) => ({\n    ...s,\n    tags: [...s.tags],\n    gradeBands: s.gradeBands ? [...s.gradeBands] : undefined,\n  }));\n}\n\nexport async function loadEvidenceSources(): Promise<EvidenceSource[]> {\n  if (cachedSources) return cloneForCaller(cachedSources);\n  if (!cachePromise) {\n    cachePromise = (async () => {\n      const sources = await fetchAndValidateJson();\n      const frozen = freezeSources(sources);\n      cachedSources = frozen; // cache only on success\n      return frozen;\n    })();\n  }\n  try {\n    const frozen = await cachePromise;\n    return cloneForCaller(frozen);\n  } catch (_err) {\n    return [];\n  } finally {\n    cachePromise = null;\n  }\n}\n\nexport async function resolveSources(ids: string[]): Promise<EvidenceSource[]> {\n  if (!ids || ids.length === 0) return [];\n  const all = await loadEvidenceSources();\n  // Build case-insensitive index from cached data to ensure consistent lookups\n  const index = new Map<string, EvidenceSource>();\n  for (const s of all) {\n    index.set(s.id.toLowerCase(), s);\n  }\n  const seen = new Set<string>();\n  const resolved: EvidenceSource[] = [];\n  for (const id of ids) {\n    const key = String(id).toLowerCase();\n    if (seen.has(key)) continue;\n    seen.add(key);\n    const found = index.get(key);\n    if (found) {\n      // Return a defensive copy per item\n      resolved.push({\n        ...found,\n        tags: [...found.tags],\n        gradeBands: found.gradeBands ? [...found.gradeBands] : undefined,\n      });\n    }\n  }\n  return resolved;\n}\n\nexport { selectEvidence } from './select';\nexport type { ScoredSource } from './select';\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/evidence/select.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/evidence/types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/evidence/validation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/explanations/sourceUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/exportSystem.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CSVParseResult' is defined but never used. Allowed unused vars must match /^_/u.","line":41,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ExportDataCollection' is defined but never used. Allowed unused vars must match /^_/u.","line":47,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":47,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Student, TrackingEntry, EmotionEntry, SensoryEntry, Goal } from \"@/types/student\";\nimport { format } from \"date-fns\";\n\n// Report content structure for PDF generation\ninterface ReportContent {\n  header: {\n    title: string;\n    dateRange: string;\n    generatedDate: string;\n    studentInfo: {\n      name: string;\n      grade?: string;\n      id: string;\n    };\n  };\n  summary: {\n    totalSessions: number;\n    totalEmotions: number;\n    totalSensoryInputs: number;\n    activeGoals: number;\n    completedGoals: number;\n  };\n  emotionAnalysis: {\n    mostCommon: string;\n    avgIntensity: string;\n    positiveRate: string;\n  };\n  sensoryAnalysis: {\n    seekingRatio: string;\n    mostCommonType: string;\n  };\n  goalProgress: Array<{\n    title: string;\n    progress: number;\n    status: string;\n  }>;\n  recommendations: string[];\n}\n\n// CSV parsing result\ninterface CSVParseResult {\n  id: string;\n  [key: string]: unknown;\n}\n\n// Data collections for export\ninterface ExportDataCollection {\n  trackingEntries: TrackingEntry[];\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  goals: Goal[];\n}\n\nexport interface ExportOptions {\n  format: 'pdf' | 'csv' | 'json';\n  includeFields: string[];\n  dateRange?: {\n    start: Date;\n    end: Date;\n  };\n  groupBy?: 'student' | 'date' | 'goal';\n  includeCharts?: boolean;\n  anonymize?: boolean;\n}\n\nexport interface BackupData {\n  version: string;\n  timestamp: Date;\n  students: Student[];\n  trackingEntries: TrackingEntry[];\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  goals: Goal[];\n  metadata: {\n    exportedBy: string;\n    totalRecords: number;\n    dateRange: {\n      earliest: Date;\n      latest: Date;\n    };\n  };\n}\n\nclass ExportSystem {\n  private readonly CURRENT_VERSION = '1.0.0';\n\n  // PDF Generation\n  async generatePDFReport(\n    student: Student,\n    data: {\n      trackingEntries: TrackingEntry[];\n      emotions: EmotionEntry[];\n      sensoryInputs: SensoryEntry[];\n      goals: Goal[];\n    },\n    options: ExportOptions\n  ): Promise<Blob> {\n    // Create a virtual document structure for PDF generation\n    const reportContent = this.buildReportContent(student, data, options);\n    \n    // For now, create a simple HTML-based report that can be printed to PDF\n    const htmlContent = this.generateHTMLReport(reportContent, options);\n    \n    // Convert to blob for download\n    return new Blob([htmlContent], { type: 'text/html' });\n  }\n\n  // CSV Export\n  generateCSVExport(\n    students: Student[],\n    allData: {\n      trackingEntries: TrackingEntry[];\n      emotions: EmotionEntry[];\n      sensoryInputs: SensoryEntry[];\n      goals: Goal[];\n    },\n    options: ExportOptions\n  ): string {\n    const { includeFields, dateRange, anonymize } = options;\n    let csvContent = '';\n\n    if (includeFields.includes('emotions')) {\n      const emotionData = this.filterByDateRange(allData.emotions, dateRange);\n      csvContent += this.generateEmotionsCSV(emotionData, students, anonymize);\n      csvContent += '\\n\\n';\n    }\n\n    if (includeFields.includes('sensoryInputs')) {\n      const sensoryData = this.filterByDateRange(allData.sensoryInputs, dateRange);\n      csvContent += this.generateSensoryCSV(sensoryData, students, anonymize);\n      csvContent += '\\n\\n';\n    }\n\n    if (includeFields.includes('goals')) {\n      csvContent += this.generateGoalsCSV(allData.goals, students, anonymize);\n      csvContent += '\\n\\n';\n    }\n\n    if (includeFields.includes('trackingEntries')) {\n      const trackingData = this.filterByDateRange(allData.trackingEntries, dateRange);\n      csvContent += this.generateTrackingCSV(trackingData, students, anonymize);\n    }\n\n    return csvContent;\n  }\n\n  // JSON Export with Full Data Structure\n  generateJSONExport(\n    students: Student[],\n    allData: {\n      trackingEntries: TrackingEntry[];\n      emotions: EmotionEntry[];\n      sensoryInputs: SensoryEntry[];\n      goals: Goal[];\n    },\n    options: ExportOptions\n  ): string {\n    const { includeFields, dateRange, anonymize } = options;\n    \n    interface JSONExportData {\n      version: string;\n      exportDate: string;\n      options: ExportOptions;\n      data: {\n        students?: Student[];\n        emotions?: EmotionEntry[];\n        sensoryInputs?: SensoryEntry[];\n        goals?: Goal[];\n        trackingEntries?: TrackingEntry[];\n      };\n    }\n\n    const exportData: JSONExportData = {\n      version: this.CURRENT_VERSION,\n      exportDate: new Date().toISOString(),\n      options,\n      data: {}\n    };\n\n    if (includeFields.includes('students')) {\n      exportData.data.students = anonymize \n        ? students.map(s => this.anonymizeStudent(s))\n        : students;\n    }\n\n    if (includeFields.includes('emotions')) {\n      const emotionData = this.filterByDateRange(allData.emotions, dateRange);\n      exportData.data.emotions = anonymize \n        ? emotionData.map(e => this.anonymizeEmotion(e))\n        : emotionData;\n    }\n\n    if (includeFields.includes('sensoryInputs')) {\n      const sensoryData = this.filterByDateRange(allData.sensoryInputs, dateRange);\n      exportData.data.sensoryInputs = anonymize \n        ? sensoryData.map(s => this.anonymizeSensory(s))\n        : sensoryData;\n    }\n\n    if (includeFields.includes('goals')) {\n      exportData.data.goals = anonymize \n        ? allData.goals.map(g => this.anonymizeGoal(g))\n        : allData.goals;\n    }\n\n    if (includeFields.includes('trackingEntries')) {\n      const trackingData = this.filterByDateRange(allData.trackingEntries, dateRange);\n      exportData.data.trackingEntries = anonymize \n        ? trackingData.map(t => this.anonymizeTracking(t))\n        : trackingData;\n    }\n\n    return JSON.stringify(exportData, null, 2);\n  }\n\n  // Backup System\n  createFullBackup(\n    students: Student[],\n    allData: {\n      trackingEntries: TrackingEntry[];\n      emotions: EmotionEntry[];\n      sensoryInputs: SensoryEntry[];\n      goals: Goal[];\n    }\n  ): BackupData {\n    const dates = [\n      ...allData.trackingEntries.map(t => t.timestamp),\n      ...allData.emotions.map(e => e.timestamp),\n      ...allData.sensoryInputs.map(s => s.timestamp)\n    ].sort((a, b) => a.getTime() - b.getTime());\n\n    return {\n      version: this.CURRENT_VERSION,\n      timestamp: new Date(),\n      students,\n      trackingEntries: allData.trackingEntries,\n      emotions: allData.emotions,\n      sensoryInputs: allData.sensoryInputs,\n      goals: allData.goals,\n      metadata: {\n        exportedBy: 'Kreativium',\n        totalRecords: allData.trackingEntries.length + allData.emotions.length + allData.sensoryInputs.length + allData.goals.length,\n        dateRange: {\n          earliest: dates[0] || new Date(),\n          latest: dates[dates.length - 1] || new Date()\n        }\n      }\n    };\n  }\n\n  // Restore from Backup\n  async restoreFromBackup(backupData: BackupData): Promise<{\n    success: boolean;\n    errors: string[];\n    imported: {\n      students: number;\n      trackingEntries: number;\n      emotions: number;\n      sensoryInputs: number;\n      goals: number;\n    };\n  }> {\n    const errors: string[] = [];\n    const imported = {\n      students: 0,\n      trackingEntries: 0,\n      emotions: 0,\n      sensoryInputs: 0,\n      goals: 0\n    };\n\n    try {\n      // Validate backup version compatibility\n      if (!this.isVersionCompatible(backupData.version)) {\n        errors.push(`Backup version ${backupData.version} is not compatible with current version ${this.CURRENT_VERSION}`);\n        return { success: false, errors, imported };\n      }\n\n      // Import data with validation\n      const validationResults = await this.validateBackupData(backupData);\n      if (validationResults.errors.length > 0) {\n        errors.push(...validationResults.errors);\n      }\n\n      // Import valid data\n      imported.students = validationResults.validStudents.length;\n      imported.trackingEntries = validationResults.validTrackingEntries.length;\n      imported.emotions = validationResults.validEmotions.length;\n      imported.sensoryInputs = validationResults.validSensoryInputs.length;\n      imported.goals = validationResults.validGoals.length;\n\n      return {\n        success: errors.length === 0,\n        errors,\n        imported\n      };\n\n    } catch (error) {\n      errors.push(`Restore failed: ${error instanceof Error ? error.message : 'Unknown error'}`);\n      return { success: false, errors, imported };\n    }\n  }\n\n  // Import from CSV\n  async importFromCSV(csvContent: string, dataType: 'emotions' | 'sensoryInputs' | 'students'): Promise<{\n    success: boolean;\n    errors: string[];\n    imported: (EmotionEntry | SensoryEntry | Student)[];\n  }> {\n    const errors: string[] = [];\n    const imported: (EmotionEntry | SensoryEntry | Student)[] = [];\n\n    try {\n      const lines = csvContent.split('\\n').filter(line => line.trim() !== '');\n      if (lines.length < 2) {\n        errors.push('CSV file must contain at least a header row and one data row');\n        return { success: false, errors, imported };\n      }\n\n      const headers = this.parseCSVLine(lines[0]);\n      const requiredHeaders = this.getRequiredHeaders(dataType);\n      \n      // Validate headers\n      const missingHeaders = requiredHeaders.filter(h => !headers.includes(h));\n      if (missingHeaders.length > 0) {\n        errors.push(`Missing required headers: ${missingHeaders.join(', ')}`);\n        return { success: false, errors, imported };\n      }\n\n      // Parse data rows\n      for (let i = 1; i < lines.length; i++) {\n        try {\n          const values = this.parseCSVLine(lines[i]);\n          if (values.length !== headers.length) {\n            errors.push(`Row ${i + 1}: Column count mismatch`);\n            continue;\n          }\n\n          const rowData = this.parseCSVRowData(headers, values, dataType);\n          if (rowData) {\n            imported.push(rowData);\n          }\n        } catch (error) {\n          errors.push(`Row ${i + 1}: ${error instanceof Error ? error.message : 'Parse error'}`);\n        }\n      }\n\n      return {\n        success: imported.length > 0,\n        errors,\n        imported\n      };\n\n    } catch (error) {\n      errors.push(`Import failed: ${error instanceof Error ? error.message : 'Unknown error'}`);\n      return { success: false, errors, imported };\n    }\n  }\n\n  // Helper Methods\n  private buildReportContent(\n    student: Student,\n    data: {\n      trackingEntries: TrackingEntry[];\n      emotions: EmotionEntry[];\n      sensoryInputs: SensoryEntry[];\n      goals: Goal[];\n    },\n    options: ExportOptions\n  ) {\n    return {\n      header: {\n        title: `Progress Report - ${student.name}`,\n        dateRange: options.dateRange ? \n          `${format(options.dateRange.start, 'MMM dd, yyyy')} - ${format(options.dateRange.end, 'MMM dd, yyyy')}` :\n          'All time',\n        generatedDate: format(new Date(), 'MMM dd, yyyy'),\n        studentInfo: {\n          name: student.name,\n          grade: student.grade,\n          id: student.id\n        }\n      },\n      summary: {\n        totalSessions: data.trackingEntries.length,\n        totalEmotions: data.emotions.length,\n        totalSensoryInputs: data.sensoryInputs.length,\n        activeGoals: data.goals.filter(g => g.status === 'active').length,\n        completedGoals: data.goals.filter(g => g.status === 'achieved').length\n      },\n      emotionAnalysis: this.analyzeEmotionsForReport(data.emotions),\n      sensoryAnalysis: this.analyzeSensoryForReport(data.sensoryInputs),\n      goalProgress: this.analyzeGoalsForReport(data.goals),\n      recommendations: this.generateRecommendations(data)\n    };\n  }\n\n  private generateHTMLReport(content: ReportContent, options: ExportOptions): string {\n    return `\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>${content.header.title}</title>\n    <style>\n        body { \n            font-family: 'Arial', sans-serif; \n            line-height: 1.6; \n            margin: 40px; \n            color: #333;\n        }\n        .header { \n            border-bottom: 2px solid #2563eb; \n            padding-bottom: 20px; \n            margin-bottom: 30px; \n        }\n        .section { \n            margin-bottom: 30px; \n            page-break-inside: avoid; \n        }\n        .summary-grid { \n            display: grid; \n            grid-template-columns: repeat(2, 1fr); \n            gap: 20px; \n            margin: 20px 0; \n        }\n        .summary-card { \n            border: 1px solid #e5e7eb; \n            padding: 15px; \n            border-radius: 8px; \n        }\n        .chart-placeholder { \n            height: 200px; \n            background: #f9fafb; \n            border: 1px dashed #d1d5db; \n            display: flex; \n            align-items: center; \n            justify-content: center; \n            margin: 20px 0; \n        }\n        @media print {\n            body { margin: 20px; }\n            .section { page-break-inside: avoid; }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"header\">\n        <h1>${content.header.title}</h1>\n        <p><strong>Period:</strong> ${content.header.dateRange}</p>\n        <p><strong>Generated:</strong> ${content.header.generatedDate}</p>\n        <p><strong>Student ID:</strong> ${content.header.studentInfo.id}</p>\n        ${content.header.studentInfo.grade ? `<p><strong>Grade:</strong> ${content.header.studentInfo.grade}</p>` : ''}\n    </div>\n\n    <div class=\"section\">\n        <h2>Summary</h2>\n        <div class=\"summary-grid\">\n            <div class=\"summary-card\">\n                <h3>Tracking Sessions</h3>\n                <p style=\"font-size: 24px; font-weight: bold;\">${content.summary.totalSessions}</p>\n            </div>\n            <div class=\"summary-card\">\n                <h3>Emotions Recorded</h3>\n                <p style=\"font-size: 24px; font-weight: bold;\">${content.summary.totalEmotions}</p>\n            </div>\n            <div class=\"summary-card\">\n                <h3>Sensory Inputs</h3>\n                <p style=\"font-size: 24px; font-weight: bold;\">${content.summary.totalSensoryInputs}</p>\n            </div>\n            <div class=\"summary-card\">\n                <h3>Active Goals</h3>\n                <p style=\"font-size: 24px; font-weight: bold;\">${content.summary.activeGoals}</p>\n            </div>\n        </div>\n    </div>\n\n    <div class=\"section\">\n        <h2>Emotional Analysis</h2>\n        <p><strong>Most Common Emotion:</strong> ${content.emotionAnalysis.mostCommon}</p>\n        <p><strong>Average Intensity:</strong> ${content.emotionAnalysis.avgIntensity}</p>\n        <p><strong>Positive Emotion Rate:</strong> ${content.emotionAnalysis.positiveRate}%</p>\n        ${options.includeCharts ? '<div class=\"chart-placeholder\">Emotion Trends Chart</div>' : ''}\n    </div>\n\n    <div class=\"section\">\n        <h2>Sensory Analysis</h2>\n        <p><strong>Seeking vs Avoiding:</strong> ${content.sensoryAnalysis.seekingRatio}% seeking</p>\n        <p><strong>Most Common Type:</strong> ${content.sensoryAnalysis.mostCommonType}</p>\n        ${options.includeCharts ? '<div class=\"chart-placeholder\">Sensory Patterns Chart</div>' : ''}\n    </div>\n\n    <div class=\"section\">\n        <h2>Goal Progress</h2>\n        ${content.goalProgress.map((goal) => `\n            <div style=\"margin-bottom: 15px;\">\n                <h3>${goal.title}</h3>\n                <p><strong>Progress:</strong> ${goal.progress}% complete</p>\n                <p><strong>Status:</strong> ${goal.status}</p>\n            </div>\n        `).join('')}\n    </div>\n\n    <div class=\"section\">\n        <h2>Recommendations</h2>\n        <ul>\n            ${content.recommendations.map((rec: string) => `<li>${rec}</li>`).join('')}\n        </ul>\n    </div>\n</body>\n</html>\n    `;\n  }\n\n  private generateEmotionsCSV(emotions: EmotionEntry[], students: Student[], anonymize: boolean): string {\n    let csv = 'Date,Student,Emotion,Intensity,Triggers,Notes\\n';\n    \n    emotions.forEach(emotion => {\n      const student = students.find(s => s.id === emotion.studentId);\n      const studentName = anonymize ? `Student_${emotion.studentId.slice(-4)}` : (student?.name || 'Unknown');\n      \n      csv += `${format(emotion.timestamp, 'yyyy-MM-dd HH:mm')},`;\n      csv += `\"${studentName}\",`;\n      csv += `\"${emotion.emotion}\",`;\n      csv += `${emotion.intensity},`;\n      csv += `\"${emotion.triggers?.join('; ') || ''}\",`;\n      csv += `\"${emotion.notes || ''}\"\\n`;\n    });\n\n    return csv;\n  }\n\n  private generateSensoryCSV(sensoryInputs: SensoryEntry[], students: Student[], anonymize: boolean): string {\n    let csv = 'Date,Student,Sensory Type,Response,Intensity,Context,Notes\\n';\n    \n    sensoryInputs.forEach(sensory => {\n      const student = students.find(s => s.id === sensory.studentId);\n      const studentName = anonymize ? `Student_${sensory.studentId.slice(-4)}` : (student?.name || 'Unknown');\n      \n      csv += `${format(sensory.timestamp, 'yyyy-MM-dd HH:mm')},`;\n      csv += `\"${studentName}\",`;\n      csv += `\"${sensory.sensoryType}\",`;\n      csv += `\"${sensory.response}\",`;\n      csv += `${sensory.intensity},`;\n      csv += `\"${sensory.notes || ''}\",`;\n      csv += `\"${sensory.notes || ''}\"\\n`;\n    });\n\n    return csv;\n  }\n\n  private generateGoalsCSV(goals: Goal[], students: Student[], anonymize: boolean): string {\n    let csv = 'Student,Goal Title,Description,Target Value,Current Progress,Status,Date Created\\n';\n    \n    goals.forEach(goal => {\n      const student = students.find(s => s.id === goal.studentId);\n      const studentName = anonymize ? `Student_${goal.studentId.slice(-4)}` : (student?.name || 'Unknown');\n      \n      csv += `\"${studentName}\",`;\n      csv += `\"${goal.title}\",`;\n      csv += `\"${goal.description}\",`;\n      csv += `${goal.targetValue},`;\n      csv += `${goal.dataPoints?.length ? goal.dataPoints[goal.dataPoints.length - 1].value : 0},`;\n      csv += `\"${goal.status}\",`;\n      csv += `${format(goal.createdDate, 'yyyy-MM-dd')}\\n`;\n    });\n\n    return csv;\n  }\n\n  private generateTrackingCSV(trackingEntries: TrackingEntry[], students: Student[], anonymize: boolean): string {\n    let csv = 'Date,Student,Session Duration,Emotion Count,Sensory Count,Environmental Notes\\n';\n    \n    trackingEntries.forEach(entry => {\n      const student = students.find(s => s.id === entry.studentId);\n      const studentName = anonymize ? `Student_${entry.studentId.slice(-4)}` : (student?.name || 'Unknown');\n      \n      csv += `${format(entry.timestamp, 'yyyy-MM-dd HH:mm')},`;\n      csv += `\"${studentName}\",`;\n      csv += `60,`; // Default duration\n      csv += `${entry.emotions.length},`;\n      csv += `${entry.sensoryInputs.length},`;\n      csv += `\"${entry.environmentalData?.notes || ''}\"\\n`;\n    });\n\n    return csv;\n  }\n\n  private filterByDateRange<T extends { timestamp: Date }>(data: T[], dateRange?: { start: Date; end: Date }): T[] {\n    if (!dateRange) return data;\n    return data.filter(item => \n      item.timestamp >= dateRange.start && item.timestamp <= dateRange.end\n    );\n  }\n\n  private anonymizeStudent(student: Student): Student {\n    return {\n      ...student,\n      name: `Student_${student.id.slice(-4)}`,\n      dateOfBirth: undefined\n    };\n  }\n\n  private anonymizeEmotion(emotion: EmotionEntry): EmotionEntry {\n    return {\n      ...emotion,\n      studentId: emotion.studentId.slice(-4)\n    };\n  }\n\n  private anonymizeSensory(sensory: SensoryEntry): SensoryEntry {\n    return {\n      ...sensory,\n      studentId: sensory.studentId.slice(-4)\n    };\n  }\n\n  private anonymizeGoal(goal: Goal): Goal {\n    return {\n      ...goal,\n      studentId: goal.studentId.slice(-4)\n    };\n  }\n\n  private anonymizeTracking(tracking: TrackingEntry): TrackingEntry {\n    return {\n      ...tracking,\n      studentId: tracking.studentId.slice(-4)\n    };\n  }\n\n  private analyzeEmotionsForReport(emotions: EmotionEntry[]) {\n    if (emotions.length === 0) {\n      return {\n        mostCommon: 'No data',\n        avgIntensity: '0.0',\n        positiveRate: '0'\n      };\n    }\n\n    const emotionCounts = emotions.reduce((acc, e) => {\n      acc[e.emotion] = (acc[e.emotion] || 0) + 1;\n      return acc;\n    }, {} as Record<string, number>);\n\n    const mostCommon = Object.entries(emotionCounts)\n      .sort(([,a], [,b]) => b - a)[0][0];\n\n    const avgIntensity = (emotions.reduce((sum, e) => sum + e.intensity, 0) / emotions.length).toFixed(1);\n\n    const positiveEmotions = emotions.filter(e => \n      ['happy', 'calm', 'focused', 'excited', 'proud'].includes(e.emotion.toLowerCase())\n    ).length;\n    const positiveRate = Math.round((positiveEmotions / emotions.length) * 100);\n\n    return {\n      mostCommon,\n      avgIntensity,\n      positiveRate: positiveRate.toString()\n    };\n  }\n\n  private analyzeSensoryForReport(sensoryInputs: SensoryEntry[]) {\n    if (sensoryInputs.length === 0) {\n      return {\n        seekingRatio: '0',\n        mostCommonType: 'No data'\n      };\n    }\n\n    const seekingCount = sensoryInputs.filter(s => \n      s.response.toLowerCase().includes('seeking')\n    ).length;\n    const seekingRatio = Math.round((seekingCount / sensoryInputs.length) * 100);\n\n    const typeCounts = sensoryInputs.reduce((acc, s) => {\n      acc[s.sensoryType] = (acc[s.sensoryType] || 0) + 1;\n      return acc;\n    }, {} as Record<string, number>);\n\n    const mostCommonType = Object.entries(typeCounts)\n      .sort(([,a], [,b]) => b - a)[0][0];\n\n    return {\n      seekingRatio: seekingRatio.toString(),\n      mostCommonType\n    };\n  }\n\n  private analyzeGoalsForReport(goals: Goal[]) {\n    return goals.map(goal => ({\n      title: goal.title,\n      progress: Math.round(((goal.dataPoints?.length ? goal.dataPoints[goal.dataPoints.length - 1].value : 0) / goal.targetValue) * 100),\n      status: goal.status\n    }));\n  }\n\n  private generateRecommendations(data: {\n    trackingEntries: TrackingEntry[];\n    emotions: EmotionEntry[];\n    sensoryInputs: SensoryEntry[];\n    goals: Goal[];\n  }): string[] {\n    const recommendations: string[] = [];\n\n    // Basic recommendations based on data patterns\n    if (data.emotions.length > 0) {\n      const avgIntensity = data.emotions.reduce((sum: number, e: EmotionEntry) => sum + e.intensity, 0) / data.emotions.length;\n      if (avgIntensity > 7) {\n        recommendations.push('Consider implementing stress reduction strategies');\n      }\n    }\n\n    if (data.sensoryInputs.length > 0) {\n      const seekingRatio = data.sensoryInputs.filter((s: SensoryEntry) => \n        s.response.toLowerCase().includes('seeking')\n      ).length / data.sensoryInputs.length;\n      \n      if (seekingRatio > 0.7) {\n        recommendations.push('Provide more structured sensory breaks and tools');\n      }\n    }\n\n    if (recommendations.length === 0) {\n      recommendations.push('Continue current monitoring and support strategies');\n    }\n\n    return recommendations;\n  }\n\n  private isVersionCompatible(version: string): boolean {\n    // Simple version compatibility check\n    const [major] = version.split('.').map(Number);\n    const [currentMajor] = this.CURRENT_VERSION.split('.').map(Number);\n    return major <= currentMajor;\n  }\n\n  private async validateBackupData(backupData: BackupData) {\n    // Validate and return valid data\n    return {\n      validStudents: backupData.students || [],\n      validTrackingEntries: backupData.trackingEntries || [],\n      validEmotions: backupData.emotions || [],\n      validSensoryInputs: backupData.sensoryInputs || [],\n      validGoals: backupData.goals || [],\n      errors: [] as string[]\n    };\n  }\n\n  private getRequiredHeaders(dataType: string): string[] {\n    const headerMap = {\n      emotions: ['Date', 'Emotion', 'Intensity'],\n      sensoryInputs: ['Date', 'Sensory Type', 'Response', 'Intensity'],\n      students: ['Name', 'Grade']\n    };\n    return headerMap[dataType as keyof typeof headerMap] || [];\n  }\n\n  private parseCSVLine(line: string): string[] {\n    const result: string[] = [];\n    let current = '';\n    let inQuotes = false;\n\n    for (let i = 0; i < line.length; i++) {\n      const char = line[i];\n      if (char === '\"') {\n        inQuotes = !inQuotes;\n      } else if (char === ',' && !inQuotes) {\n        result.push(current.trim());\n        current = '';\n      } else {\n        current += char;\n      }\n    }\n    result.push(current.trim());\n    return result;\n  }\n\n  private parseCSVRowData(headers: string[], values: string[], dataType: string): EmotionEntry | SensoryEntry | Student | null {\n    const data: Record<string, string> = {};\n    headers.forEach((header, index) => {\n      data[header] = values[index];\n    });\n\n    // Basic data type conversion and validation\n    switch (dataType) {\n      case 'emotions':\n        return {\n          id: crypto.randomUUID(),\n          emotion: data.Emotion,\n          intensity: parseInt(data.Intensity) || 0,\n          timestamp: new Date(data.Date),\n          studentId: '', // Would need to be mapped\n          triggers: data.Triggers ? data.Triggers.split(';') : [],\n          notes: data.Notes || ''\n        };\n      case 'sensoryInputs':\n        return {\n          id: crypto.randomUUID(),\n          sensoryType: data['Sensory Type'],\n          response: data.Response,\n          intensity: parseInt(data.Intensity) || 0,\n          timestamp: new Date(data.Date),\n          studentId: '', // Would need to be mapped\n          context: data.Context || '',\n          notes: data.Notes || ''\n        };\n      case 'students':\n        return {\n          id: crypto.randomUUID(),\n          name: data.Name,\n          grade: data.Grade,\n          createdAt: new Date(),\n          goals: [],\n          baselineData: {\n            emotionalRegulation: 5,\n            sensoryProcessing: 5,\n            environmentalPreferences: {}\n          }\n        };\n      default:\n        return null;\n    }\n  }\n}\n\nexport const exportSystem = new ExportSystem();","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/exportTemplates.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2679,2682],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2679,2682],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { ExportTemplate, ChartQuality, ColorScheme } from '@/components/ExportDialog';\nimport { logger } from '@/lib/logger';\n\nexport interface LayoutConfig {\n  pageSize: 'a4' | 'letter';\n  orientation: 'portrait' | 'landscape';\n  margins: { top: number; bottom: number; left: number; right: number };\n  fontSize: { base: number; title: number; subtitle: number; caption: number };\n  chartSize: { width: number; height: number };\n  chartsPerPage: number;\n  includePageNumbers: boolean;\n  includeTimestamp: boolean;\n}\n\nexport interface ChartConfig {\n  dpi: number;\n  format: 'png' | 'svg';\n  backgroundColor: string;\n  colorPalette?: string[];\n}\n\n/**\n * Get layout configuration for a template\n */\nexport function getLayoutConfig(template: ExportTemplate): LayoutConfig {\n  const base: LayoutConfig = {\n    pageSize: 'a4',\n    orientation: 'portrait',\n    margins: { top: 20, bottom: 20, left: 20, right: 20 },\n    fontSize: { base: 10, title: 16, subtitle: 12, caption: 8 },\n    chartSize: { width: 500, height: 300 },\n    chartsPerPage: 2,\n    includePageNumbers: true,\n    includeTimestamp: true\n  };\n\n  switch (template) {\n    case 'summary':\n      return {\n        ...base,\n        chartSize: { width: 400, height: 250 },\n        chartsPerPage: 3,\n        fontSize: { ...base.fontSize, base: 9 }\n      };\n    \n    case 'presentation':\n      return {\n        ...base,\n        orientation: 'landscape',\n        chartSize: { width: 700, height: 400 },\n        chartsPerPage: 1,\n        fontSize: { base: 12, title: 20, subtitle: 14, caption: 10 }\n      };\n    \n    case 'detailed':\n    default:\n      return base;\n  }\n}\n\n/**\n * Get chart export configuration\n */\nexport function getChartConfig(quality: ChartQuality, scheme: ColorScheme): ChartConfig {\n  const base: ChartConfig = {\n    dpi: 150,\n    format: 'png',\n    backgroundColor: '#ffffff'\n  };\n\n  // Quality adjustments\n  switch (quality) {\n    case 'standard':\n      base.dpi = 96;\n      break;\n    case 'high':\n      base.dpi = 150;\n      break;\n    case 'print':\n      base.dpi = 300;\n      base.format = 'svg'; // Prefer vector for print\n      break;\n  }\n\n  // Color scheme adjustments\n  switch (scheme) {\n    case 'high-contrast':\n      base.colorPalette = ['#000000', '#ffffff', '#ff0000', '#0000ff', '#ffff00'];\n      break;\n    case 'colorblind-friendly':\n      // Using colorblind-safe palette from ColorBrewer\n      base.colorPalette = ['#1b9e77', '#d95f02', '#7570b3', '#e7298a', '#66a61e'];\n      break;\n    default:\n      // Default theme colors\n      break;\n  }\n\n  return base;\n}\n\n/**\n * Get accessible text alternatives for charts\n */\nexport function getChartA11yDescription(chartType: string, data: any): string {\n  try {\n    switch (chartType) {\n      case 'bar':\n        return `Bar chart showing ${data.title || 'data distribution'}. Highest value: ${data.maxValue}, lowest value: ${data.minValue}.`;\n      case 'line':\n        return `Line chart displaying ${data.title || 'trend over time'}. Trend: ${data.trend || 'varies'}.`;\n      case 'heatmap':\n        return `Heatmap visualization of ${data.title || 'correlations'}. Strongest correlation: ${data.strongestCorr || 'unknown'}.`;\n      default:\n        return `Chart visualization of ${data.title || 'analytics data'}.`;\n    }\n  } catch (e) {\n    logger.warn('Failed to generate a11y description', { error: e });\n    return 'Data visualization';\n  }\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/filterUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/formValidation.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/formValidation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/format.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/hash.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/inlineWorker.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnalyticsData' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnalyticsResults' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":41},{"ruleId":"no-restricted-syntax","severity":1,"message":"Worker instantiation should be managed through custom hooks with proper cleanup (worker.terminate()) to prevent memory leaks","line":35,"column":20,"nodeType":"NewExpression","messageId":"restrictedSyntax","endLine":35,"endColumn":41}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Alternative worker implementation using inline worker for better compatibility\nimport { AnalyticsData, AnalyticsResults } from '@/workers/analytics.worker';\nimport { logger } from './logger';\n\nconst workerCode = `\n  import { logger } from './logger.js';\n  \n  self.onmessage = async (e) => {\n    const data = e.data;\n    // Worker received message\n    \n    // Simple response for testing\n    const results = {\n      patterns: [],\n      correlations: [],\n      predictiveInsights: [],\n      anomalies: [],\n      insights: ['Worker is functioning correctly'],\n      cacheKey: data.cacheKey\n    };\n    \n    // Simulate some processing time\n    await new Promise(resolve => setTimeout(resolve, 100));\n    \n    self.postMessage(results);\n  };\n`;\n\nexport function createInlineWorker(): Worker | null {\n  let workerUrl: string | null = null;\n  \n  try {\n    const blob = new Blob([workerCode], { type: 'application/javascript' });\n    workerUrl = URL.createObjectURL(blob);\n    const worker = new Worker(workerUrl);\n    \n    // Clean up the URL after creating the worker\n    URL.revokeObjectURL(workerUrl);\n    \n    return worker;\n  } catch (error) {\n    // Ensure URL is cleaned up even if worker creation fails\n    if (workerUrl) {\n      URL.revokeObjectURL(workerUrl);\n    }\n    logger.error('Failed to create inline worker:', error as Error);\n    return null;\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/insights.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isWithinDays' is defined but never used. Allowed unused vars must match /^_/u.","line":27,"column":45,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":57},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3718,3721],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3718,3721],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":96,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3750,3753],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3750,3753],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":212,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":212,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8312,8315],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8312,8315],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":242,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":242,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9858,9861],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9858,9861],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":274,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":274,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11476,11479],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11476,11479],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":326,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":326,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13991,13994],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13991,13994],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":326,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":326,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14012,14015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14012,14015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":332,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":332,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14182,14185],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14182,14185],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":332,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":332,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14190,14193],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14190,14193],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":335,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":335,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14342,14345],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14342,14345],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Canonical insights and confidence logic\n *\n * This module is the single source of truth for:\n * - Confidence score calculation (calculateConfidence)\n * - Insights generation (generateInsights and worker adapter)\n *\n * Migration guidance\n * - analyticsManager.ts:\n *   Import { calculateConfidence, generateInsights } from '@/lib/insights'.\n *   If analyticsManager already fetched live config slices, pass them via the cfgParam\n *   arguments to avoid duplicate analyticsConfig.getConfig() calls.\n *\n * - analytics.worker.ts:\n *   Replace local insights computation with generateInsightsFromWorkerInputs.\n *   Prefer the canonical signature generateInsightsFromWorkerInputs(emotionPatterns,\n *   sensoryPatterns, correlations, { entries, emotions }). If existing code uses a\n *   different shape, map it to this canonical form, or use the legacy adapter signature\n *   temporarily.\n *\n * Future plan\n * - InsightOutput will migrate to StructuredInsight[] with i18n key mapping instead of\n *   free-form strings. Call sites should not rely on exact phrasing and should be ready\n *   to display localized messages based on keys.\n */\nimport { analyticsConfig, ANALYTICS_CONFIG } from '@/lib/analyticsConfig';\nimport { clamp01, round2, getLastTimestamp, isWithinDays } from '@/lib/utils';\nimport type { EmotionEntry, SensoryEntry, TrackingEntry } from '@/types/student';\nimport type { PatternResult, CorrelationResult } from '@/lib/patternAnalysis';\nimport type { InsightOutput, InsightConfig, ConfidenceConfig } from '@/types/insights';\n\n/**\n * Resolve effective confidence config, preferring live config and allowing an override.\n * Kept local here to avoid cross-file private helper imports.\n */\nfunction getEffectiveConfidenceConfig(cfgParam?: ConfidenceConfig): ConfidenceConfig {\n  if (cfgParam) return cfgParam;\n  try {\n    return analyticsConfig.getConfig()?.confidence || ANALYTICS_CONFIG.confidence;\n  } catch {\n    return ANALYTICS_CONFIG.confidence;\n  }\n}\n\n// Local helpers to mirror analytics configuration access\nfunction getEffectiveInsightsConfig(cfgParam?: InsightConfig): InsightConfig {\n  if (cfgParam) return cfgParam;\n  try {\n    return analyticsConfig.getConfig()?.insights || ANALYTICS_CONFIG.insights;\n  } catch {\n    return ANALYTICS_CONFIG.insights;\n  }\n}\nfunction getEffectiveFullConfig() {\n  try {\n    return analyticsConfig.getConfig() || (ANALYTICS_CONFIG as unknown);\n  } catch {\n    return ANALYTICS_CONFIG as unknown;\n  }\n}\n\n/**\n * calculateConfidence\n *\n * Purpose:\n * - Compute a normalized confidence score in [0, 1] using data sufficiency and recency.\n * - Mirrors analyticsManager behavior (weights plus optional recency boost with an\n *   effectively exclusive day window).\n *\n * Inputs:\n * - emotions: readonly EmotionEntry[] — emotion records.\n * - sensoryInputs: readonly SensoryEntry[] — sensory observations.\n * - trackingEntries: readonly TrackingEntry[] — session/entry records used for recency and sufficiency.\n * - cfgParam?: ConfidenceConfig — optional config slice to avoid extra config lookups.\n *\n * Returns:\n * - number — rounded to two decimals, clamped to [0, 1].\n *\n * Configuration resolution order:\n * 1) cfgParam if provided,\n * 2) analyticsConfig.getConfig(),\n * 3) ANALYTICS_CONFIG.\n *\n * Purity and non-mutation guarantees:\n * - This function is pure: no external side effects or global state writes.\n * - It does not mutate any of the input arrays or objects.\n */\nexport function calculateConfidence(\n  emotions: readonly EmotionEntry[],\n  sensoryInputs: readonly SensoryEntry[],\n  trackingEntries: readonly TrackingEntry[],\n  cfgParam?: ConfidenceConfig\n): number {\n  const cfg = getEffectiveConfidenceConfig(cfgParam);\n  const TH = cfg.THRESHOLDS as any;\n  const W = cfg.WEIGHTS as any;\n\n  // Support both *_COUNT and *_ENTRIES keys defensively\n  const emotionThreshold: number = TH.EMOTION_COUNT ?? TH.EMOTION_ENTRIES ?? 1;\n  const sensoryThreshold: number = TH.SENSORY_COUNT ?? TH.SENSORY_ENTRIES ?? 1;\n  const trackingThreshold: number = TH.TRACKING_COUNT ?? TH.TRACKING_ENTRIES ?? 1;\n\n  const wEmotion: number = W.EMOTIONS ?? W.EMOTION ?? 0;\n  const wSensory: number = W.SENSORY ?? 0;\n  const wTracking: number = W.TRACKING ?? 0;\n  const recencyBoostVal: number = W.RECENCY_BOOST ?? 0;\n\n  const e = Math.min(emotions.length / Math.max(1, emotionThreshold), 1) * wEmotion;\n  const s = Math.min(sensoryInputs.length / Math.max(1, sensoryThreshold), 1) * wSensory;\n  const t = Math.min(trackingEntries.length / Math.max(1, trackingThreshold), 1) * wTracking;\n\n  // Recency boost: strictly less than N days since last entry (exclusive boundary)\n  const lastTs = getLastTimestamp(trackingEntries);\n  const daysWindow: number = TH.DAYS_SINCE_LAST_ENTRY ?? 0;\n  const hasRecencyBoost = (() => {\n    if (lastTs == null || !Number.isFinite(daysWindow) || daysWindow <= 0) return false;\n    const nowTs = Date.now();\n    const MS_PER_DAY = 24 * 60 * 60 * 1000;\n    const diff = nowTs - lastTs;\n    if (diff < 0) return false;\n    // Use integer day difference to avoid DST/partial-day rounding issues\n    const dayDiff = Math.floor(diff / MS_PER_DAY);\n    return dayDiff < daysWindow; // strictly less than N days\n  })();\n\n  const total = clamp01(e + s + t + (hasRecencyBoost ? recencyBoostVal : 0));\n  return round2(total);\n}\n\n/**\n * generateInsights (overloaded)\n *\n * Purpose:\n * - Produce human-readable insights from pattern/correlation analysis and recent data.\n * - This is the canonical insights generator used by both the main thread and the worker.\n *\n * Signatures:\n * - New/canonical signature:\n *   generateInsights(results, emotions, trackingEntries, cfgParam?)\n *   where results = { patterns, correlations, predictiveInsights }\n *\n * - Legacy signature (backward compatibility):\n *   generateInsights(emotions, sensoryInputs, trackingEntries, patterns, correlations, config?)\n *\n * Inputs:\n * - For canonical: results, emotions, trackingEntries, cfgParam?\n * - For legacy: emotions, sensoryInputs, trackingEntries, patterns, correlations, config?\n *\n * Returns:\n * - InsightOutput — currently string[]; will migrate to StructuredInsight[].\n *\n * Configuration resolution order:\n * 1) cfgParam/config if provided,\n * 2) analyticsConfig.getConfig(),\n * 3) ANALYTICS_CONFIG.\n *\n * Purity and non-mutation guarantees:\n * - Pure and side-effect free; builds a new insights array without mutating inputs.\n * - Defensive .slice() copies are used in legacy paths to avoid accidental mutation.\n */\nexport function generateInsights(\n  results: {\n    patterns: PatternResult[];\n    correlations: CorrelationResult[];\n    predictiveInsights: Array<{ description: string; confidence: number }>;\n  },\n  emotions: readonly EmotionEntry[],\n  trackingEntries: readonly TrackingEntry[],\n  cfgParam?: InsightConfig\n): InsightOutput;\nexport function generateInsights(\n  emotions: ReadonlyArray<EmotionEntry>,\n  sensoryInputs: ReadonlyArray<SensoryEntry>,\n  trackingEntries: ReadonlyArray<TrackingEntry>,\n  patterns: ReadonlyArray<PatternResult>,\n  correlations: ReadonlyArray<CorrelationResult>,\n  config?: InsightConfig\n): InsightOutput;\n\nexport type StructuredInsight = { key: string; params?: Record<string, unknown> };\n\nexport function generateInsightsStructured(\n  results: {\n    patterns: PatternResult[];\n    correlations: CorrelationResult[];\n    predictiveInsights: Array<{ description: string; confidence: number }>;\n  },\n  emotions: readonly EmotionEntry[],\n  trackingEntries: readonly TrackingEntry[],\n  cfgParam?: InsightConfig\n): StructuredInsight[] {\n  const cfg = getEffectiveInsightsConfig(cfgParam);\n  const messages: StructuredInsight[] = [];\n\n  if (trackingEntries.length === 0) {\n    return [{ key: 'analytics.insights.messages.noTrackingData' }];\n  }\n\n  if (trackingEntries.length < cfg.MIN_SESSIONS_FOR_FULL_ANALYTICS) {\n    messages.push({ key: 'analytics.insights.messages.limitedData', params: { sessions: trackingEntries.length } });\n  }\n\n  results.patterns\n    .filter(p => p.confidence > cfg.HIGH_CONFIDENCE_PATTERN_THRESHOLD)\n    .slice(0, cfg.MAX_PATTERNS_TO_SHOW)\n    .forEach(pattern => messages.push({\n      key: 'analytics.insights.messages.patternDetected',\n      params: { description: pattern.description, confidencePct: Math.round(pattern.confidence * 100) }\n    }));\n\n  results.correlations\n    .filter(c => (c as any).significance === 'high')\n    .slice(0, cfg.MAX_CORRELATIONS_TO_SHOW)\n    .forEach(correlation => messages.push({ key: 'analytics.insights.messages.strongCorrelation', params: { description: correlation.description } }));\n\n  results.predictiveInsights\n    .slice(0, cfg.MAX_PREDICTIONS_TO_SHOW)\n    .forEach(pi => messages.push({ key: 'analytics.insights.messages.prediction', params: { description: pi.description, confidencePct: Math.round(pi.confidence * 100) } }));\n\n  if (emotions.length >= cfg.RECENT_EMOTION_COUNT) {\n    const recent = emotions.slice(-cfg.RECENT_EMOTION_COUNT);\n    // POSITIVE_EMOTIONS may be a Set<string>\n    const fullCfg = getEffectiveFullConfig() as typeof ANALYTICS_CONFIG;\n    const positiveSet: Set<string> = (fullCfg.POSITIVE_EMOTIONS ?? ANALYTICS_CONFIG.POSITIVE_EMOTIONS) as Set<string>;\n    const positives = recent.filter(e => positiveSet.has(e.emotion.toLowerCase())).length;\n    const positiveRate = positives / recent.length;\n    const pct = Math.round(positiveRate * 100);\n    if (positiveRate > cfg.POSITIVE_EMOTION_TREND_THRESHOLD) {\n      messages.push({ key: 'analytics.insights.messages.positiveTrend', params: { percentage: pct } });\n    } else if (positiveRate < cfg.NEGATIVE_EMOTION_TREND_THRESHOLD) {\n      messages.push({ key: 'analytics.insights.messages.negativeTrend', params: { percentage: pct } });\n    }\n  }\n\n  if (messages.length === 0) {\n    messages.push({ key: 'analytics.insights.messages.analyticsActive' });\n  }\n\n  return messages;\n}\n\nexport function generateInsights(...args: any[]): InsightOutput {\n  // Branch 1: New signature with results object first\n  if (args.length >= 3 && args[0] && typeof args[0] === 'object' && 'patterns' in args[0]) {\n    const results = args[0] as { patterns: PatternResult[]; correlations: CorrelationResult[]; predictiveInsights: Array<{ description: string; confidence: number }>; };\n    const emotions = args[1] as readonly EmotionEntry[];\n    const trackingEntries = args[2] as readonly TrackingEntry[];\n    const cfg = getEffectiveInsightsConfig(args[3] as InsightConfig | undefined);\n    const fullCfg = getEffectiveFullConfig() as typeof ANALYTICS_CONFIG; // For POSITIVE_EMOTIONS\n\n    // TODO: Map to i18n keys; keep verbatim strings to avoid UI diffs\n    const insights: string[] = [];\n\n    // Guard: no tracking data\n    if (trackingEntries.length === 0) {\n      return [\n        'No tracking data available yet. Start by creating your first tracking session to begin pattern analysis.'\n      ];\n    }\n\n    // Limited data notice\n    if (trackingEntries.length < cfg.MIN_SESSIONS_FOR_FULL_ANALYTICS) {\n      insights.push(`Limited data available (${trackingEntries.length} sessions). Analytics will improve as more data is collected.`);\n    }\n\n    // Patterns (match analyticsManager exact filter/format)\n    results.patterns\n      .filter(p => p.confidence > cfg.HIGH_CONFIDENCE_PATTERN_THRESHOLD)\n      .slice(0, cfg.MAX_PATTERNS_TO_SHOW)\n      .forEach(pattern => insights.push(`Pattern detected: ${pattern.description} (${Math.round(pattern.confidence * 100)}% confidence)`));\n\n    // Correlations\n    results.correlations\n      .filter(c => (c as any).significance === 'high')\n      .slice(0, cfg.MAX_CORRELATIONS_TO_SHOW)\n      .forEach(correlation => insights.push(`Strong correlation found: ${correlation.description}`));\n\n    // Predictive insights\n    results.predictiveInsights\n      .slice(0, cfg.MAX_PREDICTIONS_TO_SHOW)\n      .forEach(insight => insights.push(`Prediction: ${insight.description} (${Math.round(insight.confidence * 100)}% confidence)`));\n\n    // Emotion trend\n    if (emotions.length >= cfg.RECENT_EMOTION_COUNT) {\n      const recent = emotions.slice(-cfg.RECENT_EMOTION_COUNT);\n      const positiveSet: Set<string> = (fullCfg.POSITIVE_EMOTIONS ?? ANALYTICS_CONFIG.POSITIVE_EMOTIONS) as Set<string>;\n      const positives = recent.filter(e => positiveSet.has(e.emotion.toLowerCase())).length;\n      const positiveRate = positives / recent.length;\n      if (positiveRate > cfg.POSITIVE_EMOTION_TREND_THRESHOLD) {\n        insights.push(`Positive trend: ${Math.round(positiveRate * 100)}% of recent emotions have been positive.`);\n      } else if (positiveRate < cfg.NEGATIVE_EMOTION_TREND_THRESHOLD) {\n        insights.push(`Consider reviewing strategies - only ${Math.round(positiveRate * 100)}% of recent emotions have been positive.`);\n      }\n    }\n\n    // Ensure non-empty\n    if (insights.length === 0) {\n      insights.push('Analytics are active and monitoring patterns. Continue collecting data for more detailed insights.');\n    }\n\n    return insights;\n  }\n\n  // Branch 2: Legacy signature implementation (preserve existing behavior)\n  const emotions = args[0] as ReadonlyArray<EmotionEntry>;\n  const sensoryInputs = args[1] as ReadonlyArray<SensoryEntry>;\n  const trackingEntries = args[2] as ReadonlyArray<TrackingEntry>;\n  const patterns = args[3] as ReadonlyArray<PatternResult>;\n  const correlations = args[4] as ReadonlyArray<CorrelationResult>;\n  const cfg = (args[5] as InsightConfig | undefined) ?? analyticsConfig.getConfig().insights;\n\n  const insights: string[] = [];\n\n  // Data sufficiency\n  if (trackingEntries.length < cfg.MIN_SESSIONS_FOR_FULL_ANALYTICS) {\n    insights.push(`Limited data available (${trackingEntries.length} sessions). Continue collecting data for better insights.`);\n  }\n\n  // Highlight high-confidence patterns\n  const significantPatterns = patterns\n    .filter(p => p.confidence >= cfg.HIGH_CONFIDENCE_PATTERN_THRESHOLD)\n    .slice(0, cfg.MAX_PATTERNS_TO_SHOW);\n\n  significantPatterns.forEach(p => {\n    const pct = Math.round(p.confidence * 100);\n    insights.push(`Pattern detected (${(p as any).type}): ${(p as any).pattern} (${pct}% confidence). ${p.description}`);\n  });\n\n  // Summarize strongest correlations\n  const strongCorrelations = correlations\n    .slice()\n    .sort((a: any, b: any) => Math.abs((b.correlation as number) - (a.correlation as number)))\n    .slice(0, cfg.MAX_CORRELATIONS_TO_SHOW);\n\n  strongCorrelations.forEach((c: any) => {\n    insights.push(\n      `Correlation: ${c.factor1} ↔ ${c.factor2} (r=${typeof c.correlation === 'number' ? c.correlation.toFixed(2) : '0.00'}, ${c.significance}). ${c.description}`\n    );\n  });\n\n  // Simple recent emotion perspective\n  if (emotions.length > 0) {\n    const recent = emotions.slice(-Math.max(1, cfg.RECENT_EMOTION_COUNT));\n    const top = getTopCategory(recent.map(e => e.emotion.toLowerCase()));\n    if (top) {\n      insights.push(`Recent emotions most frequently observed: ${top.key} (${top.count} of last ${recent.length}).`);\n    }\n  }\n\n  // Sensory snapshot\n  if (sensoryInputs.length > 0) {\n    const recentSensory = sensoryInputs.slice(-Math.max(1, Math.min(10, sensoryInputs.length)));\n    const seeking = recentSensory.filter(s => s.response.toLowerCase().includes('seeking')).length;\n    const avoiding = recentSensory.filter(s => s.response.toLowerCase().includes('avoiding')).length;\n    if (seeking > avoiding && seeking > 0) {\n      insights.push('Recent sensory pattern leans toward seeking behavior. Consider structured sensory breaks.');\n    } else if (avoiding > seeking && avoiding > 0) {\n      insights.push('Recent sensory pattern shows avoidance. Provide access to low-stimulation spaces.');\n    }\n  }\n\n  // Ensure bounded size\n  return insights.slice(0, Math.max(cfg.MAX_PATTERNS_TO_SHOW, cfg.MAX_CORRELATIONS_TO_SHOW, cfg.MAX_PREDICTIONS_TO_SHOW, 5));\n}\n\n/**\n * generateInsightsFromWorkerInputs (overloaded)\n *\n * Purpose:\n * - Worker-friendly adapter that funnels inputs into the canonical generateInsights API.\n * - Provides both the recommended canonical signature and a legacy object-based signature\n *   to ease migration inside analytics.worker.ts.\n *\n * Canonical signature (recommended):\n *   generateInsightsFromWorkerInputs(emotionPatterns, sensoryPatterns, correlations, { entries, emotions })\n *   - Non-mutating composition of patterns: [...emotionPatterns, ...sensoryPatterns]\n *   - Calls generateInsights(results, emotions, entries)\n *\n * Legacy signature:\n *   generateInsightsFromWorkerInputs({ patterns?, correlations?, emotions?, sensoryInputs?, trackingEntries? }, { insightConfig? })\n *   - Preserves existing worker behavior; will be removed after migration.\n *\n * Returns:\n * - InsightOutput — currently string[].\n *\n * Configuration resolution order:\n * - Same as generateInsights. If overrides.insightConfig is provided, it takes precedence.\n *\n * Purity and non-mutation guarantees:\n * - Pure function: does not mutate provided arrays/objects and has no side effects.\n */\nexport function generateInsightsFromWorkerInputs(\n  emotionPatterns: PatternResult[],\n  sensoryPatterns: PatternResult[],\n  correlations: CorrelationResult[],\n  data: { entries: TrackingEntry[]; emotions: EmotionEntry[] }\n): InsightOutput;\nexport function generateInsightsFromWorkerInputs(\n  input: {\n    patterns?: ReadonlyArray<PatternResult>;\n    correlations?: ReadonlyArray<CorrelationResult>;\n    emotions?: ReadonlyArray<EmotionEntry>;\n    sensoryInputs?: ReadonlyArray<SensoryEntry>;\n    trackingEntries?: ReadonlyArray<TrackingEntry>;\n  },\n  overrides?: { insightConfig?: InsightConfig }\n): InsightOutput;\nexport function generateInsightsFromWorkerInputs(\n  ...args: [PatternResult[], PatternResult[], CorrelationResult[], { entries: TrackingEntry[]; emotions: EmotionEntry[] }] | [\n    {\n      patterns?: ReadonlyArray<PatternResult>;\n      correlations?: ReadonlyArray<CorrelationResult>;\n      emotions?: ReadonlyArray<EmotionEntry>;\n      sensoryInputs?: ReadonlyArray<SensoryEntry>;\n      trackingEntries?: ReadonlyArray<TrackingEntry>;\n    },\n    { insightConfig?: InsightConfig }?\n  ]\n): InsightOutput {\n  // Branch A: Canonical signature with separate emotion/sensory pattern arrays\n  if (Array.isArray(args[0])) {\n    const emotionPatterns = (args[0] as PatternResult[]) ?? [];\n    const sensoryPatterns = (args[1] as PatternResult[]) ?? [];\n    const correlations = (args[2] as CorrelationResult[]) ?? [];\n    const data = args[3] as { entries: TrackingEntry[]; emotions: EmotionEntry[] };\n\n    // Non-mutating composition\n    const patterns: PatternResult[] = [...emotionPatterns, ...sensoryPatterns];\n\n    const results = { patterns, correlations, predictiveInsights: [] as Array<{ description: string; confidence: number }> };\n    return generateInsights(results, data.emotions, data.entries);\n  }\n\n  // Branch B: Legacy object-based signature\n  const input = args[0] as {\n    patterns?: ReadonlyArray<PatternResult>;\n    correlations?: ReadonlyArray<CorrelationResult>;\n    emotions?: ReadonlyArray<EmotionEntry>;\n    sensoryInputs?: ReadonlyArray<SensoryEntry>;\n    trackingEntries?: ReadonlyArray<TrackingEntry>;\n  };\n  const overrides = (args[1] as { insightConfig?: InsightConfig } | undefined) ?? undefined;\n\n  const patterns = (input.patterns ?? []).slice();\n  const legacyCorrelations = (input.correlations ?? []).slice();\n  const emotions = (input.emotions ?? []).slice();\n  // sensoryInputs are accepted in legacy input but are not required by canonical insights path\n  const trackingEntries = (input.trackingEntries ?? []).slice();\n\n  return generateInsights(\n    { patterns: patterns as PatternResult[], correlations: legacyCorrelations as CorrelationResult[], predictiveInsights: [] },\n    emotions,\n    trackingEntries,\n    overrides?.insightConfig\n  );\n}\n\n// Internal helper (pure)\nfunction getTopCategory(values: ReadonlyArray<string>): { key: string; count: number } | null {\n  if (values.length === 0) return null;\n  const counts = values.reduce<Record<string, number>>((acc, key) => {\n    acc[key] = (acc[key] ?? 0) + 1;\n    return acc;\n  }, {});\n  let bestKey = '';\n  let bestCount = 0;\n  for (const [k, c] of Object.entries(counts)) {\n    if (c > bestCount) {\n      bestKey = k;\n      bestCount = c;\n    }\n  }\n  return bestKey ? { key: bestKey, count: bestCount } : null;\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/insights/task.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[208,211],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[208,211],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[854,857],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[854,857],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1120,1123],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1120,1123],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1297,1300],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1297,1300],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1335,1338],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1335,1338],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1571,1574],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1571,1574],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":55,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2223,2226],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2223,2226],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2252,2255],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2252,2255],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2286,2289],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2286,2289],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2345,2348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2345,2348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":127,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":130,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2481,2484],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2481,2484],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":137,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":140,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2491,2494],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2491,2494],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2788,2791],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2788,2791],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":83,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3340,3343],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3340,3343],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":14,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { buildInsightsCacheKey, buildInsightsTask } from '@/lib/insights/task';\n\nvi.mock('@/lib/analyticsConfig', async (orig) => {\n  const mod: any = await orig();\n  const DEFAULT = mod.DEFAULT_ANALYTICS_CONFIG;\n  const cfg = { ...DEFAULT, cache: { ...DEFAULT.cache, ttl: 300_000 } }; // 5 minutes\n  return {\n    ...mod,\n    analyticsConfig: {\n      getConfig: vi.fn(() => ({ ...cfg })),\n    },\n    DEFAULT_ANALYTICS_CONFIG: cfg,\n  };\n});\n\ndescribe('buildInsightsCacheKey', () => {\n  it('is stable across reordering of inputs and includes structural counts via createCacheKey', () => {\n    const inputsA = {\n      entries: [\n        { id: 't1', timestamp: new Date('2025-01-02T00:00:00Z'), value: 1 },\n        { id: 't2', timestamp: new Date('2025-01-03T00:00:00Z'), value: 2 },\n      ] as any[],\n      emotions: [\n        { id: 'e1', studentId: 's1', emotion: 'happy', intensity: 3, timestamp: new Date('2025-01-01T00:00:00Z') },\n        { id: 'e2', studentId: 's1', emotion: 'sad', intensity: 2, timestamp: new Date('2025-01-04T00:00:00Z') },\n      ] as any[],\n      sensoryInputs: [\n        { id: 's1', studentId: 's1', sense: 'visual', response: 'seeking', intensity: 3, timestamp: new Date('2025-01-05T00:00:00Z') },\n      ] as any[],\n      goals: [{ id: 'g1' }] as any[]\n    };\n\n    const inputsB = {\n      entries: inputsA.entries.slice().reverse(),\n      emotions: inputsA.emotions.slice().reverse(),\n      sensoryInputs: inputsA.sensoryInputs.slice(),\n      goals: inputsA.goals?.slice(),\n    } as any;\n\n    const keyA = buildInsightsCacheKey(inputsA, {});\n    const keyB = buildInsightsCacheKey(inputsB, {});\n\n    expect(keyA).toBe(keyB);\n    // Ensure the key has the expected colon-separated parts and includes counts prefix markers\n    const parts = keyA.split(':');\n    // namespace + 5 count parts + hash => at least 7 parts\n    expect(parts.length).toBeGreaterThanOrEqual(7);\n    expect(parts[0]).toBe('insights');\n    expect(parts.slice(1, 6).every(p => /^[ciokp]\\d+$/.test(p))).toBe(true);\n  });\n\n  it('produces different keys when counts differ', () => {\n    const base = {\n      entries: [{ id: 't1', timestamp: new Date(), value: 1 }] as any[],\n      emotions: [] as any[],\n      sensoryInputs: [] as any[],\n    };\n    const k1 = buildInsightsCacheKey(base as any, {});\n    const k2 = buildInsightsCacheKey({ ...base, entries: base.entries.concat({ id: 't2', timestamp: new Date(), value: 2 } as any) } as any, {});\n    expect(k1).not.toBe(k2);\n  });\n});\n\ndescribe('buildInsightsTask', () => {\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  it('builds a consistent task envelope with cacheKey, ttlSeconds, and tags', () => {\n    const inputs = { entries: [], emotions: [], sensoryInputs: [] } as any;\n    const task = buildInsightsTask(inputs, { tags: ['custom'] });\n\n    expect(task.type).toBe('Insights/Compute');\n    expect(typeof task.cacheKey).toBe('string');\n    expect(task.cacheKey.length).toBeGreaterThan(10);\n    expect(task.ttlSeconds).toBeGreaterThan(0);\n    expect(task.tags).toEqual(expect.arrayContaining(['insights', 'v2', 'custom']));\n    expect(task.payload).toEqual(expect.objectContaining({ inputs }));\n  });\n\n  it('honors TTL override in options', () => {\n    const inputs = { entries: [], emotions: [], sensoryInputs: [] } as any;\n    const task = buildInsightsTask(inputs, { ttlSeconds: 42 });\n    expect(task.ttlSeconds).toBe(42);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/insights/task.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/insights/unified.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Student' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":58,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":65},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":88,"column":102,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":105,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3758,3761],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3758,3761],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/lib/insights/unified.ts\n// Unified insights computation module\n// - Single entry: computeInsights\n// - Pure function: no side effects, no worker instantiation\n// - Uses central config (analyticsConfig) with safe fallbacks to ANALYTICS_CONFIG\n// - Keeps payloads small and typed\n\nimport { analyticsConfig, ANALYTICS_CONFIG, type AnalyticsConfiguration } from '@/lib/analyticsConfig';\nimport { patternAnalysis, type PatternResult, type CorrelationResult } from '@/lib/patternAnalysis';\nimport { enhancedPatternAnalysis, type PredictiveInsight, type AnomalyDetection } from '@/lib/enhancedPatternAnalysis';\nimport { generateInsights as generateUnifiedInsights, calculateConfidence as computeUnifiedConfidence } from '@/lib/insights';\nimport type { EmotionEntry, SensoryEntry, TrackingEntry, Student, Goal } from '@/types/student';\nimport type { AnalyticsResults } from '@/types/analytics';\nimport { logger } from '@/lib/logger';\n\nexport interface ComputeInsightsInputs {\n  entries: TrackingEntry[];\n  emotions: EmotionEntry[];\n  sensoryInputs: SensoryEntry[];\n  goals?: Goal[];\n}\n\nexport interface ComputeInsightsOptions {\n  config?: AnalyticsConfiguration; // runtime override\n}\n\nfunction minimalSafeResults(partial?: Partial<AnalyticsResults> & { confidence?: number; hasMinimumData?: boolean }): AnalyticsResults {\n  return {\n    patterns: [],\n    correlations: [],\n    environmentalCorrelations: [],\n    predictiveInsights: [],\n    anomalies: [],\n    insights: [],\n    ...partial,\n  } as AnalyticsResults;\n}\n\nexport async function computeInsights(\n  inputs: ComputeInsightsInputs,\n  options?: ComputeInsightsOptions\n): Promise<AnalyticsResults> {\n  // Early guards for invalid inputs\n  if (!inputs || !Array.isArray(inputs.entries) || !Array.isArray(inputs.emotions) || !Array.isArray(inputs.sensoryInputs)) {\n    logger.error('[insights/unified] computeInsights: invalid inputs', { inputsType: typeof inputs });\n    return minimalSafeResults({ error: 'INVALID_INPUT', confidence: 0, hasMinimumData: false });\n  }\n\n  try {\n    const { entries, emotions, sensoryInputs } = inputs;\n    const cfg = options?.config ?? (() => {\n      try {\n        return analyticsConfig.getConfig();\n      } catch {\n        return ANALYTICS_CONFIG as unknown as AnalyticsConfiguration;\n      }\n    })();\n\n    const hasMinimumData = (emotions.length > 0) || (sensoryInputs.length > 0) || (entries.length > 0);\n\n    const patterns: PatternResult[] = [];\n    let correlations: CorrelationResult[] = [];\n    let predictiveInsights: PredictiveInsight[] = [];\n    let anomalies: AnomalyDetection[] = [];\n\n    if (hasMinimumData) {\n      const analysisDays = cfg.analytics?.ANALYSIS_PERIOD_DAYS ?? ANALYTICS_CONFIG.analytics.ANALYSIS_PERIOD_DAYS;\n      if (emotions.length > 0) {\n        patterns.push(...patternAnalysis.analyzeEmotionPatterns(emotions, analysisDays));\n      }\n      if (sensoryInputs.length > 0) {\n        patterns.push(...patternAnalysis.analyzeSensoryPatterns(sensoryInputs, analysisDays));\n      }\n      if (entries.length >= (cfg.analytics?.MIN_TRACKING_FOR_CORRELATION ?? ANALYTICS_CONFIG.analytics.MIN_TRACKING_FOR_CORRELATION)) {\n        correlations = patternAnalysis.analyzeEnvironmentalCorrelations(entries);\n      }\n      if (entries.length >= (cfg.analytics?.MIN_TRACKING_FOR_ENHANCED ?? ANALYTICS_CONFIG.analytics.MIN_TRACKING_FOR_ENHANCED)) {\n        predictiveInsights = await enhancedPatternAnalysis.generatePredictiveInsights(\n          emotions,\n          sensoryInputs,\n          entries,\n          inputs.goals ?? []\n        );\n        anomalies = enhancedPatternAnalysis.detectAnomalies(emotions, sensoryInputs, entries);\n      }\n    }\n\n    const resultsBase = { patterns, correlations, predictiveInsights, anomalies, hasMinimumData } as any;\n\n    const insights = generateUnifiedInsights(resultsBase, emotions, entries, cfg.insights);\n    const confidence = computeUnifiedConfidence(emotions, sensoryInputs, entries, cfg.confidence);\n\n    return {\n      ...resultsBase,\n      insights,\n      confidence,\n    } as AnalyticsResults;\n  } catch (error) {\n    logger.error('[insights/unified] computeInsights failed', { error: error instanceof Error ? { message: error.message, stack: error.stack, name: error.name } : error });\n    return minimalSafeResults({ error: 'ANALYTICS_UNIFIED_ERROR', confidence: 0, hasMinimumData: false });\n  }\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/key.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/logger.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/logger.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[737,740],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[737,740],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":133,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":133,"endColumn":19}],"suppressedMessages":[{"ruleId":"no-console","severity":2,"message":"Unexpected console statement.","line":83,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":83,"endColumn":18,"suggestions":[{"fix":{"range":[2086,2145],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":"Logger intentionally proxies to console when enabled"}]},{"ruleId":"no-console","severity":2,"message":"Unexpected console statement.","line":89,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":89,"endColumn":19,"suggestions":[{"fix":{"range":[2285,2344],"text":""},"messageId":"removeConsole","data":{"propertyName":"info"},"desc":"Remove the console.info()."}],"suppressions":[{"kind":"directive","justification":"Logger intentionally proxies to console when enabled"}]},{"ruleId":"no-console","severity":2,"message":"Unexpected console statement.","line":95,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":95,"endColumn":19,"suggestions":[{"fix":{"range":[2484,2543],"text":""},"messageId":"removeConsole","data":{"propertyName":"warn"},"desc":"Remove the console.warn()."}],"suppressions":[{"kind":"directive","justification":"Logger intentionally proxies to console when enabled"}]},{"ruleId":"no-console","severity":2,"message":"Unexpected console statement.","line":102,"column":9,"nodeType":"MemberExpression","messageId":"unexpected","endLine":102,"endColumn":22,"suggestions":[{"fix":{"range":[2707,2768],"text":""},"messageId":"removeConsole","data":{"propertyName":"error"},"desc":"Remove the console.error()."}],"suppressions":[{"kind":"directive","justification":"Logger intentionally proxies to console when enabled"}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable no-console -- Logger intentionally proxies to console when enabled */\nimport { LOG_LEVEL_NAME, DEBUG_MODE } from '@/lib/env';\nexport enum LogLevel {\n  DEBUG = 0,\n  INFO = 1,\n  WARN = 2,\n  ERROR = 3,\n  NONE = 4\n}\n\ninterface LoggerConfig {\n  level: LogLevel;\n  enableConsole: boolean;\n  enableRemote: boolean;\n  remoteEndpoint?: string;\n}\n\ntype LogData = Record<string, unknown> | unknown[] | string | number | boolean | null | undefined;\n\ninterface ErrorData {\n  message: string;\n  stack?: string;\n  name: string;\n  [key: string]: unknown;\n}\n\nclass Logger {\n  private config: LoggerConfig;\n  private static instance: Logger;\n\n  private constructor() {\n    const env = (() => {\n      try {\n        return (import.meta as any)?.env;\n      } catch {\n        return undefined;\n      }\n    })();\n    const isProd = !!(env && env.PROD);\n    const mappedLevel: LogLevel | null = (() => {\n      switch (LOG_LEVEL_NAME) {\n        case 'debug': return LogLevel.DEBUG;\n        case 'info': return LogLevel.INFO;\n        case 'warn': return LogLevel.WARN;\n        case 'error': return LogLevel.ERROR;\n        case 'none': return LogLevel.NONE;\n        default: return null;\n      }\n    })();\n    this.config = {\n      level: mappedLevel !== null ? mappedLevel : (isProd ? LogLevel.ERROR : (DEBUG_MODE ? LogLevel.DEBUG : LogLevel.INFO)),\n      enableConsole: mappedLevel !== LogLevel.NONE,\n      enableRemote: false\n    };\n  }\n\n  public static getInstance(): Logger {\n    if (!Logger.instance) {\n      Logger.instance = new Logger();\n    }\n    return Logger.instance;\n  }\n\n  public init(level: LogLevel) {\n    this.config.level = level;\n  }\n\n  public setLogLevel(level: LogLevel) {\n    this.config.level = level;\n  }\n\n  private shouldLog(level: LogLevel): boolean {\n    return level >= this.config.level;\n  }\n\n  private formatMessage(level: string): string {\n    const timestamp = new Date().toISOString();\n    return `[${timestamp}] [${level}]`;\n  }\n\n  debug(message: string, ...data: LogData[]): void {\n    if (this.shouldLog(LogLevel.DEBUG) && this.config.enableConsole) {\n      console.log(this.formatMessage('DEBUG'), message, ...data);\n    }\n  }\n\n  info(message: string, ...data: LogData[]): void {\n    if (this.shouldLog(LogLevel.INFO) && this.config.enableConsole) {\n      console.info(this.formatMessage('INFO'), message, ...data);\n    }\n  }\n\n  warn(message: string, ...data: LogData[]): void {\n    if (this.shouldLog(LogLevel.WARN) && this.config.enableConsole) {\n      console.warn(this.formatMessage('WARN'), message, ...data);\n    }\n  }\n\n  error(message: string, ...data: (Error | LogData)[]): void {\n    if (this.shouldLog(LogLevel.ERROR)) {\n      if (this.config.enableConsole) {\n        console.error(this.formatMessage('ERROR'), message, ...data);\n      }\n\n      const errorData = data.map(d => {\n        if (d instanceof Error) {\n          return { message: d.message, stack: d.stack, name: d.name };\n        }\n        return d;\n      });\n      \n      // Send to remote logging service if enabled\n      if (this.config.enableRemote && this.config.remoteEndpoint) {\n        this.sendToRemote(message, errorData);\n      }\n    }\n  }\n\n  private async sendToRemote(message: string, data: (LogData | ErrorData)[]): Promise<void> {\n    try {\n      await fetch(this.config.remoteEndpoint!, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          timestamp: new Date().toISOString(),\n          level: 'ERROR',\n          message,\n          data,\n          userAgent: navigator.userAgent,\n          url: window.location.href\n        })\n      });\n    } catch (error) {\n      // Silently fail to avoid infinite loop\n    }\n  }\n\n  configure(config: Partial<LoggerConfig>): void {\n    this.config = { ...this.config, ...config };\n  }\n}\n\nexport const logger = Logger.getInstance();\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/mlModels.ts","messages":[{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":163,"column":100,"nodeType":"BlockStatement","messageId":"unexpected","endLine":163,"endColumn":102,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4509,4509],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'reject' is defined but never used. Allowed unused args must match /^_/u.","line":167,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":167,"endColumn":40},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":172,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4777,4780],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4777,4780],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":172,"column":99,"nodeType":"BlockStatement","messageId":"unexpected","endLine":172,"endColumn":101,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4792,4792],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":188,"column":98,"nodeType":"BlockStatement","messageId":"unexpected","endLine":188,"endColumn":100,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[5389,5389],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":205,"column":92,"nodeType":"BlockStatement","messageId":"unexpected","endLine":205,"endColumn":94,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[5999,5999],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'modelData' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":210,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":210,"endColumn":20},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":239,"column":92,"nodeType":"BlockStatement","messageId":"unexpected","endLine":239,"endColumn":94,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[7183,7183],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":275,"column":94,"nodeType":"BlockStatement","messageId":"unexpected","endLine":275,"endColumn":96,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[8209,8209],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":297,"column":93,"nodeType":"BlockStatement","messageId":"unexpected","endLine":297,"endColumn":95,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[8884,8884],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cfgRuntime' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":423,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":423,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'finalLoss' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":438,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":438,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cfgRuntime' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":561,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":561,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'finalLoss' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":575,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":575,"endColumn":22},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'meta' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":701,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":701,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { logger } from '@/lib/logger';\nimport * as tf from '@tensorflow/tfjs';\nimport { TrackingEntry } from '../types/student';\nimport { ValidationResults } from '../types/ml';\nimport { analyticsConfig } from '@/lib/analyticsConfig';\nimport { \n  toMLSessions, \n  prepareEmotionDataset, \n  prepareSensoryDataset,\n  encodeTimeFeatures \n} from '@/lib/dataPreprocessing';\nimport { recordEvaluation, type EvaluationRun } from '@/lib/modelEvaluation';\nimport { createCacheKey } from '@/lib/analytics/cache-key';\nimport { CrossValidator, type TimeSeriesValidationConfig } from '@/lib/validation/crossValidation';\n\n// Model versioning and metadata\nexport interface ModelMetadata {\n  name: string;\n  version: string;\n  createdAt: Date;\n  lastTrainedAt: Date;\n  accuracy?: number;\n  loss?: number;\n  inputShape: number[];\n  outputShape: number[];\n  architecture: string;\n  epochs: number;\n  dataPoints: number;\n  validationResults?: ValidationResults;\n  /** Optional preprocessing schema version used to prepare the training data */\n  preprocessingSchemaVersion?: string;\n}\n\n// ML Model types\nexport type ModelType = 'emotion-prediction' | 'sensory-response' | 'baseline-clustering';\n\n// Model storage interface\nexport interface StoredModel {\n  model: tf.LayersModel | tf.Sequential;\n  metadata: ModelMetadata;\n}\n\n/**\n * Session-like interface for ML training, capturing the state\n * of a student in various sensory and emotional dimensions.\n */\nexport interface MLSession {\n  /**\n   * Unique session identifier.\n   */\n  id: string;\n  /**\n   * Identifier of the student associated with the session.\n   */\n  studentId: string;\n  /**\n   * Date of the session in ISO string format.\n   */\n  date: string;\n  emotion: {\n    /**\n     * Average intensity values for each emotional state.\n     * Ranges from 0 (none) to 10 (very intense).\n     */\n    happy?: number;\n    sad?: number;\n    angry?: number;\n    anxious?: number;\n    calm?: number;\n    energetic?: number;\n    frustrated?: number;\n  };\n  sensory: {\n    /**\n     * Sensory response types, categorized as seeking, avoiding, or neutral.\n     */\n    visual?: 'seeking' | 'avoiding' | 'neutral';\n    auditory?: 'seeking' | 'avoiding' | 'neutral';\n    tactile?: 'seeking' | 'avoiding' | 'neutral';\n    vestibular?: 'seeking' | 'avoiding' | 'neutral';\n    proprioceptive?: 'seeking' | 'avoiding' | 'neutral';\n  };\n  environment: {\n    /**\n     * Environmental conditions affecting the session.\n     */\n    lighting?: 'bright' | 'dim' | 'moderate';\n    noise?: 'loud' | 'moderate' | 'quiet';\n    temperature?: 'hot' | 'cold' | 'comfortable';\n    crowded?: 'very' | 'moderate' | 'not';\n    smells?: boolean;  // Presence of specific smells\n    textures?: boolean;  // Presence of notable textures\n  };\n  /**\n   * Activities performed during the session.\n   */\n  activities: string[];\n  /**\n   * Additional notes and observations.\n   */\n  notes: string;\n}\n\n// ML prediction results\nexport interface EmotionPrediction {\n  date: Date;\n  emotions: {\n    happy: number;\n    sad: number;\n    angry: number;\n    anxious: number;\n    calm: number;\n    energetic: number;\n    frustrated: number;\n  };\n  confidence: number;\n  confidenceInterval: {\n    lower: number;\n    upper: number;\n  };\n}\n\nexport interface SensoryPrediction {\n  sensoryResponse: {\n    visual: { seeking: number; avoiding: number; neutral: number };\n    auditory: { seeking: number; avoiding: number; neutral: number };\n    tactile: { seeking: number; avoiding: number; neutral: number };\n    vestibular: { seeking: number; avoiding: number; neutral: number };\n    proprioceptive: { seeking: number; avoiding: number; neutral: number };\n  };\n  environmentalTriggers: {\n    trigger: string;\n    probability: number;\n  }[];\n  confidence: number;\n}\n\nexport interface BaselineCluster {\n  clusterId: number;\n  centroid: number[];\n  description: string;\n  anomalyScore: number;\n  isNormal: boolean;\n}\n\n// Model storage class using IndexedDB\n/**\n * Class for managing model storage using IndexedDB.\n * Handles model serialization and deserialization.\n */\nclass ModelStorage {\n  private dbName = 'sensory-compass-ml';\n  private storeName = 'models';\n  private db: IDBDatabase | null = null;\n\n/**\n * Initialize the IndexedDB database connection.\n * Sets up the object store if it does not already exist.\n */\nasync init(): Promise<void> {\n    // Check if IndexedDB is available\n    if (typeof indexedDB === 'undefined') {\n      try { logger.warn('[mlModels] IndexedDB not available, ML models will not persist'); } catch {}\n      return;\n    }\n    \n    return new Promise((resolve, reject) => {\n      try {\n        const request = indexedDB.open(this.dbName, 1);\n        \n        request.onerror = () => {\n          try { logger.warn('[mlModels] Failed to open IndexedDB', request.error as any); } catch {}\n          resolve(); // Don't reject, just continue without persistence\n        };\n        \n        request.onsuccess = () => {\n          this.db = request.result;\n          resolve();\n        };\n        \n        request.onupgradeneeded = (event) => {\n          const db = (event.target as IDBOpenDBRequest).result;\n          if (!db.objectStoreNames.contains(this.storeName)) {\n            db.createObjectStore(this.storeName, { keyPath: 'name' });\n          }\n        };\n      } catch (error) {\n        try { logger.warn('[mlModels] IndexedDB initialization failed', error as Error); } catch {}\n        resolve(); // Don't reject, just continue without persistence\n      }\n    });\n  }\n\n/**\n * Save a model to IndexedDB with its metadata.\n * Handles model artifacts serialization with a custom handler.\n *\n * @param name - Unique name for the model type.\n * @param model - The model to be saved.\n * @param metadata - Metadata associated with the model.\n */\nasync saveModel(name: ModelType, model: tf.LayersModel, metadata: ModelMetadata): Promise<void> {\n    if (!this.db) await this.init();\n    if (!this.db) {\n      try { logger.warn('[mlModels] Cannot save model - IndexedDB not available'); } catch {}\n      return;\n    }\n    \n    // Save model to IndexedDB\n    const modelData = await model.save(tf.io.withSaveHandler(async (artifacts) => {\n      const transaction = this.db!.transaction([this.storeName], 'readwrite');\n      const store = transaction.objectStore(this.storeName);\n      \n      await new Promise<void>((resolve, reject) => {\n        const request = store.put({\n          name,\n          artifacts,\n          metadata,\n          timestamp: new Date()\n        });\n        request.onsuccess = () => resolve();\n        request.onerror = () => reject(request.error);\n      });\n      \n      return { modelArtifactsInfo: { dateSaved: new Date(), modelTopologyType: 'JSON' } };\n    }));\n  }\n\n/**\n * Load a model from IndexedDB using its name.\n * Deserializes model artifacts and reconstructs the TensorFlow.js model.\n *\n * @param name - Unique name for the model type to be loaded.\n * @returns The stored model along with its metadata, or null if not found.\n */\nasync loadModel(name: ModelType): Promise<StoredModel | null> {\n    if (!this.db) await this.init();\n    if (!this.db) {\n      try { logger.warn('[mlModels] Cannot load model - IndexedDB not available'); } catch {}\n      return null;\n    }\n    \n    return new Promise((resolve, reject) => {\n      const transaction = this.db!.transaction([this.storeName], 'readonly');\n      const store = transaction.objectStore(this.storeName);\n      const request = store.get(name);\n      \n      request.onsuccess = async () => {\n        const data = request.result;\n        if (!data) {\n          resolve(null);\n          return;\n        }\n        \n        // Load model from stored artifacts\n        const model = await tf.loadLayersModel(tf.io.fromMemory(data.artifacts));\n        resolve({\n          model,\n          metadata: data.metadata\n        });\n      };\n      \n      request.onerror = () => reject(request.error);\n    });\n  }\n\n/**\n * Delete a model from IndexedDB by its name.\n *\n * @param name - The model type identifier to delete.\n */\nasync deleteModel(name: ModelType): Promise<void> {\n    if (!this.db) await this.init();\n    if (!this.db) {\n      try { logger.warn('[mlModels] Cannot delete model - IndexedDB not available'); } catch {}\n      return;\n    }\n    \n    return new Promise((resolve, reject) => {\n      const transaction = this.db!.transaction([this.storeName], 'readwrite');\n      const store = transaction.objectStore(this.storeName);\n      const request = store.delete(name);\n      \n      request.onsuccess = () => resolve();\n      request.onerror = () => reject(request.error);\n    });\n  }\n\n/**\n * List all models stored in IndexedDB.\n *\n * @returns An array of metadata for all stored models.\n */\nasync listModels(): Promise<ModelMetadata[]> {\n    if (!this.db) await this.init();\n    if (!this.db) {\n      try { logger.warn('[mlModels] Cannot list models - IndexedDB not available'); } catch {}\n      return [];\n    }\n    \n    return new Promise((resolve, reject) => {\n      const transaction = this.db!.transaction([this.storeName], 'readonly');\n      const store = transaction.objectStore(this.storeName);\n      const request = store.getAll();\n      \n      request.onsuccess = () => {\n        const models = request.result.map(item => item.metadata);\n        resolve(models);\n      };\n      \n      request.onerror = () => reject(request.error);\n    });\n  }\n}\n\n\n// Main ML Models class\nexport class MLModels {\n  private storage: ModelStorage;\n  private models: Map<ModelType, StoredModel>;\n  private isInitialized: boolean = false;\n\n  constructor() {\n    this.storage = new ModelStorage();\n    this.models = new Map();\n  }\n\n  async init(): Promise<void> {\n    if (this.isInitialized) return;\n    \n    await this.storage.init();\n    \n    // Load existing models\n    const modelTypes: ModelType[] = ['emotion-prediction', 'sensory-response', 'baseline-clustering'];\n    for (const type of modelTypes) {\n      const model = await this.storage.loadModel(type);\n      if (model) {\n        this.models.set(type, model);\n      }\n    }\n    \n    this.isInitialized = true;\n  }\n\n  // Create emotion prediction model\n  createEmotionModel(): tf.Sequential {\n    const model = tf.sequential({\n      layers: [\n        tf.layers.lstm({\n          units: 64,\n          returnSequences: true,\n          inputShape: [7, 13] // 7 days, 13 features (7 emotions + 6 time features)\n        }),\n        tf.layers.dropout({ rate: 0.2 }),\n        tf.layers.lstm({\n          units: 32,\n          returnSequences: false\n        }),\n        tf.layers.dropout({ rate: 0.2 }),\n        tf.layers.dense({\n          units: 16,\n          activation: 'relu'\n        }),\n        tf.layers.dense({\n          units: 7,\n          activation: 'sigmoid' // Output emotions normalized to 0-1\n        })\n      ]\n    });\n    \n    model.compile({\n      optimizer: tf.train.adam(0.001),\n      loss: 'meanSquaredError',\n      metrics: ['mse', 'mae']\n    });\n    \n    return model;\n  }\n\n  // Create sensory response model\n  createSensoryModel(): tf.Sequential {\n    const model = tf.sequential({\n      layers: [\n        tf.layers.dense({\n          units: 32,\n          activation: 'relu',\n          inputShape: [12] // 6 environment + 6 time features\n        }),\n        tf.layers.dropout({ rate: 0.2 }),\n        tf.layers.dense({\n          units: 16,\n          activation: 'relu'\n        }),\n        tf.layers.dropout({ rate: 0.2 }),\n        tf.layers.dense({\n          units: 15,\n          activation: 'softmax' // 5 senses × 3 responses (seeking/avoiding/neutral)\n        })\n      ]\n    });\n    \n    model.compile({\n      optimizer: tf.train.adam(0.001),\n      loss: 'categoricalCrossentropy',\n      metrics: ['accuracy']\n    });\n    \n    return model;\n  }\n\n  // Train emotion model\n  async trainEmotionModel(\n    trackingEntries: TrackingEntry[],\n    epochs: number = 50,\n    callbacks?: tf.CustomCallbackArgs,\n    options?: { devRunTimeSeriesCV?: boolean; tsConfig?: Partial<TimeSeriesValidationConfig> }\n  ): Promise<void> {\n    const sessions = toMLSessions(trackingEntries);\n    const model = this.createEmotionModel();\n    const { inputs, outputs, meta } = prepareEmotionDataset(sessions);\n\n    // Pull defaults from analytics runtime config; fall back to sane defaults\n    const cfgRuntime = analyticsConfig.getConfig();\n    const defaultBatch = 32; // keep as fallback; UI/runtime overrides can replace\n    const defaultValSplit = 0.2;\n\n    const history = await model.fit(inputs, outputs, {\n      epochs,\n      batchSize: defaultBatch,\n      validationSplit: defaultValSplit,\n      callbacks,\n      shuffle: true\n    });\n\n    // Record evaluation (regression-style metrics using validation history)\n    try {\n      const cfg = analyticsConfig.getConfig();\n      const finalLoss = history.history.loss?.[history.history.loss.length - 1] as number | undefined;\n      const finalValMSE = (history.history.val_mse?.[history.history.val_mse.length - 1] as number | undefined)\n        ?? (history.history.mse?.[history.history.mse.length - 1] as number | undefined);\n      const finalValMAE = (history.history.val_mae?.[history.history.val_mae.length - 1] as number | undefined)\n        ?? (history.history.mae?.[history.history.mae.length - 1] as number | undefined);\n\n      const dataSignature = createCacheKey({\n        namespace: 'ml-training:data',\n        input: {\n          modelType: 'emotion-prediction',\n          dataPoints: trackingEntries.length,\n          epochs,\n          preprocessingSchemaVersion: meta?.schemaVersion,\n        },\n        version: cfg.schemaVersion,\n      });\n      const configSignature = createCacheKey({\n        namespace: 'ml-training:config',\n        input: {\n          inputShape: [7, 13],\n          outputShape: [7],\n          architecture: 'LSTM',\n        },\n        version: cfg.schemaVersion,\n      });\n\n      const run: EvaluationRun = {\n        id: `${Date.now()}-emotion`,\n        modelType: 'emotion-prediction',\n        timestamp: Date.now(),\n        dataSignature,\n        configSignature,\n        taskType: 'regression',\n        metrics: {\n          regression: {\n            mse: finalValMSE,\n            mae: finalValMAE,\n          }\n        },\n        schemaVersion: cfg.schemaVersion,\n        notes: meta?.schemaVersion ? `preprocessingSchemaVersion=${meta.schemaVersion}` : undefined,\n      };\n      recordEvaluation(run);\n\n      // Optionally run time-series CV in development only\n      if (import.meta.env?.DEV && options?.devRunTimeSeriesCV) {\n        const validator = new CrossValidator();\n        const tsCfg: TimeSeriesValidationConfig = {\n          strategy: options.tsConfig?.strategy ?? 'rolling',\n          windowSize: options.tsConfig?.windowSize ?? Math.min(7, Math.max(3, Math.floor(inputs.shape[0] / 3) || 3)),\n          horizon: options.tsConfig?.horizon ?? 1,\n          gap: options.tsConfig?.gap ?? 0,\n          folds: options.tsConfig?.folds,\n          taskType: 'regression',\n        };\n        const tsResults = await validator.validateTimeSeriesModel(() => this.createEmotionModel(), { features: inputs, labels: outputs }, tsCfg);\n        const cvSig = createCacheKey({\n          namespace: 'ml-training:cv',\n          input: { tsCfg, preprocessingSchemaVersion: meta?.schemaVersion },\n          version: cfg.schemaVersion,\n        });\n        const cvRun: EvaluationRun = {\n          id: `${Date.now()}-emotion-tscv`,\n          modelType: 'emotion-prediction',\n          timestamp: Date.now(),\n          dataSignature,\n          configSignature: cvSig,\n          taskType: 'regression',\n          metrics: {\n            regression: tsResults.average?.regression ? {\n              mse: tsResults.average.regression.mse,\n              rmse: tsResults.average.regression.rmse,\n              mae: tsResults.average.regression.mae,\n              mape: tsResults.average.regression.mape,\n            } : undefined,\n          },\n          cv: { strategy: 'time-series', horizon: tsCfg.horizon, windowSize: tsCfg.windowSize, folds: tsCfg.folds },\n          schemaVersion: cfg.schemaVersion,\n          notes: 'Time-series cross-validation (dev-only)'\n        };\n        recordEvaluation(cvRun);\n      }\n    } catch {\n      // Fail-soft: never block training if evaluation capture fails\n    }\n\n    // Save model with metadata\n    const metadata: ModelMetadata = {\n      name: 'emotion-prediction',\n      version: '1.0.0',\n      createdAt: new Date(),\n      lastTrainedAt: new Date(),\n      accuracy: history.history.val_mse ?\n        history.history.val_mse[history.history.val_mse.length - 1] as number :\n        undefined,\n      loss: history.history.loss[history.history.loss.length - 1] as number,\n      inputShape: [7, 13],\n      outputShape: [7],\n      architecture: 'LSTM',\n      epochs,\n      dataPoints: trackingEntries.length,\n      preprocessingSchemaVersion: meta?.schemaVersion\n    };\n\n    await this.storage.saveModel('emotion-prediction', model, metadata);\n    this.models.set('emotion-prediction', { model, metadata });\n\n    // Clean up tensors\n    inputs.dispose();\n    outputs.dispose();\n  }\n\n  // Train sensory model\n  async trainSensoryModel(\n    trackingEntries: TrackingEntry[],\n    epochs: number = 50,\n    callbacks?: tf.CustomCallbackArgs,\n    options?: { devRunTimeSeriesCV?: boolean; tsConfig?: Partial<TimeSeriesValidationConfig> }\n  ): Promise<void> {\n    const sessions = toMLSessions(trackingEntries);\n    const model = this.createSensoryModel();\n    const { inputs, outputs, meta } = prepareSensoryDataset(sessions);\n\n    const cfgRuntime = analyticsConfig.getConfig();\n    const defaultBatch = 32;\n    const defaultValSplit = 0.2;\n    const history = await model.fit(inputs, outputs, {\n      epochs,\n      batchSize: defaultBatch,\n      validationSplit: defaultValSplit,\n      callbacks,\n      shuffle: true\n    });\n\n    // Record evaluation (classification metrics using validation history)\n    try {\n      const cfg = analyticsConfig.getConfig();\n      const finalLoss = history.history.loss?.[history.history.loss.length - 1] as number | undefined;\n      // TFJS sometimes exposes val_accuracy or acc\n      const finalValAcc = (history.history.val_accuracy?.[history.history.val_accuracy.length - 1] as number | undefined)\n        ?? (history.history.accuracy?.[history.history.accuracy.length - 1] as number | undefined)\n        ?? (history.history.acc?.[history.history.acc.length - 1] as number | undefined);\n\n      const dataSignature = createCacheKey({\n        namespace: 'ml-training:data',\n        input: {\n          modelType: 'sensory-response',\n          dataPoints: trackingEntries.length,\n          epochs,\n          preprocessingSchemaVersion: meta?.schemaVersion,\n        },\n        version: cfg.schemaVersion,\n      });\n      const configSignature = createCacheKey({\n        namespace: 'ml-training:config',\n        input: {\n          inputShape: [12],\n          outputShape: [15],\n          architecture: 'Dense',\n        },\n        version: cfg.schemaVersion,\n      });\n\n      const run: EvaluationRun = {\n        id: `${Date.now()}-sensory`,\n        modelType: 'sensory-response',\n        timestamp: Date.now(),\n        dataSignature,\n        configSignature,\n        taskType: 'classification',\n        metrics: {\n          classification: {\n            accuracy: finalValAcc,\n          }\n        },\n        schemaVersion: cfg.schemaVersion,\n        notes: meta?.schemaVersion ? `preprocessingSchemaVersion=${meta.schemaVersion}` : undefined,\n      };\n      recordEvaluation(run);\n\n      // Optionally run time-series CV in development only (classification)\n      if (import.meta.env?.DEV && options?.devRunTimeSeriesCV) {\n        const validator = new CrossValidator();\n        const tsCfg: TimeSeriesValidationConfig = {\n          strategy: options.tsConfig?.strategy ?? 'rolling',\n          windowSize: options.tsConfig?.windowSize ?? Math.min(8, Math.max(3, Math.floor(inputs.shape[0] / 3) || 3)),\n          horizon: options.tsConfig?.horizon ?? 1,\n          gap: options.tsConfig?.gap ?? 0,\n          folds: options.tsConfig?.folds,\n          taskType: 'classification',\n        };\n        const tsResults = await validator.validateTimeSeriesModel(() => this.createSensoryModel(), { features: inputs, labels: outputs }, tsCfg);\n        const cvSig = createCacheKey({\n          namespace: 'ml-training:cv',\n          input: { tsCfg, preprocessingSchemaVersion: meta?.schemaVersion },\n          version: cfg.schemaVersion,\n        });\n        const cvRun: EvaluationRun = {\n          id: `${Date.now()}-sensory-tscv`,\n          modelType: 'sensory-response',\n          timestamp: Date.now(),\n          dataSignature,\n          configSignature: cvSig,\n          taskType: 'classification',\n          metrics: {\n            classification: tsResults.average?.classification ? {\n              accuracy: tsResults.average.classification.accuracy,\n              precision: tsResults.average.classification.precision,\n              recall: tsResults.average.classification.recall,\n              f1: tsResults.average.classification.f1Score,\n            } : undefined,\n          },\n          cv: { strategy: 'time-series', horizon: tsCfg.horizon, windowSize: tsCfg.windowSize, folds: tsCfg.folds },\n          schemaVersion: cfg.schemaVersion,\n          notes: 'Time-series cross-validation (dev-only)'\n        };\n        recordEvaluation(cvRun);\n      }\n    } catch {\n      // Fail-soft\n    }\n\n    // Save model with metadata\n    const metadata: ModelMetadata = {\n      name: 'sensory-response',\n      version: '1.0.0',\n      createdAt: new Date(),\n      lastTrainedAt: new Date(),\n      accuracy: history.history.acc ?\n        history.history.acc[history.history.acc.length - 1] as number :\n        undefined,\n      loss: history.history.loss[history.history.loss.length - 1] as number,\n      inputShape: [12],\n      outputShape: [15],\n      architecture: 'Dense',\n      epochs,\n      dataPoints: trackingEntries.length,\n      preprocessingSchemaVersion: meta?.schemaVersion\n    };\n\n    await this.storage.saveModel('sensory-response', model, metadata);\n    this.models.set('sensory-response', { model, metadata });\n\n    // Clean up tensors\n    inputs.dispose();\n    outputs.dispose();\n  }\n\n  // Predict emotions for next 7 days\n  async predictEmotions(\n    recentEntries: TrackingEntry[],\n    daysToPredict: number = 7\n  ): Promise<EmotionPrediction[]> {\n    const recentSessions = toMLSessions(recentEntries);\n    const model = this.models.get('emotion-prediction');\n    if (!model) {\n      throw new Error('Emotion prediction model not found');\n    }\n    \n    const predictions: EmotionPrediction[] = [];\n    const currentSessions = [...recentSessions];\n    \n    for (let day = 0; day < daysToPredict; day++) {\n      const { inputs, meta } = prepareEmotionDataset(\n        currentSessions.slice(-7),\n        7\n      );\n      \n      if (inputs.shape[0] === 0) {\n        inputs.dispose();\n        break;\n      }\n      \n      const prediction = model.model.predict(inputs.slice([0, 0, 0], [1, -1, -1])) as tf.Tensor;\n      const values = await prediction.array() as number[][];\n      \n      const predictedDate = new Date(currentSessions[currentSessions.length - 1].date);\n      predictedDate.setDate(predictedDate.getDate() + 1);\n      \n      // Denormalize predictions\n      const emotionValues = values[0].map(v => v * 10); // Convert back to 0-10 scale\n      \n      // Simple dispersion-based confidence: inverse of variance across outputs\n      const variance = (() => {\n        const mean = emotionValues.reduce((s, v) => s + v, 0) / emotionValues.length;\n        const varSum = emotionValues.reduce((s, v) => s + Math.pow(v - mean, 2), 0) / emotionValues.length;\n        return varSum;\n      })();\n      const confidence = Math.max(0.0, Math.min(1.0, 1 / (1 + variance)));\n\n      predictions.push({\n        date: predictedDate,\n        emotions: {\n          happy: emotionValues[0],\n          sad: emotionValues[1],\n          angry: emotionValues[2],\n          anxious: emotionValues[3],\n          calm: emotionValues[4],\n          energetic: emotionValues[5],\n          frustrated: emotionValues[6]\n        },\n        confidence,\n        confidenceInterval: {\n          lower: Math.max(0, confidence - 0.1),\n          upper: Math.min(1, confidence + 0.1)\n        }\n      });\n      \n      // Add prediction as a new session for next iteration\n      currentSessions.push({\n        id: `predicted-${day}`,\n        studentId: currentSessions[0].studentId,\n        date: predictedDate.toISOString(),\n        emotion: {\n          happy: emotionValues[0],\n          sad: emotionValues[1],\n          angry: emotionValues[2],\n          anxious: emotionValues[3],\n          calm: emotionValues[4],\n          energetic: emotionValues[5],\n          frustrated: emotionValues[6]\n        },\n        sensory: currentSessions[currentSessions.length - 1].sensory,\n        environment: currentSessions[currentSessions.length - 1].environment,\n        activities: [],\n        notes: ''\n      });\n      \n      // Clean up\n      inputs.dispose();\n      prediction.dispose();\n    }\n    \n    return predictions;\n  }\n\n  // Predict sensory responses\n  async predictSensoryResponse(\n    environment: MLSession['environment'],\n    date: Date\n  ): Promise<SensoryPrediction> {\n    const model = this.models.get('sensory-response');\n    if (!model) {\n      throw new Error('Sensory response model not found');\n    }\n    \n    // Prepare input\n    const environmentFeatures = [\n      environment.lighting === 'bright' ? 1 : environment.lighting === 'dim' ? 0.5 : 0,\n      environment.noise === 'loud' ? 1 : environment.noise === 'moderate' ? 0.5 : 0,\n      environment.temperature === 'hot' ? 1 : environment.temperature === 'cold' ? 0 : 0.5,\n      environment.crowded === 'very' ? 1 : environment.crowded === 'moderate' ? 0.5 : 0,\n      environment.smells ? 1 : 0,\n      environment.textures ? 1 : 0\n    ];\n    \n    const timeFeatures = encodeTimeFeatures(date);\n    const input = tf.tensor2d([[...environmentFeatures, ...timeFeatures]]);\n    \n    const prediction = model.model.predict(input) as tf.Tensor;\n    const values = await prediction.array() as number[][];\n    \n    // Parse predictions\n    const senses = ['visual', 'auditory', 'tactile', 'vestibular', 'proprioceptive'];\n    const sensoryResponse: SensoryPrediction['sensoryResponse'] = {\n      visual: { seeking: 0, avoiding: 0, neutral: 0 },\n      auditory: { seeking: 0, avoiding: 0, neutral: 0 },\n      tactile: { seeking: 0, avoiding: 0, neutral: 0 },\n      vestibular: { seeking: 0, avoiding: 0, neutral: 0 },\n      proprioceptive: { seeking: 0, avoiding: 0, neutral: 0 }\n    };\n    \n    senses.forEach((sense, i) => {\n      const baseIdx = i * 3;\n      sensoryResponse[sense as keyof typeof sensoryResponse] = {\n        seeking: values[0][baseIdx],\n        avoiding: values[0][baseIdx + 1],\n        neutral: values[0][baseIdx + 2]\n      };\n    });\n    \n    // Identify environmental triggers\n    const triggers = [];\n    const cfg = analyticsConfig.getConfig();\n    const triggerCutoff = cfg.patternAnalysis.concernFrequencyThreshold; // reuse configured frequency threshold as cutoff\n    if (environment.noise === 'loud' && sensoryResponse.auditory.avoiding > triggerCutoff) {\n      triggers.push({ trigger: 'Loud noise', probability: sensoryResponse.auditory.avoiding });\n    }\n    if (environment.lighting === 'bright' && sensoryResponse.visual.avoiding > triggerCutoff) {\n      triggers.push({ trigger: 'Bright lights', probability: sensoryResponse.visual.avoiding });\n    }\n    if (environment.crowded === 'very' && sensoryResponse.tactile.avoiding > triggerCutoff) {\n      triggers.push({ trigger: 'Crowded spaces', probability: sensoryResponse.tactile.avoiding });\n    }\n    \n    // Clean up\n    input.dispose();\n    prediction.dispose();\n    \n    // Confidence heuristic: sharper softmax => higher confidence\n    const flat = values[0];\n    const maxP = Math.max(...flat);\n    const entropy = -flat.reduce((s, p) => s + (p > 0 ? p * Math.log(p) : 0), 0);\n    const normEntropy = entropy / Math.log(flat.length || 1);\n    const confidence = Math.max(0, Math.min(1, (maxP * 0.6) + (1 - normEntropy) * 0.4));\n\n    return {\n      sensoryResponse,\n      environmentalTriggers: triggers.sort((a, b) => b.probability - a.probability),\n      confidence\n    };\n  }\n\n  // Get model status\n  async getModelStatus(): Promise<Map<ModelType, ModelMetadata | null>> {\n    const status = new Map<ModelType, ModelMetadata | null>();\n    const types: ModelType[] = ['emotion-prediction', 'sensory-response', 'baseline-clustering'];\n    \n    for (const type of types) {\n      const model = this.models.get(type);\n      status.set(type, model?.metadata || null);\n    }\n    \n    return status;\n  }\n\n  // Delete a model\n  async deleteModel(type: ModelType): Promise<void> {\n    await this.storage.deleteModel(type);\n    this.models.delete(type);\n  }\n\n  // Export model for external use\n  async exportModel(type: ModelType, path: string): Promise<void> {\n    const model = this.models.get(type);\n    if (!model) {\n      throw new Error(`Model ${type} not found`);\n    }\n    \n    await model.model.save(`file://${path}`);\n  }\n\n  // Baseline clustering using K-means\n  async performBaselineClustering(\n    trackingEntries: TrackingEntry[],\n    numClusters: number = 3\n  ): Promise<BaselineCluster[]> {\n    if (trackingEntries.length < numClusters) {\n      throw new Error('Not enough data points for clustering');\n    }\n\n    // Extract features for clustering\n    const features = trackingEntries.map(entry => {\n      const avgEmotionIntensity = entry.emotions.length > 0\n        ? entry.emotions.reduce((sum, e) => sum + e.intensity, 0) / entry.emotions.length\n        : 0;\n      \n      const cfg = analyticsConfig.getConfig();\n      const positiveSet = new Set((cfg.taxonomy?.positiveEmotions || []).map(e => e.toLowerCase()));\n      const positiveEmotionRatio = entry.emotions.length > 0\n        ? entry.emotions.filter(e => positiveSet.has(e.emotion.toLowerCase())).length / entry.emotions.length\n        : 0;\n      \n      const sensorySeekingRatio = entry.sensoryInputs.length > 0\n        ? entry.sensoryInputs.filter(s => s.response.toLowerCase().includes('seeking')).length / entry.sensoryInputs.length\n        : 0;\n      \n      const sensoryAvoidingRatio = entry.sensoryInputs.length > 0\n        ? entry.sensoryInputs.filter(s => s.response.toLowerCase().includes('avoiding')).length / entry.sensoryInputs.length\n        : 0;\n      \n      return [\n        avgEmotionIntensity / 5, // Normalize to 0-1\n        positiveEmotionRatio,\n        sensorySeekingRatio,\n        sensoryAvoidingRatio\n      ];\n    });\n\n    // Normalize features\n    const normalizedFeatures = this.normalizeFeatures(features);\n    \n    // Perform K-means clustering\n    const { centroids, assignments } = await this.kMeansClustering(normalizedFeatures, numClusters);\n    \n    // Calculate anomaly scores\n    const clusters: BaselineCluster[] = [];\n    for (let i = 0; i < numClusters; i++) {\n      const clusterPoints = normalizedFeatures.filter((_, idx) => assignments[idx] === i);\n      const avgDistance = clusterPoints.length > 0\n        ? clusterPoints.reduce((sum, point) => sum + this.euclideanDistance(point, centroids[i]), 0) / clusterPoints.length\n        : 0;\n      \n      // Determine cluster characteristics\n      const description = this.describeCluster(centroids[i]);\n      \n      clusters.push({\n        clusterId: i,\n        centroid: centroids[i],\n        description,\n        anomalyScore: avgDistance,\n        isNormal: avgDistance < 0.5 // Threshold for normal behavior\n      });\n    }\n    \n    return clusters;\n  }\n\n  // K-means clustering implementation\n  private async kMeansClustering(\n    data: number[][],\n    k: number,\n    maxIterations: number = 100\n  ): Promise<{ centroids: number[][]; assignments: number[] }> {\n    const n = data.length;\n    const dimensions = data[0].length;\n    \n    // Initialize centroids randomly\n    const centroids = this.initializeCentroids(data, k);\n    const assignments = new Array(n).fill(0);\n    let previousAssignments = new Array(n).fill(-1);\n    \n    for (let iter = 0; iter < maxIterations; iter++) {\n      // Assignment step\n      for (let i = 0; i < n; i++) {\n        let minDistance = Infinity;\n        let closestCentroid = 0;\n        \n        for (let j = 0; j < k; j++) {\n          const distance = this.euclideanDistance(data[i], centroids[j]);\n          if (distance < minDistance) {\n            minDistance = distance;\n            closestCentroid = j;\n          }\n        }\n        \n        assignments[i] = closestCentroid;\n      }\n      \n      // Check for convergence\n      if (assignments.every((val, idx) => val === previousAssignments[idx])) {\n        break;\n      }\n      \n      previousAssignments = [...assignments];\n      \n      // Update step\n      for (let j = 0; j < k; j++) {\n        const clusterPoints = data.filter((_, idx) => assignments[idx] === j);\n        if (clusterPoints.length > 0) {\n          centroids[j] = new Array(dimensions).fill(0).map((_, dim) =>\n            clusterPoints.reduce((sum, point) => sum + point[dim], 0) / clusterPoints.length\n          );\n        }\n      }\n    }\n    \n    return { centroids, assignments };\n  }\n\n  // Initialize centroids using K-means++\n  private initializeCentroids(data: number[][], k: number): number[][] {\n    const centroids: number[][] = [];\n    const n = data.length;\n    \n    // Choose first centroid randomly\n    centroids.push([...data[Math.floor(Math.random() * n)]]);\n    \n    // Choose remaining centroids\n    for (let i = 1; i < k; i++) {\n      const distances = data.map(point => {\n        const minDist = centroids.reduce((min, centroid) =>\n          Math.min(min, this.euclideanDistance(point, centroid)), Infinity);\n        return minDist * minDist;\n      });\n      \n      // Choose next centroid with probability proportional to squared distance\n      const totalDist = distances.reduce((sum, d) => sum + d, 0);\n      let randomValue = Math.random() * totalDist;\n      let selectedIndex = 0;\n      \n      for (let j = 0; j < n; j++) {\n        randomValue -= distances[j];\n        if (randomValue <= 0) {\n          selectedIndex = j;\n          break;\n        }\n      }\n      \n      centroids.push([...data[selectedIndex]]);\n    }\n    \n    return centroids;\n  }\n\n  // Calculate Euclidean distance\n  private euclideanDistance(point1: number[], point2: number[]): number {\n    return Math.sqrt(\n      point1.reduce((sum, val, i) => sum + Math.pow(val - point2[i], 2), 0)\n    );\n  }\n\n  // Normalize features to 0-1 range\n  private normalizeFeatures(features: number[][]): number[][] {\n    const dimensions = features[0].length;\n    const mins = new Array(dimensions).fill(Infinity);\n    const maxs = new Array(dimensions).fill(-Infinity);\n    \n    // Find min and max for each dimension\n    features.forEach(feature => {\n      feature.forEach((val, i) => {\n        mins[i] = Math.min(mins[i], val);\n        maxs[i] = Math.max(maxs[i], val);\n      });\n    });\n    \n    // Normalize\n    return features.map(feature =>\n      feature.map((val, i) => {\n        const range = maxs[i] - mins[i];\n        return range === 0 ? 0 : (val - mins[i]) / range;\n      })\n    );\n  }\n\n  // Describe cluster characteristics\n  private describeCluster(centroid: number[]): string {\n    const [emotionIntensity, positiveRatio, seekingRatio, avoidingRatio] = centroid;\n    const cfg = analyticsConfig.getConfig();\n\n    // Derive normalized intensity bounds from configured thresholds (assumes 0-5 app scale in features)\n    const highIntensityNorm = Math.min(1, cfg.patternAnalysis.highIntensityThreshold / 5);\n    const lowIntensityNorm = Math.max(0, (cfg.patternAnalysis.highIntensityThreshold - 2) / 5);\n\n    // Valence thresholds from insights config\n    const positiveValence = cfg.insights.POSITIVE_EMOTION_TREND_THRESHOLD;\n    const negativeValence = cfg.insights.NEGATIVE_EMOTION_TREND_THRESHOLD;\n\n    // Sensory dominance threshold reuse concern frequency\n    const sensoryDominance = cfg.patternAnalysis.concernFrequencyThreshold;\n\n    let description = '';\n\n    // Emotion characteristics\n    if (emotionIntensity > highIntensityNorm) {\n      description += 'High emotional intensity';\n    } else if (emotionIntensity < lowIntensityNorm) {\n      description += 'Low emotional intensity';\n    } else {\n      description += 'Moderate emotional intensity';\n    }\n\n    // Emotional valence\n    if (positiveRatio > positiveValence) {\n      description += ', predominantly positive emotions';\n    } else if (positiveRatio < negativeValence) {\n      description += ', predominantly challenging emotions';\n    } else {\n      description += ', mixed emotional states';\n    }\n\n    // Sensory patterns\n    if (seekingRatio > sensoryDominance) {\n      description += ', high sensory seeking';\n    } else if (avoidingRatio > sensoryDominance) {\n      description += ', high sensory avoiding';\n    } else {\n      description += ', balanced sensory responses';\n    }\n\n    return description;\n  }\n}\n\n// Singleton instance\nexport const mlModels = new MLModels();","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/mock/mockSeeders.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1532,1535],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1532,1535],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1631,1634],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1631,1634],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":40,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1679,1682],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1679,1682],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1926,1929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1926,1929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1976,1979],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1976,1979],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * @file src/lib/mock/mockSeeders.ts\n * Optional demo data seeders. These are never invoked automatically.\n * Use explicitly from dev tooling, tests, or a one-off script.\n */\nimport { dataStorage } from '@/lib/dataStorage';\nimport { logger } from '@/lib/logger';\nimport { v4 as uuidv4 } from 'uuid';\nimport { generateUniversalMockDataForStudent as generateMockData } from '@/lib/universalDataGenerator';\n\nexport interface SeedDemoOptions {\n  // Seed for existing students in storage\n  forExistingStudents?: boolean;\n  // Create N new demo students and seed them\n  createNewStudents?: number;\n  // Batches of tracking entries per student to generate (approximate)\n  batchesPerStudent?: number;\n}\n\n/**\n * Seed demo tracking data for existing and/or newly-created students.\n * This function is idempotent with respect to student creation (unique ids each run)\n * but will append tracking entries each invocation.\n */\nexport async function seedDemoData(options: SeedDemoOptions = {}): Promise<{ totalStudentsAffected: number; totalEntriesCreated: number; }>{\n  const { forExistingStudents = true, createNewStudents = 0, batchesPerStudent = 1 } = options;\n  let totalStudentsAffected = 0;\n  let totalEntriesCreated = 0;\n\n  try {\n    // Optionally create new demo students\n    if (createNewStudents > 0) {\n      for (let i = 0; i < createNewStudents; i++) {\n        const id = `demo-${uuidv4()}`;\n        // Minimal student object; adapt to your domain model if needed\n        const student = { id, name: `Demo Student ${i + 1}` } as any;\n        try {\n          // Persist via storage API if available\n          if ((dataStorage as any).saveStudent) {\n            (dataStorage as any).saveStudent(student);\n          } else {\n            // Fallback: push into existing list if your storage supports it\n            const students = dataStorage.getStudents();\n            if (!students.find(s => s.id === id) && (dataStorage as any).setStudents) {\n              (dataStorage as any).setStudents([...students, student]);\n            }\n          }\n        } catch (e) {\n          logger.warn('[seedDemoData] Unable to save new demo student', { id, error: e });\n        }\n      }\n    }\n\n    const students = dataStorage.getStudents();\n    const targetStudents = forExistingStudents ? students : students.slice(-createNewStudents);\n\n    for (const student of targetStudents) {\n      totalStudentsAffected++;\n      for (let b = 0; b < Math.max(1, batchesPerStudent); b++) {\n        // Generator returns an array of TrackingEntry for this student\n        const batch = generateMockData(student.id);\n        for (const entry of batch) {\n          try {\n            dataStorage.saveTrackingEntry(entry);\n            totalEntriesCreated++;\n          } catch (e) {\n            logger.error('[seedDemoData] Failed to save tracking entry', { studentId: student.id, error: e });\n          }\n        }\n      }\n    }\n\n    logger.info('[seedDemoData] Demo data seeding complete', { totalStudentsAffected, totalEntriesCreated });\n  } catch (error) {\n    logger.error('[seedDemoData] Seeding failed', { error });\n  }\n\n  return { totalStudentsAffected, totalEntriesCreated };\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/mock/socialSeeder.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/mockData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/mockDataGenerator.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/mockDataGenerator.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2053,2056],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2053,2056],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2834,2837],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2834,2837],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3613,3616],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3613,3616],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4451,4454],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4451,4454],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5268,5271],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5268,5271],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":184,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":187,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7860,7863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7860,7863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":157,"column":183,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":186,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8235,8238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8235,8238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":162,"column":179,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":182,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8577,8580],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8577,8580],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":167,"column":185,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":188,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8943,8946],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8943,8946],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":172,"column":180,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":183,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9295,9298],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9295,9298],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":618,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":618,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27474,27477],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27474,27477],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":628,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":628,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27804,27807],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27804,27807],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Student, TrackingEntry, EmotionEntry, SensoryEntry, EnvironmentalEntry, Goal } from '@/types/student';\nimport { dataStorage } from './dataStorage';\nimport { logger } from './logger';\nimport { generateId } from './uuid';\nimport { validateEmotionEntry, validateSensoryEntry, validateTrackingEntry, validateStudent } from './dataValidation';\n\n// Helper function to get a random date within the last N days\nconst getRandomDate = (daysAgo: number, variance: number = 0): Date => {\n  const baseDate = new Date();\n  baseDate.setDate(baseDate.getDate() - daysAgo);\n  \n  if (variance > 0) {\n    const varianceMs = variance * 24 * 60 * 60 * 1000; // Convert days to milliseconds\n    const randomOffset = (Math.random() - 0.5) * 2 * varianceMs;\n    baseDate.setTime(baseDate.getTime() + randomOffset);\n  }\n  \n  return baseDate;\n};\n\n// -----------------------------------------------------------------------------\n// Emma-specific social-context helpers\n// -----------------------------------------------------------------------------\n\n/** Apply a realistic social scenario to an entry for Emma to help AI answer\n * social-trigger questions (e.g., friminutt, gruppearbeid, kantine, overgang,\n * presentasjon). Uses Norwegian keywords the heuristics look for.\n */\nfunction applyEmmaSocialContext(entry: TrackingEntry): void {\n  // Ensure at least one emotion exists so we can tag social triggers\n  if (!entry.emotions || entry.emotions.length === 0) {\n    entry.emotions = [generateEmotionEntry(entry.studentId, entry.timestamp, 'anxious')];\n  }\n  const emo = entry.emotions[0];\n\n  // Prefer anxious/frustrated with higher intensity so it surfaces in patterns\n  if (Math.random() < 0.8) emo.emotion = 'anxious';\n  if (!emo.intensity || emo.intensity < 4) emo.intensity = 4;\n  emo.triggers = Array.isArray(emo.triggers) ? emo.triggers : [];\n\n  // Choose a social scenario\n  const r = Math.random();\n  if (r < 0.30) {\n    // Gruppearbeid i klasserommet\n    entry.environmentalData = entry.environmentalData || { id: undefined, timestamp: entry.timestamp } as any;\n    if (entry.environmentalData) {\n      entry.environmentalData.location = 'classroom';\n      entry.environmentalData.socialContext = 'Gruppearbeid';\n      entry.environmentalData.classroom = {\n        ...(entry.environmentalData.classroom || {}),\n        activity: 'group-work',\n        timeOfDay: (entry.environmentalData.classroom && entry.environmentalData.classroom.timeOfDay) || 'morning',\n      };\n    }\n    emo.triggers.push('sosial interaksjon', 'gruppearbeid');\n    emo.notes = emo.notes || 'Uro under gruppeoppgave';\n    entry.generalNotes = 'Sosial situasjon: gruppeoppgave i klasserommet (samarbeid/gruppe).';\n  } else if (r < 0.55) {\n    // Friminutt ute\n    entry.environmentalData = entry.environmentalData || { id: undefined, timestamp: entry.timestamp } as any;\n    if (entry.environmentalData) {\n      entry.environmentalData.location = 'playground';\n      entry.environmentalData.socialContext = 'Friminutt';\n      entry.environmentalData.classroom = {\n        ...(entry.environmentalData.classroom || {}),\n        activity: 'free-time',\n        timeOfDay: (entry.environmentalData.classroom && entry.environmentalData.classroom.timeOfDay) || 'afternoon',\n      };\n    }\n    emo.triggers.push('sosial interaksjon', 'friminutt');\n    emo.notes = emo.notes || 'Konflikt i friminutt';\n    entry.generalNotes = 'Friminutt med mange elever; mulig konflikt/press i sosial situasjon.';\n  } else if (r < 0.75) {\n    // Lunsj i kantinen\n    entry.environmentalData = entry.environmentalData || { id: undefined, timestamp: entry.timestamp } as any;\n    if (entry.environmentalData) {\n      entry.environmentalData.location = 'cafeteria';\n      entry.environmentalData.socialContext = 'Lunsj/kantine';\n      entry.environmentalData.roomConditions = {\n        ...(entry.environmentalData.roomConditions || {}),\n        noiseLevel: Math.max(3, (entry.environmentalData.roomConditions?.noiseLevel || 3)),\n        lighting: entry.environmentalData.roomConditions?.lighting || 'bright',\n      };\n    }\n    emo.triggers.push('sosial interaksjon', 'lunsj', 'kantine');\n    emo.notes = emo.notes || 'Overveldet i kantinen (støy, kø, mange elever)';\n    entry.generalNotes = 'Lunsj i kantinen; tett sosialt miljø og høy lyd.';\n  } else if (r < 0.90) {\n    // Presentasjon foran klassen\n    entry.environmentalData = entry.environmentalData || { id: undefined, timestamp: entry.timestamp } as any;\n    if (entry.environmentalData) {\n      entry.environmentalData.location = 'classroom';\n      entry.environmentalData.socialContext = 'Presentasjon';\n      entry.environmentalData.classroom = {\n        ...(entry.environmentalData.classroom || {}),\n        activity: 'instruction',\n        timeOfDay: (entry.environmentalData.classroom && entry.environmentalData.classroom.timeOfDay) || 'morning',\n      };\n    }\n    emo.triggers.push('sosial interaksjon', 'presentasjon');\n    emo.notes = emo.notes || 'Nervøs/engstelig ved presentasjon';\n    entry.generalNotes = 'Presentasjon foran klassen; sosial eksponering og forventninger.';\n  } else {\n    // Overgang mellom aktiviteter/timer (hallway/transition)\n    entry.environmentalData = entry.environmentalData || { id: undefined, timestamp: entry.timestamp } as any;\n    if (entry.environmentalData) {\n      entry.environmentalData.location = 'hallway';\n      entry.environmentalData.socialContext = 'Overgang';\n      entry.environmentalData.classroom = {\n        ...(entry.environmentalData.classroom || {}),\n        activity: 'transition',\n        timeOfDay: (entry.environmentalData.classroom && entry.environmentalData.classroom.timeOfDay) || 'afternoon',\n      };\n    }\n    emo.triggers.push('sosial interaksjon', 'overgang');\n    emo.notes = emo.notes || 'Påvirket ved overgang til/etter friminutt';\n    entry.generalNotes = 'Overgang fra friminutt til time; stress i korridor/oppstilling.';\n  }\n}\n\n/** Ensure Emma has at least a baseline number of explicit social examples. */\nfunction ensureEmmaSocialBaseline(entries: TrackingEntry[], student: Student, min = 6): void {\n  const socialRe = /(sosial|sosiale|venn|venner|kompis|klasse|klasserom|gruppe|grupp|friminutt|pause|lunsj|frokost|middag|kantine|overgang|presentasjon)/i;\n  const count = entries.filter((e) => {\n    const txt = `${e.generalNotes || e.notes || ''} ${(e.environmentalData?.classroom?.activity || '')} ${(e.environmentalData?.location || '')} ${(e.environmentalData?.socialContext || '')}`;\n    const emoTxt = (e.emotions || []).map(em => `${em.notes || ''} ${(em.triggers || []).join(' ')}`).join(' ');\n    return socialRe.test(txt) || socialRe.test(emoTxt);\n  }).length;\n  const needed = Math.max(0, min - count);\n  if (needed === 0) return;\n\n  const scenarios: Array<'gruppe' | 'friminutt' | 'kantine' | 'presentasjon' | 'overgang'> = ['gruppe', 'friminutt', 'kantine', 'presentasjon', 'overgang'];\n  for (let i = 0; i < needed; i++) {\n    const ts = new Date(Date.now() - (i + 1) * 3 * 36e5); // every ~3 hours back\n    const e: TrackingEntry = {\n      id: generateId(`tracking_${student.id}`),\n      studentId: student.id,\n      timestamp: ts,\n      emotions: [generateEmotionEntry(student.id, ts, 'anxious')],\n      sensoryInputs: [],\n      environmentalData: {},\n      generalNotes: '',\n    } as TrackingEntry;\n    // Always high enough intensity and social trigger\n    e.emotions[0].intensity = Math.max(4, e.emotions[0].intensity || 4);\n    e.emotions[0].triggers = Array.from(new Set([...(e.emotions[0].triggers || []), 'sosial interaksjon']));\n\n    // Cycle through scenarios to diversify examples\n    const t = scenarios[i % scenarios.length];\n    switch (t) {\n      case 'gruppe':\n        e.environmentalData = { ...(e.environmentalData || {}), location: 'classroom', socialContext: 'Gruppearbeid', classroom: { activity: 'group-work', timeOfDay: 'morning' } } as any;\n        e.generalNotes = 'Sosial situasjon: gruppeoppgave i klasserommet (gruppe/samarbeid).';\n        e.emotions[0].triggers?.push('gruppearbeid');\n        break;\n      case 'friminutt':\n        e.environmentalData = { ...(e.environmentalData || {}), location: 'playground', socialContext: 'Friminutt', classroom: { activity: 'free-time', timeOfDay: 'afternoon' } } as any;\n        e.generalNotes = 'Friminutt med venner; noe konflikt og uro.';\n        e.emotions[0].triggers?.push('friminutt');\n        break;\n      case 'kantine':\n        e.environmentalData = { ...(e.environmentalData || {}), location: 'cafeteria', socialContext: 'Lunsj/kantine', roomConditions: { noiseLevel: 4, lighting: 'bright' } } as any;\n        e.generalNotes = 'Lunsj i kantinen; høy lyd og tett sosialt miljø.';\n        e.emotions[0].triggers?.push('kantine', 'lunsj');\n        break;\n      case 'presentasjon':\n        e.environmentalData = { ...(e.environmentalData || {}), location: 'classroom', socialContext: 'Presentasjon', classroom: { activity: 'instruction', timeOfDay: 'morning' } } as any;\n        e.generalNotes = 'Presentasjon foran klassen; sosial eksponering.';\n        e.emotions[0].triggers?.push('presentasjon');\n        break;\n      case 'overgang':\n        e.environmentalData = { ...(e.environmentalData || {}), location: 'hallway', socialContext: 'Overgang', classroom: { activity: 'transition', timeOfDay: 'afternoon' } } as any;\n        e.generalNotes = 'Overgang fra friminutt til time; stress i korridor.';\n        e.emotions[0].triggers?.push('overgang');\n        break;\n    }\n    entries.push(e);\n  }\n}\n\n\n// Generate realistic emotion entry\nexport const generateEmotionEntry = (studentId: string, timestamp: Date, emotionBias?: string): EmotionEntry => {\n  const emotions = ['happy', 'sad', 'anxious', 'calm', 'excited', 'frustrated', 'content'];\n  const biasedEmotion = emotionBias || emotions[Math.floor(Math.random() * emotions.length)];\n  \n  // Generate intensity based on emotion type\n  const intensityMap: Record<string, [number, number]> = {\n    'happy': [3, 5],\n    'sad': [2, 4],\n    'anxious': [3, 5],\n    'calm': [2, 4],\n    'excited': [4, 5],\n    'frustrated': [3, 5],\n    'content': [2, 4],\n    'overwhelmed': [4, 5]\n  };\n  \n  const [minIntensity, maxIntensity] = intensityMap[biasedEmotion] || [2, 4];\n  const intensity = Math.floor(Math.random() * (maxIntensity - minIntensity + 1)) + minIntensity;\n  \n  const entry: EmotionEntry = {\n    id: generateId('emotion'),\n    studentId,\n    timestamp,\n    emotion: biasedEmotion,\n    intensity,\n    triggers: Math.random() > 0.7 ? ['environmental change', 'social interaction'] : [],\n    notes: Math.random() > 0.8 ? `Student seemed ${biasedEmotion} during this period` : ''\n  };\n  \n  // Validate the generated entry\n  const validationResult = validateEmotionEntry(entry);\n  if (!validationResult.isValid) {\n    logger.error('Generated invalid emotion entry:', entry, validationResult.errors);\n    throw new Error('Failed to generate valid emotion entry');\n  }\n  \n  return entry;\n};\n\n// Generate realistic sensory entry\nexport const generateSensoryEntry = (studentId: string, timestamp: Date, seeking?: boolean): SensoryEntry => {\n  const sensoryTypes = ['visual', 'auditory', 'tactile', 'vestibular', 'proprioceptive'];\n  const type = sensoryTypes[Math.floor(Math.random() * sensoryTypes.length)];\n  \n  // Determine response based on seeking behavior\n  const responses = seeking ? ['seeking', 'engaging', 'exploring'] : ['avoiding', 'withdrawing', 'defensive'];\n  const response = responses[Math.floor(Math.random() * responses.length)];\n  \n  const intensity = Math.floor(Math.random() * 5) + 1;\n  \n  const entry: SensoryEntry = {\n    id: generateId('sensory'),\n    studentId,\n    timestamp,\n    type,\n    sensoryType: type,\n    response,\n    intensity,\n    notes: Math.random() > 0.8 ? `${type} input was ${response}` : ''\n  };\n  \n  // Validate the generated entry\n  const validationResult = validateSensoryEntry(entry);\n  if (!validationResult.isValid) {\n    logger.error('Generated invalid sensory entry:', entry, validationResult.errors);\n    throw new Error('Failed to generate valid sensory entry');\n  }\n  \n  return entry;\n};\n\n// Generate environmental entry\nconst generateEnvironmentalEntry = (timestamp: Date, correlationFactors?: { noise?: boolean; bright?: boolean }): EnvironmentalEntry => {\n  const factors = correlationFactors || {};\n  \n  return {\n    id: generateId('env'),\n    timestamp,\n    location: ['classroom', 'library', 'cafeteria', 'playground', 'hallway'][Math.floor(Math.random() * 5)],\n    socialContext: ['individual work', 'group activity', 'instruction', 'transition'][Math.floor(Math.random() * 4)],\n    roomConditions: {\n      noiseLevel: factors.noise !== undefined ? (factors.noise ? 4 : 2) : Math.floor(Math.random() * 5) + 1,\n      lighting: factors.bright !== undefined ? (factors.bright ? 'bright' : 'dim') : ['bright', 'moderate', 'dim'][Math.floor(Math.random() * 3)],\n      temperature: Math.floor(Math.random() * 10) + 18, // 18-28°C\n      humidity: Math.floor(Math.random() * 20) + 40 // 40-60%\n    },\n    weather: {\n      condition: ['sunny', 'cloudy', 'rainy', 'stormy', 'snowy'][Math.floor(Math.random() * 5)] as 'sunny' | 'cloudy' | 'rainy' | 'stormy' | 'snowy',\n      temperature: Math.floor(Math.random() * 15) + 10, // 10-25°C\n      pressure: Math.floor(Math.random() * 50) + 1000 // 1000-1050 hPa\n    },\n    classroom: {\n      activity: ['instruction', 'transition', 'free-time', 'testing', 'group-work'][Math.floor(Math.random() * 5)] as 'instruction' | 'transition' | 'free-time' | 'testing' | 'group-work',\n      studentCount: Math.floor(Math.random() * 20) + 10, // 10-30 students\n      timeOfDay: ['morning', 'afternoon', 'evening'][Math.floor(Math.random() * 3)] as 'morning' | 'afternoon' | 'evening'\n    },\n    notes: Math.random() > 0.9 ? 'Notable environmental conditions' : ''\n  };\n};\n\n// Generate tracking entry for a student based on scenario\nexport const generateTrackingEntry = (student: Student, daysAgo: number, scenario: 'emma' | 'lars' | 'astrid'): TrackingEntry => {\n  const timestamp = getRandomDate(daysAgo, 0.5);\n  \n  const entry: TrackingEntry = {\n    id: generateId(`tracking_${student.id}`),\n    studentId: student.id,\n    timestamp,\n    emotions: [],\n    sensoryInputs: [],\n    environmentalData: generateEnvironmentalEntry(timestamp),\n    notes: ''\n  };\n\n  // Generate scenario-specific data\n  switch (scenario) {\n    case 'emma': // Mild anxiety patterns with improvement over time\n      {\n        const dayIndex = Math.max(0, 90 - daysAgo); // 90 days of improvement\n        const anxietyLevel = Math.max(1, 4 - (dayIndex * 0.02)); // Gradual improvement\n        \n        // Generate consistent emotion patterns for detection\n        // Recent days should have more consistent patterns\n        if (daysAgo < 30) {\n          // For recent data, create a more consistent pattern\n          if (daysAgo < 7) {\n            // Very recent: mostly anxious with high intensity to trigger high-intensity pattern\n            entry.emotions.push(generateEmotionEntry(student.id, timestamp, 'anxious'));\n            // Ensure some have high intensity (4-5)\n            if (entry.emotions[0].intensity < 4 && Math.random() > 0.5) {\n              entry.emotions[0].intensity = 4;\n            }\n          } else {\n            // Still recent: mix of anxious and calm showing improvement\n            const emotion = Math.random() > 0.6 ? 'calm' : 'anxious';\n            entry.emotions.push(generateEmotionEntry(student.id, timestamp, emotion));\n          }\n        } else {\n          // Older data: use original pattern\n          entry.emotions.push(generateEmotionEntry(student.id, timestamp, \n            Math.random() > anxietyLevel / 5 ? 'calm' : 'anxious'));\n        }\n        \n        // Add sensory seeking behaviors that correlate with emotions\n        entry.sensoryInputs.push(generateSensoryEntry(student.id, timestamp, \n          entry.emotions[0].emotion === 'anxious'));\n        \n        // Add additional emotions occasionally\n        if (Math.random() > 0.7) {\n          entry.emotions.push(generateEmotionEntry(student.id, timestamp, 'content'));\n        }\n        \n        // For very recent entries, sometimes add multiple emotions\n        if (daysAgo < 5 && Math.random() > 0.6) {\n          entry.emotions.push(generateEmotionEntry(student.id, timestamp, 'frustrated'));\n        }\n\n        // Add realistic social context frequently so \"sosiale triggere\" can be answered\n        if (Math.random() < 0.6) {\n          applyEmmaSocialContext(entry);\n        }\n      }\n      break;\n      \n    case 'lars': // Sensory processing challenges\n      {\n        // Lars has consistent sensory challenges with tactile sensitivity\n        // Create more consistent patterns for recent data\n        if (daysAgo < 30) {\n          // Recent data: strong sensory avoiding pattern\n          entry.sensoryInputs.push(generateSensoryEntry(student.id, timestamp, false)); // Consistent avoiding\n          \n          // Add more sensory entries for recent days to ensure pattern detection\n          if (daysAgo < 10 && Math.random() > 0.3) {\n            entry.sensoryInputs.push(generateSensoryEntry(student.id, timestamp, false)); // More avoiding\n          }\n          \n          // Emotions correlate strongly with sensory for recent data\n          const emotionType = daysAgo < 7 ? 'frustrated' : \n            (Math.random() > 0.6 ? 'frustrated' : 'anxious');\n          entry.emotions.push(generateEmotionEntry(student.id, timestamp, emotionType));\n        } else {\n          // Older data: original pattern\n          entry.sensoryInputs.push(generateSensoryEntry(student.id, timestamp, false));\n          \n          if (Math.random() > 0.5) {\n            entry.sensoryInputs.push(generateSensoryEntry(student.id, timestamp, true));\n          }\n          \n          const sensoryIntensity = entry.sensoryInputs[0].intensity || 3;\n          const emotionType = sensoryIntensity > 3 ? \n            (Math.random() > 0.6 ? 'frustrated' : 'anxious') : \n            (Math.random() > 0.5 ? 'calm' : 'content');\n          entry.emotions.push(generateEmotionEntry(student.id, timestamp, emotionType));\n        }\n        \n        // Environmental correlation - noise affects Lars significantly\n        if (entry.environmentalData?.roomConditions?.noiseLevel && entry.environmentalData.roomConditions.noiseLevel > 3) {\n          entry.emotions.push(generateEmotionEntry(student.id, timestamp, 'overwhelmed'));\n          // Make sure overwhelmed has high intensity\n          const lastEmotion = entry.emotions[entry.emotions.length - 1];\n          if (lastEmotion.intensity < 4) {\n            lastEmotion.intensity = 4;\n          }\n        }\n      }\n      break;\n      \n    case 'astrid': // Steady improvement and positive patterns\n      {\n        const dayIndex = Math.max(0, 120 - daysAgo); // 120 days of data\n        const progressFactor = dayIndex / 120;\n        \n        // For recent data, ensure consistent positive patterns\n        if (daysAgo < 30) {\n          // Recent: mostly positive emotions showing clear improvement\n          const positiveEmotions = ['happy', 'content', 'excited', 'calm'];\n          const selectedEmotion = positiveEmotions[Math.floor(Math.random() * positiveEmotions.length)];\n          entry.emotions.push(generateEmotionEntry(student.id, timestamp, selectedEmotion));\n          \n          // Add sensory seeking pattern for recent data\n          entry.sensoryInputs.push(generateSensoryEntry(student.id, timestamp, true)); // Consistent seeking\n          \n          // Add more data points for very recent entries\n          if (daysAgo < 7) {\n            entry.emotions.push(generateEmotionEntry(student.id, timestamp, 'happy'));\n            if (Math.random() > 0.5) {\n              entry.sensoryInputs.push(generateSensoryEntry(student.id, timestamp, true));\n            }\n          }\n        } else {\n          // Older data: original progression pattern\n          const emotionTypes = progressFactor > 0.7 ? \n            ['happy', 'content', 'excited'] : \n            progressFactor > 0.4 ? \n              ['calm', 'content', 'anxious'] : \n              ['anxious', 'frustrated', 'frustrated'];\n              \n          const selectedEmotion = emotionTypes[Math.floor(Math.random() * emotionTypes.length)];\n          entry.emotions.push(generateEmotionEntry(student.id, timestamp, selectedEmotion));\n          \n          // Sensory seeking increases with confidence\n          const seekingProbability = 0.3 + (progressFactor * 0.4);\n          entry.sensoryInputs.push(generateSensoryEntry(student.id, timestamp, \n            Math.random() < seekingProbability));\n        }\n        \n        // Occasionally add multiple entries for comprehensive tracking\n        if (Math.random() > 0.6) {\n          entry.emotions.push(generateEmotionEntry(student.id, timestamp, 'content'));\n        }\n      }\n      break;\n  }\n\n  // Add notes based on the generated data\n  if (entry.emotions.length > 1 || entry.sensoryInputs.length > 1) {\n    entry.notes = `Complex session with multiple ${entry.emotions.length > 1 ? 'emotional states' : 'sensory needs'}`;\n  }\n\n  return entry;\n};\n\n// Generate mock students\nexport const generateMockStudents = (): Student[] => {\n  const createMockGoal = (studentId: string, title: string, description: string): Goal => {\n    const progress = Math.floor(Math.random() * 50) + 25;\n    return {\n      id: generateId('goal'),\n      studentId,\n      title,\n      description,\n      category: 'sensory' as const,\n      targetDate: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000), // 90 days from now\n      createdDate: new Date(),\n      updatedAt: new Date(),\n      status: 'active' as const,\n      measurableObjective: description,\n      currentProgress: progress,\n      progress,\n      milestones: [],\n      interventions: [],\n      dataPoints: []\n    };\n  };\n\n  const students: Student[] = [\n    {\n      id: 'mock_emma_001',\n      name: 'Emma Larsen',\n      grade: '8',\n      dateOfBirth: new Date('2011-03-15').toISOString().split('T')[0],\n      notes: 'Mild anxiety, responds well to sensory breaks',\n      iepGoals: [\n        createMockGoal('mock_emma_001', 'Reduce anxiety episodes', 'Reduce anxiety episodes through sensory regulation'),\n        createMockGoal('mock_emma_001', 'Improve emotional self-awareness', 'Improve emotional self-awareness through tracking')\n      ],\n      createdAt: new Date('2024-01-15'),\n      lastUpdated: new Date(),\n      version: 1\n    },\n    {\n      id: 'mock_lars_002',\n      name: 'Lars Andersen',\n      grade: '6',\n      dateOfBirth: new Date('2013-08-22').toISOString().split('T')[0],\n      notes: 'Sensory processing disorder, tactile defensiveness',\n      iepGoals: [\n        createMockGoal('mock_lars_002', 'Increase tactile tolerance', 'Increase tactile tolerance through gradual exposure'),\n        createMockGoal('mock_lars_002', 'Develop sensory self-regulation', 'Develop sensory self-regulation strategies')\n      ],\n      createdAt: new Date('2024-02-01'),\n      lastUpdated: new Date(),\n      version: 1\n    },\n    {\n      id: 'mock_astrid_003',\n      name: 'Astrid Berg',\n      grade: '9',\n      dateOfBirth: new Date('2010-11-08').toISOString().split('T')[0],\n      notes: 'ADHD, benefits from sensory input for focus',\n      iepGoals: [\n        createMockGoal('mock_astrid_003', 'Improve attention span', 'Improve attention span through sensory strategies'),\n        createMockGoal('mock_astrid_003', 'Develop independent self-regulation', 'Develop independent self-regulation skills')\n      ],\n      createdAt: new Date('2024-01-20'),\n      lastUpdated: new Date(),\n      version: 1\n    }\n  ];\n\n  return students;\n};\n\n// Generate tracking data for a student\nconst generateTrackingDataForStudent = (student: Student, scenario: 'emma' | 'lars' | 'astrid'): TrackingEntry[] => {\n  const entries: TrackingEntry[] = [];\n  const totalDays = Math.floor(Math.random() * 30) + 60; // 60-90 days of data\n  \n  // Ensure more recent data for pattern detection\n  for (let i = 0; i < totalDays; i++) {\n    let entriesPerDay: number;\n    \n    // Generate more entries for recent days to ensure pattern detection works\n    if (i < 7) {\n      // Last 7 days: 2-4 entries per day\n      entriesPerDay = Math.floor(Math.random() * 3) + 2;\n    } else if (i < 30) {\n      // Last 30 days: 1-3 entries per day with high probability\n      entriesPerDay = Math.random() > 0.2 ? Math.floor(Math.random() * 3) + 1 : 0;\n    } else {\n      // Older than 30 days: 0-2 entries per day with lower probability\n      entriesPerDay = Math.random() > 0.5 ? Math.floor(Math.random() * 2) + 1 : 0;\n    }\n    \n    for (let j = 0; j < entriesPerDay; j++) {\n      const daysAgo = i + (j * 0.3); // Spread entries throughout the day\n      entries.push(generateTrackingEntry(student, daysAgo, scenario));\n    }\n  }\n  \n  // Guarantee a baseline of social examples for Emma\n  if (scenario === 'emma') {\n    try {\n      ensureEmmaSocialBaseline(entries, student, 6);\n    } catch {\n      // fail-soft; baseline is optional\n    }\n  }\n\n  return entries.sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime());\n};\n\n// Generate all mock data\nexport const generateAllMockData = (): { students: Student[]; trackingEntries: TrackingEntry[] } => {\n  const students = generateMockStudents();\n  const trackingEntries: TrackingEntry[] = [];\n  \n  const scenarios: Array<'emma' | 'lars' | 'astrid'> = ['emma', 'lars', 'astrid'];\n  \n  students.forEach((student, index) => {\n    const scenario = scenarios[index];\n    const studentEntries = generateTrackingDataForStudent(student, scenario);\n    trackingEntries.push(...studentEntries);\n  });\n  \n  return { students, trackingEntries };\n};\n\n/**\n * Load a specific scenario's mock data into storage.\n * This is a library-only helper that clears existing mock data and seeds a single\n * student's dataset matching the given scenario. It is safe and non-breaking for\n * consumers that still call loadMockDataToStorage().\n */\nexport function loadScenarioDataToStorage(scenario: 'emma' | 'lars' | 'astrid'): void {\n  try {\n    // Remove previously seeded mock data while preserving real data\n    clearMockDataFromStorage();\n\n    const students = generateMockStudents();\n    const selected = students.find(s => s.name.toLowerCase().includes(scenario));\n    if (!selected) {\n      throw new Error(`Student not found for scenario: ${scenario}`);\n    }\n\n    // Save the selected student first\n    dataStorage.saveStudent(selected);\n\n    // Generate and persist tracking entries for this scenario\n    const entries = generateTrackingDataForStudent(selected, scenario);\n    for (const entry of entries) {\n      // Validate before saving to prevent corrupt data\n      const trackingValidation = validateTrackingEntry(entry);\n      if (!trackingValidation.isValid) {\n        logger.error('Generated invalid tracking entry for scenario', { scenario, entry, errors: trackingValidation.errors });\n        continue; // Skip invalid entries rather than failing entire load\n      }\n      dataStorage.saveTrackingEntry(entry);\n    }\n  } catch (error) {\n    logger.error('Failed to load scenario data', error);\n    throw new Error('Failed to initialize scenario data');\n  }\n}\n\nexport function loadMockDataToStorage(): void {\n  try {\n    // Clear only existing mock data first\n    clearMockDataFromStorage();\n    \n    const { students, trackingEntries } = generateAllMockData();\n    \n    // Save students\n    students.forEach(student => {\n      const studentValidation = validateStudent(student as any);\n      if (!studentValidation.isValid) {\n        logger.warn('Skipping invalid student in mock load', { student });\n        return;\n      }\n      dataStorage.saveStudent(student);\n    });\n    \n    // Save tracking entries\n    trackingEntries.forEach(entry => {\n      const trackingValidation = validateTrackingEntry(entry as any);\n      if (!trackingValidation.isValid) {\n        logger.error('Generated invalid tracking entry during bulk mock load', { entry, errors: trackingValidation.errors });\n        return; // Skip invalid entries\n      }\n      dataStorage.saveTrackingEntry(entry);\n    });\n  } catch (error) {\n    logger.error('Failed to load mock data:', error);\n    throw new Error('Failed to initialize mock data');\n  }\n}\n\nexport function clearMockDataFromStorage(): void {\n  try {\n    const allStudents = dataStorage.getStudents();\n    const allEntries = dataStorage.getTrackingEntries();\n    \n    // Filter out mock data\n    const nonMockStudents = allStudents.filter(student => !student.id.startsWith('mock_'));\n    const nonMockEntries = allEntries.filter(entry => !entry.studentId.startsWith('mock_'));\n    \n    // Clear all data and re-save only non-mock data\n    dataStorage.clearAllData();\n    \n    // Restore non-mock data\n    nonMockStudents.forEach(student => dataStorage.saveStudent(student));\n    nonMockEntries.forEach(entry => dataStorage.saveTrackingEntry(entry));\n  } catch (error) {\n    logger.error('Failed to clear mock data:', error);\n    throw new Error('Failed to clear mock data');\n  }\n}","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/modelEvaluation.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setEvalCacheTTL' is defined but never used. Allowed unused vars must match /^_/u.","line":90,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":90,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Module: modelEvaluation\n *\n * Purpose\n * - Track and query model evaluation runs with metrics and cross-validation metadata\n * - Provide stable signatures for data/config to dedupe noisy writes\n *\n * Storage Strategy\n * - Primary: In-memory Map<ModelType, EvaluationRun[]> for fast reads\n * - Optional persistence: IndexedDB (db: 'model-eval', store: 'model-eval', keyPath: 'id')\n * - Fire-and-forget initialization and persistence; gracefully degrades to memory-only if IDB is unavailable\n * - Lightweight TTL+LRU in-process cache to avoid redundant records\n *\n * API (named exports)\n * - recordEvaluation(run: EvaluationRun): void\n * - getEvaluationHistory(modelType?: ModelType): EvaluationRun[]\n * - clearEvaluationHistory(modelType?: ModelType): void\n * - invalidateEvaluationCacheByTag(tag: string): void\n *\n * Notes\n * - Use logger for diagnostics (no console.*)\n * - Align schemaVersion with runtime analytics schema/versioning for forward compatibility\n */\n\nimport { logger } from '@/lib/logger';\nimport { createCacheKey, stableHash } from '@/lib/analytics/cache-key';\nimport type { ModelType } from '@/lib/mlModels';\n\n// Types\nexport interface ClassificationMetrics {\n  accuracy?: number;\n  precision?: number;\n  recall?: number;\n  f1?: number;\n  auc?: number;\n  confusionMatrix?: number[][];\n  perClass?: Record<string, { precision?: number; recall?: number; f1?: number; support?: number }>;\n}\n\nexport interface RegressionMetrics {\n  mae?: number;\n  mse?: number;\n  rmse?: number;\n  r2?: number;\n  mape?: number;\n}\n\nexport interface Metrics {\n  classification?: ClassificationMetrics;\n  regression?: RegressionMetrics;\n}\n\nexport interface CrossValidationMeta {\n  strategy: 'k-fold' | 'time-series' | 'holdout' | string;\n  folds?: number;        // for k-fold\n  horizon?: number;      // for time-series CV\n  windowSize?: number;   // for rolling-window strategies\n}\n\nexport interface EvaluationRun {\n  id: string;\n  modelType: ModelType;\n  timestamp: number; // epoch ms\n  dataSignature: string;   // stable fingerprint of training/validation data\n  configSignature: string; // stable fingerprint of the configuration used\n  taskType: 'classification' | 'regression' | string;\n  metrics: Metrics;\n  cv?: CrossValidationMeta;\n  notes?: string;\n  schemaVersion: string; // align with runtime analytics schema/versioning\n}\n\n// In-memory store, indexed by modelType for fast filtering\nconst memoryStore: Map<ModelType, EvaluationRun[]> = new Map();\n\n// Lightweight TTL + LRU cache to skip redundant recomputation/recording\n// Aligns with vcQlb4XB*: include input hashes in keys; purge by TTL and LRU; avoid leaks\ninterface EvalCacheEntry {\n  ts: number; // last seen timestamp (epoch ms)\n  tags: string[]; // e.g., ['model-eval', modelType, taskType]\n}\n\nconst EVAL_CACHE_NAMESPACE = 'model-eval';\nconst DEFAULT_TTL_MS = 5 * 60 * 1000; // 5 minutes\nconst MAX_CACHE_ENTRIES = 300; // LRU cap to avoid unbounded growth\n\nconst evalCache: Map<string, EvalCacheEntry> = new Map();\nlet evalCacheTTL = DEFAULT_TTL_MS;\n\nfunction setEvalCacheTTL(ttlMs: number): void {\n  evalCacheTTL = Math.max(0, ttlMs);\n}\n\nfunction makeEvalCacheKey(run: Pick<EvaluationRun, 'modelType' | 'taskType' | 'dataSignature' | 'configSignature' | 'schemaVersion'>): string {\n  // Include signatures and identifiers; counts are embedded when createCacheKey is used with structured input\n  return createCacheKey({\n    namespace: EVAL_CACHE_NAMESPACE,\n    input: {\n      mt: run.modelType,\n      task: run.taskType,\n      dataSig: run.dataSignature,\n      cfgSig: run.configSignature,\n    },\n    version: run.schemaVersion,\n    normalizeArrayOrder: false,\n  });\n}\n\nfunction touchEvalCache(key: string, tags: string[]): void {\n  // LRU behavior: delete+set to move to insertion order end\n  const now = Date.now();\n  if (evalCache.has(key)) {\n    evalCache.delete(key);\n  }\n  evalCache.set(key, { ts: now, tags });\n  // Enforce LRU cap\n  while (evalCache.size > MAX_CACHE_ENTRIES) {\n    const oldestKey = evalCache.keys().next().value as string | undefined;\n    if (!oldestKey) break;\n    evalCache.delete(oldestKey);\n  }\n}\n\nfunction isEvalCacheFresh(key: string): boolean {\n  const entry = evalCache.get(key);\n  if (!entry) return false;\n  const age = Date.now() - entry.ts;\n  if (age <= evalCacheTTL) return true;\n  // expired: drop it eagerly to keep map tidy\n  evalCache.delete(key);\n  return false;\n}\n\nexport function invalidateEvaluationCacheByTag(tag: string): void {\n  // Remove any cache entries whose tag array contains the tag (exact match)\n  for (const [k, v] of evalCache.entries()) {\n    if (v.tags.includes(tag)) {\n      evalCache.delete(k);\n    }\n  }\n}\n\n// IDB constants\nconst DB_NAME = 'model-eval';\nconst STORE_NAME = 'model-eval'; // single store with keyPath 'id'\nconst DB_VERSION = 1;\n\nlet idbAvailable = typeof indexedDB !== 'undefined';\nlet initStarted = false;\n\nfunction openDB(): Promise<IDBDatabase> {\n  if (!idbAvailable) return Promise.reject(new Error('IndexedDB not available'));\n  return new Promise((resolve, reject) => {\n    try {\n      const request = indexedDB.open(DB_NAME, DB_VERSION);\n\n      request.onupgradeneeded = (event) => {\n        try {\n          const db = (event.target as IDBOpenDBRequest).result;\n          if (!db.objectStoreNames.contains(STORE_NAME)) {\n            db.createObjectStore(STORE_NAME, { keyPath: 'id' });\n          }\n        } catch (err) {\n          logger.error('[modelEvaluation] onupgradeneeded failed', err);\n        }\n      };\n\n      request.onsuccess = () => resolve(request.result);\n      request.onerror = () => reject(request.error);\n    } catch (error) {\n      reject(error);\n    }\n  });\n}\n\nasync function loadAllFromIDB(): Promise<void> {\n  if (!idbAvailable) return;\n\n  try {\n    const db = await openDB();\n    await new Promise<void>((resolve, reject) => {\n      try {\n        const tx = db.transaction([STORE_NAME], 'readonly');\n        const store = tx.objectStore(STORE_NAME);\n        const req = store.openCursor();\n        req.onerror = () => reject(req.error);\n        req.onsuccess = () => {\n          const cursor = req.result as IDBCursorWithValue | null;\n          if (cursor) {\n            const run = cursor.value as EvaluationRun;\n            if (run && run.modelType) {\n              const list = memoryStore.get(run.modelType) ?? [];\n              list.push(run);\n              memoryStore.set(run.modelType, list);\n            }\n            cursor.continue();\n          } else {\n            resolve();\n          }\n        };\n      } catch (err) {\n        reject(err);\n      }\n    });\n    // Normalize: sort each list by timestamp desc\n    for (const [mt, list] of memoryStore.entries()) {\n      list.sort((a, b) => b.timestamp - a.timestamp);\n      memoryStore.set(mt, list);\n    }\n  } catch (error) {\n    idbAvailable = false; // fallback to memory only\n    logger.warn('[modelEvaluation] Failed to initialize from IndexedDB. Falling back to memory only.', error);\n  }\n}\n\nfunction ensureInit(): void {\n  if (initStarted) return;\n  initStarted = true;\n  // Fire-and-forget initialization; memory store remains usable\n  loadAllFromIDB().catch((err) => {\n    logger.warn('[modelEvaluation] Initialization load failed', err);\n  });\n}\n\n// Persistence helpers (fire-and-forget)\nasync function persistRun(run: EvaluationRun): Promise<void> {\n  if (!idbAvailable) return;\n  try {\n    const db = await openDB();\n    await new Promise<void>((resolve, reject) => {\n      const tx = db.transaction([STORE_NAME], 'readwrite');\n      const store = tx.objectStore(STORE_NAME);\n      const req = store.put(run);\n      req.onsuccess = () => resolve();\n      req.onerror = () => reject(req.error);\n    });\n  } catch (error) {\n    logger.warn('[modelEvaluation] persistRun failed', error);\n  }\n}\n\nasync function deleteRuns(modelType?: ModelType): Promise<void> {\n  if (!idbAvailable) return;\n  try {\n    const db = await openDB();\n    await new Promise<void>((resolve, reject) => {\n      const tx = db.transaction([STORE_NAME], 'readwrite');\n      const store = tx.objectStore(STORE_NAME);\n\n      if (!modelType) {\n        // Clear all\n        const req = store.clear();\n        req.onsuccess = () => resolve();\n        req.onerror = () => reject(req.error);\n        return;\n      }\n\n      // Delete only matching modelType (no index, iterate)\n      const cursorReq = store.openCursor();\n      cursorReq.onerror = () => reject(cursorReq.error);\n      cursorReq.onsuccess = () => {\n        const cursor = cursorReq.result as IDBCursorWithValue | null;\n        if (!cursor) { resolve(); return; }\n        const val = cursor.value as EvaluationRun;\n        if (val?.modelType === modelType) {\n          (cursor as IDBCursorWithValue).delete();\n        }\n        cursor.continue();\n      };\n    });\n  } catch (error) {\n    logger.warn('[modelEvaluation] deleteRuns failed', error);\n  }\n}\n\n// Signature utilities (internal)\nfunction computeStableSignature(namespace: string, input: unknown, version?: string): string {\n  try {\n    return createCacheKey({ namespace, input, version });\n  } catch {\n    // Fallback minimal stable hash if createCacheKey throws (e.g., cyclic input)\n    try {\n      const hash = stableHash(input);\n      return [namespace, version ? `v${version}` : undefined, hash].filter(Boolean).join(':');\n    } catch (err) {\n      logger.warn('[modelEvaluation] computeStableSignature failed; returning placeholder', err);\n      return `${namespace}:unknown`;\n    }\n  }\n}\n\n// Public API\nexport function recordEvaluation(run: EvaluationRun): void {\n  ensureInit();\n\n  if (!run || !run.id || !run.modelType || !run.timestamp) {\n    logger.warn('[modelEvaluation] recordEvaluation called with invalid run payload', { hasRun: !!run });\n    return;\n  }\n\n  // Ensure signatures are present; attempt to construct placeholders if missing\n  if (!run.dataSignature) {\n    const placeholder = computeStableSignature('model-eval:data', { id: run.id, ts: run.timestamp, mt: run.modelType }, run.schemaVersion);\n    run = { ...run, dataSignature: placeholder };\n  }\n  if (!run.configSignature) {\n    const placeholder = computeStableSignature('model-eval:config', { id: run.id, task: run.taskType, mt: run.modelType }, run.schemaVersion);\n    run = { ...run, configSignature: placeholder };\n  }\n\n  // Optional de-duplication: skip if an equivalent evaluation was just recorded within TTL\n  try {\n    const key = makeEvalCacheKey({\n      modelType: run.modelType,\n      taskType: run.taskType,\n      dataSignature: run.dataSignature,\n      configSignature: run.configSignature,\n      schemaVersion: run.schemaVersion,\n    });\n    if (isEvalCacheFresh(key)) {\n      logger.debug('[modelEvaluation] Skipping redundant evaluation record (cache fresh)', { key, ttlMs: evalCacheTTL });\n      return;\n    }\n    const tags = [EVAL_CACHE_NAMESPACE, String(run.modelType), String(run.taskType)];\n    touchEvalCache(key, tags);\n  } catch (err) {\n    // Never fail the caller on cache errors; just log and proceed\n    logger.warn('[modelEvaluation] eval cache key/touch failed; proceeding without skip', err);\n  }\n\n  // Insert into memory store (keep newest first)\n  const list = memoryStore.get(run.modelType) ?? [];\n  const existingIdx = list.findIndex((r) => r.id === run.id);\n  if (existingIdx >= 0) {\n    list[existingIdx] = run;\n  } else {\n    list.push(run);\n  }\n  list.sort((a, b) => b.timestamp - a.timestamp);\n  memoryStore.set(run.modelType, list);\n\n  // Persist asynchronously\n  void persistRun(run);\n}\n\nexport function getEvaluationHistory(modelType?: ModelType): EvaluationRun[] {\n  ensureInit();\n  if (!modelType) {\n    // Aggregate all\n    const all: EvaluationRun[] = [];\n    for (const arr of memoryStore.values()) all.push(...arr);\n    return all.sort((a, b) => b.timestamp - a.timestamp);\n  }\n  const list = memoryStore.get(modelType);\n  return (list ? [...list] : []).sort((a, b) => b.timestamp - a.timestamp);\n}\n\nexport function clearEvaluationHistory(modelType?: ModelType): void {\n  ensureInit();\n  if (!modelType) {\n    memoryStore.clear();\n    // Also clear cache entries for model-eval namespace\n    invalidateEvaluationCacheByTag(EVAL_CACHE_NAMESPACE);\n  } else {\n    memoryStore.delete(modelType);\n    // Invalidate cache entries for this model type\n    invalidateEvaluationCacheByTag(String(modelType));\n  }\n  // Fire-and-forget persistence clearing\n  void deleteRuns(modelType);\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/monitoring/modelDrift.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/patternAnalysis.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/preprocessing/facade.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/resolveCssColorVar.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/runtimeEnv.ts","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'no-var').","line":9,"column":3,"severity":1,"nodeType":null,"fix":{"range":[258,292],"text":" "}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[566,569],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[566,569],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":19,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[614,617],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[614,617],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[801,804],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[801,804],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[849,852],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[849,852],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":1,"source":"// Runtime env snapshot to avoid inconsistencies across modules/routes\nexport type ViteEnv = Record<string, unknown> & {\n  VITE_OPENROUTER_API_KEY?: string;\n  VITE_AI_MODEL_NAME?: string;\n  VITE_AI_ANALYSIS_ENABLED?: string | boolean;\n};\n\ndeclare global {\n  // eslint-disable-next-line no-var\n  var __RUNTIME_ENV__: ViteEnv | undefined;\n}\n\nexport function getRuntimeEnv(): ViteEnv {\n  try {\n    if (typeof globalThis !== 'undefined' && globalThis.__RUNTIME_ENV__) {\n      return globalThis.__RUNTIME_ENV__ as ViteEnv;\n    }\n    const env: ViteEnv = ((import.meta as any)?.env ?? {}) as ViteEnv;\n    (globalThis as any).__RUNTIME_ENV__ = env;\n    return env;\n  } catch {\n    return {} as ViteEnv;\n  }\n}\n\nexport function setRuntimeEnvFromVite(): void {\n  try {\n    const env: ViteEnv = ((import.meta as any)?.env ?? {}) as ViteEnv;\n    (globalThis as any).__RUNTIME_ENV__ = env;\n  } catch {\n    // noop\n  }\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/sessionManager.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":559,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":559,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16859,16862],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16859,16862],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":596,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":596,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17813,17816],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17813,17816],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { TrackingEntry, EmotionEntry, SensoryEntry, EnvironmentalEntry } from '@/types/student';\nimport { dataStorage } from '@/lib/dataStorage';\nimport { analyticsManager } from '@/lib/analyticsManager';\nimport { logger } from '@/lib/logger';\n\n/**\n * Session metadata for tracking and recovery\n */\nexport interface SessionMetadata {\n  id: string;\n  studentId: string;\n  startTime: Date;\n  endTime?: Date;\n  duration: number;\n  dataPoints: number;\n  status: 'active' | 'paused' | 'completed' | 'abandoned';\n  autoSaved: boolean;\n  quality: SessionQuality;\n}\n\n/**\n * Session quality assessment\n */\nexport interface SessionQuality {\n  score: number; // 0-100\n  completeness: number; // 0-100\n  consistency: number; // 0-100\n  richness: number; // 0-100\n  issues: string[];\n  recommendations: string[];\n}\n\n/**\n * Session recovery data\n */\nexport interface SessionRecoveryData {\n  sessionId: string;\n  studentId: string;\n  timestamp: Date;\n  data: {\n    emotions: Omit<EmotionEntry, 'id' | 'timestamp'>[];\n    sensoryInputs: Omit<SensoryEntry, 'id' | 'timestamp'>[];\n    environmentalData: Omit<EnvironmentalEntry, 'id' | 'timestamp'> | null;\n    notes: string;\n  };\n  metadata: SessionMetadata;\n}\n\n/**\n * Session validation rules\n */\nexport interface SessionValidationRules {\n  minEmotions?: number;\n  minSensoryInputs?: number;\n  requireEnvironmental?: boolean;\n  minDuration?: number; // milliseconds\n  maxDuration?: number; // milliseconds\n  requireNotes?: boolean;\n  customValidators?: Array<(session: SessionRecoveryData) => { isValid: boolean; error?: string }>;\n}\n\n/**\n * Session statistics\n */\nexport interface SessionStatistics {\n  totalSessions: number;\n  completedSessions: number;\n  abandonedSessions: number;\n  averageDuration: number;\n  averageDataPoints: number;\n  averageQuality: number;\n  mostCommonIssues: Array<{ issue: string; count: number }>;\n}\n\n/**\n * SessionManager class\n * Handles session lifecycle, persistence, validation, and recovery\n */\nexport class SessionManager {\n  private static instance: SessionManager;\n  private activeSessions: Map<string, SessionRecoveryData> = new Map();\n  private sessionHistory: SessionMetadata[] = [];\n  private validationRules: SessionValidationRules = {\n    minEmotions: 0,\n    minSensoryInputs: 0,\n    requireEnvironmental: false,\n    minDuration: 60000, // 1 minute\n    maxDuration: 2 * 60 * 60 * 1000, // 2 hours\n    requireNotes: false,\n  };\n\n  private constructor() {\n    this.loadSessionHistory();\n    this.checkForAbandonedSessions();\n  }\n\n  /**\n   * Get singleton instance\n   */\n  static getInstance(): SessionManager {\n    if (!SessionManager.instance) {\n      SessionManager.instance = new SessionManager();\n    }\n    return SessionManager.instance;\n  }\n\n  /**\n   * Create a new session\n   */\n  createSession(studentId: string): string {\n    const sessionId = crypto.randomUUID();\n    const now = new Date();\n\n    const sessionData: SessionRecoveryData = {\n      sessionId,\n      studentId,\n      timestamp: now,\n      data: {\n        emotions: [],\n        sensoryInputs: [],\n        environmentalData: null,\n        notes: '',\n      },\n      metadata: {\n        id: sessionId,\n        studentId,\n        startTime: now,\n        duration: 0,\n        dataPoints: 0,\n        status: 'active',\n        autoSaved: false,\n        quality: {\n          score: 0,\n          completeness: 0,\n          consistency: 0,\n          richness: 0,\n          issues: [],\n          recommendations: ['Start by recording emotions', 'Add sensory observations'],\n        },\n      },\n    };\n\n    this.activeSessions.set(sessionId, sessionData);\n    this.persistSession(sessionData);\n\n    logger.info('[SessionManager] Created new session', { sessionId, studentId });\n    return sessionId;\n  }\n\n  /**\n   * Update session data\n   */\n  updateSession(\n    sessionId: string,\n    updates: Partial<{\n      emotions: Omit<EmotionEntry, 'id' | 'timestamp'>[];\n      sensoryInputs: Omit<SensoryEntry, 'id' | 'timestamp'>[];\n      environmentalData: Omit<EnvironmentalEntry, 'id' | 'timestamp'> | null;\n      notes: string;\n    }>\n  ): boolean {\n    const session = this.activeSessions.get(sessionId);\n    if (!session) {\n      logger.warn('[SessionManager] Session not found', { sessionId });\n      return false;\n    }\n\n    // Update data\n    if (updates.emotions) session.data.emotions = updates.emotions;\n    if (updates.sensoryInputs) session.data.sensoryInputs = updates.sensoryInputs;\n    if (updates.environmentalData !== undefined) session.data.environmentalData = updates.environmentalData;\n    if (updates.notes !== undefined) session.data.notes = updates.notes;\n\n    // Update metadata\n    session.metadata.duration = Date.now() - session.metadata.startTime.getTime();\n    session.metadata.dataPoints = \n      session.data.emotions.length + \n      session.data.sensoryInputs.length + \n      (session.data.environmentalData ? 1 : 0);\n\n    // Assess quality\n    session.metadata.quality = this.assessQuality(session);\n\n    // Persist changes\n    this.persistSession(session);\n\n    logger.debug('[SessionManager] Updated session', { sessionId, updates });\n    return true;\n  }\n\n  /**\n   * Complete a session\n   */\n  async completeSession(sessionId: string): Promise<TrackingEntry | null> {\n    const session = this.activeSessions.get(sessionId);\n    if (!session) {\n      logger.warn('[SessionManager] Session not found', { sessionId });\n      return null;\n    }\n\n    // Validate session\n    const validation = this.validateSession(session);\n    if (!validation.isValid) {\n      logger.warn('[SessionManager] Session validation failed', { \n        sessionId, \n        errors: validation.errors \n      });\n      return null;\n    }\n\n    // Create tracking entry\n    const timestamp = new Date();\n    const trackingEntry: TrackingEntry = {\n      id: crypto.randomUUID(),\n      studentId: session.studentId,\n      timestamp,\n      emotions: session.data.emotions.map(e => ({\n        ...e,\n        id: crypto.randomUUID(),\n        timestamp,\n      })),\n      sensoryInputs: session.data.sensoryInputs.map(s => ({\n        ...s,\n        id: crypto.randomUUID(),\n        timestamp,\n      })),\n      environmentalData: session.data.environmentalData ? {\n        ...session.data.environmentalData,\n        id: crypto.randomUUID(),\n        timestamp,\n      } : undefined,\n      notes: session.data.notes || undefined,\n      generalNotes: session.data.notes || undefined,\n      version: 1,\n    };\n\n    // Save to storage\n    dataStorage.saveTrackingEntry(trackingEntry);\n\n    // Update session metadata\n    session.metadata.endTime = timestamp;\n    session.metadata.status = 'completed';\n    this.sessionHistory.push(session.metadata);\n    this.saveSessionHistory();\n\n    // Remove from active sessions\n    this.activeSessions.delete(sessionId);\n    this.clearPersistedSession(sessionId);\n\n    // Trigger analytics\n    const student = dataStorage.getStudentById(session.studentId);\n    if (student) {\n      await analyticsManager.triggerAnalyticsForStudent(student);\n    }\n\n    logger.info('[SessionManager] Completed session', { \n      sessionId, \n      entryId: trackingEntry.id \n    });\n\n    return trackingEntry;\n  }\n\n  /**\n   * Abandon a session\n   */\n  abandonSession(sessionId: string): void {\n    const session = this.activeSessions.get(sessionId);\n    if (!session) return;\n\n    session.metadata.endTime = new Date();\n    session.metadata.status = 'abandoned';\n    this.sessionHistory.push(session.metadata);\n    this.saveSessionHistory();\n\n    this.activeSessions.delete(sessionId);\n    this.clearPersistedSession(sessionId);\n\n    logger.info('[SessionManager] Abandoned session', { sessionId });\n  }\n\n  /**\n   * Pause a session\n   */\n  pauseSession(sessionId: string): boolean {\n    const session = this.activeSessions.get(sessionId);\n    if (!session || session.metadata.status !== 'active') return false;\n\n    session.metadata.status = 'paused';\n    this.persistSession(session);\n\n    logger.info('[SessionManager] Paused session', { sessionId });\n    return true;\n  }\n\n  /**\n   * Resume a session\n   */\n  resumeSession(sessionId: string): boolean {\n    const session = this.activeSessions.get(sessionId);\n    if (!session || session.metadata.status !== 'paused') return false;\n\n    session.metadata.status = 'active';\n    this.persistSession(session);\n\n    logger.info('[SessionManager] Resumed session', { sessionId });\n    return true;\n  }\n\n  /**\n   * Recover sessions from localStorage\n   */\n  recoverSessions(): SessionRecoveryData[] {\n    const recovered: SessionRecoveryData[] = [];\n    const keys = Object.keys(localStorage).filter(k => \n      k.startsWith('sensoryTracker_session_')\n    );\n\n    for (const key of keys) {\n      try {\n        const data = localStorage.getItem(key);\n        if (data) {\n          const session = JSON.parse(data) as SessionRecoveryData;\n          // Convert date strings back to Date objects\n          session.timestamp = new Date(session.timestamp);\n          session.metadata.startTime = new Date(session.metadata.startTime);\n          if (session.metadata.endTime) {\n            session.metadata.endTime = new Date(session.metadata.endTime);\n          }\n          \n          // Check if session is not too old (24 hours)\n          const age = Date.now() - session.metadata.startTime.getTime();\n          if (age < 24 * 60 * 60 * 1000) {\n            this.activeSessions.set(session.sessionId, session);\n            recovered.push(session);\n          } else {\n            // Mark as abandoned and clean up\n            session.metadata.status = 'abandoned';\n            this.sessionHistory.push(session.metadata);\n            localStorage.removeItem(key);\n          }\n        }\n      } catch (error) {\n        logger.error('[SessionManager] Failed to recover session', { key, error });\n        localStorage.removeItem(key);\n      }\n    }\n\n    if (recovered.length > 0) {\n      this.saveSessionHistory();\n      logger.info('[SessionManager] Recovered sessions', { count: recovered.length });\n    }\n\n    return recovered;\n  }\n\n  /**\n   * Get active sessions for a student\n   */\n  getActiveSessionsForStudent(studentId: string): SessionRecoveryData[] {\n    return Array.from(this.activeSessions.values()).filter(\n      session => session.studentId === studentId && session.metadata.status === 'active'\n    );\n  }\n\n  /**\n   * Get session statistics\n   */\n  getStatistics(studentId?: string): SessionStatistics {\n    const relevantHistory = studentId \n      ? this.sessionHistory.filter(s => s.studentId === studentId)\n      : this.sessionHistory;\n\n    const completed = relevantHistory.filter(s => s.status === 'completed');\n    const abandoned = relevantHistory.filter(s => s.status === 'abandoned');\n\n    // Count issues\n    const issueCount = new Map<string, number>();\n    relevantHistory.forEach(session => {\n      session.quality.issues.forEach(issue => {\n        issueCount.set(issue, (issueCount.get(issue) || 0) + 1);\n      });\n    });\n\n    const mostCommonIssues = Array.from(issueCount.entries())\n      .map(([issue, count]) => ({ issue, count }))\n      .sort((a, b) => b.count - a.count)\n      .slice(0, 5);\n\n    return {\n      totalSessions: relevantHistory.length,\n      completedSessions: completed.length,\n      abandonedSessions: abandoned.length,\n      averageDuration: completed.length > 0\n        ? completed.reduce((sum, s) => sum + s.duration, 0) / completed.length\n        : 0,\n      averageDataPoints: completed.length > 0\n        ? completed.reduce((sum, s) => sum + s.dataPoints, 0) / completed.length\n        : 0,\n      averageQuality: completed.length > 0\n        ? completed.reduce((sum, s) => sum + s.quality.score, 0) / completed.length\n        : 0,\n      mostCommonIssues,\n    };\n  }\n\n  /**\n   * Validate a session\n   */\n  private validateSession(session: SessionRecoveryData): { isValid: boolean; errors: string[] } {\n    const errors: string[] = [];\n    const rules = this.validationRules;\n\n    // Check minimum data requirements\n    if (rules.minEmotions && session.data.emotions.length < rules.minEmotions) {\n      errors.push(`At least ${rules.minEmotions} emotion(s) required`);\n    }\n\n    if (rules.minSensoryInputs && session.data.sensoryInputs.length < rules.minSensoryInputs) {\n      errors.push(`At least ${rules.minSensoryInputs} sensory input(s) required`);\n    }\n\n    if (rules.requireEnvironmental && !session.data.environmentalData) {\n      errors.push('Environmental data is required');\n    }\n\n    if (rules.requireNotes && !session.data.notes.trim()) {\n      errors.push('Notes are required');\n    }\n\n    // Check duration\n    const duration = Date.now() - session.metadata.startTime.getTime();\n    if (rules.minDuration && duration < rules.minDuration) {\n      errors.push(`Session too short (minimum ${rules.minDuration / 1000} seconds)`);\n    }\n\n    if (rules.maxDuration && duration > rules.maxDuration) {\n      errors.push(`Session too long (maximum ${rules.maxDuration / 1000} seconds)`);\n    }\n\n    // Custom validators\n    if (rules.customValidators) {\n      for (const validator of rules.customValidators) {\n        const result = validator(session);\n        if (!result.isValid && result.error) {\n          errors.push(result.error);\n        }\n      }\n    }\n\n    // Require at least some data\n    const totalData = session.data.emotions.length + session.data.sensoryInputs.length;\n    if (totalData === 0) {\n      errors.push('Session must contain at least one data point');\n    }\n\n    return { isValid: errors.length === 0, errors };\n  }\n\n  /**\n   * Assess session quality\n   */\n  private assessQuality(session: SessionRecoveryData): SessionQuality {\n    const issues: string[] = [];\n    const recommendations: string[] = [];\n\n    // Calculate completeness\n    let completeness = 0;\n    if (session.data.emotions.length > 0) completeness += 30;\n    if (session.data.sensoryInputs.length > 0) completeness += 30;\n    if (session.data.environmentalData) completeness += 20;\n    if (session.data.notes.length > 20) completeness += 20;\n\n    // Calculate consistency\n    const consistency = this.calculateConsistency(session);\n\n    // Calculate richness\n    const richness = this.calculateRichness(session);\n\n    // Overall score\n    const score = (completeness * 0.4 + consistency * 0.3 + richness * 0.3);\n\n    // Generate issues and recommendations\n    if (session.data.emotions.length === 0) {\n      issues.push('No emotions recorded');\n      recommendations.push('Record at least one emotion');\n    }\n\n    if (session.data.sensoryInputs.length === 0) {\n      issues.push('No sensory inputs recorded');\n      recommendations.push('Add sensory observations');\n    }\n\n    if (!session.data.environmentalData) {\n      issues.push('No environmental data');\n      recommendations.push('Record environmental conditions');\n    }\n\n    if (session.data.notes.length < 10) {\n      issues.push('Minimal or no notes');\n      recommendations.push('Add descriptive notes about the session');\n    }\n\n    const duration = Date.now() - session.metadata.startTime.getTime();\n    if (duration < 2 * 60 * 1000) { // Less than 2 minutes\n      issues.push('Very short session');\n      recommendations.push('Spend more time observing and recording');\n    }\n\n    return {\n      score,\n      completeness,\n      consistency,\n      richness,\n      issues,\n      recommendations,\n    };\n  }\n\n  /**\n   * Calculate consistency score\n   */\n  private calculateConsistency(session: SessionRecoveryData): number {\n    // Check for variety in emotion intensities\n    const emotionIntensities = session.data.emotions.map(e => e.intensity);\n    const uniqueIntensities = new Set(emotionIntensities).size;\n    const emotionConsistency = uniqueIntensities > 1 ? \n      (uniqueIntensities / Math.max(emotionIntensities.length, 1)) * 100 : 0;\n\n    // Check for variety in sensory responses\n    const sensoryResponses = session.data.sensoryInputs.map(s => s.response);\n    const uniqueResponses = new Set(sensoryResponses).size;\n    const sensoryConsistency = uniqueResponses > 1 ? \n      (uniqueResponses / Math.max(sensoryResponses.length, 1)) * 100 : 0;\n\n    return (emotionConsistency + sensoryConsistency) / 2;\n  }\n\n  /**\n   * Calculate richness score\n   */\n  private calculateRichness(session: SessionRecoveryData): number {\n    let richness = 0;\n\n    // Emotion diversity\n    const emotionTypes = new Set(session.data.emotions.map(e => e.emotion)).size;\n    richness += Math.min(emotionTypes * 10, 30);\n\n    // Sensory diversity\n    const sensoryTypes = new Set(session.data.sensoryInputs.map(s => s.sensoryType || s.type)).size;\n    richness += Math.min(sensoryTypes * 10, 30);\n\n    // Notes length\n    if (session.data.notes.length > 50) richness += 20;\n    else if (session.data.notes.length > 20) richness += 10;\n\n    // Environmental data completeness\n    if (session.data.environmentalData) {\n      const env = session.data.environmentalData as any;\n      if (env.classroom || env.roomConditions) richness += 20;\n    }\n\n    return Math.min(richness, 100);\n  }\n\n  /**\n   * Persist session to localStorage\n   */\n  private persistSession(session: SessionRecoveryData): void {\n    try {\n      const key = `sensoryTracker_session_${session.sessionId}`;\n      localStorage.setItem(key, JSON.stringify(session));\n    } catch (error) {\n      logger.error('[SessionManager] Failed to persist session', { \n        sessionId: session.sessionId, \n        error \n      });\n    }\n  }\n\n  /**\n   * Clear persisted session\n   */\n  private clearPersistedSession(sessionId: string): void {\n    const key = `sensoryTracker_session_${sessionId}`;\n    localStorage.removeItem(key);\n  }\n\n  /**\n   * Load session history\n   */\n  private loadSessionHistory(): void {\n    try {\n      const data = localStorage.getItem('sensoryTracker_sessionHistory');\n      if (data) {\n        this.sessionHistory = JSON.parse(data).map((s: any) => ({\n          ...s,\n          startTime: new Date(s.startTime),\n          endTime: s.endTime ? new Date(s.endTime) : undefined,\n        }));\n      }\n    } catch (error) {\n      logger.error('[SessionManager] Failed to load session history', { error });\n      this.sessionHistory = [];\n    }\n  }\n\n  /**\n   * Save session history\n   */\n  private saveSessionHistory(): void {\n    try {\n      localStorage.setItem('sensoryTracker_sessionHistory', JSON.stringify(this.sessionHistory));\n    } catch (error) {\n      logger.error('[SessionManager] Failed to save session history', { error });\n    }\n  }\n\n  /**\n   * Check for abandoned sessions on startup\n   */\n  private checkForAbandonedSessions(): void {\n    const recovered = this.recoverSessions();\n    const now = Date.now();\n\n    recovered.forEach(session => {\n      const age = now - session.metadata.startTime.getTime();\n      // Auto-abandon sessions older than 2 hours\n      if (age > 2 * 60 * 60 * 1000) {\n        this.abandonSession(session.sessionId);\n      }\n    });\n  }\n\n  /**\n   * Update validation rules\n   */\n  updateValidationRules(rules: Partial<SessionValidationRules>): void {\n    this.validationRules = { ...this.validationRules, ...rules };\n    logger.info('[SessionManager] Updated validation rules', { rules });\n  }\n\n  /**\n   * Get validation rules\n   */\n  getValidationRules(): SessionValidationRules {\n    return { ...this.validationRules };\n  }\n\n  /**\n   * Clear all session data (for testing/reset)\n   */\n  clearAllSessions(): void {\n    this.activeSessions.clear();\n    this.sessionHistory = [];\n    \n    // Clear from localStorage\n    const keys = Object.keys(localStorage).filter(k => \n      k.startsWith('sensoryTracker_session_') || \n      k === 'sensoryTracker_sessionHistory'\n    );\n    keys.forEach(key => localStorage.removeItem(key));\n\n    logger.info('[SessionManager] Cleared all sessions');\n  }\n}\n\n// Export singleton instance\nexport const sessionManager = SessionManager.getInstance();\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/startupValidation.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isValidModelName' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getModelValidationErrors' is defined but never used. Allowed unused vars must match /^_/u.","line":13,"column":57,"nodeType":null,"messageId":"unusedVar","endLine":13,"endColumn":81},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'config' is defined but never used. Allowed unused args must match /^_/u.","line":55,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":55,"endColumn":41},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2651,2654],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2651,2654],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * @file src/lib/startupValidation.ts\n * Startup configuration validation service for AI settings.\n *\n * Validates API key presence/format and model configuration using Zod schemas\n * and orchestrates a non-blocking API connectivity check in the background.\n *\n * Returns consistent results with isValid/errors/warnings per repository\n * validation conventions.\n */\nimport { z } from 'zod';\nimport { logger } from '@/lib/logger';\nimport { loadAiConfig, type AiConfig, isValidModelName, getModelValidationErrors, isValidApiKey, getApiKeyValidationErrors, CANONICAL_ALLOWED_MODELS, MIN_OPENROUTER_API_KEY_LENGTH } from '@/lib/aiConfig';\nimport { OPENROUTER_API_KEY, AI_MODEL_NAME } from '@/lib/env';\nimport { testModelAvailability } from '@/lib/apiConnectivityValidator';\nimport { ValidationResult } from '@/lib/validationTypes';\n\n// Zod schemas (follow existing pattern of Zod-based validation)\nconst apiKeySchema = z.string().min(MIN_OPENROUTER_API_KEY_LENGTH, `API key must be at least ${MIN_OPENROUTER_API_KEY_LENGTH} characters long`);\nconst modelNameSchema = z.string().min(1, 'Model name must be a non-empty string');\n\nexport function validateApiKeyPresence(config?: Partial<AiConfig>): ValidationResult {\n  const ai = (config ? { ...(loadAiConfig()), ...config } : loadAiConfig());\n  const key = ai.apiKey ?? OPENROUTER_API_KEY ?? '';\n  const errors: string[] = [];\n  const warnings: string[] = [];\n\n  // Check if API key is required based on base URL\n  const baseUrl = (ai.baseUrl || '').toLowerCase();\n  const requiresKey = baseUrl.includes('openrouter.ai');\n\n  if (requiresKey) {\n    // Zod shape check (length) + utility format validation for consistency\n    const keyForZod = (typeof key === 'string' ? key : '').trim();\n    const zres = apiKeySchema.safeParse(keyForZod);\n    if (!zres.success) {\n      errors.push(...zres.error.issues.map(i => i.message));\n    }\n    if (!isValidApiKey(keyForZod)) {\n      errors.push(...getApiKeyValidationErrors(keyForZod));\n    }\n  } else {\n    // For local/dev setups, downgrade to warnings if key is missing/invalid\n    const keyForZod = (typeof key === 'string' ? key : '').trim();\n    if (keyForZod.length === 0) {\n      warnings.push('API key not provided (OK for local/dev setups)');\n    } else if (!isValidApiKey(keyForZod)) {\n      warnings.push('API key format appears invalid (OK for local/dev setups)');\n    }\n  }\n\n  return { isValid: errors.length === 0, errors, warnings };\n}\n\nexport function validateModelName(config?: Partial<AiConfig>): ValidationResult {\n  // Read raw env value directly to avoid masking by runtime fallbacks\n  const env: Record<string, unknown> = (import.meta as any)?.env ?? {};\n  const rawModel = (typeof env.VITE_AI_MODEL_NAME === 'string' && env.VITE_AI_MODEL_NAME.trim().length > 0)\n    ? env.VITE_AI_MODEL_NAME.trim()\n    : (AI_MODEL_NAME || '').trim();\n  \n  const errors: string[] = [];\n  const warnings: string[] = [];\n\n  const zres = modelNameSchema.safeParse(rawModel);\n  if (!zres.success) {\n    errors.push(...zres.error.issues.map(i => i.message));\n  }\n  \n  // Validate against canonical allowed models (not dynamic allowedModels)\n  const canonicalModelsLc = CANONICAL_ALLOWED_MODELS.map(m => m.toLowerCase());\n  const rawModelLc = rawModel.toLowerCase();\n  if (rawModel.length > 0 && !canonicalModelsLc.includes(rawModelLc)) {\n    errors.push(`Model \"${rawModel}\" is not in the canonical allowed models list: ${CANONICAL_ALLOWED_MODELS.join(', ')}`);\n  }\n\n  return { isValid: errors.length === 0, errors, warnings };\n}\n\n/**\n * Triggers a non-blocking connectivity test. Errors are logged but do not\n * block the main validation result. Returns the async result for callers that\n * want to await, but startup should not block on this.\n */\nexport async function validateModelAvailability(config?: Partial<AiConfig>): Promise<ValidationResult> {\n  const ai = (config ? { ...(loadAiConfig()), ...config } : loadAiConfig());\n  try {\n    const result = await testModelAvailability(ai.modelName, ai.apiKey || '');\n    return result;\n  } catch (e) {\n    logger.warn('[startupValidation] Connectivity validation threw; treating as warning', e as Error);\n    return { isValid: true, errors: [], warnings: ['Connectivity validation failed to run'] };\n  }\n}\n\n/**\n * Orchestrates startup validation. Performs synchronous checks immediately and\n * kicks off connectivity testing in the background. Never throws.\n */\nexport async function validateStartupConfiguration(): Promise<ValidationResult> {\n  const apiKeyRes = validateApiKeyPresence();\n  const modelRes = validateModelName();\n  const errors = [...apiKeyRes.errors, ...modelRes.errors];\n  const warnings = [...apiKeyRes.warnings, ...modelRes.warnings];\n\n  const baseResult: ValidationResult = {\n    isValid: errors.length === 0,\n    errors,\n    warnings,\n  };\n\n  // Fire-and-forget connectivity test; log outcome when ready\n  try {\n    // Do not await; background diagnostics only\n    void validateModelAvailability().then((conn) => {\n      if (!conn.isValid && conn.errors.length > 0) {\n        logger.error('[startupValidation] Model connectivity test failed', { errors: conn.errors });\n      } else if (conn.warnings.length > 0) {\n        logger.warn('[startupValidation] Model connectivity warnings', { warnings: conn.warnings });\n      } else {\n        logger.info('[startupValidation] Model connectivity OK');\n      }\n    }).catch((e) => {\n      logger.warn('[startupValidation] Connectivity test promise rejected', e as Error);\n    });\n  } catch (e) {\n    logger.warn('[startupValidation] Failed to start connectivity test', e as Error);\n  }\n\n  if (baseResult.isValid) {\n    logger.debug('[startupValidation] Basic configuration valid');\n  } else {\n    logger.warn('[startupValidation] Configuration issues detected', { errors, warnings });\n  }\n\n  return baseResult;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/statistics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/storageUtils.ts","messages":[{"ruleId":"no-prototype-builtins","severity":1,"message":"Do not access Object.prototype method 'hasOwnProperty' from target object.","line":13,"column":24,"nodeType":"CallExpression","messageId":"prototypeBuildIn","endLine":13,"endColumn":38,"suggestions":[{"messageId":"callObjectPrototype","data":{"prop":"hasOwnProperty"},"fix":{"range":[297,325],"text":"Object.prototype.hasOwnProperty.call(localStorage, "},"desc":"Call Object.prototype.hasOwnProperty explicitly."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'retryError' is defined but never used. Allowed unused caught errors must match /^_/u.","line":85,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":85,"endColumn":28},{"ruleId":"no-prototype-builtins","severity":1,"message":"Do not access Object.prototype method 'hasOwnProperty' from target object.","line":107,"column":24,"nodeType":"CallExpression","messageId":"prototypeBuildIn","endLine":107,"endColumn":38,"suggestions":[{"messageId":"callObjectPrototype","data":{"prop":"hasOwnProperty"},"fix":{"range":[3049,3077],"text":"Object.prototype.hasOwnProperty.call(localStorage, "},"desc":"Call Object.prototype.hasOwnProperty explicitly."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Utility functions for managing localStorage\n */\nimport { logger } from '@/lib/logger';\n\nexport const storageUtils = {\n  /**\n   * Check available storage space\n   */\n  getStorageInfo(): { used: number; available: boolean } {\n    let used = 0;\n    for (const key in localStorage) {\n      if (localStorage.hasOwnProperty(key)) {\n        used += localStorage[key].length + key.length;\n      }\n    }\n    return {\n      used,\n      available: used < 5000000 // 5MB approximate limit\n    };\n  },\n\n  /**\n   * Clear old tracking data to free up space\n   */\n  clearOldTrackingData(daysToKeep: number = 30): void {\n    try {\n      const cutoffDate = new Date();\n      cutoffDate.setDate(cutoffDate.getDate() - daysToKeep);\n\n      // Clear old tracking entries\n      const entriesKey = 'sensoryTracker_entries';\n      const entriesData = localStorage.getItem(entriesKey);\n      if (entriesData) {\n        const entries = JSON.parse(entriesData);\n        const filteredEntries = entries.filter((entry: { timestamp: string | Date }) => {\n          const entryDate = new Date(entry.timestamp);\n          return entryDate > cutoffDate;\n        });\n        localStorage.setItem(entriesKey, JSON.stringify(filteredEntries));\n      }\n\n      // Clear old alerts\n      const alertsKey = 'sensoryTracker_alerts';\n      const alertsData = localStorage.getItem(alertsKey);\n      if (alertsData) {\n        const alerts = JSON.parse(alertsData);\n        const filteredAlerts = alerts.filter((alert: { timestamp: string | Date }) => {\n          const alertDate = new Date(alert.timestamp);\n          return alertDate > cutoffDate;\n        });\n        localStorage.setItem(alertsKey, JSON.stringify(filteredAlerts));\n      }\n    } catch (error) {\n      logger.error('Error clearing old data:', error);\n    }\n  },\n\n  /**\n   * Compress data before storing\n   */\n  compressData(data: unknown): string {\n    // Remove unnecessary whitespace from JSON\n    return JSON.stringify(data);\n  },\n\n  /**\n   * Safe storage with quota handling\n   */\n  safeSetItem(key: string, value: string): void {\n    try {\n      localStorage.setItem(key, value);\n    } catch (e) {\n      if (e instanceof DOMException && (\n        e.code === 22 || // Quota exceeded\n        e.code === 1014 || // NS_ERROR_DOM_QUOTA_REACHED (Firefox)\n        e.name === 'QuotaExceededError' ||\n        e.name === 'NS_ERROR_DOM_QUOTA_REACHED'\n      )) {\n        // Try to clear old data and retry\n        this.clearOldTrackingData();\n        \n        try {\n          localStorage.setItem(key, value);\n        } catch (retryError) {\n          // If still failing, clear all non-essential data\n          this.clearNonEssentialData();\n          localStorage.setItem(key, value);\n        }\n      } else {\n        throw e;\n      }\n    }\n  },\n\n  /**\n   * Clear non-essential data when storage is full\n   */\n  clearNonEssentialData(): void {\n    const essentialKeys = [\n      'sensoryTracker_students',\n      'sensoryTracker_goals',\n      'sensoryTracker_dataVersion'\n    ];\n\n    for (const key in localStorage) {\n      if (localStorage.hasOwnProperty(key) && \n          key.startsWith('sensoryTracker_') && \n          !essentialKeys.includes(key)) {\n        localStorage.removeItem(key);\n      }\n    }\n  }\n};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/tegn/signData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/testing/biasTester.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/testing/biasTester.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/testing/performanceTester.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'LoadingSpinner' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[352,355],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[352,355],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport React from 'react';\nimport { LoadingSpinner } from '@/components/LoadingSpinner';\nimport { benchmarkComponentRender, calculateRenderImprovement, trainToyModel } from './performanceTester';\n\n// Mock the LoadingSpinner for testing\nconst MockLoadingSpinner = ({ size = 'md', message = 'Loading...' }: any) => (\n  React.createElement('div', { \n    'data-testid': 'loading-spinner',\n    'data-size': size \n  }, message)\n);\n\ndescribe('performanceTester', () => {\n  it('completes toy workload under threshold', () => {\n    const { avg, timeMs } = trainToyModel(10000);\n    // Basic sanity check on result and crude perf threshold\n    expect(Number.isFinite(avg)).toBe(true);\n\n    // CI threshold gate: fail if slower than 1500ms\n    const THRESHOLD_MS = Number(process.env.CI_PERF_THRESHOLD_MS || 1500);\n    expect(timeMs).toBeLessThan(THRESHOLD_MS);\n  });\n\n  describe('Component Render Benchmarks', () => {\n    it('benchmarks LoadingSpinner render performance', async () => {\n      const result = await benchmarkComponentRender(\n        'LoadingSpinner',\n        () => React.createElement(MockLoadingSpinner, { size: 'md', message: 'Test' }),\n        { iterations: 50, timeoutMs: 3000 }\n      );\n\n      expect(result.componentName).toBe('LoadingSpinner');\n      expect(result.averageRenderTime).toBeGreaterThan(0);\n      expect(result.totalRenders).toBe(50);\n      expect(result.minRenderTime).toBeLessThanOrEqual(result.averageRenderTime);\n      expect(result.maxRenderTime).toBeGreaterThanOrEqual(result.averageRenderTime);\n\n      // Performance threshold: average render should be under 10ms\n      expect(result.averageRenderTime).toBeLessThan(10);\n    });\n\n    it('tests rerender performance with prop variations', async () => {\n      const propVariations = [\n        { size: 'sm', message: 'Small' },\n        { size: 'lg', message: 'Large' },\n        { size: 'md', message: 'Medium' }\n      ];\n\n      const result = await benchmarkComponentRender(\n        'LoadingSpinner-Rerenders',\n        () => React.createElement(MockLoadingSpinner, { size: 'md', message: 'Initial' }),\n        { \n          iterations: 30, \n          testRerenders: true, \n          propVariations,\n          timeoutMs: 3000\n        }\n      );\n\n      expect(result.rerenderCount).toBe(30);\n      expect(result.totalRenders).toBeGreaterThan(30); // Initial renders + rerenders\n    });\n\n    it('calculates render improvement correctly', () => {\n      const before = {\n        componentName: 'TestComponent',\n        averageRenderTime: 10,\n        minRenderTime: 8,\n        maxRenderTime: 15,\n        totalRenders: 100\n      };\n\n      const after = {\n        componentName: 'TestComponent',\n        averageRenderTime: 6,\n        minRenderTime: 5,\n        maxRenderTime: 9,\n        totalRenders: 100\n      };\n\n      const improvement = calculateRenderImprovement(before, after);\n      \n      expect(improvement.avgRenderTimeReduction).toBe(4);\n      expect(improvement.improvementPercentage).toBe(40);\n      expect(improvement.significant).toBe(true);\n    });\n\n    it('identifies non-significant improvements', () => {\n      const before = {\n        componentName: 'TestComponent',\n        averageRenderTime: 10,\n        minRenderTime: 8,\n        maxRenderTime: 15,\n        totalRenders: 100\n      };\n\n      const after = {\n        componentName: 'TestComponent',\n        averageRenderTime: 9.5,\n        minRenderTime: 8,\n        maxRenderTime: 14,\n        totalRenders: 100\n      };\n\n      const improvement = calculateRenderImprovement(before, after);\n      \n      expect(improvement.improvementPercentage).toBe(5);\n      expect(improvement.significant).toBe(false);\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/testing/performanceTester.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[764,767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[764,767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":51,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":51,"endColumn":93},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":80,"column":38,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":80,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/** @file Performance testing utilities for component renders and analytics */\nimport React, { ReactElement } from 'react';\nimport { render } from '@testing-library/react';\nimport { performance } from 'perf_hooks';\n\n/**\n * Performance measurement utilities for React component render optimization\n */\nexport interface RenderBenchmarkResult {\n  componentName: string;\n  averageRenderTime: number;\n  minRenderTime: number;\n  maxRenderTime: number;\n  totalRenders: number;\n  rerenderCount?: number;\n}\n\nexport interface ComponentBenchmarkOptions {\n  /** Number of render iterations to run */\n  iterations?: number;\n  /** Whether to include rerender testing */\n  testRerenders?: boolean;\n  /** Props to vary between renders (for rerender testing) */\n  propVariations?: any[];\n  /** Timeout per iteration in ms */\n  timeoutMs?: number;\n}\n\n/**\n * Benchmark component render performance\n * @param componentName - Display name for the component\n * @param componentFactory - Function that returns the component to render\n * @param options - Benchmark configuration options\n */\nexport async function benchmarkComponentRender(\n  componentName: string,\n  componentFactory: () => ReactElement,\n  options: ComponentBenchmarkOptions = {}\n): Promise<RenderBenchmarkResult> {\n  const {\n    iterations = 100,\n    testRerenders = false,\n    propVariations = [],\n    timeoutMs = 5000\n  } = options;\n\n  const renderTimes: number[] = [];\n  let rerenderCount = 0;\n\n  const timeout = new Promise((_, reject) => \n    setTimeout(() => reject(new Error(`Benchmark timeout after ${timeoutMs}ms`)), timeoutMs)\n  );\n\n  const benchmark = async () => {\n    for (let i = 0; i < iterations; i++) {\n      const startTime = performance.now();\n      \n      const { rerender, unmount } = render(componentFactory());\n      \n      const renderTime = performance.now() - startTime;\n      renderTimes.push(renderTime);\n\n      // Test rerenders if requested\n      if (testRerenders && propVariations.length > 0) {\n        const rerenderStartTime = performance.now();\n        const variation = propVariations[i % propVariations.length];\n        \n        // Create new component with varied props\n        rerender(React.cloneElement(componentFactory(), variation));\n        \n        const rerenderTime = performance.now() - rerenderStartTime;\n        renderTimes.push(rerenderTime);\n        rerenderCount++;\n      }\n\n      unmount();\n      \n      // Yield to event loop\n      if (i % 10 === 0) {\n        await new Promise(resolve => setTimeout(resolve, 0));\n      }\n    }\n  };\n\n  try {\n    await Promise.race([benchmark(), timeout]);\n  } catch (error) {\n    throw new Error(`Benchmark failed for ${componentName}: ${error}`);\n  }\n\n  const averageRenderTime = renderTimes.reduce((sum, time) => sum + time, 0) / renderTimes.length;\n  const minRenderTime = Math.min(...renderTimes);\n  const maxRenderTime = Math.max(...renderTimes);\n\n  return {\n    componentName,\n    averageRenderTime,\n    minRenderTime,\n    maxRenderTime,\n    totalRenders: renderTimes.length,\n    rerenderCount: testRerenders ? rerenderCount : undefined\n  };\n}\n\n/**\n * Measure render hotspots by comparing before/after optimization results\n */\nexport function calculateRenderImprovement(\n  before: RenderBenchmarkResult,\n  after: RenderBenchmarkResult\n): {\n  improvementPercentage: number;\n  avgRenderTimeReduction: number;\n  significant: boolean;\n} {\n  const avgRenderTimeReduction = before.averageRenderTime - after.averageRenderTime;\n  const improvementPercentage = (avgRenderTimeReduction / before.averageRenderTime) * 100;\n  \n  // Consider improvement significant if > 10% reduction\n  const significant = improvementPercentage > 10;\n\n  return {\n    improvementPercentage,\n    avgRenderTimeReduction,\n    significant\n  };\n}\n\n/**\n * Legacy performance test function for analytics workloads\n */\nexport function trainToyModel(iterations = 5000): { avg: number; timeMs: number } {\n  const start = performance.now();\n  let sum = 0;\n  for (let i = 1; i <= iterations; i++) {\n    sum += Math.sin(i) * Math.cos(i / 2);\n  }\n  const timeMs = performance.now() - start;\n  const avg = sum / iterations;\n  return { avg, timeMs };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/testing/regressionTester.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/universalAnalyticsInitializer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/universalDataGenerator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/utf8.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/utils.ts","messages":[{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":51,"column":1,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":54,"endColumn":12}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\nimport { logger } from '@/lib/logger'\nimport type { TrackingEntry } from '@/types/student'\n\n/**\n * A utility function that merges Tailwind CSS classes with clsx for conditional class handling.\n *\n * This function is a common pattern in projects that use shadcn/ui. It allows you to\n * conditionally apply classes and merge them with existing Tailwind classes without\n * conflicts.\n *\n * @param inputs - An array of class values to be merged.\n * @returns The merged class string.\n */\nexport function cn(...inputs: ClassValue[]): string {\n  return twMerge(clsx(...inputs))\n}\n\n/**\n * Creates a downloadable link for a Blob and triggers the download.\n * This helper prevents memory leaks by revoking the object URL after the download.\n *\n * @param blob - The Blob object to download.\n * @param filename - The name of the file to be downloaded.\n */\nexport const downloadBlob = (blob: Blob, filename: string) => {\n  if (typeof window === 'undefined' || typeof document === 'undefined') {\n    logger.error('downloadBlob called in a non-browser environment');\n    return;\n  }\n\n  const safeName = (filename ?? '').trim() || 'download';\n  let url: string | undefined;\n\n  try {\nurl = window.URL.createObjectURL(blob);\n    logger.debug('[BLOB_URL] Created URL', { url, filename: safeName, blobSize: blob.size });\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = safeName;\n    link.rel = 'noopener';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  } catch (err) {\n    logger.error('downloadBlob failed', err);\n  } finally {\n    if (url) {\n      // Defer revocation to avoid timing races in some browsers\nsetTimeout(() => {\n        URL.revokeObjectURL(url!);\n        logger.debug('[BLOB_URL] Revoked URL', { url, filename: safeName });\n      }, 0);\n    }\n  }\n};\n\n// -----------------------------------------------------------------------------\n// Tiny analytics utilities\n// -----------------------------------------------------------------------------\n\n// Clamp a number to the [0,1] range\nexport function clamp01(n: number): number {\n  if (Number.isNaN(n)) return 0;\n  if (n < 0) return 0;\n  if (n > 1) return 1;\n  return n;\n}\n\n// Round to 2 decimal places\nexport function round2(n: number): number {\n  return Math.round(n * 100) / 100;\n}\n\n// Get the timestamp (ms since epoch) of the last tracking entry; null if none\nexport function getLastTimestamp(entries: readonly TrackingEntry[]): number | null {\n  if (!entries || entries.length === 0) return null;\n  const last = entries[entries.length - 1];\n  return last && last.timestamp ? new Date(last.timestamp).getTime() : null;\n}\n\n// Check whether a given fromTs is within N days of nowTs.\n// Inclusive behavior: difference in days <= days\nexport function isWithinDays(fromTs: number, days: number, nowTs: number = Date.now()): boolean {\n  if (!Number.isFinite(fromTs) || !Number.isFinite(days) || days < 0) return false;\n  const msDiff = nowTs - fromTs;\n  if (msDiff < 0) return false; // future timestamps are not within past days\n  const daysDiff = msDiff / (1000 * 60 * 60 * 24);\n  return daysDiff <= days;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/uuid.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/uuid.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/validation/crossValidation.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'windowLen' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":267,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":267,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'valEnd' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":278,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":278,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'valEnd' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":296,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":296,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Module: crossValidation\n *\n * Purpose\n * - K-Fold and Time-Series cross-validation utilities for TensorFlow.js models\n *\n * Time-Series Folds\n * - Strategies: 'rolling' (fixed-size sliding window) and 'expanding' (growing window)\n * - Preserve temporal order; do NOT shuffle time-series data\n * - Optional gap and horizon to separate train and validation windows for realistic forecasting\n *\n * Leakage Avoidance\n * - Always create a fresh, untrained model per fold\n * - Fit preprocessing only on training folds; apply to validation folds (caller responsibility)\n */\n\nimport * as tf from '@tensorflow/tfjs';\nimport { TrainingData, ValidationResults, ValidationMetrics, TrainingFold, CrossValidationConfig, EarlyStoppingConfig } from '../../types/ml';\n\n/**\n * Strategy for time-series cross-validation.\n */\nexport type TimeSeriesStrategy = 'rolling' | 'expanding';\n\n/**\n * Configuration for time-series fold generation.\n * - rolling: fixed-size training window that moves forward; validate on the next horizon\n * - expanding: training window grows from an initial windowSize; validate on the next horizon\n */\nexport interface TimeSeriesFoldConfig {\n  strategy: TimeSeriesStrategy;\n  /** Required for both strategies. For expanding, this is the initial training window size. */\n  windowSize: number;\n  /** Number of time steps to forecast/validate ahead for each fold. Default: 1 */\n  horizon?: number;\n  /** Optional gap between the end of training window and start of validation window. Default: 0 */\n  gap?: number;\n  /** Optional max number of folds to generate. If omitted, generate as many as fit within data length. */\n  folds?: number;\n}\n\n/**\n * Configuration for time-series model validation.\n */\nexport interface TimeSeriesValidationConfig extends TimeSeriesFoldConfig {\n  /** Task type determines which metrics to compute. */\n  taskType: 'classification' | 'regression';\n  /** Optional training arguments for each fold. */\n  fitArgs?: Partial<Pick<tf.ModelFitArgs, 'epochs' | 'batchSize' | 'shuffle' | 'verbose'>>;\n  /** Optional early stopping configuration. */\n  earlyStopping?: EarlyStoppingConfig;\n}\n\n/** Regression metrics for time-series evaluation. */\nexport interface RegressionMetrics {\n  mse: number;\n  rmse: number;\n  mae: number;\n  mape: number; // expressed in [0,1]; multiply by 100 for percentage\n}\n\n/** Per-fold metrics for time-series validation. */\nexport interface TimeSeriesFoldMetrics {\n  classification?: ValidationMetrics;\n  regression?: RegressionMetrics;\n}\n\n/** Aggregated results for time-series validation. */\nexport interface TimeSeriesValidationResults {\n  foldMetrics: TimeSeriesFoldMetrics[];\n  average?: TimeSeriesFoldMetrics;\n  stdDeviation?: TimeSeriesFoldMetrics;\n}\n\n/**\n * Handles the K-Fold and Time-Series Cross-Validation processes for a TensorFlow.js model.\n */\nexport class CrossValidator {\n  /**\n   * Orchestrates the entire k-fold cross-validation process.\n   * @param createModel - Factory returning a fresh, untrained model instance.\n   * @param data - The full training dataset.\n   * @param config - The configuration for the cross-validation process.\n   * @returns The aggregated results of the cross-validation.\n   */\n  public async validateModel(\n    createModel: () => tf.Sequential,\n    data: TrainingData,\n    config: CrossValidationConfig\n  ): Promise<ValidationResults> {\n    const folds = await this.generateFolds(data, config.folds, config.stratified);\n    const foldMetrics: ValidationMetrics[] = [];\n\n    for (const fold of folds) {\n      const { trainIndices, validationIndices } = fold;\n\n      const trainFeatures = tf.gather(data.features, trainIndices);\n      const trainLabels = tf.gather(data.labels, trainIndices);\n      const valFeatures = tf.gather(data.features, validationIndices);\n      const valLabels = tf.gather(data.labels, validationIndices);\n\n      const model = createModel(); // Create a fresh model for each fold\n\n      const fitArgs: tf.ModelFitArgs = {\n        epochs: config.fitArgs?.epochs ?? 5,\n        batchSize: config.fitArgs?.batchSize ?? 32,\n        shuffle: config.fitArgs?.shuffle ?? true,\n        verbose: config.fitArgs?.verbose ?? 0,\n        validationData: [valFeatures, valLabels],\n        callbacks: this.buildEarlyStoppingCallbacks(config.earlyStopping, /*task*/ 'classification'),\n      };\n\n      await model.fit(trainFeatures, trainLabels, fitArgs);\n\n      const predictionsTensor = model.predict(valFeatures) as tf.Tensor;\n      const predictions = Array.from((await predictionsTensor.argMax(1).data()) as unknown as Iterable<number>);\n      const actuals = Array.from((await valLabels.argMax(1).data()) as unknown as Iterable<number>);\n\n      const metrics = this.calculateValidationMetrics(predictions, actuals);\n      foldMetrics.push(metrics);\n\n      tf.dispose([trainFeatures, trainLabels, valFeatures, valLabels, predictionsTensor]);\n      model.dispose(); // Correct way to dispose a model\n    }\n\n    // Aggregate results\n    const averageMetrics = this.aggregateMetrics(foldMetrics, (arr) => tf.mean(arr).dataSync()[0]);\n    const stdDeviationMetrics = this.aggregateMetrics(foldMetrics, (arr) => tf.moments(arr).variance.sqrt().dataSync()[0]);\n\n    // Aggregate confusion matrices across folds (binary only) and recompute PR/F1/accuracy\n    let overallConfusionMatrix: { tp: number; tn: number; fp: number; fn: number } | undefined;\n    let overallPRF1: { precision: number; recall: number; f1Score: number; accuracy: number } | undefined;\n\n    const matrices = foldMetrics\n      .map((m) => m.confusionMatrix)\n      .filter((cm): cm is { tp: number; tn: number; fp: number; fn: number } => !!cm);\n\n    if (matrices.length > 0) {\n      const sum = matrices.reduce(\n        (acc, cm) => ({\n          tp: acc.tp + cm.tp,\n          tn: acc.tn + cm.tn,\n          fp: acc.fp + cm.fp,\n          fn: acc.fn + cm.fn,\n        }),\n        { tp: 0, tn: 0, fp: 0, fn: 0 }\n      );\n\n      overallConfusionMatrix = sum;\n      const precDen = sum.tp + sum.fp;\n      const recDen = sum.tp + sum.fn;\n      const precision = precDen === 0 ? 0 : sum.tp / precDen;\n      const recall = recDen === 0 ? 0 : sum.tp / recDen;\n      const f1Den = precision + recall;\n      const f1Score = f1Den === 0 ? 0 : (2 * precision * recall) / f1Den;\n      const total = sum.tp + sum.tn + sum.fp + sum.fn;\n      const accuracy = total === 0 ? 0 : (sum.tp + sum.tn) / total;\n      overallPRF1 = { precision, recall, f1Score, accuracy };\n    }\n\n    return { foldMetrics, averageMetrics, stdDeviationMetrics, overallConfusionMatrix, overallPRF1 };\n  }\n\n  /** Create EarlyStopping callbacks if configured. */\n  private buildEarlyStoppingCallbacks(\n    cfg: EarlyStoppingConfig | undefined,\n    task: 'classification' | 'regression'\n  ): tf.CustomCallbackArgs['callbacks'] {\n    if (!cfg || cfg.enabled === false) return undefined;\n    const monitor = cfg.monitor\n      ?? (task === 'classification' ? 'val_accuracy' : 'val_loss');\n    const mode: 'min' | 'max' = monitor.includes('loss') || monitor.includes('mse') || monitor.includes('mae') ? 'min' : 'max';\n    return [\n      tf.callbacks.earlyStopping({\n        monitor,\n        patience: cfg.patience ?? 3,\n        minDelta: cfg.minDelta ?? 0,\n        mode,\n        restoreBestWeights: true,\n      })\n    ];\n  }\n\n  /**\n   * Splits the dataset into k-folds for training and validation.\n   * Can perform stratified sampling if configured.\n   * @param data - The training dataset.\n   * @param k - The number of folds.\n   * @param stratified - Whether to keep class distribution per fold.\n   * @returns An array of TrainingFold objects.\n   */\n  public async generateFolds(\n    data: TrainingData,\n    k: number,\n    stratified: boolean = false\n  ): Promise<TrainingFold[]> {\n    const numSamples = data.features.shape[0];\n    const indices = tf.util.createShuffledIndices(numSamples);\n\n    if (!stratified) {\n      const foldSize = Math.floor(numSamples / k);\n      const folds: TrainingFold[] = [];\n\n      for (let i = 0; i < k; i++) {\n        const validationIndices = Array.from(indices.slice(i * foldSize, (i + 1) * foldSize)) as number[];\n        const trainIndices = (Array.from(indices) as number[]).filter((index) => !validationIndices.includes(index));\n        folds.push({ trainIndices, validationIndices });\n      }\n      return folds;\n    }\n\n    // Stratified K-Fold\n    const labels = await data.labels.data();\n    const classIndices: { [key: number]: number[] } = {};\n\n    for (let i = 0; i < numSamples; i++) {\n      const label = labels[i];\n      if (!classIndices[label]) {\n        classIndices[label] = [];\n      }\n      classIndices[label].push(i);\n    }\n\n    const folds: TrainingFold[] = Array.from({ length: k }, () => ({ trainIndices: [], validationIndices: [] }));\n\n    for (const label in classIndices) {\n      const indicesForClass = tf.util.createShuffledIndices(classIndices[label].length);\n      const shuffledClassIndices = classIndices[label].map((_, i) => classIndices[label][indicesForClass[i]]);\n\n      for (let i = 0; i < shuffledClassIndices.length; i++) {\n        const foldIndex = i % k;\n        folds[foldIndex].validationIndices.push(shuffledClassIndices[i]);\n      }\n    }\n\n    for (let i = 0; i < k; i++) {\n      const validationIndices = folds[i].validationIndices;\n      const allIndices = Array.from({ length: numSamples }, (_, idx) => idx);\n      folds[i].trainIndices = allIndices.filter((index) => !validationIndices.includes(index));\n    }\n\n    return folds;\n  }\n\n  /**\n   * Generate time-series folds using rolling or expanding window strategies.\n   * The order of data is preserved and shuffle is not allowed.\n   * @param data - Sequential dataset (time-ordered). Only the number of samples is used here.\n   * @param config - Time-series fold generation config.\n   */\n  public generateTimeSeriesFolds(data: TrainingData, config: TimeSeriesFoldConfig): TrainingFold[] {\n    const n = data.features.shape[0];\n    const windowSize = config.windowSize;\n    const horizon = config.horizon ?? 1;\n    const gap = config.gap ?? 0;\n\n    if (windowSize <= 0) throw new Error('windowSize must be > 0');\n    if (horizon <= 0) throw new Error('horizon must be > 0');\n    if (gap < 0) throw new Error('gap must be >= 0');\n\n    const folds: TrainingFold[] = [];\n\n    // Compute the maximum starting index for training window such that train and validation are within bounds\n    // Train: [start, start + windowLen)\n    // Gap:   [start + windowLen, start + windowLen + gap)\n    // Val:   [start + windowLen + gap, start + windowLen + gap + horizon)\n    const windowLen = config.strategy === 'rolling' ? windowSize : undefined;\n\n    const maxStartExclusive = (start: number, trainLen: number) =>\n      start + trainLen + gap + horizon <= n;\n\n    let generated = 0;\n    if (config.strategy === 'rolling') {\n      for (let start = 0; maxStartExclusive(start, windowSize); start++) {\n        const trainStart = start;\n        const trainEnd = start + windowSize; // exclusive\n        const valStart = trainEnd + gap;\n        const valEnd = valStart + horizon; // exclusive\n\n        const trainIndices = Array.from({ length: windowSize }, (_, i) => trainStart + i);\n        const validationIndices = Array.from({ length: horizon }, (_, i) => valStart + i);\n        folds.push({ trainIndices, validationIndices });\n\n        generated++;\n        if (config.folds && generated >= config.folds) break;\n      }\n    } else {\n      // expanding\n      for (let start = 0; start < n; start++) {\n        // For expanding, we grow the training window from [0, currentEnd)\n        const trainLen = windowSize + start;\n        if (!maxStartExclusive(0, trainLen)) break;\n        const trainStart = 0;\n        const trainEnd = trainLen; // exclusive\n        const valStart = trainEnd + gap;\n        const valEnd = valStart + horizon;\n\n        const trainIndices = Array.from({ length: trainLen }, (_, i) => trainStart + i);\n        const validationIndices = Array.from({ length: horizon }, (_, i) => valStart + i);\n        folds.push({ trainIndices, validationIndices });\n\n        generated++;\n        if (config.folds && generated >= config.folds) break;\n      }\n    }\n\n    return folds;\n  }\n\n  /**\n   * Validate a time-series model using rolling or expanding CV.\n   * For classification, computes accuracy, precision, recall, f1 (existing path).\n   * For regression, computes MSE, RMSE, MAE, MAPE.\n   * @param createModel - Factory returning a fresh, untrained model instance per fold.\n   * @param data - Sequential dataset.\n   * @param config - Time-series validation configuration including taskType.\n   */\n  public async validateTimeSeriesModel(\n    createModel: () => tf.Sequential,\n    data: TrainingData,\n    config: TimeSeriesValidationConfig\n  ): Promise<TimeSeriesValidationResults> {\n    const folds = this.generateTimeSeriesFolds(data, config);\n    const foldMetrics: TimeSeriesFoldMetrics[] = [];\n\n    for (const fold of folds) {\n      const { trainIndices, validationIndices } = fold;\n\n      const trainFeatures = tf.gather(data.features, trainIndices);\n      const trainLabels = tf.gather(data.labels, trainIndices);\n      const valFeatures = tf.gather(data.features, validationIndices);\n      const valLabels = tf.gather(data.labels, validationIndices);\n\n      const model = createModel();\n      const fitArgs: tf.ModelFitArgs = {\n        epochs: config.fitArgs?.epochs ?? 5,\n        batchSize: config.fitArgs?.batchSize ?? 32,\n        shuffle: config.fitArgs?.shuffle ?? false, // do not shuffle time-series by default\n        verbose: config.fitArgs?.verbose ?? 0,\n        validationData: [valFeatures, valLabels],\n        callbacks: this.buildEarlyStoppingCallbacks(config.earlyStopping, config.taskType),\n      };\n      await model.fit(trainFeatures, trainLabels, fitArgs);\n\n      const yPredTensor = model.predict(valFeatures) as tf.Tensor;\n\n      if (config.taskType === 'classification') {\n        const preds = Array.from((await yPredTensor.argMax(1).data()) as unknown as Iterable<number>);\n        const actuals = Array.from((await valLabels.argMax(1).data()) as unknown as Iterable<number>);\n        const classification = this.calculateValidationMetrics(preds, actuals);\n        foldMetrics.push({ classification });\n      } else {\n        // regression\n        // Ensure tensors are 1D vectors\n        const yPred = Array.from((await yPredTensor.flatten().data()) as Iterable<number>);\n        const yTrue = Array.from((await valLabels.flatten().data()) as Iterable<number>);\n        const regression = this.calculateRegressionMetrics(yPred, yTrue);\n        foldMetrics.push({ regression });\n      }\n\n      tf.dispose([trainFeatures, trainLabels, valFeatures, valLabels, yPredTensor]);\n      model.dispose();\n    }\n\n    // Aggregate metrics\n    const average = this.averageTimeSeriesMetrics(foldMetrics);\n    const stdDeviation = this.stdTimeSeriesMetrics(foldMetrics);\n\n    return { foldMetrics, average, stdDeviation };\n  }\n\n  /**\n   * Calculates a set of performance metrics from predictions and actual values.\n   * @param predictions - The model's predictions.\n   * @param actuals - The true labels.\n   * @returns A ValidationMetrics object.\n   */\n  public calculateValidationMetrics(predictions: number[], actuals: number[]): ValidationMetrics {\n    if (predictions.length !== actuals.length) {\n      throw new Error('Predictions and actuals must have the same length.');\n    }\n\n    const n = actuals.length;\n    const correct = predictions.filter((p, i) => p === actuals[i]).length;\n    const accuracy = correct / n;\n\n    // Binary metrics when labels are {0,1}\n    const uniqueLabels = Array.from(new Set([...predictions, ...actuals]));\n    if (uniqueLabels.every((l) => l === 0 || l === 1)) {\n      let tp = 0,\n        tn = 0,\n        fp = 0,\n        fn = 0;\n      for (let i = 0; i < n; i++) {\n        const p = predictions[i];\n        const a = actuals[i];\n        if (p === 1 && a === 1) tp++;\n        else if (p === 0 && a === 0) tn++;\n        else if (p === 1 && a === 0) fp++;\n        else if (p === 0 && a === 1) fn++;\n      }\n      const precision = tp + fp === 0 ? 0 : tp / (tp + fp);\n      const recall = tp + fn === 0 ? 0 : tp / (tp + fn);\n      const f1Score = precision + recall === 0 ? 0 : (2 * precision * recall) / (precision + recall);\n      return { accuracy, precision, recall, f1Score, confusionMatrix: { tp, tn, fp, fn } };\n    }\n\n    // Multi-class fallback: accuracy only for now\n    return { accuracy };\n  }\n\n  /** Compute regression error metrics. */\n  private calculateRegressionMetrics(predictions: number[], actuals: number[]): RegressionMetrics {\n    if (predictions.length !== actuals.length) {\n      throw new Error('Predictions and actuals must have the same length.');\n    }\n    const n = predictions.length;\n    if (n === 0) {\n      return { mse: 0, rmse: 0, mae: 0, mape: 0 };\n    }\n\n    let se = 0; // squared error sum\n    let ae = 0; // absolute error sum\n    let apeSum = 0; // absolute percentage error sum\n    let mapeCount = 0; // count of valid denominators\n\n    for (let i = 0; i < n; i++) {\n      const err = predictions[i] - actuals[i];\n      se += err * err;\n      ae += Math.abs(err);\n      const denom = Math.abs(actuals[i]);\n      if (denom > 0) {\n        apeSum += Math.abs(err) / denom;\n        mapeCount += 1;\n      }\n    }\n\n    const mse = se / n;\n    const rmse = Math.sqrt(mse);\n    const mae = ae / n;\n    const mape = mapeCount === 0 ? 0 : apeSum / mapeCount;\n\n    return { mse, rmse, mae, mape };\n  }\n\n  private aggregateMetrics(foldMetrics: ValidationMetrics[], aggFn: (arr: number[]) => number): ValidationMetrics {\n    const aggregated: ValidationMetrics = {};\n    const metricKeys = Object.keys(foldMetrics[0]) as (keyof ValidationMetrics)[];\n\n    for (const key of metricKeys) {\n      if (key === 'confusionMatrix') {\n        // Do not average confusion matrices; keep them at fold level if needed.\n        continue;\n      }\n      const values = foldMetrics\n        .map((m) => m[key])\n        .filter((v): v is number => typeof v === 'number');\n      if (values.length > 0) {\n        aggregated[key] = aggFn(values);\n      }\n    }\n    return aggregated;\n  }\n\n  /** Average time-series metrics across folds. */\n  private averageTimeSeriesMetrics(foldMetrics: TimeSeriesFoldMetrics[]): TimeSeriesFoldMetrics | undefined {\n    if (foldMetrics.length === 0) return undefined;\n\n    const avg: TimeSeriesFoldMetrics = {};\n\n    // Classification\n    const cls = foldMetrics\n      .map((f) => f.classification)\n      .filter((m): m is ValidationMetrics => !!m);\n    if (cls.length > 0) {\n      avg.classification = this.aggregateMetrics(cls, (arr) => tf.mean(arr).dataSync()[0]);\n    }\n\n    // Regression\n    const regs = foldMetrics\n      .map((f) => f.regression)\n      .filter((m): m is RegressionMetrics => !!m);\n    if (regs.length > 0) {\n      avg.regression = this.aggregateRegression(regs, (arr) => tf.mean(arr).dataSync()[0]);\n    }\n\n    return avg;\n  }\n\n  /** Std deviation of time-series metrics across folds. */\n  private stdTimeSeriesMetrics(foldMetrics: TimeSeriesFoldMetrics[]): TimeSeriesFoldMetrics | undefined {\n    if (foldMetrics.length === 0) return undefined;\n\n    const std: TimeSeriesFoldMetrics = {};\n\n    const cls = foldMetrics\n      .map((f) => f.classification)\n      .filter((m): m is ValidationMetrics => !!m);\n    if (cls.length > 0) {\n      std.classification = this.aggregateMetrics(\n        cls,\n        (arr) => tf.moments(arr).variance.sqrt().dataSync()[0]\n      );\n    }\n\n    const regs = foldMetrics\n      .map((f) => f.regression)\n      .filter((m): m is RegressionMetrics => !!m);\n    if (regs.length > 0) {\n      std.regression = this.aggregateRegression(\n        regs,\n        (arr) => tf.moments(arr).variance.sqrt().dataSync()[0]\n      );\n    }\n\n    return std;\n  }\n\n  private aggregateRegression(\n    foldMetrics: RegressionMetrics[],\n    aggFn: (arr: number[]) => number\n  ): RegressionMetrics {\n    const keys: (keyof RegressionMetrics)[] = ['mse', 'rmse', 'mae', 'mape'];\n    const out: RegressionMetrics = { mse: 0, rmse: 0, mae: 0, mape: 0 };\n    for (const key of keys) {\n      const values = foldMetrics.map((m) => m[key]);\n      out[key] = aggFn(values);\n    }\n    return out;\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/validation/dataLeakage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/lib/validationTypes.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/main.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[636,639],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[636,639],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[728,731],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[728,731],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createRoot } from 'react-dom/client'\nimport { App } from './App.tsx'\nimport { logger, LogLevel } from '@/lib/logger'\nimport { POC_MODE } from '@/lib/env'\nimport { setRuntimeEnvFromVite } from '@/lib/runtimeEnv'\nimport './index.css'\nimport { i18n, initI18n } from './i18n'\nimport { I18nextProvider } from 'react-i18next'\nimport { validateStartupConfiguration } from '@/lib/startupValidation'\n\n// Seed a stable runtime env snapshot for all modules/routes\nsetRuntimeEnvFromVite();\n\n// Dev-only: seed localStorage fallbacks so AI works even if Vite env is missing\nif (import.meta.env.DEV) {\n  try {\n    const key = (import.meta as any)?.env?.VITE_OPENROUTER_API_KEY as string | undefined;\n    const model = (import.meta as any)?.env?.VITE_AI_MODEL_NAME as string | undefined;\n    const ls = (k: string) => {\n      try { return localStorage.getItem(k) || ''; } catch { return ''; }\n    };\n    if (!ls('OPENROUTER_API_KEY') && typeof key === 'string' && key.trim().length > 0) {\n      localStorage.setItem('OPENROUTER_API_KEY', key.trim());\n    }\n    if (!ls('VITE_OPENROUTER_API_KEY') && typeof key === 'string' && key.trim().length > 0) {\n      localStorage.setItem('VITE_OPENROUTER_API_KEY', key.trim());\n    }\n    const m = (typeof model === 'string' && model.trim().length > 0) ? model.trim() : 'openai/gpt-4o-mini';\n    if (!ls('VITE_AI_MODEL_NAME')) {\n      localStorage.setItem('VITE_AI_MODEL_NAME', m);\n    }\n  } catch {\n    // ignore\n  }\n}\n\n// Ensure i18n is initialized before rendering\nawait initI18n();\n\n// Run startup validation (non-blocking)\ntry {\n  void validateStartupConfiguration().then(res => {\n    if (!res.isValid) {\n      logger.warn('[main] Startup validation issues', { errors: res.errors, warnings: res.warnings });\n    } else {\n      logger.debug('[main] Startup validation ok');\n    }\n  }).catch(err => {\n    logger.warn('[main] Startup validation failed to run', err as Error);\n  });\n} catch (e) {\n  logger.warn('[main] Failed to initiate startup validation', e as Error);\n}\n\ncreateRoot(document.getElementById(\"root\")!).render(\n  <I18nextProvider i18n={i18n}>\n    <App />\n  </I18nextProvider>\n);\n\n// Configure logger for POC mode to minimize console noise\nif (POC_MODE) {\n  logger.configure({ level: LogLevel.ERROR, enableConsole: true });\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/AddStudent.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"*\"","line":103,"column":67,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":104,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Student } from \"@/types/student\";\nimport { ArrowLeft, UserPlus } from \"lucide-react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { toast } from \"sonner\";\nimport { useTranslation } from \"@/hooks/useTranslation\";\nimport { LanguageSettings } from \"@/components/LanguageSettings\";\nimport { analyticsManager } from \"@/lib/analyticsManager\";\nimport { dataStorage } from \"@/lib/dataStorage\";\nimport { logger } from \"@/lib/logger\";\n\nconst AddStudent = () => {\n  const [name, setName] = useState('');\n  const [grade, setGrade] = useState('');\n  const [dateOfBirth, setDateOfBirth] = useState('');\n  const [notes, setNotes] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  \n  const navigate = useNavigate();\n  const { tStudent, tCommon } = useTranslation();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!name.trim()) {\n      toast.error(String(tStudent('addStudent.form.name.required')));\n      return;\n    }\n\n    setIsLoading(true);\n\n    try {\n      const newStudent: Student = {\n        id: crypto.randomUUID(),\n        name: name.trim(),\n        grade: grade.trim() || undefined,\n        dateOfBirth: dateOfBirth || undefined,\n        notes: notes.trim() || undefined,\n        createdAt: new Date(),\n      };\n\n      // Save student using proper dataStorage method\n      dataStorage.saveStudent(newStudent);\n      \n      // Initialize analytics infrastructure only (no mock data generation)\n      analyticsManager.initializeStudentAnalytics(newStudent.id);\n      \n      toast.success(String(tStudent('addStudent.success')));\n      navigate('/');\n    } catch (error) {\n      logger.error('Error adding student:', error);\n      const errorMessage = error instanceof Error ? error.message : \"Failed to add student. Please try again.\";\n      toast.error(errorMessage);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background font-dyslexia\">\n      <div className=\"container mx-auto px-4 py-8 max-w-2xl\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <Button\n              variant=\"ghost\"\n              aria-label={String(tStudent('addStudent.backToDashboard'))}\n              title={String(tStudent('addStudent.backToDashboard'))}\n              onClick={() => navigate('/')}\n              className=\"font-dyslexia\"\n            >\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              <span className=\"hidden sm:inline\">{String(tStudent('addStudent.backToDashboard'))}</span>\n            </Button>\n            <LanguageSettings />\n          </div>\n          \n          <h1 className=\"text-3xl font-bold text-foreground mb-2\">\n            {String(tStudent('addStudent.title'))}\n          </h1>\n          <p className=\"text-muted-foreground\">\n            {String(tStudent('addStudent.description'))}\n          </p>\n        </div>\n\n        {/* Form */}\n        <Card className=\"bg-gradient-card border-0 shadow-medium\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2 text-foreground\">\n              <UserPlus className=\"h-5 w-5\" />\n              {String(tStudent('profile.information'))}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\n              {/* Name - Required */}\n              <div>\n                <label className=\"block text-sm font-medium text-foreground mb-2\">\n                  {String(tStudent('addStudent.form.name.label'))} *\n                </label>\n                <Input\n                  type=\"text\"\n                  value={name}\n                  onChange={(e) => setName(e.target.value)}\n                  placeholder={String(tStudent('addStudent.form.name.placeholder'))}\n                  className=\"font-dyslexia bg-input border-border focus:ring-ring\"\n                  required\n                />\n              </div>\n\n              {/* Grade - Optional */}\n              <div>\n                <label className=\"block text-sm font-medium text-foreground mb-2\">\n                  {String(tStudent('addStudent.form.grade.label'))}\n                </label>\n                <Input\n                  type=\"text\"\n                  value={grade}\n                  onChange={(e) => setGrade(e.target.value)}\n                  placeholder={String(tStudent('addStudent.form.grade.placeholder'))}\n                  className=\"font-dyslexia bg-input border-border focus:ring-ring\"\n                />\n              </div>\n\n              {/* Date of Birth - Optional */}\n              <div>\n                <label className=\"block text-sm font-medium text-foreground mb-2\">\n                  {String(tStudent('addStudent.form.dateOfBirth.label'))}\n                </label>\n                <Input\n                  type=\"date\"\n                  value={dateOfBirth}\n                  onChange={(e) => setDateOfBirth(e.target.value)}\n                  className=\"font-dyslexia bg-input border-border focus:ring-ring\"\n                />\n              </div>\n\n              {/* Notes - Optional */}\n              <div>\n                <label className=\"block text-sm font-medium text-foreground mb-2\">\n                  {String(tStudent('addStudent.form.notes.label'))}\n                </label>\n                <Textarea\n                  value={notes}\n                  onChange={(e) => setNotes(e.target.value)}\n                  placeholder={String(tStudent('addStudent.form.notes.placeholder'))}\n                  className=\"font-dyslexia bg-input border-border focus:ring-ring\"\n                  rows={4}\n                />\n              </div>\n\n              {/* Submit Buttons */}\n              <div className=\"flex gap-4 pt-4\">\n              <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  onClick={() => navigate('/')}\n                  className=\"flex-1 font-dyslexia\"\n                  disabled={isLoading}\n                >\n                  {String(tCommon('buttons.cancel'))}\n                </Button>\n                <Button\n                  type=\"submit\"\n                  className=\"flex-1 font-dyslexia bg-gradient-primary hover:opacity-90 transition-all duration-200\"\n                  disabled={isLoading}\n                >\n                  {isLoading ? (\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"w-4 h-4 border-2 border-primary-foreground border-t-transparent rounded-full animate-spin\" />\n                      {String(tCommon('status.saving'))}\n                    </div>\n                  ) : (\n                    <>\n                      <UserPlus className=\"h-4 w-4 mr-2\" />\n                      {String(tCommon('buttons.add'))} {String(tCommon('navigation.students')).slice(0, -1)}\n                    </>\n                  )}\n                </Button>\n              </div>\n            </form>\n          </CardContent>\n        </Card>\n\n        {/* Helper Text */}\n        <div className=\"mt-6 p-4 bg-accent/50 rounded-lg border border-accent\">\n          <h3 className=\"font-medium text-accent-foreground mb-2\">{String(tStudent('addStudent.helpText'))}</h3>\n          <p className=\"text-sm text-accent-foreground/80\">\n            {String(tStudent('addStudent.helpText'))}\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default AddStudent;\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/Dashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrackingEntry' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'HelpCircle' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":34},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":64,"column":1,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":64,"endColumn":56},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":68,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":68,"endColumn":68},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"K\"","line":168,"column":116,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":168,"endColumn":117},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"kreativium‑AI\"","line":233,"column":58,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":235,"endColumn":19},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n                    variant=\"glass\"\n                    size=\"lg\"\n                    onClick={() => navigate('/kreativium-ai')}\n                    className=\"flex items-center justify-center group\"\n                    aria-label=\"Kreativium AI\"\n                    data-testid=\"dashboard-kreativium-ai-button\"\n                  >\n                    <Sparkles className=\"mr-2 h-4 w-4\" />\n                    kreativium‑AI\n                  </Button>","line":233,"column":58,"nodeType":"JSXText","endLine":235,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"5%\"","line":332,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":332,"endColumn":58},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"from last week\"","line":333,"column":66,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":333,"endColumn":80},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"ml-1 text-muted-foreground\">from last week</span>","line":333,"column":66,"nodeType":"JSXText","endLine":333,"endColumn":80},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":360,"column":33,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":360,"endColumn":34}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogDescription } from \"@/components/ui/dialog\";\nimport { Student, TrackingEntry } from \"@/types/student\";\nimport { useNavigate } from \"react-router-dom\";\nimport { isToday } from \"date-fns\";\nimport { useTranslation } from \"@/hooks/useTranslation\";\nimport { AnimatedCounter } from \"@/components/AnimatedCounter\";\nimport { LanguageSettings } from \"@/components/LanguageSettings\";\nimport { POCBadge } from \"@/components/POCBadge\";\nimport { POC_MODE, IS_PROD } from \"@/lib/env\";\nimport { PremiumStudentCard } from \"@/components/ui/PremiumStudentCard\";\nimport { MockDataLoader } from \"@/components/MockDataLoader\";\nimport { dataStorage } from \"@/lib/dataStorage\";\nimport { FlaskConical, HelpCircle, Download, Plus, Users, CalendarDays, BarChart3, TrendingUp, TrendingDown, Hand, Sparkles } from \"lucide-react\";\nimport { HelpAndSupport } from \"@/components/HelpAndSupport\";\nimport { GlobalMenu } from \"@/components/GlobalMenu\";\nimport { subWeeks, startOfWeek, endOfWeek, isWithinInterval } from 'date-fns';\nimport { logger } from \"@/lib/logger\";\nimport { cn } from \"@/lib/utils\";\n\n/**\n * Dashboard component - Main landing page with modern glassmorphism design\n * @returns React component displaying students list and tracking statistics\n */\nconst Dashboard = () => {\n  const [students, setStudents] = useState<Student[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const navigate = useNavigate();\n  const { tDashboard, tCommon, tSettings } = useTranslation();\n\n  useEffect(() => {\n    const loadData = () => {\n      try {\n        const students = dataStorage.getStudents();\n        setStudents(students);\n      } catch (error) {\n        logger.error('Dashboard: Error loading students', { error });\n        setStudents([]);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n\n    loadData();\n    \n    // Listen for storage changes to refresh data without page reload\n    const handleStorageChange = (e: StorageEvent) => {\n      if (e.key?.startsWith('sensoryTracker_')) {\n        \n        loadData();\n      }\n    };\n\n    /**\n     * Handles the 'mockDataLoaded' event dispatched from the MockDataLoader component.\n     * This ensures the dashboard's data is refreshed when mock data is loaded.\n     */\n    const handleMockDataLoaded = () => {\n      loadData();\n    }\n    \nwindow.addEventListener('storage', handleStorageChange);\n    logger.debug('[EVENT_LISTENER] Added storage listener');\n    \n    // The 'mockDataLoaded' event is a custom event dispatched from the MockDataLoader component.\n    window.addEventListener('mockDataLoaded', handleMockDataLoaded);\n    logger.debug('[EVENT_LISTENER] Added mockDataLoaded listener');\n    \n    return () => {\n      window.removeEventListener('storage', handleStorageChange);\n      logger.debug('[EVENT_LISTENER] Removed storage listener');\n      \n      window.removeEventListener('mockDataLoaded', handleMockDataLoaded);\n      logger.debug('[EVENT_LISTENER] Removed mockDataLoaded listener');\n    };\n  }, []);\n\n  /**\n   * Calculate statistics from all tracking data, including weekly trends.\n   * This memoized calculation avoids re-computing on every render.\n   */\n  const { todayEntries, totalEntries, weeklyTrend } = useMemo(() => {\n    if (students.length === 0) {\n      return { todayEntries: 0, totalEntries: 0, weeklyTrend: { students: 0, entries: 0 } };\n    }\n\n    try {\n      const allEntries = dataStorage.getTrackingEntries();\n      const todayCount = allEntries.filter(entry => isToday(entry.timestamp)).length;\n\n      const now = new Date();\n      const lastWeekStart = startOfWeek(subWeeks(now, 1));\n      const lastWeekEnd = endOfWeek(subWeeks(now, 1));\n      const thisWeekStart = startOfWeek(now);\n\n      const lastWeekEntries = allEntries.filter(entry => isWithinInterval(entry.timestamp, { start: lastWeekStart, end: lastWeekEnd })).length;\n      const thisWeekEntries = allEntries.filter(entry => isWithinInterval(entry.timestamp, { start: thisWeekStart, end: now })).length;\n\n      const entriesTrend = lastWeekEntries > 0 ? ((thisWeekEntries - lastWeekEntries) / lastWeekEntries) * 100 : thisWeekEntries > 0 ? 100 : 0;\n\n      const lastWeekStudents = students.filter(s => isWithinInterval(new Date(s.createdAt), { start: lastWeekStart, end: lastWeekEnd })).length;\n      const thisWeekStudents = students.filter(s => isWithinInterval(new Date(s.createdAt), { start: thisWeekStart, end: now })).length;\n      const studentsTrend = lastWeekStudents > 0 ? ((thisWeekStudents - lastWeekStudents) / lastWeekStudents) * 100 : thisWeekStudents > 0 ? 100 : 0;\n      \n      return { \n        todayEntries: todayCount,\n        totalEntries: allEntries.length,\n        weeklyTrend: {\n          students: studentsTrend,\n          entries: entriesTrend\n        }\n      };\n    } catch (error) {\n      logger.error('Dashboard: Error calculating statistics', { error });\n      return { todayEntries: 0, totalEntries: 0, weeklyTrend: { students: 0, entries: 0 } };\n    }\n  }, [students]);\n\n  const handleAddStudent = () => {\n    navigate('/add-student');\n  };\n\n  const handleNewEntry = () => {\n    if (students.length > 0) {\n      navigate(`/track/${students[0].id}`);\n    } else {\n      navigate('/add-student');\n    }\n  };\n\n  // Removed system-wide export from Dashboard. A dedicated Reports page now handles exports.\n\n  const handleViewStudent = (student: Student) => {\n    navigate(`/student/${student.id}`);\n  };\n\n  const handleTrackStudent = (student: Student) => {\n    navigate(`/track/${student.id}`);\n  };\n\n  return (\n    <div className=\"main-container min-h-screen relative\">\n      {/* Animated glow background */}\n      <div className=\"glow-bg\"></div>\n      \n      <div className=\"relative z-10 min-h-screen px-4 py-8 sm:px-6 lg:px-8\">\n        <div className=\"max-w-7xl mx-auto\">\n          \n          {/* Enhanced Header with Gradient and Animations */}\n          <header className=\"relative mb-16 overflow-hidden\">\n            {/* Decorative background elements */}\n            <div className=\"absolute inset-0 -z-10\">\n              <div className=\"absolute top-0 -left-4 w-72 h-72 bg-purple-300 rounded-full mix-blend-multiply filter blur-xl opacity-10 motion-safe:animate-blob\"></div>\n              <div className=\"absolute top-0 -right-4 w-72 h-72 bg-yellow-300 rounded-full mix-blend-multiply filter blur-xl opacity-10 motion-safe:animate-blob animation-delay-2000\"></div>\n              <div className=\"absolute -bottom-8 left-20 w-72 h-72 bg-pink-300 rounded-full mix-blend-multiply filter blur-xl opacity-10 motion-safe:animate-blob animation-delay-4000\"></div>\n            </div>\n            \n            <div className=\"relative glass-card rounded-2xl p-8 shadow-2xl backdrop-blur-xl border border-primary/20\">\n              <div className=\"flex justify-between items-center\">\n                <div className=\"space-y-4\">\n                  {/* Animated title with gradient */}\n                  <div className=\"flex items-center gap-4\">\n                    <div className=\"relative\">\n                      <div className=\"absolute inset-0 bg-gradient-to-r from-primary via-purple-500 to-pink-500 rounded-2xl blur-xl opacity-50 motion-safe:animate-pulse\"></div>\n                      <div className=\"relative bg-gradient-to-br from-primary/20 to-purple-500/20 p-4 rounded-2xl border border-primary/30 group\">\n                        <div className=\"text-3xl font-bold text-white motion-safe:group-hover:animate-bounce-slow\">K</div>\n                      </div>\n                    </div>\n                    <div>\n                      <h1 className=\"text-5xl lg:text-6xl font-black bg-gradient-to-r from-white via-primary-foreground to-purple-200 bg-clip-text text-transparent motion-safe:animate-gradient-x\">\n                        {String(tDashboard('title'))}\n                      </h1>\n                      <div className=\"flex items-center gap-2 mt-2\">\n                        <div className=\"h-0.5 w-8 bg-gradient-to-r from-primary to-purple-500 rounded-full\"></div>\n                        <div className=\"h-0.5 w-4 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full\"></div>\n                        <div className=\"h-0.5 w-2 bg-pink-500 rounded-full\"></div>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  {/* Subtitle with elegant styling */}\n                  <p className=\"text-lg lg:text-xl text-muted-foreground/90 font-light tracking-wide max-w-2xl leading-relaxed\">\n                    {String(tDashboard('subtitle'))}\n                  </p>\n                  \n                  {/* Stats pills */}\n                  <div className=\"flex flex-wrap gap-3 pt-2\">\n                    <div className=\"px-4 py-2 bg-primary/10 rounded-full border border-primary/20 backdrop-blur-sm\">\n                      <span className=\"text-xs font-medium text-primary\">{students.length} {String(tDashboard('pills.students'))}</span>\n                    </div>\n                    <div className=\"px-4 py-2 bg-purple-500/10 rounded-full border border-purple-500/20 backdrop-blur-sm\">\n                      <span className=\"text-xs font-medium text-primary-foreground/80\">{todayEntries} {String(tDashboard('pills.today'))}</span>\n                      <span className=\"text-xs font-medium text-primary-foreground/80\">{totalEntries} {String(tDashboard('pills.total'))}</span>\n                    </div>\n                    <div className=\"px-4 py-2 bg-pink-500/10 rounded-full border border-pink-500/20 backdrop-blur-sm\">\n                      <span className=\"text-xs font-medium text-pink-400\">{totalEntries} {String(tDashboard('pills.total'))}</span>\n                    </div>\n                  </div>\n                </div>\n                \n                {/* Action buttons with glassmorphism */}\n                <div className=\"flex items-center gap-3\">\n                  {POC_MODE && <POCBadge />}\n                  \n                  <div className=\"flex items-center gap-2\" role=\"toolbar\" aria-label={tCommon('a11y.headerControls')}>\n                    <GlobalMenu />\n                    <HelpAndSupport />\n                    <LanguageSettings />\n                  </div>\n                </div>\n              </div>\n            </div>\n            </header>\n\n            <main>\n              {/* Overview section with buttons */}\n              <div \n                className=\"flex justify-between items-center mb-8 motion-safe:animate-fade-in\" \n                data-animation-delay=\"0.2s\"\n              >\n                <h2 className=\"text-3xl font-bold tracking-tight text-foreground\">{String(tDashboard('overview.title'))}</h2>\n                <div className=\"flex items-center space-x-4\">\n                  <Button\n                    variant=\"glass\"\n                    size=\"lg\"\n                    onClick={() => navigate('/kreativium-ai')}\n                    className=\"flex items-center justify-center group\"\n                    aria-label=\"Kreativium AI\"\n                    data-testid=\"dashboard-kreativium-ai-button\"\n                  >\n                    <Sparkles className=\"mr-2 h-4 w-4\" />\n                    kreativium‑AI\n                  </Button>\n                  <Button \n                    variant=\"outline\" \n                    onClick={() => navigate('/reports')}\n                    className=\"flex items-center justify-center group\"\n                    aria-label={tSettings('data.export')}\n                    data-testid=\"dashboard-export-link\"\n                  >\n                    <Download className=\"mr-2 h-4 w-4\" />\n                    {String(tSettings('data.export'))}\n                  </Button>\n                  <Button\n                    variant=\"glass\"\n                    size=\"lg\"\n                    onClick={() => navigate('/tegn')}\n                    className=\"flex items-center justify-center group\"\n                    aria-label={tCommon('navigation.tegnTilTale')}\n                    data-testid=\"dashboard-tegn-button\"\n                  >\n                    <Hand className=\"mr-2 h-4 w-4\" />\n                    {String(tCommon('navigation.tegnTilTale'))}\n                  </Button>\n                  <Button \n                    variant=\"default\" \n                    onClick={handleNewEntry}\n                    size=\"lg\"\n                    className=\"flex items-center justify-center group\"\n                  >\n                    <Plus className=\"mr-2 h-4 w-4 group-hover:animate-bounce\" />\n                    {String(tDashboard('actions.newEntry'))}\n                  </Button>\n                </div>\n              </div>\n\n              {/* Stats cards */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12\">\n                  <Card \n                  className=\"motion-safe:animate-fade-in\" \n                  data-animation-delay=\"0.3s\"\n                >\n                  <div className=\"flex justify-between items-start\">\n                    <h3 className=\"text-lg font-medium text-muted-foreground\">\n                      {String(tDashboard('stats.totalStudents'))}\n                    </h3>\n                    <div className=\"icon-bg p-2 rounded-lg\">\n                      <Users className=\"text-primary h-5 w-5\" />\n                    </div>\n                  </div>\n                  <p className=\"text-5xl font-bold mt-6 text-foreground motion-safe:animate-number-pop\" data-animation-delay=\"0.4s\">\n                    <AnimatedCounter value={isLoading ? 0 : students.length} />\n                  </p>\n                  <div className=\"flex items-center text-sm mt-3\">\n                    {weeklyTrend.students >= 0 ? <TrendingUp className=\"text-success h-4 w-4 mr-1\" /> : <TrendingDown className=\"text-destructive h-4 w-4 mr-1\" />}\n                    <span className={cn(weeklyTrend.students >= 0 ? \"text-success\" : \"text-destructive\")}>{Math.abs(weeklyTrend.students).toFixed(0)}%</span>\n                    <span className=\"ml-1 text-muted-foreground\">{String(tDashboard('stats.fromLastWeek'))}</span>\n                  </div>\n                </Card>\n\n                <Card \n                  className=\"motion-safe:animate-fade-in\" \n                  data-animation-delay=\"0.4s\"\n                >\n                  <div className=\"flex justify-between items-start\">\n                    <h3 className=\"text-lg font-medium text-muted-foreground\">\n                      {String(tDashboard('stats.todaysEntries'))}\n                    </h3>\n                    <div className=\"icon-bg p-2 rounded-lg\">\n                      <CalendarDays className=\"text-primary h-5 w-5\" />\n                    </div>\n                  </div>\n                  <p className=\"text-5xl font-bold mt-6 text-foreground motion-safe:animate-number-pop\" data-animation-delay=\"0.5s\">\n                    <AnimatedCounter value={isLoading ? 0 : todayEntries} />\n                  </p>\n                  <div className=\"flex items-center text-sm mt-3\">\n                    {weeklyTrend.entries >= 0 ? <TrendingUp className=\"text-success h-4 w-4 mr-1\" /> : <TrendingDown className=\"text-destructive h-4 w-4 mr-1\" />}\n                    <span className={cn(weeklyTrend.entries >= 0 ? \"text-success\" : \"text-destructive\")}>{Math.abs(weeklyTrend.entries).toFixed(0)}%</span>\n                    <span className=\"ml-1 text-muted-foreground\">{String(tDashboard('stats.fromLastWeek'))}</span>\n                  </div>\n                </Card>\n\n                <Card \n                  className=\"motion-safe:animate-fade-in\" \n                  data-animation-delay=\"0.5s\"\n                >\n                  <div className=\"flex justify-between items-start\">\n                    <h3 className=\"text-lg font-medium text-muted-foreground\">\n                      {String(tDashboard('stats.totalEntries'))}\n                    </h3>\n                    <div className=\"icon-bg p-2 rounded-lg\">\n                      <BarChart3 className=\"text-primary h-5 w-5\" />\n                    </div>\n                  </div>\n                  <p className=\"text-5xl font-bold mt-6 text-foreground motion-safe:animate-number-pop\" data-animation-delay=\"0.6s\">\n                    <AnimatedCounter value={isLoading ? 0 : totalEntries} />\n                  </p>\n                  <div className=\"flex items-center text-sm mt-3\">\n                    <TrendingDown className=\"text-destructive h-4 w-4 mr-1\" />\n                    <span className=\"text-destructive\">5%</span>\n                    <span className=\"ml-1 text-muted-foreground\">from last week</span>\n                  </div>\n                </Card>\n              </div>\n\n              {/* Students section */}\n              <div>\n                <div \n                  className=\"flex justify-between items-center mb-8 text-foreground motion-safe:animate-fade-in\" \n                  data-animation-delay=\"0.6s\"\n                >\n                  <h2 className=\"text-3xl font-bold tracking-tight\">{String(tDashboard('students.title'))}</h2>\n                  <Button \n                    variant=\"default\" \n                    onClick={handleAddStudent}\n                    size=\"lg\"\n                    className=\"flex items-center justify-center group\"\n                  >\n                    <Plus className=\"mr-2 h-4 w-4 group-hover:animate-bounce transition-transform\" />\n                    {String(tDashboard('actions.addStudent'))}\n                  </Button>\n                </div>\n\n                {/* Students grid or empty state */}\n                {isLoading ? (\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 motion-safe:animate-fade-in\" data-animation-delay=\"0.7s\">\n                    {[...Array(3)].map((_, i) => (\n                      <div key={i} className=\"glass-card rounded-3xl p-6 animate-pulse\">\n                        <div className=\"flex items-start gap-4 mb-4\">\n                          <div className=\"w-12 h-12 bg-muted/50 rounded-full\"></div>\n                          <div className=\"flex-1\">\n                            <div className=\"h-5 bg-muted/50 rounded mb-2\"></div>\n                            <div className=\"h-4 bg-muted/30 rounded w-2/3\"></div>\n                          </div>\n                        </div>\n                        <div className=\"h-2 bg-muted/30 rounded mb-4\"></div>\n                        <div className=\"grid grid-cols-2 gap-4 mb-4\">\n                          <div className=\"h-12 bg-muted/30 rounded\"></div>\n                          <div className=\"h-12 bg-muted/30 rounded\"></div>\n                        </div>\n                        <div className=\"flex gap-2\">\n                          <div className=\"h-8 bg-muted/30 rounded flex-1\"></div>\n                          <div className=\"h-8 bg-muted/30 rounded flex-1\"></div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                ) : students.length > 0 ? (\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-fade-in\" data-animation-delay=\"0.7s\">\n                    {students.map((student, index) => (\n                      <PremiumStudentCard\n                        key={student.id}\n                        student={student}\n                        onView={handleViewStudent}\n                        onTrack={handleTrackStudent}\n                        index={index}\n                      />\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"space-y-8 animate-fade-in\" data-animation-delay=\"0.7s\">\n                    {/* Empty State */}\n                    <div className=\"relative glass-card rounded-3xl p-8 text-center min-h-[400px] flex flex-col justify-center items-center overflow-hidden\">\n                      {/* Decorative SVG elements */}\n                      <div className=\"absolute top-10 right-10 opacity-10 transition-transform duration-500 hover:scale-110\">\n                        <svg fill=\"none\" height=\"100\" viewBox=\"0 0 24 24\" width=\"100\" xmlns=\"http://www.w3.org/2000/svg\">\n                          <path d=\"M16.5 12C16.5 14.4853 14.4853 16.5 12 16.5C9.51472 16.5 7.5 14.4853 7.5 12C7.5 9.51472 9.51472 7.5 12 7.5C14.4853 7.5 16.5 9.51472 16.5 12Z\" stroke=\"hsl(var(--primary))\" strokeWidth=\"1.5\"></path>\n                          <path d=\"M19.5 17.5714C19.5 19.961 17.2687 21.5 15.4286 21.5C13.5884 21.5 11.8333 20.3571 10.7143 19.2857M4.5 17.5714C4.5 19.961 6.73134 21.5 8.57143 21.5C10.4116 21.5 12.1667 20.3571 13.2857 19.2857M13.2857 19.2857C14.0714 18.5 14.0714 17.2143 13.2857 16.4286M10.7143 19.2857C9.92857 18.5 9.92857 17.2143 10.7143 16.4286M13.2857 16.4286C12.5 15.6429 11.5 15.6429 10.7143 16.4286M12 7.5C10.7143 4.5 8.57143 2.5 6 2.5M12 7.5C13.2857 4.5 15.4286 2.5 18 2.5\" stroke=\"hsl(var(--primary))\" strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"1.5\"></path>\n                        </svg>\n                      </div>\n                      \n                      <div className=\"absolute bottom-10 left-10 opacity-5 -rotate-12 transition-transform duration-500 hover:scale-110 hover:-rotate-6\">\n                        <svg fill=\"none\" height=\"120\" viewBox=\"0 0 24 24\" width=\"120\" xmlns=\"http://www.w3.org/2000/svg\">\n                          <path d=\"M16.5 12C16.5 14.4853 14.4853 16.5 12 16.5C9.51472 16.5 7.5 14.4853 7.5 12C7.5 9.51472 9.51472 7.5 12 7.5C14.4853 7.5 16.5 9.51472 16.5 12Z\" stroke=\"hsl(var(--primary))\" strokeWidth=\"1.5\"></path>\n                          <path d=\"M19.5 17.5714C19.5 19.961 17.2687 21.5 15.4286 21.5C13.5884 21.5 11.8333 20.3571 10.7143 19.2857M4.5 17.5714C4.5 19.961 6.73134 21.5 8.57143 21.5C10.4116 21.5 12.1667 20.3571 13.2857 19.2857M13.2857 19.2857C14.0714 18.5 14.0714 17.2143 13.2857 16.4286M10.7143 19.2857C9.92857 18.5 9.92857 17.2143 10.7143 16.4286M13.2857 16.4286C12.5 15.6429 11.5 15.6429 10.7143 16.4286M12 7.5C10.7143 4.5 8.57143 2.5 6 2.5M12 7.5C13.2857 4.5 15.4286 2.5 18 2.5\" stroke=\"hsl(var(--primary))\" strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"1.5\"></path>\n                        </svg>\n                      </div>\n\n                      <div className=\"relative z-10 flex flex-col items-center\">\n                        <div className=\"flex items-center justify-center w-24 h-24 bg-primary/10 rounded-full mb-6 border border-primary/20 transition-transform duration-300 hover:scale-110\">\n                          <Users className=\"text-primary h-12 w-12 transition-transform duration-300 group-hover:rotate-6\" />\n                        </div>\n                        <h3 className=\"text-2xl font-semibold text-foreground\">\n                          {String(tDashboard('empty.welcome'))}\n                        </h3>\n                        <p className=\"mt-3 max-w-md text-base text-muted-foreground\">\n                          {String(tDashboard('empty.description'))}\n                        </p>\n                        <Button \n                          variant=\"default\" \n                          onClick={handleAddStudent}\n                          size=\"lg\"\n                          className=\"mt-8 flex items-center justify-center group\"\n                        >\n                          <Plus className=\"mr-2 h-4 w-4 group-hover:animate-bounce transition-transform\" />\n                          {String(tDashboard('empty.addFirstStudent'))}\n                        </Button>\n                      </div>\n                    </div>\n\n                    {/*\n                      The MockDataLoader component is displayed in the empty state to help users\n                      get started with some sample data for testing and exploration.\n                    */}\n                    {(!IS_PROD || POC_MODE) && (\n                      <Card className=\"mt-8 bg-gradient-card border-0 shadow-soft\">\n                        <CardContent className=\"p-6\">\n                          <div className=\"text-center mb-4\">\n                            <h4 className=\"text-lg font-semibold text-foreground\">{String(tDashboard('empty.sample.title'))}</h4>\n                            <p className=\"text-sm text-muted-foreground mt-1\">\n                              {String(tDashboard('empty.sample.description'))}\n                            </p>\n                          </div>\n                          <Dialog>\n                            <DialogTrigger asChild>\n                              <Button variant=\"outline\" className=\"w-full\">\n                                <FlaskConical className=\"h-4 w-4 mr-2\" />\n                                {String(tDashboard('empty.sample.loadButton'))}\n                              </Button>\n                            </DialogTrigger>\n                            <DialogContent className=\"max-w-2xl\">\n                              <DialogHeader>\n                                <DialogTitle>{String(tDashboard('empty.sample.dialogTitle'))}</DialogTitle>\n                                <DialogDescription>\n                                  {String(tDashboard('empty.sample.dialogDescription'))}\n                                </DialogDescription>\n                              </DialogHeader>\n                              <MockDataLoader />\n                            </DialogContent>\n                          </Dialog>\n                        </CardContent>\n                      </Card>\n                    )}\n                  </div>\n                )}\n              </div>\n            </main>\n          </div>\n        </div>\n      </div>\n  );\n};\n\nexport { Dashboard };\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/DevTools.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Developer Tools\"","line":26,"column":24,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":26,"endColumn":39},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle>Developer Tools</CardTitle>","line":26,"column":24,"nodeType":"JSXText","endLine":26,"endColumn":39},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"This section is not available in production.\"","line":29,"column":58,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":29,"endColumn":102},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground\">This section is not available in production.</p>","line":29,"column":58,"nodeType":"JSXText","endLine":29,"endColumn":102},{"ruleId":"react-hooks/rules-of-hooks","severity":1,"message":"React Hook \"useTranslation\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":36,"column":23,"nodeType":"Identifier","endLine":36,"endColumn":37},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Developer Tools\"","line":48,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":50,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h1 className=\"text-3xl font-bold tracking-tight flex items-center gap-2\">\n            <Wrench className=\"h-6 w-6 text-primary\" />\n            Developer Tools\n          </h1>","line":48,"column":56,"nodeType":"JSXText","endLine":50,"endColumn":11},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Storage Management\"","line":60,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":62,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n              <Database className=\"h-5 w-5 text-primary\" />\n              Storage Management\n            </CardTitle>","line":60,"column":60,"nodeType":"JSXText","endLine":62,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Inspect and manage local data storage. Clear old or non-essential data safely.\"","line":65,"column":63,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":67,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground mb-4\">\n              Inspect and manage local data storage. Clear old or non-essential data safely.\n            </p>","line":65,"column":63,"nodeType":"JSXText","endLine":67,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Open Storage Manager\"","line":71,"column":56,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":73,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button variant=\"outline\" className=\"w-full\">\n                  <Database className=\"h-4 w-4 mr-2\" />\n                  Open Storage Manager\n                </Button>","line":71,"column":56,"nodeType":"JSXText","endLine":73,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Storage Management\"","line":77,"column":32,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":77,"endColumn":50},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DialogTitle>Storage Management</DialogTitle>","line":77,"column":32,"nodeType":"JSXText","endLine":77,"endColumn":50},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Loading…\"","line":79,"column":88,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":79,"endColumn":96},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"p-4 text-sm text-muted-foreground\">Loading…</div>","line":79,"column":88,"nodeType":"JSXText","endLine":79,"endColumn":96},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Model Diagnostics\"","line":91,"column":63,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":93,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n              <Stethoscope className=\"h-5 w-5 text-primary\" />\n              Model Diagnostics\n            </CardTitle>","line":91,"column":63,"nodeType":"JSXText","endLine":93,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Run time-series cross-validation and inspect recent evaluation runs. Loaded on demand to keep main bundle small.\"","line":96,"column":63,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":98,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground mb-4\">\n              Run time-series cross-validation and inspect recent evaluation runs. Loaded on demand to keep main bundle small.\n            </p>","line":96,"column":63,"nodeType":"JSXText","endLine":98,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Open Diagnostics Panel\"","line":102,"column":59,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":104,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button variant=\"outline\" className=\"w-full\">\n                  <Stethoscope className=\"h-4 w-4 mr-2\" />\n                  Open Diagnostics Panel\n                </Button>","line":102,"column":59,"nodeType":"JSXText","endLine":104,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Model Diagnostics\"","line":108,"column":32,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":108,"endColumn":49},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <DialogTitle>Model Diagnostics</DialogTitle>","line":108,"column":32,"nodeType":"JSXText","endLine":108,"endColumn":49},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Loading diagnostics…\"","line":110,"column":88,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":110,"endColumn":108},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"p-4 text-sm text-muted-foreground\">Loading diagnostics…</div>","line":110,"column":88,"nodeType":"JSXText","endLine":110,"endColumn":108},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Loading env…\"","line":119,"column":80,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":119,"endColumn":92},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"p-4 text-sm text-muted-foreground\">Loading env…</div>","line":119,"column":80,"nodeType":"JSXText","endLine":119,"endColumn":92}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":29,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { lazy, Suspense } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { TestingToolsSection } from '@/components/TestingToolsSection';\nimport { IS_PROD, POC_MODE } from '@/lib/env';\nimport { Database, Wrench, Stethoscope } from 'lucide-react';\nimport { Breadcrumbs } from '@/components/ui/Breadcrumbs';\nimport { useTranslation } from '@/hooks/useTranslation';\n\nconst StorageManager = lazy(() => import('@/components/StorageManager').then(m => ({ default: m.StorageManager })));\nconst ModelDiagnosticsPanel = lazy(() => import('@/components/dev/ModelDiagnosticsPanel').then(m => ({ default: m.ModelDiagnosticsPanel })));\nconst EnvDebug = lazy(() => import('@/components/dev/EnvDebug').then(m => ({ default: m.EnvDebug })));\n\n/**\n * Developer Tools page - centralizes non user-facing utilities\n * Gated to non-production or POC modes via routing in App.tsx\n */\nconst DevTools = (): JSX.Element => {\n  // Extra guard to avoid accidental exposure if route misconfigured\n  if (IS_PROD && !POC_MODE) {\n    return (\n      <div className=\"max-w-4xl mx-auto px-4 py-12\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Developer Tools</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-sm text-muted-foreground\">This section is not available in production.</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const { tCommon } = useTranslation();\n  return (\n    <div className=\"relative z-10 min-h-screen px-4 py-8 sm:px-6 lg:px-8\">\n      <div className=\"max-w-6xl mx-auto space-y-8\">\n        <header className=\"space-y-2\">\n          <Breadcrumbs\n            items={[\n              { label: tCommon('buttons.home'), href: '/' },\n              { label: 'Developer Tools', current: true },\n            ]}\n          />\n          <h1 className=\"text-3xl font-bold tracking-tight flex items-center gap-2\">\n            <Wrench className=\"h-6 w-6 text-primary\" />\n            Developer Tools\n          </h1>\n        </header>\n\n        {/* Reuse existing TestingToolsSection which already includes MockDataLoader */}\n        <TestingToolsSection />\n\n        {/* Storage Management */}\n        <Card className=\"bg-gradient-card border-0 shadow-soft\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Database className=\"h-5 w-5 text-primary\" />\n              Storage Management\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-sm text-muted-foreground mb-4\">\n              Inspect and manage local data storage. Clear old or non-essential data safely.\n            </p>\n            <Dialog>\n              <DialogTrigger asChild>\n                <Button variant=\"outline\" className=\"w-full\">\n                  <Database className=\"h-4 w-4 mr-2\" />\n                  Open Storage Manager\n                </Button>\n              </DialogTrigger>\n              <DialogContent className=\"max-w-3xl max-h-[80vh] overflow-y-auto\">\n                <DialogHeader>\n                  <DialogTitle>Storage Management</DialogTitle>\n                </DialogHeader>\n                <Suspense fallback={<div className=\"p-4 text-sm text-muted-foreground\">Loading…</div>}>\n                  <StorageManager />\n                </Suspense>\n              </DialogContent>\n            </Dialog>\n          </CardContent>\n        </Card>\n\n        {/* Diagnostics Panel (dev-only), lazy loaded */}\n        <Card className=\"bg-gradient-card border-0 shadow-soft\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Stethoscope className=\"h-5 w-5 text-primary\" />\n              Model Diagnostics\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-sm text-muted-foreground mb-4\">\n              Run time-series cross-validation and inspect recent evaluation runs. Loaded on demand to keep main bundle small.\n            </p>\n            <Dialog>\n              <DialogTrigger asChild>\n                <Button variant=\"outline\" className=\"w-full\">\n                  <Stethoscope className=\"h-4 w-4 mr-2\" />\n                  Open Diagnostics Panel\n                </Button>\n              </DialogTrigger>\n              <DialogContent className=\"max-w-5xl max-h-[85vh] overflow-y-auto\">\n                <DialogHeader>\n                  <DialogTitle>Model Diagnostics</DialogTitle>\n                </DialogHeader>\n                <Suspense fallback={<div className=\"p-4 text-sm text-muted-foreground\">Loading diagnostics…</div>}>\n                  <ModelDiagnosticsPanel />\n                </Suspense>\n              </DialogContent>\n            </Dialog>\n          </CardContent>\n        </Card>\n\n        {/* Env / AI Debug */}\n        <Suspense fallback={<div className=\"p-4 text-sm text-muted-foreground\">Loading env…</div>}>\n          <EnvDebug />\n        </Suspense>\n      </div>\n    </div>\n  );\n};\n\nexport default DevTools;\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/EnhancedTrackStudent.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tStudent' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":20,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":20,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Loading student data...\"","line":169,"column":42,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":169,"endColumn":65},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Back to Profile\"","line":189,"column":53,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":191,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => navigate(`/student/${student.id}`)}\n              className=\"font-dyslexia\"\n            >\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Profile\n            </Button>","line":189,"column":53,"nodeType":"JSXText","endLine":191,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Tracking Session:\"","line":193,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":193,"endColumn":67},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h1 className=\"text-xl font-bold\">Tracking Session: {student.name}</h1>","line":193,"column":49,"nodeType":"JSXText","endLine":193,"endColumn":67},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Session duration:\"","line":195,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":196,"endColumn":35},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                <Clock className=\"h-3 w-3\" />\n                Session duration: {sessionDuration} minutes\n              </div>","line":195,"column":46,"nodeType":"JSXText","endLine":196,"endColumn":35},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"minutes\"","line":196,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":197,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                <Clock className=\"h-3 w-3\" />\n                Session duration: {sessionDuration} minutes\n              </div>","line":196,"column":52,"nodeType":"JSXText","endLine":197,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Cancel\"","line":202,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":204,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button variant=\"outline\" onClick={handleCancel}>\n              <X className=\"h-4 w-4 mr-2\" />\n              Cancel\n            </Button>","line":202,"column":45,"nodeType":"JSXText","endLine":204,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Save Session\"","line":209,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":211,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button \n              onClick={handleSaveSession}\n              disabled={sessionEmotions.length === 0 && sessionSensoryInputs.length === 0}\n            >\n              <Save className=\"h-4 w-4 mr-2\" />\n              Save Session\n            </Button>","line":209,"column":48,"nodeType":"JSXText","endLine":211,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Current Session Summary\"","line":221,"column":63,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":223,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n              <CheckCircle className=\"h-5 w-5 text-primary\" />\n              Current Session Summary\n            </CardTitle>","line":221,"column":63,"nodeType":"JSXText","endLine":223,"endColumn":13},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotions Tracked\"","line":229,"column":64,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":229,"endColumn":80},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">Emotions Tracked</div>","line":229,"column":64,"nodeType":"JSXText","endLine":229,"endColumn":80},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory Inputs\"","line":233,"column":64,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":233,"endColumn":78},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">Sensory Inputs</div>","line":233,"column":64,"nodeType":"JSXText","endLine":233,"endColumn":78},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"m\"","line":236,"column":83,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":236,"endColumn":84},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-2xl font-bold text-primary\">{sessionDuration}m</div>","line":236,"column":83,"nodeType":"JSXText","endLine":236,"endColumn":84},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Session Time\"","line":237,"column":64,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":237,"endColumn":76},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">Session Time</div>","line":237,"column":64,"nodeType":"JSXText","endLine":237,"endColumn":76},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Start tracking by adding emotions or sensory inputs below\"","line":241,"column":98,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":243,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"mt-4 p-3 bg-muted/50 rounded-lg text-center text-muted-foreground\">\n                Start tracking by adding emotions or sensory inputs below\n              </div>","line":241,"column":98,"nodeType":"JSXText","endLine":243,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Session Data Review\"","line":261,"column":26,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":261,"endColumn":45},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle>Session Data Review</CardTitle>","line":261,"column":26,"nodeType":"JSXText","endLine":261,"endColumn":45},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Emotions This Session\"","line":267,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":267,"endColumn":73},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-medium mb-2\">Emotions This Session</h4>","line":267,"column":52,"nodeType":"JSXText","endLine":267,"endColumn":73},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Intensity:\"","line":273,"column":74,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":274,"endColumn":40},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">\n                            Intensity: {emotion.intensity}/5\n                          </div>","line":273,"column":74,"nodeType":"JSXText","endLine":274,"endColumn":40},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"/5\"","line":274,"column":59,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":275,"endColumn":27},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Context:\"","line":277,"column":76,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":278,"endColumn":40},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">\n                              Context: {emotion.context}\n                            </div>","line":277,"column":76,"nodeType":"JSXText","endLine":278,"endColumn":40},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sensory Inputs This Session\"","line":301,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":301,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h4 className=\"font-medium mb-2\">Sensory Inputs This Session</h4>","line":301,"column":52,"nodeType":"JSXText","endLine":301,"endColumn":79},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Context:\"","line":311,"column":76,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":312,"endColumn":40},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-sm text-muted-foreground\">\n                              Context: {sensory.context}\n                            </div>","line":311,"column":76,"nodeType":"JSXText","endLine":312,"endColumn":40},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Session Notes\"","line":338,"column":24,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":338,"endColumn":37},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle>Session Notes</CardTitle>","line":338,"column":24,"nodeType":"JSXText","endLine":338,"endColumn":37},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"General observations or notes\"","line":342,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":342,"endColumn":75},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Label htmlFor=\"general-notes\">General observations or notes</Label>","line":342,"column":46,"nodeType":"JSXText","endLine":342,"endColumn":75}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":43,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { SmartDataEntry } from \"@/components/SmartDataEntry\";\nimport { Student, TrackingEntry, EmotionEntry, SensoryEntry } from \"@/types/student\";\nimport { dataStorage } from \"@/lib/dataStorage\";\nimport { ArrowLeft, Save, X, Clock, CheckCircle } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { useTranslation } from \"@/hooks/useTranslation\";\nimport { analyticsManager } from \"@/lib/analyticsManager\";\nimport { format } from \"date-fns\";\nimport { logger } from \"@/lib/logger\";\n\nconst EnhancedTrackStudent = () => {\n  const { studentId } = useParams();\n  const navigate = useNavigate();\n  const { tStudent, tCommon } = useTranslation();\n  const [student, setStudent] = useState<Student | null>(null);\n  const [sessionEmotions, setSessionEmotions] = useState<EmotionEntry[]>([]);\n  const [sessionSensoryInputs, setSessionSensoryInputs] = useState<SensoryEntry[]>([]);\n  const [generalNotes, setGeneralNotes] = useState(\"\");\n  const [sessionStartTime] = useState(new Date());\n  const [recentData, setRecentData] = useState<{\n    emotions: EmotionEntry[];\n    sensoryInputs: SensoryEntry[];\n  }>({ emotions: [], sensoryInputs: [] });\n\n  useEffect(() => {\n    if (!studentId) return;\n\n    // Load student data\n    const storedStudents = localStorage.getItem('sensoryTracker_students');\n    if (storedStudents) {\n      const students = JSON.parse(storedStudents);\n      const foundStudent = students.find((s: Student) => s.id === studentId);\n      if (foundStudent) {\n        setStudent({\n          ...foundStudent,\n          createdAt: new Date(foundStudent.createdAt)\n        });\n      } else {\n        toast.error('Student not found');\n        navigate('/');\n        return;\n      }\n    }\n\n    // Load recent data for smart suggestions\n    const storedEntries = localStorage.getItem('sensoryTracker_entries');\n    if (storedEntries) {\n      const entries: TrackingEntry[] = JSON.parse(storedEntries);\n      const studentEntries = entries\n        .filter(entry => entry.studentId === studentId)\n        .map(entry => ({\n          ...entry,\n          timestamp: new Date(entry.timestamp),\n          emotions: entry.emotions.map(e => ({\n            ...e,\n            timestamp: new Date(e.timestamp)\n          })),\n          sensoryInputs: entry.sensoryInputs.map(s => ({\n            ...s,\n            timestamp: new Date(s.timestamp)\n          }))\n        }))\n        .sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime())\n        .slice(0, 10); // Get last 10 sessions\n\n      // Flatten recent emotions and sensory inputs\n      const recentEmotions = studentEntries.flatMap(entry => entry.emotions);\n      const recentSensoryInputs = studentEntries.flatMap(entry => entry.sensoryInputs);\n      \n      setRecentData({\n        emotions: recentEmotions,\n        sensoryInputs: recentSensoryInputs\n      });\n    }\n  }, [studentId, navigate]);\n\n  const handleEmotionAdd = (emotion: Omit<EmotionEntry, 'id' | 'timestamp'>) => {\n    const newEmotion: EmotionEntry = {\n      id: crypto.randomUUID(),\n      timestamp: new Date(),\n      ...emotion\n    };\n    setSessionEmotions(prev => [...prev, newEmotion]);\n    toast.success(`Added ${emotion.emotion} (intensity ${emotion.intensity})`);\n  };\n\n  const handleSensoryAdd = (sensory: Omit<SensoryEntry, 'id' | 'timestamp'>) => {\n    const newSensory: SensoryEntry = {\n      id: crypto.randomUUID(),\n      timestamp: new Date(),\n      ...sensory\n    };\n    setSessionSensoryInputs(prev => [...prev, newSensory]);\n    toast.success(`Added ${sensory.type}: ${sensory.response}`);\n  };\n\n  const handleSaveSession = async () => {\n    if (!student) return;\n\n    if (sessionEmotions.length === 0 && sessionSensoryInputs.length === 0) {\n      toast.error(\"Please add at least one emotion or sensory input before saving.\");\n      return;\n    }\n\n    try {\n      const sessionData: TrackingEntry = {\n        id: crypto.randomUUID(),\n        studentId: student.id,\n        timestamp: sessionStartTime,\n        emotions: sessionEmotions,\n        sensoryInputs: sessionSensoryInputs,\n        environmentalData: {\n          location: '',\n          roomConditions: {\n            noiseLevel: 0,\n            lighting: '',\n            temperature: 0\n          },\n          socialContext: ''\n        },\n        notes: generalNotes\n      };\n\n      dataStorage.saveTrackingEntry(sessionData);\n\n      // Trigger analytics update only if there's data\n      if (sessionEmotions.length > 0 || sessionSensoryInputs.length > 0) {\n        analyticsManager.initializeStudentAnalytics(student.id);\n        await analyticsManager.triggerAnalyticsForStudent(student);\n      }\n\n      toast.success(\"Session saved successfully!\");\n      navigate(`/student/${student.id}`);\n    } catch (error) {\n      logger.error('Save session error', { error });\n      toast.error(\"Failed to save session. Please try again.\");\n    }\n  };\n\n  const handleCancel = () => {\n    if (sessionEmotions.length > 0 || sessionSensoryInputs.length > 0) {\n      if (confirm(\"You have unsaved data. Are you sure you want to cancel?\")) {\n        navigate(`/student/${student.id}`);\n      }\n    } else {\n      navigate(`/student/${student.id}`);\n    }\n  };\n\n  const removeEmotion = (id: string) => {\n    setSessionEmotions(prev => prev.filter(e => e.id !== id));\n  };\n\n  const removeSensory = (id: string) => {\n    setSessionSensoryInputs(prev => prev.filter(s => s.id !== id));\n  };\n\n  if (!student) {\n    return (\n      <div className=\"min-h-screen bg-background font-dyslexia flex items-center justify-center\">\n        <div className=\"text-center\">\n          <h1 className=\"text-2xl font-bold mb-4\">{String(tCommon('status.loading'))}</h1>\n          <div className=\"animate-pulse\">Loading student data...</div>\n        </div>\n      </div>\n    );\n  }\n\n  const sessionDuration = Math.round((new Date().getTime() - sessionStartTime.getTime()) / 1000 / 60);\n\n  return (\n    <div className=\"min-h-screen bg-background font-dyslexia\">\n      {/* Header */}\n      <header className=\"border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\n        <div className=\"flex h-16 items-center justify-between px-6\">\n          <div className=\"flex items-center gap-3\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => navigate(`/student/${student.id}`)}\n              className=\"font-dyslexia\"\n            >\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Profile\n            </Button>\n            <div>\n              <h1 className=\"text-xl font-bold\">Tracking Session: {student.name}</h1>\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                <Clock className=\"h-3 w-3\" />\n                Session duration: {sessionDuration} minutes\n              </div>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button variant=\"outline\" onClick={handleCancel}>\n              <X className=\"h-4 w-4 mr-2\" />\n              Cancel\n            </Button>\n            <Button \n              onClick={handleSaveSession}\n              disabled={sessionEmotions.length === 0 && sessionSensoryInputs.length === 0}\n            >\n              <Save className=\"h-4 w-4 mr-2\" />\n              Save Session\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      <div className=\"p-6 max-w-6xl mx-auto space-y-6\">\n        {/* Session Summary */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <CheckCircle className=\"h-5 w-5 text-primary\" />\n              Current Session Summary\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <div className=\"text-center\">\n                <div className=\"text-2xl font-bold text-primary\">{sessionEmotions.length}</div>\n                <div className=\"text-sm text-muted-foreground\">Emotions Tracked</div>\n              </div>\n              <div className=\"text-center\">\n                <div className=\"text-2xl font-bold text-primary\">{sessionSensoryInputs.length}</div>\n                <div className=\"text-sm text-muted-foreground\">Sensory Inputs</div>\n              </div>\n              <div className=\"text-center\">\n                <div className=\"text-2xl font-bold text-primary\">{sessionDuration}m</div>\n                <div className=\"text-sm text-muted-foreground\">Session Time</div>\n              </div>\n            </div>\n            {sessionEmotions.length === 0 && sessionSensoryInputs.length === 0 && (\n              <div className=\"mt-4 p-3 bg-muted/50 rounded-lg text-center text-muted-foreground\">\n                Start tracking by adding emotions or sensory inputs below\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Smart Data Entry */}\n        <SmartDataEntry\n          student={student}\n          recentEmotions={recentData.emotions}\n          recentSensoryInputs={recentData.sensoryInputs}\n          onEmotionAdd={handleEmotionAdd}\n          onSensoryAdd={handleSensoryAdd}\n        />\n\n        {/* Session Data Review */}\n        {(sessionEmotions.length > 0 || sessionSensoryInputs.length > 0) && (\n          <Card>\n            <CardHeader>\n              <CardTitle>Session Data Review</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {/* Current Session Emotions */}\n              {sessionEmotions.length > 0 && (\n                <div>\n                  <h4 className=\"font-medium mb-2\">Emotions This Session</h4>\n                  <div className=\"space-y-2\">\n                    {sessionEmotions.map((emotion) => (\n                      <div key={emotion.id} className=\"flex items-center justify-between p-3 bg-muted/50 rounded-lg\">\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"font-medium\">{emotion.emotion}</div>\n                          <div className=\"text-sm text-muted-foreground\">\n                            Intensity: {emotion.intensity}/5\n                          </div>\n                          {emotion.context && (\n                            <div className=\"text-sm text-muted-foreground\">\n                              Context: {emotion.context}\n                            </div>\n                          )}\n                          <div className=\"text-xs text-muted-foreground\">\n                            {format(emotion.timestamp, 'HH:mm')}\n                          </div>\n                        </div>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => removeEmotion(emotion.id)}\n                        >\n                          <X className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Current Session Sensory Inputs */}\n              {sessionSensoryInputs.length > 0 && (\n                <div>\n                  <h4 className=\"font-medium mb-2\">Sensory Inputs This Session</h4>\n                  <div className=\"space-y-2\">\n                    {sessionSensoryInputs.map((sensory) => (\n                      <div key={sensory.id} className=\"flex items-center justify-between p-3 bg-muted/50 rounded-lg\">\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"font-medium\">{sensory.type}</div>\n                          <div className=\"text-sm text-muted-foreground\">\n                            {sensory.input} - {sensory.response}\n                          </div>\n                          {sensory.context && (\n                            <div className=\"text-sm text-muted-foreground\">\n                              Context: {sensory.context}\n                            </div>\n                          )}\n                          <div className=\"text-xs text-muted-foreground\">\n                            {format(sensory.timestamp, 'HH:mm')}\n                          </div>\n                        </div>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => removeSensory(sensory.id)}\n                        >\n                          <X className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        )}\n\n        {/* General Notes */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Session Notes</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"general-notes\">General observations or notes</Label>\n              <Textarea\n                id=\"general-notes\"\n                value={generalNotes}\n                onChange={(e) => setGeneralNotes(e.target.value)}\n                placeholder=\"Add any additional observations, environmental factors, or context about this session...\"\n                rows={4}\n              />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n};\n\nexport { EnhancedTrackStudent };\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/EnvironmentalCorrelationsTest.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/InteractiveVizTest.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":6,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":9,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[434,437],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[434,437],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":6,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":9,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[597,600],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[597,600],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":17,"column":6,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":9,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[749,752],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[749,752],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\nimport { InteractiveDataVisualization } from '@/components/InteractiveDataVisualization';\nimport { ErrorBoundary } from '@/components/ErrorBoundary';\n\nconst now = new Date();\nconst emotions = [\n  { id: '1', emotion: 'happy', intensity: 4, timestamp: now, triggers: [], notes: '' },\n  { id: '2', emotion: 'calm', intensity: 3, timestamp: new Date(now.getTime() + 60*60*1000), triggers: [], notes: '' },\n] as any[];\n\nconst sensoryInputs = [\n  { id: '1', type: 'visual', response: 'seeking', intensity: 3, timestamp: new Date(now.getTime() + 30*60*1000), notes: '' },\n] as any[];\n\nconst trackingEntries = [\n  { id: '1', timestamp: now, emotions: ['happy'], sensoryInputs: ['visual'], environmentalData: {}, notes: '' },\n] as any[];\n\nexport default function InteractiveVizTest() {\n  return (\n    <ErrorBoundary>\n      <div className=\"p-6\">\n        <InteractiveDataVisualization\n          emotions={emotions}\n          sensoryInputs={sensoryInputs}\n          trackingEntries={trackingEntries}\n          studentName=\"Test Student\"\n        />\n      </div>\n    </ErrorBoundary>\n  );\n}\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/KreativiumAI.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5406,5409],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5406,5409],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":123,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6119,6122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6119,6122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":125,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6178,6181],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6178,6181],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'studentId'. Either include it or remove the dependency array.","line":141,"column":6,"nodeType":"ArrayExpression","endLine":141,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [studentId]","fix":{"range":[6607,6609],"text":"[studentId]"}}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":164,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":164,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[7825,7825],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":176,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":176,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[8377,8377],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'timeframe'. Either include it or remove the dependency array.","line":177,"column":6,"nodeType":"ArrayExpression","endLine":177,"endColumn":74,"suggestions":[{"desc":"Update the dependencies array to be: [toolbarLast, studentId, timeframe.start, timeframe.end, students, timeframe]","fix":{"range":[8384,8452],"text":"[toolbarLast, studentId, timeframe.start, timeframe.end, students, timeframe]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":183,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8727,8730],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8727,8730],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":184,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8811,8814],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8811,8814],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":201,"column":125,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":201,"endColumn":128,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9533,9536],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9533,9536],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":238,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10740,10743],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10740,10743],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":246,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":246,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11079,11082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11079,11082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":248,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":248,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11185,11188],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11185,11188],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":254,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11480,11483],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11480,11483],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":284,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":284,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12472,12475],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12472,12475],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":292,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":292,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12787,12790],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12787,12790],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":294,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":294,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12893,12896],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12893,12896],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":300,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":300,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13161,13164],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13161,13164],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":355,"column":97,"nodeType":"BlockStatement","messageId":"unexpected","endLine":355,"endColumn":99,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[15080,15080],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":357,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":357,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[15151,15151],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":369,"column":98,"nodeType":"BlockStatement","messageId":"unexpected","endLine":369,"endColumn":100,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[15890,15890],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":371,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":371,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[15960,15960],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":378,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":378,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16116,16119],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16116,16119],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":379,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":379,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16158,16161],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16158,16161],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":383,"column":92,"nodeType":"BlockStatement","messageId":"unexpected","endLine":383,"endColumn":94,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[16378,16378],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":385,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":385,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[16450,16450],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":395,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":395,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16814,16817],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16814,16817],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":397,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":397,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16972,16975],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16972,16975],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":399,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":399,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[17022,17022],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"År:\"","line":432,"column":77,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":432,"endColumn":81},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground mt-1\">År: {source.year}</p>","line":432,"column":77,"nodeType":"JSXText","endLine":432,"endColumn":81},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Kreativium‑AI\"","line":464,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":464,"endColumn":65},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h1 className=\"text-2xl font-bold\">Kreativium‑AI</h1>","line":464,"column":52,"nodeType":"JSXText","endLine":464,"endColumn":65},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Lokal LLM for mønstre, korrelasjoner og tiltak\"","line":465,"column":60,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":465,"endColumn":106},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground\">Lokal LLM for mønstre, korrelasjoner og tiltak</p>","line":465,"column":60,"nodeType":"JSXText","endLine":465,"endColumn":106},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Modell:\"","line":466,"column":67,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":466,"endColumn":75},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs text-muted-foreground mt-0.5\">Modell: <code>{displayModelName}</code> {fromUiCache && (<span className=\"ml-2 inline-flex items-center gap-1 text-[11px] rounded px-1.5 py-0.5 border border-muted-foreground/30\">• {tAnalytics('interface.fromUiCache')}</span>)}</p>","line":466,"column":67,"nodeType":"JSXText","endLine":466,"endColumn":75},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":470,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":470,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20234,20237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20234,20237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Elev\"","line":482,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":484,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label\n                id={studentSelectLabelId}\n                className=\"block text-sm text-muted-foreground mb-1\"\n                htmlFor={studentSelectTriggerId}\n              >\n                Elev\n              </label>","line":482,"column":16,"nodeType":"JSXText","endLine":484,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Tidsrom\"","line":505,"column":16,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":507,"endColumn":15},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label\n                id={presetSelectLabelId}\n                className=\"block text-sm text-muted-foreground mb-1\"\n                htmlFor={presetSelectTriggerId}\n              >\n                Tidsrom\n              </label>","line":505,"column":16,"nodeType":"JSXText","endLine":507,"endColumn":15},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Siste 7 dager\"","line":517,"column":42,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":517,"endColumn":55},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"7d\">Siste 7 dager</SelectItem>","line":517,"column":42,"nodeType":"JSXText","endLine":517,"endColumn":55},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Siste 30 dager\"","line":518,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":518,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"30d\">Siste 30 dager</SelectItem>","line":518,"column":43,"nodeType":"JSXText","endLine":518,"endColumn":57},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Siste 90 dager\"","line":519,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":519,"endColumn":57},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"90d\">Siste 90 dager</SelectItem>","line":519,"column":43,"nodeType":"JSXText","endLine":519,"endColumn":57},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Hele historikken\"","line":520,"column":43,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":520,"endColumn":59},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <SelectItem value=\"all\">Hele historikken</SelectItem>","line":520,"column":43,"nodeType":"JSXText","endLine":520,"endColumn":59},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":543,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":543,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23351,23354],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23351,23354],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"IEP-trygg modus\"","line":556,"column":88,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":558,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <label className=\"text-sm text-muted-foreground\" htmlFor={iepToggleId}>\n                  IEP-trygg modus\n                </label>","line":556,"column":88,"nodeType":"JSXText","endLine":558,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"IEP-trygg modus sikrer pedagogiske anbefalinger\"","line":577,"column":26,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":577,"endColumn":73},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p>IEP-trygg modus sikrer pedagogiske anbefalinger</p>","line":577,"column":26,"nodeType":"JSXText","endLine":577,"endColumn":73},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"uten medisinske/kliniske råd\"","line":578,"column":46,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":578,"endColumn":74},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-xs\">uten medisinske/kliniske råd</p>","line":578,"column":46,"nodeType":"JSXText","endLine":578,"endColumn":74},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Test AI\"","line":585,"column":57,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":586,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button variant=\"outline\" onClick={testAI} disabled={isTesting} className=\"w-1/2\">\n                  <RefreshCw className=\"h-4 w-4 mr-2\" />Test AI\n                </Button>","line":585,"column":57,"nodeType":"JSXText","endLine":586,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Kjør analyse\"","line":588,"column":52,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":589,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button onClick={analyze} disabled={isAnalyzing || !studentId} className=\"w-1/2\">\n                  <Play className=\"h-4 w-4 mr-2\" />Kjør analyse\n                </Button>","line":588,"column":52,"nodeType":"JSXText","endLine":589,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Oppdater (forbi cache)\"","line":591,"column":57,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":592,"endColumn":17},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button onClick={refreshAnalyze} variant=\"secondary\" disabled={isAnalyzing || !studentId} className=\"w-full sm:w-auto\">\n                  <RefreshCw className=\"h-4 w-4 mr-2\" />Oppdater (forbi cache)\n                </Button>","line":591,"column":57,"nodeType":"JSXText","endLine":592,"endColumn":17},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sammenligning...\"","line":595,"column":65,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":596,"endColumn":19},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Datakvalitet\"","line":607,"column":94,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":607,"endColumn":106},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\"><Database className=\"h-4 w-4\" />Datakvalitet</CardTitle>","line":607,"column":94,"nodeType":"JSXText","endLine":607,"endColumn":106},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Datapunkter\"","line":613,"column":68,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":613,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-muted-foreground\">Datapunkter</div>","line":613,"column":68,"nodeType":"JSXText","endLine":613,"endColumn":79},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Sist registrert\"","line":617,"column":68,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":617,"endColumn":83},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-muted-foreground\">Sist registrert</div>","line":617,"column":68,"nodeType":"JSXText","endLine":617,"endColumn":83},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Dager siden\"","line":621,"column":68,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":621,"endColumn":79},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-muted-foreground\">Dager siden</div>","line":621,"column":68,"nodeType":"JSXText","endLine":621,"endColumn":79},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Fullstendighet\"","line":625,"column":68,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":625,"endColumn":82},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-muted-foreground\">Fullstendighet</div>","line":625,"column":68,"nodeType":"JSXText","endLine":625,"endColumn":82},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Balanse (tid på dagen)\"","line":629,"column":73,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":629,"endColumn":95},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-muted-foreground mb-1\">Balanse (tid på dagen)</div>","line":629,"column":73,"nodeType":"JSXText","endLine":629,"endColumn":95},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":634,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":634,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28276,28279],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28276,28279],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"score:\"","line":638,"column":83,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":638,"endColumn":90},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"ml-auto text-[11px] text-muted-foreground\">score: {dataQuality.balance}%</span>","line":638,"column":83,"nodeType":"JSXText","endLine":638,"endColumn":90},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Ingen data funnet for valgt periode.\"","line":643,"column":117,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":643,"endColumn":153},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"flex items-center gap-2 text-muted-foreground\"><AlertTriangle className=\"h-4 w-4\" />Ingen data funnet for valgt periode.</div>","line":643,"column":117,"nodeType":"JSXText","endLine":643,"endColumn":153},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":711,"column":114,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":711,"endColumn":117,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32108,32111],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32108,32111],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Nøkkelfunn\"","line":722,"column":96,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":722,"endColumn":106},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\"><Database className=\"h-4 w-4\" />Nøkkelfunn</CardTitle>","line":722,"column":96,"nodeType":"JSXText","endLine":722,"endColumn":106},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":725,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":725,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32882,32885],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32882,32885],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":727,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":727,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33022,33025],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33022,33025],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":727,"column":90,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":727,"endColumn":91},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Ingen nøkkelfunn rapportert.\"","line":729,"column":66,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":729,"endColumn":94},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground\">Ingen nøkkelfunn rapportert.</p>","line":729,"column":66,"nodeType":"JSXText","endLine":729,"endColumn":94},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Mønstre\"","line":735,"column":93,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":735,"endColumn":100},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\"><Clock className=\"h-4 w-4\" />Mønstre</CardTitle>","line":735,"column":93,"nodeType":"JSXText","endLine":735,"endColumn":100},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":739,"column":29,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":739,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":742,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":742,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33838,33841],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33838,33841],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":743,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":743,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[33931,33934],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[33931,33934],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Ingen mønstre identifisert.\"","line":748,"column":67,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":748,"endColumn":94},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground\">Ingen mønstre identifisert.</p>","line":748,"column":67,"nodeType":"JSXText","endLine":748,"endColumn":94},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Tiltak og anbefalinger\"","line":754,"column":96,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":754,"endColumn":118},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\"><Sparkles className=\"h-4 w-4\" />Tiltak og anbefalinger</CardTitle>","line":754,"column":96,"nodeType":"JSXText","endLine":754,"endColumn":118},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":758,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":758,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34603,34606],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34603,34606],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":760,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":760,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34722,34725],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34722,34725],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":760,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":760,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34758,34761],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34758,34761],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":761,"column":32,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":761,"endColumn":33},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":766,"column":79,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":766,"endColumn":80},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Källor:\"","line":771,"column":82,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":771,"endColumn":89},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <span className=\"text-xs text-muted-foreground mr-2\">Källor:</span>","line":771,"column":82,"nodeType":"JSXText","endLine":771,"endColumn":89},{"ruleId":"react/no-array-index-key","severity":1,"message":"Do not use Array index in keys","line":774,"column":50,"nodeType":"Identifier","messageId":"noArrayIndex","endLine":774,"endColumn":53},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Ingen anbefalinger rapportert.\"","line":789,"column":66,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":789,"endColumn":96},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-sm text-muted-foreground\">Ingen anbefalinger rapportert.</p>","line":789,"column":66,"nodeType":"JSXText","endLine":789,"endColumn":96},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"AI‑metadata •\"","line":798,"column":49,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":798,"endColumn":63},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <CardTitle className=\"flex items-center gap-2\">\n                    <Info className=\"h-4 w-4\" />AI‑metadata • <span className=\"font-normal text-muted-foreground\">{displayModelName}</span>\n                    {(((results.ai.usage as any)?.cacheReadTokens ?? 0) > 0 || (Array.isArray(results.ai.caveats) && results.ai.caveats.some(c => /cache/i.test(String(c))))) && (\n                      <Badge variant=\"outline\">{tAnalytics('interface.fromCache')}</Badge>\n                    )}\n                  </CardTitle>","line":798,"column":49,"nodeType":"JSXText","endLine":798,"endColumn":63},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":799,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":799,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36963,36966],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36963,36966],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Modell:\"","line":805,"column":24,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":805,"endColumn":32},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Modell: {results.ai.model}</div>","line":805,"column":24,"nodeType":"JSXText","endLine":805,"endColumn":32},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Latens:\"","line":806,"column":57,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":806,"endColumn":65},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Latens: {Math.round(results.ai.latencyMs)} ms</div>","line":806,"column":57,"nodeType":"JSXText","endLine":806,"endColumn":65},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Latens: {Math.round(results.ai.latencyMs)} ms</div>","line":806,"column":99,"nodeType":"JSXText","endLine":806,"endColumn":102},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Tokens: prompt\"","line":808,"column":26,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":808,"endColumn":41},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Tokens: prompt {results.ai.usage.promptTokens ?? 0} • completion {results.ai.usage.completionTokens ?? 0} • total {results.ai.usage.totalTokens ?? 0}</div>","line":808,"column":26,"nodeType":"JSXText","endLine":808,"endColumn":41},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• completion\"","line":808,"column":77,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":808,"endColumn":91},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Tokens: prompt {results.ai.usage.promptTokens ?? 0} • completion {results.ai.usage.completionTokens ?? 0} • total {results.ai.usage.totalTokens ?? 0}</div>","line":808,"column":77,"nodeType":"JSXText","endLine":808,"endColumn":91},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• total\"","line":808,"column":131,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":808,"endColumn":140},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Tokens: prompt {results.ai.usage.promptTokens ?? 0} • completion {results.ai.usage.completionTokens ?? 0} • total {results.ai.usage.totalTokens ?? 0}</div>","line":808,"column":131,"nodeType":"JSXText","endLine":808,"endColumn":140},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":810,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":810,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37825,37828],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37825,37828],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":810,"column":119,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":810,"endColumn":122,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37881,37884],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37881,37884],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Cache: read\"","line":811,"column":26,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":811,"endColumn":38},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Cache: read {(results.ai.usage as any).cacheReadTokens ?? 0} • write {(results.ai.usage as any).cacheWriteTokens ?? 0}</div>","line":811,"column":26,"nodeType":"JSXText","endLine":811,"endColumn":38},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":811,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":811,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37978,37981],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37978,37981],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"• write\"","line":811,"column":86,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":811,"endColumn":95},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Cache: read {(results.ai.usage as any).cacheReadTokens ?? 0} • write {(results.ai.usage as any).cacheWriteTokens ?? 0}</div>","line":811,"column":86,"nodeType":"JSXText","endLine":811,"endColumn":95},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":811,"column":117,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":811,"endColumn":120,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38035,38038],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38035,38038],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"JSON‑gyldighet (global):\"","line":813,"column":131,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":813,"endColumn":156},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>JSON‑gyldighet (global): {pct}%</div>","line":813,"column":131,"nodeType":"JSXText","endLine":813,"endColumn":156},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Forbehold:\"","line":815,"column":26,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":815,"endColumn":37},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div>Forbehold: {results.ai.caveats.join('; ')}</div>","line":815,"column":26,"nodeType":"JSXText","endLine":815,"endColumn":37}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'students' and 'timeframe'. Either include them or remove the dependency array.","line":166,"column":6,"nodeType":"ArrayExpression","endLine":166,"endColumn":51,"suggestions":[{"desc":"Update the dependencies array to be: [studentId, timeframe.start, timeframe.end, students, timeframe]","fix":{"range":[7892,7937],"text":"[studentId, timeframe.start, timeframe.end, students, timeframe]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":134,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useMemo, useRef, useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Skeleton } from '@/components/ui/skeleton';\nimport { Sparkles, Play, RefreshCw, Database, Clock, Info, AlertTriangle, Loader2, Download, Share2, Clipboard as ClipboardIcon } from 'lucide-react';\nimport { dataStorage } from '@/lib/dataStorage';\nimport type { Student } from '@/types/student';\nimport { LLMAnalysisEngine } from '@/lib/analysis/llmAnalysisEngine';\nimport type { AnalyticsResultsAI } from '@/lib/analysis/analysisEngine';\nimport { loadAiConfig } from '@/lib/aiConfig';\nimport { openRouterClient } from '@/lib/ai/openrouterClient';\nimport { logger } from '@/lib/logger';\nimport { Toggle } from '@/components/ui/toggle';\nimport { computeComparisonRange, formatComparisonPeriodLabel } from '@/lib/analysis/dateHelpers';\nimport { ComparisonSummary } from '@/components/ComparisonSummary';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { formatAiReportText, downloadPdfFromText } from '@/lib/ai/exportAiReport';\nimport { aiMetrics } from '@/lib/ai/metrics';\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';\nimport { announceToScreenReader } from '@/utils/accessibility';\nimport { resolveSources } from '@/lib/evidence';\n\ntype Preset = 'all' | '7d' | '30d' | '90d';\n\nfunction computeRange(preset: Preset) {\n  if (preset === 'all') return undefined;\n  const now = new Date();\n  const start = new Date(now);\n  const days = preset === '7d' ? 7 : preset === '30d' ? 30 : 90;\n  start.setDate(now.getDate() - days);\n  return { start, end: now, timezone: Intl.DateTimeFormat().resolvedOptions().timeZone } as const;\n}\n\nfunction computeDataQualityMetrics(studentId: string, timeframe?: ReturnType<typeof computeRange>) {\n  try {\n    if (!studentId) return null;\n    const entriesAll = dataStorage.getEntriesForStudent(studentId) || [];\n    const { start, end } = timeframe || {};\n    const inRange = (start || end)\n      ? entriesAll.filter(e => {\n          const t = e.timestamp.getTime();\n          const s = start ? (start as Date).getTime() : -Infinity;\n          const en = end ? (end as Date).getTime() : Infinity;\n          return t >= s && t <= en;\n        })\n      : entriesAll;\n    const total = inRange.length;\n    const last = inRange[0]?.timestamp || null;\n    const daysSince = last ? Math.max(0, Math.round((Date.now() - last.getTime()) / (1000 * 60 * 60 * 24))) : null;\n    const completeCount = inRange.filter(e => (e.emotions?.length || 0) > 0 && (e.sensoryInputs?.length || 0) > 0).length;\n    const completeness = total > 0 ? Math.round((completeCount / total) * 100) : 0;\n    const buckets = { morning: 0, afternoon: 0, evening: 0 } as Record<'morning'|'afternoon'|'evening', number>;\n    let totalIntensity = 0;\n    let intensityCount = 0;\n    for (const e of inRange) {\n      const h = e.timestamp.getHours();\n      if (h < 12) buckets.morning++;\n      else if (h < 16) buckets.afternoon++;\n      else buckets.evening++;\n      \n      // Calculate average intensity from emotions\n      if (e.emotions?.length) {\n        for (const emotion of e.emotions) {\n          if (typeof emotion.intensity === 'number') {\n            totalIntensity += emotion.intensity;\n            intensityCount++;\n          }\n        }\n      }\n    }\n    const counts = Object.values(buckets);\n    const max = counts.length ? Math.max(...counts) : 0;\n    const min = counts.length ? Math.min(...counts) : 0;\n    const balance = max > 0 ? Math.round((min / max) * 100) : 0;\n    const avgIntensity = intensityCount > 0 ? totalIntensity / intensityCount : null;\n    return { total, last, daysSince, completeness, balance, buckets, avgIntensity };\n  } catch {\n    return null;\n  }\n}\n\nexport default function KreativiumAI(): JSX.Element {\n  const { tAnalytics } = useTranslation();\n  const [students, setStudents] = useState<Student[]>([]);\n  const [studentId, setStudentId] = useState<string>('');\n  const [preset, setPreset] = useState<Preset>('30d');\n  const [isTesting, setIsTesting] = useState(false);\n  const [isAnalyzing, setIsAnalyzing] = useState(false);\n  const [isAnalyzingBaseline, setIsAnalyzingBaseline] = useState(false);\n  const [error, setError] = useState<string>('');\n  const [results, setResults] = useState<AnalyticsResultsAI | null>(null);\n  const [baselineResults, setBaselineResults] = useState<AnalyticsResultsAI | null>(null);\n  // const [lastModelUsed, setLastModelUsed] = useState<string>('');\n  const [fromUiCache, setFromUiCache] = useState<boolean>(false);\n  const resultsCacheRef = useRef<Map<string, { current: AnalyticsResultsAI, baseline: AnalyticsResultsAI | null }>>(new Map());\n  const [compareEnabled, setCompareEnabled] = useState<boolean>(false);\n  const [compareMode, setCompareMode] = useState<'previous' | 'lastMonth' | 'lastYear'>('previous');\n  const [toolbarLast, setToolbarLast] = useState<{ type: 'copy' | 'pdf' | 'share' | null; at: number | null }>({ type: null, at: null });\n  const [iepSafeMode, setIepSafeMode] = useState<boolean>(true);  // Default ON for safety\n  const [resolvedSources, setResolvedSources] = useState<Map<string, any>>(new Map());\n\n  // Clear cache when IEP mode changes\n  useEffect(() => {\n    setResults(null);\n    setBaselineResults(null);\n    resultsCacheRef.current.clear();\n  }, [iepSafeMode]);\n\n  const ai = loadAiConfig();\n  const isLocal = (() => {\n    const url = ai.baseUrl || '';\n    const quick = url.includes('localhost') || url.includes('127.0.0.1');\n    if (quick) return true;\n    try {\n      const u = new URL(url);\n      const h = (u.hostname || '').toLowerCase();\n      if (h === 'localhost' || h === '127.0.0.1') return true;\n      if (/^10\\./.test(h)) return true;\n      if (/^192\\.168\\./.test(h)) return true;\n      if (/^172\\.(1[6-9]|2[0-9]|3[0-1])\\./.test(h)) return true;\n      return Boolean((ai as any).localOnly);\n    } catch {\n      return Boolean((ai as any).localOnly) || quick;\n    }\n  })();\n\n  // Cosmetic model label: always show \"Kreativium-AI\" as requested\n  const displayModelName = 'Kreativium-AI';\n\n  useEffect(() => {\n    try {\n      const s = dataStorage.getStudents();\n      setStudents(s);\n      if (s.length && !studentId) setStudentId(s[0].id);\n    } catch (e) {\n      logger.error('[KreativiumAI] load students failed', e as Error);\n      setStudents([]);\n    }\n  }, []);\n\n  const timeframe = useMemo(() => computeRange(preset), [preset]);\n\n  const cacheKey = useMemo(() => {\n    const t = timeframe ? `${(timeframe.start as Date)?.toISOString?.() || String(timeframe.start)}_${(timeframe.end as Date)?.toISOString?.() || String(timeframe.end)}` : 'all';\n    const cmp = compareEnabled && timeframe ? `|cmp:${compareMode}` : '';\n    return `${studentId || 'none'}|${preset}|${t}${cmp}|iep:${iepSafeMode ? 'on' : 'off'}`;\n  }, [studentId, preset, timeframe, compareEnabled, compareMode, iepSafeMode]);\n\n  // Persist toolbar last action per student+range in session\n  useEffect(() => {\n    try {\n      const key = (() => {\n        const s = (students.find(st => st.id === studentId)?.name || 'elev').toLowerCase();\n        const r = timeframe ? `${(timeframe.start as Date).toLocaleDateString()}_${(timeframe.end as Date).toLocaleDateString()}`.toLowerCase() : 'alle';\n        return `ai_toolbar_last_${s}_${r}`;\n      })();\n      const raw = sessionStorage.getItem(key);\n      if (raw) {\n        const saved = JSON.parse(raw) as { type: 'copy' | 'pdf' | 'share' | null; at: number | null };\n        if (saved && typeof saved.at === 'number') setToolbarLast(saved);\n      }\n    } catch {}\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [studentId, timeframe?.start, timeframe?.end]);\n\n  useEffect(() => {\n    try {\n      const key = (() => {\n        const s = (students.find(st => st.id === studentId)?.name || 'elev').toLowerCase();\n        const r = timeframe ? `${(timeframe.start as Date).toLocaleDateString()}_${(timeframe.end as Date).toLocaleDateString()}`.toLowerCase() : 'alle';\n        return `ai_toolbar_last_${s}_${r}`;\n      })();\n      sessionStorage.setItem(key, JSON.stringify(toolbarLast));\n    } catch {}\n  }, [toolbarLast, studentId, timeframe?.start, timeframe?.end, students]);\n\n  const dataQuality = useMemo(() => computeDataQualityMetrics(studentId, timeframe), [studentId, timeframe]);\n\n  const baselineDataQuality = useMemo(() => {\n    if (!compareEnabled || !timeframe) return null;\n    const baselineRange = computeComparisonRange(timeframe as any, compareMode);\n    return computeDataQualityMetrics(studentId, baselineRange as any);\n  }, [studentId, compareEnabled, timeframe, compareMode]);\n\n  const hasSmallBaseline = useMemo(() => {\n    if (!baselineDataQuality) return false;\n    // Threshold: less than 5 data points for small baseline warning\n    const minimumDataPoints = 5;\n    return baselineDataQuality.total < minimumDataPoints;\n  }, [baselineDataQuality]);\n\n  async function testAI() {\n    setIsTesting(true);\n    setError('');\n    try {\n      const resp = await openRouterClient.chat([\n        { role: 'system', content: 'Svar kun på norsk. Vær kort.' },\n        { role: 'user', content: 'Si kun ordet: pong' },\n      ], { modelName: ai.modelName, baseUrl: ai.baseUrl, timeoutMs: 10_000, maxTokens: 8, temperature: 0, localOnly: (ai as any).localOnly });\n      setResults(null);\n      // Model name is displayed via displayModelName; keep minimal state\n      if (!resp?.content?.toLowerCase().includes('pong')) {\n        setError('AI svarte, men ikke som forventet. Sjekk modell og base URL.');\n      }\n    } catch (e) {\n      setError((e as Error)?.message || 'Kunne ikke kontakte AI.');\n    } finally {\n      setIsTesting(false);\n    }\n  }\n\n  async function analyze() {\n    if (!studentId) {\n      setError('Velg en elev først.');\n      return;\n    }\n    setError('');\n    setResults(null);\n    setBaselineResults(null);\n    \n    // UI cache first - check before setting loading states\n    const uiHit = resultsCacheRef.current.get(cacheKey);\n    if (uiHit) {\n      setResults(uiHit.current);\n      setBaselineResults(uiHit.baseline);\n      setFromUiCache(true);\n      // try { if ((uiHit.current as any)?.ai?.model) setLastModelUsed((uiHit.current as any).ai.model as string); } catch {}\n      return;\n    }\n    \n    setIsAnalyzing(true);\n    setIsAnalyzingBaseline(compareEnabled);\n    try {\n      const engine = new LLMAnalysisEngine();\n      // Current analysis\n      const currentPromise = engine.analyzeStudent(studentId, timeframe as any, { \n        includeAiMetadata: true,\n        aiProfile: iepSafeMode ? 'iep' : 'default'\n      });\n\n      // Baseline if enabled and timeframe provided\n      let baselinePromise: Promise<AnalyticsResultsAI | null> | null = null;\n      if (compareEnabled && timeframe) {\n        const baselineRange = computeComparisonRange(timeframe as any, compareMode);\n        baselinePromise = engine\n          .analyzeStudent(studentId, baselineRange as any, { \n            includeAiMetadata: true,\n            aiProfile: iepSafeMode ? 'iep' : 'default'\n          })\n          .then((b) => {\n            // Treat empty baseline as null for UI clarity\n            const totalLen = (b?.patterns?.length || 0) + (b?.correlations?.length || 0) + ((b as any)?.insights?.length || 0);\n            return totalLen === 0 ? null : b;\n          })\n          .catch(() => null);\n      }\n\n      const [res, base] = await Promise.all([currentPromise, baselinePromise ?? Promise.resolve(null)]);\n      setResults(res);\n      setBaselineResults(base);\n      resultsCacheRef.current.set(cacheKey, { current: res, baseline: base });\n      setFromUiCache(false);\n      // if ((res as any)?.ai?.model) setLastModelUsed((res as any).ai.model as string);\n    } catch (e) {\n      setError((e as Error)?.message || 'Analyse feilet.');\n    } finally {\n      setIsAnalyzing(false);\n      setIsAnalyzingBaseline(false);\n    }\n  }\n\n  async function refreshAnalyze() {\n    if (!studentId) {\n      setError('Velg en elev først.');\n      return;\n    }\n    setIsAnalyzing(true);\n    setIsAnalyzingBaseline(compareEnabled);\n    setError('');\n    try {\n      const engine = new LLMAnalysisEngine();\n      const currentPromise = engine.analyzeStudent(studentId, timeframe as any, { \n        includeAiMetadata: true, \n        bypassCache: true,\n        aiProfile: iepSafeMode ? 'iep' : 'default'\n      });\n\n      let baselinePromise: Promise<AnalyticsResultsAI | null> | null = null;\n      if (compareEnabled && timeframe) {\n        const baselineRange = computeComparisonRange(timeframe as any, compareMode);\n        baselinePromise = engine\n          .analyzeStudent(studentId, baselineRange as any, { \n            includeAiMetadata: true, \n            bypassCache: true,\n            aiProfile: iepSafeMode ? 'iep' : 'default'\n          })\n          .then((b) => {\n            const totalLen = (b?.patterns?.length || 0) + (b?.correlations?.length || 0) + ((b as any)?.insights?.length || 0);\n            return totalLen === 0 ? null : b;\n          })\n          .catch(() => null);\n      }\n\n      const [res, base] = await Promise.all([currentPromise, baselinePromise ?? Promise.resolve(null)]);\n      setResults(res);\n      setBaselineResults(base);\n      resultsCacheRef.current.set(cacheKey, { current: res, baseline: base });\n      setFromUiCache(false);\n      // if ((res as any)?.ai?.model) setLastModelUsed((res as any).ai.model as string);\n    } catch (e) {\n      setError((e as Error)?.message || 'Analyse feilet.');\n    } finally {\n      setIsAnalyzing(false);\n      setIsAnalyzingBaseline(false);\n    }\n  }\n\n  // Resolve evidence sources when results change\n  useEffect(() => {\n    async function resolveInterventionSources() {\n      if (!results?.suggestedInterventions?.length) return;\n      \n      const allSourceIds = new Set<string>();\n      for (const intervention of results.suggestedInterventions) {\n        if (intervention.sources?.length) {\n          for (const id of (intervention.sources || [])) {\n            if (typeof id === 'string' && id.trim()) {\n              allSourceIds.add(id.trim());\n            }\n          }\n        }\n      }\n      \n      if (allSourceIds.size === 0) return;\n      \n      try {\n        const resolved = await resolveSources(Array.from(allSourceIds));\n        const sourceMap = new Map(resolved.map(s => [s.id, s]));\n        setResolvedSources(sourceMap);\n      } catch (e) {\n        logger.error('[KreativiumAI] Failed to resolve sources', e as Error);\n      }\n    }\n    \n    resolveInterventionSources();\n  }, [results]);\n\n  async function handleCopyReport() {\n    try {\n      if (!results) return;\n      const text = await formatAiReportText(results, { includeMetadata: true });\n      await navigator.clipboard.writeText(text);\n      try { announceToScreenReader(String(tAnalytics('interface.copyReportAnnounce'))); } catch {}\n      setToolbarLast({ type: 'copy', at: Date.now() });\n    } catch {}\n  }\n\n  async function handleDownloadPDF() {\n    try {\n      if (!results) return;\n      const text = await formatAiReportText(results, { includeMetadata: true });\n      const student = students.find(s => s.id === studentId)?.name || 'elev';\n      const sanitize = (s: string) => s.replace(/[^\\p{L}0-9\\s_-]+/gu, '').trim().replace(/\\s+/g, '_');\n      const studentSafe = sanitize(student);\n      const rangeSafe = timeframe ? `${(timeframe.start as Date).toLocaleDateString()}_${(timeframe.end as Date).toLocaleDateString()}`.replace(/\\s+/g,'') : 'alle';\n      await downloadPdfFromText(text, `kreativium_${studentSafe}_${rangeSafe}.pdf`);\n      try { announceToScreenReader(String(tAnalytics('interface.downloadPdfAnnounce'))); } catch {}\n      setToolbarLast({ type: 'pdf', at: Date.now() });\n    } catch {}\n  }\n\n  async function handleShare() {\n    try {\n      if (!results) return;\n      const text = await formatAiReportText(results);\n      if ((navigator as any).share) {\n        await (navigator as any).share({ title: 'Kreativium‑AI rapport', text });\n      } else {\n        await navigator.clipboard.writeText(text);\n      }\n      try { announceToScreenReader(String(tAnalytics('interface.shareAnnounce'))); } catch {}\n      setToolbarLast({ type: 'share', at: Date.now() });\n    } catch {}\n  }\n\n  // Safe truncation for multi-byte characters\n  const truncateGrapheme = (str: string, max: number): string => {\n    if (!str || str.length <= max) return str;\n    \n    try {\n      // Use Intl.Segmenter if available for proper grapheme cluster handling\n      if (typeof Intl !== 'undefined' && 'Segmenter' in Intl) {\n        const segmenter = new (Intl as any).Segmenter('nb', { granularity: 'grapheme' });\n        const segments = Array.from(segmenter.segment(str));\n        return segments.slice(0, max).map((s: any) => s.segment).join('');\n      }\n    } catch {}\n    \n    // Fallback to Array.from for better multi-byte support than slice\n    return Array.from(str).slice(0, max).join('');\n  };\n\n  // Component for rendering evidence source chips\n  const SourceChip = React.memo(({ sourceId }: { sourceId: string }) => {\n    const source = resolvedSources.get(sourceId);\n    if (!source) return null;\n    \n    const truncatedTitle = truncateGrapheme(source.title, 20);\n    const needsTitleEllipsis = source.title.length > 20;\n    const excerpt = source.shortExcerpt \n      ? truncateGrapheme(source.shortExcerpt, 100) + (source.shortExcerpt.length > 100 ? '...' : '')\n      : '';\n    \n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>\n          <a\n            href={source.url}\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-background border cursor-pointer hover:bg-accent transition-colors\"\n            aria-label={`Åpne kilde: ${source.title}`}\n          >\n            {truncatedTitle}{needsTitleEllipsis && '...'}\n          </a>\n        </TooltipTrigger>\n        <TooltipContent className=\"max-w-xs\">\n          <p className=\"font-medium\">{source.title}</p>\n          {excerpt && <p className=\"text-xs mt-1\">{excerpt}</p>}\n          {source.year && <p className=\"text-xs text-muted-foreground mt-1\">År: {source.year}</p>}\n        </TooltipContent>\n      </Tooltip>\n    );\n  });\n\n  const studentSelectLabelId = React.useId();\n  const studentSelectTriggerId = React.useId();\n  const presetSelectLabelId = React.useId();\n  const presetSelectTriggerId = React.useId();\n  const compareToggleId = React.useId();\n  const iepToggleId = React.useId();\n\n  return (\n    <div className=\"min-h-screen px-4 py-8 sm:px-6 lg:px-8\">\n      {/* Aria-live region for screen reader announcements */}\n      <div \n        className=\"sr-only\" \n        aria-live=\"polite\"\n        aria-atomic=\"true\"\n      >\n        {isAnalyzing && 'Analyserer...'}\n        {isAnalyzingBaseline && 'Analyserer sammenligningsperiode...'}\n        {!isAnalyzing && !isAnalyzingBaseline && results && 'Analyse fullført'}\n      </div>\n      <div className=\"max-w-6xl mx-auto space-y-8\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-11 h-11 rounded-xl bg-gradient-to-br from-primary/20 to-purple-500/20 border border-primary/30 flex items-center justify-center\">\n                <Sparkles className=\"text-primary\" />\n              </div>\n              <div>\n                <h1 className=\"text-2xl font-bold\">Kreativium‑AI</h1>\n              <p className=\"text-sm text-muted-foreground\">Lokal LLM for mønstre, korrelasjoner og tiltak</p>\n              <p className=\"text-xs text-muted-foreground mt-0.5\">Modell: <code>{displayModelName}</code> {fromUiCache && (<span className=\"ml-2 inline-flex items-center gap-1 text-[11px] rounded px-1.5 py-0.5 border border-muted-foreground/30\">• {tAnalytics('interface.fromUiCache')}</span>)}</p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-2\">\n            <Badge variant=\"outline\">{(isLocal || (ai as any).localOnly) ? 'Local model' : 'Remote'}</Badge>\n            <Badge variant=\"outline\">{displayModelName}</Badge>\n            </div>\n          </div>\n\n        <Card className=\"bg-gradient-card border-0 shadow-soft\">\n          <CardContent className=\"p-6 grid gap-4 md:grid-cols-4\">\n            <div className=\"md:col-span-2\">\n              <label\n                id={studentSelectLabelId}\n                className=\"block text-sm text-muted-foreground mb-1\"\n                htmlFor={studentSelectTriggerId}\n              >\n                Elev\n              </label>\n              <Select value={studentId} onValueChange={setStudentId}>\n                <SelectTrigger\n                  id={studentSelectTriggerId}\n                  className=\"w-full\"\n                  aria-labelledby={studentSelectLabelId}\n                >\n                  <SelectValue placeholder=\"Velg elev\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {students.map(s => (\n                    <SelectItem key={s.id} value={s.id}>{s.name}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <label\n                id={presetSelectLabelId}\n                className=\"block text-sm text-muted-foreground mb-1\"\n                htmlFor={presetSelectTriggerId}\n              >\n                Tidsrom\n              </label>\n              <Select value={preset} onValueChange={(v) => setPreset(v as Preset)}>\n                <SelectTrigger\n                  id={presetSelectTriggerId}\n                  className=\"w-full\"\n                  aria-labelledby={presetSelectLabelId}\n                >\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"7d\">Siste 7 dager</SelectItem>\n                  <SelectItem value=\"30d\">Siste 30 dager</SelectItem>\n                  <SelectItem value=\"90d\">Siste 90 dager</SelectItem>\n                  <SelectItem value=\"all\">Hele historikken</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"flex flex-col gap-3\">\n              <div className=\"flex items-center gap-2\">\n                <label className=\"text-sm text-muted-foreground\" htmlFor={compareToggleId}>\n                  {tAnalytics('interface.comparePeriods')}\n                </label>\n                <Toggle\n                  id={compareToggleId}\n                  aria-label={tAnalytics('interface.comparePeriods')}\n                  pressed={compareEnabled}\n                  onPressedChange={(v) => { setCompareEnabled(Boolean(v)); if (!v) setBaselineResults(null); }}\n                  disabled={!studentId || !timeframe}\n                  variant=\"outline\"\n                  size=\"sm\"\n                >\n                  {compareEnabled ? 'På' : 'Av'}\n                </Toggle>\n                <div className=\"ml-auto min-w-[12rem]\">\n                  <Select\n                    value={compareMode}\n                    onValueChange={(v) => setCompareMode(v as any)}\n                    disabled={!compareEnabled || !studentId || !timeframe}\n                  >\n                    <SelectTrigger className=\"w-full\"><SelectValue placeholder={tAnalytics('interface.comparisonMode')} /></SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"previous\">{tAnalytics('interface.previousPeriod')}</SelectItem>\n                      <SelectItem value=\"lastMonth\">{tAnalytics('interface.sameLastMonth')}</SelectItem>\n                      <SelectItem value=\"lastYear\">{tAnalytics('interface.sameLastYear')}</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n              <div className=\"flex items-center gap-2 mt-3\">\n                <label className=\"text-sm text-muted-foreground\" htmlFor={iepToggleId}>\n                  IEP-trygg modus\n                </label>\n                <TooltipProvider>\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Toggle\n                        id={iepToggleId}\n                        aria-label=\"IEP-trygg modus\"\n                        pressed={iepSafeMode}\n                        onPressedChange={(v) => {\n                          setIepSafeMode(Boolean(v));\n                          announceToScreenReader(v ? 'IEP-trygg modus aktivert' : 'IEP-trygg modus deaktivert');\n                        }}\n                        variant=\"outline\"\n                        size=\"sm\"\n                      >\n                        {iepSafeMode ? 'På' : 'Av'}\n                      </Toggle>\n                    </TooltipTrigger>\n                    <TooltipContent>\n                      <p>IEP-trygg modus sikrer pedagogiske anbefalinger</p>\n                      <p className=\"text-xs\">uten medisinske/kliniske råd</p>\n                    </TooltipContent>\n                  </Tooltip>\n                </TooltipProvider>\n              </div>\n              <div className=\"flex items-end gap-2\">\n                <Button variant=\"outline\" onClick={testAI} disabled={isTesting} className=\"w-1/2\">\n                  <RefreshCw className=\"h-4 w-4 mr-2\" />Test AI\n                </Button>\n                <Button onClick={analyze} disabled={isAnalyzing || !studentId} className=\"w-1/2\">\n                  <Play className=\"h-4 w-4 mr-2\" />Kjør analyse\n                </Button>\n                <Button onClick={refreshAnalyze} variant=\"secondary\" disabled={isAnalyzing || !studentId} className=\"w-full sm:w-auto\">\n                  <RefreshCw className=\"h-4 w-4 mr-2\" />Oppdater (forbi cache)\n                </Button>\n                {compareEnabled && isAnalyzingBaseline && (\n                  <span className=\"inline-flex items-center gap-1 text-xs text-muted-foreground\">\n                    <Loader2 className=\"h-3 w-3 animate-spin\" /> Sammenligning...\n                  </span>\n                )}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Data Quality Card */}\n        {studentId && (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\"><Database className=\"h-4 w-4\" />Datakvalitet</CardTitle>\n            </CardHeader>\n            <CardContent className=\"text-sm text-foreground/90\">\n              {dataQuality ? (\n                <div className=\"grid grid-cols-1 sm:grid-cols-4 gap-3\">\n                  <div>\n                    <div className=\"text-xs text-muted-foreground\">Datapunkter</div>\n                    <div className=\"font-medium\">{dataQuality.total}</div>\n                  </div>\n                  <div>\n                    <div className=\"text-xs text-muted-foreground\">Sist registrert</div>\n                    <div className=\"font-medium\">{dataQuality.last ? dataQuality.last.toLocaleString() : '—'}</div>\n                  </div>\n                  <div>\n                    <div className=\"text-xs text-muted-foreground\">Dager siden</div>\n                    <div className=\"font-medium\">{dataQuality.daysSince ?? '—'}</div>\n                  </div>\n                  <div>\n                    <div className=\"text-xs text-muted-foreground\">Fullstendighet</div>\n                    <div className=\"font-medium\">{dataQuality.completeness}%</div>\n                  </div>\n                  <div className=\"sm:col-span-4\">\n                    <div className=\"text-xs text-muted-foreground mb-1\">Balanse (tid på dagen)</div>\n                    <div className=\"flex items-center gap-2\">\n                      {(['morning','afternoon','evening'] as const).map((k, i) => (\n                        <div key={k} className=\"flex items-center gap-1\">\n                          <span className=\"text-[11px] text-muted-foreground\">{k === 'morning' ? 'morgen' : k === 'afternoon' ? 'etterm.' : 'kveld'}</span>\n                          <span className=\"text-[11px]\">{(dataQuality.buckets as any)[k]}</span>\n                          {i < 2 && <span className=\"text-muted-foreground/40\">•</span>}\n                        </div>\n                      ))}\n                      <span className=\"ml-auto text-[11px] text-muted-foreground\">score: {dataQuality.balance}%</span>\n                    </div>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"flex items-center gap-2 text-muted-foreground\"><AlertTriangle className=\"h-4 w-4\" />Ingen data funnet for valgt periode.</div>\n              )}\n            </CardContent>\n          </Card>\n        )}\n\n        {error && (\n          <Card>\n            <CardContent className=\"p-4 text-destructive text-sm\">{error}</CardContent>\n          </Card>\n        )}\n\n        {!results && !error && (isTesting || isAnalyzing) && (\n          <div className=\"grid grid-cols-1 gap-4\">\n            <Skeleton className=\"h-28\" />\n            <Skeleton className=\"h-40\" />\n            <Skeleton className=\"h-40\" />\n          </div>\n        )}\n\n        {results && (\n          <div className=\"space-y-6\">\n            {/* Export & Share Toolbar */}\n            <Card>\n              <CardContent className=\"p-4 flex flex-wrap items-center gap-2\">\n                <TooltipProvider>\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button variant=\"outline\" size=\"sm\" aria-label={String(tAnalytics('interface.toolbarCopyAria'))} onClick={handleCopyReport}>\n                        <ClipboardIcon className=\"h-4 w-4 mr-2\" />{String(tAnalytics('interface.toolbarCopy'))}\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>{String(tAnalytics('interface.toolbarCopyTooltip'))}</TooltipContent>\n                  </Tooltip>\n                </TooltipProvider>\n                <TooltipProvider>\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button variant=\"outline\" size=\"sm\" aria-label={String(tAnalytics('interface.toolbarPdfAria'))} onClick={handleDownloadPDF}>\n                        <Download className=\"h-4 w-4 mr-2\" />{String(tAnalytics('interface.toolbarPdf'))}\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>{String(tAnalytics('interface.toolbarPdfTooltip'))}</TooltipContent>\n                  </Tooltip>\n                </TooltipProvider>\n                <TooltipProvider>\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button variant=\"outline\" size=\"sm\" aria-label={String(tAnalytics('interface.toolbarShareAria'))} onClick={handleShare}>\n                        <Share2 className=\"h-4 w-4 mr-2\" />{String(tAnalytics('interface.toolbarShare'))}\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent>{String(tAnalytics('interface.toolbarShareTooltip'))}</TooltipContent>\n                  </Tooltip>\n                </TooltipProvider>\n                {toolbarLast.at && (\n                  <span className=\"text-[11px] text-muted-foreground ml-1\">\n                    {String(tAnalytics('interface.lastExportShort'))}: {toolbarLast.type?.toUpperCase()} {new Date(toolbarLast.at).toLocaleTimeString()}\n                  </span>\n                )}\n              </CardContent>\n            </Card>\n            {compareEnabled && timeframe && (\n              <ComparisonSummary\n                current={results}\n                baseline={baselineResults}\n                mode={compareMode}\n                currentLabel={`${(timeframe.start as Date).toLocaleDateString()} – ${(timeframe.end as Date).toLocaleDateString()}`}\n                baselineLabel={baselineResults ? formatComparisonPeriodLabel(computeComparisonRange(timeframe as any, compareMode), compareMode) : tAnalytics('interface.noDataInComparisonPeriod')}\n                studentName={students.find(s => s.id === studentId)?.name || ''}\n                currentBalance={dataQuality?.balance}\n                baselineBalance={baselineDataQuality?.balance}\n                currentAvgIntensity={dataQuality?.avgIntensity}\n                baselineAvgIntensity={baselineDataQuality?.avgIntensity}\n                hasSmallBaseline={hasSmallBaseline}\n              />\n            )}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\"><Database className=\"h-4 w-4\" />Nøkkelfunn</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-2\">\n                {(results as any)?.keyFindings?.length ? (\n                  <ul className=\"list-disc pl-5 text-sm text-foreground/90\">\n                    {(results as any).keyFindings.map((x: string, i: number) => <li key={i}>{x}</li>)}\n                  </ul>\n                ) : <p className=\"text-sm text-muted-foreground\">Ingen nøkkelfunn rapportert.</p>}\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\"><Clock className=\"h-4 w-4\" />Mønstre</CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {results.patterns?.length ? results.patterns.map((p, idx) => (\n                  <div key={idx} className=\"rounded-md border p-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"font-medium\">{p.pattern || 'Mønster'}</div>\n                      {typeof (p as any).impact === 'string' && (\n                        <Badge variant=\"outline\">{String((p as any).impact)}</Badge>\n                      )}\n                    </div>\n                    {p.description && <p className=\"text-sm text-muted-foreground mt-1\">{p.description}</p>}\n                  </div>\n                )) : <p className=\"text-sm text-muted-foreground\">Ingen mønstre identifisert.</p>}\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\"><Sparkles className=\"h-4 w-4\" />Tiltak og anbefalinger</CardTitle>\n              </CardHeader>\n              <TooltipProvider>\n              <CardContent className=\"space-y-3\">\n                {(results as any)?.suggestedInterventions?.length ? (\n                  <ul className=\"space-y-3\">\n                    {(results as any).suggestedInterventions.map((s: any, i: number) => (\n                      <li key={i} className=\"rounded-md border p-3\">\n                        <div className=\"font-medium\">{s.title}</div>\n                        {s.description && <p className=\"text-sm text-muted-foreground mt-1\">{s.description}</p>}\n                        {Array.isArray(s.actions) && s.actions.length > 0 && (\n                          <ul className=\"list-disc pl-5 mt-2 text-sm\">\n                            {s.actions.map((a: string, j: number) => <li key={j}>{a}</li>)}\n                          </ul>\n                        )}\n                        {s.sources?.length > 0 && (\n                          <div className=\"mt-3\">\n                            <span className=\"text-xs text-muted-foreground mr-2\">Källor:</span>\n                            <div className=\"flex flex-wrap gap-1 mt-1\">\n                              {s.sources.map((sourceId: string, idx: number) => (\n                                <SourceChip key={idx} sourceId={sourceId} />\n                              ))}\n                            </div>\n                          </div>\n                        )}\n                        {(s.expectedImpact || s.timeHorizon || s.tier) && (\n                          <div className=\"mt-2 flex flex-wrap gap-2\">\n                            {s.expectedImpact && <Badge variant=\"outline\">{s.expectedImpact}</Badge>}\n                            {s.timeHorizon && <Badge variant=\"outline\">{s.timeHorizon}</Badge>}\n                            {s.tier && <Badge variant=\"outline\">{s.tier}</Badge>}\n                          </div>\n                        )}\n                      </li>\n                    ))}\n                  </ul>\n                ) : <p className=\"text-sm text-muted-foreground\">Ingen anbefalinger rapportert.</p>}\n              </CardContent>\n              </TooltipProvider>\n            </Card>\n\n            {results.ai && (\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Info className=\"h-4 w-4\" />AI‑metadata • <span className=\"font-normal text-muted-foreground\">{displayModelName}</span>\n                    {(((results.ai.usage as any)?.cacheReadTokens ?? 0) > 0 || (Array.isArray(results.ai.caveats) && results.ai.caveats.some(c => /cache/i.test(String(c))))) && (\n                      <Badge variant=\"outline\">{tAnalytics('interface.fromCache')}</Badge>\n                    )}\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"text-sm text-muted-foreground space-y-1\">\n                  <div>Modell: {results.ai.model}</div>\n                  {results.ai.latencyMs != null && <div>Latens: {Math.round(results.ai.latencyMs)} ms</div>}\n                  {results.ai.usage && (\n                    <div>Tokens: prompt {results.ai.usage.promptTokens ?? 0} • completion {results.ai.usage.completionTokens ?? 0} • total {results.ai.usage.totalTokens ?? 0}</div>\n                  )}\n                  {results.ai.usage && (((results.ai.usage as any).cacheReadTokens ?? 0) > 0 || ((results.ai.usage as any).cacheWriteTokens ?? 0) > 0) && (\n                    <div>Cache: read {(results.ai.usage as any).cacheReadTokens ?? 0} • write {(results.ai.usage as any).cacheWriteTokens ?? 0}</div>\n                  )}\n                  {(() => { try { const s = aiMetrics.summary(); const pct = Math.round((s.jsonValidity || 0) * 100); return <div>JSON‑gyldighet (global): {pct}%</div>; } catch { return null; } })()}\n                  {Array.isArray(results.ai.caveats) && results.ai.caveats.length > 0 && (\n                    <div>Forbehold: {results.ai.caveats.join('; ')}</div>\n                  )}\n                </CardContent>\n              </Card>\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/NotFound.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/ReportBuilderPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/Reports.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/ReportsClean.tsx","messages":[{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":47,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":47,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2126,2126],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":53,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":53,"endColumn":15,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2309,2309],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useEffect, useMemo, useState, useId } from 'react';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { useTranslation } from '@/hooks/useTranslation';\nimport { dataStorage } from '@/lib/dataStorage';\nimport { downloadBlob } from '@/lib/utils';\nimport { logger } from '@/lib/logger';\nimport { Download, FileText, Save } from 'lucide-react';\nimport { toast } from 'sonner';\nimport { Breadcrumbs } from '@/components/ui/Breadcrumbs';\nimport { useNavigate } from 'react-router-dom';\nimport { useReportsWorker } from '@/hooks/useReportsWorker';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { Label } from '@/components/ui/label';\n\nconst EXPORT_PREFS_KEY = 'sensory-tracker_export_prefs_v1';\n\ntype DatePreset = '7d' | '30d' | '90d' | 'qtd' | 'all' | 'custom';\n\nconst Reports = () => {\n  const { tSettings, tCommon } = useTranslation();\n  const [isExporting, setIsExporting] = useState<boolean>(false);\n  const [progress, setProgress] = useState<number>(0);\n  const { run } = useReportsWorker();\n  const navigate = useNavigate();\n\n  const [preset, setPreset] = useState<DatePreset>('all');\n  const [customStart, setCustomStart] = useState<string>('');\n  const [customEnd, setCustomEnd] = useState<string>('');\n  const [anonymize, setAnonymize] = useState<boolean>(false);\n  const [backupUseFilters, setBackupUseFilters] = useState<boolean>(false);\n  const customStartId = useId();\n  const customEndId = useId();\n\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem(EXPORT_PREFS_KEY);\n      if (raw) {\n        const saved = JSON.parse(raw) as { preset: DatePreset; customStart?: string; customEnd?: string; anonymize?: boolean; backupUseFilters?: boolean };\n        setPreset(saved.preset ?? 'all');\n        setCustomStart(saved.customStart ?? '');\n        setCustomEnd(saved.customEnd ?? '');\n        setAnonymize(!!saved.anonymize);\n        setBackupUseFilters(!!saved.backupUseFilters);\n      }\n    } catch {}\n  }, []);\n\n  useEffect(() => {\n    try {\n      localStorage.setItem(EXPORT_PREFS_KEY, JSON.stringify({ preset, customStart, customEnd, anonymize, backupUseFilters }));\n    } catch {}\n  }, [preset, customStart, customEnd, anonymize, backupUseFilters]);\n\n  const computedDateRange = useMemo(() => {\n    if (preset === 'all') return undefined;\n    const now = new Date();\n    if (preset === '7d' || preset === '30d' || preset === '90d') {\n      const days = preset === '7d' ? 7 : preset === '30d' ? 30 : 90;\n      const start = new Date(now);\n      start.setDate(now.getDate() - days);\n      return { start, end: now } as const;\n    }\n    if (preset === 'qtd') {\n      const month = now.getMonth();\n      const qStartMonth = month - (month % 3);\n      const start = new Date(now.getFullYear(), qStartMonth, 1);\n      return { start, end: now } as const;\n    }\n    if (preset === 'custom' && customStart && customEnd) {\n      const start = new Date(customStart);\n      const end = new Date(customEnd);\n      if (!isNaN(start.getTime()) && !isNaN(end.getTime()) && start <= end) {\n        return { start, end } as const;\n      }\n    }\n    return undefined;\n  }, [preset, customStart, customEnd]);\n\n  const customRangeInvalid = useMemo(() => {\n    if (preset !== 'custom') return false;\n    if (!customStart || !customEnd) return true;\n    const start = new Date(customStart);\n    const end = new Date(customEnd);\n    return isNaN(start.getTime()) || isNaN(end.getTime()) || start > end;\n  }, [preset, customStart, customEnd]);\n\n  const [pdfStudentId, setPdfStudentId] = useState<string>(\"\");\n\n  const loadAllData = useCallback(() => {\n    try {\n      const students = dataStorage.getStudents();\n      const trackingEntries = dataStorage.getTrackingEntries();\n      const goals = dataStorage.getGoals();\n      return { students, trackingEntries, goals } as const;\n    } catch (error) {\n      logger.error('Reports: failed to load data for export', { error });\n      return { students: [], trackingEntries: [], goals: [] } as const;\n    }\n  }, []);\n\n  const handleExportCSV = useCallback(async () => {\n    setIsExporting(true);\n    try {\n      const { students, trackingEntries, goals } = loadAllData();\n      setProgress(0);\n      const content = await run({\n        kind: 'csv',\n        students,\n        allData: {\n          trackingEntries,\n          emotions: trackingEntries.flatMap(e => e.emotions),\n          sensoryInputs: trackingEntries.flatMap(e => e.sensoryInputs),\n          goals,\n        },\n        options: {\n          includeFields: ['emotions','sensoryInputs','goals','trackingEntries'],\n          dateRange: computedDateRange,\n          anonymize,\n        },\n        onProgress: ({ progress }) => setProgress(Math.round(progress * 100)),\n      });\n      const blob = new Blob([content], { type: 'text/csv' });\n      const filename = `sensory_tracker_full_export_${new Date().toISOString().split('T')[0]}.csv`;\n      downloadBlob(blob, filename);\n      toast.success(String(tSettings('dataExport.success_csv')));\n    } catch (error) {\n      logger.error('System CSV export failed', { error });\n      toast.error(tSettings('dataExport.error_generic'));\n    } finally {\n      setIsExporting(false);\n    }\n  }, [loadAllData, run, computedDateRange, anonymize, tSettings]);\n\n  const handleExportJSON = useCallback(async () => {\n    setIsExporting(true);\n    try {\n      const { students, trackingEntries, goals } = loadAllData();\n      setProgress(0);\n      const content = await run({\n        kind: 'json',\n        students,\n        allData: {\n          trackingEntries,\n          emotions: trackingEntries.flatMap(e => e.emotions),\n          sensoryInputs: trackingEntries.flatMap(e => e.sensoryInputs),\n          goals,\n        },\n        options: {\n          includeFields: ['students','trackingEntries','emotions','sensoryInputs','goals'],\n          dateRange: computedDateRange,\n          anonymize,\n        },\n        onProgress: ({ progress }) => setProgress(Math.round(progress * 100)),\n      });\n      const blob = new Blob([content], { type: 'application/json' });\n      const filename = `sensory_tracker_full_export_${new Date().toISOString().replace(/[:.]/g, '-')}.json`;\n      downloadBlob(blob, filename);\n      toast.success(String(tSettings('dataExport.success_json')));\n    } catch (error) {\n      logger.error('System JSON export failed', { error });\n      toast.error(tSettings('dataExport.error_generic'));\n    } finally {\n      setIsExporting(false);\n    }\n  }, [loadAllData, run, computedDateRange, anonymize, tSettings]);\n\n  const handleCreateBackup = useCallback(async () => {\n    setIsExporting(true);\n    try {\n      const { students, trackingEntries, goals } = loadAllData();\n      const { exportSystem } = await import('@/lib/exportSystem');\n      let entries = trackingEntries;\n      let emotions = trackingEntries.flatMap(e => e.emotions);\n      let sensoryInputs = trackingEntries.flatMap(e => e.sensoryInputs);\n      if (backupUseFilters && computedDateRange) {\n        const { start, end } = computedDateRange;\n        entries = entries.filter(e => e.timestamp >= start && e.timestamp <= end);\n        emotions = emotions.filter(e => e.timestamp >= start && e.timestamp <= end);\n        sensoryInputs = sensoryInputs.filter(s => s.timestamp >= start && s.timestamp <= end);\n      }\n      const backup = exportSystem.createFullBackup(students, {\n        trackingEntries: entries,\n        emotions,\n        sensoryInputs,\n        goals,\n      });\n      const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });\n      const filename = `sensory_tracker_backup_${new Date().toISOString().replace(/[:.]/g, '-')}.json`;\n      downloadBlob(blob, filename);\n      toast.success(String(tSettings('dataExport.success_backup')));\n    } catch (error) {\n      logger.error('System backup failed', { error });\n      toast.error(tSettings('dataExport.error_generic'));\n    } finally {\n      setIsExporting(false);\n    }\n  }, [loadAllData, backupUseFilters, computedDateRange, tSettings]);\n\n  return (\n    <div className=\"min-h-screen px-4 py-8 sm:px-6 lg:px-8\">\n      <div className=\"max-w-4xl mx-auto space-y-6\">\n        <header className=\"space-y-2\">\n          <Breadcrumbs\n            items={[\n              { label: tCommon('buttons.home'), href: '/' },\n              { label: tSettings('title'), href: '/settings' },\n              { label: tSettings('dataExport.title'), current: true },\n            ]}\n          />\n          <h1 className=\"text-3xl font-bold text-foreground\">{tSettings('dataExport.title')}</h1>\n          <p className=\"text-muted-foreground mt-2\">{tSettings('dataExport.description')}</p>\n        </header>\n\n        <Card className=\"bg-gradient-card border-0 shadow-soft\">\n          <CardContent className=\"p-6 space-y-4\">\n            <div className=\"grid gap-4 md:grid-cols-3\">\n              <div>\n                <Label className=\"mb-2 block\">{tCommon('reports.exportFilters.dateRange')}</Label>\n                <Select value={preset} onValueChange={(v) => setPreset(v as DatePreset)}>\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">{tCommon('reports.exportFilters.presets.all')}</SelectItem>\n                    <SelectItem value=\"7d\">{tCommon('reports.exportFilters.presets.last7')}</SelectItem>\n                    <SelectItem value=\"30d\">{tCommon('reports.exportFilters.presets.last30')}</SelectItem>\n                    <SelectItem value=\"90d\">{tCommon('reports.exportFilters.presets.last90')}</SelectItem>\n                    <SelectItem value=\"qtd\">{tCommon('reports.exportFilters.presets.qtd')}</SelectItem>\n                    <SelectItem value=\"custom\">{tCommon('reports.exportFilters.presets.custom')}</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              {preset === 'custom' && (\n                <div className=\"grid grid-cols-2 gap-2 md:col-span-2\">\n                  <div>\n                    <label className=\"text-sm\" htmlFor={customStartId}>{tCommon('reports.exportFilters.start')}</label>\n                    <input\n                      id={customStartId}\n                      className={`w-full h-9 rounded-md border bg-background px-3 text-sm ${customRangeInvalid ? 'border-destructive' : ''}`}\n                      type=\"date\"\n                      aria-invalid={customRangeInvalid}\n                      aria-label={tCommon('reports.exportFilters.start')}\n                      value={customStart}\n                      onChange={(e) => setCustomStart(e.target.value)}\n                    />\n                  </div>\n                  <div>\n                    <label className=\"text-sm\" htmlFor={customEndId}>{tCommon('reports.exportFilters.end')}</label>\n                    <input\n                      id={customEndId}\n                      className={`w-full h-9 rounded-md border bg-background px-3 text-sm ${customRangeInvalid ? 'border-destructive' : ''}`}\n                      type=\"date\"\n                      aria-invalid={customRangeInvalid}\n                      aria-label={tCommon('reports.exportFilters.end')}\n                      value={customEnd}\n                      onChange={(e) => setCustomEnd(e.target.value)}\n                    />\n                  </div>\n                  {customRangeInvalid && (\n                    <p className=\"col-span-2 text-xs text-destructive\" role=\"alert\">\n                      {tCommon('reports.exportFilters.errors.invalidRange')}\n                    </p>\n                  )}\n                </div>\n              )}\n              <div className=\"flex items-center gap-2 md:col-start-3\">\n                <Checkbox id=\"anonymize\" checked={anonymize} onCheckedChange={(c) => setAnonymize(!!c)} />\n                <Label htmlFor=\"anonymize\">{tCommon('reports.exportFilters.anonymize')}</Label>\n              </div>\n              <div className=\"flex items-center gap-2 md:col-start-3\">\n                <Checkbox id=\"backupFilters\" checked={backupUseFilters} onCheckedChange={(c) => setBackupUseFilters(!!c)} />\n                <Label htmlFor=\"backupFilters\">{tCommon('reports.exportFilters.backupUseFilters')}</Label>\n              </div>\n            </div>\n\n            {/* Summary */}\n            <p className=\"text-xs text-muted-foreground\" aria-live=\"polite\" role=\"status\">\n              {(() => {\n                const fmt = (d: Date) => d.toISOString().slice(0, 10);\n                if (computedDateRange) {\n                  return anonymize\n                    ? tCommon('reports.exportFilters.summary.withRangeAnon', { start: fmt(computedDateRange.start), end: fmt(computedDateRange.end) })\n                    : tCommon('reports.exportFilters.summary.withRange', { start: fmt(computedDateRange.start), end: fmt(computedDateRange.end) });\n                }\n                return anonymize\n                  ? tCommon('reports.exportFilters.summary.allAnon')\n                  : tCommon('reports.exportFilters.summary.all');\n              })()}\n              {isExporting ? ` • ${tCommon('reports.exportFilters.summary.progress', { percent: progress })}` : ''}\n            </p>\n\n            <div className=\"flex flex-wrap gap-3\">\n              <Button variant=\"outline\" onClick={handleExportCSV} disabled={isExporting || customRangeInvalid} aria-busy={isExporting} data-testid=\"export-csv\">\n                <Download className=\"h-4 w-4 mr-2\" />{tSettings('dataExport.actions.exportAllCsv')}\n              </Button>\n              <Button variant=\"outline\" onClick={handleExportJSON} disabled={isExporting || customRangeInvalid} aria-busy={isExporting} data-testid=\"export-json\">\n                <FileText className=\"h-4 w-4 mr-2\" />{tSettings('dataExport.actions.exportAllJson')}\n              </Button>\n              <Button variant=\"outline\" onClick={handleCreateBackup} disabled={isExporting} aria-busy={isExporting} data-testid=\"create-backup\">\n                <Save className=\"h-4 w-4 mr-2\" />{tSettings('dataExport.actions.createBackup')}\n              </Button>\n            </div>\n\n            {/* Analytics PDF quick access */}\n            <div className=\"mt-6 grid gap-3 md:grid-cols-3 items-end\">\n              <div className=\"md:col-span-2\">\n                <Label htmlFor=\"pdfStudent\">{tCommon('reports.analyticsPdf.student')}</Label>\n                <Select value={pdfStudentId} onValueChange={setPdfStudentId}>\n                  <SelectTrigger id=\"pdfStudent\">\n                    <SelectValue placeholder={tCommon('reports.analyticsPdf.selectStudent')} />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {loadAllData().students.map((s) => (\n                      <SelectItem key={s.id} value={s.id}>{s.name}</SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"flex gap-2\">\n                <Button\n                  variant=\"default\"\n                  disabled={!pdfStudentId}\n                  onClick={() => {\n                    const range = computedDateRange;\n                    const params = new URLSearchParams();\n                    params.set('tab', 'charts');\n                    if (range) {\n                      params.set('start', range.start.toISOString().slice(0, 10));\n                      params.set('end', range.end.toISOString().slice(0, 10));\n                    }\n                    navigate(`/student/${pdfStudentId}?${params.toString()}`);\n                  }}\n                  data-testid=\"analytics-pdf-link\"\n                >\n                  {tCommon('reports.analyticsPdf.button')}\n                </Button>\n              </div>\n            </div>\n\n            <p className=\"text-xs text-muted-foreground\">\n              {tCommon('reports.analyticsPdf.helper')}\n            </p>\n\n            <p className=\"text-xs text-muted-foreground\">{tSettings('dataExport.note')}</p>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n};\n\nexport default Reports;\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/ReportsHub.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/Settings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/SignIndexPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/SignLearnPage.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Vis dette tegnet:\"","line":41,"column":41,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":41,"endColumn":60},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <h3 className=\"text-2xl font-semibold text-foreground flex items-center gap-2\">\n            <Hand className=\"h-5 w-5\" /> Vis dette tegnet: <span className=\"text-primary\">{current.word}</span>\n          </h3>","line":41,"column":41,"nodeType":"JSXText","endLine":41,"endColumn":60},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"👍 Jeg gjorde det!\"","line":53,"column":66,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":53,"endColumn":84},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <Button onClick={handleNext} aria-label=\"Neste tegn\">👍 Jeg gjorde det!</Button>","line":53,"column":66,"nodeType":"JSXText","endLine":53,"endColumn":84},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Kameraveiledning kommer – øv selv foreløpig\"","line":57,"column":45,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":58,"endColumn":13},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <div className=\"text-xs text-muted-foreground flex items-center gap-2\">\n              <Camera className=\"h-4 w-4\" /> Kameraveiledning kommer – øv selv foreløpig\n            </div>","line":57,"column":45,"nodeType":"JSXText","endLine":58,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { useTranslation } from \"@/hooks/useTranslation\";\nimport { SIGN_ITEMS } from \"@/lib/tegn/signData\";\nimport { Button } from \"@/components/ui/button\";\nimport { useState } from \"react\";\nimport { TegnXPBar } from \"@/components/tegn/TegnXPBar\";\nimport { useTegnXP } from \"@/contexts/TegnXPContext\";\nimport { Camera, Hand } from \"lucide-react\";\nimport { WebcamPreview } from \"@/components/tegn/WebcamPreview\";\n\nconst SignLearnPage = () => {\n  const { tCommon } = useTranslation();\n  const sample = SIGN_ITEMS.slice(0, 12);\n  const { addXP } = useTegnXP();\n  const [index, setIndex] = useState(0);\n  const [showAnswer, setShowAnswer] = useState(false);\n\n  const current = sample[index % sample.length];\n\n  const handleNext = () => {\n    addXP(5);\n    setIndex(prev => prev + 1);\n    setShowAnswer(false);\n  };\n\n  return (\n    <section className=\"space-y-6\">\n      <Card className=\"bg-gradient-card border-0 shadow-soft\">\n        <CardContent className=\"p-6 space-y-2\">\n          <h2 className=\"text-xl font-semibold\">{String(tCommon('tegn.learn'))}</h2>\n          <p className=\"text-sm text-muted-foreground\">{String(tCommon('tegn.learnDesc'))}</p>\n        </CardContent>\n      </Card>\n\n      <TegnXPBar />\n\n      <Card className=\"glass-card border border-primary/10\">\n        <CardContent className=\"p-6 space-y-4\">\n          <div className=\"text-sm text-muted-foreground\">{index + 1}/{sample.length}</div>\n          <h3 className=\"text-2xl font-semibold text-foreground flex items-center gap-2\">\n            <Hand className=\"h-5 w-5\" /> Vis dette tegnet: <span className=\"text-primary\">{current.word}</span>\n          </h3>\n          <div className=\"flex flex-col items-center gap-4\">\n            <img src={current.imageUrl} alt={current.alt} className=\"w-64 h-64 object-contain\" />\n            {showAnswer && (\n              <div className=\"text-lg text-foreground\">{current.word}</div>\n            )}\n          </div>\n          <div className=\"flex flex-wrap gap-2\">\n            <Button variant=\"outline\" onClick={() => setShowAnswer(s => !s)} aria-label={showAnswer ? 'Skjul fasit' : 'Vis fasit'}>\n              {showAnswer ? 'Skjul fasit' : 'Vis fasit'}\n            </Button>\n            <Button onClick={handleNext} aria-label=\"Neste tegn\">👍 Jeg gjorde det!</Button>\n          </div>\n          <div className=\"space-y-2\">\n            <div className=\"text-xs text-muted-foreground flex items-center gap-2\">\n              <Camera className=\"h-4 w-4\" /> Kameraveiledning kommer – øv selv foreløpig\n            </div>\n            <WebcamPreview active={false} className=\"max-w-md\" />\n          </div>\n        </CardContent>\n      </Card>\n    </section>\n  );\n};\n\nexport default SignLearnPage;\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/SignMemoryPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'flippedIndexes' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":28,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":24},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":78,"column":9,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":101,"endColumn":16},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"?\"","line":150,"column":112,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":150,"endColumn":113}],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'setupGame'. Either include it or remove the dependency array.","line":55,"column":6,"nodeType":"ArrayExpression","endLine":55,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [setupGame]","fix":{"range":[1821,1823],"text":"[setupGame]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTranslation } from \"@/hooks/useTranslation\";\nimport { SIGN_ITEMS } from \"@/lib/tegn/signData\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useTegnXP } from \"@/contexts/TegnXPContext\";\nimport { cn } from \"@/lib/utils\";\n\ntype CardType = 'sign' | 'text';\n\ninterface MemoryCard {\n  id: string;\n  pairKey: string; // shared word\n  type: CardType;\n  imageUrl?: string;\n  revealed: boolean;\n  matched: boolean;\n}\n\nconst PAIRS = 6;\nconst MATCH_XP = 2;\nconst BONUS_XP = 10;\n\nconst SignMemoryPage = () => {\n  const { tCommon } = useTranslation();\n  const { addXP } = useTegnXP();\n  const [cards, setCards] = useState<MemoryCard[]>([]);\n  const [flippedIndexes, setFlippedIndexes] = useState<number[]>([]);\n  const [moves, setMoves] = useState(0);\n  const [pairsFound, setPairsFound] = useState(0);\n  const [gameOver, setGameOver] = useState(false);\n\n  const basePool = useMemo(() => SIGN_ITEMS.slice(0), []);\n\n  const setupGame = () => {\n    setGameOver(false);\n    setMoves(0);\n    setPairsFound(0);\n    setFlippedIndexes([]);\n    // pick random PAIRS distinct signs\n    const shuffled = [...basePool].sort(() => Math.random() - 0.5).slice(0, PAIRS);\n    const newCards: MemoryCard[] = [];\n    shuffled.forEach(sign => {\n      newCards.push({ id: `${sign.id}-img`, pairKey: sign.word, type: 'sign', imageUrl: sign.imageUrl, revealed: false, matched: false });\n      newCards.push({ id: `${sign.id}-txt`, pairKey: sign.word, type: 'text', revealed: false, matched: false });\n    });\n    // shuffle cards\n    const mixed = newCards.sort(() => Math.random() - 0.5);\n    setCards(mixed);\n  };\n\n  useEffect(() => {\n    setupGame();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    if (pairsFound === PAIRS && PAIRS > 0) {\n      setGameOver(true);\n      addXP(BONUS_XP);\n    }\n  }, [pairsFound, addXP]);\n\n  const handleFlip = (idx: number) => {\n    if (gameOver) return;\n    setCards(prev => {\n      const c = prev[idx];\n      if (c.revealed || c.matched) return prev;\n      const next = [...prev];\n      next[idx] = { ...c, revealed: true };\n      return next;\n    });\n    setFlippedIndexes(prev => {\n      const next = [...prev, idx];\n      if (next.length === 2) {\n        setMoves(m => m + 1);\n        // check match after short delay to allow UI render\n        setTimeout(() => {\n          setCards(curr => {\n            const [a, b] = next;\n            const ca = curr[a];\n            const cb = curr[b];\n            if (!ca || !cb) return curr;\n            if (ca.pairKey === cb.pairKey && ca.type !== cb.type) {\n              // match\n              addXP(MATCH_XP);\n              const updated = curr.map((card, i) =>\n                i === a || i === b ? { ...card, matched: true } : card\n              );\n              setPairsFound(p => p + 1);\n              return updated;\n            } else {\n              // flip back\n              const updated = curr.map((card, i) =>\n                i === a || i === b ? { ...card, revealed: false } : card\n              );\n              return updated;\n            }\n          });\n          setFlippedIndexes([]);\n        }, 650);\n      }\n      return next;\n    });\n  };\n\n  return (\n    <section className=\"space-y-6\">\n      <Card className=\"bg-gradient-card border-0 shadow-soft\">\n        <CardContent className=\"p-6 space-y-2\">\n          <h2 className=\"text-xl font-semibold\">{String(tCommon('tegn.memory'))}</h2>\n          <p className=\"text-sm text-muted-foreground\">{String(tCommon('tegn.memoryDesc'))}</p>\n          <div className=\"text-sm text-muted-foreground flex gap-4\">\n            <span>{String(tCommon('tegn.moves'))}: {moves}</span>\n            <span>{String(tCommon('tegn.pairsFound', { count: pairsFound }))}</span>\n          </div>\n          <div className=\"flex gap-2\">\n            <Button variant=\"outline\" onClick={setupGame}>{String(tCommon('tegn.resetGame'))}</Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"grid grid-cols-3 sm:grid-cols-4 gap-4\">\n        {cards.map((card, idx) => {\n          const isFaceUp = card.revealed || card.matched;\n          const aria = !isFaceUp\n            ? tCommon('tegn.hiddenCard')\n            : card.type === 'sign'\n              ? tCommon('tegn.signCardAria', { word: card.pairKey })\n              : tCommon('tegn.textCardAria', { word: card.pairKey });\n          return (\n            <button\n              key={card.id}\n              onClick={() => handleFlip(idx)}\n              className={cn(\n                'relative aspect-[3/4] rounded-xl border border-border overflow-hidden transition-transform focus:outline-none focus-visible:ring-2 focus-visible:ring-ring',\n                isFaceUp ? 'bg-background' : 'bg-muted/60 hover:scale-[1.02]'\n              )}\n              aria-label={aria}\n            >\n              {isFaceUp ? (\n                card.type === 'sign' ? (\n                  <img src={card.imageUrl} alt={card.pairKey} className=\"w-full h-full object-contain p-3\" />\n                ) : (\n                  <div className=\"w-full h-full flex items-center justify-center text-lg font-semibold text-foreground\">\n                    {card.pairKey}\n                  </div>\n                )\n              ) : (\n                <div className=\"w-full h-full flex items-center justify-center text-3xl text-muted-foreground\">?</div>\n              )}\n              {card.matched && (\n                <div className=\"absolute inset-0 ring-2 ring-success/70 rounded-xl pointer-events-none\" aria-hidden=\"true\" />\n              )}\n            </button>\n          );\n        })}\n      </div>\n\n      {gameOver && (\n        <Card className=\"bg-gradient-card border-0 shadow-soft\">\n          <CardContent className=\"p-6 space-y-3\">\n            <div className=\"text-lg text-foreground\">{String(tCommon('tegn.gameComplete', { bonus: BONUS_XP }))}</div>\n            <Button onClick={setupGame}>{String(tCommon('tegn.memoryPlayAgain'))}</Button>\n          </CardContent>\n        </Card>\n      )}\n    </section>\n  );\n};\n\nexport default SignMemoryPage;\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/SignProgressPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/StudentProfile.original.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'tCommon'. Either include it or remove the dependency array.","line":202,"column":6,"nodeType":"ArrayExpression","endLine":202,"endColumn":29,"suggestions":[{"desc":"Update the dependencies array to be: [studentId, reloadData, tCommon]","fix":{"range":[8165,8188],"text":"[studentId, reloadData, tCommon]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'tCommon'. Either include it or remove the dependency array.","line":300,"column":6,"nodeType":"ArrayExpression","endLine":300,"endColumn":53,"suggestions":[{"desc":"Update the dependencies array to be: [filteredData, getInsights, student, studentId, tCommon]","fix":{"range":[11543,11590],"text":"[filteredData, getInsights, student, studentId, tCommon]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'tCommon'. Either include it or remove the dependency array.","line":361,"column":6,"nodeType":"ArrayExpression","endLine":361,"endColumn":36,"suggestions":[{"desc":"Update the dependencies array to be: [student, filteredData.entries, filteredData.emotions, filteredData.sensoryInputs, goals, tCommon]","fix":{"range":[13887,13917],"text":"[student, filteredData.entries, filteredData.emotions, filteredData.sensoryInputs, goals, tCommon]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'tCommon'. Either include it or remove the dependency array.","line":384,"column":6,"nodeType":"ArrayExpression","endLine":384,"endColumn":70,"suggestions":[{"desc":"Update the dependencies array to be: [student, trackingEntries, allEmotions, allSensoryInputs, goals, tCommon]","fix":{"range":[14782,14846],"text":"[student, trackingEntries, allEmotions, allSensoryInputs, goals, tCommon]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback, memo, useRef } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { Button } from \"@/components/ui/button\";\nimport { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { StudentProfileSidebar } from \"@/components/StudentProfileSidebar\";\nimport { DashboardSection } from \"@/components/profile-sections/DashboardSection\";\nimport { AnalyticsSection } from \"@/components/profile-sections/AnalyticsSection\";\nimport { ToolsSection } from \"@/components/profile-sections/ToolsSection\";\nimport { GoalManager } from \"@/components/GoalManager\";\nimport { ProgressDashboard } from \"@/components/ProgressDashboard\";\nimport { LazyReportBuilder } from \"@/components/lazy/LazyReportBuilder\";\nimport { ErrorBoundary } from \"@/components/ErrorBoundary\";\nimport { useDataFiltering } from \"@/hooks/useDataFiltering\";\nimport { useOptimizedInsights } from \"@/hooks/useOptimizedInsights\";\nimport { useStudentData } from \"@/hooks/useStudentData\";\nimport { Insights } from \"@/types/student\";\nimport { exportSystem } from \"@/lib/exportSystem\";\nimport { downloadBlob } from \"@/lib/utils\";\nimport { ArrowLeft, Download, Save, FileText, Calendar, Loader } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { useTranslation } from \"@/hooks/useTranslation\";\nimport { LanguageSettings } from \"@/components/LanguageSettings\";\nimport { GlobalMenu } from \"@/components/GlobalMenu\";\nimport { analyticsManager } from \"@/lib/analyticsManager\";\nimport { logger } from \"@/lib/logger\";\nimport { dataStorage } from \"@/lib/dataStorage\";\nimport { seedMinimalDemoData } from \"@/lib/mockData\";\n\n// Centralized className constants to satisfy react/jsx-no-literals for attribute strings\nconst fullScreenCenterCls = \"h-screen w-full flex items-center justify-center\";\nconst rowGap2Cls = \"flex items-center gap-2\";\nconst textMutedCls = \"text-muted-foreground\";\nconst textDestructiveCls = \"text-destructive\";\nconst pageRootCls = \"min-h-screen w-full bg-background font-dyslexia flex\";\nconst mainCls = \"flex-1 overflow-auto relative z-0\";\nconst headerCls = \"border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 sticky top-0 z-30\";\nconst headerInnerCls = \"flex h-14 items-center justify-between px-6\";\nconst flexGap3Cls = \"flex items-center gap-3\";\nconst BTN_VARIANT_GHOST = \"ghost\";\nconst BTN_VARIANT_OUTLINE = \"outline\";\nconst BTN_SIZE_SM = \"sm\";\nconst iconSmCls = \"h-4 w-4 mr-2\";\nconst containerPaddingCls = \"p-6\";\nconst spaceY6Cls = \"space-y-6\";\nconst titleCls = \"text-2xl font-bold\";\nconst centerMutedCls = \"text-center py-8 text-muted-foreground\";\nconst loaderIconCls = \"h-5 w-5 animate-spin\";\nconst reportsActionsCls = \"flex flex-wrap gap-3 p-4 bg-gradient-card rounded-lg border-0 shadow-soft\";\n\n/**\n * Memoized versions of section components to prevent unnecessary re-renders.\n * These components will only re-render if their specific props change.\n */\nconst MemoizedDashboardSection = memo(DashboardSection);\nconst MemoizedAnalyticsSection = memo(AnalyticsSection);\nconst MemoizedToolsSection = memo(ToolsSection);\nconst MemoizedGoalManager = memo(GoalManager);\nconst MemoizedProgressDashboard = memo(ProgressDashboard);\nconst MemoizedLazyReportBuilder = memo(LazyReportBuilder);\n\n/**\n * @component StudentProfile\n * \n * This is a top-level component that serves as the main profile page for a single student.\n * It orchestrates data fetching, state management, and rendering for all sub-sections\n * related to a student, such as their dashboard, analytics, goals, and reports.\n * \n * Key Responsibilities:\n * - Fetches all necessary data for a given student ID using the `useStudentData` hook.\n * - Manages the active view (e.g., dashboard, analytics) through the `activeSection` state.\n * - Handles data filtering based on date ranges.\n * - Generates AI-powered insights asynchronously.\n * - Provides functionality for data export and backup.\n * - Renders the appropriate section component based on the user's navigation.\n */\nconst StudentProfile = () => {\n  const { studentId } = useParams<{ studentId: string }>();\n  const navigate = useNavigate();\n  const { tCommon, t } = useTranslation();\n\n  // DIAGNOSTIC: Mount parameters\n  if (import.meta.env.DEV) {\n    logger.debug('[DIAGNOSTIC] StudentProfile mount', { studentId });\n  }\n\n  const {\n    student,\n    trackingEntries,\n    allEmotions,\n    allSensoryInputs,\n    goals,\n    isLoading: isLoadingStudent,\n    error: studentError,\n    reloadGoals,\n    reloadData,\n  } = useStudentData(studentId);\n\n  // DIAGNOSTIC: After data hook\n  if (import.meta.env.DEV) {\n    try {\n      logger.debug('[DIAGNOSTIC] useStudentData snapshot', {\n        hasStudent: !!student,\n        studentId,\n        studentName: student?.name,\n        trackingEntriesCount: trackingEntries?.length ?? 0,\n        emotionsCount: allEmotions?.length ?? 0,\n        sensoryInputsCount: allSensoryInputs?.length ?? 0,\n        goalsCount: goals?.length ?? 0,\n        isLoadingStudent,\n        studentError\n      });\n    } catch (_err) {\n      logger.debug('[DIAGNOSTIC] useStudentData snapshot logging failed');\n    }\n  }\n\n  // State to control which profile section is currently visible.\n  const [activeSection, setActiveSection] = useState('dashboard');\n  const handleSectionChange = useCallback((section: string) => {\n    try { logger.debug('[UI] Active section change', { from: activeSection, to: section }); } catch (_err) { void 0; }\n    setActiveSection(section);\n  }, [activeSection]);\n  \n  // Ref to guard against duplicate seeding\n  const seedingRef = useRef(false);\n  const [, setIsSeedingData] = useState(false);\n\n  // Hook for filtering tracking data by a selected date range.\n  const { selectedRange, filteredData, handleRangeChange } = useDataFiltering(\n    trackingEntries,\n    allEmotions,\n    allSensoryInputs\n  );\n\n  const { getInsights } = useOptimizedInsights(\n    filteredData.emotions,\n    filteredData.sensoryInputs,\n    filteredData.entries\n  );\n\n  // State for storing and managing the loading of AI-generated insights.\n  const [insights, setInsights] = useState<Insights | null>(null);\n  const [isLoadingInsights, setIsLoadingInsights] = useState(false);\n\n  /**\n   * Auto-seed effect for mock student routes.\n   * When navigating to /student/mock_* and storage is empty, auto-create minimal demo data.\n   */\n  useEffect(() => {\n    const seedMockDataIfNeeded = async () => {\n      // Check if the route is a mock route\n      if (!studentId?.startsWith('mock_')) {\n        return;\n      }\n\n      // Prevent duplicate seeding using ref guard\n      if (seedingRef.current) {\n        return;\n      }\n\n      // Only auto-seed when:\n      // 1) storage is empty, OR\n      // 2) this specific mock student already exists but lacks sufficient data\n      const existingStudents = dataStorage.getStudents();\n      const hasAnyStudents = existingStudents.length > 0;\n      const mockStudentExists = !!dataStorage.getStudentById(studentId);\n      const existingEntriesForMock = dataStorage.getEntriesForStudent(studentId) || [];\n      const needsSeeding = !hasAnyStudents || (mockStudentExists && existingEntriesForMock.length < 8);\n      if (!needsSeeding) {\n        return;\n      }\n\n      // Set the guard to prevent re-runs\n      seedingRef.current = true;\n      setIsSeedingData(true);\n\n      try {\n        logger.info('Auto-seeding minimal demo data for mock route', { studentId });\n        \n        // Seed minimal demo data with the provided student ID\n        await seedMinimalDemoData(studentId);\n        \n        // Dispatch custom event to notify other components\n        window.dispatchEvent(new CustomEvent('mockDataLoaded'));\n        \n        // Show non-intrusive success message\n        toast.success(String(tCommon('status.success')));\n        \n        // Reload the data to show the newly created student\n        if (reloadData) {\n          reloadData();\n        }\n      } catch (error) {\n        logger.error('Failed to auto-seed mock data', { error, studentId });\n        toast.error(String(tCommon('error.title')));\n      } finally {\n        setIsSeedingData(false);\n      }\n    };\n\n    seedMockDataIfNeeded();\n  }, [studentId, reloadData]);\n\n  // Effect to handle errors from the data fetching hook.\n  useEffect(() => {\n    if (studentError) {\n      toast.error(studentError);\n      navigate('/');\n    }\n  }, [studentError, navigate]);\n\n  /**\n   * Effect for asynchronously generating student insights.\n   * \n   * This effect runs whenever the filtered data or student context changes.\n   * It uses an `AbortController` to prevent race conditions and to cancel\n   * pending requests if the component unmounts or if dependencies change,\n   * which is a robust pattern for handling async operations in useEffect.\n   */\n  useEffect(() => {\n    const controller = new AbortController();\n    const { signal } = controller;\n\n    const generateInsights = async () => {\n      if (\n        !student ||\n        (filteredData.emotions.length === 0 &&\n          filteredData.sensoryInputs.length === 0 &&\n          filteredData.entries.length === 0)\n      ) {\n        setInsights(null);\n        return;\n      }\n\n      setIsLoadingInsights(true);\n      try {\n        const newInsights = await getInsights();\n        if (!signal.aborted) {\n          setInsights(newInsights as Insights);\n        }\n      } catch (error) {\n        if (!signal.aborted) {\n          logger.error('Error generating insights', { error });\n          setInsights(null);\n          toast.error(String(tCommon('error.title')));\n        }\n      } finally {\n        if (!signal.aborted) {\n          setIsLoadingInsights(false);\n        }\n      }\n    };\n\n    generateInsights();\n\n    // Analytics triggers with diagnostics and isolation (fail-soft)\n    try {\n      if (student) {\n        if (import.meta.env.DEV) {\n          logger.debug('[DIAGNOSTIC] analyticsManager.triggerAnalyticsForStudent start', {\n            studentId: student.id,\n            name: student.name,\n          });\n        }\n        // Do not block UI if analytics fails\n        Promise.resolve(analyticsManager.triggerAnalyticsForStudent(student))\n          .then(() => {\n            if (import.meta.env.DEV) {\n              logger.debug('[DIAGNOSTIC] analyticsManager.triggerAnalyticsForStudent done');\n            }\n          })\n          .catch((err) => {\n            logger.error('[SAFE] analyticsManager.triggerAnalyticsForStudent failed', { error: err, studentId: student.id });\n          });\n      } else if (studentId) {\n        if (import.meta.env.DEV) {\n          logger.debug('[DIAGNOSTIC] analyticsManager.initializeStudentAnalytics start', { studentId });\n        }\n        try {\n          analyticsManager.initializeStudentAnalytics(studentId);\n          if (import.meta.env.DEV) {\n            logger.debug('[DIAGNOSTIC] analyticsManager.initializeStudentAnalytics done');\n          }\n        } catch (err) {\n          logger.error('[SAFE] analyticsManager.initializeStudentAnalytics failed', { error: err, studentId });\n        }\n      }\n    } catch (err) {\n      // Extra safety net; never rethrow from analytics side-effect\n      logger.error('[SAFE] analyticsManager outer try/catch caught error', { error: err });\n    }\n\n    return () => {\n      // On cleanup, abort any pending operations to prevent memory leaks and state updates on unmounted components.\n      if (import.meta.env.DEV) {\n        logger.debug('[DIAGNOSTIC] StudentProfile cleanup: aborting controller and clearing timers if any');\n      }\n      controller.abort();\n    };\n  }, [filteredData, getInsights, student, studentId]);\n\n  /**\n   * Handles the export of student data in various formats (PDF, CSV, JSON).\n   * Wrapped in `useCallback` to ensure the function reference is stable across re-renders,\n   * preventing unnecessary re-renders of child components that might receive it as a prop.\n   */\n  const handleExportData = useCallback(async (format: 'pdf' | 'csv' | 'json') => {\n    if (!student) return;\n\n    try {\n      const baseFilename = `${student.name.replace(/\\s+/g, '_')}_${new Date().toISOString().split('T')[0]}`;\n      let blob: Blob;\n      let filename: string;\n\n      const exportOptions = {\n        trackingEntries: filteredData.entries,\n        emotions: filteredData.emotions,\n        sensoryInputs: filteredData.sensoryInputs,\n        goals,\n      };\n\n      switch (format) {\n        case 'pdf': {\n          blob = await exportSystem.generatePDFReport(student, exportOptions, {\n            format: 'pdf',\n            includeFields: ['all'],\n            includeCharts: true,\n          });\n          // Note: generatePDFReport currently returns an HTML document for printing.\n          // Use .html extension to avoid browsers trying to open it as a PDF.\n          filename = `${baseFilename}_report.html`;\n          break;\n        }\n        case 'csv': {\n          const csvContent = exportSystem.generateCSVExport([student], exportOptions, {\n            format: 'csv',\n            includeFields: ['all'],\n          });\n          blob = new Blob([csvContent], { type: 'text/csv' });\n          filename = `${baseFilename}_data.csv`;\n          break;\n        }\n        case 'json': {\n          const jsonContent = exportSystem.generateJSONExport([student], exportOptions, {\n            format: 'json',\n            includeFields: ['students', 'trackingEntries', 'emotions', 'sensoryInputs', 'goals'],\n          });\n          blob = new Blob([jsonContent], { type: 'application/json' });\n          filename = `${baseFilename}_data.json`;\n          break;\n        }\n      }\n      \n      downloadBlob(blob, filename);\n      toast.success(String(tCommon('status.success')));\n    } catch (error: unknown) {\n      logger.error('Export error', { error });\n      const errorMessage = error instanceof Error ? error.message : 'Please try again.';\n      toast.error(`Export failed: ${errorMessage}`);\n    }\n  }, [student, filteredData, goals]);\n  \n  /**\n   * Creates and triggers the download of a full backup of the student's data.\n   * Wrapped in `useCallback` for performance optimization.\n   */\n  const handleBackupData = useCallback(async () => {\n    if (!student) return;\n    try {\n      const backup = exportSystem.createFullBackup([student], {\n        trackingEntries,\n        emotions: allEmotions,\n        sensoryInputs: allSensoryInputs,\n        goals,\n      });\n      const backupBlob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });\n      const filename = `sensory_tracker_backup_${new Date().toISOString().replace(/[:.]/g, '-')}.json`;\n      downloadBlob(backupBlob, filename);\n      toast.success(String(tCommon('status.success')));\n    } catch (error) {\n      logger.error('Backup error', { error });\n      toast.error(String(tCommon('error.title')));\n    }\n  }, [student, trackingEntries, allEmotions, allSensoryInputs, goals]);\n\n  /**\n   * Callback executed after mock data has been loaded.\n   * This function calls `reloadData` from the `useStudentData` hook to refresh the UI\n   * without requiring a full page reload, providing a smoother user experience.\n   */\n\n  // Consolidated early returns to avoid duplication\n  if (isLoadingStudent) {\n    return (\n      <div className={fullScreenCenterCls}>\n        <div className={rowGap2Cls}>\n          <Loader className={loaderIconCls} />\n          <p className={textMutedCls}>{t('loading_student_data')}</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!student) {\n    return (\n      <div className={fullScreenCenterCls}>\n        <div className={rowGap2Cls}>\n          <p className={textDestructiveCls}>{t('student_not_found')}</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <SidebarProvider>\n      <div className={pageRootCls}>\n        <StudentProfileSidebar\n          student={student}\n          activeSection={activeSection}\n          onSectionChange={handleSectionChange}\n        />\n        <main className={mainCls}>\n          <header className={headerCls}>\n            <div className={headerInnerCls}>\n              <div className={flexGap3Cls}>\n                <SidebarTrigger />\n                <Button variant={BTN_VARIANT_GHOST} size={BTN_SIZE_SM} onClick={() => navigate('/')} aria-label={tCommon('aria.go_back_to_dashboard')}>\n                  <ArrowLeft className={iconSmCls} />\n                  {String(tCommon('buttons.back'))}\n                </Button>\n              </div>\n              <div className={flexGap3Cls}>\n                <GlobalMenu />\n                <LanguageSettings />\n              </div>\n            </div>\n          </header>\n          <div className={containerPaddingCls}>\n            <ErrorBoundary>\n              {/* \n                The main content is rendered conditionally based on the `activeSection` state.\n                This declarative approach is more efficient and readable than the previous `useMemo` block.\n                Each section is a memoized component, ensuring it only re-renders when its specific props change.\n              */}\n              {activeSection === 'dashboard' && (\n                <MemoizedDashboardSection\n                  student={student}\n                  trackingEntries={trackingEntries}\n                  filteredData={filteredData}\n                  selectedRange={selectedRange}\n                  onRangeChange={handleRangeChange}\n                  insights={insights}\n                  isLoadingInsights={isLoadingInsights}\n                />\n              )}\n              {activeSection === 'analytics' && (\n                <ErrorBoundary showToast={true}>\n                  <MemoizedAnalyticsSection\n                    student={student}\n                    trackingEntries={trackingEntries ?? []}\n                    filteredData={filteredData}\n                    insights={insights}\n                    isLoadingInsights={isLoadingInsights}\n                  />\n                </ErrorBoundary>\n              )}\n              {activeSection === 'goals' && (\n                <div className={spaceY6Cls}>\n                  <div>\n                    <h2 className={titleCls}>{t('goals_title')}</h2>\n                    <p className={textMutedCls}>\n                      {t('goals_description', { name: student.name })}\n                    </p>\n                  </div>\n                  <MemoizedGoalManager student={student} onGoalUpdate={reloadGoals} />\n                </div>\n              )}\n              {activeSection === 'progress' && (\n                 <div className={spaceY6Cls}>\n                   <div>\n                     <h2 className={titleCls}>{t('progress_title')}</h2>\n                     <p className={textMutedCls}>\n                       {t('progress_description', { name: student.name })}\n                     </p>\n                   </div>\n                   <MemoizedProgressDashboard student={student} goals={goals} />\n                 </div>\n              )}\n              {activeSection === 'reports' && (\n                <div className={spaceY6Cls}>\n                  <div>\n                    <h2 className={titleCls}>{t('reports_title')}</h2>\n                    <p className={textMutedCls}>\n                      {t('reports_description', { name: student.name })}\n                    </p>\n                  </div>\n                  <div className={reportsActionsCls}>\n                    <Button variant={BTN_VARIANT_OUTLINE} onClick={() => handleExportData('pdf')}>\n                      <FileText className={iconSmCls} />{t('export_pdf')}\n                    </Button>\n                    <Button variant={BTN_VARIANT_OUTLINE} onClick={() => handleExportData('csv')}>\n                      <Calendar className={iconSmCls} />{t('export_csv')}\n                    </Button>\n                    <Button variant={BTN_VARIANT_OUTLINE} onClick={() => handleExportData('json')}>\n                      <Download className={iconSmCls} />{t('export_json')}\n                    </Button>\n                    <Button variant={BTN_VARIANT_OUTLINE} onClick={handleBackupData}>\n                      <Save className={iconSmCls} />{t('create_backup')}\n                    </Button>\n                  </div>\n                  <ErrorBoundary>\n                    <MemoizedLazyReportBuilder\n                      student={student}\n                      goals={goals}\n                      trackingEntries={filteredData.entries}\n                      emotions={filteredData.emotions}\n                      sensoryInputs={filteredData.sensoryInputs}\n                    />\n                  </ErrorBoundary>\n                </div>\n              )}\n              {(activeSection === 'search' || activeSection === 'templates' || activeSection === 'compare') && (\n                 <MemoizedToolsSection\n                    student={student}\n                    trackingEntries={trackingEntries}\n                    emotions={allEmotions}\n                    sensoryInputs={allSensoryInputs}\n                    goals={goals}\n                    activeToolSection={activeSection}\n                    onToolSectionChange={setActiveSection}\n                    onSearchResults={() => {}} // This should be properly handled if search is a feature\n                  />\n              )}\n              {activeSection === 'enhanced-tracking' && (\n                  <div className={spaceY6Cls}>\n                    <div>\n                      <h2 className={titleCls}>{t('enhanced_tracking_title')}</h2>\n                      <p className={textMutedCls}>\n                        {t('enhanced_tracking_description', { name: student.name })}\n                      </p>\n                    </div>\n                    <div className={centerMutedCls}>\n                      <p>{t('enhanced_tracking_coming_soon')}</p>\n                    </div>\n                  </div>\n              )}\n            </ErrorBoundary>\n          </div>\n        </main>\n      </div>\n    </SidebarProvider>\n  );\n};\n\nexport { StudentProfile };\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/StudentProfile.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":343,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":343,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13588,13591],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13588,13591],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":344,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":344,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13655,13658],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13655,13658],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":345,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":345,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13732,13735],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13732,13735],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":356,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":356,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14047,14050],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14047,14050],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback, memo, useRef } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { Button } from \"@/components/ui/button\";\nimport { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { StudentProfileSidebar } from \"@/components/StudentProfileSidebar\";\nimport { DashboardSection } from \"@/components/profile-sections/DashboardSection\";\nimport { AnalyticsSection } from \"@/components/profile-sections/AnalyticsSection\";\nimport { ToolsSection } from \"@/components/profile-sections/ToolsSection\";\nimport { GoalManager } from \"@/components/GoalManager\";\nimport { lazy } from 'react';\nconst ProgressDashboard = lazy(() => import(\"@/components/ProgressDashboard\").then(m => ({ default: m.ProgressDashboard })));\nimport { LazyReportBuilder } from \"@/components/lazy/LazyReportBuilder\";\nimport { ErrorBoundary } from \"@/components/ErrorBoundary\";\nimport { useDataFiltering } from \"@/hooks/useDataFiltering\";\nimport { useOptimizedInsights } from \"@/hooks/useOptimizedInsights\";\nimport { useStudentData } from \"@/hooks/useStudentData\";\nimport { Insights } from \"@/types/student\";\nimport { exportSystem } from \"@/lib/exportSystem\";\nimport { analyticsExport, type AnalyticsExportData } from \"@/lib/analyticsExport\";\nimport { downloadBlob } from \"@/lib/utils\";\nimport { ArrowLeft, Download, Save, FileText, Calendar, Loader } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { useTranslation } from \"@/hooks/useTranslation\";\nimport { LanguageSettings } from \"@/components/LanguageSettings\";\nimport { GlobalMenu } from \"@/components/GlobalMenu\";\nimport { analyticsManager } from \"@/lib/analyticsManager\";\nimport { logger } from \"@/lib/logger\";\nimport { dataStorage } from \"@/lib/dataStorage\";\nimport { seedMinimalDemoData } from \"@/lib/mockData\";\n\n// Centralized className constants to satisfy react/jsx-no-literals for attribute strings\nconst fullScreenCenterCls = \"h-screen w-full flex items-center justify-center\";\nconst rowGap2Cls = \"flex items-center gap-2\";\nconst textMutedCls = \"text-muted-foreground\";\nconst textDestructiveCls = \"text-destructive\";\nconst pageRootCls = \"min-h-screen w-full bg-background font-dyslexia flex\";\nconst mainCls = \"flex-1 overflow-auto relative z-0\";\nconst headerCls = \"border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 sticky top-0 z-30\";\nconst headerInnerCls = \"flex h-14 items-center justify-between px-6\";\nconst flexGap3Cls = \"flex items-center gap-3\";\nconst BTN_VARIANT_GHOST = \"ghost\";\nconst BTN_VARIANT_OUTLINE = \"outline\";\nconst BTN_SIZE_SM = \"sm\";\nconst iconSmCls = \"h-4 w-4 mr-2\";\nconst containerPaddingCls = \"p-6\";\nconst spaceY6Cls = \"space-y-6\";\nconst titleCls = \"text-2xl font-bold\";\nconst centerMutedCls = \"text-center py-8 text-muted-foreground\";\nconst loaderIconCls = \"h-5 w-5 animate-spin\";\nconst reportsActionsCls = \"flex flex-wrap gap-3 p-4 bg-gradient-card rounded-lg border-0 shadow-soft\";\n\n/**\n * Memoized versions of section components to prevent unnecessary re-renders.\n * These components will only re-render if their specific props change.\n */\nconst MemoizedDashboardSection = memo(DashboardSection);\nconst MemoizedAnalyticsSection = memo(AnalyticsSection);\nconst MemoizedToolsSection = memo(ToolsSection);\nconst MemoizedGoalManager = memo(GoalManager);\nconst MemoizedProgressDashboard = memo(ProgressDashboard);\nconst MemoizedLazyReportBuilder = memo(LazyReportBuilder);\n\n/**\n * @component StudentProfile\n * \n * This is a top-level component that serves as the main profile page for a single student.\n * It orchestrates data fetching, state management, and rendering for all sub-sections\n * related to a student, such as their dashboard, analytics, goals, and reports.\n * \n * Key Responsibilities:\n * - Fetches all necessary data for a given student ID using the `useStudentData` hook.\n * - Manages the active view (e.g., dashboard, analytics) through the `activeSection` state.\n * - Handles data filtering based on date ranges.\n * - Generates AI-powered insights asynchronously.\n * - Provides functionality for data export and backup.\n * - Renders the appropriate section component based on the user's navigation.\n */\nconst StudentProfile = () => {\n  const { studentId } = useParams<{ studentId: string }>();\n  const navigate = useNavigate();\n  const { tCommon, t } = useTranslation();\n\n  // DIAGNOSTIC: Mount parameters\n  if (import.meta.env.DEV) {\n    logger.debug('[DIAGNOSTIC] StudentProfile mount', { studentId });\n  }\n\n  const {\n    student,\n    trackingEntries,\n    allEmotions,\n    allSensoryInputs,\n    goals,\n    isLoading: isLoadingStudent,\n    error: studentError,\n    reloadGoals,\n    reloadData,\n  } = useStudentData(studentId);\n\n  // DIAGNOSTIC: After data hook\n  if (import.meta.env.DEV) {\n    try {\n      logger.debug('[DIAGNOSTIC] useStudentData snapshot', {\n        hasStudent: !!student,\n        studentId,\n        studentName: student?.name,\n        trackingEntriesCount: trackingEntries?.length ?? 0,\n        emotionsCount: allEmotions?.length ?? 0,\n        sensoryInputsCount: allSensoryInputs?.length ?? 0,\n        goalsCount: goals?.length ?? 0,\n        isLoadingStudent,\n        studentError\n      });\n    } catch (_err) {\n      logger.debug('[DIAGNOSTIC] useStudentData snapshot logging failed');\n    }\n  }\n\n  // State to control which profile section is currently visible.\n  const [activeSection, setActiveSection] = useState('dashboard');\n  const handleSectionChange = useCallback((section: string) => {\n    try { logger.debug('[UI] Active section change', { from: activeSection, to: section }); } catch (_err) { void 0; }\n    setActiveSection(section);\n  }, [activeSection]);\n  \n  // Ref to guard against duplicate seeding\n  const seedingRef = useRef(false);\n  const [, setIsSeedingData] = useState(false);\n\n  // Hook for filtering tracking data by a selected date range.\n  const { selectedRange, filteredData, handleRangeChange } = useDataFiltering(\n    trackingEntries,\n    allEmotions,\n    allSensoryInputs\n  );\n\n  const { getInsights } = useOptimizedInsights(\n    filteredData.emotions,\n    filteredData.sensoryInputs,\n    filteredData.entries\n  );\n\n  // State for storing and managing the loading of AI-generated insights.\n  const [insights, setInsights] = useState<Insights | null>(null);\n  const [isLoadingInsights, setIsLoadingInsights] = useState(false);\n\n  /**\n   * Auto-seed effect for mock student routes.\n   * When navigating to /student/mock_* and storage is empty, auto-create minimal demo data.\n   */\n  useEffect(() => {\n    const seedMockDataIfNeeded = async () => {\n      // Check if the route is a mock route\n      if (!studentId?.startsWith('mock_')) {\n        return;\n      }\n\n      // Prevent duplicate seeding using ref guard\n      if (seedingRef.current) {\n        return;\n      }\n\n      // Only auto-seed when:\n      // 1) storage is empty, OR\n      // 2) this specific mock student already exists but lacks sufficient data\n      const existingStudents = dataStorage.getStudents();\n      const hasAnyStudents = existingStudents.length > 0;\n      const mockStudentExists = !!dataStorage.getStudentById(studentId);\n      const existingEntriesForMock = dataStorage.getEntriesForStudent(studentId) || [];\n      const needsSeeding = !hasAnyStudents || (mockStudentExists && existingEntriesForMock.length < 8);\n      if (!needsSeeding) {\n        return;\n      }\n\n      // Set the guard to prevent re-runs\n      seedingRef.current = true;\n      setIsSeedingData(true);\n\n      try {\n        logger.info('Auto-seeding minimal demo data for mock route', { studentId });\n        \n        // Seed minimal demo data with the provided student ID\n        await seedMinimalDemoData(studentId);\n        \n        // Dispatch custom event to notify other components\n        window.dispatchEvent(new CustomEvent('mockDataLoaded'));\n        \n        // Show non-intrusive success message\n        toast.success('Demo data created successfully', {\n          description: 'Sample data has been generated for demonstration purposes',\n        });\n        \n        // Reload the data to show the newly created student\n        if (reloadData) {\n          reloadData();\n        }\n      } catch (error) {\n        logger.error('Failed to auto-seed mock data', { error, studentId });\n        toast.error('Failed to create demo data', {\n          description: 'Please try loading mock data manually',\n        });\n      } finally {\n        setIsSeedingData(false);\n      }\n    };\n\n    seedMockDataIfNeeded();\n  }, [studentId, reloadData]);\n\n  // Effect to handle errors from the data fetching hook.\n  useEffect(() => {\n    if (studentError) {\n      toast.error(studentError);\n      navigate('/');\n    }\n  }, [studentError, navigate]);\n\n  /**\n   * Effect for asynchronously generating student insights.\n   * \n   * This effect runs whenever the filtered data or student context changes.\n   * It uses an `AbortController` to prevent race conditions and to cancel\n   * pending requests if the component unmounts or if dependencies change,\n   * which is a robust pattern for handling async operations in useEffect.\n   */\n  useEffect(() => {\n    const controller = new AbortController();\n    const { signal } = controller;\n\n    const generateInsights = async () => {\n      if (\n        !student ||\n        (filteredData.emotions.length === 0 &&\n          filteredData.sensoryInputs.length === 0 &&\n          filteredData.entries.length === 0)\n      ) {\n        setInsights(null);\n        return;\n      }\n\n      setIsLoadingInsights(true);\n      try {\n        const newInsights = await getInsights();\n        if (!signal.aborted) {\n          setInsights(newInsights as Insights);\n        }\n      } catch (error) {\n        if (!signal.aborted) {\n          logger.error('Error generating insights', { error });\n          setInsights(null);\n          toast.error('Failed to generate insights');\n        }\n      } finally {\n        if (!signal.aborted) {\n          setIsLoadingInsights(false);\n        }\n      }\n    };\n\n    generateInsights();\n\n    // Analytics triggers with diagnostics and isolation (fail-soft)\n    try {\n      if (student) {\n        if (import.meta.env.DEV) {\n          logger.debug('[DIAGNOSTIC] analyticsManager.triggerAnalyticsForStudent start', {\n            studentId: student.id,\n            name: student.name,\n          });\n        }\n        // Do not block UI if analytics fails\n        Promise.resolve(analyticsManager.triggerAnalyticsForStudent(student))\n          .then(() => {\n            if (import.meta.env.DEV) {\n              logger.debug('[DIAGNOSTIC] analyticsManager.triggerAnalyticsForStudent done');\n            }\n          })\n          .catch((err) => {\n            logger.error('[SAFE] analyticsManager.triggerAnalyticsForStudent failed', { error: err, studentId: student.id });\n          });\n      } else if (studentId) {\n        if (import.meta.env.DEV) {\n          logger.debug('[DIAGNOSTIC] analyticsManager.initializeStudentAnalytics start', { studentId });\n        }\n        try {\n          analyticsManager.initializeStudentAnalytics(studentId);\n          if (import.meta.env.DEV) {\n            logger.debug('[DIAGNOSTIC] analyticsManager.initializeStudentAnalytics done');\n          }\n        } catch (err) {\n          logger.error('[SAFE] analyticsManager.initializeStudentAnalytics failed', { error: err, studentId });\n        }\n      }\n    } catch (err) {\n      // Extra safety net; never rethrow from analytics side-effect\n      logger.error('[SAFE] analyticsManager outer try/catch caught error', { error: err });\n    }\n\n    return () => {\n      // On cleanup, abort any pending operations to prevent memory leaks and state updates on unmounted components.\n      if (import.meta.env.DEV) {\n        logger.debug('[DIAGNOSTIC] StudentProfile cleanup: aborting controller and clearing timers if any');\n      }\n      controller.abort();\n    };\n  }, [filteredData, getInsights, student, studentId]);\n\n  /**\n   * Handles the export of student data in various formats (PDF, CSV, JSON).\n   * Wrapped in `useCallback` to ensure the function reference is stable across re-renders,\n   * preventing unnecessary re-renders of child components that might receive it as a prop.\n   */\n  const handleExportData = useCallback(async (format: 'pdf' | 'csv' | 'json') => {\n    if (!student) return;\n\n    try {\n      const baseFilename = `${student.name.replace(/\\s+/g, '_')}_${new Date().toISOString().split('T')[0]}`;\n      let blob: Blob;\n      let filename: string;\n\n      const exportOptions = {\n        trackingEntries: filteredData.entries,\n        emotions: filteredData.emotions,\n        sensoryInputs: filteredData.sensoryInputs,\n        goals,\n      };\n\n      switch (format) {\n        case 'pdf': {\n          // Consolidated PDF: build AnalyticsExportData and delegate to analyticsExport\n          const allDates: Date[] = [\n            ...filteredData.entries.map(t => t.timestamp as unknown as Date),\n            ...filteredData.emotions.map(e => (e as unknown as { timestamp: Date }).timestamp),\n            ...filteredData.sensoryInputs.map(s => (s as unknown as { timestamp: Date }).timestamp),\n          ];\n          const start = allDates.length ? new Date(Math.min(...allDates.map(d => d.getTime()))) : new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);\n          const end = allDates.length ? new Date(Math.max(...allDates.map(d => d.getTime()))) : new Date();\n\n          const exportData: AnalyticsExportData = {\n            student,\n            dateRange: { start, end },\n            data: {\n              entries: filteredData.entries as unknown as any[],\n              emotions: filteredData.emotions as unknown as any[],\n              sensoryInputs: filteredData.sensoryInputs as unknown as any[],\n            },\n            analytics: {\n              patterns: [],\n              correlations: [],\n              insights: [],\n              predictiveInsights: [],\n              anomalies: [],\n            },\n          } as unknown as AnalyticsExportData;\n\n          await analyticsExport.exportTo('pdf' as any, exportData);\n          toast.success('Report exported as PDF');\n          return;\n        }\n        case 'csv': {\n          const csvContent = exportSystem.generateCSVExport([student], exportOptions, {\n            format: 'csv',\n            includeFields: ['all'],\n          });\n          blob = new Blob([csvContent], { type: 'text/csv' });\n          filename = `${baseFilename}_data.csv`;\n          break;\n        }\n        case 'json': {\n          const jsonContent = exportSystem.generateJSONExport([student], exportOptions, {\n            format: 'json',\n            includeFields: ['students', 'trackingEntries', 'emotions', 'sensoryInputs', 'goals'],\n          });\n          blob = new Blob([jsonContent], { type: 'application/json' });\n          filename = `${baseFilename}_data.json`;\n          break;\n        }\n      }\n      \n      downloadBlob(blob, filename);\n      toast.success(`Data exported successfully as ${format.toUpperCase()}`);\n    } catch (error: unknown) {\n      logger.error('Export error', { error });\n      const errorMessage = error instanceof Error ? error.message : 'Please try again.';\n      toast.error(`Export failed: ${errorMessage}`);\n    }\n  }, [student, filteredData, goals]);\n  \n  /**\n   * Creates and triggers the download of a full backup of the student's data.\n   * Wrapped in `useCallback` for performance optimization.\n   */\n  const handleBackupData = useCallback(async () => {\n    if (!student) return;\n    try {\n      const backup = exportSystem.createFullBackup([student], {\n        trackingEntries,\n        emotions: allEmotions,\n        sensoryInputs: allSensoryInputs,\n        goals,\n      });\n      const backupBlob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });\n      const filename = `sensory_tracker_backup_${new Date().toISOString().replace(/[:.]/g, '-')}.json`;\n      downloadBlob(backupBlob, filename);\n      toast.success('Backup created successfully');\n    } catch (error) {\n      logger.error('Backup error', { error });\n      toast.error('Backup failed. Please try again.');\n    }\n  }, [student, trackingEntries, allEmotions, allSensoryInputs, goals]);\n\n  /**\n   * Callback executed after mock data has been loaded.\n   * This function calls `reloadData` from the `useStudentData` hook to refresh the UI\n   * without requiring a full page reload, providing a smoother user experience.\n   */\n\n  // Consolidated early returns to avoid duplication\n  if (isLoadingStudent) {\n    return (\n      <div className={fullScreenCenterCls}>\n        <div className={rowGap2Cls}>\n          <Loader className={loaderIconCls} />\n          <p className={textMutedCls}>{t('loading_student_data')}</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!student) {\n    return (\n      <div className={fullScreenCenterCls}>\n        <div className={rowGap2Cls}>\n          <p className={textDestructiveCls}>{t('student_not_found')}</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <SidebarProvider>\n      <div className={pageRootCls}>\n        <StudentProfileSidebar\n          student={student}\n          activeSection={activeSection}\n          onSectionChange={handleSectionChange}\n        />\n        <main className={mainCls}>\n          <header className={headerCls}>\n            <div className={headerInnerCls}>\n              <div className={flexGap3Cls}>\n                <SidebarTrigger />\n                <Button variant={BTN_VARIANT_GHOST} size={BTN_SIZE_SM} onClick={() => navigate('/')} aria-label={tCommon('aria.go_back_to_dashboard')}>\n                  <ArrowLeft className={iconSmCls} />\n                  {String(tCommon('buttons.back'))}\n                </Button>\n              </div>\n              <div className={flexGap3Cls}>\n                <GlobalMenu />\n                <LanguageSettings />\n              </div>\n            </div>\n          </header>\n          <div className={containerPaddingCls}>\n            <ErrorBoundary>\n              {/* \n                The main content is rendered conditionally based on the `activeSection` state.\n                This declarative approach is more efficient and readable than the previous `useMemo` block.\n                Each section is a memoized component, ensuring it only re-renders when its specific props change.\n              */}\n              {activeSection === 'dashboard' && (\n                <MemoizedDashboardSection\n                  student={student}\n                  trackingEntries={trackingEntries}\n                  filteredData={filteredData}\n                  selectedRange={selectedRange}\n                  onRangeChange={handleRangeChange}\n                  insights={insights}\n                  isLoadingInsights={isLoadingInsights}\n                />\n              )}\n              {activeSection === 'analytics' && (\n                <ErrorBoundary showToast={true}>\n                  <MemoizedAnalyticsSection\n                    student={student}\n                    trackingEntries={trackingEntries ?? []}\n                    filteredData={filteredData}\n                    insights={insights}\n                    isLoadingInsights={isLoadingInsights}\n                  />\n                </ErrorBoundary>\n              )}\n              {activeSection === 'goals' && (\n                <div className={spaceY6Cls}>\n                  <div>\n                    <h2 className={titleCls}>{t('goals_title')}</h2>\n                    <p className={textMutedCls}>\n                      {t('goals_description', { name: student.name })}\n                    </p>\n                  </div>\n                  <MemoizedGoalManager student={student} onGoalUpdate={reloadGoals} />\n                </div>\n              )}\n              {activeSection === 'progress' && (\n                 <div className={spaceY6Cls}>\n                   <div>\n                     <h2 className={titleCls}>{t('progress_title')}</h2>\n                     <p className={textMutedCls}>\n                       {t('progress_description', { name: student.name })}\n                     </p>\n                   </div>\n                   <MemoizedProgressDashboard student={student} goals={goals} />\n                 </div>\n              )}\n              {activeSection === 'reports' && (\n                <div className={spaceY6Cls}>\n                  <div>\n                    <h2 className={titleCls}>{t('reports_title')}</h2>\n                    <p className={textMutedCls}>\n                      {t('reports_description', { name: student.name })}\n                    </p>\n                  </div>\n                  <div className={reportsActionsCls}>\n                    <Button variant={BTN_VARIANT_OUTLINE} onClick={() => handleExportData('pdf')}>\n                      <FileText className={iconSmCls} />{t('export_pdf')}\n                    </Button>\n                    <Button variant={BTN_VARIANT_OUTLINE} onClick={() => handleExportData('csv')}>\n                      <Calendar className={iconSmCls} />{t('export_csv')}\n                    </Button>\n                    <Button variant={BTN_VARIANT_OUTLINE} onClick={() => handleExportData('json')}>\n                      <Download className={iconSmCls} />{t('export_json')}\n                    </Button>\n                    <Button variant={BTN_VARIANT_OUTLINE} onClick={handleBackupData}>\n                      <Save className={iconSmCls} />{t('create_backup')}\n                    </Button>\n                  </div>\n                  <ErrorBoundary>\n                    <MemoizedLazyReportBuilder\n                      student={student}\n                      goals={goals}\n                      trackingEntries={filteredData.entries}\n                      emotions={filteredData.emotions}\n                      sensoryInputs={filteredData.sensoryInputs}\n                    />\n                  </ErrorBoundary>\n                </div>\n              )}\n              {(activeSection === 'search' || activeSection === 'templates' || activeSection === 'compare') && (\n                 <MemoizedToolsSection\n                    student={student}\n                    trackingEntries={trackingEntries}\n                    emotions={allEmotions}\n                    sensoryInputs={allSensoryInputs}\n                    goals={goals}\n                    activeToolSection={activeSection}\n                    onToolSectionChange={setActiveSection}\n                    onSearchResults={() => {}} // This should be properly handled if search is a feature\n                  />\n              )}\n              {activeSection === 'enhanced-tracking' && (\n                  <div className={spaceY6Cls}>\n                    <div>\n                      <h2 className={titleCls}>{t('enhanced_tracking_title')}</h2>\n                      <p className={textMutedCls}>\n                        {t('enhanced_tracking_description', { name: student.name })}\n                      </p>\n                    </div>\n                    <div className={centerMutedCls}>\n                      <p>{t('enhanced_tracking_coming_soon')}</p>\n                    </div>\n                  </div>\n              )}\n            </ErrorBoundary>\n          </div>\n        </main>\n      </div>\n    </SidebarProvider>\n  );\n};\n\nexport { StudentProfile };\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/StudentProfileOptimized.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Download' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Save' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'FileText' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":45},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Calendar' is defined but never used. Allowed unused vars must match /^_/u.","line":12,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":12,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MemoizedToolsSection' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":37,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":27},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MemoizedGoalManager' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":38,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MemoizedProgressDashboard' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":39,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'MemoizedLazyReportBuilder' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":40,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":40,"endColumn":32},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'BTN_VARIANT_OUTLINE' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":53,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":53,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'spaceY6Cls' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":57,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":57,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'titleCls' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":58,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":58,"endColumn":15},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'centerMutedCls' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":59,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":59,"endColumn":21},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'reportsActionsCls' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":61,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":61,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'studentError' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":75,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":75,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'reloadGoals' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":76,"column":5,"nodeType":null,"messageId":"unusedVar","endLine":76,"endColumn":16},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'handleExportData' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":166,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":166,"endColumn":25},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":192,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":195,"endColumn":14,"suggestions":[{"messageId":"addBrackets","fix":{"range":[7756,8039],"text":"{ const csvContent = exportSystem.generateCSVExport([student], exportOptions, {\n            format: 'csv',\n            includeFields: ['all'],\n          });\n          blob = new Blob([csvContent], { type: 'text/csv' });\n          filename = `${baseFilename}_data.csv`;\n          break; }"},"desc":"Add {} brackets around the case block."}]},{"ruleId":"no-case-declarations","severity":1,"message":"Unexpected lexical declaration in case block.","line":200,"column":11,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":203,"endColumn":14,"suggestions":[{"messageId":"addBrackets","fix":{"range":[8071,8429],"text":"{ const jsonContent = exportSystem.generateJSONExport([student], exportOptions, {\n            format: 'json',\n            includeFields: ['students', 'trackingEntries', 'emotions', 'sensoryInputs', 'goals'],\n          });\n          blob = new Blob([jsonContent], { type: 'application/json' });\n          filename = `${baseFilename}_data.json`;\n          break; }"},"desc":"Add {} brackets around the case block."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":18,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback, memo, useRef, lazy, Suspense } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { Button } from \"@/components/ui/button\";\nimport { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { StudentProfileSidebar } from \"@/components/StudentProfileSidebar\";\nimport { ErrorBoundary } from \"@/components/ErrorBoundary\";\nimport { useDataFiltering } from \"@/hooks/useDataFiltering\";\nimport { useOptimizedInsights } from \"@/hooks/useOptimizedInsights\";\nimport { useStudentData } from \"@/hooks/useStudentData\";\nimport { Insights } from \"@/types/student\";\nimport { downloadBlob } from \"@/lib/utils\";\nimport { ArrowLeft, Download, Save, FileText, Calendar, Loader } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { useTranslation } from \"@/hooks/useTranslation\";\nimport { LanguageSettings } from \"@/components/LanguageSettings\";\nimport { GlobalMenu } from \"@/components/GlobalMenu\";\n// Use the lightweight version for initial load\nimport { analyticsManager } from \"@/lib/analyticsManagerLite\";\nimport { logger } from \"@/lib/logger\";\nimport { dataStorage } from \"@/lib/dataStorage\";\n\n// Lazy load heavy components\nconst DashboardSection = lazy(() => import(\"@/components/profile-sections/DashboardSection\").then(m => ({ default: m.DashboardSection })));\nconst AnalyticsSection = lazy(() => import(\"@/components/profile-sections/AnalyticsSection\").then(m => ({ default: m.AnalyticsSection })));\nconst ToolsSection = lazy(() => import(\"@/components/profile-sections/ToolsSection\").then(m => ({ default: m.ToolsSection })));\nconst GoalManager = lazy(() => import(\"@/components/GoalManager\").then(m => ({ default: m.GoalManager })));\nconst ProgressDashboard = lazy(() => import(\"@/components/ProgressDashboard\").then(m => ({ default: m.ProgressDashboard })));\nconst LazyReportBuilder = lazy(() => import(\"@/components/lazy/LazyReportBuilder\").then(m => ({ default: m.LazyReportBuilder })));\n\n// Lazy load export system to reduce initial bundle\nconst loadExportSystem = () => import(\"@/lib/exportSystem\").then(m => m.exportSystem);\nconst loadSeedData = () => import(\"@/lib/mockData\").then(m => m.seedMinimalDemoData);\n\n// Memoized versions of section components\nconst MemoizedDashboardSection = memo(DashboardSection);\nconst MemoizedAnalyticsSection = memo(AnalyticsSection);\nconst MemoizedToolsSection = memo(ToolsSection);\nconst MemoizedGoalManager = memo(GoalManager);\nconst MemoizedProgressDashboard = memo(ProgressDashboard);\nconst MemoizedLazyReportBuilder = memo(LazyReportBuilder);\n\n// CSS class constants\nconst fullScreenCenterCls = \"h-screen w-full flex items-center justify-center\";\nconst rowGap2Cls = \"flex items-center gap-2\";\nconst textMutedCls = \"text-muted-foreground\";\nconst textDestructiveCls = \"text-destructive\";\nconst pageRootCls = \"min-h-screen w-full bg-background font-dyslexia flex\";\nconst mainCls = \"flex-1 overflow-auto relative z-0\";\nconst headerCls = \"border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 sticky top-0 z-30\";\nconst headerInnerCls = \"flex h-14 items-center justify-between px-6\";\nconst flexGap3Cls = \"flex items-center gap-3\";\nconst BTN_VARIANT_GHOST = \"ghost\";\nconst BTN_VARIANT_OUTLINE = \"outline\";\nconst BTN_SIZE_SM = \"sm\";\nconst iconSmCls = \"h-4 w-4 mr-2\";\nconst containerPaddingCls = \"p-6\";\nconst spaceY6Cls = \"space-y-6\";\nconst titleCls = \"text-2xl font-bold\";\nconst centerMutedCls = \"text-center py-8 text-muted-foreground\";\nconst loaderIconCls = \"h-5 w-5 animate-spin\";\nconst reportsActionsCls = \"flex flex-wrap gap-3 p-4 bg-gradient-card rounded-lg border-0 shadow-soft\";\n\nconst StudentProfileOptimized = () => {\n  const { studentId } = useParams<{ studentId: string }>();\n  const navigate = useNavigate();\n  const { tCommon, t } = useTranslation();\n\n  const {\n    student,\n    trackingEntries,\n    allEmotions,\n    allSensoryInputs,\n    goals,\n    isLoading: isLoadingStudent,\n    error: studentError,\n    reloadGoals,\n    reloadData,\n  } = useStudentData(studentId);\n\n  const [activeSection, setActiveSection] = useState('dashboard');\n  const handleSectionChange = useCallback((section: string) => {\n    setActiveSection(section);\n  }, []);\n  \n  const seedingRef = useRef(false);\n  const [, setIsSeedingData] = useState(false);\n\n  const { selectedRange, filteredData, handleRangeChange } = useDataFiltering(\n    trackingEntries,\n    allEmotions,\n    allSensoryInputs\n  );\n\n  const { getInsights } = useOptimizedInsights(\n    filteredData.emotions,\n    filteredData.sensoryInputs,\n    filteredData.entries\n  );\n\n  const [insights, setInsights] = useState<Insights | null>(null);\n  const [isLoadingInsights, setIsLoadingInsights] = useState(false);\n\n  // Auto-seed for mock routes (lazy-loaded)\n  useEffect(() => {\n    const seedMockDataIfNeeded = async () => {\n      if (!studentId?.startsWith('mock_') || seedingRef.current) return;\n\n      const existingStudents = dataStorage.getStudents();\n      const hasAnyStudents = existingStudents.length > 0;\n      const mockStudentExists = !!dataStorage.getStudentById(studentId);\n      const existingEntriesForMock = dataStorage.getEntriesForStudent(studentId) || [];\n      const needsSeeding = !hasAnyStudents || (mockStudentExists && existingEntriesForMock.length < 8);\n      \n      if (!needsSeeding) return;\n\n      seedingRef.current = true;\n      setIsSeedingData(true);\n\n      try {\n        const seedMinimalDemoData = await loadSeedData();\n        await seedMinimalDemoData(studentId);\n        window.dispatchEvent(new CustomEvent('mockDataLoaded'));\n        toast.success('Demo data created successfully');\n        if (reloadData) reloadData();\n      } catch (error) {\n        logger.error('Failed to auto-seed mock data', { error, studentId });\n        toast.error('Failed to create demo data');\n      } finally {\n        setIsSeedingData(false);\n      }\n    };\n\n    seedMockDataIfNeeded();\n  }, [studentId, reloadData]);\n\n  // Lightweight analytics initialization\n  useEffect(() => {\n    if (student) {\n      // Use lightweight manager for initial setup\n      analyticsManager.initializeStudentAnalytics(student.id);\n      \n      // Defer full analytics to avoid blocking\n      const controller = new AbortController();\n      \n      (async () => {\n        if (filteredData.emotions.length > 0 || filteredData.sensoryInputs.length > 0) {\n          try {\n            setIsLoadingInsights(true);\n            const newInsights = await getInsights();\n            if (!controller.signal.aborted) {\n              setInsights(newInsights);\n            }\n          } catch (error) {\n            logger.error('Failed to get insights', { error });\n          } finally {\n            setIsLoadingInsights(false);\n          }\n        }\n      })();\n\n      return () => controller.abort();\n    }\n  }, [filteredData, getInsights, student, studentId]);\n\n  // Lazy-loaded export handlers\n  const handleExportData = useCallback(async (format: 'pdf' | 'csv' | 'json') => {\n    if (!student) return;\n\n    try {\n      const exportSystem = await loadExportSystem();\n      const baseFilename = `${student.name.replace(/\\s+/g, '_')}_${new Date().toISOString().split('T')[0]}`;\n      let blob: Blob;\n      let filename: string;\n\n      const exportOptions = {\n        trackingEntries: filteredData.entries,\n        emotions: filteredData.emotions,\n        sensoryInputs: filteredData.sensoryInputs,\n        goals,\n      };\n\n      switch (format) {\n        case 'pdf':\n          blob = await exportSystem.generatePDFReport(student, exportOptions, {\n            format: 'pdf',\n            includeFields: ['all'],\n            includeCharts: true,\n          });\n          filename = `${baseFilename}_report.html`;\n          break;\n        case 'csv':\n          const csvContent = exportSystem.generateCSVExport([student], exportOptions, {\n            format: 'csv',\n            includeFields: ['all'],\n          });\n          blob = new Blob([csvContent], { type: 'text/csv' });\n          filename = `${baseFilename}_data.csv`;\n          break;\n        case 'json':\n          const jsonContent = exportSystem.generateJSONExport([student], exportOptions, {\n            format: 'json',\n            includeFields: ['students', 'trackingEntries', 'emotions', 'sensoryInputs', 'goals'],\n          });\n          blob = new Blob([jsonContent], { type: 'application/json' });\n          filename = `${baseFilename}_data.json`;\n          break;\n      }\n      \n      downloadBlob(blob, filename);\n      toast.success(`Data exported successfully as ${format.toUpperCase()}`);\n    } catch (error) {\n      logger.error('Export error', { error });\n      toast.error(`Export failed: ${error instanceof Error ? error.message : 'Please try again.'}`);\n    }\n  }, [student, filteredData, goals]);\n\n  if (isLoadingStudent) {\n    return (\n      <div className={fullScreenCenterCls}>\n        <div className={rowGap2Cls}>\n          <Loader className={loaderIconCls} />\n          <p className={textMutedCls}>{t('loading_student_data')}</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!student) {\n    return (\n      <div className={fullScreenCenterCls}>\n        <div className={rowGap2Cls}>\n          <p className={textDestructiveCls}>{t('student_not_found')}</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <SidebarProvider>\n      <div className={pageRootCls}>\n        <StudentProfileSidebar\n          student={student}\n          activeSection={activeSection}\n          onSectionChange={handleSectionChange}\n        />\n        <main className={mainCls}>\n          <header className={headerCls}>\n            <div className={headerInnerCls}>\n              <div className={flexGap3Cls}>\n                <SidebarTrigger />\n                <Button variant={BTN_VARIANT_GHOST} size={BTN_SIZE_SM} onClick={() => navigate('/')}>\n                  <ArrowLeft className={iconSmCls} />\n                  {String(tCommon('buttons.back'))}\n                </Button>\n              </div>\n              <div className={flexGap3Cls}>\n                <GlobalMenu />\n                <LanguageSettings />\n              </div>\n            </div>\n          </header>\n          <div className={containerPaddingCls}>\n            <ErrorBoundary>\n              <Suspense fallback={\n                <div className=\"flex items-center justify-center h-64\">\n                  <Loader className=\"h-8 w-8 animate-spin\" />\n                </div>\n              }>\n                {activeSection === 'dashboard' && (\n                  <MemoizedDashboardSection\n                    student={student}\n                    trackingEntries={trackingEntries}\n                    filteredData={filteredData}\n                    selectedRange={selectedRange}\n                    onRangeChange={handleRangeChange}\n                    insights={insights}\n                    isLoadingInsights={isLoadingInsights}\n                  />\n                )}\n                {activeSection === 'analytics' && (\n                  <ErrorBoundary showToast={true}>\n                    <MemoizedAnalyticsSection\n                      student={student}\n                      trackingEntries={trackingEntries ?? []}\n                      filteredData={filteredData}\n                      insights={insights}\n                      isLoadingInsights={isLoadingInsights}\n                    />\n                  </ErrorBoundary>\n                )}\n                {/* Other sections remain similar but wrapped in Suspense */}\n              </Suspense>\n            </ErrorBoundary>\n          </div>\n        </main>\n      </div>\n    </SidebarProvider>\n  );\n};\n\nexport { StudentProfileOptimized as StudentProfile };\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/TegnLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/TegnTilTaleMenu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/pages/TrackStudent.tsx","messages":[{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"...\"","line":120,"column":83,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":120,"endColumn":86},{"ruleId":"react/jsx-no-literals","severity":1,"message":"Strings not allowed in JSX files: \"Record emotions and sensory responses for this session\"","line":154,"column":48,"nodeType":"JSXText","messageId":"noStringsInJSX","endLine":156,"endColumn":11},{"ruleId":"i18next/no-literal-string","severity":1,"message":"disallow literal string: <p className=\"text-muted-foreground\">\n            Record emotions and sensory responses for this session\n          </p>","line":154,"column":48,"nodeType":"JSXText","endLine":156,"endColumn":11}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { Button } from \"@/components/ui/button\";\nimport { EmotionTracker } from \"@/components/EmotionTracker\";\nimport { SensoryTracker } from \"@/components/SensoryTracker\";\nimport { EnvironmentalTracker } from \"@/components/EnvironmentalTracker\";\nimport { Student, EmotionEntry, SensoryEntry, TrackingEntry, EnvironmentalEntry } from \"@/types/student\";\nimport { ArrowLeft, Save, User } from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { useTranslation } from \"@/hooks/useTranslation\";\nimport { LanguageSettings } from \"@/components/LanguageSettings\";\nimport { analyticsManager } from \"@/lib/analyticsManager\";\nimport { logger } from \"@/lib/logger\";\n\nconst TrackStudent = () => {\n  const { studentId } = useParams();\n  const navigate = useNavigate();\n  const [student, setStudent] = useState<Student | null>(null);\n  const [emotions, setEmotions] = useState<Omit<EmotionEntry, 'id' | 'timestamp'>[]>([]);\n  const [sensoryInputs, setSensoryInputs] = useState<Omit<SensoryEntry, 'id' | 'timestamp'>[]>([]);\n  const [environmentalData, setEnvironmentalData] = useState<Omit<EnvironmentalEntry, 'id' | 'timestamp'> | null>(null);\n  const [generalNotes, setGeneralNotes] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const { tTracking, tCommon } = useTranslation();\n\n  useEffect(() => {\n    if (!studentId) return;\n\n    // Load student data\n    const storedStudents = localStorage.getItem('sensoryTracker_students');\n    if (storedStudents) {\n      const students = JSON.parse(storedStudents);\n      const foundStudent = students.find((s: Student) => s.id === studentId);\n      if (foundStudent) {\n        setStudent({\n          ...foundStudent,\n          createdAt: new Date(foundStudent.createdAt)\n        });\n      } else {\n        toast.error(String(tTracking('session.validationError')));\n        navigate('/');\n      }\n    }\n  }, [studentId, navigate, tTracking]);\n\n  const handleEmotionAdd = (emotion: Omit<EmotionEntry, 'id' | 'timestamp'>) => {\n    setEmotions([...emotions, emotion]);\n    toast.success(\"Emotion recorded!\");\n  };\n\n  const handleSensoryAdd = (sensory: Omit<SensoryEntry, 'id' | 'timestamp'>) => {\n    setSensoryInputs([...sensoryInputs, sensory]);\n    toast.success(\"Sensory input recorded!\");\n  };\n\n  const handleEnvironmentalAdd = (environmental: Omit<EnvironmentalEntry, 'id' | 'timestamp'>) => {\n    setEnvironmentalData(environmental);\n    toast.success(\"Environmental conditions recorded!\");\n  };\n\n  const handleSaveSession = async () => {\n    if (!student) return;\n    \n    if (emotions.length === 0 && sensoryInputs.length === 0) {\n      toast.error(String(tTracking('session.validationError')));\n      return;\n    }\n\n    setIsLoading(true);\n    try {\n      const timestamp = new Date();\n      \n      // Create the tracking entry\n      const trackingEntry: TrackingEntry = {\n        id: crypto.randomUUID(),\n        studentId: student.id,\n        timestamp,\n        emotions: emotions.map(e => ({\n          ...e,\n          id: crypto.randomUUID(),\n          timestamp\n        })),\n        sensoryInputs: sensoryInputs.map(s => ({\n          ...s,\n          id: crypto.randomUUID(),\n          timestamp\n        })),\n        environmentalData: environmentalData ? {\n          ...environmentalData,\n          id: crypto.randomUUID(),\n          timestamp\n        } : undefined,\n        notes: generalNotes.trim() || undefined\n      };\n\n      // Save using dataStorage for consistency\n      const storedEntries = localStorage.getItem('sensoryTracker_entries');\n      const entries = storedEntries ? JSON.parse(storedEntries) : [];\n      entries.push(trackingEntry);\n      localStorage.setItem('sensoryTracker_entries', JSON.stringify(entries));\n\n      // Trigger analytics update for this student\n      await analyticsManager.triggerAnalyticsForStudent(student);\n\n      toast.success(String(tTracking('session.sessionSaved')));\n      navigate(`/student/${student.id}`);\n    } catch (error) {\n      logger.error('Failed to save tracking session', { error });\n      toast.error(String(tTracking('session.saveError')));\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  if (!student) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4\" />\n          <p className=\"text-muted-foreground\">{String(tCommon('status.loading'))}...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background font-dyslexia\">\n      <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <Button\n              variant=\"ghost\"\n              onClick={() => navigate(`/student/${student.id}`)}\n              className=\"font-dyslexia\"\n            >\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              {String(tCommon('buttons.back'))}\n            </Button>\n            <LanguageSettings />\n          </div>\n          \n          <div className=\"flex items-center gap-3 mb-2\">\n            <div className=\"w-12 h-12 rounded-full bg-gradient-primary flex items-center justify-center text-primary-foreground font-semibold text-lg\">\n              {student.name.split(' ').map(n => n[0]).join('').toUpperCase()}\n            </div>\n            <div>\n              <h1 className=\"text-3xl font-bold text-foreground\">\n                {String(tTracking('session.title')).replace('{{studentName}}', student.name)}\n              </h1>\n            </div>\n          </div>\n          \n          <p className=\"text-muted-foreground\">\n            Record emotions and sensory responses for this session\n          </p>\n        </div>\n\n        {/* Session Summary */}\n        <div className=\"mb-6 p-4 bg-primary-soft rounded-lg border border-primary/20\">\n          <h3 className=\"text-lg font-semibold text-primary-foreground mb-2\">\n            {String(tTracking('session.summary'))}\n          </h3>\n          <div className=\"flex items-center gap-4 text-sm text-primary-foreground\">\n            <div className=\"flex items-center gap-2\">\n              <User className=\"h-4 w-4\" />\n              <span>{String(tTracking('session.emotionsRecorded')).replace('{{count}}', emotions.length.toString())}</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <span>{String(tTracking('session.sensoryInputsRecorded')).replace('{{count}}', sensoryInputs.length.toString())}</span>\n            </div>\n          </div>\n        </div>\n\n        {/* Tracking Forms */}\n        <div className=\"space-y-8 mb-8\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n            <EmotionTracker \n              onEmotionAdd={handleEmotionAdd}\n              studentId={student.id}\n            />\n            <SensoryTracker \n              onSensoryAdd={handleSensoryAdd}\n              studentId={student.id}\n            />\n          </div>\n          \n          {/* Environmental Tracking */}\n          <div className=\"w-full\">\n            <EnvironmentalTracker \n              onEnvironmentalAdd={handleEnvironmentalAdd}\n              studentId={student.id}\n            />\n          </div>\n        </div>\n\n        {/* General Notes */}\n        <div className=\"mb-8\">\n          <h3 className=\"text-lg font-semibold text-foreground mb-3\">\n            {String(tTracking('session.generalNotes'))}\n          </h3>\n          <textarea\n            value={generalNotes}\n            onChange={(e) => setGeneralNotes(e.target.value)}\n            placeholder={String(tTracking('session.generalNotesPlaceholder'))}\n            aria-label={String(tTracking('session.generalNotes'))}\n            className=\"w-full p-4 border border-border rounded-lg font-dyslexia bg-input focus:ring-2 focus:ring-ring focus:border-transparent resize-none\"\n            rows={4}\n          />\n        </div>\n\n        {/* Save Session */}\n        <div className=\"flex gap-4\">\n          <Button\n            variant=\"ghost\"\n            onClick={() => navigate(`/student/${student.id}`)}\n            className=\"flex-1 font-dyslexia\"\n          >\n            {String(tTracking('session.cancelSession'))}\n          </Button>\n          <Button\n            onClick={handleSaveSession}\n            disabled={isLoading || (emotions.length === 0 && sensoryInputs.length === 0)}\n            className=\"flex-1 font-dyslexia bg-gradient-primary hover:opacity-90 transition-all duration-200\"\n          >\n            {isLoading ? (\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-4 h-4 border-2 border-primary-foreground border-t-transparent rounded-full animate-spin\" />\n                {String(tCommon('status.saving'))}\n              </div>\n            ) : (\n              <>\n                <Save className=\"h-4 w-4 mr-2\" />\n                {String(tTracking('session.saveSession'))}\n              </>\n            )}\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default TrackStudent;\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/setupTests.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/types/analytics-cache.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/types/analytics-manager.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/types/analytics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/types/chart.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/types/charts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/types/errors.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/types/global.d.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[114,117],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[114,117],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Global window properties used by the application\n */\ndeclare global {\n  interface Window {\n    dataLayer?: any[];\n    __analyticsWorkerInitLogged?: boolean;\n  }\n}\n\nexport {};\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/types/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/types/insights.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/types/ml.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/types/preprocessing.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/types/student.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/types/tegn.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/types/typeGuards.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/types/window.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/utils/accessibility.ts","messages":[{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":13,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":15,"endColumn":13},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":89,"column":3,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":89,"endColumn":55}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Accessibility utility functions\n\n/**\n * Announces a message to screen readers\n */\nexport function announceToScreenReader(message: string, priority: 'polite' | 'assertive' = 'polite') {\n  const announcer = document.getElementById('accessibility-announcements');\n  if (announcer) {\n    announcer.setAttribute('aria-live', priority);\n    announcer.textContent = message;\n    \n    // Clear after a short delay to avoid repeated announcements\n    setTimeout(() => {\n      announcer.textContent = '';\n    }, 1000);\n  }\n}\n\n/**\n * Moves focus to an element by ID\n */\nexport function moveFocusTo(elementId: string) {\n  const element = document.getElementById(elementId);\n  if (element) {\n    element.focus();\n    return true;\n  }\n  return false;\n}\n\n/**\n * Checks if an element is focusable\n */\nexport function isFocusable(element: HTMLElement): boolean {\n  const focusableSelectors = [\n    'a[href]',\n    'button:not([disabled])',\n    'input:not([disabled])',\n    'select:not([disabled])',\n    'textarea:not([disabled])',\n    '[tabindex]:not([tabindex=\"-1\"])'\n  ];\n  \n  return focusableSelectors.some(selector => element.matches(selector));\n}\n\n/**\n * Gets all focusable elements within a container\n */\nexport function getFocusableElements(container: HTMLElement): HTMLElement[] {\n  const focusableSelectors = [\n    'a[href]',\n    'button:not([disabled])',\n    'input:not([disabled])',\n    'select:not([disabled])',\n    'textarea:not([disabled])',\n    '[tabindex]:not([tabindex=\"-1\"])'\n  ].join(', ');\n  \n  return Array.from(container.querySelectorAll(focusableSelectors));\n}\n\n/**\n * Traps focus within a container\n */\nexport function trapFocus(container: HTMLElement) {\n  const focusableElements = getFocusableElements(container);\n  const firstFocusable = focusableElements[0];\n  const lastFocusable = focusableElements[focusableElements.length - 1];\n\n  const handleKeyDown = (e: KeyboardEvent) => {\n    if (e.key === 'Tab') {\n      if (e.shiftKey) {\n        // Shift + Tab\n        if (document.activeElement === firstFocusable) {\n          e.preventDefault();\n          lastFocusable?.focus();\n        }\n      } else {\n        // Tab\n        if (document.activeElement === lastFocusable) {\n          e.preventDefault();\n          firstFocusable?.focus();\n        }\n      }\n    }\n  };\n\n  container.addEventListener('keydown', handleKeyDown);\n\n  // Focus the first focusable element\n  firstFocusable?.focus();\n\n  // Return cleanup function\n  return () => {\n    container.removeEventListener('keydown', handleKeyDown);\n  };\n}","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/workers/analytics.worker.stub.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[204,207],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[204,207],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Minimal stub worker used in POC mode to avoid bundling heavy analytics code\n// Posts a single complete message with empty-but-valid results\n\n \nself.onmessage = (event: MessageEvent) => {\n  const data: any = event.data || {};\n  const cacheKey = data.cacheKey;\n   \n  (self as unknown as Worker).postMessage({\n    type: 'complete',\n    payload: {\n      patterns: [],\n      correlations: [],\n      environmentalCorrelations: [],\n      predictiveInsights: [],\n      anomalies: [],\n      insights: [],\n      cacheKey\n    }\n  });\n};\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/workers/analytics.worker.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[838,841],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[838,841],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":6,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":9,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[927,930],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[927,930],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1331,1334],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1331,1334],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":61,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1922,1925],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1922,1925],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { handleMessage } from './analytics.worker';\nimport type { AnalyticsData } from '@/types/analytics';\n\n// Mock cached analysis used by worker to deterministic outputs\nvi.mock('@/lib/cachedPatternAnalysis', () => ({\n  createCachedPatternAnalysis: () => ({\n    analyzeEmotionPatterns: vi.fn().mockReturnValue([]),\n    analyzeSensoryPatterns: vi.fn().mockReturnValue([]),\n    analyzeEnvironmentalCorrelations: vi.fn().mockReturnValue([\n      { factor1: 'emotion', factor2: 'sensory', correlation: 0.5, significance: 'high', description: 'test' }\n    ]),\n    generatePredictiveInsights: vi.fn().mockResolvedValue([]),\n    detectAnomalies: vi.fn().mockReturnValue([]),\n  })\n}));\n\n// Mock the global postMessage for worker context\nconst mockPostMessage = vi.fn();\n(global as any).postMessage = mockPostMessage;\n\nconst self = {\n  postMessage: mockPostMessage,\n} as any;\n\ndescribe('analytics.worker', () => {\n  beforeEach(() => {\n    vi.clearAllMocks();\n    vi.useFakeTimers();\n  });\n\n  it('should handle ANALYZE message', async () => {\nconst testData: AnalyticsData = {\n      entries: [{ id: '1', timestamp: new Date(), value: 5 }],\n      emotions: [],\n      sensoryInputs: [],\n    };\n\n    await handleMessage.call(self, new MessageEvent('message', { data: testData as any }));\n    await vi.runAllTimersAsync();\n\n    expect(self.postMessage).toHaveBeenCalledWith(\n      expect.objectContaining({\n        type: 'complete',\n        payload: expect.objectContaining({\n          patterns: expect.any(Array),\n          correlations: expect.any(Array),\n          insights: expect.any(Array),\n        })\n      })\n    );\n  });\n\n  it('should handle empty data', async () => {\n    const testData: AnalyticsData = {\n      entries: [],\n      emotions: [],\n      sensoryInputs: [],\n    };\n\n    await handleMessage.call(self, new MessageEvent('message', { data: testData as any }));\n    await vi.runAllTimersAsync();\n\n    expect(self.postMessage).toHaveBeenCalledWith(\n      expect.objectContaining({\n        type: 'complete',\n        payload: expect.objectContaining({\n          patterns: [],\n          correlations: [],\n          insights: [],\n        })\n      })\n    );\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/workers/analytics.worker.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'PatternResult' is defined but never used. Allowed unused vars must match /^_/u.","line":9,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":9,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TrackingEntry' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'EmotionEntry' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SensoryEntry' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":51},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'analyticsConfig' is defined but never used. Allowed unused vars must match /^_/u.","line":16,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":43},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":131,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4645,4648],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4645,4648],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getConfigHash' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":143,"column":7,"nodeType":null,"messageId":"unusedVar","endLine":143,"endColumn":20},{"ruleId":"no-restricted-syntax","severity":1,"message":"setInterval/setTimeout should be used inside useEffect with proper cleanup (clearInterval/clearTimeout) to prevent memory leaks","line":176,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":185,"endColumn":11},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":201,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":201,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6961,6964],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6961,6964],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":206,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":206,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7161,7164],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7161,7164],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":224,"column":98,"nodeType":"BlockStatement","messageId":"unexpected","endLine":224,"endColumn":100,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[8679,8679],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":236,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":236,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9028,9031],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9028,9031],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":260,"column":92,"nodeType":"BlockStatement","messageId":"unexpected","endLine":260,"endColumn":94,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[10053,10053],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":432,"column":102,"nodeType":"BlockStatement","messageId":"unexpected","endLine":432,"endColumn":104,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[16533,16533],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used. Allowed unused caught errors must match /^_/u.","line":465,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":465,"endColumn":15},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":493,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":500,"endColumn":7},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":499,"column":115,"nodeType":"BlockStatement","messageId":"unexpected","endLine":499,"endColumn":117,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[19048,19048],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":502,"column":5,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":510,"endColumn":7},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":509,"column":119,"nodeType":"BlockStatement","messageId":"unexpected","endLine":509,"endColumn":121,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[19775,19775],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":511,"column":109,"nodeType":"BlockStatement","messageId":"unexpected","endLine":511,"endColumn":111,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[19896,19896],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":1,"message":"Empty block statement.","line":517,"column":106,"nodeType":"BlockStatement","messageId":"unexpected","endLine":517,"endColumn":108,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[20236,20236],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":180,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6371,6374],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6371,6374],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":496,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":496,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18687,18690],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18687,18690],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":502,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":502,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19179,19182],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19179,19182],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":506,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":506,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19414,19417],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19414,19417],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":516,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":516,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20060,20063],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20060,20063],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":21,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * @file src/workers/analytics.worker.ts\n * \n * This is a web worker dedicated to performing heavy analytics computations\n * in a background thread, ensuring the main UI thread remains responsive.\n * It listens for messages containing student data, runs a series of analyses,\n * and posts the results back to the main thread.\n */\nimport { PatternResult, CorrelationResult } from '@/lib/patternAnalysis';\nimport { PredictiveInsight, AnomalyDetection } from '@/lib/enhancedPatternAnalysis';\nimport { TrackingEntry, EmotionEntry, SensoryEntry } from '@/types/student';\nimport { AnalyticsData, AnalyticsResults, AnalyticsConfiguration, WorkerCacheEntry, AnalyticsWorkerMessage } from '@/types/analytics';\nimport { createCachedPatternAnalysis } from '@/lib/cachedPatternAnalysis';\nimport { logger } from '@/lib/logger';\nimport { generateInsightsFromWorkerInputs } from '@/lib/insights';\nimport { ANALYTICS_CONFIG, analyticsConfig } from '@/lib/analyticsConfig';\nimport { generateAnalyticsSummary } from '@/lib/analyticsSummary';\n\n// Type is now imported from @/types/analytics\n\n// Worker cache TTL source: cache.ttl from central analytics config (ms). Safe fallback applied.\nlet workerCacheTTL = (ANALYTICS_CONFIG.cache.ttl ?? 300_000); // default from config, safe fallback 300s\n// Worker cache max size source: cache.maxSize from central analytics config. Safe fallback applied.\nlet workerCacheMaxSize = (ANALYTICS_CONFIG.cache.maxSize ?? 200); // soft cap, overridden by config if provided\nconst insertionOrder: string[] = []; // FIFO order for eviction\n\n// Create a simple cache implementation for the worker\nconst workerCache = {\n  storage: new Map<string, WorkerCacheEntry>(),\n  \n  get(key: string): unknown | undefined {\n    const entry = this.storage.get(key);\n    if (entry && entry.expires > Date.now()) {\n      return entry.data;\n    }\n    // Expired or missing: ensure removal\n    this.storage.delete(key);\n    return undefined;\n  },\n  \n  set(key: string, value: unknown, tags: string[] = []): void {\n    // Insert/update\n    if (!this.storage.has(key)) {\n      insertionOrder.push(key);\n    }\n    this.storage.set(key, {\n      data: value,\n      expires: Date.now() + workerCacheTTL,\n      tags\n    });\n    // Evict oldest until under max size\n    while (insertionOrder.length > workerCacheMaxSize) {\n      const oldestKey = insertionOrder.shift();\n      if (oldestKey) {\n        this.storage.delete(oldestKey);\n      }\n    }\n  },\n  \n  has(key: string): boolean {\n    return this.get(key) !== undefined;\n  },\n  \n  invalidateByTag(tag: string): number {\n    let count = 0;\n    for (const [key, entry] of this.storage.entries()) {\n      if (entry.tags && entry.tags.includes(tag)) {\n        this.storage.delete(key);\n        count++;\n      }\n    }\n    if (count > 0) {\n      // Rebuild insertion order without deleted keys\n      const remaining = insertionOrder.filter(k => this.storage.has(k));\n      insertionOrder.length = 0;\n      insertionOrder.push(...remaining);\n    }\n    return count;\n  },\n\n  clearAll(): number {\n    const count = this.storage.size;\n    this.storage.clear();\n    insertionOrder.length = 0;\n    return count;\n  },\n\n  clearByStudentId(studentId: string): number {\n    return this.invalidateByTag(`student-${studentId}`);\n  },\n\n  clearByPattern(pattern: RegExp): number {\n    let count = 0;\n    for (const key of Array.from(this.storage.keys())) {\n      if (pattern.test(key)) {\n        this.storage.delete(key);\n        count++;\n      }\n    }\n    const remaining = insertionOrder.filter(k => this.storage.has(k));\n    insertionOrder.length = 0;\n    insertionOrder.push(...remaining);\n    return count;\n  },\n\n  getStats(): { size: number } {\n    return { size: this.storage.size };\n  },\n\n  // Utilities required by CachedPatternAnalysisEngine\n  getDataFingerprint(data: unknown): string {\n    const stringify = (obj: unknown): string => {\n      if (obj === null || obj === undefined) return 'null';\n      if (typeof obj !== 'object') return String(obj);\n      if (Array.isArray(obj)) return `[${obj.map(stringify).join(',')}]`;\n      const rec = obj as Record<string, unknown>;\n      const keys = Object.keys(rec).sort();\n      return `{${keys.map(k => `${k}:${stringify(rec[k])}`).join(',')}}`;\n    };\n    const str = stringify(data);\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n      const ch = str.charCodeAt(i);\n      hash = ((hash << 5) - hash) + ch;\n      hash = hash & hash;\n    }\n    return Math.abs(hash).toString(36);\n  },\n\n  createKey(prefix: string, params: Record<string, unknown>): string {\n    const sorted = Object.keys(params).sort().map(k => `${k}:${JSON.stringify((params as any)[k])}`).join(':');\n    return `${prefix}:${sorted}`;\n  },\n  \n};\n\n// Create cached pattern analysis instance\nconst cachedAnalysis = createCachedPatternAnalysis(workerCache);\n\n/**\n * Compute a stable hash for the subset of config that affects analysis output.\n */\nconst getConfigHash = (cfg: AnalyticsConfiguration | null): string => {\n  if (!cfg) return 'no-config';\n  const subset = {\n    patternAnalysis: cfg.patternAnalysis,\n    enhancedAnalysis: cfg.enhancedAnalysis,\n    timeWindows: cfg.timeWindows,\n    alertSensitivity: cfg.alertSensitivity\n  };\n  // Reuse workerCache fingerprint utility by temporary object\n  const stringify = (obj: unknown): string => {\n    if (obj === null || obj === undefined) return 'null';\n    if (typeof obj !== 'object') return String(obj);\n    if (Array.isArray(obj)) return `[${obj.map(stringify).join(',')}]`;\n    const keys = Object.keys(obj as Record<string, unknown>).sort();\n    return `{${keys.map(k => `${k}:${stringify((obj as Record<string, unknown>)[k])}`).join(',')}}`;\n  };\n  const str = stringify(subset);\n  let hash = 0;\n  for (let i = 0; i < str.length; i++) {\n    const char = str.charCodeAt(i);\n    hash = ((hash << 5) - hash) + char;\n    hash = hash & hash;\n  }\n  return Math.abs(hash).toString(36);\n};\n\n// Outgoing message queue to avoid flooding the main thread with messages\nconst outgoingQueue: AnalyticsWorkerMessage[] = [];\nlet flushScheduled = false;\nconst enqueueMessage = (msg: AnalyticsWorkerMessage) => {\n  outgoingQueue.push(msg);\n  if (!flushScheduled) {\n    flushScheduled = true;\n    setTimeout(() => {\n      try {\n        while (outgoingQueue.length) {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          (postMessage as any)(outgoingQueue.shift());\n        }\n      } finally {\n        flushScheduled = false;\n      }\n    }, 30);\n  }\n};\n\n// Configuration passed from main thread\nlet currentConfig: AnalyticsConfiguration | null = null;\n\n// Types are now imported from @/types/analytics\nexport type { AnalyticsData, AnalyticsResults } from '@/types/analytics';\n\n\n/**\n * Main message handler for the worker.\n * This function is triggered when the main thread calls `worker.postMessage()`.\n * It orchestrates the analysis process and posts the results back.\n */\nexport async function handleMessage(e: MessageEvent<any>) {\n  // Support two message shapes:\n  // A) Cache control commands (CACHE/*)\n  // B) Typed task envelope built via buildInsightsTask\n  // C) Legacy AnalyticsData directly\n  const msg = e.data as any;\n\n  // Intercept cache control messages first\n  if (msg && typeof msg.type === 'string' && msg.type.startsWith('CACHE/')) {\n    try {\n      if (msg.type === 'CACHE/CLEAR_ALL') {\n        const patternsCleared = (() => { try { return cachedAnalysis.invalidateAllCache(); } catch { return 0; } })();\n        const cacheCleared = workerCache.clearAll();\n        enqueueMessage({ type: 'CACHE/CLEAR_DONE', payload: { scope: 'all', patternsCleared, cacheCleared, stats: workerCache.getStats() } } as unknown as AnalyticsWorkerMessage);\n      } else if (msg.type === 'CACHE/CLEAR_STUDENT' && typeof msg.studentId === 'string') {\n        const patternsCleared = (() => { try { return cachedAnalysis.invalidateStudentCache(msg.studentId); } catch { return 0; } })();\n        const cacheCleared = workerCache.clearByStudentId(msg.studentId);\n        enqueueMessage({ type: 'CACHE/CLEAR_DONE', payload: { scope: 'student', studentId: msg.studentId, patternsCleared, cacheCleared, stats: workerCache.getStats() } } as unknown as AnalyticsWorkerMessage);\n      } else if (msg.type === 'CACHE/CLEAR_PATTERNS') {\n        const patternsCleared = (() => { try { return cachedAnalysis.invalidateAllCache(); } catch { return 0; } })();\n        enqueueMessage({ type: 'CACHE/CLEAR_DONE', payload: { scope: 'patterns', patternsCleared, stats: workerCache.getStats() } } as unknown as AnalyticsWorkerMessage);\n      }\n    } catch (err) {\n      try { logger.error('[analytics.worker] Cache clear command failed', err as Error); } catch {}\n    }\n    return;\n  }\n  let filteredData: AnalyticsData;\n  if (msg && msg.type === 'Insights/Compute' && msg.payload) {\n    const { inputs, config } = msg.payload;\n    filteredData = {\n      entries: inputs.entries,\n      emotions: inputs.emotions,\n      sensoryInputs: inputs.sensoryInputs,\n      cacheKey: msg.cacheKey,\n      config: (config as any) ?? null\n    } as unknown as AnalyticsData;\n    // Optionally honor ttlSeconds from task by updating per-message TTL\n    if (typeof msg.ttlSeconds === 'number' && msg.ttlSeconds > 0) {\n      workerCacheTTL = Math.max(1000, Math.floor(msg.ttlSeconds * 1000));\n    }\n  } else {\n    filteredData = msg as AnalyticsData;\n  }\n\n  // Diagnostic log: message received - use cache to limit verbosity\n  try {\n    const logKey = `worker_msg_${filteredData?.cacheKey || 'nocache'}_${new Date().getMinutes()}`;\n    if (!workerCache.has(logKey)) {\n      logger.debug('[analytics.worker] onmessage', {\n        hasConfig: !!filteredData?.config,\n        cacheKey: filteredData?.cacheKey ?? null,\n        entries: filteredData?.entries?.length ?? 0,\n        emotions: filteredData?.emotions?.length ?? 0,\n        sensory: filteredData?.sensoryInputs?.length ?? 0,\n      });\n      workerCache.set(logKey, true, ['logging']);\n    }\n  } catch (e) {\n    try { logger.warn('[analytics.worker] Diagnostic logging failed', e as Error); } catch {}\n  }\n\n  // Update configuration if provided\n  if (filteredData.config) {\n    currentConfig = filteredData.config;\n    if (typeof currentConfig.cache?.ttl === 'number' && currentConfig.cache.ttl > 0) {\n      workerCacheTTL = currentConfig.cache.ttl;\n    }\n    if (typeof currentConfig.cache?.maxSize === 'number' && currentConfig.cache.maxSize > 0) {\n      workerCacheMaxSize = currentConfig.cache.maxSize;\n      // Trim immediately if oversize\n      while (insertionOrder.length > workerCacheMaxSize) {\n        const oldestKey = insertionOrder.shift();\n        if (oldestKey) {\n          workerCache.storage.delete(oldestKey);\n        }\n      }\n    }\n  }\n\n// Early exit only when absolutely no data is present.\n// Previously, we exited when emotions and sensoryInputs were empty, which\n// incorrectly skipped correlation analysis based solely on tracking entries.\n// Now we require that all sources are empty before returning.\n  if (\n    (filteredData.emotions?.length ?? 0) === 0 &&\n    (filteredData.sensoryInputs?.length ?? 0) === 0 &&\n    (filteredData.entries?.length ?? 0) === 0\n  ) {\n    enqueueMessage({\n      type: 'complete',\n      cacheKey: filteredData.cacheKey ?? undefined,\n      payload: {\n        patterns: [],\n        correlations: [],\n        predictiveInsights: [],\n        anomalies: [],\n        insights: [],\n        cacheKey: filteredData.cacheKey ?? undefined,\n        updatedCharts: ['insightList']\n      },\n      chartsUpdated: ['insightList']\n    });\n    return;\n  }\n\ntry {\n// Use configured time window or default from central config\n    // Analysis window source: timeWindows.defaultAnalysisDays from runtime config; fallback to defaults.\n    // This avoids hardcoding and keeps behavior environment-tunable (Task 8, rule j9uS...).\n    const timeWindow = currentConfig?.timeWindows?.defaultAnalysisDays ?? ANALYTICS_CONFIG.timeWindows.defaultAnalysisDays;\n\n    // Progress heartbeat: start\n    enqueueMessage({ type: 'progress', cacheKey: filteredData.cacheKey, progress: { stage: 'start', percent: 5 } });\n\n    const emotionPatterns = filteredData.emotions.length > 0\n      ? cachedAnalysis.analyzeEmotionPatterns(filteredData.emotions, timeWindow)\n      : [];\n    const sensoryPatterns = filteredData.sensoryInputs.length > 0\n      ? cachedAnalysis.analyzeSensoryPatterns(filteredData.sensoryInputs, timeWindow)\n      : [];\n    \n    const patterns = [...emotionPatterns, ...sensoryPatterns];\n\n    // Send partial update for patterns\n    enqueueMessage({\n      type: 'partial',\n      cacheKey: filteredData.cacheKey,\n      payload: {\n        patterns,\n        cacheKey: filteredData.cacheKey,\n        updatedCharts: ['patternHighlights']\n      },\n      chartsUpdated: ['patternHighlights'],\n      progress: { stage: 'patterns', percent: 30 }\n    });\n\n    let correlations: CorrelationResult[] = [];\n    // Correlation threshold source: analytics.MIN_TRACKING_FOR_CORRELATION from runtime config.\n    const minForCorrelation = currentConfig?.analytics?.MIN_TRACKING_FOR_CORRELATION ?? ANALYTICS_CONFIG.analytics.MIN_TRACKING_FOR_CORRELATION;\n    if (filteredData.entries.length >= minForCorrelation) {\n      correlations = cachedAnalysis.analyzeEnvironmentalCorrelations(filteredData.entries);\n    }\n\n    // Send partial update for correlations\n    enqueueMessage({\n      type: 'partial',\n      cacheKey: filteredData.cacheKey,\n      payload: {\n        correlations,\n        environmentalCorrelations: correlations,\n        cacheKey: filteredData.cacheKey,\n        updatedCharts: ['correlationMatrix']\n      },\n      chartsUpdated: ['correlationMatrix'],\n      progress: { stage: 'correlations', percent: 55 }\n    });\n\n    let predictiveInsights: PredictiveInsight[] = [];\n    let anomalies: AnomalyDetection[] = [];\n    // Enhanced analysis threshold source: analytics.MIN_TRACKING_FOR_ENHANCED from runtime config.\n    const minForEnhanced = currentConfig?.analytics?.MIN_TRACKING_FOR_ENHANCED ?? ANALYTICS_CONFIG.analytics.MIN_TRACKING_FOR_ENHANCED;\n    if (filteredData.entries.length >= minForEnhanced) {\n      predictiveInsights = await cachedAnalysis.generatePredictiveInsights(\n        filteredData.emotions,\n        filteredData.sensoryInputs,\n        filteredData.entries,\n        []\n      );\n\n      // Send partial update for predictive insights\n      enqueueMessage({\n        type: 'partial',\n        cacheKey: filteredData.cacheKey,\n        payload: {\n          predictiveInsights,\n          cacheKey: filteredData.cacheKey,\n          updatedCharts: ['predictiveTimeline']\n        },\n        chartsUpdated: ['predictiveTimeline'],\n        progress: { stage: 'predictiveInsights', percent: 75 }\n      });\n\n      anomalies = cachedAnalysis.detectAnomalies(\n        filteredData.emotions,\n        filteredData.sensoryInputs,\n        filteredData.entries\n      );\n\n      // Send partial update for anomalies\n      enqueueMessage({\n        type: 'partial',\n        cacheKey: filteredData.cacheKey,\n        payload: {\n          anomalies,\n          cacheKey: filteredData.cacheKey,\n          updatedCharts: ['anomalyTimeline']\n        },\n        chartsUpdated: ['anomalyTimeline'],\n        progress: { stage: 'anomalies', percent: 85 }\n      });\n    }\n\n// Compute insights via canonical path\nlet insights: string[];\n// Summary facade toggle source: features.enableSummaryFacade from runtime config; default aligns with project defaults.\nconst useSummaryFacade = (currentConfig?.features?.enableSummaryFacade ?? ANALYTICS_CONFIG.features?.enableSummaryFacade) === true;\nif (useSummaryFacade) {\n  const summary = await generateAnalyticsSummary({\n    entries: filteredData.entries,\n    emotions: filteredData.emotions,\n    sensoryInputs: filteredData.sensoryInputs,\n    results: {\n      patterns: [...emotionPatterns, ...sensoryPatterns],\n      correlations,\n      predictiveInsights,\n    },\n  });\n  insights = summary.insights;\n  // Low-noise telemetry: log at most once per minute when facade used\n  try {\n    const minuteKey = `_logged_facade_used_${new Date().getMinutes()}`;\n    if (!workerCache.has(minuteKey)) {\n      logger.debug('[analytics.worker] Using summary facade for insights', {\n        entries: filteredData.entries?.length ?? 0,\n        emotions: filteredData.emotions?.length ?? 0,\n        sensory: filteredData.sensoryInputs?.length ?? 0,\n      });\n      workerCache.set(minuteKey, true, ['logging']);\n    }\n  } catch (e) {\n    try { logger.warn('[analytics.worker] Summary facade debug logging failed', e as Error); } catch {}\n  }\n} else {\n  insights = generateInsightsFromWorkerInputs(\n    {\n      patterns: [...emotionPatterns, ...sensoryPatterns],\n      correlations,\n      emotions: filteredData.emotions,\n      sensoryInputs: filteredData.sensoryInputs,\n      trackingEntries: filteredData.entries,\n    },\n    { insightConfig: (currentConfig?.insights ?? ANALYTICS_CONFIG.insights) }\n  );\n}\n\n    const results: AnalyticsResults = {\n      patterns,\n      correlations,\n      environmentalCorrelations: correlations, // Include environmental correlations\n      predictiveInsights,\n      anomalies,\n      insights,\n      suggestedInterventions: [], // Default to empty array\n      cacheKey: filteredData.cacheKey, // Include cache key if provided\n      updatedCharts: ['insightList']\n    };\n\n    // Post the final results back to the main thread.\n    enqueueMessage({ type: 'complete', cacheKey: filteredData.cacheKey, payload: results, chartsUpdated: ['insightList'], progress: { stage: 'complete', percent: 100 } });\n\n  } catch (error) {\n    try {\n    logger.error('[analytics.worker] error', error);\n    } catch (e) {\n      /* ignore logging failure */\n    }\n    logger.error('Error in analytics worker:', error);\n    // Post an error message back to the main thread for graceful error handling.\n    // Include empty results to prevent UI errors\n    enqueueMessage({\n      type: 'error',\n      cacheKey: filteredData.cacheKey,\n      error: 'Failed to analyze data.',\n      payload: {\n        patterns: [],\n        correlations: [],\n        predictiveInsights: [],\n        anomalies: [],\n        insights: ['An error occurred during analysis. Please try again.'],\n        cacheKey: filteredData.cacheKey,\n        updatedCharts: ['insightList']\n      },\n      chartsUpdated: ['insightList']\n    });\n  }\n}\n\n// Attach the handler to self.onmessage for the worker context\nif (typeof self !== 'undefined' && 'onmessage' in self) {\n  // Global safety nets to surface runtime failures without crashing silently\n  try {\n    self.addEventListener('error', (e: ErrorEvent) => {\n      try {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (postMessage as any)({ type: 'error', error: e.message, cacheKey: undefined, payload: {\n          patterns: [], correlations: [], predictiveInsights: [], anomalies: [], insights: ['Worker runtime error encountered.'], updatedCharts: ['insightList']\n        }});\n      } catch (err) { try { logger.warn('[analytics.worker] Failed to post error message', err as Error); } catch {} }\n    });\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    self.addEventListener('unhandledrejection', (e: any) => {\n      const msg = typeof e?.reason === 'string' ? e.reason : (e?.reason?.message ?? 'Unhandled rejection in worker');\n      try {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (postMessage as any)({ type: 'error', error: String(msg), cacheKey: undefined, payload: {\n          patterns: [], correlations: [], predictiveInsights: [], anomalies: [], insights: ['Worker unhandled rejection.'], updatedCharts: ['insightList']\n        }});\n      } catch (err) { try { logger.warn('[analytics.worker] Failed to post rejection message', err as Error); } catch {} }\n    });\n  } catch (e) { try { logger.warn('[analytics.worker] Failed to setup error handlers', e as Error); } catch {} }\n\n  // Signal readiness so main thread can flush any queued tasks\n  try {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (postMessage as any)({ type: 'progress', progress: { stage: 'ready', percent: 1 } });\n  } catch (e) { try { logger.warn('[analytics.worker] Failed to post ready signal', e as Error); } catch {} }\n\n  self.onmessage = handleMessage;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/workers/hyperparameterOptimization.worker.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/workers/mlTraining.worker.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ValidationResults' is defined but never used. Allowed unused vars must match /^_/u.","line":11,"column":49,"nodeType":null,"messageId":"unusedVar","endLine":11,"endColumn":66},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'model' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":148,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":148,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'normalizers' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":149,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":149,"endColumn":39},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'model' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":216,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":216,"endColumn":14},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'saveResult' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":278,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":278,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * @file src/workers/mlTraining.worker.ts\n * \n * Web worker dedicated to training machine learning models in the background.\n * This ensures that heavy ML computations don't block the main UI thread.\n */\nimport * as tf from '@tensorflow/tfjs';\nimport { TrackingEntry, EmotionEntry, SensoryEntry } from '@/types/student';\nimport { ModelType, ModelMetadata } from '@/lib/mlModels';\nimport { convertTrackingEntriesToSessions, prepareEmotionData, prepareSensoryData } from '@/lib/preprocessing/facade';\nimport { CrossValidator, CrossValidationConfig, ValidationResults } from '../lib/validation/crossValidation';\nimport { TrainingData, EarlyStoppingConfig } from '../types/ml';\n\n// Set TensorFlow.js backend for web workers\ntf.setBackend('cpu');\n\ninterface TrainingRequest {\n  type: 'train-emotion' | 'train-sensory' | 'train-baseline';\n  data: {\n    trackingEntries?: TrackingEntry[];\n    emotions?: EmotionEntry[];\n    sensoryInputs?: SensoryEntry[];\n  };\n  config: {\n    epochs?: number;\n    batchSize?: number;\n    validationSplit?: number;\n    earlyStopping?: EarlyStoppingConfig;\n  };\n}\n\ninterface TrainingProgress {\n  type: 'progress';\n  modelType: ModelType;\n  epoch: number;\n  totalEpochs: number;\n  loss: number;\n  accuracy?: number;\n  logs?: tf.Logs;\n}\n\ninterface TrainingResult {\n  type: 'complete' | 'error';\n  modelType: ModelType;\n  model?: ArrayBuffer; // Serialized model\n  metadata?: ModelMetadata;\n  error?: string;\n}\n\ntype WorkerMessage = TrainingProgress | TrainingResult;\n\n// Training callbacks to report progress\nconst createTrainingCallbacks = (\n  modelType: ModelType,\n  totalEpochs: number\n): tf.CustomCallbackArgs => {\n  return {\n    onEpochEnd: async (epoch: number, logs?: tf.Logs) => {\n      const progress: TrainingProgress = {\n        type: 'progress',\n        modelType,\n        epoch: epoch + 1,\n        totalEpochs,\n        loss: logs?.loss as number || 0,\n        accuracy: logs?.acc as number || logs?.accuracy as number,\n        logs\n      };\n      self.postMessage(progress);\n    }\n  };\n};\n\n// Create emotion prediction model\nconst createEmotionModel = (): tf.Sequential => {\n  const model = tf.sequential({\n    layers: [\n      tf.layers.lstm({\n        units: 64,\n        returnSequences: true,\n        inputShape: [7, 13] // 7 days, 13 features\n      }),\n      tf.layers.dropout({ rate: 0.2 }),\n      tf.layers.lstm({\n        units: 32,\n        returnSequences: false\n      }),\n      tf.layers.dropout({ rate: 0.2 }),\n      tf.layers.dense({\n        units: 16,\n        activation: 'relu'\n      }),\n      tf.layers.dense({\n        units: 7,\n        activation: 'sigmoid'\n      })\n    ]\n  });\n  \n  model.compile({\n    optimizer: tf.train.adam(0.001),\n    loss: 'meanSquaredError',\n    metrics: ['mse', 'mae']\n  });\n  \n  return model;\n};\n\n// Create sensory response model\nconst createSensoryModel = (): tf.Sequential => {\n  const model = tf.sequential({\n    layers: [\n      tf.layers.dense({\n        units: 32,\n        activation: 'relu',\n        inputShape: [12] // 6 environment + 6 time features\n      }),\n      tf.layers.dropout({ rate: 0.2 }),\n      tf.layers.dense({\n        units: 16,\n        activation: 'relu'\n      }),\n      tf.layers.dropout({ rate: 0.2 }),\n      tf.layers.dense({\n        units: 15,\n        activation: 'softmax' // 5 senses × 3 responses\n      })\n    ]\n  });\n  \n  model.compile({\n    optimizer: tf.train.adam(0.001),\n    loss: 'categoricalCrossentropy',\n    metrics: ['accuracy']\n  });\n  \n  return model;\n};\n\n// Train emotion model\nconst trainEmotionModel = async (\n  trackingEntries: TrackingEntry[],\n  epochs: number = 50,\n  batchSize: number = 32,\n  validationSplit: number = 0.2,\n  earlyStopping?: EarlyStoppingConfig\n): Promise<{ model: tf.Sequential; history: tf.History; metadata: ModelMetadata }> => {\n  const sessions = convertTrackingEntriesToSessions(trackingEntries);\n  const model = createEmotionModel();\n  const { inputs, outputs, normalizers } = prepareEmotionData(sessions);\n  \n  const trainingData: TrainingData = { features: inputs, labels: outputs };\n  \n  const validator = new CrossValidator();\n  const config: CrossValidationConfig = {\n      folds: 5,\n      stratified: true,\n      randomState: 42,\n      validationMetrics: ['accuracy'],\n      fitArgs: { epochs, batchSize, shuffle: true, verbose: 0 },\n      earlyStopping,\n  };\n\n  const validationResults = await validator.validateModel(createEmotionModel, trainingData, config);\n\n  // After validation, train the final model on all data\n  const finalModel = createEmotionModel();\n  const history = await finalModel.fit(inputs, outputs, {\n      epochs,\n      batchSize,\n      validationSplit,\n      callbacks: [\n        createTrainingCallbacks('emotion-prediction', epochs),\n        ...(earlyStopping?.enabled ? [tf.callbacks.earlyStopping({\n          monitor: earlyStopping.monitor ?? 'val_loss',\n          patience: earlyStopping.patience ?? 3,\n          minDelta: earlyStopping.minDelta ?? 0,\n          mode: (earlyStopping.monitor ?? 'val_loss').includes('loss') || (earlyStopping.monitor ?? 'val_loss').includes('mse') || (earlyStopping.monitor ?? 'val_loss').includes('mae') ? 'min' : 'max',\n          restoreBestWeights: true,\n        })] : []),\n      ],\n      shuffle: true\n  });\n\n  // Create metadata\n  const metadata: ModelMetadata = {\n    name: 'emotion-prediction',\n    version: '1.0.0',\n    createdAt: new Date(),\n    lastTrainedAt: new Date(),\n    accuracy: validationResults.averageMetrics.accuracy,\n    loss: history.history.loss[history.history.loss.length - 1] as number,\n    validationResults,\n    inputShape: [7, 13],\n    outputShape: [7],\n    architecture: 'LSTM',\n    epochs,\n    dataPoints: trackingEntries.length\n  };\n  \n  // Clean up tensors\n  inputs.dispose();\n  outputs.dispose();\n  \n  return { model: finalModel, history, metadata };\n};\n\n// Train sensory model\nconst trainSensoryModel = async (\n  trackingEntries: TrackingEntry[],\n  epochs: number = 50,\n  batchSize: number = 32,\n  validationSplit: number = 0.2,\n  earlyStopping?: EarlyStoppingConfig\n): Promise<{ model: tf.Sequential; history: tf.History; metadata: ModelMetadata }> => {\n  const sessions = convertTrackingEntriesToSessions(trackingEntries);\n  const model = createSensoryModel();\n  const { inputs, outputs } = prepareSensoryData(sessions);\n\n  const trainingData: TrainingData = { features: inputs, labels: outputs };\n\n  const validator = new CrossValidator();\n  const config: CrossValidationConfig = {\n      folds: 5,\n      stratified: true,\n      randomState: 42,\n      validationMetrics: ['accuracy'],\n      fitArgs: { epochs, batchSize, shuffle: true, verbose: 0 },\n      earlyStopping,\n  };\n\n  const validationResults = await validator.validateModel(createSensoryModel, trainingData, config);\n\n  // After validation, train the final model on all data\n  const finalModel = createSensoryModel();\n  const history = await finalModel.fit(inputs, outputs, {\n      epochs,\n      batchSize,\n      validationSplit,\n      callbacks: [\n        createTrainingCallbacks('sensory-response', epochs),\n        ...(earlyStopping?.enabled ? [tf.callbacks.earlyStopping({\n          monitor: earlyStopping.monitor ?? 'val_accuracy',\n          patience: earlyStopping.patience ?? 3,\n          minDelta: earlyStopping.minDelta ?? 0,\n          mode: (earlyStopping.monitor ?? 'val_accuracy').includes('loss') || (earlyStopping.monitor ?? 'val_accuracy').includes('mse') || (earlyStopping.monitor ?? 'val_accuracy').includes('mae') ? 'min' : 'max',\n          restoreBestWeights: true,\n        })] : []),\n      ],\n      shuffle: true\n  });\n\n  // Create metadata\n  const metadata: ModelMetadata = {\n    name: 'sensory-response',\n    version: '1.0.0',\n    createdAt: new Date(),\n    lastTrainedAt: new Date(),\n    accuracy: validationResults.averageMetrics.accuracy,\n    loss: history.history.loss[history.history.loss.length - 1] as number,\n    validationResults,\n    inputShape: [12],\n    outputShape: [15],\n    architecture: 'Dense',\n    epochs,\n    dataPoints: trackingEntries.length\n  };\n  \n  // Clean up tensors\n  inputs.dispose();\n  outputs.dispose();\n  \n  return { model: finalModel, history, metadata };\n};\n\n// Serialize model to ArrayBuffer for transfer\nimport { utf8Encode } from '@/lib/utf8';\nconst serializeModel = async (model: tf.LayersModel): Promise<ArrayBuffer> => {\n  const saveResult = await model.save(tf.io.withSaveHandler(async (artifacts) => {\n    // Convert artifacts to ArrayBuffer\n    const modelTopology = JSON.stringify(artifacts.modelTopology);\n    const weightSpecs = JSON.stringify(artifacts.weightSpecs);\n    \n    // Handle weight data - it's already an ArrayBuffer\n    const weightData = artifacts.weightData as ArrayBuffer;\n    const weightDataView = new Uint8Array(weightData);\n    \n    // Create a simple format to store the model\n    const topologyBytes = utf8Encode(modelTopology);\n    const weightSpecsBytes = utf8Encode(weightSpecs);\n    \n    // Format: [topologyLength][topology][weightSpecsLength][weightSpecs][weightData]\n    const totalLength = 8 + topologyBytes.length + weightSpecsBytes.length + weightData.byteLength;\n    const serialized = new ArrayBuffer(totalLength);\n    const view = new DataView(serialized);\n    \n    // Write topology length and data\n    view.setUint32(0, topologyBytes.length, true);\n    new Uint8Array(serialized, 4, topologyBytes.length).set(topologyBytes);\n    \n    // Write weight specs length and data\n    const weightSpecsOffset = 4 + topologyBytes.length;\n    view.setUint32(weightSpecsOffset, weightSpecsBytes.length, true);\n    new Uint8Array(serialized, weightSpecsOffset + 4, weightSpecsBytes.length).set(weightSpecsBytes);\n    \n    // Write weight data\n    const weightDataOffset = weightSpecsOffset + 4 + weightSpecsBytes.length;\n    new Uint8Array(serialized, weightDataOffset).set(weightDataView);\n    \n    return { modelArtifactsInfo: { dateSaved: new Date(), modelTopologyType: 'JSON' } };\n  }));\n  \n  // Return the serialized data (this is a hack, we'll return empty ArrayBuffer and handle serialization differently)\n  // In a real implementation, we would properly serialize the model\n  return new ArrayBuffer(0);\n};\n\n// Main message handler\nself.onmessage = async (e: MessageEvent<TrainingRequest>) => {\n  const { type, data, config } = e.data;\n  \n  try {\n    switch (type) {\n      case 'train-emotion': {\n        if (!data.trackingEntries || data.trackingEntries.length < 7) {\n          throw new Error('Insufficient data for emotion model training (need at least 7 days)');\n        }\n        \n        const emotionResult = await trainEmotionModel(\n          data.trackingEntries,\n          config.epochs,\n          config.batchSize,\n          config.validationSplit,\n          config.earlyStopping\n        );\n        \n        const emotionResponse: TrainingResult = {\n          type: 'complete',\n          modelType: 'emotion-prediction',\n          model: await serializeModel(emotionResult.model),\n          metadata: emotionResult.metadata\n        };\n        \n        self.postMessage(emotionResponse);\n        break;\n      }\n        \n      case 'train-sensory': {\n        if (!data.trackingEntries || data.trackingEntries.length < 10) {\n          throw new Error('Insufficient data for sensory model training (need at least 10 sessions)');\n        }\n        \n        const sensoryResult = await trainSensoryModel(\n          data.trackingEntries,\n          config.epochs,\n          config.batchSize,\n          config.validationSplit,\n          config.earlyStopping\n        );\n        \n        const sensoryResponse: TrainingResult = {\n          type: 'complete',\n          modelType: 'sensory-response',\n          model: await serializeModel(sensoryResult.model),\n          metadata: sensoryResult.metadata\n        };\n        \n        self.postMessage(sensoryResponse);\n        break;\n      }\n        \n      case 'train-baseline': {\n        // Baseline clustering doesn't require training in the traditional sense\n        // It's computed on-demand, so we just send a success response\n        const baselineResponse: TrainingResult = {\n          type: 'complete',\n          modelType: 'baseline-clustering',\n          metadata: {\n            name: 'baseline-clustering',\n            version: '1.0.0',\n            createdAt: new Date(),\n            lastTrainedAt: new Date(),\n            inputShape: [4], // 4 features for clustering\n            outputShape: [3], // 3 clusters by default\n            architecture: 'K-means',\n            epochs: 0,\n            dataPoints: data.trackingEntries?.length || 0\n          }\n        };\n        \n        self.postMessage(baselineResponse);\n        break;\n      }\n        \n      default:\n        throw new Error(`Unknown training type: ${type}`);\n    }\n  } catch (error) {\n    const errorResponse: TrainingResult = {\n      type: 'error',\n      modelType: type.replace('train-', '') as ModelType,\n      error: error instanceof Error ? error.message : 'Training failed'\n    };\n    \n    self.postMessage(errorResponse);\n  }\n};\n\n// Export types for use in main thread\nexport type { TrainingRequest, TrainingProgress, TrainingResult, WorkerMessage };","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/src/workers/reports.worker.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1442,1445],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1442,1445],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":44,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1460,1463],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1460,1463],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":45,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1490,1493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1490,1493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1759,1762],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1759,1762],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":51,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1777,1780],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1777,1780],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":52,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1807,1810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1807,1810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"no-restricted-syntax","severity":1,"message":"addEventListener should be used inside useEffect with proper cleanup to prevent memory leaks","line":30,"column":1,"nodeType":"CallExpression","messageId":"restrictedSyntax","endLine":64,"endColumn":3,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable no-restricted-syntax */\n// Vite builds this as a module worker (see vite.config.ts worker.format = 'es')\nimport { exportSystem as ExportSystem } from '@/lib/exportSystem';\n\nexport type ReportsWorkerRequest = {\n  id: string;\n  kind: 'csv' | 'json';\n  payload: {\n    students: unknown[];\n    allData: {\n      trackingEntries: unknown[];\n      emotions: unknown[];\n      sensoryInputs: unknown[];\n      goals: unknown[];\n    };\n    options: {\n      format: 'csv' | 'json';\n      includeFields: string[];\n      dateRange?: { start: string; end: string } | null;\n      anonymize?: boolean;\n    };\n  };\n};\n\nexport type ReportsWorkerResponse =\n  | { id: string; type: 'progress'; progress: number; message?: string }\n  | { id: string; type: 'success'; content: string; kind: 'csv' | 'json' }\n  | { id: string; type: 'error'; error: string };\n\nself.addEventListener('message', (evt: MessageEvent<ReportsWorkerRequest>) => {\n  const msg = evt.data;\n  const respond = (data: ReportsWorkerResponse) => (self as unknown as Worker).postMessage(data);\n\n  try {\n    respond({ id: msg.id, type: 'progress', progress: 0.05, message: 'starting' });\n\n    const { students, allData, options } = msg.payload;\n\n    // Progress hint: filtering window\n    respond({ id: msg.id, type: 'progress', progress: 0.2, message: 'preparing' });\n\n    let content = '';\n    if (msg.kind === 'csv') {\n      content = ExportSystem.generateCSVExport(students as any[], allData as any, {\n        ...(options as any),\n        dateRange: options.dateRange\n          ? { start: new Date(options.dateRange.start), end: new Date(options.dateRange.end) }\n          : undefined,\n      });\n    } else if (msg.kind === 'json') {\n      content = ExportSystem.generateJSONExport(students as any[], allData as any, {\n        ...(options as any),\n        dateRange: options.dateRange\n          ? { start: new Date(options.dateRange.start), end: new Date(options.dateRange.end) }\n          : undefined,\n      });\n    }\n\n    respond({ id: msg.id, type: 'progress', progress: 0.95, message: 'finalizing' });\n    respond({ id: msg.id, type: 'success', content, kind: msg.kind });\n  } catch (e) {\n    respond({ id: msg.id, type: 'error', error: e instanceof Error ? e.message : 'Unknown error' });\n  }\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/bias/analytics.bias.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/e2e-smoke/smoke.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/e2e/a11y-smoke.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/e2e/aiAnalysisFeatureFlag.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/e2e/dashboard.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/e2e/devtools.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/e2e/export.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[343,346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[343,346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[593,596],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[593,596],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1201,1204],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1201,1204],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { test, expect } from '@playwright/test';\nimport { runAxeWithAppChromeHidden, writeAxeViolations } from '../utils/a11y';\n\ntest.describe('CSV export smoke (POC)', () => {\n  test('triggers export and shows success toast', async ({ page }) => {\n    await page.addInitScript(() => {\n      const orig = URL.createObjectURL;\n      (window as any).__exportHook = { urls: [] as string[] };\n      // @ts-expect-error Override URL.createObjectURL in test context to capture blob URLs\n      URL.createObjectURL = function(blob: Blob) {\n        const url = orig.call(URL, blob);\n        (window as any).__exportHook.urls.push(url);\n        return url;\n      } as typeof URL.createObjectURL;\n    });\n    await page.goto('/reports');\n\n    // Quick a11y check before triggering heavy work\n    const a11y = await runAxeWithAppChromeHidden(page);\n    await writeAxeViolations('export-page-pre', a11y);\n    expect(a11y.violations.length).toBe(0);\n\n    // Trigger CSV export directly from the Reports page\n    await page.getByTestId('export-csv').click();\n\n    // Assert that createObjectURL was invoked (blob created for CSV)\n    await expect.poll(async () => {\n      return await page.evaluate(() => (window as any).__exportHook?.urls?.length || 0);\n    }, { timeout: 5000, intervals: [200, 300, 500, 1000, 3000] }).toBeGreaterThan(0);\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/e2e/interactive-viz-edge.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/e2e/interactive-viz.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[881,884],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[881,884],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { test, expect } from '@playwright/test';\nimport { runAxeWithAppChromeHidden, writeAxeViolations } from '../utils/a11y';\n\ntest.describe('Interactive Visualization - Trends & Filters smoke', () => {\n  test('loads, opens filters, toggles views, and passes basic a11y checks', async ({ page }) => {\n    await page.goto('/e2e/interactive-viz');\n\n    // Title with student name should be visible\n    await expect(page.getByRole('heading', { name: /interactive data analysis -\\s*test student/i })).toBeVisible();\n\n    // Counts should be present\n    const counts = page.locator('[aria-label=\"Data counts\"]');\n    await expect(counts).toContainText(/emotions/i);\n    await expect(counts).toContainText(/sensory inputs/i);\n    await expect(counts).toContainText(/sessions/i);\n\n    // Helper for retrying a click action to reduce flakiness\n    async function clickWithRetry(locator: any, attempts = 3) {\n      for (let i = 0; i < attempts; i++) {\n        try {\n          await locator.click({ timeout: 1500 });\n          return;\n        } catch (e) {\n          if (i === attempts - 1) throw e;\n          await page.waitForTimeout(300);\n        }\n      }\n    }\n\n    // Open Filters panel (best-effort) and continue\n    await clickWithRetry(page.getByRole('button', { name: 'Filters' }));\n    await page.waitForTimeout(300);\n    // Close the sheet if open by pressing Escape\n    await page.keyboard.press('Escape');\n\n    // Switch layout to Focus Mode and back via the Layout dropdown (best-effort)\n    try {\n      const layoutBtn = page.getByTestId('layout-mode-trigger');\n      await layoutBtn.waitFor({ state: 'visible', timeout: 3000 });\n      await clickWithRetry(layoutBtn);\n      await clickWithRetry(page.getByText('Focus Mode'));\n\n      // Toggle a focused visualization (e.g., Trends)\n      await clickWithRetry(page.getByRole('button', { name: /trends/i }));\n\n      // Switch back to Dashboard layout\n      await clickWithRetry(layoutBtn);\n      await clickWithRetry(page.getByText('Dashboard'));\n    } catch {\n      // Non-fatal: continue\n    }\n\n    // Basic a11y check on the page\n    const accessibilityScanResults = await runAxeWithAppChromeHidden(page, {\n      tags: ['wcag2a', 'wcag2aa'],\n      disableRules: ['color-contrast', 'button-name']\n    });\n    // Log violations for debugging\n    console.log('AXE_VIOLATIONS_START');\n    console.log(JSON.stringify(accessibilityScanResults.violations, null, 2));\n    console.log('AXE_VIOLATIONS_END');\n    await writeAxeViolations('interactive-viz', accessibilityScanResults);\n    // Tight threshold: enforce zero violations\n    expect(accessibilityScanResults.violations.length).toBe(0);\n  });\n});\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/e2e/navigation.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/e2e/reports.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/e2e/user-journey.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/integration/analyticsManagerAI.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[783,786],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[783,786],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[857,860],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[857,860],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1057,1060],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1057,1060],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1642,1645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1642,1645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1986,1989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1986,1989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":74,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2344,2347],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2344,2347],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2953,2956],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2953,2956],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\n\nvi.mock('@/lib/analysis', () => {\n  class HeuristicAnalysisEngine {\n    analyzeStudent = vi.fn(async () => ({\n      patterns: [],\n      correlations: [],\n      environmentalCorrelations: [],\n      predictiveInsights: [],\n      anomalies: [],\n      insights: ['heuristic'],\n      ai: { provider: 'heuristic' },\n    }));\n  }\n  class LLMAnalysisEngine {\n    analyzeStudent = vi.fn(async () => ({\n      patterns: [],\n      correlations: [],\n      environmentalCorrelations: [],\n      predictiveInsights: [],\n      anomalies: [],\n      insights: ['ai'],\n      ai: { provider: 'openrouter' },\n    }));\n  }\n  return { HeuristicAnalysisEngine, LLMAnalysisEngine };\n});\n\nvi.mock('@/lib/aiConfig', async (orig) => {\n  const mod: any = await orig();\n  return {\n    ...mod,\n    loadAiConfig: (overrides?: any) => ({\n      ...mod.DEFAULT_AI_CONFIG,\n      enabled: true,\n      apiKey: 'test-key',\n      ...(overrides || {}),\n    }),\n  };\n});\n\nvi.mock('@/lib/analyticsConfig', async (orig) => {\n  const mod: any = await orig();\n  const cfg = { ...mod.DEFAULT_ANALYTICS_CONFIG, features: { ...mod.DEFAULT_ANALYTICS_CONFIG.features, aiAnalysisEnabled: true } };\n  return {\n    ...mod,\n    analyticsConfig: {\n      getConfig: () => cfg,\n      subscribe: () => () => {},\n    },\n  };\n});\n\ndescribe('analyticsManager AI integration', () => {\n  beforeEach(() => vi.clearAllMocks());\n\n  it('uses LLM engine when useAI true (runtime priority)', async () => {\n    const { analyticsManager } = await import('@/lib/analyticsManager');\n    const student = { id: 's1', name: 'S', createdAt: new Date() } as any;\n    const res = await analyticsManager.getStudentAnalytics(student, { useAI: true });\n    expect(res.ai?.provider).toBe('openrouter');\n  });\n\n  it('uses heuristic when useAI false', async () => {\n    const { analyticsManager } = await import('@/lib/analyticsManager');\n    const student = { id: 's2', name: 'S', createdAt: new Date() } as any;\n    const res = await analyticsManager.getStudentAnalytics(student, { useAI: false });\n    expect(res.ai?.provider).toBe('heuristic');\n  });\n\n  it('runtime toggle overrides config-disabled AI (precedence check)', async () => {\n    // Mock analytics config to disable AI analysis\n    vi.doMock('@/lib/analyticsConfig', async (orig) => {\n      const mod: any = await orig();\n      const disabledConfig = { \n        ...mod.DEFAULT_ANALYTICS_CONFIG, \n        features: { \n          ...mod.DEFAULT_ANALYTICS_CONFIG.features, \n          aiAnalysisEnabled: false \n        } \n      };\n      return {\n        ...mod,\n        analyticsConfig: {\n          getConfig: () => disabledConfig,\n          subscribe: () => () => {},\n        },\n      };\n    });\n\n    // Re-import with mocked config\n    vi.resetModules();\n    const { analyticsManager } = await import('@/lib/analyticsManager');\n    \n    const student = { id: 's3', name: 'Test Student', createdAt: new Date() } as any;\n    \n    // Test that runtime useAI: true overrides config aiAnalysisEnabled: false\n    const res = await analyticsManager.getStudentAnalytics(student, { useAI: true });\n    \n    // Should use LLM engine despite config being disabled (runtime priority)\n    expect(res.ai?.provider).toBe('openrouter');\n    \n    // Also test that useAI: false still works with disabled config\n    const res2 = await analyticsManager.getStudentAnalytics(student, { useAI: false });\n    expect(res2.ai?.provider).toBe('heuristic');\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/integration/analytics_data_flow.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AnalyticsResult' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":43},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[521,524],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[521,524],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1104,1107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1104,1107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1816,1819],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1816,1819],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'result1' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":325,"column":13,"nodeType":null,"messageId":"unusedVar","endLine":325,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":351,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":351,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10079,10082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10079,10082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":410,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":410,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11802,11805],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11802,11805],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, expect, it, beforeEach, afterEach, vi } from 'vitest';\nimport { AnalyticsManager } from '@/lib/analyticsManager';\nimport { analyticsConfig } from '@/lib/analyticsConfig';\nimport { generateCacheKey } from '@/lib/analytics/cache-key';\nimport type { SessionData, AnalyticsResult } from '@/types';\n\n// Mock worker module\nvi.mock('@/workers/analytics.worker', () => ({\n  default: class MockWorker {\n    private listeners: Map<string, (...args: unknown[]) => unknown> = new Map();\n    \n    postMessage(data: any) {\n      // Simulate worker processing\n      setTimeout(() => {\n        const message = this.processMessage(data);\n        const handler = this.listeners.get('message');\n        if (handler) {\n          handler({ data: message });\n        }\n      }, 10);\n    }\n    \n    addEventListener(event: string, handler: (...args: unknown[]) => unknown) {\n      this.listeners.set(event, handler);\n    }\n    \n    removeEventListener(event: string) {\n      this.listeners.delete(event);\n    }\n    \n    terminate() {\n      this.listeners.clear();\n    }\n    \n    private processMessage(data: any) {\n      switch (data.type) {\n        case 'ANALYZE':\n          return {\n            type: 'ANALYSIS_COMPLETE',\n            payload: {\n              success: true,\n              result: {\n                summary: {\n                  totalSessions: data.payload.sessions.length,\n                  averageDuration: 45,\n                  completionRate: 0.75,\n                },\n                patterns: [],\n                insights: [],\n                correlations: {},\n              },\n            },\n          };\n        case 'BATCH_ANALYZE':\n          return {\n            type: 'BATCH_COMPLETE',\n            payload: {\n              success: true,\n              results: data.payload.batches.map((batch: any) => ({\n                studentId: batch.studentId,\n                summary: {\n                  totalSessions: batch.sessions.length,\n                  averageDuration: 30,\n                  completionRate: 0.8,\n                },\n              })),\n            },\n          };\n        default:\n          return { type: 'ERROR', error: 'Unknown message type' };\n      }\n    }\n  },\n}));\n\ndescribe('Analytics Data Flow Integration', () => {\n  let manager: AnalyticsManager;\n  \n  beforeEach(() => {\n    vi.clearAllMocks();\n    localStorage.clear();\n    manager = new AnalyticsManager();\n  });\n  \n  afterEach(async () => {\n    await manager.cleanup();\n  });\n\n  describe('End-to-End Analytics Processing', () => {\n    it('processes single student data through the complete pipeline', async () => {\n      const sessions: SessionData[] = [\n        {\n          id: 'session-1',\n          studentId: 'student-1',\n          date: new Date().toISOString(),\n          duration: 30,\n          progress: 0.5,\n          tasks: [],\n        },\n        {\n          id: 'session-2',\n          studentId: 'student-1',\n          date: new Date().toISOString(),\n          duration: 60,\n          progress: 1.0,\n          tasks: [],\n        },\n      ];\n\n      const result = await manager.analyzeStudent('student-1', sessions);\n      \n      expect(result).toBeDefined();\n      expect(result.summary.totalSessions).toBe(2);\n      expect(result.summary.averageDuration).toBeGreaterThan(0);\n      expect(result.summary.completionRate).toBeGreaterThanOrEqual(0);\n      expect(result.summary.completionRate).toBeLessThanOrEqual(1);\n    });\n\n    it('handles batch processing for multiple students', async () => {\n      const batches = [\n        {\n          studentId: 'student-1',\n          sessions: [\n            {\n              id: 'session-1-1',\n              studentId: 'student-1',\n              date: new Date().toISOString(),\n              duration: 45,\n              progress: 0.7,\n              tasks: [],\n            },\n          ],\n        },\n        {\n          studentId: 'student-2',\n          sessions: [\n            {\n              id: 'session-2-1',\n              studentId: 'student-2',\n              date: new Date().toISOString(),\n              duration: 35,\n              progress: 0.9,\n              tasks: [],\n            },\n          ],\n        },\n      ];\n\n      const results = await manager.analyzeBatch(batches);\n      \n      expect(results).toHaveLength(2);\n      expect(results[0].studentId).toBe('student-1');\n      expect(results[1].studentId).toBe('student-2');\n      \n      results.forEach(result => {\n        expect(result.summary).toBeDefined();\n        expect(result.summary.totalSessions).toBeGreaterThan(0);\n      });\n    });\n\n    it('maintains data consistency across cache layers', async () => {\n      const sessions: SessionData[] = [\n        {\n          id: 'cached-session',\n          studentId: 'cached-student',\n          date: new Date().toISOString(),\n          duration: 40,\n          progress: 0.6,\n          tasks: [],\n        },\n      ];\n\n      // First analysis - should compute and cache\n      const result1 = await manager.analyzeStudent('cached-student', sessions);\n      \n      // Second analysis with same data - should use cache\n      const result2 = await manager.analyzeStudent('cached-student', sessions);\n      \n      expect(result1).toEqual(result2);\n      \n      // Verify cache key generation\n      const cacheKey = generateCacheKey('analytics', {\n        studentId: 'cached-student',\n        sessionCount: sessions.length,\n      });\n      \n      expect(cacheKey).toBeDefined();\n      expect(cacheKey).toContain('cached-student');\n    });\n  });\n\n  describe('Worker Communication', () => {\n    it('handles worker message passing correctly', async () => {\n      const messageSpy = vi.fn();\n      \n      // Intercept worker messages\n      const originalAnalyze = manager.analyzeStudent.bind(manager);\n      manager.analyzeStudent = async function(...args) {\n        messageSpy('analyze-called');\n        return originalAnalyze(...args);\n      };\n      \n      const sessions: SessionData[] = [\n        {\n          id: 'worker-test',\n          studentId: 'worker-student',\n          date: new Date().toISOString(),\n          duration: 25,\n          progress: 0.4,\n          tasks: [],\n        },\n      ];\n\n      await manager.analyzeStudent('worker-student', sessions);\n      \n      expect(messageSpy).toHaveBeenCalledWith('analyze-called');\n    });\n\n    it('handles worker errors gracefully', async () => {\n      // Mock worker error\n      vi.mock('@/workers/analytics.worker', () => ({\n        default: class ErrorWorker {\n          postMessage() {\n            setTimeout(() => {\n              this.onerror?.(new Error('Worker crashed'));\n            }, 10);\n          }\n          addEventListener() {}\n          removeEventListener() {}\n          terminate() {}\n          onerror?: (error: Error) => void;\n        },\n      }), { temporary: true });\n\n      const sessions: SessionData[] = [\n        {\n          id: 'error-session',\n          studentId: 'error-student',\n          date: new Date().toISOString(),\n          duration: 30,\n          progress: 0.5,\n          tasks: [],\n        },\n      ];\n\n      // Should fallback to main thread processing\n      const result = await manager.analyzeStudent('error-student', sessions);\n      expect(result).toBeDefined();\n    });\n\n    it('manages worker lifecycle properly', async () => {\n      const sessions: SessionData[] = [\n        {\n          id: 'lifecycle-test',\n          studentId: 'lifecycle-student',\n          date: new Date().toISOString(),\n          duration: 35,\n          progress: 0.8,\n          tasks: [],\n        },\n      ];\n\n      // Process multiple requests\n      const promises = Array.from({ length: 3 }, (_, i) => \n        manager.analyzeStudent(`student-${i}`, sessions)\n      );\n\n      const results = await Promise.all(promises);\n      \n      expect(results).toHaveLength(3);\n      results.forEach(result => {\n        expect(result).toBeDefined();\n        expect(result.summary).toBeDefined();\n      });\n\n      // Cleanup should terminate workers\n      await manager.cleanup();\n    });\n  });\n\n  describe('Configuration Integration', () => {\n    it('respects analytics configuration thresholds', async () => {\n      // Set custom thresholds\n      analyticsConfig.update({\n        thresholds: {\n          engagement: {\n            low: 0.3,\n            medium: 0.6,\n            high: 0.9,\n          },\n        },\n      });\n\n      const sessions: SessionData[] = [\n        {\n          id: 'config-test',\n          studentId: 'config-student',\n          date: new Date().toISOString(),\n          duration: 50,\n          progress: 0.7,\n          tasks: [],\n        },\n      ];\n\n      const result = await manager.analyzeStudent('config-student', sessions);\n      \n      expect(result).toBeDefined();\n      // Results should reflect configuration\n      expect(result.summary.completionRate).toBeDefined();\n    });\n\n    it('invalidates cache on configuration change', async () => {\n      const sessions: SessionData[] = [\n        {\n          id: 'cache-invalidation',\n          studentId: 'cache-student',\n          date: new Date().toISOString(),\n          duration: 40,\n          progress: 0.5,\n          tasks: [],\n        },\n      ];\n\n      // First analysis\n      const result1 = await manager.analyzeStudent('cache-student', sessions);\n      \n      // Change configuration\n      analyticsConfig.update({\n        features: {\n          enablePatternDetection: false,\n        },\n      });\n      \n      // Should recompute due to config change\n      const result2 = await manager.analyzeStudent('cache-student', sessions);\n      \n      // Results might differ due to configuration change\n      expect(result2).toBeDefined();\n    });\n  });\n\n  describe('Data Validation', () => {\n    it('validates input data before processing', async () => {\n      const invalidSessions = [\n        {\n          id: 'invalid',\n          studentId: '',  // Invalid: empty student ID\n          date: 'not-a-date',  // Invalid: bad date format\n          duration: -10,  // Invalid: negative duration\n          progress: 1.5,  // Invalid: progress > 1\n          tasks: null as any,  // Invalid: null tasks\n        },\n      ] as SessionData[];\n\n      await expect(\n        manager.analyzeStudent('', invalidSessions)\n      ).rejects.toThrow();\n    });\n\n    it('sanitizes and normalizes data', async () => {\n      const messySessions: SessionData[] = [\n        {\n          id: '  trimmed  ',\n          studentId: 'STUDENT-1',\n          date: new Date('2024-01-15').toISOString(),\n          duration: 3600,  // 1 hour in seconds\n          progress: 0.99999,  // Should be normalized to valid range\n          tasks: [],\n        },\n      ];\n\n      const result = await manager.analyzeStudent('student-1', messySessions);\n      \n      expect(result).toBeDefined();\n      expect(result.summary.totalSessions).toBe(1);\n    });\n  });\n\n  describe('Error Recovery', () => {\n    it('provides fallback results on partial failures', async () => {\n      const mixedSessions: SessionData[] = [\n        {\n          id: 'valid-1',\n          studentId: 'mixed-student',\n          date: new Date().toISOString(),\n          duration: 30,\n          progress: 0.5,\n          tasks: [],\n        },\n        {\n          id: 'valid-2',\n          studentId: 'mixed-student',\n          date: new Date().toISOString(),\n          duration: 45,\n          progress: 0.8,\n          tasks: [],\n        },\n      ];\n\n      const result = await manager.analyzeStudent('mixed-student', mixedSessions);\n      \n      // Should process valid sessions even if some fail\n      expect(result).toBeDefined();\n      expect(result.summary.totalSessions).toBeGreaterThan(0);\n    });\n\n    it('maintains state consistency after errors', async () => {\n      // Cause an error\n      await expect(\n        manager.analyzeStudent('error-student', null as any)\n      ).rejects.toThrow();\n\n      // Should still work for valid requests\n      const validSessions: SessionData[] = [\n        {\n          id: 'recovery-test',\n          studentId: 'recovery-student',\n          date: new Date().toISOString(),\n          duration: 35,\n          progress: 0.6,\n          tasks: [],\n        },\n      ];\n\n      const result = await manager.analyzeStudent('recovery-student', validSessions);\n      expect(result).toBeDefined();\n    });\n  });\n\n  describe('Performance Optimization', () => {\n    it('batches requests efficiently', async () => {\n      const startTime = performance.now();\n      \n      // Create multiple concurrent requests\n      const requests = Array.from({ length: 10 }, (_, i) => ({\n        studentId: `perf-student-${i}`,\n        sessions: [\n          {\n            id: `perf-session-${i}`,\n            studentId: `perf-student-${i}`,\n            date: new Date().toISOString(),\n            duration: 30 + i,\n            progress: 0.5 + (i * 0.05),\n            tasks: [],\n          },\n        ],\n      }));\n\n      const results = await manager.analyzeBatch(requests);\n      \n      const endTime = performance.now();\n      const totalTime = endTime - startTime;\n      \n      expect(results).toHaveLength(10);\n      // Should complete reasonably quickly (under 1 second for mock)\n      expect(totalTime).toBeLessThan(1000);\n    });\n\n    it('uses caching to improve repeated queries', async () => {\n      const sessions: SessionData[] = [\n        {\n          id: 'perf-cache',\n          studentId: 'perf-student',\n          date: new Date().toISOString(),\n          duration: 40,\n          progress: 0.7,\n          tasks: [],\n        },\n      ];\n\n      // First call - compute\n      const start1 = performance.now();\n      await manager.analyzeStudent('perf-student', sessions);\n      const time1 = performance.now() - start1;\n\n      // Second call - should use cache\n      const start2 = performance.now();\n      await manager.analyzeStudent('perf-student', sessions);\n      const time2 = performance.now() - start2;\n\n      // Cached call should be significantly faster\n      expect(time2).toBeLessThanOrEqual(time1);\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/integration/correlations_parity.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":7,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[300,303],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[300,303],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[953,956],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[953,956],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":28,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[984,987],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[984,987],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1119,1122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1119,1122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":117,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":120,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1320,1323],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1320,1323],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1598,1601],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1598,1601],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { patternAnalysis } from '@/lib/patternAnalysis';\nimport { analyticsWorkerFallback } from '@/lib/analyticsWorkerFallback';\n\n// Simple synthetic dataset to compare fallback vs local analysis path\nfunction makeEntries(n: number) {\n  const entries: any[] = [];\n  for (let i = 0; i < n; i++) {\n    entries.push({\n      id: `t${i}`,\n      studentId: 's1',\n      timestamp: new Date(Date.now() - (n - i) * 3600_000),\n      emotions: [],\n      sensoryInputs: [],\n      environmentalData: {\n        location: i % 2 === 0 ? 'classroom' : 'playground',\n        classroom: { activity: i % 3 === 0 ? 'instruction' : 'group-work', timeOfDay: 'morning' }\n      }\n    });\n  }\n  return entries;\n}\n\ndescribe('Environmental correlations parity: worker fallback vs direct', () => {\n  it('produces consistent top correlations on the same dataset', async () => {\n    const entries = makeEntries(30);\n    const emotions: any[] = [];\n    const sensory: any[] = [];\n\n    // Direct analysis via patternAnalysis\n    const direct = patternAnalysis.analyzeEnvironmentalCorrelations(entries as any);\n\n    // Fallback (routes internally, but we can simulate via processAnalytics)\n    const results = await analyticsWorkerFallback.processAnalytics({ entries, emotions, sensoryInputs: sensory } as any);\n    const viaFallback = results.environmentalCorrelations || results.correlations || [];\n\n    const topDirect = JSON.stringify(direct.slice(0, 3).map(c => ({ f1: c.factor1, f2: c.factor2 })));\n    const topFallback = JSON.stringify((viaFallback || []).slice(0, 3).map((c: any) => ({ f1: c.factor1, f2: c.factor2 })));\n\n    expect(topFallback).toBe(topDirect);\n  });\n});\n\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/integration/data_leakage_integration.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/integration/model_training_integration.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1553,1556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1553,1556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1599,1602],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1599,1602],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1769,1772],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1769,1772],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2532,2535],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2532,2535],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":80,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2622,2625],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2622,2625],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":90,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3058,3061],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3058,3061],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":91,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3111,3114],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3111,3114],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3742,3745],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3742,3745],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":107,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3780,3783],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3780,3783],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":114,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4098,4101],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4098,4101],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":115,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4151,4154],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4151,4154],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":131,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4954,4957],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4954,4957],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":133,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4992,4995],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4992,4995],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":138,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5299,5302],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5299,5302],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":139,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5356,5359],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5356,5359],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\nimport * as tf from '@tensorflow/tfjs';\nimport type { TrackingEntry, EmotionEntry, SensoryEntry } from '@/types/student';\n\nfunction makeEmotionEntry(id: string, emotion: string, intensity: number, ts: Date): EmotionEntry {\n  return {\n    id: `e-${id}`,\n    emotion,\n    intensity,\n    timestamp: ts,\n  } as EmotionEntry;\n}\n\nfunction makeSensoryEntry(id: string, type: string, response: string, ts: Date): SensoryEntry {\n  return {\n    id: `s-${id}`,\n    type,\n    response,\n    timestamp: ts,\n  } as SensoryEntry;\n}\n\nfunction makeTrackingEntries(days: number): TrackingEntry[] {\n  const entries: TrackingEntry[] = [];\n  const start = new Date('2024-01-01T00:00:00Z');\n  for (let i = 0; i < days; i++) {\n    const ts = new Date(start.getTime() + i * 24 * 60 * 60 * 1000);\n    const emotions: EmotionEntry[] = [\n      makeEmotionEntry(`${i}-h`, 'happy', (i % 10) / 10, ts),\n      makeEmotionEntry(`${i}-s`, 'sad', ((i + 3) % 10) / 10, ts),\n    ];\n    const sensoryInputs: SensoryEntry[] = [\n      makeSensoryEntry(`${i}-v`, 'visual', i % 2 === 0 ? 'seeking' : 'neutral', ts),\n      makeSensoryEntry(`${i}-a`, 'auditory', i % 3 === 0 ? 'avoiding' : 'neutral', ts),\n    ];\n    entries.push({\n      id: `t-${i}`,\n      studentId: 'stu-1',\n      timestamp: ts,\n      emotions,\n      sensoryInputs,\n      notes: `day-${i}`,\n    } as TrackingEntry);\n  }\n  return entries;\n}\n\ndescribe('Integration: preprocessing + model training worker', () => {\n  const originalPostMessage = (global as any).postMessage;\n  const selfObj = global as any;\n\n  beforeEach(async () => {\n    vi.clearAllMocks();\n    vi.resetModules();\n    // Ensure a worker-like global exists before loading the worker module\n    (global as any).self = global;\n    selfObj.postMessage = vi.fn();\n    // Ensure CPU backend to avoid GPU availability flakiness in CI\n     \n    tf.setBackend('cpu');\n    // Dynamically import the worker so it registers on the prepared self\n    await import('@/workers/mlTraining.worker');\n  });\n\n  afterEach(() => {\n    selfObj.postMessage = originalPostMessage;\n  });\n\n  // TODO(kb-analytics): Temporarily skipped for CI stability; TFJS-node backend not installed\n  it.skip('trains emotion model end-to-end and produces validation metadata', async () => {\n    const trackingEntries = makeTrackingEntries(12); // >= 7 required by worker\n\n    const message = {\n      type: 'train-emotion',\n      data: { trackingEntries },\n      config: { epochs: 1, batchSize: 8 },\n    } as any;\n\n    // Send message to the worker onmessage handler\n    const handler = (selfObj as any).onmessage as (e: MessageEvent) => Promise<void> | void;\n    expect(typeof handler).toBe('function');\n\n    await handler(new MessageEvent('message', { data: message }));\n\n    // Wait for async tfjs tasks to flush\n    await new Promise((r) => setTimeout(r, 10));\n\n    // Assert that a completion message was posted with validation results\n    expect(selfObj.postMessage).toHaveBeenCalled();\n    const calls = (selfObj.postMessage as any).mock.calls;\n    const complete = calls.find((c: any[]) => c[0]?.type === 'complete' && c[0]?.modelType === 'emotion-prediction');\n    expect(complete).toBeTruthy();\n    expect(complete[0].metadata).toBeDefined();\n    expect(complete[0].metadata.validationResults).toBeDefined();\n    expect(complete[0].metadata.validationResults.averageMetrics).toBeDefined();\n  }, 30000);\n\n  it('trains sensory model end-to-end and produces validation metadata', async () => {\n    const trackingEntries = makeTrackingEntries(15); // >= 10 required by worker\n\n    const message = {\n      type: 'train-sensory',\n      data: { trackingEntries },\n      config: { epochs: 1, batchSize: 8 },\n    } as any;\n\n    const handler = (selfObj as any).onmessage as (e: MessageEvent) => Promise<void> | void;\n    expect(typeof handler).toBe('function');\n\n    await handler(new MessageEvent('message', { data: message }));\n    await new Promise((r) => setTimeout(r, 10));\n\n    expect(selfObj.postMessage).toHaveBeenCalled();\n    const calls = (selfObj.postMessage as any).mock.calls;\n    const complete = calls.find((c: any[]) => c[0]?.type === 'complete' && c[0]?.modelType === 'sensory-response');\n    expect(complete).toBeTruthy();\n    expect(complete[0].metadata).toBeDefined();\n    expect(complete[0].metadata.validationResults).toBeDefined();\n    expect(complete[0].metadata.validationResults.averageMetrics).toBeDefined();\n  }, 30000);\n\n  it.skip('ensures fit/transform consistency in pipeline-derived tensors (sanity)', async () => {\n    // This sanity test ensures that when the worker rebuilds models after validation,\n    // the final training pass still runs on tensors constructed from preprocessing without shape drift.\n    const trackingEntries = makeTrackingEntries(8);\n\n    const message = {\n      type: 'train-emotion',\n      data: { trackingEntries },\n      config: { epochs: 1, batchSize: 4 },\n    } as any;\n\n    const handler = (selfObj as any).onmessage as (e: MessageEvent) => Promise<void> | void;\n    await handler(new MessageEvent('message', { data: message }));\n    await new Promise((r) => setTimeout(r, 10));\n\n    // Inspect logs payload for loss present (indicates final fit occurred on tensors)\n    const calls = (selfObj.postMessage as any).mock.calls;\n    const progresses = calls.filter((c: any[]) => c[0]?.type === 'progress' && c[0]?.modelType === 'emotion-prediction');\n    expect(progresses.length).toBeGreaterThan(0);\n    const lastProgress = progresses[progresses.length - 1][0];\n    expect(typeof lastProgress.loss).toBe('number');\n  }, 30000);\n});\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/integration/openrouterClient.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":9,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[299,302],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[299,302],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[373,376],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[373,376],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[840,843],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[840,843],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[953,956],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[953,956],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1542,1545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1542,1545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":57,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2201,2204],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2201,2204],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2496,2499],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2496,2499],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';\nimport { OpenRouterClient } from '@/lib/ai/openrouterClient';\n\nvi.mock('@/lib/errorHandler', () => ({\n  errorHandler: { handle: vi.fn(() => Promise.resolve()) },\n}));\n\nvi.mock('@/lib/aiConfig', async (orig) => {\n  const mod: any = await orig();\n  return {\n    ...mod,\n    loadAiConfig: (overrides?: any) => ({\n      ...mod.DEFAULT_AI_CONFIG,\n      enabled: true,\n      apiKey: 'test-key',\n      ...(overrides || {}),\n    }),\n  };\n});\n\ndescribe('OpenRouterClient integration (mocked fetch)', () => {\n  const realFetch = global.fetch;\n\n  beforeEach(() => {\n    vi.useFakeTimers();\n    // @ts-expect-error Mock global fetch with vi.fn for integration harness\n    global.fetch = vi.fn();\n  });\n  afterEach(() => {\n    vi.useRealTimers();\n    global.fetch = realFetch as any;\n    vi.clearAllMocks();\n  });\n\n  it('handles successful JSON chat call', async () => {\n    (global.fetch as any).mockResolvedValueOnce({\n      ok: true,\n      json: async () => ({ choices: [{ message: { content: '{\"ok\":true}' } }], model: 'gpt-4o-mini', usage: { prompt_tokens: 5, completion_tokens: 10, total_tokens: 15 } }),\n      headers: new Headers(),\n    });\n    const client = new OpenRouterClient();\n    const { data, response } = await client.chatJSON('{\"user\":\"hi\"}', { ensureJson: true });\n    expect(data).toEqual({ ok: true });\n    expect(response.usage.total_tokens).toBe(15);\n  });\n\n  it('retries on 429 with retry-after and eventually succeeds', async () => {\n    (global.fetch as any)\n      .mockResolvedValueOnce({ ok: false, status: 429, text: async () => JSON.stringify({ error: { message: 'rate limit' } }), headers: new Headers({ 'retry-after': '1' }) })\n      .mockResolvedValueOnce({ ok: true, json: async () => ({ choices: [{ message: { content: '{\"ok\":true}' } }], model: 'gpt-4o-mini' }), headers: new Headers() });\n    const client = new OpenRouterClient({ maxRetries: 1, baseDelayMs: 10, maxDelayMs: 50 });\n    const { data } = await client.chatJSON('{\"user\":\"hi\"}', { ensureJson: true });\n    expect(data).toEqual({ ok: true });\n  });\n\n  it('times out and throws recoverable timeout error', async () => {\n    (global.fetch as any).mockImplementationOnce(() => new Promise(() => {}));\n    const client = new OpenRouterClient({ timeoutMs: 10, maxRetries: 0 });\n    await expect(client.chatJSON('{\"user\":\"hi\"}')).rejects.toBeTruthy();\n  });\n\n  it('handles non-retriable 400-level errors', async () => {\n    (global.fetch as any).mockResolvedValueOnce({ ok: false, status: 400, text: async () => 'bad', headers: new Headers() });\n    const client = new OpenRouterClient({ maxRetries: 0 });\n    await expect(client.chatJSON('{\"user\":\"hi\"}')).rejects.toBeTruthy();\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/integration/pipeline_persistence_integration.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'fitted' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":25,"column":11,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { PreprocessingPipeline } from '@/lib/PreprocessingPipeline';\nimport { AnyStepConfig } from '@/types/preprocessing';\n\n// These tests assert persistence/recovery and schema evolution compatibility for pipeline metadata\n\ndescribe('Integration: preprocessing state persistence and recovery', () => {\n  function dataset() {\n    return [\n      { num: 1, cat: 'a', note: ' hi ' },\n      { num: 2, cat: 'b', note: 'there' },\n      { num: 3, cat: 'a', note: '  ok ' },\n    ];\n  }\n\n  it('persists fitted state and recovers identical transforms', () => {\n    const cfg: AnyStepConfig[] = [\n      { name: 'clean', kind: 'cleaning', dropAllNullColumns: true, trimStrings: true },\n      { name: 'scale', kind: 'scaling' },\n      { name: 'encode', kind: 'encoding', oneHotMaxCategories: 10 },\n      { name: 'poly', kind: 'feature_engineering', polynomialDegree: 2 },\n    ];\n\n    const pipe = new PreprocessingPipeline(cfg);\n    const fitted = pipe.fit(dataset());\n    const payload = pipe.toJSON();\n\n    const restored = PreprocessingPipeline.fromJSON(payload);\n    const originalOut = pipe.transform(dataset());\n    const restoredOut = restored.transform(dataset());\n\n    expect(restoredOut).toEqual(originalOut);\n    expect(payload.metadata.pipelineVersion).toBeDefined();\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/integration/schema_evolution_integration.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/performance/analytics.performance.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'i' is defined but never used. Allowed unused args must match /^_/u.","line":99,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":99,"endColumn":56},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used. Allowed unused caught errors must match /^_/u.","line":232,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":232,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, expect, it, beforeEach, afterEach } from 'vitest';\nimport { performance } from 'perf_hooks';\nimport { AnalyticsManager } from '@/lib/analyticsManager';\nimport { dataTransformations } from '@/lib/dataTransformations';\nimport { enhancedPatternAnalysis } from '@/lib/enhancedPatternAnalysis';\nimport type { SessionData } from '@/types';\n\n// Performance thresholds from CI environment\nconst CI_PERF_THRESHOLD_MS = Number(process.env.CI_PERF_THRESHOLD_MS) || 1500;\nconst OPERATIONS_PER_SECOND_TARGET = 1000;\nconst MEMORY_THRESHOLD_MB = 50;\n\n// Helper to measure execution time\nasync function measurePerformance<T>(\n  name: string,\n  fn: () => Promise<T> | T\n): Promise<{ result: T; duration: number; memory: number }> {\n  const startMemory = process.memoryUsage().heapUsed;\n  const startTime = performance.now();\n  \n  const result = await fn();\n  \n  const endTime = performance.now();\n  const endMemory = process.memoryUsage().heapUsed;\n  \n  return {\n    result,\n    duration: endTime - startTime,\n    memory: (endMemory - startMemory) / 1024 / 1024, // Convert to MB\n  };\n}\n\n// Generate test data\nfunction generateLargeDataset(size: number): SessionData[] {\n  return Array.from({ length: size }, (_, i) => ({\n    id: `session-${i}`,\n    studentId: `student-${i % 100}`,\n    date: new Date(Date.now() - i * 86400000).toISOString(),\n    duration: 30 + (i % 60),\n    progress: Math.random(),\n    tasks: Array.from({ length: 5 }, (_, j) => ({\n      id: `task-${i}-${j}`,\n      name: `Task ${j}`,\n      completed: Math.random() > 0.5,\n      score: Math.random() * 100,\n    })),\n  }));\n}\n\ndescribe('Analytics Performance Tests', () => {\n  let manager: AnalyticsManager;\n  \n  beforeEach(() => {\n    manager = new AnalyticsManager();\n  });\n  \n  afterEach(async () => {\n    await manager.cleanup();\n  });\n\n  describe('Data Processing Performance', () => {\n    it('processes small dataset within threshold', async () => {\n      const data = generateLargeDataset(100);\n      \n      const { duration, memory } = await measurePerformance(\n        'small-dataset',\n        () => manager.analyzeStudent('student-1', data)\n      );\n      \n      expect(duration).toBeLessThan(CI_PERF_THRESHOLD_MS / 10);\n      expect(memory).toBeLessThan(MEMORY_THRESHOLD_MB / 10);\n    });\n\n    it('processes medium dataset within threshold', async () => {\n      const data = generateLargeDataset(1000);\n      \n      const { duration, memory } = await measurePerformance(\n        'medium-dataset',\n        () => manager.analyzeStudent('student-1', data)\n      );\n      \n      expect(duration).toBeLessThan(CI_PERF_THRESHOLD_MS / 2);\n      expect(memory).toBeLessThan(MEMORY_THRESHOLD_MB / 2);\n    });\n\n    it('processes large dataset within threshold', async () => {\n      const data = generateLargeDataset(5000);\n      \n      const { duration, memory } = await measurePerformance(\n        'large-dataset',\n        () => manager.analyzeStudent('student-1', data)\n      );\n      \n      expect(duration).toBeLessThan(CI_PERF_THRESHOLD_MS);\n      expect(memory).toBeLessThan(MEMORY_THRESHOLD_MB);\n    });\n\n    it('handles concurrent processing efficiently', async () => {\n      const datasets = Array.from({ length: 10 }, (_, i) => \n        generateLargeDataset(500)\n      );\n      \n      const startTime = performance.now();\n      \n      const promises = datasets.map((data, i) => \n        manager.analyzeStudent(`student-${i}`, data)\n      );\n      \n      await Promise.all(promises);\n      \n      const totalDuration = performance.now() - startTime;\n      \n      // Concurrent processing should be faster than sequential\n      expect(totalDuration).toBeLessThan(CI_PERF_THRESHOLD_MS * 3);\n    });\n  });\n\n  describe('Data Transformation Performance', () => {\n    it('normalizes data efficiently', async () => {\n      const data = generateLargeDataset(10000);\n      \n      const { duration } = await measurePerformance(\n        'normalization',\n        () => dataTransformations.normalize(data)\n      );\n      \n      const operationsPerSecond = (data.length / duration) * 1000;\n      expect(operationsPerSecond).toBeGreaterThan(OPERATIONS_PER_SECOND_TARGET);\n    });\n\n    it('aggregates data efficiently', async () => {\n      const data = generateLargeDataset(10000);\n      \n      const { duration } = await measurePerformance(\n        'aggregation',\n        () => dataTransformations.aggregate(data, 'daily')\n      );\n      \n      expect(duration).toBeLessThan(CI_PERF_THRESHOLD_MS / 2);\n    });\n\n    it('filters data efficiently', async () => {\n      const data = generateLargeDataset(10000);\n      \n      const { duration } = await measurePerformance(\n        'filtering',\n        () => dataTransformations.filter(data, {\n          dateRange: {\n            start: new Date(Date.now() - 30 * 86400000),\n            end: new Date(),\n          },\n          minProgress: 0.5,\n        })\n      );\n      \n      const operationsPerSecond = (data.length / duration) * 1000;\n      expect(operationsPerSecond).toBeGreaterThan(OPERATIONS_PER_SECOND_TARGET * 2);\n    });\n  });\n\n  describe('Pattern Analysis Performance', () => {\n    it('detects patterns in reasonable time', async () => {\n      const data = generateLargeDataset(2000);\n      \n      const { duration, memory } = await measurePerformance(\n        'pattern-detection',\n        () => enhancedPatternAnalysis.detectPatterns(data)\n      );\n      \n      expect(duration).toBeLessThan(CI_PERF_THRESHOLD_MS);\n      expect(memory).toBeLessThan(MEMORY_THRESHOLD_MB);\n    });\n\n    it('identifies correlations efficiently', async () => {\n      const data = generateLargeDataset(1000);\n      \n      const { duration } = await measurePerformance(\n        'correlation-analysis',\n        () => enhancedPatternAnalysis.findCorrelations(data)\n      );\n      \n      expect(duration).toBeLessThan(CI_PERF_THRESHOLD_MS / 2);\n    });\n\n    it('generates insights quickly', async () => {\n      const data = generateLargeDataset(1500);\n      \n      const { duration } = await measurePerformance(\n        'insight-generation',\n        () => enhancedPatternAnalysis.generateInsights(data)\n      );\n      \n      expect(duration).toBeLessThan(CI_PERF_THRESHOLD_MS / 3);\n    });\n  });\n\n  describe('Memory Management', () => {\n    it('releases memory after processing', async () => {\n      const initialMemory = process.memoryUsage().heapUsed / 1024 / 1024;\n      \n      // Process large dataset\n      const data = generateLargeDataset(5000);\n      await manager.analyzeStudent('student-1', data);\n      \n      // Force garbage collection if available\n      if (global.gc) {\n        global.gc();\n      }\n      \n      // Wait a bit for cleanup\n      await new Promise(resolve => setTimeout(resolve, 100));\n      \n      const finalMemory = process.memoryUsage().heapUsed / 1024 / 1024;\n      const memoryIncrease = finalMemory - initialMemory;\n      \n      // Memory increase should be minimal after cleanup\n      expect(memoryIncrease).toBeLessThan(10);\n    });\n\n    it('handles memory pressure gracefully', async () => {\n      const datasets = Array.from({ length: 50 }, () => \n        generateLargeDataset(1000)\n      );\n      \n      let processedCount = 0;\n      let errorCount = 0;\n      \n      for (const data of datasets) {\n        try {\n          await manager.analyzeStudent(`student-${processedCount}`, data);\n          processedCount++;\n        } catch (error) {\n          errorCount++;\n        }\n      }\n      \n      // Should process most datasets without errors\n      expect(processedCount).toBeGreaterThan(45);\n      expect(errorCount).toBeLessThan(5);\n    });\n  });\n\n  describe('Cache Performance', () => {\n    it('cache lookups are fast', async () => {\n      const data = generateLargeDataset(1000);\n      \n      // First call - compute\n      await manager.analyzeStudent('cached-student', data);\n      \n      // Second call - should use cache\n      const { duration } = await measurePerformance(\n        'cache-lookup',\n        () => manager.analyzeStudent('cached-student', data)\n      );\n      \n      // Cache lookup should be very fast\n      expect(duration).toBeLessThan(10);\n    });\n\n    it('cache invalidation is efficient', async () => {\n      const datasets = Array.from({ length: 100 }, (_, i) => ({\n        id: `student-${i}`,\n        data: generateLargeDataset(100),\n      }));\n      \n      // Fill cache\n      for (const { id, data } of datasets) {\n        await manager.analyzeStudent(id, data);\n      }\n      \n      const { duration } = await measurePerformance(\n        'cache-invalidation',\n        () => manager.clearCache()\n      );\n      \n      // Clearing cache should be fast\n      expect(duration).toBeLessThan(100);\n    });\n  });\n\n  describe('Worker Performance', () => {\n    it('worker initialization is fast', async () => {\n      const { duration } = await measurePerformance(\n        'worker-init',\n        () => manager.initializeWorker()\n      );\n      \n      expect(duration).toBeLessThan(100);\n    });\n\n    it('worker communication has low overhead', async () => {\n      const data = generateLargeDataset(500);\n      \n      // Measure with worker\n      const { duration: withWorker } = await measurePerformance(\n        'with-worker',\n        () => manager.analyzeStudent('worker-test', data)\n      );\n      \n      // Measure without worker (fallback)\n      manager.disableWorker();\n      const { duration: withoutWorker } = await measurePerformance(\n        'without-worker',\n        () => manager.analyzeStudent('fallback-test', data)\n      );\n      \n      // Worker overhead should be minimal\n      const overhead = withWorker - withoutWorker;\n      expect(Math.abs(overhead)).toBeLessThan(50);\n    });\n  });\n\n  describe('Scalability Tests', () => {\n    it('scales linearly with data size', async () => {\n      const sizes = [100, 500, 1000, 2000];\n      const durations: number[] = [];\n      \n      for (const size of sizes) {\n        const data = generateLargeDataset(size);\n        const { duration } = await measurePerformance(\n          `scale-${size}`,\n          () => manager.analyzeStudent('scale-test', data)\n        );\n        durations.push(duration);\n      }\n      \n      // Check if scaling is roughly linear\n      for (let i = 1; i < sizes.length; i++) {\n        const sizeRatio = sizes[i] / sizes[i - 1];\n        const durationRatio = durations[i] / durations[i - 1];\n        \n        // Allow some deviation from linear scaling\n        expect(durationRatio).toBeGreaterThan(sizeRatio * 0.7);\n        expect(durationRatio).toBeLessThan(sizeRatio * 1.5);\n      }\n    });\n\n    it('handles edge cases efficiently', async () => {\n      const edgeCases = [\n        { name: 'empty', data: [] },\n        { name: 'single', data: generateLargeDataset(1) },\n        { name: 'duplicates', data: Array(1000).fill(generateLargeDataset(1)[0]) },\n        { name: 'sparse', data: generateLargeDataset(100).filter((_, i) => i % 10 === 0) },\n      ];\n      \n      for (const { name, data } of edgeCases) {\n        const { duration } = await measurePerformance(\n          `edge-${name}`,\n          () => manager.analyzeStudent(`edge-${name}`, data)\n        );\n        \n        // Edge cases should be handled quickly\n        expect(duration).toBeLessThan(100);\n      }\n    });\n  });\n\n  describe('Benchmark Suite', () => {\n    it('comprehensive benchmark', async () => {\n      const results = {\n        smallDataset: 0,\n        mediumDataset: 0,\n        largeDataset: 0,\n        patternDetection: 0,\n        concurrentProcessing: 0,\n        cachePerformance: 0,\n      };\n      \n      // Small dataset\n      const small = await measurePerformance(\n        'benchmark-small',\n        () => manager.analyzeStudent('bench-1', generateLargeDataset(100))\n      );\n      results.smallDataset = small.duration;\n      \n      // Medium dataset\n      const medium = await measurePerformance(\n        'benchmark-medium',\n        () => manager.analyzeStudent('bench-2', generateLargeDataset(1000))\n      );\n      results.mediumDataset = medium.duration;\n      \n      // Large dataset\n      const large = await measurePerformance(\n        'benchmark-large',\n        () => manager.analyzeStudent('bench-3', generateLargeDataset(5000))\n      );\n      results.largeDataset = large.duration;\n      \n      // Pattern detection\n      const patterns = await measurePerformance(\n        'benchmark-patterns',\n        () => enhancedPatternAnalysis.detectPatterns(generateLargeDataset(2000))\n      );\n      results.patternDetection = patterns.duration;\n      \n      // Concurrent processing\n      const concurrent = await measurePerformance(\n        'benchmark-concurrent',\n        () => Promise.all(\n          Array.from({ length: 5 }, (_, i) => \n            manager.analyzeStudent(`concurrent-${i}`, generateLargeDataset(500))\n          )\n        )\n      );\n      results.concurrentProcessing = concurrent.duration;\n      \n      // Cache performance\n      const cacheData = generateLargeDataset(1000);\n      await manager.analyzeStudent('cache-test', cacheData);\n      const cache = await measurePerformance(\n        'benchmark-cache',\n        () => manager.analyzeStudent('cache-test', cacheData)\n      );\n      results.cachePerformance = cache.duration;\n      \n      // Log benchmark results\n      console.log('Performance Benchmark Results:', results);\n      \n      // Verify all benchmarks pass thresholds\n      expect(results.smallDataset).toBeLessThan(CI_PERF_THRESHOLD_MS / 10);\n      expect(results.mediumDataset).toBeLessThan(CI_PERF_THRESHOLD_MS / 2);\n      expect(results.largeDataset).toBeLessThan(CI_PERF_THRESHOLD_MS);\n      expect(results.patternDetection).toBeLessThan(CI_PERF_THRESHOLD_MS);\n      expect(results.concurrentProcessing).toBeLessThan(CI_PERF_THRESHOLD_MS * 2);\n      expect(results.cachePerformance).toBeLessThan(10);\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/preprocessing/dataLeakage.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/preprocessing/pipeline.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":56,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2131,2134],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2131,2134],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { PreprocessingPipeline } from '@/lib/PreprocessingPipeline';\nimport { AnyStepConfig, SerializedPipeline } from '@/types/preprocessing';\n\nfunction sampleData() {\n  return [\n    { a: 1, b: 'x', keep: 1 },\n    { a: 3, b: 'y', keep: 2 },\n    { a: 5, b: 'x', keep: 3 },\n  ];\n}\n\ndescribe('PreprocessingPipeline', () => {\n  test('fit/transform determinism and schema metadata', () => {\n    const cfg: AnyStepConfig[] = [\n      { name: 'clean', kind: 'cleaning', dropAllNullColumns: true },\n      { name: 'scale', kind: 'scaling', method: 'standard' },\n      { name: 'encode', kind: 'encoding', oneHotMaxCategories: 10 },\n      { name: 'poly', kind: 'feature_engineering', polynomialDegree: 2 },\n    ];\n    const pipe = new PreprocessingPipeline(cfg);\n    const fitted = pipe.fit(sampleData());\n    const meta = pipe.getMetadata();\n    expect(meta?.pipelineVersion).toBeDefined();\n    expect(Array.isArray(meta?.dataSchema.columns)).toBe(true);\n    const again = pipe.transform(sampleData());\n    // transform after fit should be consistent\n    expect(again).toEqual(fitted);\n  });\n\n  test('serialization and deserialization', () => {\n    const cfg: AnyStepConfig[] = [\n      { name: 'clean', kind: 'cleaning', dropAllNullColumns: true },\n      { name: 'scale', kind: 'scaling' },\n      { name: 'encode', kind: 'encoding', oneHotMaxCategories: 10 },\n    ];\n    const pipe = new PreprocessingPipeline(cfg);\n    pipe.fit(sampleData());\n    const payload = pipe.toJSON();\n\n    const restored = PreprocessingPipeline.fromJSON(payload as SerializedPipeline);\n    const transformedOriginal = pipe.transform(sampleData());\n    const transformedRestored = restored.transform(sampleData());\n\n    expect(transformedRestored).toEqual(transformedOriginal);\n  });\n\n  test('edge cases: empty data, single sample, extreme values', () => {\n    const cfg: AnyStepConfig[] = [\n      { name: 'scale', kind: 'scaling' },\n      { name: 'encode', kind: 'encoding', oneHotMaxCategories: 10 },\n      { name: 'poly', kind: 'feature_engineering', polynomialDegree: 2 },\n    ];\n    const pipe = new PreprocessingPipeline(cfg);\n\n    // Empty\n    const empty: any[] = [];\n    const emptyOut = pipe.fit(empty);\n    expect(emptyOut).toEqual([]);\n\n    // Single sample\n    const single = [{ a: 1, b: 'x' }];\n    pipe.fit(single);\n    const singleOut = pipe.transform(single);\n    expect(Array.isArray(singleOut)).toBe(true);\n\n    // Extreme values\n    const extreme = [\n      { a: 1e12, b: 'big' },\n      { a: -1e12, b: 'small' },\n    ];\n    pipe.fit(extreme);\n    const out = pipe.transform(extreme);\n    expect(out.length).toBe(2);\n  });\n\n  test('consistency between training (fit) and inference (transform) sequences', () => {\n    const cfg: AnyStepConfig[] = [\n      { name: 'clean', kind: 'cleaning', dropAllNullColumns: true },\n      { name: 'scale', kind: 'scaling' },\n      { name: 'encode', kind: 'encoding', oneHotMaxCategories: 10 },\n    ];\n    const pipe = new PreprocessingPipeline(cfg);\n    const trainTransformed = pipe.fit(sampleData());\n    const inferTransformed = pipe.transform(sampleData());\n    expect(inferTransformed).toEqual(trainTransformed);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/setup.dom.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1031,1034],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1031,1034],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1429,1432],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1429,1432],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1481,1484],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1481,1484],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1521,1524],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1521,1524],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1682,1685],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1682,1685],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":47,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1728,1731],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1728,1731],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1785,1788],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1785,1788],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":48,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1798,1801],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1798,1801],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * JSDOM and browser API shims to reduce animation/portal noise in tests\n */\nimport { vi } from 'vitest';\n\n// Prefer reduced motion in tests to minimize animations/transitions\nif (!('matchMedia' in window)) {\n  // @ts-expect-error jsdom shim\n  window.matchMedia = (query: string) => {\n    const listeners = new Set<(e: MediaQueryListEvent) => void>();\n    const mql: MediaQueryList = {\n      media: query,\n      matches: /prefers-reduced-motion:\\s*reduce/i.test(query),\n      onchange: null,\n      addListener: (cb: (e: MediaQueryListEvent) => void) => listeners.add(cb), // deprecated\n      removeListener: (cb: (e: MediaQueryListEvent) => void) => listeners.delete(cb), // deprecated\n      addEventListener: (_: string, cb: (e: MediaQueryListEvent) => void) => listeners.add(cb),\n      removeEventListener: (_: string, cb: (e: MediaQueryListEvent) => void) => listeners.delete(cb),\n      dispatchEvent: (ev: Event) => {\n        listeners.forEach((cb) => cb(ev as MediaQueryListEvent));\n        return true;\n      },\n    } as any;\n    return mql;\n  };\n}\n\n// requestAnimationFrame polyfill to run timers immediately\nif (!('requestAnimationFrame' in window)) {\n  // @ts-expect-error jsdom shim\n  window.requestAnimationFrame = (cb: FrameRequestCallback) => setTimeout(() => cb(Date.now()), 0) as unknown as number;\n  // @ts-expect-error jsdom shim\n  window.cancelAnimationFrame = (id: number) => clearTimeout(id as unknown as any);\n}\n\n// ResizeObserver mock\nif (!(globalThis as any).ResizeObserver) {\n  (globalThis as any).ResizeObserver = class {\n    observe = vi.fn();\n    unobserve = vi.fn();\n    disconnect = vi.fn();\n  };\n}\n\n// IntersectionObserver mock\nif (!(globalThis as any).IntersectionObserver) {\n  (globalThis as any).IntersectionObserver = class {\n    constructor(_cb: any, _opts?: any) {}\n    observe = vi.fn();\n    unobserve = vi.fn();\n    disconnect = vi.fn();\n    takeRecords = vi.fn(() => []);\n    root = null;\n    rootMargin = '0px';\n    thresholds = [0];\n  };\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/setup.polyfills.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[250,253],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[250,253],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":8,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[333,336],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[333,336],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":24,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[915,918],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[915,918],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[947,950],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[947,950],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":25,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[975,978],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[975,978],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * Global storage and window polyfills for Node test environment.\n * Loaded by Vitest via setupFiles in vitest.config.ts before any test imports.\n */\nconst defineStorage = (targetKey: 'localStorage' | 'sessionStorage') => {\n  if (!(globalThis as any)[targetKey]) {\n    const store = new Map<string, string>();\n    (globalThis as any)[targetKey] = {\n      getItem: (k: string) => (store.has(k) ? store.get(k)! : null),\n      setItem: (k: string, v: string) => { store.set(k, String(v)); },\n      removeItem: (k: string) => { store.delete(k); },\n      clear: () => { store.clear(); },\n      key: (i: number) => Array.from(store.keys())[i] ?? null,\n      get length() { return store.size; }\n    };\n  }\n};\n\ndefineStorage('localStorage');\ndefineStorage('sessionStorage');\n\n// Provide a minimal window shim for tests that reference window.*\n// In Node environment, window is undefined by default.\nif (!(globalThis as any).window) {\n  (globalThis as any).window = globalThis as any;\n}","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/setup.radix.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/setup.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[786,789],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[786,789],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":26,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[820,823],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[820,823],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":29,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[944,947],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[944,947],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[994,997],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[994,997],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":33,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1062,1065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1062,1065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":34,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1112,1115],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1112,1115],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1184,1187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1184,1187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1238,1241],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1238,1241],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import '@testing-library/jest-dom/vitest';\nimport { cleanup } from '@testing-library/react';\nimport { afterEach, vi } from 'vitest';\n\nimport analyticsEn from '@/locales/en/analytics.json';\nimport commonEn from '@/locales/en/common.json';\nimport dashboardEn from '@/locales/en/dashboard.json';\nimport settingsEn from '@/locales/en/settings.json';\nimport studentEn from '@/locales/en/student.json';\nimport trackingEn from '@/locales/en/tracking.json';\n\n// Mock IndexedDB for jsdom environment\nconst mockIndexedDB = {\n  open: vi.fn().mockReturnThis(),\n  transaction: vi.fn().mockReturnThis(),\n  objectStore: vi.fn().mockReturnThis(),\n  get: vi.fn(),\n  put: vi.fn(),\n  delete: vi.fn(),\n  createIndex: vi.fn(),\n  onupgradeneeded: null,\n  onsuccess: null,\n  onerror: null,\n};\n\n(globalThis as any).indexedDB = mockIndexedDB as any;\n\n// jsdom lacks pointer capture APIs used by Radix Select; provide minimal no-op polyfills.\nif (!(Element.prototype as any).hasPointerCapture) {\n  (Element.prototype as any).hasPointerCapture = () => false;\n}\n\nif (!(Element.prototype as any).setPointerCapture) {\n  (Element.prototype as any).setPointerCapture = () => undefined;\n}\n\nif (!(Element.prototype as any).releasePointerCapture) {\n  (Element.prototype as any).releasePointerCapture = () => undefined;\n}\n\nif (!Element.prototype.scrollIntoView) {\n  Element.prototype.scrollIntoView = () => undefined;\n}\n\ntype TranslationDictionary = Record<string, string>;\n\nconst flattenTranslations = (input: unknown, prefix = ''): TranslationDictionary => {\n  if (input == null || typeof input !== 'object') {\n    return {};\n  }\n\n  return Object.entries(input as Record<string, unknown>).reduce((acc, [key, value]) => {\n    const path = prefix ? `${prefix}.${key}` : key;\n\n    if (typeof value === 'string') {\n      acc[path] = value;\n      return acc;\n    }\n\n    if (Array.isArray(value)) {\n      value.forEach((item, index) => {\n        if (typeof item === 'string') {\n          acc[`${path}.${index}`] = item;\n        } else if (item && typeof item === 'object') {\n          Object.assign(acc, flattenTranslations(item, `${path}.${index}`));\n        }\n      });\n      return acc;\n    }\n\n    Object.assign(acc, flattenTranslations(value, path));\n    return acc;\n  }, {} as TranslationDictionary);\n};\n\nconst translationsByNamespace: Record<string, TranslationDictionary> = {\n  analytics: flattenTranslations(analyticsEn),\n  common: flattenTranslations(commonEn),\n  dashboard: flattenTranslations(dashboardEn),\n  settings: flattenTranslations(settingsEn),\n  student: flattenTranslations(studentEn),\n  tracking: flattenTranslations(trackingEn),\n  translation: {},\n};\n\nconst interpolate = (template: string, values: Record<string, unknown>): string =>\n  template.replace(/\\{\\{\\s*(\\w+)\\s*\\}\\}/g, (_, token: string) => {\n    const value = values[token];\n    return value == null ? '' : String(value);\n  });\n\nconst createTranslator = (defaultNamespace: string | undefined) => {\n  const translate = (key: string, options: Record<string, unknown> = {}): string => {\n    const { ns, defaultValue, ...replacements } = options;\n    const namespacesToTry = [ns as string | undefined, defaultNamespace, 'common'].filter(Boolean) as string[];\n\n    for (const namespace of namespacesToTry) {\n      const dictionary = translationsByNamespace[namespace];\n      if (!dictionary) continue;\n      const raw = dictionary[key];\n      if (raw != null) {\n        return interpolate(String(raw), replacements);\n      }\n    }\n\n    if (typeof defaultValue === 'string') {\n      return interpolate(defaultValue, replacements);\n    }\n\n    return interpolate(key, replacements);\n  };\n\n  const namespaced = (namespace: string) => (key: string, options?: Record<string, unknown>) =>\n    translate(key, { ...options, ns: namespace });\n\n  const formatLocale = 'en-US';\n\n  return {\n    t: translate,\n    tCommon: namespaced('common'),\n    tDashboard: namespaced('dashboard'),\n    tStudent: namespaced('student'),\n    tTracking: namespaced('tracking'),\n    tAnalytics: namespaced('analytics'),\n    tSettings: namespaced('settings'),\n    changeLanguage: () => undefined,\n    currentLanguage: 'en' as const,\n    formatDate: (date: Date) =>\n      new Intl.DateTimeFormat(formatLocale, {\n        year: 'numeric',\n        month: '2-digit',\n        day: '2-digit',\n      }).format(date),\n    formatDateTime: (date: Date) =>\n      new Intl.DateTimeFormat(formatLocale, {\n        year: 'numeric',\n        month: '2-digit',\n        day: '2-digit',\n        hour: '2-digit',\n        minute: '2-digit',\n      }).format(date),\n    formatNumber: (value: number, options?: Intl.NumberFormatOptions) =>\n      new Intl.NumberFormat(formatLocale, options).format(value),\n    formatCurrency: (value: number, currency: 'NOK' | 'USD' = 'USD') =>\n      new Intl.NumberFormat(formatLocale, { style: 'currency', currency }).format(value),\n    i18n: {\n      language: 'en',\n      changeLanguage: async () => undefined,\n    },\n  };\n};\n\nvi.mock('react-i18next', () => ({\n  useTranslation: (namespace?: string) => ({\n    t: (key: string, options?: Record<string, unknown>) =>\n      createTranslator(namespace ?? 'common').t(key, options ?? {}),\n    i18n: { changeLanguage: () => Promise.resolve() },\n  }),\n}));\n\nvi.mock('@/hooks/useTranslation', () => ({\n  useTranslation: (namespace?: string) => createTranslator(namespace),\n}));\n\n// Cleanup after each test case (e.g. clearing jsdom)\nafterEach(() => {\n  cleanup();\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/unit/analyticsWorkerFallback.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/unit/dataTransformations.performance.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generateSensoryEntry' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":52},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'generateTrackingEntry' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":54,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":75}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, test, expect, vi } from 'vitest';\nimport { generateEmotionEntry, generateSensoryEntry, generateTrackingEntry, generateAllMockData } from '@/lib/mockDataGenerator';\n\nvi.mock('@/lib/dataValidation', () => ({\n  validateEmotionEntry: vi.fn(() => ({ isValid: true })),\n  validateSensoryEntry: vi.fn(() => ({ isValid: true })),\n  validateTrackingEntry: vi.fn(() => ({ isValid: true })),\n}));\n\ndescribe('Data Transformation Performance', () => {\n  test('should handle large dataset generation efficiently', () => {\n    const startTime = performance.now();\n    \n    // Generate 1000 emotion entries\n    const entries = [];\n    for (let i = 0; i < 1000; i++) {\n      entries.push(generateEmotionEntry(`student-${i}`, new Date()));\n    }\n    \n    const endTime = performance.now();\n    const duration = endTime - startTime;\n    \n    // Should complete within 1 second\n    expect(duration).toBeLessThan(1000);\n    expect(entries.length).toBe(1000);\n  });\n\n  test('should handle concurrent data generation', async () => {\n    const promises = [];\n    const numConcurrent = 10;\n    \n    for (let i = 0; i < numConcurrent; i++) {\n      promises.push(\n        new Promise((resolve) => {\n          const data = generateAllMockData();\n          resolve(data);\n        })\n      );\n    }\n    \n    const startTime = performance.now();\n    const results = await Promise.all(promises);\n    const endTime = performance.now();\n    \n    expect(results.length).toBe(numConcurrent);\n    results.forEach(result => {\n      expect(result.students.length).toBeGreaterThan(0);\n      expect(result.trackingEntries.length).toBeGreaterThan(0);\n    });\n    \n    // Should handle concurrent generation efficiently\n    expect(endTime - startTime).toBeLessThan(5000);\n  });\n\n  test('should not have memory leaks with repeated generation', () => {\n    const iterations = 100;\n    let lastMemoryUsage = 0;\n    \n    for (let i = 0; i < iterations; i++) {\n      const data = generateAllMockData();\n      expect(data).toBeDefined();\n      \n      if (i === iterations - 1 && global.gc) {\n        global.gc();\n        const memoryUsage = process.memoryUsage().heapUsed;\n        \n        // Memory usage should not grow exponentially\n        if (lastMemoryUsage > 0) {\n          const growth = (memoryUsage - lastMemoryUsage) / lastMemoryUsage;\n          expect(growth).toBeLessThan(0.5); // Less than 50% growth\n        }\n        lastMemoryUsage = memoryUsage;\n      }\n    }\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/unit/dataTransformations.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":20,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[855,858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[855,858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, test, expect, vi } from 'vitest';\nimport { generateEmotionEntry, generateSensoryEntry, generateTrackingEntry, generateMockStudents, generateAllMockData } from '@/lib/mockDataGenerator';\n\nvi.mock('@/lib/dataValidation', () => ({\n  validateEmotionEntry: vi.fn(() => ({ isValid: true })),\n  validateSensoryEntry: vi.fn(() => ({ isValid: true })),\n  validateTrackingEntry: vi.fn(() => ({ isValid: true })),\n}));\n\ndescribe('Data Transformation', () => {\n  describe('Edge Cases', () => {\n    test('should handle empty data', () => {\n      const data = generateAllMockData();\n      expect(data).toBeDefined();\n      expect(data.students).toBeDefined();\n      expect(data.trackingEntries).toBeDefined();\n    });\n\n    test('should handle null values gracefully', () => {\n      const entry = generateEmotionEntry('student-1', new Date(), null as any);\n      expect(entry).toBeDefined();\n      expect(entry.emotion).toBeDefined();\n    });\n\n    test('should handle malformed student data', () => {\n      const student = { id: '', name: '', grade: '', dateOfBirth: '', notes: '', iepGoals: [], createdAt: new Date(), lastUpdated: new Date(), version: 1 };\n      const entry = generateTrackingEntry(student, 1, 'emma');\n      expect(entry).toBeDefined();\n      expect(entry.studentId).toBe('');\n    });\n  });\n\n  describe('Data Integrity', () => {\n    test('should generate unique IDs for each entry', () => {\n      const entries = [];\n      for (let i = 0; i < 100; i++) {\n        entries.push(generateEmotionEntry('student-1', new Date()));\n      }\n      const ids = entries.map(e => e.id);\n      const uniqueIds = new Set(ids);\n      expect(uniqueIds.size).toBe(100);\n    });\n\n    test('should generate valid intensity values', () => {\n      for (let i = 0; i < 50; i++) {\n        const entry = generateEmotionEntry('student-1', new Date());\n        expect(entry.intensity).toBeGreaterThanOrEqual(1);\n        expect(entry.intensity).toBeLessThanOrEqual(5);\n      }\n    });\n\n    test('should generate valid timestamps', () => {\n      const now = new Date();\n      const entry = generateEmotionEntry('student-1', now);\n      expect(entry.timestamp).toEqual(now);\n    });\n  });\n\n  describe('Scenario-based Generation', () => {\n    test('should generate appropriate data for emma scenario', () => {\n      const student = { id: 'emma-1', name: 'Emma', grade: '8', dateOfBirth: '2011-01-01', notes: '', iepGoals: [], createdAt: new Date(), lastUpdated: new Date(), version: 1 };\n      const entry = generateTrackingEntry(student, 10, 'emma');\n      expect(entry.emotions.length).toBeGreaterThan(0);\n      expect(entry.sensoryInputs.length).toBeGreaterThan(0);\n    });\n\n    test('should generate appropriate data for lars scenario', () => {\n      const student = { id: 'lars-1', name: 'Lars', grade: '6', dateOfBirth: '2013-01-01', notes: '', iepGoals: [], createdAt: new Date(), lastUpdated: new Date(), version: 1 };\n      const entry = generateTrackingEntry(student, 10, 'lars');\n      expect(entry.emotions.length).toBeGreaterThan(0);\n      expect(entry.sensoryInputs.length).toBeGreaterThan(0);\n    });\n\n    test('should generate appropriate data for astrid scenario', () => {\n      const student = { id: 'astrid-1', name: 'Astrid', grade: '9', dateOfBirth: '2010-01-01', notes: '', iepGoals: [], createdAt: new Date(), lastUpdated: new Date(), version: 1 };\n      const entry = generateTrackingEntry(student, 10, 'astrid');\n      expect(entry.emotions.length).toBeGreaterThan(0);\n      expect(entry.sensoryInputs.length).toBeGreaterThan(0);\n    });\n  });\n  describe('generateEmotionEntry', () => {\n    test('should generate a valid emotion entry', () => {\n      const entry = generateEmotionEntry('student-1', new Date());\n      expect(entry).toHaveProperty('id');\n      expect(entry).toHaveProperty('studentId', 'student-1');\n      expect(entry).toHaveProperty('timestamp');\n      expect(entry).toHaveProperty('emotion');\n      expect(entry).toHaveProperty('intensity');\n    });\n  });\n\n  describe('generateSensoryEntry', () => {\n    test('should generate a valid sensory entry', () => {\n      const entry = generateSensoryEntry('student-1', new Date());\n      expect(entry).toHaveProperty('id');\n      expect(entry).toHaveProperty('studentId', 'student-1');\n      expect(entry).toHaveProperty('timestamp');\n      expect(entry).toHaveProperty('type');\n      expect(entry).toHaveProperty('response');\n    });\n  });\n\n  describe('generateTrackingEntry', () => {\n    test('should generate a valid tracking entry for a given scenario', () => {\n      const student = { id: 'student-1', name: 'Test Student', grade: '1', dateOfBirth: '2022-01-01', notes: '', iepGoals: [], createdAt: new Date(), lastUpdated: new Date(), version: 1 };\n      const entry = generateTrackingEntry(student, 1, 'emma');\n      expect(entry).toHaveProperty('id');\n      expect(entry).toHaveProperty('studentId', 'student-1');\n      expect(entry).toHaveProperty('timestamp');\n      expect(entry).toHaveProperty('emotions');\n      expect(entry).toHaveProperty('sensoryInputs');\n      expect(entry).toHaveProperty('environmentalData');\n    });\n  });\n\n  describe('generateMockStudents', () => {\n    test('should generate a list of mock students', () => {\n      const students = generateMockStudents();\n      expect(students).toBeInstanceOf(Array);\n      expect(students.length).toBeGreaterThan(0);\n      students.forEach(student => {\n        expect(student).toHaveProperty('id');\n        expect(student).toHaveProperty('name');\n        expect(student).toHaveProperty('grade');\n      });\n    });\n  });\n\n  describe('generateAllMockData', () => {\n    test('should generate a complete set of mock data', () => {\n      const data = generateAllMockData();\n      expect(data).toHaveProperty('students');\n      expect(data).toHaveProperty('trackingEntries');\n      expect(data.students.length).toBeGreaterThan(0);\n      expect(data.trackingEntries.length).toBeGreaterThan(0);\n    });\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/unit/entryDetailsDrawer.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/unit/evidence/select.weighted.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/unit/explanationChat.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/unit/exportAiReport.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[194,197],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[194,197],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1058,1061],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1058,1061],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":32,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1448,1451],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1448,1451],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1950,1953],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1950,1953],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":49,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2607,2610],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2607,2610],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\nimport type { AnalyticsResultsAI } from '@/lib/analysis/analysisEngine';\n\nvi.mock('@/lib/evidence', async (orig) => {\n  const mod: any = await orig();\n  return {\n    ...mod,\n    resolveSources: vi.fn(async (ids: string[]) => ids.map((id) => ({ id, title: `Source ${id}`, url: 'https://example.com', shortExcerpt: 'Excerpt', tags: ['udl'], year: 2021 }))),\n  };\n});\n\ndescribe('exportAiReport.formatAiReportText', () => {\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  it('includes inline sources and a Källor section', async () => {\n    const { formatAiReportText } = await import('@/lib/ai/exportAiReport');\n    const result: AnalyticsResultsAI = {\n      patterns: [], correlations: [], environmentalCorrelations: [], predictiveInsights: [], anomalies: [], insights: [], suggestedInterventions: [\n        { title: 'Intervention A', description: 'Desc', actions: [], metrics: ['M1'], sources: ['s1','s2'], udlCheckpoints: [], hlps: [], tier: 'Tier1', scope: 'classroom' }\n      ]\n    } as any;\n    const text = await formatAiReportText(result, { includeMetadata: false, locale: 'sv' });\n    expect(text).toMatch(/\\[Källor: Source s1, Source s2\\]/);\n    expect(text).toMatch(/# Källor/);\n    expect(text).toMatch(/• Source s1/);\n  });\n\n  it('omits sources section gracefully when resolve fails', async () => {\n    const evidence = await import('@/lib/evidence');\n    (evidence as any).resolveSources.mockImplementationOnce(async () => { throw new Error('fail'); });\n    const { formatAiReportText } = await import('@/lib/ai/exportAiReport');\n    const result: AnalyticsResultsAI = {\n      patterns: [], correlations: [], environmentalCorrelations: [], predictiveInsights: [], anomalies: [], insights: [], suggestedInterventions: [\n        { title: 'Intervention A', description: 'Desc', actions: [], metrics: ['M1'], sources: ['s1'], udlCheckpoints: [], hlps: [] }\n      ]\n    } as any;\n    const text = await formatAiReportText(result, { includeMetadata: false, locale: 'sv' });\n    expect(text).not.toMatch(/# Källor/);\n  });\n\n  it('handles interventions without sources and omits inline [Källor: ...] labels', async () => {\n    const { formatAiReportText } = await import('@/lib/ai/exportAiReport');\n    const result: AnalyticsResultsAI = {\n      patterns: [], correlations: [], environmentalCorrelations: [], predictiveInsights: [], anomalies: [], insights: [], suggestedInterventions: [\n        { title: 'Intervention A', description: 'Desc', actions: [], metrics: ['M1'], sources: [], udlCheckpoints: [], hlps: [] }\n      ]\n    } as any;\n    const text = await formatAiReportText(result, { includeMetadata: false, locale: 'sv' });\n    expect(text).not.toMatch(/\\[Källor:/);\n    expect(text).not.toMatch(/# Källor/);\n  });\n});\n\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/unit/exportDialog.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/unit/exportFilters.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DatePreset' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":50,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":60}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from 'vitest';\nimport { computeDateRange, isCustomRangeInvalid, DatePreset } from '@/lib/dateRange';\n\ndescribe('export filters helpers', () => {\n  it('computes relative presets', () => {\n    const r7 = computeDateRange('7d');\n    expect(r7).toBeTruthy();\n    const diffDays = Math.round((r7!.end.getTime() - r7!.start.getTime()) / (1000*60*60*24));\n    expect(diffDays).toBeGreaterThanOrEqual(6);\n  });\n\n  it('returns undefined for all', () => {\n    expect(computeDateRange('all')).toBeUndefined();\n  });\n\n  it('validates custom ranges', () => {\n    const valid = computeDateRange('custom', '2025-01-01', '2025-01-31');\n    expect(valid).toBeTruthy();\n    expect(isCustomRangeInvalid('custom', '2025-01-01', '2025-01-31')).toBe(false);\n    expect(isCustomRangeInvalid('custom', '', '2025-01-31')).toBe(true);\n    expect(isCustomRangeInvalid('custom', '2025-02-01', '2025-01-31')).toBe(true);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/unit/heuristicAnalysisEngine.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[435,438],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[435,438],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":50,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1518,1521],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1518,1521],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1907,1910],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1907,1910],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":79,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2651,2654],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2651,2654],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2979,2982],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2979,2982],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { HeuristicAnalysisEngine } from '@/lib/analysis/heuristicAnalysisEngine';\nimport { ZAiReport } from '@/lib/analysis/aiSchema';\n\nvi.mock('@/lib/dataStorage', () => {\n  return {\n    dataStorage: {\n      getEntriesForStudent: vi.fn(() => []),\n      getGoalsForStudent: vi.fn(() => []),\n    },\n  };\n});\n\nvi.mock('@/lib/analyticsConfig', async (orig) => {\n  const mod: any = await orig();\n  // Ensure deterministic config for tests\n  return {\n    ...mod,\n    analyticsConfig: {\n      getConfig: () => ({\n        ...mod.DEFAULT_ANALYTICS_CONFIG,\n        cache: { ...mod.DEFAULT_ANALYTICS_CONFIG.cache, ttl: 1000 },\n      }),\n      subscribe: () => () => {},\n    },\n  };\n});\n\ndescribe('HeuristicAnalysisEngine', () => {\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  it('returns safe results on invalid student id', async () => {\n    const engine = new HeuristicAnalysisEngine();\n    // @ts-expect-error testing invalid input\n    const res = await engine.analyzeStudent(undefined);\n    expect(res).toBeDefined();\n    expect(res.patterns).toEqual([]);\n    expect(res.correlations).toEqual([]);\n    expect(res.predictiveInsights).toEqual([]);\n    expect(res.anomalies).toEqual([]);\n  });\n\n  it('wraps unified analytics and returns AnalyticsResultsAI', async () => {\n    const engine = new HeuristicAnalysisEngine();\n    const { dataStorage } = await import('@/lib/dataStorage');\n\n    const now = new Date();\n    (dataStorage.getEntriesForStudent as any).mockReturnValue([\n      {\n        id: 'e1',\n        studentId: 's1',\n        timestamp: now,\n        emotions: [\n          { id: 'em1', studentId: 's1', emotion: 'happy', intensity: 3, timestamp: now },\n        ],\n        sensoryInputs: [\n          { id: 'sens1', studentId: 's1', response: 'calm', timestamp: now },\n        ],\n      },\n    ]);\n    (dataStorage.getGoalsForStudent as any).mockReturnValue([]);\n\n    const res = await engine.analyzeStudent('s1', undefined, { includeAiMetadata: true });\n    expect(res).toBeDefined();\n    expect(Array.isArray(res.patterns)).toBe(true);\n    expect(Array.isArray(res.correlations)).toBe(true);\n    expect(Array.isArray(res.predictiveInsights)).toBe(true);\n    expect(Array.isArray(res.anomalies)).toBe(true);\n    expect(res.ai?.provider).toBe('heuristic');\n    expect(typeof res.ai?.confidence?.overall === 'number').toBe(true);\n  });\n\n  it('respects conservative preset via options', async () => {\n    const engine = new HeuristicAnalysisEngine();\n    const { dataStorage } = await import('@/lib/dataStorage');\n    const now = new Date();\n    (dataStorage.getEntriesForStudent as any).mockReturnValue([\n      { id: 'e1', studentId: 's1', timestamp: now, emotions: [], sensoryInputs: [] },\n      { id: 'e2', studentId: 's1', timestamp: now, emotions: [], sensoryInputs: [] },\n      { id: 'e3', studentId: 's1', timestamp: now, emotions: [], sensoryInputs: [] },\n    ]);\n    (dataStorage.getGoalsForStudent as any).mockReturnValue([]);\n\n    const res = await engine.analyzeStudent('s1', undefined, { profile: 'conservative', includeAiMetadata: true });\n    expect(res).toBeDefined();\n    expect(res.ai?.provider).toBe('heuristic');\n  });\n\n  it('produces heuristic interventions compatible with extended schema (empty evidence fields)', async () => {\n    const parsed = ZAiReport.safeParse({\n      summary: 's', keyFindings: [], patterns: [], correlations: [], hypothesizedCauses: [], suggestedInterventions: [\n        { title: 't', description: 'd', actions: [], expectedImpact: 'low', metrics: [], sources: [] }\n      ], anomalies: [], predictiveInsights: [], dataLineage: [], confidence: { overall: 0.5 }\n    });\n    expect(parsed.success).toBe(true);\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/unit/interactiveFeatures.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'waitFor' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":37,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[501,504],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[501,504],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":23,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[726,729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[726,729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":117,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3855,3858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3855,3858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":144,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4903,4906],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4903,4906],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, test, expect, vi } from 'vitest';\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport React from 'react';\n\n// Mock components for testing\nconst MockStudentList = ({ onSelect }: { onSelect: (id: string) => void }) => {\n  return (\n    <div>\n      <button onClick={() => onSelect('student-1')}>Student 1</button>\n      <button onClick={() => onSelect('student-2')}>Student 2</button>\n    </div>\n  );\n};\n\nconst MockDataVisualization = ({ data }: { data: any }) => {\n  return (\n    <div data-testid=\"data-visualization\">\n      {data ? `Displaying ${data.length} entries` : 'No data'}\n    </div>\n  );\n};\n\nconst MockFilterControls = ({ onFilterChange }: { onFilterChange: (filters: any) => void }) => {\n  return (\n    <div>\n      <button onClick={() => onFilterChange({ emotion: 'happy' })}>Filter Happy</button>\n      <button onClick={() => onFilterChange({ emotion: null })}>Clear Filters</button>\n    </div>\n  );\n};\n\ndescribe('Interactive Features', () => {\n  describe('User Interactions', () => {\n    test('should handle student selection', () => {\n      const handleSelect = vi.fn();\n      render(<MockStudentList onSelect={handleSelect} />);\n      \n      const student1Button = screen.getByText('Student 1');\n      fireEvent.click(student1Button);\n      \n      expect(handleSelect).toHaveBeenCalledWith('student-1');\n    });\n\n    test('should update visualization on data change', () => {\n      const { rerender } = render(<MockDataVisualization data={null} />);\n      expect(screen.getByText('No data')).toBeInTheDocument();\n      \n      rerender(<MockDataVisualization data={[1, 2, 3]} />);\n      expect(screen.getByText('Displaying 3 entries')).toBeInTheDocument();\n    });\n\n    test('should handle filter changes', () => {\n      const handleFilterChange = vi.fn();\n      render(<MockFilterControls onFilterChange={handleFilterChange} />);\n      \n      const filterButton = screen.getByText('Filter Happy');\n      fireEvent.click(filterButton);\n      \n      expect(handleFilterChange).toHaveBeenCalledWith({ emotion: 'happy' });\n      \n      const clearButton = screen.getByText('Clear Filters');\n      fireEvent.click(clearButton);\n      \n      expect(handleFilterChange).toHaveBeenCalledWith({ emotion: null });\n    });\n  });\n\n  describe('Error Handling UI', () => {\n    const MockErrorBoundary = ({ children, fallback }: { children: React.ReactNode, fallback: React.ComponentType<{ error: Error }> }) => {\n      const [hasError, setHasError] = React.useState(false);\n      const [error, setError] = React.useState<Error | null>(null);\n\n      React.useEffect(() => {\n        const errorHandler = (event: ErrorEvent) => {\n          setHasError(true);\n          setError(new Error(event.message));\n        };\n        window.addEventListener('error', errorHandler);\n        return () => window.removeEventListener('error', errorHandler);\n      }, []);\n\n      if (hasError && error) {\n        const FallbackComponent = fallback;\n        return <FallbackComponent error={error} />;\n      }\n\n      return <>{children}</>;\n    };\n\n    const ThrowError = () => {\n      throw new Error('Test error');\n    };\n\n    test('should display error UI when component fails', () => {\n      const ErrorFallback = ({ error }: { error: Error }) => (\n        <div role=\"alert\">Error: {error.message}</div>\n      );\n\n      // Suppress console.error for this test\n      const originalError = console.error;\n      console.error = vi.fn();\n\n      expect(() => {\n        render(\n          <MockErrorBoundary fallback={ErrorFallback}>\n            <ThrowError />\n          </MockErrorBoundary>\n        );\n      }).toThrow();\n\n      // Restore console.error\n      console.error = originalError;\n    });\n  });\n\n  describe('Loading States', () => {\n    const MockLoadingComponent = ({ isLoading, data }: { isLoading: boolean, data?: any }) => {\n      if (isLoading) {\n        return <div role=\"status\" aria-busy=\"true\">Loading...</div>;\n      }\n      return <div>{data || 'No data'}</div>;\n    };\n\n    test('should show loading state', () => {\n      render(<MockLoadingComponent isLoading={true} />);\n      \n      const loadingElement = screen.getByRole('status');\n      expect(loadingElement).toBeInTheDocument();\n      expect(loadingElement).toHaveAttribute('aria-busy', 'true');\n      expect(screen.getByText('Loading...')).toBeInTheDocument();\n    });\n\n    test('should show data after loading', () => {\n      const { rerender } = render(<MockLoadingComponent isLoading={true} />);\n      expect(screen.getByText('Loading...')).toBeInTheDocument();\n      \n      rerender(<MockLoadingComponent isLoading={false} data=\"Test data\" />);\n      expect(screen.queryByText('Loading...')).not.toBeInTheDocument();\n      expect(screen.getByText('Test data')).toBeInTheDocument();\n    });\n  });\n\n  describe('Form Validation', () => {\n    const MockForm = ({ onSubmit }: { onSubmit: (data: any) => void }) => {\n      const [errors, setErrors] = React.useState<{ [key: string]: string }>({});\n      \n      const handleSubmit = (e: React.FormEvent) => {\n        e.preventDefault();\n        const formData = new FormData(e.target as HTMLFormElement);\n        const data = Object.fromEntries(formData);\n        \n        const newErrors: { [key: string]: string } = {};\n        if (!data.name) {\n          newErrors.name = 'Name is required';\n        }\n        if (!data.grade) {\n          newErrors.grade = 'Grade is required';\n        }\n        \n        if (Object.keys(newErrors).length > 0) {\n          setErrors(newErrors);\n        } else {\n          onSubmit(data);\n        }\n      };\n      \n      return (\n        <form onSubmit={handleSubmit}>\n          <div>\n            <input name=\"name\" placeholder=\"Name\" aria-label=\"Name\" />\n            {errors.name && <span role=\"alert\">{errors.name}</span>}\n          </div>\n          <div>\n            <input name=\"grade\" placeholder=\"Grade\" aria-label=\"Grade\" />\n            {errors.grade && <span role=\"alert\">{errors.grade}</span>}\n          </div>\n          <button type=\"submit\">Submit</button>\n        </form>\n      );\n    };\n\n    test('should validate required fields', () => {\n      const handleSubmit = vi.fn();\n      render(<MockForm onSubmit={handleSubmit} />);\n      \n      const submitButton = screen.getByText('Submit');\n      fireEvent.click(submitButton);\n      \n      expect(screen.getByText('Name is required')).toBeInTheDocument();\n      expect(screen.getByText('Grade is required')).toBeInTheDocument();\n      expect(handleSubmit).not.toHaveBeenCalled();\n    });\n\n    test('should submit valid form', () => {\n      const handleSubmit = vi.fn();\n      render(<MockForm onSubmit={handleSubmit} />);\n      \n      const nameInput = screen.getByPlaceholderText('Name');\n      const gradeInput = screen.getByPlaceholderText('Grade');\n      \n      fireEvent.change(nameInput, { target: { value: 'John Doe' } });\n      fireEvent.change(gradeInput, { target: { value: '10' } });\n      \n      const submitButton = screen.getByText('Submit');\n      fireEvent.click(submitButton);\n      \n      expect(handleSubmit).toHaveBeenCalledWith({\n        name: 'John Doe',\n        grade: '10'\n      });\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/unit/llmAnalysisEngine.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[416,419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[416,419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[490,493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[490,493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[812,815],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[812,815],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":46,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1101,1104],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1101,1104],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":60,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1616,1619],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1616,1619],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":81,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2765,2768],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2765,2768],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":84,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":84,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2921,2924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2921,2924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":95,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3421,3424],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3421,3424],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":102,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3735,3738],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3735,3738],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":105,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3891,3894],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3891,3894],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":118,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4526,4529],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4526,4529],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":128,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5109,5112],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5109,5112],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":129,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5160,5163],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5160,5163],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":130,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5232,5235],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5232,5235],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5532,5535],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5532,5535],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":136,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5572,5575],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5572,5575],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":152,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6422,6425],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6422,6425],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":166,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7154,7157],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7154,7157],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":172,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7654,7657],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7654,7657],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":176,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7930,7933],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7930,7933],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":178,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8061,8064],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8061,8064],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":179,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8144,8147],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8144,8147],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":179,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8175,8178],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8175,8178],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":182,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8326,8329],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8326,8329],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":187,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8555,8558],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8555,8558],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":201,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":201,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9545,9548],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9545,9548],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":215,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10373,10376],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10373,10376],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":225,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":225,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10838,10841],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10838,10841],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":227,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":227,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11016,11019],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11016,11019],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":29,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { LLMAnalysisEngine } from '@/lib/analysis/llmAnalysisEngine';\nimport { ZAiReport } from '@/lib/analysis/aiSchema';\n\nvi.mock('@/lib/dataStorage', () => {\n  return {\n    dataStorage: {\n      getEntriesForStudent: vi.fn(() => []),\n      getGoalsForStudent: vi.fn(() => []),\n    },\n  };\n});\n\nvi.mock('@/lib/aiConfig', async (orig) => {\n  const mod: any = await orig();\n  return {\n    ...mod,\n    loadAiConfig: (overrides?: any) => ({\n      ...mod.DEFAULT_AI_CONFIG,\n      enabled: true,\n      apiKey: 'test-key',\n      ...(overrides || {}),\n    }),\n  };\n});\n\nvi.mock('@/lib/ai/openrouterClient', () => {\n  return {\n    openRouterClient: {\n      chatJSON: vi.fn(),\n    },\n  };\n});\n\nvi.mock('@/lib/evidence/select', async (orig) => {\n  const mod: any = await orig();\n  return {\n    ...mod,\n    selectEvidence: vi.fn(async () => [\n      { id: 's1', title: 'UDL Guidelines', url: 'https://example.com', shortExcerpt: 'Evidence excerpt...', tags: ['udl'] },\n    ]),\n  };\n});\n\nvi.mock('@/lib/evidence/index', async (orig) => {\n  const mod: any = await orig();\n  return {\n    ...mod,\n    resolveSources: vi.fn(async (ids: string[]) => ids.map((id) => ({ id, title: `Source ${id}`, url: 'https://example.com', shortExcerpt: 'Short excerpt', tags: ['udl'], year: 2020}))),\n  };\n});\n\ndescribe('LLMAnalysisEngine', () => {\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  it('returns AI analysis on success and attaches metadata', async () => {\n    const { openRouterClient } = await import('@/lib/ai/openrouterClient');\n    (openRouterClient.chatJSON as any).mockResolvedValue({\n      data: {\n        summary: 'Test summary',\n        keyFindings: ['finding1'],\n        patterns: [{ name: 'pattern', description: 'desc', strength: 0.7, impact: 'medium', evidence: [] }],\n        correlations: [{ variables: ['a','b'], coefficient: 0.5, direction: 'positive', pValue: 0.1, confounders: [], evidence: [] }],\n        hypothesizedCauses: [{ cause: 'c', likelihood: 0.5, rationale: 'r', supportingEvidence: [] }],\n        suggestedInterventions: [{ title: 't', description: 'd', actions: [], expectedImpact: 'low', metrics: [] }],\n        anomalies: [{ description: 'an', severity: 'low', evidence: [] }],\n        predictiveInsights: [{ outcome: 'o', probability: 0.6 }],\n        insights: ['insight'],\n        dataLineage: [],\n        confidence: { overall: 0.8 },\n      },\n      response: {\n        content: '{}', raw: { model: 'gpt-4o-mini' }, usage: { prompt_tokens: 10, completion_tokens: 20, total_tokens: 30 }, metrics: { durationMs: 100, attempts: 1 }\n      }\n    });\n\n    const now = new Date();\n    const { dataStorage } = await import('@/lib/dataStorage');\n    (dataStorage.getEntriesForStudent as any).mockReturnValue([\n      { id: 'e1', studentId: 's1', timestamp: now, emotions: [], sensoryInputs: [] },\n    ]);\n    (dataStorage.getGoalsForStudent as any).mockReturnValue([]);\n\n    const engine = new LLMAnalysisEngine();\n    const res = await engine.analyzeStudent('s1', undefined, { includeAiMetadata: true });\n    expect(res).toBeDefined();\n    expect(res.ai?.provider).toBe('openrouter');\n    expect(typeof res.ai?.confidence?.overall === 'number').toBe(true);\n  });\n\n  it('falls back to heuristic on invalid AI response', async () => {\n    const { openRouterClient } = await import('@/lib/ai/openrouterClient');\n    (openRouterClient.chatJSON as any).mockResolvedValue({\n      data: 'not-json',\n      response: { content: 'not-json', raw: { model: 'gpt-4o-mini' }, usage: {}, metrics: { durationMs: 50, attempts: 1 } }\n    });\n\n    const now = new Date();\n    const { dataStorage } = await import('@/lib/dataStorage');\n    (dataStorage.getEntriesForStudent as any).mockReturnValue([\n      { id: 'e1', studentId: 's1', timestamp: now, emotions: [], sensoryInputs: [] },\n    ]);\n    (dataStorage.getGoalsForStudent as any).mockReturnValue([]);\n\n    const engine = new LLMAnalysisEngine();\n    const res = await engine.analyzeStudent('s1', undefined, { includeAiMetadata: true });\n    // Should produce heuristic results with caveat metadata\n    expect(res).toBeDefined();\n    expect(res.ai).toBeDefined();\n    expect(res.ai?.caveats?.some((c) => /fallback/i.test(c || ''))).toBe(true);\n  });\n\n  it('selects evidence and preserves sources[] in interventions', async () => {\n    const { openRouterClient } = await import('@/lib/ai/openrouterClient');\n    const { selectEvidence } = await import('@/lib/evidence/select');\n    (openRouterClient.chatJSON as any).mockResolvedValue({\n      data: {\n        summary: 's', keyFindings: [], patterns: [], correlations: [],\n        suggestedInterventions: [ { title: 't', description: 'd', actions: [], expectedImpact: 'low', metrics: [] } ],\n        anomalies: [], predictiveInsights: [], dataLineage: [], confidence: { overall: 0.8 }\n      },\n      response: { raw: { model: 'g' }, usage: {}, metrics: { durationMs: 1 } }\n    });\n    const engine = new LLMAnalysisEngine();\n    const res = await engine.analyzeStudent('s1', undefined, { includeAiMetadata: true });\n    expect((selectEvidence as any)).toHaveBeenCalled();\n    const ints = (res as any).suggestedInterventions || [];\n    const hasSources = ints.some((i: any) => Array.isArray(i.sources) && i.sources.length > 0);\n    expect(hasSources).toBe(true);\n  });\n\n  it('IEP mode threads through and requires richer intervention metadata', async () => {\n    const { openRouterClient } = await import('@/lib/ai/openrouterClient');\n    (openRouterClient.chatJSON as any).mockImplementation(async (payload: any) => {\n      // Inspect prompt for IEP-safe signals\n      const userText: string = payload?.[1]?.content || '';\n      expect(typeof userText === 'string').toBe(true);\n      // Return minimal valid AI report; engine should augment as needed\n      return {\n        data: {\n          summary: 's', keyFindings: [], patterns: [], correlations: [],\n          suggestedInterventions: [ { title: 't', description: 'd', actions: [], expectedImpact: 'low', metrics: [] } ],\n          anomalies: [], predictiveInsights: [], dataLineage: [], confidence: { overall: 0.8 }\n        },\n        response: { raw: { model: 'g' }, usage: {}, metrics: { durationMs: 1 } }\n      };\n    });\n    const engine = new LLMAnalysisEngine();\n    const res = await engine.analyzeStudent('s1', undefined, { includeAiMetadata: true, aiProfile: 'iep' });\n    const ints = (res as any).suggestedInterventions || [];\n    expect(ints.length).toBeGreaterThan(0);\n    const first = ints[0];\n    expect(Array.isArray(first.sources)).toBe(true);\n    expect(first.metrics).toBeDefined();\n    // optional but preferred in IEP mode\n    expect(['short','medium','long']).toContain(first.timeHorizon ?? 'short');\n    expect(['Tier1','Tier2','Tier3']).toContain(first.tier ?? 'Tier1');\n    expect(['classroom','school']).toContain(first.scope ?? 'classroom');\n  });\n\n  it('does not select evidence when VITE_AI_EVIDENCE_DISABLED=true', async () => {\n    const { openRouterClient } = await import('@/lib/ai/openrouterClient');\n    const evidenceIndex = await import('@/lib/evidence/select');\n    (openRouterClient.chatJSON as any).mockResolvedValue({\n      data: { summary: 's', keyFindings: [], patterns: [], correlations: [], suggestedInterventions: [ { title: 't', description: 'd', actions: [], expectedImpact: 'low', metrics: [] } ], anomalies: [], predictiveInsights: [], dataLineage: [], confidence: { overall: 0.8 } },\n      response: { raw: { model: 'g' }, usage: {}, metrics: { durationMs: 1 } }\n    });\n    // Temporarily stub the env flag module import\n    const envMod = await import('@/lib/env');\n    (envMod as any).AI_EVIDENCE_DISABLED = true;\n    const engine = new LLMAnalysisEngine();\n    const res = await engine.analyzeStudent('s1', undefined, { includeAiMetadata: true, bypassCache: true });\n    // Assert selectEvidence was suppressed\n    expect((evidenceIndex.selectEvidence as any)).toHaveBeenCalledTimes(0);\n    // Interventions should still be present and have sources: []\n    expect(Array.isArray((res as any).suggestedInterventions)).toBe(true);\n    const allHaveEmptySources = ((res as any).suggestedInterventions as any[]).every(iv => Array.isArray(iv.sources) && iv.sources.length === 0);\n    expect(allHaveEmptySources).toBe(true);\n    // Reset flag\n    (envMod as any).AI_EVIDENCE_DISABLED = false;\n  });\n\n  it('threads aiProfile to cache key and prompt path (smoke)', async () => {\n    const { openRouterClient } = await import('@/lib/ai/openrouterClient');\n    (openRouterClient.chatJSON as any).mockResolvedValue({ data: { summary: 's', keyFindings: [], patterns: [], correlations: [], suggestedInterventions: [], anomalies: [], predictiveInsights: [], dataLineage: [], confidence: { overall: 0.8 } }, response: { raw: { model: 'g' }, usage: {}, metrics: { durationMs: 1 } } });\n    const engine = new LLMAnalysisEngine();\n    const res1 = await engine.analyzeStudent('s1', undefined, { aiProfile: 'iep' });\n    const res2 = await engine.analyzeStudent('s1', undefined, { aiProfile: 'default', bypassCache: true });\n    expect(res1).toBeDefined();\n    expect(res2).toBeDefined();\n  });\n\n  it('IEP mode passes profile to generateAnalysisPrompt and affects cache behavior with disclaimers', async () => {\n    const { openRouterClient } = await import('@/lib/ai/openrouterClient');\n    // Spy on prompt generator\n    const promptMod = await import('@/lib/analysis/promptEngineering');\n    const spy = vi.spyOn(promptMod, 'generateAnalysisPrompt');\n\n    (openRouterClient.chatJSON as any).mockResolvedValue({\n      data: {\n        summary: 's', keyFindings: [], patterns: [], correlations: [], suggestedInterventions: [ { title: 't', description: 'd', actions: [], expectedImpact: 'low', metrics: [] } ], anomalies: [], predictiveInsights: [], dataLineage: [], confidence: { overall: 0.8 }\n      },\n      response: { raw: { model: 'g' }, usage: {}, metrics: { durationMs: 1 } }\n    });\n\n    const engine = new LLMAnalysisEngine();\n    const resIep = await engine.analyzeStudent('s1', undefined, { includeAiMetadata: true, aiProfile: 'iep' });\n    expect(spy).toHaveBeenCalled();\n    // Third argument should be 'iep'\n    const lastCall = spy.mock.calls.at(-1);\n    expect(lastCall?.[2]).toBe('iep');\n    // Expect IEP guidance/disclaimer in system or caveats\n    const sys = (promptMod.generateAnalysisPrompt as any).mock?.results?.[0]?.system;\n    if (typeof sys === 'string') {\n      expect(sys.toLowerCase()).toContain('ingen medisinske');\n      expect(sys.toLowerCase()).toContain('klasserommet');\n    }\n    if (resIep.ai?.caveats) {\n      expect(resIep.ai.caveats.join(' ').toLowerCase()).not.toBeUndefined();\n    }\n\n    // Cache key difference proxy: subsequent default profile call should still perform a fresh call\n    const callsBefore = (openRouterClient.chatJSON as any).mock.calls.length;\n    await engine.analyzeStudent('s1', undefined, { includeAiMetadata: true, aiProfile: 'default' });\n    const callsAfter = (openRouterClient.chatJSON as any).mock.calls.length;\n    expect(callsAfter).toBeGreaterThan(callsBefore);\n  });\n\n  it('validates AI schema with evidence fields present', async () => {\n    const valid = ZAiReport.safeParse({\n      summary: 's', keyFindings: [], patterns: [], correlations: [], hypothesizedCauses: [], suggestedInterventions: [\n        { title: 't', description: 'd', actions: [], expectedImpact: 'low', metrics: [], sources: ['s1'], udlCheckpoints: ['1.1'], hlps: ['HLP1'], tier: 'Tier1', scope: 'classroom' }\n      ], anomalies: [], predictiveInsights: [], dataLineage: [], confidence: { overall: 0.8 }\n    });\n    expect(valid.success).toBe(true);\n  });\n});\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/unit/sanitizePlainNorwegian.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/unit/visualSnapshot.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/quentinthiessen/Desktop/kreativiummedgemma/tests/utils/a11y.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
